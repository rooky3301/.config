"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1144],{33932:(e,t,n)=>{n.r(t),n.d(t,{closeAssistantRightHandSideMenu:()=>u,navigateToView:()=>d,openAssistantRightHandSideMenu:()=>c});n(21703);var s=n(97880),i=n(21273),a=n(98180),o=n(56206),r=n(58016),l=n(28344);function d(e){o.d.setState({...o.d.state,currentView:e.view})}async function c(e){const{environment:t,from:n}=e,d=i.Z.isAssistantExperienceQna();let c=a.Z.getActiveSessionId();const u=d&&a.Z.wasActiveSessionLastOpenedOutsideOfHistorySavedWindow();if(!c||u){c=(await(0,r.resetAndInitializeAssistantSession)({environment:t})).sessionId}if(d&&(0,s.$K)(n)){const e=a.Z.getSessionContextOrThrow(c),s=e.assistantConfigurationStore.state;if(!s)throw new Error("No configuration state");l.trackQnAOpened(t,{configurationState:s,runtimeState:e.assistantRuntimeStore.state,hasQuery:!1,from:n,searchSessionId:void 0})}(0,r.updateAssistantTimestampsAfterSessionInitialization)({environment:t}),o.d.setState({open:!0,currentView:"chat"})}function u(){o.d.setState({...o.d.state,open:!1})}},70771:(e,t,n)=>{n.d(t,{Cc:()=>g,K7:()=>u,Nt:()=>m,OZ:()=>p});n(21703),n(41432);var s=n(4615),i=(n(71644),n(21202),n(6287),n(13493),n(91644),n(19889),n(70203),n(54642)),a=(n(94419),n(9953)),o=(n(80444),n(98180)),r=n(82375),l=n(89912),d=n(58016),c=n(33932);async function u(e){const{environment:t,spaceId:n}=e,s=await i.getSkillsInSpace(t,{spaceId:n});if("success"!==s.type)throw new Error("Failed to fetch skills in space.");const{skillIds:a}=s.data;l.L.setState({...l.L.state,serverSkillIds:new Set(a)})}async function p(e){var t;const{environment:n,clientSkill:i}=e,a=r.Pl.state,l=Boolean(a);if(!i.inAppSkillTrigger)return;(0,c.navigateToView)({view:"chat"});const{sessionId:u}=await(0,d.resetAndInitializeAssistantSession)({environment:n,isLabelerSlackMode:l,fakeSlackChannel:null==a?void 0:a.selectedFakeChannel,clientSkill:i,skillSettings:{}});if(!(null===(t=o.Z.getSessionContextOrThrow(u).assistantRuntimeStore.state)||void 0===t?void 0:t.evaluator))throw new Error("No evaluator.");i.inAppSkillTrigger.requiresInput||await(0,d.sampleNextAssistantSteps)({environment:n,inferenceId:(0,s.ZP)(),sessionId:u})}function g(e){const{store:t,update:n,transaction:s}=e;a.sW({store:t.getSettingsStore(),data:n,transaction:s})}function m(e){const{store:t,transaction:n}=e;a.sW({store:t,data:{alive:!1},transaction:n})}},26382:(e,t,n)=>{n.r(t),n.d(t,{AssistantFullPageChat:()=>Te,AssistantLabelerBar:()=>z,AssistantMenuPopup:()=>Pe,AssistantOriginElement:()=>be,AssistantWriterInProgressContent:()=>w,AssistantWriterPopupRenderer:()=>v,SearchAssistantPane:()=>Xe,assistantActions:()=>s,assistantAnalyticsActions:()=>i,assistantMenuActions:()=>a,assistantMenuStore:()=>r.d,assistantOriginElementStore:()=>l.N,clientSkillHelpers:()=>o});var s=n(58016),i=n(28344),a=n(33932),o=n(27967),r=n(56206),l=n(40824),d=(n(67635),n(67294)),c=n(86628),u=n(24405),p=n(9291),g=n(80444),m=n(98180),h=n(67973),S=n(84969),f=n(85893);function v(e){window.__c={n:"AssistantWriterPopupRenderer"};const t=(0,p.useIntl)(),n=(0,c.VK)((()=>g.default.state.currentSpaceStore),[]),s=(0,c.VK)((()=>m.Z.getActiveAssistantConfigurationState()),[]),i=(0,c.VK)((()=>m.Z.getActiveAssistantRuntimeState()),[]),a=(0,c.VK)((()=>{if(i)return i.temporaryClientSteps.findLast((e=>"assistantChat"===e.type))}),[i],{useDeepEqual:!0}),r=(0,c.qz)(void 0,h.d),l=(0,u.yK)((e=>({defaultMessageWrap:{padding:"3px 2px"}})),[]);return n&&s&&i?(0,f.jsxs)(f.Fragment,{children:[i.selectedSkill&&0===i.clientSteps.length&&o.skillDefaultAssistantMessageMap[i.selectedSkill.skillType]&&(0,f.jsx)("div",{style:l.defaultMessageWrap,children:t.formatMessage(o.skillDefaultAssistantMessageMap[i.selectedSkill.skillType])}),a&&(0,f.jsx)(S.m,{clientStep:a,parentStore:n,configurationState:s,fakeSlackUser:void 0,isLatestStep:!0,isQuickSearchMode:!1,renderAsFullPage:!1,priorSearchResultsStep:void 0,citationHoverStore:r,disableWrap:!0})]}):null}var x=n(23388),y=n(49631),k=n(16540);function w(e){window.__c={n:"AssistantWriterInProgressContent"};const t=(0,c.VK)((()=>g.default.state.currentSpaceStore),[]),n=(0,c.VK)((()=>m.Z.getActiveAssistantConfigurationState()),[]),s=(0,c.VK)((()=>m.Z.getActiveAssistantRuntimeState()),[]),i=(0,x.f6)({assistantRuntimeState:s,assistantConfigurationState:n}),a=(0,c.qz)(void 0,h.d);return t&&n&&s?(0,f.jsx)("div",{style:{minHeight:36},children:"searchResults"===(null==i?void 0:i.type)?(0,f.jsx)(k.N,{clientStep:i.step,parentStore:t,configurationState:n,citationHoverStore:a,isQuickSearchMode:!1,renderAsFullPage:!1}):(0,f.jsx)(y.H,{clientStep:{type:"assistantLoading"},parentStore:t,parentSpaceId:t.id,configurationState:n,isQuickSearchMode:!1,renderAsFullPage:!1,latestStepCitationHoverStore:a})}):null}var b=n(480),C=n(94568),j=n(42875),A=n(59054),M=n(72126),I=n(21202),Z=n(70203),T=n(82990),F=n(54642),R=n(98104),P=n(52275),B=n(88359),_=n(1743),V=n(74194),K=n(84076),L=n(68785),W=n(63296),E=n(53437),O=n(14871),H=n(95477),N=n(82375),D=n(26136),Q=n(24666);function z(){window.__c={n:"AssistantLabelerBar"};const e=(0,b.O7)(),t=(0,u.yK)((e=>({wrap:{padding:8,backgroundColor:e.contentBackground,width:400},samplingPicker:{display:"flex",alignItems:"center",marginBottom:8,gap:4},error:{fontSize:14,color:e.accentColors.red[600],maxHeight:150,overflow:"scroll"},observation:{fontSize:14,maxHeight:150,overflow:"scroll"},tooltip:{width:500,whiteSpace:"pre-wrap",fontFamily:T.Z.baseFontFamily.mono},input:{marginTop:5,marginBottom:5,fontFamily:T.Z.baseFontFamily.githubMono,fontSize:12},inputInner:{height:100}})),[]),n=(0,c.VK)((()=>N.Hl.state),[]),i=(0,c.VK)((()=>m.Z.getActiveAssistantRuntimeState()),[]),a=(0,c.VK)((()=>m.Z.getActiveAssistantConfigurationState()),[]),o=(0,c.VK)((()=>Boolean(i&&i.sampledSteps.length>0)),[i]),r=(0,c.VK)((()=>Boolean(a&&(a.sampling||a.evaluating))),[a]),l=(0,c.VK)((()=>null==i?void 0:i.previewingStepIndex),[i]),p=(0,c.VK)((()=>{const e=null==i?void 0:i.previewingStepIndex;var t;if("number"==typeof e)return null==i||null===(t=i.sampledSteps)||void 0===t?void 0:t[e]}),[i],{useDeepEqual:!0}),g=(0,c.VK)((()=>(null==i?void 0:i.previewingStepObservations)||[]),[i],{useDeepEqual:!0}),h=g.filter((e=>"error"===e.observationType)),S=g.filter((e=>"error"!==e.observationType)),v=(0,d.useCallback)((()=>{const e=m.Z.getActiveSessionId();e&&s.cancelPreviewStep({sessionId:e})}),[]),x=(0,d.useCallback)((async t=>{const n=m.Z.getActiveSessionId(),i=m.Z.getActiveAssistantRuntimeStore();if(!p||!i||!n)return;const a={...p,value:t.target.value};(0,N.zZ)({store:i,step:a}),await s.simulateOrCommitStep({environment:e,step:a,commit:!1,isStreaming:!1,preventSelection:!0,sessionId:n})}),[e,p]),y=(0,d.useCallback)((async t=>{const n=m.Z.getActiveSessionId(),i=m.Z.getActiveAssistantRuntimeState();i&&n&&await s.simulateOrCommitStep({environment:e,step:i.sampledSteps[t],commit:!1,isStreaming:!1,sessionId:n})}),[e]),k=(0,d.useCallback)((async()=>{const t=m.Z.getActiveSessionId(),n=m.Z.getActiveAssistantRuntimeState();if(!n||!t)return;const i=n.previewingStepObservations.length>0;await s.commitPreviewAssistantStep({environment:e,sessionId:t}),i||await s.applyUncommittedOperations({environment:e,sessionId:t})}),[e]),w=(0,d.useCallback)((async()=>{const t=m.Z.getActiveSessionId();t&&await s.retryNextAssistantSteps({environment:e,sessionId:t})}),[e]),C=(0,c.VK)((()=>({top:20,left:0,right:0,bottom:0,width:e.WindowSizeStore.state.width,height:0})),[e],{useDeepEqual:!0}),[j,A]=(0,d.useState)(!1),M=(0,d.useCallback)((()=>{Q.default.hasSelection()&&R.ZH(e),A(!0)}),[e,A]),I=(0,d.useCallback)((()=>{A(!1)}),[A]),Z=H.default.isLocalhost||!1;return(0,f.jsx)(E.ZP,{popupType:E.kQ.Popup,open:!0,originRect:C,originGap:6,disableMouseCapture:!0,render:()=>(0,f.jsx)(_.Z,{capture:j,children:(0,f.jsxs)("div",{style:t.wrap,children:[(0,f.jsx)(q,{}),o&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{style:t.samplingPicker,children:[(0,f.jsx)(W.Z,{hovered:void 0===l||void 0,onClick:v,children:"Original"}),(0,f.jsx)(W.Z,{hovered:0===l||void 0,onClick:()=>y(0),children:"A"}),(0,f.jsx)(W.Z,{hovered:1===l||void 0,onClick:()=>y(1),children:"B"}),(0,f.jsx)("div",{style:{flexGrow:1}}),r&&(0,f.jsx)(L.Z,{style:{marginRight:4}}),(0,f.jsx)(W.Z,{disabled:!Z&&(void 0===l||r||!n),disabledFeedback:!0,onClick:w,children:"Retry"}),(0,f.jsx)(W.Z,{disabled:!Z&&(void 0===l||r||!n),disabledFeedback:!0,onClick:k,isBlue:!0,children:"Accept"})]}),p&&(0,f.jsx)(V.Z,{style:t.input,inputStyle:t.inputInner,value:p.value,onChange:x,onFocus:M,onBlur:I,textarea:!0,spellCheck:!1}),h.length>0&&!r&&(0,f.jsx)("div",{style:t.error,children:h.map((e=>e.value)).join("\n")}),S.length>0&&!r&&(0,f.jsxs)("div",{style:t.observation,children:["Results: ",S.map((e=>e.value)).join("\n")]})]})]})})})}function q(e){var t;window.__c={n:"TaskPicker"};const n=(0,b.O7)(),s=(0,c.VK)((()=>N.Hl.state),[]),[i]=(0,A.r5)((async()=>{const e="results",t={type:"reducer",filter:{operator:"and",filters:[{property:"ouFf",filter:{operator:"status_is",value:{type:"is_group",value:"In progress"}}}]},sort:[],userId:n.currentUser.id,userTimeZone:(0,j.r)(),searchQuery:void 0,reducers:{[e]:{type:"results",limit:100}}},s=await F.queryCollection(n,{source:{type:"collection",id:"f704a995-6417-457a-8038-ca9e1cb2c65f",spaceId:C.vj},collectionView:{id:"1dee420b-aa96-4e48-8eba-c2a0613e179e",spaceId:C.vj},loader:t},void 0,{src:"queryCollectionAction"});if("failed"===s.type)return;const i=s.data.result.reducerResults.results;if(!i||"results"!==i.type)return;const{blockIds:a}=i;let o=M.oA(a.map((e=>new D.G(n,{table:I.iU,id:e}).getValue()))).map((e=>{var t,n,s;return{id:e.id,name:(0,Z.QaF)(null==e||null===(t=e.properties)||void 0===t?void 0:t.title),url:(0,Z.QaF)(null==e||null===(n=e.properties)||void 0===n?void 0:n["}v_K"]),type:(0,Z.QaF)(null==e||null===(s=e.properties)||void 0===s?void 0:s.pdfW)}}));return o=M.MR(o,(e=>e.name.toLowerCase())),o}),[n]),a=(0,d.useCallback)((e=>{var t;const n=null===(t=i.value)||void 0===t?void 0:t.find((t=>t.id===e));n&&N.Hl.setState(n)}),[i]),o={menuTitle:"",items:(null===(t=i.value)||void 0===t?void 0:t.map((e=>e.id)))??[],getKey:e=>e,selectedItem:null==s?void 0:s.id,onSelect:a,renderItem:e=>{var t;const n=null===(t=i.value)||void 0===t?void 0:t.find((t=>t.id===e.value));return(0,f.jsx)(P.Z,{...e,title:null==n?void 0:n.name})},renderOrigin:e=>(0,f.jsx)(B.Z,{focused:!1,title:"",right:(null==s?void 0:s.name)||(0,f.jsx)("span",{style:{color:"red"},children:"Please select a task"}),...e}),width:300},r=(0,u.yK)((e=>({wrap:{marginBottom:8},inner:{display:"flex",alignItems:"center",marginBottom:4,gap:4},label:{fontSize:14,flexShrink:0},link:{fontSize:14,textDecoration:"underline"}})),[]);return(0,f.jsxs)("div",{style:r.wrap,children:[(0,f.jsxs)("div",{style:r.inner,children:[(0,f.jsx)("div",{style:r.label,children:"Current task:"}),(0,f.jsx)(O.Z,{...o})]}),s&&(0,f.jsx)(K.Z,{style:r.link,href:s.url,external:!0,children:"Instructions for task"})]})}var U=n(34876),$=n(33104),G=n(5257),Y=n(11751),J=n(97880),X=n(63143),ee=n(51454),te=n(44458),ne=n(16091),se=n(55031),ie=n(64921),ae=n(91839),oe=n(10388),re=n(28020),le=n(79897),de=n(24646),ce=n(21273),ue=n(4926),pe=n(55320),ge=(n(52262),n(30120)),me=n(82530),he=n(37181),Se=n(2551),fe=n(85844);const ve=[3,4],xe=4*X.C0;function ye(){const e=(0,b.O7)(),[t,n]=(0,d.useState)(),[s,i]=(0,d.useState)((()=>ge.ou.utc())),[a,o]=(0,d.useState)(!1),r=(0,c.VK)((()=>ce.Z.showRemindersToUseQnA()),[]);return(0,d.useEffect)((()=>{const e=setTimeout((()=>{o(!0),i(ge.ou.utc())}),xe);return()=>clearTimeout(e)}),[]),(0,Se.W)((()=>{i(ge.ou.utc())}),5*X.hM,a&&r),(0,c.VK)((()=>{if(!r)return;if(!a)return;if((0,J.$K)(t))return;if(!fe.Z.state.isVisible)return;const i=function(e){const{environment:t,now:n}=e,{currentUserSettingsStore:s}=g.default.state;if(!s)return;const i=function(e){const{currentUserSettings:t,now:n}=e;if(!(0,J.$K)(t.last_exposed_to_ai_qna_at))return;const s=t.qna_reminders_shown_at??[],i=s.length,a=ve.at(i);if(!(0,J.$K)(a))return;const o=0===i?t.last_exposed_to_ai_qna_at:s[i-1];if(n.diff(ge.ou.fromMillis(o),"days").days<a)return;if(i>0){const e=s[i-1];if(t.last_exposed_to_ai_qna_at>=e)return}return{reminder:{number:i+1},update:{qna_reminders_shown_at:[...s,n.toMillis()]}}}({currentUserSettings:{last_exposed_to_ai_qna_at:s.getSettingsStore().getKeyStore("last_exposed_to_ai_qna_at").getValue(),qna_reminders_shown_at:s.getSettingsStore().getKeyStore("qna_reminders_shown_at").getValue()},now:n});if(!(0,J.$K)(i))return;return me.createAndCommit({environment:t,userAction:"useApplicableQnaReminder.setNumQnaRemindersShown",perform:e=>{he.d2({userSettingsStore:s,transaction:e,data:i.update})}}),i.reminder}({environment:e,now:s});(0,J.$K)(i)&&n(i)}),[r,a,t,e,s]),t}const ke=(0,p.defineMessages)({reminderToUseQnA:{id:"AssistantOriginElement.reminderToUseQnA",defaultMessage:"Find pages, get instant answers with Q&A"}}),we=2*X.hM;function be(){window.__c={n:"AssistantOriginElement"};const e=(0,b.O7)(),t=(0,u.Fg)();!function(){const e=(0,b.O7)(),t=(0,c.VK)((()=>g.default.state.mainEditorCurrentBlockStore),[]),n=(0,c.VK)((()=>{var e;return null===(e=g.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),s=(0,c.VK)((()=>{var e;return Boolean(null===(e=m.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.isCurrentlyCommittingHumanStep)}),[]),i=(0,c.VK)((()=>l.N.state.currentState),[]);(0,d.useEffect)((()=>{let e;return"answerWaitingForUserClick"===i&&(e=setTimeout((()=>{"answerWaitingForUserClick"===l.N.state.currentState&&l.N.setState({...l.N.state,currentState:"default"})}),we)),()=>clearTimeout(e)}),[i]);const{lastStepLoadingCompletionUnixEpochMs:a,aiWindowLastSeenUnixEpochMs:o}=(0,c.VK)((()=>l.N.state),[]),r=ye(),[u,p]=(0,d.useState)(!1);(0,d.useEffect)((()=>{(async()=>{const i=l.N.state.currentState,d=a===-1/0||o>a;if((0,J.$K)(r)&&!u){let s;ce.Z.modeIsAtMost("development")&&t&&n&&(s=await(0,te.qC)({environment:e,blockStore:t,spaceId:n})),l.N.setState({...l.N.state,currentState:"qnaReminder",reminderNumber:r.number,suggestedQuestion:s}),p(!0)}else s||d||"answerLoading"!==i||a===-1/0?s||"qnaReminder"===i||"answerLoading"!==i&&!d?!s||"default"!==i&&"qnaReminder"!==i||l.N.setState({...l.N.state,currentState:"answerLoading"}):l.N.setState({...l.N.state,currentState:"default"}):l.N.setState({...l.N.state,currentState:"answerWaitingForUserClick"})})()}),[e,t,n,o,s,a,r,u])}();const n=(0,u.yK)((e=>({faceImg:{width:16,pointerEvents:"none"}})),[]),i=(0,d.useRef)(null),o=(0,c.VK)((()=>{const{currentUserSettingsStore:t,currentSpaceStore:n,mainEditorCurrentBlockStore:s}=g.default.state;return!re.tu.state&&(!!(n&&s&&s.canRead())&&ce.Z.isQnATooltipsVisible(e.device,t))}),[e.device]),p=(0,c.VK)((()=>{var e,t;if(ce.Z.isXMLAssistantEnabled(void 0))return{currentState:"default"};const n=l.N.state;return null!==(e=r.d.state)&&void 0!==e&&e.open||null!==(t=pe.default.state)&&void 0!==t&&t.open?{currentState:"default"}:n}),[]),h=(0,d.useCallback)((async()=>{const{currentUserSettingsStore:t}=g.default.state;t&&(0,te.CX)(e,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipClose",userSettingsStore:t}),l.N.setState({...l.N.state,currentState:"default"}),"qnaReminder"===p.currentState&&p.suggestedQuestion&&(await(0,s.resetAndInitializeAssistantSession)({environment:e}),await(0,x.AF)({newValue:[[p.suggestedQuestion]],environment:e,isSlackMode:!1,slackModeState:void 0,currentSkill:void 0,source:"suggested_question"})),a.openAssistantRightHandSideMenu({environment:e,from:"button"})}),[e,p]),S=(0,c.VK)((()=>(0,se.y)(e,{theme:t,rightEdgeDistance:16,isInPeekRenderer:!1,width:36})),[e,t]),v=(0,d.useMemo)((()=>(0,Y.t)({...n.faceImg})),[n.faceImg]);if((0,le.A3)())return null;switch(p.currentState){case"answerLoading":return(0,f.jsx)(Ae,{onClick:h,isAnswerReady:!1});case"answerWaitingForUserClick":return(0,f.jsx)(Ae,{onClick:h,isAnswerReady:!0});case"qnaReminder":return(0,f.jsx)(je,{onClick:h,reminderNumber:p.reminderNumber,suggestedQuestion:p.suggestedQuestion});case"default":return(0,f.jsxs)(f.Fragment,{children:[o&&(0,f.jsx)(ne.ND,{origin:i}),(0,f.jsx)(ie.Z,{ariaLabel:"ai",className:"notion-ai-button",style:{...S,...o?{border:"3px solid #b6cce7"}:{}},hoveredStyle:{background:t.whiteButtonHoveredBackground},pressedStyle:{background:t.whiteButtonPressedBackground},onClick:h,ref:i,children:v})]});default:(0,J.t1)(p)}}function Ce(e){const{rightEdgeDistance:t,theme:n,environment:s,isInPeekRenderer:i,width:a,height:o,background:r,alwaysVisible:l}=e,d=(0,de.ll)(s,i)-(0,de.vJ)(s);return{position:"absolute",bottom:(0,se.G)(s,16+ue.Z.state),right:t+ue.Z.state,width:a,height:o,borderRadius:100,fontSize:20,boxShadow:n.lightBoxShadow,zIndex:ee.hT,background:r,backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",backgroundBlendMode:"overlay, normal",opacity:re.tu.state&&!l?0:1,transform:`translateX(-${d}px) translateZ(0)`,transition:`\n\t\t\topacity ${oe.nk}ms,\n\t\t\tcolor ${oe.nk}ms,\n\t\t\ttransform 200ms\n\t\t`}}function je(e){window.__c={n:"QnaReminderElement"};const{onClick:t,reminderNumber:n,suggestedQuestion:s}=e,a=(0,u.Fg)(),o=(0,b.O7)(),r=(0,c.VK)((()=>Ce({rightEdgeDistance:16,isInPeekRenderer:!1,width:void 0,height:36,environment:o,theme:a,background:a.whiteButtonBackground,alwaysVisible:!0})),[o,a]),[l,g]=(0,d.useState)(!1),[m,h]=(0,d.useState)(!1),S=(0,u.yK)((e=>({buttonStyle:{...r,cursor:"pointer",overflow:"hidden",display:"flex",userSelect:"none",...l?{background:e.whiteButtonHoveredBackground}:{},...m?{background:e.whiteButtonPressedBackground}:{}},sparklesIcon:{width:16,marginRight:10},inner:{display:"flex",alignItems:"center",flexWrap:"nowrap",padding:"0 10px"},chevronIcon:{height:19,width:15,opacity:.5,marginLeft:8},message:{fontSize:T.Z.fontSize.UIRegular.desktop,textWrap:"nowrap"}})),[r,l,m]);(0,d.useEffect)((()=>{i.trackQnaReminderShown(o,{number:n})}),[o,n]);const v=(0,d.useCallback)((()=>{g(!1),h(!1)}),[]),x=(0,d.useCallback)((()=>{v(),window.removeEventListener("mouseup",x)}),[v]),y=(0,d.useCallback)((()=>{g(!0)}),[]),k=(0,d.useCallback)((()=>{g(m),h(!1)}),[m]),w=(0,d.useCallback)((()=>{h(!0),window.addEventListener("mouseup",x)}),[x]),C=(0,d.useCallback)((()=>{h(!1)}),[]);return(0,f.jsx)(U.E.div,{style:S.buttonStyle,variants:{initial:{width:36},animate:{width:"auto",transition:{ease:[.87,0,.13,1],type:"spring",stiffness:90,damping:16,mass:1}}},initial:"initial",animate:"animate",onMouseMove:y,onMouseLeave:k,onMouseDown:w,onMouseUp:C,onClick:t,children:(0,f.jsxs)("div",{style:S.inner,children:[(0,Y.t)(S.sparklesIcon),(0,f.jsx)(U.E.div,{style:S.message,variants:{initial:{opacity:0},animate:{opacity:1,transition:{ease:[.16,1,.3,1],duration:.75}}},initial:"initial",animate:"animate",children:s?(0,f.jsx)(p.FormattedMessage,{defaultMessage:"Ask “{suggestedQuestion}”",values:{suggestedQuestion:s},id:"AssistantOriginElement.reminderToUseQnAWithSuggestedQuestion"}):(0,f.jsx)(p.FormattedMessage,{...ke.reminderToUseQnA})}),(0,G.o)(S.chevronIcon)]})})}function Ae(e){let{onClick:t,isAnswerReady:n}=e;window.__c={n:"QnaBackgroundProcessingElement"};const s=(0,u.yK)((e=>({sparklesIcon:{height:18,width:18,fill:e.regularIconColor},aiProcessingButtonTopLevelStyle:{display:"flex",alignItems:"center",flexDirection:"row",marginLeft:12.5,marginRight:14,height:52},sparklesIconWrapperStyle:{borderRadius:"100%",background:e.whiteButtonBackground,height:30,width:30,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${e.outlineButtonBorder}`,fill:e.regularIconColor},messagesWrapperStyle:{display:"flex",flexDirection:"column",justifyContent:"center",marginLeft:8},notionAiTitleStyle:{fontSize:12,fontWeight:"500",color:e.lightTextColor},answerReadyStyle:{fontSize:13,fontWeight:"500",color:e.aiPurpleColor,display:"flex",alignItems:"center"},preparingYourAnswerStyle:{fontSize:14,fontWeight:"500",color:e.aiPurpleColor},chevronRightStyle:{height:19,width:15,opacity:.2,marginLeft:"auto"}})),[]),i=(0,u.Fg)(),a=(0,b.O7)(),o=(0,c.VK)((()=>Ce({rightEdgeDistance:16,isInPeekRenderer:!1,width:278,height:52,environment:a,theme:i,background:i.aiPurpleTranslucentRadialGradientBackground})),[a,i]),[r,l]=(0,$.H)(),[g,m]=(0,$.H)(),h=(0,d.useCallback)((async()=>{await l(r.current,{width:278}),await m(g.current,{display:"block",opacity:1})}),[l,m,r,g]);(0,d.useEffect)((()=>{h()}),[h]);return(0,f.jsx)(U.E.div,{"aria-label":"ai processing",className:"notion-ai-button",onClick:t,style:{...o,cursor:"pointer",overflow:"hidden",flexWrap:"wrap"},variants:{initial:{width:28},animate:{width:278,transition:{type:"spring",stiffness:20,damping:15}}},initial:"initial",animate:"animate",ref:r,children:(0,f.jsxs)("div",{style:s.aiProcessingButtonTopLevelStyle,children:[(0,f.jsx)("div",{style:s.sparklesIconWrapperStyle,children:(0,Y.t)(s.sparklesIcon)}),(0,f.jsx)("div",{style:{...s.messagesWrapperStyle,display:"none"},ref:g,children:n?(0,f.jsx)("div",{style:s.answerReadyStyle,children:(0,f.jsx)(p.FormattedMessage,{id:"AssistantOriginElement.answerReady",defaultMessage:"Your answer is ready"})}):(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,f.jsx)("div",{style:s.preparingYourAnswerStyle,children:(0,f.jsx)(p.FormattedMessage,{id:"AssistantOriginElement.notionAiLoadingText",defaultMessage:"Preparing your answer"})}),(0,f.jsx)("div",{style:{marginLeft:6,fontWeight:"500"},children:(0,f.jsx)(ae.Z,{})})]})}),(0,G.o)(s.chevronRightStyle)]})})}var Me=n(61679),Ie=n(17456),Ze=n(85075);function Te(e){window.__c={n:"AssistantFullPageChat"};const{route:t}=e,n=Boolean(t.peekViewBlockId),s=(0,b.O7)(),i=(0,c.VK)((()=>(0,de.vJ)(s)+(0,de.Wk)(s)),[s]),a=(0,u.yK)((()=>({wrap:{...n?{width:`calc(100% - ${i}px)`}:{}},chatHistoryAligner:{display:"flex",alignItems:"flex-end",flexDirection:"column"},chatHistoryWrap:{height:"calc(100vh - 16px)",display:"flex",flexDirection:"column",width:"min(100%, 360px)",marginTop:16,justifyContent:"flex-end"},layoutContent:{height:"100vh"}})),[n,i]);return(0,f.jsx)("div",{style:a.wrap,children:(0,f.jsxs)(Me.Ar,{type:"chat",children:[!n&&(0,f.jsx)(Me.mZ,{children:(0,f.jsx)("div",{style:a.chatHistoryAligner,children:(0,f.jsx)("div",{style:a.chatHistoryWrap,children:(0,f.jsx)(Ie.p,{renderAsFullPage:!0,hideNewChatCreation:!0})})})}),(0,f.jsx)(Me.bU,{style:a.layoutContent,children:(0,f.jsx)(Ze.Q,{renderAsFullPage:!0})})]})})}var Fe=n(31945),Re=n(4023);function Pe(){window.__c={n:"AssistantMenuPopup"};const e=(0,c.VK)((()=>r.d.state.open),[]),[t,n]=(0,d.useState)(),s=(0,b.O7)(),{isMobile:i,isPhone:o}=(0,b.Fy)(),l=(0,c.VK)((()=>{const e=(0,de.ll)(s,!1)-(0,de.vJ)(s);return{bottom:15+ue.Z.state,right:15+ue.Z.state,xPosition:e}}),[s]);(0,d.useEffect)((()=>{const e=()=>{n(new DOMRect(window.innerWidth-l.right-l.xPosition,window.innerHeight-l.bottom,0,0))};return e(),addEventListener("resize",e),()=>removeEventListener("resize",e)}),[l.right,l.xPosition,l.bottom]);const p=(0,u.yK)((e=>({wrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow}})),[]),g=()=>{a.closeAssistantRightHandSideMenu()};return(0,f.jsx)(E.ZP,{popupType:i?Fe.Z4.SlideUp:Fe.Z4.Popup,forceFullScreenSlideUp:i&&o,alignmentToOrigin:Re.v.End,alignBoxStyle:{transition:"left 200ms, top 200ms"},originRect:t,disableMouseCapture:!0,preventScaleTransition:!1,preventSlideUpTransition:i,keepFocus:i,popupWrapStyle:p.wrap,isWaxPaper:!0,open:e,slideUpWrapStyle:{...i&&o?{height:"var(--full-viewport-height)"}:{}},render:()=>(0,f.jsx)(Ze.Q,{showBackButton:i,renderAsFullPage:i,onClose:g}),onDismiss:g})}var Be=n(80721),_e=n(13148),Ve=n(76994),Ke=n(78990),Le=n(23063),We=n(73063),Ee=n(36488),Oe=n(56940),He=n(78140),Ne=n(72495),De=n(26388),Qe=n(33991),ze=n(61817),qe=n(43250),Ue=n(34700),$e=n(87279),Ge=n(85665),Ye=n(29026),Je=n(49053);function Xe(e){window.__c={n:"SearchAssistantPane"};const t=(0,b.Fy)();return(0,Ge.Z)(),(0,f.jsx)(Oe.Z,{capture:!0,ignoreBlockSelection:!0,focusOffscreenInput:!1,restoreSelection:!t.isMobile,render:()=>(0,f.jsx)(Ee.Z,{capture:!0,allowMenuList:!0,render:t=>(0,f.jsx)(et,{...e,ignoreAreaEvents:t})})})}function et(e){window.__c={n:"SearchAssistantPaneInner"};const{ignoreAreaEvents:t,renderAsPage:n,quickSearchMode:a,searchContentPaneType:o,onClose:r}=e,{modalBodyMenuRef:l}=(0,d.useContext)(Qe.SearchStaticContext),g=(0,b.O7)(),h=(0,c.VK)((()=>null===m.Z||void 0===m.Z?void 0:m.Z.getActiveAssistantConfigurationState()),[]),S=(0,d.useCallback)((()=>{null!=h&&h.sessionId&&i.trackQnaBackToSearch(g,{sessionId:h.sessionId}),Ye.ZP.update((e=>({...e,mode:"search"})))}),[null==h?void 0:h.sessionId,g]),v=(0,d.useCallback)((()=>{r()}),[r]),y=(0,c.VK)((()=>(0,ze.ip)({searchContentPaneType:o,renderAsPage:n,environment:g})),[n,o,g]),k=(0,u.yK)((e=>({header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingLeft:12,paddingRight:16,paddingBottom:8},body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},scroller:{display:"flex",flexDirection:"column",maxHeight:y.maxHeight,minHeight:y.minHeight},clearButton:{...(0,Ue.X)({noDrag:Boolean(a)})},headerButton:{color:e.mediumIconColor,...(0,Ue.X)({noDrag:Boolean(a)})},closeButton:{borderRadius:"100%",marginLeft:6,...(0,Ue.X)({noDrag:Boolean(a)})},backButton:{marginRight:6,...(0,Ue.X)({noDrag:Boolean(a)})}})),[y,a]),w=(0,b.Fy)(),C=(0,d.useMemo)((()=>{if(w.isMobile){return{menuType:$e.og.Modal,width:n?"100vw":void 0,disableHeaderShadow:!0,disableBottomPadding:!0,bodyScrollerClassName:qe.GZn,hideMobileTopbar:!0,renderAsPage:!0,scrollerStyle:{display:"flex",flexDirection:"column",paddingBottom:0},...t}}const e={menuType:$e.og.Popup,maxHeight:y.maxHeight,minHeight:y.minHeight,...a?{width:"100vw"}:{},disableScroller:!0,scrollerStyle:k.scroller,...t};return n&&w.isDesktop&&(e.maxWidth="100%"),e}),[w,k,t,y,n,a]),j=(0,d.useCallback)((()=>{i.trackQnaClear(g,h,null===m.Z||void 0===m.Z?void 0:m.Z.getActiveAssistantRuntimeState()),(0,s.clearActiveAssistantSession)({environment:g})}),[h,g]),A=(0,c.VK)((()=>{const e=m.Z.getActiveAssistantRuntimeState();return!e||!m.Z.getActiveAssistantConfigurationState()||0===e.clientSteps.length&&0===e.temporaryClientSteps.length}),[]);return(0,f.jsxs)(He.Z,{...C,className:qe.Oau,ref:l,children:[(0,f.jsx)(Ne.Z,{children:(0,f.jsxs)("div",{style:k.header,children:[(0,f.jsx)(We.Z,{icon:Be.W,onClick:S,ariaLabel:"back",style:k.backButton}),(0,f.jsx)(Ke.Z,{}),(0,f.jsx)("div",{style:{flexGrow:1}}),(0,f.jsx)(Fe.ZP,{popupType:g.device.isMobile?Fe.Z4.SlideUp:Fe.Z4.Popup,renderOrigin:e=>(0,f.jsx)(De.ZP,{renderTooltip:()=>(0,f.jsx)(p.FormattedMessage,{id:"SearchAssistantPane.viewHistoryButton",defaultMessage:"History"}),render:t=>(0,f.jsx)(We.Z,{style:k.closeButton,hovered:!0,icon:Ve.w,ariaLabel:"history",...t,...e})}),render:e=>(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:375,transition:"height 200ms ease",minHeight:128},children:[(0,f.jsx)("div",{style:{fontSize:14,fontWeight:T.Z.fontWeight.medium,display:"flex",alignItems:"center",paddingLeft:16,paddingTop:12,marginBottom:8},children:(0,f.jsx)(p.FormattedMessage,{id:"SearchAssistantPane.askNotionAI.header",defaultMessage:"All chats"})}),(0,f.jsx)("div",{style:{marginTop:"auto"}}),(0,f.jsx)(Ie.p,{renderAsFullPage:!1,hideNewChatCreation:!0,onRestoreChatSession:()=>e.close()})]})}),(0,f.jsx)(Le.Z,{enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},animationStyle:{opacity:1},render:()=>(0,f.jsx)(Je.v,{style:k.clearButton,onClick:j,disabled:A}),isVisible:!A}),(0,f.jsx)(We.Z,{style:k.closeButton,hovered:!0,icon:_e.U,onClick:v,ariaLabel:"close"})]})}),(0,f.jsx)(x.R3,{renderAsFullPage:n,isQuickSearchMode:a,onBackspaceOnEmptyInput:S})]})}},2405:(e,t,n)=>{n.d(t,{Z:()=>o});n(67294);var s=n(24405),i=n(64921),a=n(85893);function o(e){window.__c={n:"AssistantActionButton"};const{style:t,icon:n,disabled:o,iconStyle:r,title:l,onClick:d,focused:c,lightGrey:u}=e,p=(g={lightGrey:u},(0,s.yK)((e=>({AssistantActionButton:{display:"flex",alignItems:"center",boxShadow:e.inputBoxShadow,padding:"6px 10px 6px 12px",color:g.lightGrey?e.lightTextColor:e.regularTextColor,fontSize:13,fontWeight:500,borderRadius:24,width:"max-content"},icon:{width:14,height:14,fill:g.lightGrey?e.lightIconColor:e.regularIconColor,marginRight:6}})),[g.lightGrey]));var g;return(0,a.jsxs)(i.Z,{disabled:o,style:{...p.AssistantActionButton,...t},onClick:d,focused:c,...e.tooltipEvents??{},children:[null==n?void 0:n({...p.icon,...r}),l]})}},23388:(e,t,n)=>{n.d(t,{R3:()=>Qe,AF:()=>De,AP:()=>Oe,f6:()=>tt});n(52262),n(24506);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(49085),l=n(27328),d=n(41892),c=n(92595),u=n(7057),p=n(53877),g=n(42875),m=n(64275),h=n(84169),S=n(72126),f=n(70203),v=n(97880),x=n(82990),y=n(9291),k=n(25888),w=n(47307),b=n(24677),C=n(80402),j=n(993),A=n(98104),M=n(82530),I=n(63594),Z=n(73063),T=n(53336),F=n(72495),R=n(26388),P=n(42402),B=n(37712),_=(n(95477),n(75179)),V=n(57254),K=n(19124),L=n(17809),W=n(4023),E=n(34859),O=n(80444),H=n(21273),N=n(98180),D=n(82375),Q=n(69454),z=n(45589),q=n(55320),U=n(58016),$=n(65147),G=n(33932),Y=n(70771),J=n(91437),X=n(27967),ee=n(67973),te=n(2405),ne=n(49631),se=n(42899),ie=n(26263),ae=n(1302),oe=n(83176),re=n(88437),le=n(76927),de=n(47453),ce=n(18101),ue=n(98519),pe=n(55863),ge=n(4615),me=n(893),he=n(56518),Se=n(28344);n(21703);var fe=n(64964);var ve=n(85893);function xe(e){window.__c={n:"AssistantFeedbackBar"};const{type:t,renderAsFullPage:n}=e,r=(0,i.O7)(),l=(0,o.yK)((e=>({wrap:{display:"flex",marginTop:8,marginBottom:0,gap:6}})),[]),[d,c]=(0,s.useState)((()=>(0,ge.ZP)())),u=(0,a.VK)((()=>I.Z.state),[]),p=(0,a.VK)((()=>H.Z.isXMLAssistantEnabled(void 0)),[]),g=(0,s.useCallback)((async()=>{const e=N.Z.getActiveSessionId();e&&(U.saveFeedback({environment:r,inferenceId:d,type:"assistant_accept_edits",sessionId:e}),await U.commitPreviewAssistantStep({environment:r,sessionId:e}),await U.applyUncommittedOperations({environment:r,sessionId:e}))}),[r,d]),m=(0,s.useCallback)((async()=>{const e=N.Z.getActiveSessionId();e&&(U.saveFeedback({environment:r,inferenceId:d,type:"assistant_fix_errors",sessionId:e}),await U.commitPreviewAssistantStep({environment:r,sessionId:e}))}),[r,d]),h=(0,s.useCallback)((async()=>{const e=N.Z.getActiveSessionId();e&&(U.saveFeedback({environment:r,inferenceId:d,type:"assistant_undo",sessionId:e}),await U.commitPreviewAssistantStep({environment:r,sessionId:e}),U.resetUncommittedOperations({environment:r,sessionId:e}))}),[r,d]),S=(0,s.useCallback)((async()=>{const e=N.Z.getActiveSessionId();e&&(U.saveFeedback({environment:r,inferenceId:d,type:"assistant_retry",sessionId:e}),await U.retryNextAssistantSteps({environment:r,sessionId:e}))}),[r,d]),x=(0,s.useCallback)((()=>{const e=N.Z.getActiveAssistantRuntimeState(),t=N.Z.getActiveAssistantConfigurationState(),n=null==e?void 0:e.temporaryClientSteps.find((e=>"assistantChat"===e.type||"assistantChatText"===e.type));if(n){if("assistantChatText"===n.type)me.RD({environment:r,stringValue:n.text??"",copiedMessage:me.tq.copiedQnAMessageToClipboard});else if("assistantChat"===n.type){const e=(0,$.me)({environment:r,clientStep:n,citationOrdering:void 0,inMemoryRecordCache:new ie.Z({name:"assistantChat.clipboard"})}),t=(0,he.X4)({rootBlock:{...e[0].pointer,spaceId:e[0].getSpaceId()},blockValues:e.map((e=>e.getValue())).filter(v.$K),getRecordValue:e[0].getRecordValue,isWindows:r.device.isWindows,markdownLinkifyIt:void 0});me.RD({environment:r,stringValue:t.markdown??"",copiedMessage:me.tq.copiedQnAMessageToClipboard})}else(0,v.t1)(n);t&&Se.trackQnACopyClick(r,{sessionId:t.sessionId})}}),[r]),k=(0,s.useCallback)((async()=>{const e=N.Z.getActiveSessionId();e&&(M.createAndCommit({userAction:"assistant.createPage",environment:r,perform:t=>{U.createPageFromAssistantChat({environment:r,sessionId:e,transaction:t})}}),await U.commitPreviewAssistantStep({environment:r,sessionId:e}),await ae.default.afterNextFlush(),await ae.default.afterNextFlush(),await U.updateContextForCurrentPageIfNecessary({environment:r,sessionId:e,autoLoadPage:!0}))}),[r]),w=(0,s.useCallback)((async()=>{const e=N.Z.getActiveSessionId();e&&(M.createAndCommit({userAction:"assistant.insertIntoPage",environment:r,perform:t=>{U.insertAssistanChatIntoCurrentPage({environment:r,sessionId:e,transaction:t})}}),await U.commitPreviewAssistantStep({environment:r,sessionId:e}))}),[r]),b=(0,s.useCallback)((async()=>{if(!N.Z.getActiveSessionId())return;const e=N.Z.getActiveAssistantRuntimeState(),t=null==e?void 0:e.temporaryClientSteps.find((e=>"assistantCreateWorkflow"===e.type));t&&await async function(e){const{environment:t,workflowSettings:n}=e;fe.oV({label:"Running workflow",durationMs:"keep"});const{sessionId:s}=await(0,U.resetAndInitializeAssistantSession)({environment:t,makeActiveSession:!1});try{const{assistantRuntimeStore:e}=N.Z.getSessionContextOrThrow(s);for(const d of n.steps||[]){const n=e.state;if(!n)throw new Error("No runtime state");const a=n.evaluator;if("assistant-code"===d.type){const e=(i=d.value).slice(i.indexOf("{")+1,i.lastIndexOf("}"));await(0,U.simulateOrCommitStep)({environment:t,step:a.createAssistantStep(e),commit:!0,isStreaming:!1,sessionId:s})}else if("assistant-prompt"===d.type)await(0,U.commitHumanStep)({environment:t,text:(0,f.TPx)(d.value),sessionId:s}),await(0,U.commitPreviewAssistantStep)({environment:t,sessionId:s});else{if("human"===d.type)throw new Error("Human steps not yet implemented");(0,v.t1)(d)}const o=a.getTranscript(),r=o[o.length-1];if("observation"===r.type&&"error"===r.observationType)break}const a=e.state;if(!a)throw new Error("No runtime state");const o=a.evaluator.getTranscript(),r=o[o.length-1],l="observation"===r.type&&"error"===r.observationType?r.value:void 0;l?fe.oV({label:`Error: ${l}`}):(await(0,U.applyUncommittedOperations)({environment:t,sessionId:s}),fe.oV({label:"Workflow complete"}))}catch(a){fe.oV({label:`Error: ${a}`})}finally{(0,U.clearActiveAssistantSession)({environment:t,sessionId:s})}var i}({environment:r,workflowSettings:t.workflowSettings})}),[r]);return(0,ve.jsxs)("div",{style:l.wrap,children:["accept_edits"===t&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(te.Z,{icon:ue.k,onClick:g,title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Accept all",id:"assistant.acceptAllButton"})}),(0,ve.jsx)(te.Z,{icon:pe.s,onClick:h,title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Undo all",id:"assistant.undoAllButton"})})]}),"error"===t&&(0,ve.jsx)(te.Z,{icon:oe.z,onClick:m,title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Fix errors",id:"assistant.fixErrorsButton"})}),"chat"===t&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(te.Z,{icon:re.a,onClick:x,title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Copy",id:"assistant.copyButton"})}),p&&(n?(0,ve.jsx)(te.Z,{icon:de.R,onClick:k,title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Create page",id:"assistant.createPageButton"})}):(0,ve.jsx)(te.Z,{icon:de.R,onClick:w,title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Insert",id:"assistant.insertButton"})}))]}),"create_workflow"===t&&(0,ve.jsx)(ve.Fragment,{children:(0,ve.jsx)(te.Z,{icon:le.p,onClick:b,title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Test workflow",id:"assistant.testWorkflowButton"})})}),u?(0,ve.jsx)(te.Z,{icon:ce.b,onClick:S,title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Try again",id:"assistant.retryButton"})}):null]})}var ye=n(72263),ke=n(42922),we=n(99622),be=n(12205),Ce=n(80671),je=n(44041),Ae=n(35057),Me=n(88280);function Ie(e){window.__c={n:"AssistantBlueLink"};const t=(0,o.yK)((e=>({assistantBlueLink:{color:e.text.uiBluePrimary,cursor:"pointer",fontWeight:600}})),[]);return(0,ve.jsx)("span",{style:t.assistantBlueLink,onClick:e.onClick,children:e.children})}const Ze=(0,y.defineMessages)({requestAccessButton:{id:"AssistantLimitReached.requestAccess.button",defaultMessage:"Request access"},requestAccessMessage:{id:"AssistantLimitReached.requestAccess.message",defaultMessage:"You’ve run out of free AI responses. Request the <bold>Notion AI add-on</bold> from your workspace owner."},requestAccessReceived:{id:"AssistantLimitReached.requestAccess.received",defaultMessage:"Thank you! We received your request."},unavailableMessage:{id:"AssistantLimitReached.unavailable.message",defaultMessage:"You’ve run out of free AI responses. Reach out to your account representative to purchase the Notion AI add-on."},upsellButton:{id:"AssistantLimitReached.upsell.button",defaultMessage:"Get unlimited AI"},upsellMessage:{id:"AssistantLimitReached.upsell.message",defaultMessage:"You’ve run out of free AI responses. Get the <bold>Notion AI add-on</bold> so that I can answer an unlimited number of questions for you!"}});function Te(e){window.__c={n:"AssistantLimitReached"};const t=(0,be.J)(),n=(0,we.Y)(Me.subscriptionDataStoreInstance);return n&&t?(0,ve.jsx)(Pe,{...e}):n&&!t?(0,ve.jsx)(Fe,{...e}):!n&&t?(0,ve.jsx)(Re,{...e}):n||t?null:(0,ve.jsx)(Fe,{...e})}function Fe(e){window.__c={n:"RequestAccess"};const t=(0,i.O7)(),[n,o]=(0,s.useState)(!1),r=(0,y.useIntl)(),l=Be(),d=(0,a.VK)((()=>O.default.state.currentSpaceStore),[]),c=(0,s.useCallback)((()=>{d&&((0,Ce.jw)({environment:t,spaceStore:d,from:"ai_qna_limit_in_app"}),o(!0))}),[t,d]);if(n)return(0,ve.jsx)("div",{style:l.wrapper,children:(0,ve.jsx)(ne.H,{...e,clientStep:{type:"assistantLimitReached",message:r.formatMessage(Ze.requestAccessReceived)}})});const u=r.formatMessage(Ze.requestAccessMessage,{bold:e=>(0,ve.jsx)(Ie,{onClick:c,children:e})});return(0,ve.jsxs)("div",{style:l.wrapper,children:[(0,ve.jsx)(ne.H,{...e,clientStep:{type:"assistantLimitReached",message:u}}),(0,ve.jsxs)(ke.Z,{style:l.button,onClick:c,children:[(0,ye._)(l.icon),r.formatMessage(Ze.requestAccessButton)]})]})}function Re(e){window.__c={n:"Upsell"};const t=(0,i.O7)(),n=Be(),a=(0,y.useIntl)(),o=(0,s.useCallback)((()=>{je.y(t,{from:"ai_qna_limit_in_app",for:(0,Ae.zt)(),addOnFeature:"ai"})}),[t]),r=a.formatMessage(Ze.upsellMessage,{bold:e=>(0,ve.jsx)(Ie,{onClick:o,children:e})});return(0,ve.jsxs)("div",{style:n.wrapper,children:[(0,ve.jsx)(ne.H,{...e,clientStep:{type:"assistantLimitReached",message:r}}),(0,ve.jsxs)(ke.Z,{style:n.button,onClick:o,children:[(0,ye._)(n.icon),a.formatMessage(Ze.upsellButton)]})]})}function Pe(e){window.__c={n:"Unavailable"};const t=Be(),n=(0,y.useIntl)();return(0,ve.jsx)("div",{style:t.wrapper,children:(0,ve.jsx)(ne.H,{...e,clientStep:{type:"assistantLimitReached",message:n.formatMessage(Ze.unavailableMessage)}})})}function Be(){return(0,o.yK)((()=>({button:{alignSelf:"flex-start",borderRadius:100,display:"flex",gap:6,marginTop:6,marginBottom:6,padding:"7px 12px"},icon:{width:16,height:16},wrapper:{marginTop:4,display:"flex",flexDirection:"column"}})),[])}var _e=n(85075),Ve=n(67593),Ke=n(16540),Le=n(5175),We=n(14309);const Ee=(0,y.defineMessages)({qnaInputPlaceholder:{id:"assistantChat.qnaInputPlaceholder.text",defaultMessage:"Ask a question…"},assistantInputPlaceholder:{id:"assistantChat.assistantInputPlaceholder.text",defaultMessage:"Ask for anything, @mention pages or people…"},qnaAssistantChatText:{id:"assistantChat.qnaWelcomeMessage.text",defaultMessage:"Hi {firstName}! Ask me about anything in {workspaceName}. I’ll find an answer in the pages you have access to."},assistantBetaDisclaimerText:{id:"assistantChat.qnaWelcomeMessage.disclaimerText",defaultMessage:"I’m still in Beta, so please use the 👍 👎 buttons to help me improve."}});function Oe(e){const{renderAsFullPage:t,isQuickSearchMode:n}=e,o=(0,a.VK)((()=>N.Z.getActiveAssistantRuntimeState()),[]),r=(0,a.VK)((()=>N.Z.getActiveAssistantConfigurationState()),[]),l=null==o?void 0:o.selectedSkill,d=(0,a.VK)((()=>H.Z.isAssistantExperienceQna()),[]),u=ze({renderAsFullPage:t}),p=qe(),g=(0,a.VK)((()=>H.Z.isXMLAssistantEnabled(l)),[l]),m=(0,a.VK)((()=>{var e;return Boolean(null===(e=N.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.clientSteps.find((e=>"human"===e.type)))}),[]),h=tt({assistantRuntimeState:o,assistantConfigurationState:r}),S=(0,a.VK)((()=>(0,K.Gw)()),[]),f=!o||o&&!o.selectedSkill&&0===o.clientSteps.length,x=(0,a.VK)((()=>f&&!t&&p.length>0&&H.Z.isSuggestedQuestionsExperimentOn()),[f,t,p]),y=Boolean((null==r?void 0:r.sampling)||(null==r?void 0:r.evaluating)),k=(0,a.VK)((()=>{var e;const t=null===(e=N.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.previewingStepObservations.filter((e=>"observation"===e.type&&"error"===e.observationType));return null==t?void 0:t.map((e=>e.value)).join("\n")}),[]),w=(0,a.VK)((()=>I.Z.state),[]),b=(0,a.VK)((()=>q.default.state.open),[]),C=(0,i.O7)().device.isMobile;return(0,s.useEffect)((()=>{(0,c.exposeDebugValue)("shouldShowSuggestedQuestionsFlags",{isEmptyAssistantState:f,isSuggestedQuestionsEnabled:x,suggestedQuestions:p,renderAsFullPage:t})}),[f,x,p,t]),{shouldRenderFinetunedAssistantIntroMessage:g&&f,shouldShowFullPageSkillSwitcher:g&&f&&u.length>0&&t,shouldShowClientSkillsPageSection:g&&f&&u.length>0&&!t,shouldShowSuggestedQuestionsPageSection:x,shouldShowQnaWelcomeHeader:!m&&d,shouldShowCitationsAtBottom:!k||y,isAnswerLoading:h&&y,shouldShowCitationsLoadingDots:!(0,v.$K)(h)&&y,shouldShowNonQNAError:r&&k&&!y&&!d,shouldShowAssistantFeedbackButtons:!S&&o&&r&&(o.temporaryClientSteps.length>0||k)&&!r.sampling&&!r.evaluating,shouldShowHelpRedirectBar:!n&&!b&&d&&!C&&!S&&(!o||0===o.clientSteps.length&&0===o.temporaryClientSteps.length)&&(!r||!r.sampling&&!r.evaluating),isAiEligible:w,isLabelerMode:S,isQnA:d,hasLockAction:(null==r?void 0:r.evaluating)||(null==r?void 0:r.sampling)||(null==r?void 0:r.committing)||!w}}function He(e){window.__c={n:"AssistantChatSkillsToTryOutInlineSection"};const{skillsWrapStyle:t,skillIconStyle:n,clientSkills:a}=e,o=(0,i.O7)(),r=(0,s.useCallback)((async e=>{await(0,Y.OZ)({environment:o,clientSkill:e})}),[o]),l=(0,s.useCallback)((()=>{(0,G.navigateToView)({view:"skillSwitcher"})}),[]);return(0,ve.jsx)(F.Z,{desktopTitleStyle:{paddingLeft:2},title:(0,ve.jsx)(y.FormattedMessage,{id:"assistantChat.thingsToTry",defaultMessage:"Things to try"}),children:(0,ve.jsxs)("div",{style:t,children:[S.xH(X.pageChatSections.map((e=>e.skills[0]))).map((e=>{const t=a.find((t=>t.skillType===e));if(t)return(0,ve.jsx)(te.Z,{icon:X.skillIconMap[t.skillType],iconStyle:n,onClick:async()=>{await r(t)},title:(0,ve.jsx)(Le.Z,{clientSkill:t})},t.key)})),(0,ve.jsx)(te.Z,{onClick:l,title:"More"})]})})}function Ne(e){window.__c={n:"AssistantChatSuggestionBubblesInlineSection"};const{bubblesWrapStyle:t,handleSubmitSuggestedItem:n,shouldShowHelpRedirectBar:i}=e,a=(0,s.useRef)(null),[o,r]=(0,s.useState)(void 0),[l,d]=(0,s.useState)(!1),c=qe(),u=(0,s.useMemo)((()=>[...c.map((e=>({type:"suggested_question",question:e}))),...i?[{type:"help_redirect_bar"}]:[]]),[i,c]),p=u.slice(0,l?void 0:o??void 0);return(0,s.useEffect)((()=>{if(a&&null!==a.current){var e;const n=a.current.offsetTop,s=null===(e=a.current.firstChild)||void 0===e?void 0:e.offsetHeight;for(let e=0;e<u.length;e++){var t;const i=null===(t=a.current)||void 0===t?void 0:t.children[e];if(!i)continue;const o=i.offsetTop;if(Math.floor((o-n)/s)+1>3){r(e);break}}}}),[u]),(0,ve.jsx)(F.Z,{desktopTitleStyle:{paddingLeft:2},title:(0,ve.jsx)(y.FormattedMessage,{id:"assistantChat.suggested_questions_section_title",defaultMessage:"Ask about"}),children:(0,ve.jsxs)("div",{style:t,ref:a,children:[p.map(((e,t)=>"suggested_question"===e.type?(0,ve.jsx)(R.ZP,{renderTooltip:()=>(0,ve.jsx)("div",{style:{maxWidth:220,whiteSpace:"normal"},children:e.question}),placement:W.u.Top,render:t=>(0,ve.jsx)(te.Z,{onClick:()=>n(e.question),title:e.question.length>40?`${e.question.slice(0,40)}...`:e.question,tooltipEvents:e.question.length>40?t:void 0})},`${t}_${e}`):(0,ve.jsx)(Xe,{hasVerticalMargin:!1},"-1_help"))),!l&&o&&(0,ve.jsx)(te.Z,{onClick:()=>d(!0),title:"More",lightGrey:!0},"More")]})})}async function De(e){const{snapToBottom:t,newValue:n,isSlackMode:s,slackModeState:i,currentSkill:a,environment:o,shouldForceStartNewSession:r,source:l}=e;if(!n)return;null==t||t();let d=N.Z.getActiveSessionId();if(!d||r){d=(await U.resetAndInitializeAssistantSession({environment:o,isLabelerSlackMode:s,fakeSlackChannel:null==i?void 0:i.selectedFakeChannel,clientSkill:a,skillSettings:{}})).sessionId}U.commitHumanStep({environment:o,text:n,fakeUser:null==i?void 0:i.selectedFakeUser,sessionId:d,source:l}),U.updateAssistantTimestampsAfterSessionInitialization({environment:o})}function Qe(e){window.__c={n:"AssistantChat"};const{renderAsFullPage:t=!1,onBackspaceOnEmptyInput:n}=e,o=Boolean(e.isQuickSearchMode),r=(0,i.O7)(),{isMobile:d}=r.device,c=(0,s.useRef)(void 0),u=(0,y.useIntl)(),p=(0,a.VK)((()=>N.Z.getActiveAssistantRuntimeState()),[]),g=(0,a.VK)((()=>N.Z.getActiveAssistantConfigurationState()),[]),h=(0,a.VK)((()=>O.default.state.mainEditorCurrentBlockStore),[]),v=(0,a.VK)((()=>O.default.state.currentSpaceStore),[]),x=(0,a.VK)((()=>(0,l.w_)(r.TabbedRouterStore.state)),[r]),[k,I]=(0,s.useState)(!1),F=null==p?void 0:p.selectedSkill,R=(0,a.VK)((()=>D.Pl.state),[]),V=Boolean(R),{store:K}=(0,L.Cl)({initialValue:void 0,onChange:S.yR}),W=Oe({renderAsFullPage:t,isQuickSearchMode:o}),H=(0,s.useCallback)((()=>{c.current&&(c.current.scrollToBottom(),I(!1))}),[I]),q=(0,s.useCallback)((async(e,t)=>{!V||null!=R&&R.selectedFakeUser?e&&await De({isSlackMode:V,slackModeState:R,environment:r,currentSkill:F,snapToBottom:H,newValue:e,source:t}):w.deprecatedShowErrorMessage("Please select a user to send the message as")}),[V,R,r,F,H]),$=(0,s.useCallback)(((e,t)=>{const n=c.current;n&&(n.atScrollEnd()?I(!1):I(!0),r.device.isMobile&&"up"===t&&(n.distanceToBottom()??0)>0&&b.ZH({device:r.device}))}),[r]),G=(0,s.useCallback)((()=>{const e=N.Z.getActiveAssistantConfigurationStore();e&&e.state&&e.setState({...e.state,showNotionHelpQuestionWarning:!1})}),[]);(0,s.useEffect)((()=>{if(r.device.isMobileNative){var e,t;Boolean("web"===x.type&&("nativeTab"===x.route.name&&"assistant"===x.route.tab||"nativeTab"===(null===(e=x.redirectedTo)||void 0===e?void 0:e.route.name)&&"assistant"===(null===(t=x.redirectedTo)||void 0===t?void 0:t.route.tab)))?$e(r,K):b.ZH({device:r.device})}}),[r,x,K]),(0,s.useEffect)((()=>{$e(r,K)}),[r,K]),(0,s.useEffect)((()=>{const e=N.Z.getActiveAssistantRuntimeStore(),t=null==p?void 0:p.primeTextInput;e&&t&&(M.createAndCommit({userAction:"assistant.primeTextFromSearch",environment:r,perform:e=>{j.sO({environment:r,store:K,value:f.TPx(t),transaction:e})}}),A.Z5({store:K,selection:{startIndex:t.length,endIndex:t.length}}),U.clearPrimedText({assistantRuntimeStore:e}))}),[r,K,null==p?void 0:p.primeTextInput]),(0,s.useEffect)((()=>{c.current&&!k&&c.current.scrollToBottom()}),[null==p?void 0:p.clientSteps,null==p?void 0:p.temporaryClientSteps,k]);const Y=(0,a.qz)(void 0,z.Z),J=nt();return v&&(t||h)?(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(B.A,{scrollerStore:Y}),null!=g&&g.showNotionHelpQuestionWarning?(0,ve.jsxs)("div",{style:J.helpCenterBlueBar,children:[(0,ve.jsx)("div",{children:(0,ve.jsx)(y.FormattedMessage,{id:"assistantChat.lookingForHelpCenter",defaultMessage:"Looking for the {notionHelpCenter}?",values:{notionHelpCenter:(0,ve.jsx)(P.Z,{external:!0,href:"/help",disableHover:!0,children:(0,ve.jsx)(y.FormattedMessage,{id:"assistantChat.lookingForHelpCenter.notionHelpCenter",defaultMessage:"Notion help center"})})}})}),(0,ve.jsx)(Z.Z,{iconStyle:J.helpCenterBlueBarCloseButtonIcon,style:J.helpCenterBlueBarCloseButton,icon:m.D,onClick:G,ariaLabel:"close"})]}):null,(0,ve.jsx)(T.T,{ref:c,type:E.Z.Y,style:J.scroller,onScroll:$,store:Y,children:(0,ve.jsx)(Ue,{assistantChatSectionsState:W,renderAsFullPage:t,isQuickSearchMode:o,currentSpaceStore:v,handleTextSubmit:e=>q(e,"suggested_question")})}),W.isAiEligible?(0,ve.jsx)("div",{style:J.inputWrap,children:(0,ve.jsx)(_.Z,{capture:d,render:()=>(0,ve.jsx)(Ve.H,{isQnA:W.isQnA,store:K,placeholder:W.isQnA?u.formatMessage(Ee.qnaInputPlaceholder):u.formatMessage(Ee.assistantInputPlaceholder),onSubmit:e=>q(e,"chat"),onFocus:()=>{C.MO(),d&&Q.Z.onShow(H)},disabled:W.hasLockAction,onBackspaceOnEmptyInput:n})})}):null]}):null}function ze(e){const{renderAsFullPage:t}=e;return(0,a.VK)((()=>(0,X.getFilteredClientSkills)({showCustomSkills:H.Z.showCustomSkills(),hasCurrentPage:!t})),[t])}function qe(){return(0,a.VK)((()=>{var e;return H.Z.shouldShowSuggestedQuestions()?(null===(e=O.default.state.currentSpaceViewStore)||void 0===e||null===(e=e.getModel())||void 0===e||null===(e=e.getAiSuggestions())||void 0===e||null===(e=e.qna_suggested_questions)||void 0===e||null===(e=e.questions)||void 0===e?void 0:e.map((e=>e.text)))??[]:[]}),[])}function Ue(e){window.__c={n:"AssistantChatScrollerContent"};const{assistantChatSectionsState:t,currentSpaceStore:n,renderAsFullPage:o,isQuickSearchMode:l,handleTextSubmit:c}=e,m=(0,y.useIntl)(),h=(0,i.O7)(),S=ze({renderAsFullPage:o}),x=(0,a.VK)((()=>N.Z.getActiveAssistantConfigurationState()),[]),k=Boolean((null==x?void 0:x.sampling)||(null==x?void 0:x.evaluating)),w=(0,s.useMemo)((()=>r.default.createValue(!0)),[]);(0,s.useEffect)((()=>{if(!k){var e;const t=null===(e=N.Z.getActiveAssistantRuntimeStore())||void 0===e?void 0:e.getCombinedSteps().at(-1);if("assistantChat"===(null==t?void 0:t.type)){0===(0,J.M)({clientStep:t,citationOrdering:void 0}).length&&w.setState(!1)}}}),[w,h,k]);const b=(0,a.qz)(void 0,ee.d),C=nt(),j=(0,a.VK)((()=>N.Z.getActiveAssistantRuntimeState()),[]),A=null==j?void 0:j.selectedSkill,M=(0,s.useCallback)((e=>!!t.isLabelerMode||(t.isQnA?"human"===e.type||"assistantChat"===e.type||"assistantChatText"===e.type||"assistantShowSearchResults"===e.type||"assistantFriendlyError"===e.type:"human"===e.type||"assistantChat"===e.type||"assistantChatText"===e.type||"assistantShowSearchResults"===e.type||"assistantTransaction"===e.type||"assistantCreateWorkflow"===e.type)),[t.isLabelerMode,t.isQnA]),I=(0,a.VK)((()=>{var e;const t=null===(e=N.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.previewingStepObservations.filter((e=>"observation"===e.type&&"error"===e.observationType));return null==t?void 0:t.map((e=>e.value)).join("\n")}),[]),Z=(0,s.useMemo)((()=>{if(null==x||!x.startTimestamp)return;const e=(0,p.kT)({date:x.startTimestamp,timezone:(0,g.r)()});return[(0,u.p6)({allowRelativeDates:!0,date:e,dateFormat:"relative",intl:m,shortenDate:!1}),e.toFormat("h:mm a")].join(" ")}),[null==x?void 0:x.startTimestamp,m]),T=(0,s.useMemo)((()=>r.default.createValue(!1)),[]),F=tt({assistantRuntimeState:j,assistantConfigurationState:x});return(0,s.useEffect)((()=>{F&&(T.setState(!1),w.setState(!0))}),[T,w,F]),(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("div",{style:{marginTop:"auto"}}),t.shouldRenderFinetunedAssistantIntroMessage&&(0,ve.jsx)(ve.Fragment,{children:(0,ve.jsxs)("div",{style:C.emptyStateWrap,children:[(0,ve.jsx)("div",{style:C.faceImgWrap,children:(0,ve.jsx)("img",{style:C.faceImg,src:d.Z.images.aiFaceLookleftPng})}),(0,ve.jsxs)("div",{style:C.emptyStateText,children:[(0,ve.jsx)("p",{children:(0,ve.jsx)(y.FormattedMessage,{id:"assistantChat.welcomeMessage.title",defaultMessage:"Hi, I’m Notion AI! I can chat with you about anything, find information from the workspace, and read and edit pages."})}),(0,ve.jsx)("p",{children:(0,ve.jsx)(y.FormattedMessage,{id:"assistantChat.welcomeMessage.helpText",defaultMessage:"I’m still in Beta, so please use the 👍 👎 buttons to help me improve."})})]})]})}),t.shouldShowFullPageSkillSwitcher&&(0,ve.jsx)(We.s,{clientSkills:S,renderAsFullPage:o,disableKeyboard:!0}),t.shouldShowClientSkillsPageSection&&(0,ve.jsx)(He,{clientSkills:S,skillIconStyle:C.skillIcon,skillsWrapStyle:C.skillsWrap}),Z&&(0,v.$K)(j)&&j.clientSteps.length>0&&(0,ve.jsx)("div",{style:C.dateContainer,children:(0,ve.jsx)("div",{style:C.date,children:Z})}),t.shouldShowQnaWelcomeHeader&&(0,ve.jsx)(st,{isQuickSearchMode:l,renderAsFullPage:o}),A&&X.skillDefaultAssistantMessageMap[A.skillType]&&(0,ve.jsx)(ne.H,{clientStep:{type:"assistantChatText",text:m.formatMessage(X.skillDefaultAssistantMessageMap[A.skillType])},parentStore:n,parentSpaceId:n.id,configurationState:x,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:void 0}),(0,ve.jsx)(et,{clientSteps:[...(null==j?void 0:j.clientSteps)??[],...(null==j?void 0:j.temporaryClientSteps)??[]].filter(M),parentStore:n,parentSpaceId:n.id,configurationState:x,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:b}),F&&("default"===F.type?(0,ve.jsx)(ne.H,{clientStep:{type:"assistantLoading"},parentStore:n,parentSpaceId:n.id,configurationState:x,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:b}):"searchResults"===F.type?(0,ve.jsx)(Ke.N,{clientStep:F.step,parentStore:n,configurationState:x,citationHoverStore:b,isQuickSearchMode:l,renderAsFullPage:o}):(0,v.t1)(F)),t.shouldShowCitationsAtBottom&&(0,ve.jsx)(Ge,{hoverStore:b,parentStore:n,expandedStore:T,toggledStore:w,isLoading:t.shouldShowCitationsLoadingDots}),t.shouldShowNonQNAError&&(0,ve.jsx)("div",{style:C.error,children:I}),t.shouldShowAssistantFeedbackButtons&&(0,ve.jsx)(xe,{type:Boolean(null==j?void 0:j.temporaryClientSteps.find((e=>"assistantCreateWorkflow"===e.type)))?"create_workflow":I?t.isQnA?"error_retry_only":"error":Boolean(null==j?void 0:j.temporaryClientSteps.find((e=>"assistantTransaction"===e.type)))?"accept_edits":"chat",renderAsFullPage:o}),t.shouldShowSuggestedQuestionsPageSection?(0,ve.jsx)(Ne,{handleSubmitSuggestedItem:e=>c(f.TPx(e)),bubblesWrapStyle:C.skillsWrap,shouldShowHelpRedirectBar:t.shouldShowHelpRedirectBar}):t.shouldShowHelpRedirectBar&&(0,ve.jsx)(Xe,{hasVerticalMargin:!0}),!t.isAiEligible&&(0,ve.jsx)(Te,{parentStore:n,parentSpaceId:n.id,configurationState:x,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:b})]})}function $e(e,t){b.ZH({device:e.device}),A.N_({store:t})}function Ge(e){window.__c={n:"LatestStepCitations"};const{hoverStore:t,parentStore:n,expandedStore:s,toggledStore:i,isLoading:o}=e,{chatStep:r,searchResultsStep:l}=(0,a.VK)((()=>{var e;const t=(null===(e=N.Z.getActiveAssistantRuntimeStore())||void 0===e?void 0:e.getCombinedSteps())??[];if(0===t.length)return{chatStep:void 0,searchResultsStep:void 0};const n=t.slice(-2).reverse().find((0,v.AO)((e=>"assistantShowSearchResults"===e.type?{true:e}:{false:e}))),s=t[t.length-1];return{chatStep:"assistantChat"===s.type?s:void 0,searchResultsStep:n}}),[]),d={hoverStore:t,parentStore:n,expandedStore:s,canExpand:!0,toggledStore:i,isLoading:o};return(0,v.$K)(r)?(0,ve.jsx)(Ye,{...d,chatStep:r,searchResultsStep:l}):(0,v.$K)(l)?(0,ve.jsx)(Je,{...d,searchResultsStep:l}):null}function Ye(e){window.__c={n:"CitedPagesListWithNumbers"};const{chatStep:t,parentStore:n,searchResultsStep:i,...a}=e,o=(0,s.useMemo)((()=>{const e=(0,J.M)({clientStep:t,citationOrdering:i?(0,$.TT)(i):void 0});return(0,$.Zr)({pageCitationsFromChat:e,parentStore:n,searchResultsStep:i})}),[t,n,i]);return(0,ve.jsx)(se.d,{citations:o,...a})}function Je(e){window.__c={n:"CitedPagesListFromSearch"};const{parentStore:t,searchResultsStep:n,...i}=e,a=(0,s.useMemo)((()=>(0,$.Zr)({pageCitationsFromChat:[],parentStore:t,searchResultsStep:n})),[t,n]);return(0,ve.jsx)(se.d,{citations:a,...i})}function Xe(e){window.__c={n:"AssistantHelpRedirectBar"};const t=(0,i.O7)(),n=(0,o.yK)((()=>({wrap:{display:"flex",marginTop:e.hasVerticalMargin?8:0,marginBottom:e.hasVerticalMargin?6:0,gap:6}})),[e.hasVerticalMargin]);return(0,ve.jsx)("div",{style:n.wrap,children:(0,ve.jsx)(te.Z,{icon:e=>(0,h.m)({...e,fontWeight:500}),onClick:()=>{_e.G.update((e=>({...e,open:!0})));const e=N.Z.getActiveAssistantConfigurationState();e&&k.Ar(t,{qnaSessionId:e.sessionId,from:"qna_modal_chat"})},title:(0,ve.jsx)(y.FormattedMessage,{defaultMessage:"Get Notion help",id:"AssistantChat.routeToNotionHelp"})})})}function et(e){const{clientSteps:t,parentStore:n,parentSpaceId:s,configurationState:i,isQuickSearchMode:a,renderAsFullPage:o,latestStepCitationHoverStore:r}=e;return(0,ve.jsx)(ve.Fragment,{children:t.map(((e,t)=>(0,ve.jsx)(ne.H,{clientStep:e,parentStore:n,parentSpaceId:s,configurationState:i,isQuickSearchMode:a,renderAsFullPage:o,latestStepCitationHoverStore:r,fakeSlackUser:"human"===e.type?e.fakeUser:void 0},`${(null==i?void 0:i.sessionId)??""}-${t}`)))})}function tt(e){const{assistantRuntimeState:t,assistantConfigurationState:n}=e;return(0,a.VK)((()=>{if(!t||!n)return;if(!n.sampling&&!n.evaluating)return;const e=t.temporaryClientSteps.find((0,v.AO)((e=>"assistantChat"===e.type||"assistantTransaction"===e.type||"assistantChatText"===e.type?{true:e}:{false:e})));if(e&&("assistantTransaction"===e.type||!(0,V.S)(e)))return;const s=t.clientSteps[t.clientSteps.length-1];return s&&"assistantShowSearchResults"===s.type?{type:"searchResults",step:s}:{type:"default"}}),[t,n])}function nt(){const{device:e}=(0,i.O7)(),{isMobile:t}=e;return(0,o.yK)((e=>({wrap:{display:"flex",flexDirection:"column",background:e.contentBackground,width:400,height:"max(calc(100vh - 78px), 300px)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingLeft:12,paddingRight:12},labeledInput:{display:"flex",gap:8,alignItems:"center"},reset:{color:e.mediumIconColor},toggleSlackMode:{color:e.mediumIconColor},closeButton:{borderRadius:"100%",marginLeft:4},input:{width:void 0,marginLeft:8,marginRight:8},scroller:{flexGrow:1,display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:12,paddingLeft:16,paddingRight:16,WebkitMaskImage:"linear-gradient(black calc(100% - 12px), transparent)"},samplesLabel:{fontSize:t?14:12,marginTop:8,marginBottom:8},inputLabel:{fontSize:t?16:14,color:e.mediumTextColor},previewLabel:{fontSize:t?14:12},editLink:{fontSize:t?16:14,color:e.mediumTextColor,textDecoration:"underline",paddingLeft:8,paddingRight:8},error:{fontSize:t?16:14,color:e.errorText},addCustomInstructionsIcon:{fill:e.aiPurpleColor},suggestionsLabel:{fontSize:t?14:12,color:e.mediumTextColor,marginTop:18,marginBottom:12},faceImgWrap:{width:64,height:64,borderRadius:"100%",background:"white",boxShadow:e.largeLightBoxShadow,overflow:"hidden"},faceImg:{width:64,pointerEvents:"none"},emptyStateText:{marginTop:28,fontSize:16,color:e.regularTextColor,fontFamily:x.Z.baseFontFamily.serif},emptyStateWrap:{marginLeft:8,marginRight:8},inputWrap:{paddingTop:0,paddingBottom:16},skillsCaption:{fontSize:t?14:12,color:e.mediumTextColor,marginBottom:8},skillIcon:{fill:e.aiPurpleColor},skillsWrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8},date:{fontSize:12,color:e.lightTextColor},dateContainer:{display:"flex",justifyContent:"center",marginTop:4,marginBottom:4},helpCenterBlueBar:{backgroundColor:e.blueButtonBackground,fontSize:14,padding:"8px 16px",color:e.regularInvertedTextColor,display:"flex",justifyContent:"space-between",alignItems:"center"},helpCenterBlueBarCloseButton:{width:16,height:16,borderRadius:"100%"},helpCenterBlueBarCloseButtonIcon:{fill:e.regularInvertedTextColor}})),[t])}function st(e){window.__c={n:"QnAWelcomeHeader"};const{isQuickSearchMode:t,renderAsFullPage:n}=e,s=(0,y.useIntl)(),i=(0,a.VK)((()=>N.Z.getActiveAssistantConfigurationState()),[]),o=(0,a.VK)((()=>O.default.state.mainEditorCurrentBlockStore),[]),r=(0,a.VK)((()=>O.default.state.currentSpaceStore),[]),l=(0,a.VK)((()=>{var e;return null===(e=O.default.state.currentUserStore)||void 0===e?void 0:e.getDisplayName(s)}),[s]),d=(0,a.VK)((()=>I.Z.state),[]),c=(0,a.VK)((()=>null==r?void 0:r.getName()),[r]);if(!r||!c||!n&&!o||!l)return null;if(!d)return null;const u={parentStore:r,parentSpaceId:r.id,configurationState:i,isQuickSearchMode:t,renderAsFullPage:n,latestStepCitationHoverStore:void 0};return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(ne.H,{clientStep:{type:"assistantChatText",text:s.formatMessage(Ee.qnaAssistantChatText,{firstName:l,workspaceName:c})},...u}),(0,ve.jsx)(ne.H,{clientStep:{type:"assistantChatText",text:s.formatMessage(Ee.assistantBetaDisclaimerText)},...u}),!1]})}},17456:(e,t,n)=>{n.d(t,{p:()=>L});n(21703);var s=n(43261),i=n.n(s),a=n(30120),o=n(67294),r=n(18466),l=n(480),d=n(86628),c=n(24405),u=n(3158),p=n(89942),g=n(59054),m=n(41219),h=n(72126),S=n(45953),f=n(149),v=n(8542),x=n(70203),y=n(82990),k=n(9291),w=n(54642),b=n(80402),C=n(68785),j=n(75179),A=n(17809),M=n(80444),I=n(82375),Z=n(26136),T=n(58016),F=n(45891),R=n(26382),P=n(58449),B=n(23388),_=n(67593),V=n(85893);const K=(0,k.defineMessages)({chatHistorySearchPlaceholder:{id:"assistant.chatHistory.placeholder",defaultMessage:"Search or start new chat"},searchOnlyPlaceholder:{id:"assistant.chatHistory.searchOnlyPlaceholder",defaultMessage:"Search"}});function L(e){window.__c={n:"AssistantChatHistory"};const{renderAsFullPage:t,hideNewChatCreation:n,onRestoreChatSession:s}=e,i=function(){const e=(0,l.O7)(),t=(0,d.VK)((()=>{var e;const t=null===(e=M.default.state.currentSpaceStore)||void 0===e?void 0:e.getSpaceId();if(!t)throw new Error("No space Id for user");return t}),[]),[n]=(0,g.r5)((async()=>{const n=await w.getChatTranscriptSessionHistoryForUser(e,{spaceId:t});if("success"!==n.type)throw new Error("Failed to fetch chat transcript history for space");const s=Date.now(),i=S.PF.create(n.data.recordMap);P.Z.setSessionInfos(t,n.data.chatSessionIds.map((e=>{var t;return{id:e,createdTime:(null===(t=i.getModel({id:e,table:v.t_}))||void 0===t?void 0:t.created_time)??s}})))}),[e,t]);return(0,d.VK)((()=>{const{currentSpaceViewStore:e}=M.default.state;if(!e)return[];const s=P.Z.getSessionsForSpace(t);return"pending"!==n.status||0!==s.length?s.map((n=>{let{id:s}=n;return Z.uj.createChildStore(e,{id:s,table:v.t_,spaceId:t})})):void 0}),[n.status,t])}();return void 0===i?(0,V.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",flexGrow:1,paddingBottom:20},children:(0,V.jsx)(C.Z,{})}):(0,V.jsx)(O,{childStores:i,renderAsFullPage:t,hideNewChatCreation:n,onRestoreChatSession:s})}function W(e){const{store:t}=e,n=(0,d.VK)((()=>{var e;return null===(e=t.getChatStepStore())||void 0===e?void 0:e.dangerouslyGetUnmigratedStorageStep()}),[t]),[{value:s}]=(0,g.r5)((async()=>{if(!n||f.x.isFail(n))return{value:void 0};if(!n.value)return{value:void 0};return await(0,u.Fd)(n.value)}),[n]);return s?{status:"loaded",result:s}:{status:"loading"}}function E(e){const{migratedStep:t,intl:n}=e,s=t.serializedTranscriptSteps,i=null==s?void 0:s.slice().reverse().find(p.Zn);if(!i)return"";const a=(0,u.xA)({step:i,intl:n});return f.x.isFail(a)?void 0:a.value}function O(e){window.__c={n:"AssistantLoadedChatHistory"};const{renderAsFullPage:t,childStores:n,hideNewChatCreation:s,onRestoreChatSession:a}=e,[p,m]=(0,o.useState)(""),S=(0,c.yK)((()=>({wrap:{paddingLeft:12,paddingRight:12,overflowY:"scroll"},textInputWrap:{paddingBottom:16,paddingTop:s?8:2}})),[s]),v=(0,B.AP)({renderAsFullPage:t,isQuickSearchMode:!1}),{isMobile:y}=(0,l.Fy)(),w=(0,k.useIntl)(),{store:C}=(0,A.Cl)({initialValue:void 0,onChange:h.yR}),M=function(e,t){const n=(0,d.VK)((()=>h.oA(e.map((e=>{var t;const n=null===(t=e.getChatStepStore())||void 0===t?void 0:t.dangerouslyGetUnmigratedStorageStep();if(n&&f.x.isSuccess(n))return{childStoreId:e.id,value:n.value}})))),[e]),[{value:s}]=(0,g.r5)((async()=>h.oA(await Promise.all(n.map((async e=>{const{childStoreId:t,value:n}=e;if(!n)return;const s=await(0,u.Fd)(n);return!f.x.isFail(s)&&e.value?{childStoreId:t,value:e.value}:void 0}))))),[n]);if(!s)return new Map;const i=new Map;for(const{childStoreId:a,value:o}of s)i.set(a,E({migratedStep:o,intl:t})??"");return i}(n,w),Z={extract:e=>r.Z.withListenerIgnored((()=>e.getTitleOrFallback(w)+M.get(e.id)??""))},T=i().filter(p,n,Z).map((e=>e.original)),F=(0,d.VK)((()=>I.Pl.state),[]),P=(0,l.O7)(),L=(0,o.useCallback)((e=>{(0,B.AF)({isSlackMode:Boolean(F),slackModeState:F,newValue:e,environment:P,currentSkill:void 0,shouldForceStartNewSession:!0,source:"transcript"}).then((()=>{R.assistantMenuStore.setState({...R.assistantMenuStore.state,currentView:"chat"})})).catch((()=>{}))}),[P,F]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("div",{style:S.wrap,children:[T.map(((e,t)=>(0,V.jsx)(o.Fragment,{children:(0,V.jsx)(N,{store:e,isLastItem:t===T.length-1,onRestoreChatSession:a})},e.id))),!s&&(0,V.jsx)(H,{})]}),(0,V.jsx)(j.Z,{capture:y,render:()=>(0,V.jsx)("div",{style:S.textInputWrap,children:(0,V.jsx)(_.H,{hideSubmitIcon:s,isQnA:v.isQnA,store:C,placeholder:w.formatMessage(s?K.searchOnlyPlaceholder:K.chatHistorySearchPlaceholder),onSubmit:v.isAiEligible&&!s?L:h.ZT,onFocus:()=>{b.MO()},disabled:v.hasLockAction,onBackspaceOnEmptyInput:h.ZT,onTextChange:e=>{m((0,x.Jcv)(e))}})})})]})}function H(){window.__c={n:"StartNewChatButtonOption"};const e=(0,l.O7)(),t=(0,o.useCallback)((()=>{(0,T.resetAndInitializeAssistantSession)({environment:e,makeActiveSession:!0}).then((()=>{R.assistantMenuStore.setState({...R.assistantMenuStore.state,currentView:"chat"})})).catch((()=>{}))}),[e]),[n,s]=(0,o.useState)(!1),i=(0,c.yK)((e=>({wrapper:{display:"flex",alignItems:"center",paddingTop:6,paddingBottom:6,marginBottom:6,backgroundColor:n?e.hoveredDiscussionBackground:void 0,borderRadius:6,cursor:"pointer"},textWrapper:{fontSize:14,fontWeight:500},startNewChatIcon:{color:e.icon.secondary,height:16,width:16},startNewChatIconWrapper:{marginLeft:8,marginRight:8}})),[n]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("div",{style:{borderTop:"1px solid #E5E5E5",marginTop:6,marginBottom:6}}),(0,V.jsxs)("div",{style:i.wrapper,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[(0,V.jsx)("div",{style:i.startNewChatIconWrapper,children:(0,m.L)(i.startNewChatIcon)}),(0,V.jsx)("div",{style:i.textWrapper,onClick:t,children:(0,V.jsx)(k.FormattedMessage,{id:"assistant.chatHistory.startNewChat",defaultMessage:"Start a new chat"})})]})]})}function N(e){window.__c={n:"AssistantChatHistoryItem"};const{store:t,onRestoreChatSession:n,isLastItem:s}=e,i=(0,k.useIntl)(),a=(0,d.VK)((()=>t.getTitleOrFallback(i)),[i,t]),r=(0,l.O7)(),c=W({store:t}),u=(0,d.VK)((()=>t.getCreatedTime()),[t]),p=(0,o.useCallback)((()=>{"loading"===c.status||f.x.isFail(c.result)||c.result.value&&(0,F.t)(c.result.value,r).then((()=>{R.assistantMenuStore.setState({...R.assistantMenuStore.state,currentView:"chat"}),null==n||n()})).catch((()=>{}))}),[r,n,c]),g=function(e){const{store:t,intl:n}=e,s=W({store:t});if("loading"===s.status)return{value:void 0};const i=s.result;return f.x.isFail(i)?i:i.value?{value:E({migratedStep:i.value,intl:n})}:{value:void 0}}({store:t,intl:i});let m="";return f.x.isSuccess(g)&&g.value&&(m=g.value),(0,V.jsx)(D,{isLastItem:s,title:a,description:m,onSelectHistoryItem:p,createdTime:u})}function D(e){window.__c={n:"AssistantChatHistoryItemRenderer"};const{onSelectHistoryItem:t,title:n,description:s,isLastItem:i,createdTime:r}=e,[l,u]=(0,o.useState)(!1),p=(0,d.VK)((()=>{return(e=a.ou.utc().diff(a.ou.fromMillis(r))).as("minutes")<1?"just now":e.as("hours")<1?`${Math.round(e.as("minutes"))}m`:e.as("days")<1?`${Math.round(e.as("hours"))}h`:`${Math.round(e.as("days"))}d`;var e}),[r]),g=(0,c.yK)((e=>({chatHistoryItemWrapper:{display:"flex",flexDirection:"column",paddingLeft:12,paddingRight:12,cursor:"pointer",backgroundColor:l?e.hoveredDiscussionBackground:void 0,paddingTop:6,paddingBottom:6,borderRadius:6},chatHistorySubtitle:{color:e.text.secondary,fontSize:12,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},titleWrap:{display:"flex",alignItems:"center"},title:{fontSize:14,fontWeight:500},timestamp:{fontSize:y.Z.fontSize.UISmall.desktop,color:e.text.secondary,paddingLeft:6}})),[l]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("div",{style:g.chatHistoryItemWrapper,onClick:t,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[(0,V.jsxs)("div",{style:g.titleWrap,children:[(0,V.jsx)("div",{style:g.title,children:n}),(0,V.jsx)("div",{style:g.timestamp,children:p})]}),(0,V.jsx)("div",{style:g.chatHistorySubtitle,children:s})]}),!i&&(0,V.jsx)("div",{style:{borderTop:"1px solid #E5E5E5",marginTop:6,marginBottom:6}})]})}},84969:(e,t,n)=>{n.d(t,{m:()=>w});n(57658);var s=n(67294),i=n(26263),a=n(480),o=n(86628),r=n(49085),l=n(4615),d=n(70203),c=n(44805),u=n(97880),p=n(15201),g=n(55217),m=n(62619),h=n(48588),S=n(65147),f=n(91437),v=n(67973),x=n(61144),y=n(42899),k=n(85893);function w(e){window.__c={n:"AssistantChatMessageRenderer"};const{clientStep:t,parentStore:n,configurationState:w,fakeSlackUser:b,isLatestStep:C,isQuickSearchMode:j,renderAsFullPage:A,priorSearchResultsStep:M,disableWrap:I}=e,Z=(0,a.O7)(),T=(0,s.useMemo)((()=>new i.Z({name:"AssistantChatMessageListRenderer",isSyntheticAssistantData:!0})),[]),F=(0,s.useMemo)((()=>(0,l.ZP)()),[]),R=(0,o.qz)(void 0,v.d),P=e.citationHoverStore??R,B=(0,S.RS)({environment:Z,clientStep:t,citationOrdering:M?(0,S.TT)(M):void 0,inMemoryRecordCache:T,listId:F}),_=(0,s.useMemo)((()=>{const e=(0,f.M)({clientStep:t,citationOrdering:M?(0,S.TT)(M):void 0});return(0,S.Zr)({pageCitationsFromChat:e,parentStore:n,searchResultsStep:M})}),[t,n,M]),V=(0,s.useRef)(null),K=(0,s.useMemo)((()=>r.default.createValue(!1)),[]),L=(0,s.useMemo)((()=>r.default.createValue(!1)),[]);!function(e){const{containerRef:t,citationHoverStore:n}=e,i=(0,o.VK)((()=>{var e;const n=h.Z.state;if(!n||!t.current||!m.r3(t.current,n.token.node))return;const s=n.annotations.find(d.OU5),i=s?null===(e=d.Vv0(s))||void 0===e?void 0:e.blockId:void 0;return i?{pageId:i,tokenNode:n.token.node}:void 0}),[t]),a=(0,s.useRef)([]);(0,s.useEffect)((()=>{n.setState(i?{type:"token",pageId:i.pageId,node:i.tokenNode}:void 0)}),[n,i]),(0,o.VK)((()=>{var e;const s=null===(e=n.state)||void 0===e?void 0:e.pageId,o=(0,u.$K)(i)?void 0:s;for(const t of a.current)t.style.removeProperty("background-color");const r=[];if(o&&t.current){const e=t.current.querySelectorAll(`[${c.JQ}='${o}']`);for(const t of Array.from(e))t instanceof HTMLElement&&t&&(t.style.backgroundColor="#2383e2",r.push(t))}a.current=r}),[n,t,i]),(0,s.useEffect)((()=>()=>{for(const e of a.current)e.style.removeProperty("background-color")}),[])}({containerRef:V,citationHoverStore:P});const W=(0,k.jsx)(p.O,{displayName:"AssistantChatStepContent",disabled:!0,children:(0,k.jsx)(g.Z,{store:B,disabled:!1,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})}),E=(0,k.jsxs)(k.Fragment,{children:[!C&&(0,k.jsx)(y.d,{citations:_,hoverStore:P,canExpand:!0,toggledStore:K,expandedStore:L}),(0,k.jsx)(y.P,{containerRef:V,hoverStore:P,parentStore:n,renderAsFullPage:A,isQuickSearchMode:j})]});return I?(0,k.jsxs)(k.Fragment,{children:[W,E]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(x.J,{ref:V,clientStep:t,configurationState:w,fakeSlackUser:b,forceShowFeedback:C,children:W}),E]})}},49631:(e,t,n)=>{n.d(t,{H:()=>ne});n(67635);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(49019),l=n(35840),d=n(23867),c=n(97880),u=n(9291),p=n(91839),g=n(60682),m=n(57254),h=n(14976),S=n(98180),f=n(77080),v=n(84969),x=(n(21703),n(18466)),y=n(26263),k=n(46964),w=n(893),b=n(82530),C=n(15201),j=n(55217),A=n(77907),M=n(85893);function I(e){window.__c={n:"AssistantChatMessageRendererMarkdown"};const{clientStep:t}=e,n=(0,i.O7)(),{value:a}=(0,A.useDependency)(A.deps.markdownLinkifyIt),o=(0,s.useMemo)((()=>a?x.Z.withListenerIgnored((()=>function(e){const{environment:t,clientStep:n,markdownLinkifyIt:s}=e,i=new y.Z({name:"AssistantChatMessageListRenderer"});return b.createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStore",environment:t,canUndo:!1,perform:e=>{const a=function(e){const{environment:t,clientStep:n,transaction:s,markdownLinkifyIt:i}=e,a=new y.Z({name:"AssistantChatMessageRenderer",isSyntheticAssistantData:!0}),o=t.currentUser.id;if(!o)throw new Error("No current user.");const r=e=>{const s=w.Mt({environment:t,text:(0,k.rr)(n.text),transaction:e,inMemoryRecordCache:a,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:void 0});if(!s)return[];for(const t of s)a.setModelAndRole({pointer:t.pointer,userId:o},t.getModel(),"reader");return s};if(a.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),s)return r(s);return b.createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStore",environment:t,perform:r,canUndo:!1}).performResult}({environment:t,clientStep:n,transaction:e,markdownLinkifyIt:s});return w.Lh({environment:t,stores:a,inMemoryRecordCache:i,transaction:e})}}).performResult}({environment:n,clientStep:t,markdownLinkifyIt:a}))):void 0),[t,n,a]);return(0,M.jsx)(C.O,{displayName:"AssistantChatStepContent",disabled:!0,children:o?(0,M.jsx)(j.Z,{store:o,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0}):null})}var Z=n(61144),T=n(15145),F=n(88891),R=n(37167),P=n(72126),B=n(21202),_=n(82990),V=n(2456),K=n(40971),L=n(61519),W=n(84076),E=n(76798),O=n(11335),H=n(84210),N=n(80444),D=n(26136);function Q(e){window.__c={n:"AssistantTransactionRenderer"};const{clientStep:t}=e,n=(0,F.rn)(t.operations),i=(0,o.yK)((e=>({divider:{marginTop:6,marginBottom:6},subheader:{color:e.mediumTextColor}})),[]);return(0,M.jsx)(M.Fragment,{children:n.map(((e,t)=>(0,M.jsxs)(s.Fragment,{children:[(0,M.jsx)(z,{group:e},t),n[t+1]&&(0,M.jsx)(L.Z,{style:i.divider,size:1})]},t)))})}function z(e){window.__c={n:"AssistantTransactionGroupRenderer"};const{group:t}=e,n=(0,i.O7)(),s=(0,o.yK)((e=>({header:{marginTop:4,marginBottom:6,color:e.mediumTextColor},pageTitle:{display:"inline",color:e.regularTextColor,fontWeight:_.Z.fontWeight.semibold,whiteSpace:void 0,overflow:void 0,textOverflow:void 0,textDecoration:"underline"},divider:{marginBottom:6},subheader:{color:e.mediumTextColor,marginBottom:4}})),[]),r=(0,a.VK)((()=>N.default.state.mainEditorCurrentBlockStore),[]),l=(0,a.VK)((()=>N.default.state.currentSpaceStore),[]),d=r||l;if(!l)throw new Error("No current space store");if(!d)throw new Error("No parent store");const p=(null==r?void 0:r.id)!==t.pageId,g=l.id,m=D.G.createChildStore(d,{table:B.iU,id:t.pageId,spaceId:g}),h=(0,a.VK)((()=>{const{route:e}=n.RouterStore.state;return"chat"===e.name?(0,R.t)({blockId:m.id,pageVisitSource:T.tY.AIChat}):r&&m.id===r.id?(0,H.ZP)({store:r,pageVisitSource:T.tY.AIChat,fullyQualified:!1}):r?(0,H.ZP)({store:r,pageVisitSource:T.tY.AIChat,fullyQualified:!1,peekViewBlockId:m.id}):(0,H.ZP)({store:m,pageVisitSource:T.tY.AIChat,fullyQualified:!1})}),[r,m,n]),S=(0,a.VK)((()=>{if("updatedPage"!==t.type)return[];const e=m.getParentCollectionStore(),n=null==e?void 0:e.getSchema();return P.oA(Array.from(t.updatedPropertyNames).map((e=>{const t=Object.entries(n||{}).find((t=>{let[,n]=t;return(null==n?void 0:n.name)===e}));if(t)return t[0]})))}),[m,t]);if("updatedPage"===t.type){const{insertedBlockIds:e,updatedBlockIds:n,removedBlockIds:i,updatedTitle:a,updatedPropertyNames:o}=t,r=e.size+n.size+i.size+(a?1:0)+o.size;return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(W.Z,{style:s.header,href:h,children:(0,M.jsx)("span",{children:t.didCreatePage?(0,M.jsx)(u.FormattedMessage,{defaultMessage:"Created {page}",id:"assistant.transactionRenderer.createdPage.title",values:{page:(0,M.jsx)(E.Z,{store:m,style:s.pageTitle})}}):(0,M.jsx)(u.FormattedMessage,{defaultMessage:"{numEdits, plural, one {1 edit to {page}} other {{numEdits} edits to {page}}}",id:"assistant.transactionRenderer.editedPage.title",values:{numEdits:r,page:(0,M.jsx)(E.Z,{store:m,style:s.pageTitle})}})})}),a&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{style:s.subheader,children:"Updated title"}),p&&(0,M.jsx)(U,{spaceId:g,blockIds:[t.pageId],parentStore:d})]}),S.length>0&&(0,M.jsxs)(M.Fragment,{children:[`Updated ${S.length} ${S.length>1?"properties":"property"}`,p&&S.map(((e,t)=>(0,M.jsx)(q,{pageStore:m,property:e},t)))]}),e.size>0&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{style:s.subheader,children:`Inserted ${e.size} block${e.size>1?"s":""}`}),p&&(0,M.jsx)(U,{spaceId:g,blockIds:Array.from(e),parentStore:d})]}),n.size>0&&(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{style:s.subheader,children:[`Updated ${n.size} block${n.size>1?"s":""}`,p&&(0,M.jsx)(U,{spaceId:g,blockIds:Array.from(n),parentStore:d})]})}),i.size>0&&(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{style:s.subheader,children:[`Removed ${i.size} block${i.size>1?"s":""}`,p&&(0,M.jsx)(U,{spaceId:g,blockIds:Array.from(i),parentStore:d})]})})]})}if("removedPage"===t.type)return(0,M.jsx)(W.Z,{style:s.header,href:h,children:(0,M.jsx)("span",{children:(0,M.jsx)(u.FormattedMessage,{defaultMessage:"Deleted {page}",id:"assistant.transactionRenderer.removedPage.title",values:{page:(0,M.jsx)("span",{style:{fontWeight:_.Z.fontWeight.bold},children:(0,M.jsx)(E.Z,{store:m,style:s.pageTitle})})}})})});(0,c.t1)(t)}function q(e){window.__c={n:"BlockPropertyRenderer"};const{pageStore:t,property:n}=e,s=(0,a.VK)((()=>t.getParentCollectionStore()),[t]),i=(0,a.VK)((()=>{const e=null==s?void 0:s.getSchema(),t=Object.entries(e||{}).find((e=>{let[t]=e;return t===n}));return null==t?void 0:t[1]}),[s,n]),o=(0,a.VK)((()=>t.getPropertyValue(n)),[t,n]),r=(0,a.VK)((()=>null==s?void 0:s.getSpaceId()),[s]);return s&&i&&r?(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(V.Hq,{labeled:!0,name:i.name,type:i.type,icon:i.icon,style:{marginBottom:6},children:(0,M.jsx)(O.Z,{propertySchema:i,beforeValue:{value:[],spaceId:r},afterValue:{value:o||[],spaceId:r},rootStore:t})})}):null}function U(e){window.__c={n:"BlockListRenderer"};const{blockIds:t,parentStore:n,spaceId:i}=e,a=P.d9(t).reverse(),o=(0,s.useMemo)((()=>x.Z.withListenerIgnored((()=>a.map((e=>D.G.createChildStore(n,{table:B.iU,id:e,spaceId:i})))))),[a,n,i]);return(0,M.jsx)(C.O,{displayName:"AssistantBlockRenderer",disabled:!0,children:o.map(((e,t)=>(0,M.jsx)($,{store:e},t)))})}function $(e){window.__c={n:"BlockRenderer"};const{store:t}=e,n=(0,a.VK)((()=>(0,K.h)(t)),[t]);return n?(0,M.jsx)(n,{store:t,disabled:!0,isFirstItem:!1,isLastItem:!1}):null}var G=n(65422),Y=n(3124),J=n(54851),X=n(28495),ee=n(11751);function te(e){var t;window.__c={n:"AssistantWorkflowRenderer"};const{clientStep:n}=e,s=(0,o.yK)((e=>({header:{display:"flex",alignItems:"center",marginTop:4,marginBottom:4,color:e.aiPurpleColor},headerIcon:{width:10,fill:e.aiPurpleColor,marginRight:4},name:{display:"flex",alignItems:"center",fontWeight:500,marginBottom:4},description:{display:"flex",alignItems:"center",marginBottom:8},triggersHeader:{display:"flex",alignItems:"center",marginBottom:4,color:e.mediumTextColor},trigger:{display:"flex",alignItems:"center",marginBottom:4,background:"rgba(0,0,0,0.03)",padding:4,borderRadius:8},stepsHeader:{display:"flex",alignItems:"center",marginBottom:4,color:e.mediumTextColor},step:{display:"flex",alignItems:"center",marginBottom:4,background:"rgba(0,0,0,0.03)",padding:4,borderRadius:8},pageUpdatedTriggerIcon:{width:14,marginRight:6,marginLeft:4},codeStepIcon:{width:14,marginRight:6,marginLeft:4},aiStepIcon:{width:14,marginRight:6,marginLeft:4},humanStepIcon:{width:14,marginRight:6,marginLeft:4}})),[]);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)("div",{style:s.header,children:[(0,G.K)(s.headerIcon),(0,M.jsx)(u.FormattedMessage,{id:"AssistantWorkflowRenderer.header",defaultMessage:"Workflow"})]}),(0,M.jsx)("div",{style:s.name,children:n.workflowSettings.name}),(0,M.jsx)("div",{style:s.description,children:n.workflowSettings.description}),n.workflowSettings.triggers&&n.workflowSettings.triggers.length>0&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{style:s.triggersHeader,children:(0,M.jsx)(u.FormattedMessage,{id:"AssistantWorkflowRenderer.triggersHeader",defaultMessage:"Triggers"})}),n.workflowSettings.triggers.map(((e,t)=>{if("page-updated"===e.type)return(0,M.jsxs)("div",{style:s.trigger,children:[(0,J.S)(s.pageUpdatedTriggerIcon),(0,M.jsx)(u.FormattedMessage,{id:"AssistantWorkflowRenderer.pageUpdatedTrigger",defaultMessage:"When the page is updated"})]},t);(0,c.t1)(e.type)}))]}),(0,M.jsx)("div",{style:s.stepsHeader,children:(0,M.jsx)(u.FormattedMessage,{id:"AssistantWorkflowRenderer.stepsHeader",defaultMessage:"Steps"})}),null===(t=n.workflowSettings.steps)||void 0===t?void 0:t.map(((e,t)=>"assistant-code"===e.type?(0,M.jsxs)("div",{style:s.step,children:[(0,Y._)(s.codeStepIcon),e.description]},t):"assistant-prompt"===e.type?(0,M.jsxs)("div",{style:s.step,children:[(0,ee.t)(s.aiStepIcon),e.description]},t):"human"===e.type?(0,M.jsxs)("div",{style:s.step,children:[(0,X.v)(s.humanStepIcon),e.description]},t):void(0,c.t1)(e)))]})}function ne(e){window.__c={n:"AssistantChatStep"};const{clientStep:t,parentStore:n,parentSpaceId:s,fakeSlackUser:x,configurationState:y,isQuickSearchMode:k,renderAsFullPage:w,latestStepCitationHoverStore:b}=e,C=(0,i.O7)(),j=(0,o.Fg)(),A=(0,a.VK)((()=>{const e=S.Z.getActiveAssistantRuntimeStore(),t=(null==e?void 0:e.getCombinedSteps())??[],n=t.findLast((e=>"human"===e.type));if(!n)return;const s=t.indexOf(n);return t.slice(s-1).find((e=>"assistantSearch"===e.type||"assistantLoadPage"===e.type))}),[]),T=(0,a.VK)((()=>{var e;return(null===(e=S.Z.getActiveAssistantRuntimeStore())||void 0===e||null===(e=e.state)||void 0===e?void 0:e.isAiProviderDown)??!1}),[]),F=(0,a.VK)((()=>f.default.getConfigKey("assistant_error_message_override","message")),[]),{isCurrentClientStepLatestStep:R,priorSearchResultsStep:P}=(0,a.VK)((()=>{const e=S.Z.getActiveAssistantRuntimeState(),n=[...(null==e?void 0:e.clientSteps)??[],...(null==e?void 0:e.temporaryClientSteps)??[]],s=n.indexOf(t),i=s-1>=0?n[s-1]:void 0;return{isCurrentClientStepLatestStep:s>=0&&s===n.length-1,priorSearchResultsStep:"assistantShowSearchResults"===(null==i?void 0:i.type)?i:void 0}}),[t]),B=(0,a.VK)((()=>"human"===t.type?{element:(0,M.jsx)("div",{style:{wordBreak:"break-word"},children:(0,h.IY)({environment:C,textValue:{value:t.text,spaceId:(0,d.C)(s)},parentStore:n,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:j,emojiType:(0,g.e_)(C),katex:C.KatexStore.getKatex(),formulaValueTypes:[]})})}:"assistantLoading"===t.type?{element:(0,M.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:["assistantSearch"===(null==A?void 0:A.type)?(0,M.jsx)(u.FormattedMessage,{id:"AssistantChatStep.searching",defaultMessage:"Searching {icon} {keywords}",description:"Placeholder text while the AI is searching. The icon is a magnifying glass.",values:{icon:(0,l.R)({width:12,height:12}),keywords:(0,M.jsx)("span",{style:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",maxWidth:"70%",textTransform:"lowercase",whiteSpace:"nowrap"},children:A.keywords})},children:function(e){return(0,M.jsx)(M.Fragment,{children:e.map(((e,t)=>"string"==typeof e?(0,M.jsx)("span",{children:e},t):e))})}}):"assistantLoadPage"===(null==A?void 0:A.type)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.FormattedMessage,{id:"AssistantChatStep.loadingPage",defaultMessage:"Reading page"})," "]}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.FormattedMessage,{id:"AssistantChatStep.thinking",defaultMessage:"Thinking"})," "]}),(0,M.jsx)("div",{style:{marginLeft:4},children:(0,M.jsx)(p.Z,{isTriColored:!0})})]})}:"assistantThink"===t.type?{element:(0,M.jsx)(M.Fragment,{children:`💡 ${t.thought}`})}:"assistantChatText"===t.type?(0,m.S)(t)?{element:null,doNotWrap:!0}:{element:(0,M.jsx)(I,{clientStep:t})}:"assistantChat"===t.type?(0,m.S)(t)?{element:null,doNotWrap:!0}:{element:(0,M.jsx)(v.m,{clientStep:t,parentStore:n,configurationState:y,fakeSlackUser:x,isLatestStep:R,isQuickSearchMode:k,renderAsFullPage:w,priorSearchResultsStep:P,citationHoverStore:R?b:void 0}),doNotWrap:!0}:"assistantTransaction"===t.type?{element:(0,M.jsx)(Q,{clientStep:t})}:"assistantLoadPage"===t.type?{element:(0,M.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(u.FormattedMessage,{id:"AssistantChatStep.loadPage",defaultMessage:"Reading pages"}),(0,M.jsx)("div",{style:{marginLeft:6},children:(0,M.jsx)(p.Z,{})})]})}:"assistantFriendlyError"===t.type?{element:(0,M.jsx)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",padding:"8px 4px"},children:F||(T?"I'm sorry! We’re experiencing issues with our AI provider. Try again in a few minutes.":"I'm sorry! I wasn't able to complete this query. Please try asking me a different question.")})}:"assistantSearch"===t.type?{element:(0,M.jsxs)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap"},children:[(0,r.e)({width:14,marginRight:4}),(0,M.jsx)(u.FormattedMessage,{id:"AssistantChatStep.search",defaultMessage:"Search {text}",values:{text:(0,M.jsx)("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.question})}})]})}:"assistantSearchPeople"===t.type?{element:(0,M.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(u.FormattedMessage,{id:"AssistantChatStep.searchPeople",defaultMessage:"Looking up people"}),(0,M.jsx)("div",{style:{marginLeft:6},children:(0,M.jsx)(p.Z,{})})]})}:"queryDatabase"===t.type?{element:(0,M.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(u.FormattedMessage,{id:"AssistantChatStep.queryDatabase",defaultMessage:"Querying databases"}),(0,M.jsx)("div",{style:{marginLeft:6},children:(0,M.jsx)(p.Z,{})})]})}:"assistantShowSearchResults"===t.type?{element:null,doNotWrap:!0}:"assistantLimitReached"===t.type?{element:(0,M.jsx)(M.Fragment,{children:t.message})}:"assistantCreateWorkflow"===t.type?{element:(0,M.jsx)(te,{clientStep:t})}:void(0,c.t1)(t)),[t,C,s,n,j,y,x,R,k,w,P,b,A,T,F]);return B.doNotWrap?B.element:(0,M.jsx)(Z.J,{clientStep:t,configurationState:y,fakeSlackUser:x,forceShowFeedback:R,children:B.element})}},61144:(e,t,n)=>{n.d(t,{J:()=>g,O:()=>p});var s=n(67294),i=n(480),a=n(6740),o=n(24405),r=n(72126),l=n(26388),d=(n(95477),n(82375)),c=n(33871),u=n(85893);const p="min(calc(100% - 48px), 512px)",g=(0,s.forwardRef)((function(e,t){window.__c={n:"AssistantChatStepWrapper"};const{children:n,clientStep:g,configurationState:m,fakeSlackUser:h,forceShowFeedback:S}=e,f=(0,i.O7)(),v=f.device.isMobile,x=(0,o.yK)((e=>({wrap:{display:"flex",marginTop:6,marginBottom:6,gap:6},baseMessage:{maxWidth:p,borderRadius:16,padding:"4px 12px",fontSize:v?15:14,whiteSpace:"pre-wrap",overflowWrap:"break-word",position:"relative",lineHeight:1.45},userLabel:{fontSize:12,color:e.mediumTextColor},humanMessage:{backgroundColor:"light"===e.mode?e.cardHoveredBackground:e.accentColors.translucentGray[100],color:e.darkTextColor,padding:"6px 14px",border:"unset"},assistantThinkMessage:{backgroundColor:e.accentColors.gray[50],color:e.mediumTextColor},assistantLoadingMessage:{fontSize:12,color:e.lightTextColor,fontWeight:500,padding:"4px 0 0 6px"},assistantShowSearchResultsMessage:{color:e.mediumTextColor,border:`1px solid ${"light"===e.mode?e.accentColors.gray[75]:e.accentColors.translucentGray[200]}`},assistantMessage:{border:`1px solid ${"light"===e.mode?e.accentColors.gray[75]:e.accentColors.translucentGray[200]}`,backgroundColor:"light"===e.mode?e.contentBackground:e.accentColors.translucentGray[200],color:e.regularTextColor,padding:"2px 10px",boxShadow:"0px 2px 4px 0px rgba(0, 0, 0, 0.04), 0px 0px 6px 0px rgba(0, 0, 0, 0.02)"}})),[v]),[y,k]=(0,s.useState)(!1),w=(0,s.useMemo)((()=>(0,r.Ds)(k,100)),[k]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(l.ZP,{placement:l.ug.Left,textWrap:!0,style:{maxWidth:240},disableTooltip:!("thought"in g&&g.thought,0),renderTooltip:()=>"thought"in g?`💡 ${g.thought}`:void 0,delayThreshold:500,render:e=>(0,u.jsxs)("div",{ref:t,style:x.wrap,...e,onFocus:t=>{var n;null===(n=e.onFocus)||void 0===n||n.call(e,t),(0,a.E)(t.target)&&w(!0)},onMouseEnter:t=>{var n;null===(n=e.onMouseEnter)||void 0===n||n.call(e,t),w(!0)},onBlur:t=>{var n;null===(n=e.onBlur)||void 0===n||n.call(e,t),w(!1)},onMouseLeave:t=>{var n;null===(n=e.onMouseLeave)||void 0===n||n.call(e,t),w(!1)},children:["human"===g.type&&(0,u.jsx)("div",{style:{flexGrow:1}}),(0,u.jsx)("div",{style:{...x.baseMessage,..."human"===g.type?x.humanMessage:"assistantThink"===g.type||"assistantLoading"===g.type?x.assistantLoadingMessage:"assistantShowSearchResults"===g.type?x.assistantShowSearchResultsMessage:x.assistantMessage},children:n}),"assistantChat"===g.type&&(0,d.Of)(g)&&(0,u.jsx)(c.x,{configurationState:m,environment:f,isVisible:y||S,clientAssistantChatStep:g})]})}),h&&"human"===g.type&&(0,u.jsxs)("div",{style:{display:"flex"},children:[(0,u.jsx)("div",{style:{flexGrow:1}}),(0,u.jsx)("div",{style:x.userLabel,children:h.name})]})]})}))},49053:(e,t,n)=>{n.d(t,{v:()=>l});n(67294);var s=n(480),i=n(24405),a=n(9291),o=n(89728),r=n(85893);function l(e){window.__c={n:"AssistantClearButton"};const{disabled:t,onClick:n,style:l}=e,{isMobile:d}=(0,s.Fy)(),c=(0,i.yK)((e=>({button:{color:t?e.lightTextColor:e.mediumIconColor,opacity:t?.5:1,height:24,paddingLeft:6,paddingRight:6,fontSize:d?15:13,...l}})),[t,l,d]);return(0,r.jsx)(o.Z,{style:c.button,onClick:n,disabled:t,isSmall:!0,children:(0,r.jsx)(a.FormattedMessage,{id:"searchAssistantPane.header.clear.label",defaultMessage:"Clear"})})}},33871:(e,t,n)=>{n.d(t,{x:()=>K});var s=n(67294),i=n(86628),a=n(24405),o=n(33676),r=n(97022),l=n(39986),d=n(10498),c=n(24677),u=n(23063),p=n(73063),g=n(21273),m=n(49085);class h extends m.default{getInitialState(){return{}}}const S=new h;var f=n(98180);class v extends m.default{getInitialState(){return{open:!1,inferenceId:void 0}}}const x=new v;var y=n(26382),k=n(480),w=n(82990),b=n(9291),C=n(54642),j=n(42922),A=n(36488),M=n(74194),I=n(63296),Z=n(53336),T=n(92660),F=(n(95477),n(34859)),R=n(80444),P=n(69454),B=n(85893);function _(){window.__c={n:"ReportBadQnAForm"};const{isMobile:e}=(0,k.Fy)(),t=(0,a.yK)((t=>({wrap:{display:"flex",flexDirection:"column",width:e?"min(100%, 600px)":void 0,minHeight:128,maxHeight:e?void 0:"max(calc(100vh - 78px), 300px)"},modalWrap:{width:"32rem",padding:24,fontSize:14,maxWidth:"100%"},modalTitle:{fontSize:16,fontWeight:w.Z.fontWeight.medium},modalWarning:{fontSize:13,color:t.lightTextColor},titleContainer:{marginBottom:12},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18,gap:8},scroller:{flexGrow:1,display:"flex",flexDirection:"column",WebkitMaskImage:"linear-gradient(black calc(100% - 12px), transparent)"}})),[e]),n=(0,b.useIntl)(),[o,r]=(0,s.useState)(),l=(0,i.VK)((()=>R.default.state.currentSpaceStore),[]),d=(0,k.O7)(),c=(0,s.useCallback)((()=>{const{inferenceId:e}=x.state,t=null==l?void 0:l.id;e&&t&&(C.saveAssistantFeedback(d,{type:"slackbot_followup_feedback",id:e,notes:o||""}),x.reset())}),[null==l?void 0:l.id,d,o]),u=(0,s.useRef)(void 0);return(0,B.jsx)(T.Z,{onDismiss:V,style:e?{maxHeight:"100%",display:"flex"}:{},render:()=>(0,B.jsx)(A.Z,{allowMobileAutoScroll:!0,capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:s=>(0,B.jsx)("div",{style:t.wrap,children:(0,B.jsx)(Z.Z,{ref:u,type:F.Z.Y,style:t.scroller,...s,children:(0,B.jsxs)("div",{style:t.modalWrap,...s,children:[(0,B.jsxs)("div",{style:t.titleContainer,children:[(0,B.jsx)("div",{style:t.modalTitle,children:(0,B.jsx)(b.FormattedMessage,{id:"BadQnAFeedbackForm.title",defaultMessage:"Give additional feedback on this answer"})}),(0,B.jsx)("div",{style:t.modalWarning,children:(0,B.jsx)(b.FormattedMessage,{id:"BadQnAFeedbackForm.warning",defaultMessage:"Chat and search results will be sent to Notion for quality improvement"})})]}),(0,B.jsx)(M.Z,{placeholder:n.formatMessage({id:"BadQnAFeedbackForm.additionalCommentsPlaceholder",defaultMessage:"Add feedback..."}),value:o,onChange:e=>r(e.target.value),focusInitial:!e,onFocus:()=>{e&&P.Z.onShow((()=>{var e;null===(e=u.current)||void 0===e||e.scrollToBottom()}))},inputStyle:{padding:8}}),(0,B.jsxs)("div",{style:t.buttonArea,children:[(0,B.jsx)(I.Z,{onClick:V,children:(0,B.jsx)(b.FormattedMessage,{id:"BadQnAFeedbackForm.cancelButton.label",defaultMessage:"Cancel"})}),(0,B.jsx)(j.Z,{isLarge:!0,onClick:c,children:(0,B.jsx)(b.FormattedMessage,{id:"BadQnAFeedbackForm.reportButton.label",defaultMessage:"Send"})})]})]})})})}),requireOnline:!0,modalStore:x})}function V(){x.update((()=>({open:!1,inferenceId:void 0})))}function K(e){let{configurationState:t,environment:n,isVisible:p,clientAssistantChatStep:m,style:h}=e;window.__c={n:"AssistantFeedbackButtons"};const{inferenceId:v}=m,k=(0,i.VK)((()=>S.state[v]??void 0),[v]),w=(0,a.yK)((e=>({thumbsUpFeedbackButton:{width:14,height:14,fill:"thumbs_up"===k?e.blueButtonBackground:e.grayButtonHoveredBackground},thumbsDownFeedbackButton:{width:14,height:14,fill:"thumbs_down"===k?e.blueButtonBackground:e.grayButtonHoveredBackground}})),[k]),b=(0,i.VK)((()=>g.Z.isAssistantExperienceQna()),[]),C=(0,s.useCallback)((()=>{const e=f.Z.getActiveSessionId();e&&(y.assistantActions.saveFeedback({environment:n,inferenceId:v,type:"assistant_thumbs_up",sessionId:e}),S.update((e=>({...e,[v]:"thumbs_up"}))))}),[n,v]),j=(0,s.useCallback)((()=>{c.ZH({device:n.device});const e=f.Z.getActiveSessionId();e&&(y.assistantActions.saveFeedback({environment:n,inferenceId:v,type:"assistant_thumbs_down",sessionId:e}),S.update((e=>({...e,[v]:"thumbs_down"}))),x.update((()=>({open:!0,inferenceId:v}))))}),[n,v]);return(0,B.jsx)(u.Z,{isVisible:!0,animationStyle:{opacity:p||Boolean(k)?1:0},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:1},render:()=>(0,B.jsxs)("div",{style:{marginTop:"auto",display:"flex",...h},children:[(0,B.jsx)(L,{type:"up",iconHollow:l.P,iconFilled:d.w,onClick:C,style:w.thumbsUpFeedbackButton,feedbackReceived:k}),(0,B.jsx)(L,{type:"down",iconHollow:o.A,iconFilled:r.E,onClick:j,style:w.thumbsDownFeedbackButton,feedbackReceived:k}),b?(0,B.jsx)(_,{}):null]})})}function L(e){let{type:t,iconHollow:n,iconFilled:s,feedbackReceived:i,style:a,onClick:o}=e;const r=i===`thumbs_${t}`;return(0,B.jsx)(p.Z,{icon:r?s:n,onClick:r?()=>{}:o,disableBackground:r,iconStyle:{cursor:r?"initial":"pointer",...a},ariaLabel:`Thumbs ${t} feedback on assistant message`})}},85075:(e,t,n)=>{n.d(t,{Q:()=>de,G:()=>le});n(21703);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(59054),l=n(37652),d=n(1464),c=n(64275),u=n(56666),p=n(88437),g=n(82990),m=n(9291),h=n(25888),S=n(4653),f=n(19471),v=(n(57658),n(82801),n(13991)),x=n(7057),y=n(80721),k=n(5257),w=n(97880),b=n(87279),C=n(98180),j=n(52275),A=n(73063),M=n(78140),I=n(32163),Z=n(72495),T=n(85893);function F(e){window.__c={n:"AssistantDebugPopupMenu"};const{buttonPopupParent:t}=e,n=(0,m.useIntl)(),[i,o]=(0,s.useState)(void 0),r=(0,a.VK)((()=>function(e){const t=[];for(const[i,a]of(0,w.qP)(C.Z.state.sessions)){var n,s;const o=null==a||null===(n=a.assistantConfigurationStore.state)||void 0===n?void 0:n.startTimestamp;t.push({sessionId:i.toString(),skillType:(null==a||null===(s=a.assistantRuntimeStore.state)||void 0===s||null===(s=s.selectedSkill)||void 0===s?void 0:s.skillType)??"general_assistant",timestamp:void 0!==o?(0,x.$b)(o,v.SP,e):void 0})}return t}(n)),[n]),l=(0,s.useCallback)((()=>{const e=R(null==i?void 0:i.sessionId),t=(null==e?void 0:e.getTranscript())??[],n=P(null==i?void 0:i.sessionId);n&&t.push(n);const s=JSON.stringify(t);navigator.clipboard.writeText(s)}),[i]),d=(0,s.useCallback)((()=>{const e=R(null==i?void 0:i.sessionId),t=P(null==i?void 0:i.sessionId),n=null==e?void 0:e.getInferenceInputForEval({skipLastAssistantStep:!0,appendPreviewingStepForDebug:t}),s=JSON.stringify(n);navigator.clipboard.writeText(s)}),[i]),c=(0,s.useCallback)((()=>{const e=R(null==i?void 0:i.sessionId),t=P(null==i?void 0:i.sessionId),n=null==e?void 0:e.getInferenceInputForEval({skipLastAssistantStep:!0,appendPreviewingStepForDebug:t}),s=JSON.stringify(n),a=btoa(encodeURIComponent(s));window.open(`/design/aiJsonRenderer#jsonl=${a}`,"_blank")}),[i]),u={key:"debug-data",render:e=>(0,T.jsx)(Z.Z,{...e,desktopTitleStyle:{alignItems:"center",paddingLeft:2,marginTop:0},title:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(A.Z,{icon:y.W,ariaLabel:"debug-menu-back-button",onClick:()=>o(void 0),iconStyle:{width:12,height:12}}),null==i?void 0:i.skillType]}),right:null==i?void 0:i.timestamp}),items:[{key:"copy-transcript",render:e=>(0,T.jsx)(j.Z,{...e,title:"Copy transcript"}),action:()=>{l(),t.close()}},{key:"copy-eval",render:e=>(0,T.jsx)(j.Z,{...e,title:"Copy as AssistantInferenceInput"}),action:()=>{d(),t.close()}},{key:"open-in-jsonl-viewer",render:e=>(0,T.jsx)(j.Z,{...e,title:"Open in JSONL viewer"}),action:()=>{c(),t.close()}}]},p=r.map((e=>{let{sessionId:t,skillType:n,timestamp:s}=e;return{key:t,action:()=>{o({sessionId:t,skillType:n,timestamp:s})},render:e=>(0,T.jsx)(j.Z,{...e,title:n,right:(0,T.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[s,(0,k.o)({marginLeft:4,width:12})]})})}})),g={key:"sessions",render:e=>(0,T.jsx)(Z.Z,{...e}),items:p},h={key:"empty",render:e=>(0,T.jsx)(Z.Z,{...e}),items:[{key:"empty-item",action:()=>{},render:e=>(0,T.jsx)(j.Z,{...e,title:"No sessions found"})}]},S=i?u:p.length>0?g:h;return(0,T.jsx)(M.Z,{menuType:b.og.Popup,width:300,children:(0,T.jsx)(I.Z,{type:I.i.Vertical,initialFocus:0,sections:[S]})})}function R(e){var t;if(e)return null===(t=C.Z.getSessionContext(e))||void 0===t||null===(t=t.assistantRuntimeStore)||void 0===t||null===(t=t.state)||void 0===t?void 0:t.evaluator}function P(e){var t;if(!e)return;const n=C.Z.getSessionContextOrThrow(e),{assistantRuntimeStore:s}=n;return null==s||null===(t=s.state)||void 0===t?void 0:t.previewingStep}var B=n(78990),_=n(23063),V=n(31945),K=n(88359),L=n(89728),W=n(14871),E=n(26388),O=n(19124),H=n(77907),N=n(80444),D=n(21273),Q=n(82375),z=n(61766),q=n(58016),U=n(28344),$=n(33932),G=n(70771),Y=n(56206),J=n(40824),X=n(23388),ee=n(17456),te=n(49053),ne=n(80594),se=n(14309),ie=n(42853),ae=n(27967),oe=n(5175);function re(e){window.__c={n:"AssistantSkillSwitcherButton"};const{store:t}=e,n=(0,a.VK)((()=>t.state),[t]),i=(0,o.yK)((e=>({skillIcon:{fill:e.aiPurpleColor},chevronDown:{fill:e.mediumIconColor,width:12,marginLeft:4}})),[]),r=(0,s.useCallback)((()=>{(0,$.navigateToView)({view:"skillSwitcher"})}),[]);if(null==n||!n.selectedSkill)return null;const{selectedSkill:l}=n;return(0,T.jsxs)(L.Z,{onClick:r,icon:ae.skillIconMap[l.skillType],iconStyle:i.skillIcon,children:[(0,T.jsx)(oe.Z,{clientSkill:l}),(0,ie.i)(i.chevronDown)]})}const le=new z.Z;function de(e){var t;window.__c={n:"AssistantMenu"};const{renderAsFullPage:n,showBackButton:v,onClose:x}=e,y=(0,i.O7)(),k=(0,a.VK)((()=>D.Z.isChatHistoryEnabled()),[]),w=(0,a.VK)((()=>{var e;return null===(e=C.Z.getActiveAssistantConfigurationStore())||void 0===e?void 0:e.hasLockAction()}),[]),b=(0,a.VK)((()=>C.Z.getActiveAssistantRuntimeStore()),[]),M=(0,a.VK)((()=>C.Z.getActiveAssistantRuntimeState()),[]),I=(0,a.VK)((()=>D.Z.isXMLAssistantEnabled(null==M?void 0:M.selectedSkill)),[M]),Z=(0,s.useCallback)((()=>{D.Z.isAssistantExperienceQna()&&U.trackQnaClear(y,C.Z.getActiveAssistantConfigurationState(),C.Z.getActiveAssistantRuntimeState()),(0,q.clearActiveAssistantSession)({environment:y})}),[y]),R=(0,a.VK)((()=>{const e=C.Z.getActiveAssistantRuntimeState();return!e||!C.Z.getActiveAssistantConfigurationState()||!e.selectedSkill&&0===e.clientSteps.length&&0===e.temporaryClientSteps.length}),[]),P=(0,a.VK)((()=>{var e;return null===(e=N.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),z=(0,a.VK)((()=>(0,O.Gw)()),[]),ie=(0,a.VK)((()=>Y.d.state.currentView),[]),ae=(0,a.VK)((()=>Q.Pl.state),[]),oe=Boolean(ae),de=(0,a.VK)((()=>D.Z.shouldShowDebugHelpers()),[]);(0,r.r5)((async()=>{P&&await(0,G.K7)({environment:y,spaceId:P})}),[y,P]);const[ce,ue]=(0,s.useState)([]),pe=(0,H.useDependency)(H.deps.searchActions);(0,s.useEffect)((()=>{if(!oe)return;if("resolved"!==pe.status)return;pe.value.searchVisibleSpaceUsers({environment:y,query:"",membersOnly:!1}).then((e=>ue(e))).catch((e=>{throw new Error(e)}))}),[y,oe,pe]);const ge=(0,s.useCallback)((()=>{$.navigateToView({view:"chat"})}),[]),me=(0,s.useCallback)((()=>{J.N.setAssistantLastViewedTime(),null==x||x();const e=D.Z.isAssistantExperienceQna(),t=C.Z.getActiveAssistantConfigurationState();t&&e&&U.trackQnaClosed(y,{configurationState:t,runtimeState:C.Z.getActiveAssistantRuntimeState(),from:"button"})}),[y,x]),he=(0,s.useCallback)((()=>{C.Z.endCurrentSession(),oe?Q.Pl.setState(void 0):Q.Pl.setState({enabled:!0,selectedFakeUser:void 0,selectedFakeChannel:"#"})}),[oe]),Se=(0,s.useCallback)((()=>{const e=C.Z.getActiveAssistantConfigurationState();e&&h.Ar(y,{qnaSessionId:e.sessionId,from:"qna_modal_menu"}),S.i(y)}),[y]),fe=(0,s.useCallback)((()=>{$.closeAssistantRightHandSideMenu()}),[]),ve=function(e){const{hasLockAction:t,renderAsFullPage:n}=e,{device:s}=(0,i.O7)(),{isMobile:a}=s;return(0,o.yK)((e=>({wrap:{display:"flex",flexDirection:"column",width:n?"min(100%, 640px)":375,transition:"height 200ms ease",minHeight:128,height:n?"100%":void 0,maxHeight:n?void 0:"max(calc(100vh - 78px), 300px)"},header:{display:"flex",alignItems:"center",pointerEvents:"auto",paddingTop:12,paddingLeft:16,paddingRight:16,paddingBottom:12},labeledInput:{display:"flex",gap:8,alignItems:"center"},clearButton:{color:t?e.lightTextColor:e.mediumIconColor,opacity:t?.5:1},headerButton:{color:e.mediumIconColor},closeButton:{borderRadius:"100%",marginLeft:4,width:22,height:22},backwardButton:{borderRadius:"100%",marginRight:6},input:{width:void 0,marginLeft:8,marginRight:8},inputLabel:{fontSize:a?16:14,color:e.mediumTextColor},faceImgWrap:{width:64,height:64,borderRadius:"100%",background:"white",boxShadow:e.largeLightBoxShadow,overflow:"hidden"},faceImg:{width:64,pointerEvents:"none"},emptyStateText:{marginTop:28,fontSize:16,color:e.regularTextColor,fontFamily:g.Z.baseFontFamily.serif},inputWrap:{paddingTop:8,paddingBottom:8},skillsCaption:{fontSize:a?14:12,color:e.mediumTextColor,marginBottom:8},skillIcon:{fill:e.aiPurpleColor},skillsWrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8},rightButtons:{display:"flex",alignItems:"center",gap:6},headerContentLeftOfClose:{display:"flex",marginRight:"8px",flexGrow:1,alignItems:"center"}})),[t,n,a])}({hasLockAction:w,renderAsFullPage:n});return(0,T.jsxs)("div",{style:ve.wrap,children:[(0,T.jsxs)("div",{style:ve.header,children:[(0,T.jsxs)("div",{style:ve.headerContentLeftOfClose,children:["chat"===ie&&k?(0,T.jsx)(A.Z,{iconStyle:{width:16,height:16},style:ve.backwardButton,icon:l.V,onClick:()=>{Y.d.setState({...Y.d.state,currentView:"chatHistory"})},disableBackground:!0,isDarkIconColor:!0,ariaLabel:"close"}):v&&(0,T.jsx)(A.Z,{iconStyle:{width:32,height:32},style:ve.backwardButton,icon:d.k,onClick:me,disableBackground:!0,isDarkIconColor:!0,ariaLabel:"close"}),"chatHistory"===ie&&(0,T.jsx)("div",{style:{fontSize:14,fontWeight:g.Z.fontWeight.medium,display:"flex",alignItems:"center",paddingLeft:3},children:(0,T.jsx)(m.FormattedMessage,{id:"assistantMenu.header.askNotionAI.header",defaultMessage:"All chats"})}),"chat"===ie&&(0,T.jsxs)(T.Fragment,{children:[M&&b&&I&&(0,T.jsx)(re,{store:b}),I&&"persisted"===(null==M||null===(t=M.selectedSkill)||void 0===t?void 0:t.type)&&(0,T.jsx)(ne.Z,{clientSkill:M.selectedSkill,renderOrigin:e=>(0,T.jsx)(L.Z,{...e,style:ve.headerButton,children:(0,T.jsx)(m.FormattedMessage,{id:"assistantMenu.skillEdit.label",defaultMessage:"Edit"})})}),(0,T.jsx)(B.Z,{}),(0,T.jsx)("div",{style:{flexGrow:1}}),z&&(0,T.jsx)(L.Z,{style:ve.headerButton,onClick:he,children:oe?"Disable Slack mode":"Enable Slack mode"})]}),"skillSwitcher"===ie&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(A.Z,{icon:l.V,onClick:ge,ariaLabel:"back"}),(0,T.jsx)("div",{style:{marginLeft:4,fontSize:14},children:"All skills"}),(0,T.jsx)("div",{style:{flexGrow:1}})]}),(0,T.jsxs)("div",{style:ve.rightButtons,children:[(0,T.jsx)(_.Z,{enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},animationStyle:{opacity:1},render:()=>(0,T.jsx)(te.v,{onClick:Z,disabled:R}),isVisible:!R&&"chatHistory"!==ie}),de&&(0,T.jsx)(V.ZP,{popupType:y.device.isMobile?V.Z4.SlideUp:V.Z4.Popup,renderOrigin:e=>(0,T.jsx)(E.ZP,{render:t=>(0,T.jsx)(A.Z,{iconStyle:{width:18,height:18},icon:p.a,ariaLabel:"See debug data",...t,...e}),renderTooltip:()=>(0,T.jsx)(m.FormattedMessage,{id:"assistant.copyTranscript",defaultMessage:"Debug data [dev]"})}),render:e=>(0,T.jsx)(F,{buttonPopupParent:e})}),"chat"===ie&&!y.device.isMobileNative&&(0,T.jsx)(V.ZP,{buttonPopupStore:le,alignmentToOrigin:V.vR.Start,placementToOrigin:V.pO.Left,popupType:y.device.isMobile?V.Z4.SlideUp:V.Z4.Popup,onClick:Se,renderOrigin:e=>(0,T.jsx)(E.ZP,{render:t=>(0,T.jsx)(A.Z,{iconStyle:{width:16,height:16},icon:u.o,ariaLabel:"more",...t,...e}),renderTooltip:()=>(0,T.jsx)(m.FormattedMessage,{id:"assistant.help",defaultMessage:"Help, contact, more..."})}),render:()=>(0,T.jsx)(H.LazyHelpButtonContent,{shouldRenderAsStaticModal:!1,fromForAnalytics:"ai_qna",onAcceptMessageSupport:fe})})]})]}),!n&&(0,T.jsx)(A.Z,{style:ve.closeButton,hovered:!0,icon:c.D,onClick:me,ariaLabel:"close"})]}),oe&&(0,T.jsxs)("div",{style:{...ve.header,flexDirection:"column",gap:6},children:[(0,T.jsxs)("div",{style:ve.labeledInput,children:[(0,T.jsx)("div",{style:ve.inputLabel,children:"Channel"}),(0,T.jsx)(f.bH,{value:(null==ae?void 0:ae.selectedFakeChannel)||"",onChange:e=>{if(!ae)throw new Error("slackModeState is undefined");Q.Pl.setState({...ae,selectedFakeChannel:e})},disabled:Boolean(M),placeholder:"Channel name",style:ve.input})]}),(0,T.jsxs)("div",{style:ve.labeledInput,children:[(0,T.jsx)("div",{style:ve.inputLabel,children:"User"}),(0,T.jsx)(W.Z,{items:ce,selectedItem:null==ae?void 0:ae.selectedFakeUser,getKey:e=>e.name||e.id,renderItem:e=>(0,T.jsx)(j.Z,{...e,title:e.key}),onSelect:e=>{if(!ae)throw new Error("slackModeState is undefined");Q.Pl.setState({...ae,selectedFakeUser:e})},renderOrigin:e=>(0,T.jsx)(K.Z,{focused:!1,title:null!=ae&&ae.selectedFakeUser?null==ae?void 0:ae.selectedFakeUser.name:"Select a user",...e})})]})]}),"chat"===ie&&(0,T.jsx)(X.R3,{renderAsFullPage:Boolean(n)}),"skillSwitcher"===ie&&(0,T.jsx)(se.Z,{renderAsFullPage:Boolean(n)}),"chatHistory"===ie&&(0,T.jsx)(ee.p,{renderAsFullPage:Boolean(n)})]})}},67593:(e,t,n)=>{n.d(t,{H:()=>b});var s=n(67294),i=n(1302),a=n(480),o=n(86628),r=n(24405),l=n(83065),d=n(15336),c=n(72126),u=n(70203),p=n(993),g=n(98104),m=n(82530),h=n(73063),S=n(65187),f=n(43250),v=n(12534),x=n(28685),y=n(29026),k=n(58016),w=n(85893);function b(e){window.__c={n:"AssistantRichTextInput"};const{isQnA:t,store:n,placeholder:l,disabled:d,onSubmit:h,onFocus:b,onBackspaceOnEmptyInput:j,hideSubmitIcon:A}=e,M=(0,a.O7)(),{isMobile:I}=(0,a.Fy)(),Z=(0,o.VK)((()=>""===(0,u.Jcv)(n.getValue()).trim()),[n]),[T,F]=s.useState(!1),R=(0,s.useCallback)((e=>{Z||!h||d||T||(h(n.getValue()),m.createAndCommit({userAction:"AssistantRichTextInput.valueChanged",environment:M,perform:e=>{p.sO({environment:M,store:n,value:void 0,transaction:e})}}))}),[d,M,h,n,Z,T]),P=(0,s.useCallback)((e=>{(0,v.ZP)({event:e,context:v.Af.ButtonMouseDown,callback:()=>{!async function(e){const{environment:t,textValueStore:n,setIsUndoing:s}=e;s(!0);const a=await(0,k.rewindActiveAssistantSession)({environment:t});a&&m.createAndCommit({userAction:"AssistantRichTextInput.undoLastHumanStep",environment:t,perform:e=>{p.sO({environment:t,store:n,value:a,transaction:e})}});await i.default.afterNextFlush((()=>{g.NX({store:n})})),s(!1)}({environment:M,textValueStore:n,setIsUndoing:F})}})}),[M,n]),B=(0,s.useCallback)((e=>{!h||Z||T||(h(n.getValue()),m.createAndCommit({userAction:"AssistantRichTextInput.valueChanged",environment:M,perform:e=>{p.sO({environment:M,store:n,value:void 0,transaction:e})}}))}),[h,Z,n,M,T]),_=(0,s.useRef)(),{onTextChange:V}=e,K=(0,s.useCallback)((e=>{e&&e instanceof KeyboardEvent&&"Backspace"===e.key&&!e.repeat&&0===(0,u.VrM)(_.current??[])&&(null==j||j()),_.current=n.getValue(),null==V||V(n.getValue())}),[_,n,j,V]),L=(0,r.yK)((e=>({wrap:{display:"flex",alignItems:"center",flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:"transparent",borderRadius:I?22:16,padding:I?"6px 8px 6px 14px":"4px 8px 4px 14px",minHeight:I?36:void 0,marginLeft:16,marginRight:16,overflow:"hidden",fontSize:I?15:14},placeholder:{opacity:d?.5:1,cursor:"text"}})),[d,I]);return(0,w.jsxs)("div",{style:L.wrap,...I?{}:{className:f.Wh_},onClick:e=>{if(e.target===e.currentTarget){const t=x.E.findEditableWithStore(n);t&&t.handleClick(e)}},children:[(0,w.jsx)(S.Z,{onEsc:()=>y.ZP.switchToSearchPane(),placeholder:l,disabled:!1,store:n,placeholderStyle:L.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,onEnter:d?c.ZT:B,disableMobileActionBar:!0,disableDateReminderMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMentions:t,onFocus:b,onChange:K}),!A&&(0,w.jsx)(C,{disabled:d??!1,isUndoing:T,storeIsEmpty:Z,handleClickEnter:R,handleClickStop:P})]})}function C(e){window.__c={n:"AssistantIconButton"};const{disabled:t,isUndoing:n,storeIsEmpty:s,handleClickStop:i,handleClickEnter:o}=e,c=(0,a.Fy)().isMobile,u=(0,r.yK)((e=>({icon:{height:c?24:20,width:c?24:20},stopIcon:{fill:e.icon.secondary},button:{pointerEvents:"auto",height:c?24:20,width:c?24:20}})),[c]);return n?(0,w.jsx)(h.Z,{icon:l._,onClick:()=>{},isBlue:!1,disabled:!0,iconStyle:u.icon,style:u.button,ariaLabel:"submit-ai-message"}):t?(0,w.jsx)(h.Z,{icon:d.q,onClick:i,style:u.button,iconStyle:{...u.icon,...u.stopIcon},ariaLabel:"stop-ai-message"}):(0,w.jsx)(h.Z,{icon:l._,onClick:o,isBlue:!s,disabled:s||t,iconStyle:u.icon,style:u.button,ariaLabel:"submit-ai-message"})}},16540:(e,t,n)=>{n.d(t,{N:()=>S});var s=n(67294),i=n(86628),a=n(24405),o=n(21202),r=n(82990),l=n(9291),d=n(91839),c=n(31278),u=n(76798),p=n(26136),g=n(61144),m=n(42899),h=n(85893);function S(e){window.__c={n:"AssistantSearchResultsThinkingMessage"};const{clientStep:t,parentStore:n,configurationState:i,citationHoverStore:a,renderAsFullPage:r,isQuickSearchMode:l}=e,{searchResults:d}=t,c=(0,s.useMemo)((()=>d.map((e=>p.G.createChildStore(n,{table:o.iU,id:e})))),[n,d]),u=(0,s.useRef)(null);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.J,{clientStep:t,configurationState:i,fakeSlackUser:void 0,forceShowFeedback:!1,ref:u,children:(0,h.jsx)(f,{searchResultStores:c})}),(0,h.jsx)(m.P,{containerRef:u,hoverStore:a,parentStore:n,isQuickSearchMode:l,renderAsFullPage:r})]})}function f(e){window.__c={n:"ThinkingMessageBody"};const{searchResultStores:t}=e,[n,o]=(0,s.useState)(0),p=(0,a.yK)((e=>({messageWrapper:{display:"flex",marginTop:6,marginBottom:6},currentElementStyle:{marginRight:6,display:"flex",height:21}})),[]);(0,s.useEffect)((()=>{const e=setInterval((()=>{o((e=>e+1))}),800);return()=>clearInterval(e)}),[]);const g=(0,i.VK)((()=>t.map(((e,t)=>(0,h.jsx)("div",{style:p.currentElementStyle,children:(0,h.jsx)(l.FormattedMessage,{id:"AssistantChatStep.searchingText",defaultMessage:"Reading {link}",values:{link:(0,h.jsx)("div",{style:r.Z.textOverflowStyle,children:(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,h.jsx)(c.Z,{disabled:!0,isEmptyPage:e.isEmptyPage(),icon:e.getIcon(),size:20,emojiSize:20,disableShrinking:!0,largeIcon:!0,style:{margin:"0px 4px"}}),(0,h.jsx)(u.Z,{store:e})]})})}})},t)))),[t,p.currentElementStyle]),m=n>=t.length?(0,h.jsx)("div",{style:{...p.currentElementStyle},children:(0,h.jsx)(l.FormattedMessage,{id:"AssistantChatStep.summarize",defaultMessage:"Summarizing"})}):g[n];return(0,h.jsxs)("div",{style:{display:"flex"},children:[(0,h.jsx)("div",{style:{minWidth:50},children:m}),(0,h.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:2},children:(0,h.jsx)(d.Z,{isTriColored:!0})})]})}},5175:(e,t,n)=>{n.d(t,{Z:()=>r});n(67294);var s=n(86628),i=n(9291),a=n(27967),o=n(85893);function r(e){window.__c={n:"AssistantSkillName"};const{clientSkill:t}=e,n=(0,i.useIntl)(),r=(0,s.VK)((()=>{if("persisted"===t.type){const e=t.skillStore.getName();if(e)return e}return n.formatMessage(a.skillNameMap[t.skillType])}),[t,n]);return(0,o.jsx)(o.Fragment,{children:r})}},80594:(e,t,n)=>{n.d(t,{Z:()=>F});var s=n(67294),i=n(480),a=n(24405),o=n(31945),r=n(86628),l=n(9291),d=n(54642),c=n(47307),u=n(82530),p=n(19471),g=n(89728),m=n(53336),h=n(72495),S=n(34859),f=n(70771),v=n(27967),x=n(5175),y=n(2553),k=n(15201),w=n(68709),b=n(55217),C=n(34541),j=n(43250),A=n(12534),M=n(85893);const I=(0,l.defineMessages)({instructionSectionTitle:{id:"CustomSkillMenu.instructionSection.title",defaultMessage:"Instructions"}});function Z(e){window.__c={n:"CustomSkillMenu"};const{clientSkill:t}=e,{skillStore:n}=t,o=(0,i.O7)(),d=(0,l.useIntl)(),c=(0,a.yK)((e=>({listWrap:{background:e.contentBackground,boxShadow:e.inputBoxShadow,padding:"3px 9px",margin:"0 8px",borderRadius:5,minHeight:64,..."dark"===e.mode?{backgroundColor:e.inputBackground}:{},fontSize:14},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"},sectionTitle:{color:e.lightTextColor,fontSize:12}})),[]),p=(0,r.VK)((()=>!n.canEdit()),[n]),g=(0,r.VK)((()=>{if(n.isType("custom"))return n.getInstructionParentStore()}),[n]),m=(0,r.VK)((()=>{if(g)return g.getContentStore()}),[g]),S=(0,s.useCallback)((e=>{(0,A.ZP)({event:e,context:A.Af.EditorClick,callback:()=>{if(!m)return;(m.getValue()||[]).length>0||u.createAndCommit({userAction:"CustomSkillMenu.handleListClick",environment:o,perform:e=>{y.Nj({environment:o,parentStore:m,transaction:e})}})}})}),[o,m]);return(0,M.jsx)(M.Fragment,{children:m&&g&&(0,M.jsx)(h.Z,{title:d.formatMessage(I.instructionSectionTitle),children:(0,M.jsx)(C.Z,{store:g,isDefaultContainer:!0,droppable:!1,render:()=>(0,M.jsx)(w.p,{allowSelectionWithin:!0,children:(0,M.jsx)("div",{style:c.listWrap,onClick:S,className:j.Wh_,children:(0,M.jsx)(k.O,{displayName:"CustomSkillMenuContent",disabled:p,children:(0,M.jsx)(b.Z,{disabled:p,store:m,emptyPlaceholder:(0,M.jsx)("div",{style:c.emptyPlaceholder,children:(0,M.jsx)(l.FormattedMessage,{id:"automations.CustomSkillMenu.emptyPlaceholder",defaultMessage:"Click to edit instructions…"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})},g.id)})})}function T(e){window.__c={n:"EditSkillMenu"};const{clientSkill:t,onClose:n,onDelete:o}=e,{skillStore:y}=t,k=(0,i.O7)(),w=(0,r.VK)((()=>y.getType()),[y]),b=(0,r.VK)((()=>y.isRenameable()),[y]),C=(0,r.VK)((()=>y.getName()),[y]),[j,A]=s.useState(C),I=s.useCallback((e=>{A(e),u.createAndCommit({userAction:"EditSkillMenu.handleNameChange",environment:k,perform:t=>{(0,f.Cc)({store:y,update:{name:e},transaction:t})}})}),[y,k]),T=(0,s.useCallback)((async()=>{if(!(await c.confirmUserAction({message:(0,M.jsx)(l.FormattedMessage,{defaultMessage:"Are you sure you want to delete this skill?",id:"EditSkillMenu.delete.cancelConfirmation"}),acceptLabel:(0,M.jsx)(l.FormattedMessage,{defaultMessage:"Delete",id:"EditSkillMenu.delete.cancelConfirmation.delete"})})))return;const e=y.getSpaceId();e&&await d.setPageAssistantPreferences(k,{type:"skill",spaceId:e,skillId:y.id,operation:{type:"clear_channel"}}),u.createAndCommit({userAction:"EditSkillMenu.handleDelete",environment:k,perform:e=>{(0,f.Nt)({store:y,transaction:e})}}),null==o||o(),n()}),[k,y,n,o]),F=(0,a.yK)((e=>({scroller:{maxHeight:"50vh"},skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},fromRowWrap:{display:"flex",alignItems:"center",margin:"4px 8px",gap:4,fontSize:14},rowWrap:{display:"flex",alignItems:"center",margin:"0 8px",gap:8,fontSize:14},headerNameWrap:{flexGrow:1},sectionTitle:{color:e.lightTextColor,fontSize:12}})),[]);return(0,M.jsxs)(m.Z,{type:S.Z.Y,style:F.scroller,children:[(0,M.jsx)(h.Z,{children:(0,M.jsxs)("div",{style:F.rowWrap,children:[v.skillIconMap[t.skillType](F.skillIcon),w&&b?(0,M.jsx)(p.bH,{value:j,onChange:I,placeholder:"custom"===w?"Custom skill name":"Skill name"}):(0,M.jsx)("div",{style:F.headerNameWrap,children:(0,M.jsx)(x.Z,{clientSkill:t})}),(0,M.jsx)(g.Z,{onClick:n,isBlue:!0,children:"Done"})]})}),"custom"===w&&(0,M.jsx)(Z,{clientSkill:t}),(0,M.jsx)(h.Z,{children:(0,M.jsx)("div",{style:F.rowWrap,children:(0,M.jsx)(g.Z,{onClick:T,isRed:!0,children:"Delete"})})})]})}function F(e){window.__c={n:"AssistantSkillPopup"};const{clientSkill:t,renderOrigin:n,buttonPopupStore:s,onDelete:r}=e,l=(0,i.O7)(),d=(0,a.yK)((e=>({headerWrap:{display:"flex",alignItems:"center",margin:"0 4px"},editPopupWrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow,width:392}})),[]);return(0,M.jsx)(o.ZP,{popupType:l.device.isMobile?o.Z4.SlideUp:o.Z4.Popup,preventScaleTransition:!0,preventOpacityTransition:!0,popupWrapStyle:d.editPopupWrap,renderOrigin:n,render:e=>t&&(0,M.jsx)(T,{clientSkill:t,onClose:e.close,onDelete:r}),buttonPopupStore:s})}},14309:(e,t,n)=>{n.d(t,{Z:()=>b,s:()=>C});n(67294);var s=n(480),i=n(86628),a=n(24405),o=n(18442),r=n(72126),l=n(9291),d=n(73063),c=n(32163),u=n(53336),p=n(72495),g=n(98165),m=n(34859),h=n(80444),S=n(21273),f=n(70771),v=n(27967),x=n(2405),y=n(5175),k=n(80594),w=n(85893);function b(e){window.__c={n:"AssistantSkillSwitcher"};const{renderAsFullPage:t}=e,n=(0,i.VK)((()=>(0,v.getFilteredClientSkills)({showCustomSkills:S.Z.showCustomSkills(),hasCurrentPage:!t})),[t]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(u.Z,{type:m.Z.Y,children:(0,w.jsx)(C,{clientSkills:n,renderAsFullPage:t,disableKeyboard:!1})})})}function C(e){window.__c={n:"SkillSwitcherMenuList"};const{clientSkills:t,renderAsFullPage:n,disableKeyboard:o}=e,d=(0,s.O7)(),u=(0,l.useIntl)(),m=(0,a.yK)((e=>({skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},skillMenuItemWrap:{display:"flex",alignItems:"center",margin:n?"8px 0px":8},settingsButton:{marginLeft:8},sectionTitle:n?{paddingLeft:0}:{}})),[n]),S=(0,i.VK)((()=>{const{mainEditorCurrentBlockStore:e}=h.default.state;if(!e)return[];return(0,g.uJ)(e).map((e=>e.id))}),[]),f=(0,i.VK)((()=>{const e=t.filter((e=>e.inAppSkillTrigger&&"persisted"!==e.type)),n=t.filter((t=>!e.includes(t)&&"persisted"===t.type&&Boolean(t.inAppSkillTrigger)&&S.includes(t.skillStore.getParentId()))),s=t.filter((t=>Boolean(t.inAppSkillTrigger)&&!e.includes(t)&&!n.includes(t)));return{globalSkills:e,pageSkills:n,workspaceSkills:s}}),[S,t]),x=(n?v.globalChatSections:v.pageChatSections).map((e=>{const t=r.oA(e.skills.map((e=>f.globalSkills.find((t=>t.skillType===e)))));return{key:e.key,render:t=>(0,w.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:u.formatMessage(e.title),desktopTitleStyle:m.sectionTitle,...t}),items:t.map((e=>j({environment:d,clientSkill:e,styles:m})))}})),y=f.pageSkills.map((e=>j({environment:d,clientSkill:e,styles:m}))),k=f.workspaceSkills.map((e=>j({environment:d,clientSkill:e,styles:m})));return(0,w.jsx)(c.Z,{type:c.i.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,disableKeyboard:o,sections:r.oA([...x,y.length>0&&{key:"page",render:e=>(0,w.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:"From this page",desktopTitleStyle:m.sectionTitle,...e}),items:y},k.length>0&&{key:"workspace",render:e=>(0,w.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:"Other skills",desktopTitleStyle:m.sectionTitle,...e}),items:k}])})}function j(e){const{environment:t,clientSkill:n,styles:s}=e;return{key:n.key,render:e=>"persisted"===n.type?(0,w.jsx)(k.Z,{clientSkill:n,renderOrigin:t=>(0,w.jsxs)("div",{style:s.skillMenuItemWrap,onMouseEnter:e.onMouseEnter,ref:e.ref,children:[(0,w.jsx)(x.Z,{iconStyle:s.skillIcon,title:(0,w.jsx)(y.Z,{clientSkill:n}),icon:v.skillIconMap[n.skillType],onClick:e.onClick,focused:e.focused}),"persisted"===n.type&&e.focused&&(0,w.jsx)(d.Z,{icon:o.H,ariaLabel:"edit",style:s.settingsButton,...t})]},e.key)}):(0,w.jsx)("div",{style:s.skillMenuItemWrap,onMouseEnter:e.onMouseEnter,ref:e.ref,children:(0,w.jsx)(x.Z,{iconStyle:s.skillIcon,title:(0,w.jsx)(y.Z,{clientSkill:n}),icon:v.skillIconMap[n.skillType],focused:e.focused,onClick:e.onClick})},e.key),action:async()=>{await(0,f.OZ)({environment:t,clientSkill:n})}}}},42899:(e,t,n)=>{n.d(t,{P:()=>R,d:()=>I});var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(15145),l=n(37167),d=n(40745),c=n(17693),u=n(21202),p=n(97880),g=n(82990),m=n(9291),h=n(84076),S=n(91839),f=n(53437),v=n(31278),x=n(76798),y=n(98567),k=n(84210),w=n(98180),b=n(26136),C=n(28344),j=n(33932),A=n(61144),M=n(85893);function I(e){window.__c={n:"CitedPagesList"};const{citations:t,hoverStore:n,toggledStore:r,isLoading:l}=e,d=(0,i.O7)(),c=(0,i.Fy)(),u=e.canExpand&&t.length>4,h=e.canExpand?e.expandedStore:void 0,S=(0,a.VK)((()=>r.state),[r]),f=(0,s.useCallback)((e=>{const t=w.Z.getActiveAssistantConfigurationState();t&&C.trackQnaCitationsToggle(d,{sessionId:t.sessionId,shown:e}),r.setState(e),!e&&(0,p.$K)(h)&&h.setState(!1)}),[d,h,r]),v=(0,a.VK)((()=>!(0,p.$K)(h)||h.state),[h]),x=(0,s.useCallback)((e=>{(0,p.$K)(h)&&h.setState(e)}),[h]);(0,a.VK)((()=>{t.forEach((e=>e.store.getTitleValue()))}),[t]);const y=v?t:t.slice(0,4),k=(0,o.yK)((e=>({wrap:{position:"relative",marginLeft:6,marginBottom:6,display:"flex",fontSize:c.isMobile?g.Z.fontSize.UISmall.mobile:g.Z.fontSize.UISmall.desktop},listWrap:{display:"flex",flexDirection:"column",flexGrow:1,gap:2,maxWidth:A.O,marginLeft:-6,paddingLeft:6,...u&&!v?{WebkitMaskImage:"linear-gradient(180deg, black, rgba(0,0,0,0.99) 80%, transparent)"}:{}}})),[u,c,v]);return 0===y.length?null:(0,M.jsxs)("div",{style:k.wrap,children:[(0,M.jsxs)("div",{style:k.listWrap,children:[(0,M.jsx)(Z,{enabled:!l,isLoading:Boolean(l),onClick:()=>{f(!S)},open:S,children:(0,M.jsx)(m.FormattedMessage,{id:"assistantCitationHelpers.numPagesFound",defaultMessage:"{count, plural, one {{count} page found} other {{count} pages found}}",values:{count:t.length}})}),S&&y.map((e=>(0,M.jsx)(F,{citation:e,hoverStore:n},e.store.id)))]}),u&&!v&&S&&(0,M.jsx)(T,{onClick:()=>{const e=w.Z.getActiveAssistantConfigurationState();e&&C.trackQnaCitationsSeeMoreClick(d,{sessionId:e.sessionId}),x(!0)}})]})}function Z(e){window.__c={n:"PageListHeader"};const{enabled:t,onClick:n,children:a,open:r,isLoading:l}=e,{isMobile:d}=(0,i.Fy)(),[u,p]=(0,s.useState)(!1),g=(0,o.yK)((e=>({wrap:{color:e.lightTextColor,fontWeight:500,fontSize:12,padding:"4px 0 2px",display:"flex",alignItems:"center"},content:{padding:"1px 2px",margin:"-1px -2px",cursor:t?"pointer":"default"},icon:{width:11,height:11,marginLeft:4,fill:e.lightIconColor,transform:`rotateZ(${r?0:-90}deg)`,opacity:d||u?1:0,transition:"opacity 0.2s ease, transform 200ms ease-out"},loadingDots:{marginLeft:8}})),[t,r,u,d]);return(0,M.jsxs)("div",{style:g.wrap,children:[(0,M.jsx)("div",{style:g.content,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),onClick:()=>{t&&n()},children:a}),t&&(0,c.A)(g.icon),l&&(0,M.jsx)(S.Z,{isTriColored:!0,styleParentContainer:g.loadingDots})]})}function T(e){window.__c={n:"ExpandOverlay"};const{onClick:t}=e,n=(0,i.Fy)(),[r,l]=(0,s.useState)(!1),c=(0,a.VK)((()=>r||n.isMobile),[n,r]),u=(0,o.yK)((e=>({wrap:{position:"absolute",left:0,right:0,bottom:0,cursor:"pointer",height:24,display:"flex",justifyContent:"center",alignItems:"flex-end",fontSize:n.isMobile?g.Z.fontSize.UISmall.mobile:g.Z.fontSize.UISmall.desktop,opacity:c?1:0,transition:"opacity 0.2s ease"},label:{display:"flex",gap:2,alignItems:"center",color:e.mediumTextColor,fontWeight:500,fontSize:11,borderRadius:6,padding:"2px 6px",boxShadow:"0px 0px 1px 0px rgba(0, 0, 0, 0.04), 0px 0px 2px 0px rgba(0, 0, 0, 0.06), 0px 4px 8px 0px rgba(0, 0, 0, 0.04)",background:e.whiteButtonBackground},icon:{width:12,height:12,fill:e.mediumIconColor}})),[n,c]);return(0,M.jsx)("div",{style:u.wrap,onClick:t,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:(0,M.jsxs)("div",{style:u.label,children:[(0,M.jsx)("div",{children:(0,M.jsx)(m.FormattedMessage,{id:"assistantCitationHelpers.seeMore",defaultMessage:"See more"})}),(0,d.M)(u.icon)]})})}function F(e){window.__c={n:"CitedPageRow"};const{citation:{number:t,store:n},hoverStore:d}=e,c=(0,i.O7)(),u=(0,a.VK)((()=>{var e;return(null===(e=d.state)||void 0===e?void 0:e.pageId)===n.id}),[d,n]),g=(0,s.useRef)(null),m=(0,o.yK)((e=>({wrap:{display:"flex",position:"relative"},linkBox:{display:"flex",alignItems:"center",gap:4,padding:"0 4px",borderRadius:6,fontWeight:500,fontSize:13,transition:"background 0.2s ease",maxWidth:"95%",marginLeft:-4},linkBoxHoveredStyle:{background:e.accentColors.uiBlue[100]},iconWrap:{position:"relative",marginRight:4,width:14,height:14,flexShrink:0},icon:{position:"absolute",left:0,top:0,transition:"opacity 0.2s ease",opacity:(0,p.$K)(t)&&u?0:1},number:{position:"absolute",left:0,top:0,opacity:u?1:0,transition:"opacity 0.2s ease",zIndex:10},titleWrap:{display:"flex",alignItems:"center",padding:2,minWidth:50}})),[u,t]),S=(0,s.useCallback)((e=>{if(e){if(!g.current)return;d.setState({type:"list",pageId:n.id,node:g.current})}else d.setState(void 0)}),[d,n]),f=(0,a.VK)((()=>n.getIcon()),[n]),y=(0,a.VK)((()=>n.isEmptyPage()),[n]),b=(0,a.VK)((()=>c.RouterStore.state.route),[c]),{metaHref:A,href:I}=(0,a.VK)((()=>{const e=(0,k.ZP)({store:n,fullyQualified:!1,pageVisitSource:r.tY.AIQna});return"page"===b.name||"nativeTab"===b.name&&"assistant"===b.tab||"quickSearch"===b.name?{metaHref:e,href:e}:"chat"===b.name?{metaHref:e,href:(0,l.t)({blockId:n.id,pageVisitSource:r.tY.AIQna})}:{metaHref:void 0,href:void 0}}),[b,n]);return(0,M.jsx)("div",{style:m.wrap,ref:g,children:(0,M.jsx)(h.Z,{href:A,metaHref:I,style:m.linkBox,hovered:u,hoveredStyle:m.linkBoxHoveredStyle,onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),onClick:()=>{c.device.isMobileBrowser&&j.closeAssistantRightHandSideMenu(),C.trackQnaResultClicked(c,{clickedPageId:n.id,configurationState:w.Z.getActiveAssistantConfigurationState(),source:"citation_list"})},children:(0,M.jsxs)("div",{style:m.titleWrap,children:[(0,M.jsxs)("div",{style:m.iconWrap,children:[(0,p.$K)(t)&&(0,M.jsx)(B,{number:t,hovered:u,style:m.number}),(0,M.jsx)(v.Z,{disabled:!0,icon:f,isEmptyPage:y,size:14,style:m.icon,useInvertedColors:!1})]}),(0,M.jsx)(x.Z,{store:n})]})})})}function R(e){window.__c={n:"CitationPreviewPopup"};const{containerRef:t,hoverStore:n,parentStore:s,isQuickSearchMode:o}=e,r=(0,i.Fy)(),l=(0,a.VK)((()=>{if(!n.state||!t.current||r.isMobile||o)return;const e=t.current.getBoundingClientRect(),i=e.left>=y.Tq+24;let a;const l=n.state.node.getBoundingClientRect();if(i)a=new DOMRect(e.x,l.y,e.width,l.height);else{if("token"!==n.state.type)return;a=l}return{store:b.G.createChildStore(s,{id:n.state.pageId,table:u.iU}),originRect:a,isFullTooltip:i}}),[t,s,r,o,n]);if((0,p.$K)(l)){const{originRect:e,isFullTooltip:t,store:n}=l;return(0,M.jsx)(f.ZP,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:f.ZP.PopupType.Popup,originGap:t?24:8,alignmentToOrigin:f.ZP.Alignment.Start,open:!0,placementToOrigin:t?f.ZP.Placement.Left:f.ZP.Placement.Bottom,originRect:e,useLightBoxShadow:!t,render:()=>t?(0,M.jsx)(y.E5,{store:n}):(0,M.jsx)(P,{store:n})})}return null}function P(e){window.__c={n:"MinimalCitationTooltip"};const{store:t}=e,n=(0,o.yK)((e=>({wrap:{fontSize:g.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,fontWeight:g.Z.fontWeight.regular,fill:e.mediumIconColor,padding:"4px 6px 4px 6px",display:"flex",alignItems:"center",gap:2}})),[]),s=(0,a.VK)((()=>t.getIcon()),[t]),i=(0,a.VK)((()=>t.isEmptyPage()),[t]);return(0,M.jsxs)("div",{style:n.wrap,children:[(0,M.jsx)(v.Z,{disabled:!0,icon:s,isEmptyPage:i,size:14,useInvertedColors:!1}),(0,M.jsx)(x.Z,{store:t})]})}function B(e){window.__c={n:"CitationNumber"};const{number:t,hovered:n,style:s}=e,i=(0,o.yK)((e=>({wrap:{verticalAlign:"middle",cursor:"pointer",transition:"all 100ms ease-in",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:90,padding:"0 4px",fontSize:10,minWidth:14,height:14,fontWeight:g.Z.fontWeight.semibold,color:"dark"===e.mode?"#2f2f2f":"white",backgroundColor:n?"#2383e2":"dark"===e.mode?"#787774":"#acaba9",...s}})),[n,s]),a=(0,m.useIntl)();return(0,M.jsx)("div",{style:i.wrap,children:t.toLocaleString(a.locale)})}},67973:(e,t,n)=>{n.d(t,{d:()=>i});var s=n(49085);class i extends s.default{getInitialState(){}}},78990:(e,t,n)=>{n.d(t,{Z:()=>se});var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(42853),l=n(11751),d=n(82990),c=n(9291),u=n(35294),p=n(21273),g=n(28410),m=n(12174),h=n(36591),S=n(97880),f=n(58016),v=(n(95477),n(87279)),x=n(98180),y=n(82375),k=n(7339),w=n(52275),b=n(78140),C=n(32163),j=n(72495),A=n(42782),M=n(85893);function I(e,t){window.__c={n:"AssistantModeExtensionMenuItem"};const{mode:n,fineTunedModelsForMode:s,onFocus:o,renderOrigin:r,onSelectModel:l,...d}=e,{isMobile:c}=(0,i.Fy)(),u=(0,a.VK)((()=>x.Z.getActiveAssistantConfigurationStore()),[]),p=(0,a.VK)((()=>{var e,t;const n=null==u||null===(e=u.state)||void 0===e?void 0:e.clientFineTunedOverride;return null===(t=s.find((e=>{let{name:t}=e;return t===n})))||void 0===t?void 0:t.name}),[u,s]);return(0,M.jsx)(A.Z,{...d,ref:t,onFocus:o,renderOrigin:r,allowOptionalExtensionMenu:!0,renderExtension:(e,t)=>{let i;return i=c?{menuType:v.og.Modal,...e}:{menuType:v.og.Popup,width:300,...e},(0,M.jsx)(b.Z,{...i,children:(0,M.jsx)(C.Z,{type:C.i.Vertical,initialFocus:0,sections:[{key:"fine-tuned-models",render:e=>(0,M.jsx)(j.Z,{...e}),items:[...s,{name:void 0,description:"Default assistant model for this mode."}].map((e=>{let{name:s,description:i}=e;return{key:s??"default",action:()=>{l({extensionMenuItemParent:t,model:s,mode:n})},render:e=>(0,M.jsx)(w.Z,{...e,title:s??"Default",caption:i,right:s===p?(0,h.e)({width:12,height:"auto"}):void 0,shouldWrapCaption:!0})}}))}],onAccept:()=>{t.close()}})})}})}const Z=s.forwardRef(I);var T=n(64921),F=n(31945);function R(){window.__c={n:"AssistantFeatureGateBadge"};const e=(0,i.O7)(),{isMobile:t}=(0,i.Fy)(),n=(0,a.VK)((()=>p.Z.getMode()),[]),r=(0,a.VK)((()=>x.Z.getActiveAssistantConfigurationStore()),[]),l=(0,a.VK)((()=>y.Pl.state),[]),d=s.useCallback((e=>{const{buttonPopupParent:t,mode:n}=e;k.C.updateLocalOverrideConfig("assistant_variant",n),t.close()}),[]),c=s.useCallback((async t=>{const{extensionMenuItemParent:n,model:s,mode:i}=t;if(r)r.setClientModelOverride(s);else{const{sessionId:t}=await(0,f.resetAndInitializeAssistantSession)({environment:e,isLabelerSlackMode:Boolean(l),fakeSlackChannel:null==l?void 0:l.selectedFakeChannel}),n=x.Z.getSessionContext(t);null==n||n.assistantConfigurationStore.setClientModelOverride(s)}k.C.updateLocalOverrideConfig("assistant_variant",i),n.close()}),[e,r,l]),u=(0,o.yK)((e=>({buttonContainer:{marginLeft:8},badge:{fontSize:t?14:11,fontWeight:500,padding:"1px 4px",backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,borderRadius:4}})),[t]);return"control"===n?null:(0,M.jsx)(F.ZP,{popupType:t?F.Z4.SlideUp:F.Z4.Popup,disabled:true,placementToOrigin:F.pO.Bottom,alignmentToOrigin:F.vR.Start,renderOrigin:e=>(0,M.jsx)(T.Z,{...e,disabled:true,ignoreLocalHoverState:!0,style:u.buttonContainer,children:(0,M.jsx)("div",{style:u.badge,children:(0,M.jsx)(P,{mode:n})})}),render:e=>(0,M.jsx)(b.Z,{menuType:v.og.Popup,width:350,children:(0,M.jsx)(C.Z,{type:C.i.Vertical,initialFocus:0,sections:[{key:"assistant_modes",render:e=>(0,M.jsx)(j.Z,{...e,title:"Mode for Dev",shouldShowBottomDivider:!0}),items:m.KM.map((t=>function(e){const{mode:t,buttonPopupParent:n,currentMode:s,onSelectModel:i,onSelectMode:a}=e,o=(0,S.qg)(g.RV,t)?g.RV[t]:[],r=(e,n)=>(0,M.jsx)(w.Z,{...e,ref:n,title:(0,M.jsx)(P,{mode:t}),right:t===s?(0,h.e)({width:12,height:"auto"}):void 0,caption:(0,M.jsx)(B,{mode:t}),shouldWrapCaption:!0});return{key:t,render:(e,n)=>o.length>0?(0,M.jsx)(Z,{...e,fineTunedModelsForMode:o,onFocus:()=>{n.onFocus},renderOrigin:(e,t)=>r(e,t),mode:t,onSelectModel:i}):r(e),action:()=>{a({buttonPopupParent:n,mode:t})}}}({buttonPopupParent:e,mode:t,currentMode:n,onSelectMode:d,onSelectModel:c})))}]})})})}function P(e){const{mode:t}=e;return"beta"===t?(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.Beta.label",defaultMessage:"Q&A Beta"}):"development"===t?(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.Development.label",defaultMessage:"Development"}):"exploratory"===t?(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.exploratory.label",defaultMessage:"Exploratory"}):"wild_west"===t?(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.WildWest.label",defaultMessage:"Wild West"}):(0,S.t1)(t)}function B(e){const{mode:t}=e;return"beta"===t?(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.Beta.caption",defaultMessage:"🚢 Current AI experience for our users."}):"development"===t?(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.Development.caption",defaultMessage:"🌱 New features we're about to ship."}):"exploratory"===t?(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.Exploratory.caption",defaultMessage:"🧪 Features still baking but want feedback on."}):"wild_west"===t?(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.WildWest.caption",defaultMessage:"🤠 Yee haw! Use at your own risk!"}):(0,S.t1)(t)}var _=n(74487);const V=_.object({required:{type:_.literal("everything")},optional:{}}),K=_.object({required:{type:_.literal("workspace")},optional:{}}),L=_.object({required:{type:_.literal("teamspace"),teamId:_.uuid()},optional:{}}),W=_.object({required:{type:_.literal("page"),pageId:_.uuid()},optional:{}}),E=(_.union([V,K,L,W]),{type:"everything"});var O=n(56666),H=n(84169),N=n(98519),D=n(25888),Q=n(12714),z=n(95193),q=n(80444),U=n(42875),$=n(31278);function G(e,t){window.__c={n:"AssistantScopedSearchPageMenuItem"};const{blockStore:n,right:s,...i}=e,r=(0,c.useIntl)(),l=(0,a.VK)((()=>{var e;return null===(e=n.getModel())||void 0===e?void 0:e.getRenderIcon({getRecordModel:n.getRecordModel})}),[n]),d=(0,a.VK)((()=>{var e;return null===(e=n.getModel())||void 0===e?void 0:e.getRenderTitle({getRecordModel:n.getRecordModel,userTimeZone:(0,U.r)(),intl:r})}),[n,r]),u=(0,a.VK)((()=>{var e;return(null===(e=q.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.id)===n.id}),[n]),p=(0,a.VK)((()=>n.isEmptyPage()),[n]),g=(0,o.yK)((e=>({lightText:{color:e.lightTextColor}})),[]);return(0,M.jsx)(w.Z,{...i,ref:t,icon:(0,M.jsx)($.Z,{disabled:!0,icon:l,isEmptyPage:p,size:20}),title:u?(0,M.jsx)(c.FormattedMessage,{id:"assistantScopedSearchPageMenuItem.currentPage.title",defaultMessage:"{pageTitle} <light>- Current page</light>",values:{pageTitle:d,light:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,M.jsx)("span",{style:g.lightText,children:t})}}}):d,right:s})}const Y=s.forwardRef(G);function J(e,t){window.__c={n:"AssistantScopedSearchTeamMenuItem"};const{teamStore:n,right:s,...i}=e,o=(0,a.VK)((()=>{var e;return null===(e=n.getModel())||void 0===e?void 0:e.getRenderIcon()}),[n]),r=(0,a.VK)((()=>{var e;return null===(e=n.getModel())||void 0===e?void 0:e.getRenderTitle()}),[n]);return(0,M.jsx)(w.Z,{...i,ref:t,icon:o&&(0,M.jsx)($.Z,{disabled:!0,icon:o,isEmptyPage:!1,size:20}),title:r,right:s})}const X=s.forwardRef(J);var ee=n(56496),te=n(45653);function ne(e){window.__c={n:"AssistantScopedSearchMenu"};const{buttonPopupParent:t}=e,n=(0,i.O7)(),{isMobile:r}=(0,i.Fy)(),[l,d]=s.useState(!1),u=(0,a.VK)((()=>q.default.state.currentUserStore),[]),p=(0,a.VK)((()=>q.default.state.currentSpaceStore),[]),g=(0,a.VK)((()=>{var e;return null==p||null===(e=p.getModel())||void 0===e?void 0:e.getRenderIcon()}),[p]),m=(0,a.VK)((()=>{var e;return null==p||null===(e=p.getModel())||void 0===e?void 0:e.getRenderTitle()}),[p]),h=(0,a.VK)((()=>x.Z.getActiveAssistantConfigurationStore()),[]),v=(0,a.VK)((()=>{var e;return(null==h||null===(e=h.state)||void 0===e?void 0:e.searchScope)??E}),[h]),k=(0,a.VK)((()=>y.Pl.state),[]),A=(0,a.VK)((()=>q.default.state.currentSpaceViewStore),[]),I=(0,a.VK)((()=>A?A.getTeamsStores():[]),[A]),Z=(0,a.VK)((()=>q.default.state.mainEditorCurrentBlockStore),[]),T=s.useCallback((e=>"everything"===e.type?"everything"===v.type:"workspace"===e.type?"workspace"===v.type:"teamspace"===e.type?"teamspace"===v.type&&e.teamId===v.teamId:"page"===e.type?"page"===v.type&&e.pageId===v.pageId:(0,S.t1)(e)),[v]),F=s.useCallback((async e=>{if(h)h.setSearchScope(e);else{const{sessionId:t}=await(0,f.resetAndInitializeAssistantSession)({environment:n,isLabelerSlackMode:Boolean(k),fakeSlackChannel:null==k?void 0:k.selectedFakeChannel}),s=x.Z.getSessionContext(t);null==s||s.assistantConfigurationStore.setSearchScope(e)}t.close()}),[n,k,h,t]),R=(0,z.F)(),P=function(e){const{isMobile:t}=e;return(0,o.yK)((e=>({questionMark:{width:t?16:14,height:t?16:14,color:e.lightIconColor},checkmark:{width:t?16:14,height:t?16:14,color:e.lightIconColor},lightText:{color:e.lightTextColor},dots:{width:t?16:14,height:t?16:14,color:e.lightIconColor},moreText:{color:e.lightTextColor}})),[t])}({isMobile:r}),B=[{key:"find_in_section",render:e=>(0,M.jsx)(j.Z,{...e,title:(0,M.jsx)(c.FormattedMessage,{id:"assistantScopedSearchMenu.findInSection.title",defaultMessage:"Find in"})}),items:[{key:"everything_item",render:e=>(0,M.jsx)(w.Z,{...e,icon:(0,M.jsx)(te.Z,{userStore:u,size:20}),title:(0,M.jsx)(c.FormattedMessage,{id:"assistantScopedSearchMenu.everythingItem.title",defaultMessage:"Everything I can access"}),right:T({type:"everything"})&&(0,N.k)(P.checkmark)}),action:()=>{F({type:"everything"})}},{key:"workspace",render:e=>(0,M.jsx)(w.Z,{...e,icon:m?(0,M.jsx)($.Z,{disabled:!0,icon:g,isEmptyPage:!1,title:m,size:20}):(0,M.jsx)("div",{style:{opacity:.25},children:(0,M.jsx)(ee.Z,{size:20,title:void 0})}),title:(0,M.jsx)(c.FormattedMessage,{id:"assistantScopedSearchMenu.workspaceItem.title",defaultMessage:"{spaceName} <light>- Workspace</light>",values:{spaceName:m,light:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,M.jsx)("span",{style:P.lightText,children:t})}}}),right:T({type:"workspace"})&&(0,N.k)(P.checkmark)}),action:()=>{F({type:"workspace"})}},...s.useMemo((()=>{if(!Z)return[];const e={type:"page",pageId:Z.id};return[{key:`page_${Z.id}`,render:t=>(0,M.jsx)(Y,{...t,blockStore:Z,right:T(e)&&(0,N.k)(P.checkmark)}),action:()=>{F(e)}}]}),[Z,F,T,P.checkmark]),...s.useMemo((()=>{if(0===I.length)return[];const e=I.find((e=>T({type:"teamspace",teamId:e.id})));return(l?I:[e??I[0]]).map((e=>{const t={type:"teamspace",teamId:e.id};return{key:`teamspace_${e.id}`,render:n=>(0,M.jsx)(X,{...n,teamStore:e,right:T(t)&&(0,N.k)(P.checkmark)}),action:()=>{F(t)}}}))}),[l,I,F,T,P.checkmark]),...s.useMemo((()=>I.length<=1||l?[]:[{key:"more",render:e=>(0,M.jsx)(w.Z,{...e,icon:(0,O.o)(P.dots),title:(0,M.jsx)(c.FormattedMessage,{id:"assistantScopedSearchMenu.moreItem.title",defaultMessage:"More"}),titleStyle:P.moreText}),action:()=>{d(!0)}}]),[l,I,P.dots,P.moreText])]},{key:"learn_more_section",render:e=>(0,M.jsx)(j.Z,{...e,topBorder:!0}),items:[{key:"learn_more_item",render:e=>(0,M.jsx)(w.Z,{...e,icon:(0,H.m)(P.questionMark),title:(0,M.jsx)(c.FormattedMessage,{id:"assistantScopedSearchMenu.learnMore.title",defaultMessage:"Learn more about Q&A"})}),action:()=>{!function(e){const{environment:t}=e;D.Fs(t,{from:"assistant_scoped_search_menu"}),Q.D({environment:t,url:"https://www.notion.so/help/qna"})}({environment:n})}}]}];return(0,M.jsx)(b.Z,{...R,children:(0,M.jsx)(C.Z,{type:C.i.Vertical,sections:B,initialFocus:0})})}function se(){window.__c={n:"AssistantMenuHeader"};const{device:e}=(0,i.O7)(),{isMobile:t}=e,n=(0,a.VK)((()=>!p.Z.showScopedSearch()),[]),s=(0,u.d)(),g=function(e){const{isMobile:t}=e;return(0,o.yK)((e=>({headerSparkles:{width:t?18:16,height:t?18:16,marginRight:6,color:e.regularIconColor},headerLabel:{fontSize:t?16:14,color:e.regularTextColor,fontWeight:d.Z.fontWeight.medium,display:"flex",alignItems:"center"},chevronDown:{width:t?16:12,height:t?16:12,marginLeft:6,marginRight:6,color:e.lightIconColor},button:{display:"flex",alignItems:"center",borderRadius:4}})),[t])}({isMobile:t});return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(F.ZP,{disabled:n,disablePopup:n,popupType:s,renderOrigin:e=>(0,M.jsxs)(T.Z,{...e,disabled:n,style:g.button,children:[(0,l.t)(g.headerSparkles),(0,M.jsx)("div",{style:g.headerLabel,children:(0,M.jsx)(c.FormattedMessage,{id:"assistantMenu.header.askNotionAI.label",defaultMessage:"Ask AI"})}),!n&&(0,r.i)(g.chevronDown)]}),render:e=>(0,M.jsx)(ne,{buttonPopupParent:e})}),(0,M.jsx)(R,{})]})}},37712:(e,t,n)=>{n.d(t,{A:()=>o});n(67294);var s=n(86628),i=n(24405),a=n(85893);function o(e){let{scrollerStore:t}=e;window.__c={n:"SidebarScrollToTopBorder"};const n=(0,s.VK)((()=>0===t.state.scrollTop),[t]),o=(0,i.yK)((e=>({border:{width:"100%",boxShadow:n?"0 0 0 transparent":`0 1px 0 ${e.regularDividerColor}`,transition:"box-shadow 300ms",height:2,marginTop:-2,zIndex:99}})),[n]);return(0,a.jsx)("div",{style:o.border})}},99622:(e,t,n)=>{n.d(t,{Y:()=>a});var s=n(86628),i=n(88893);function a(e){return(0,s.VK)((()=>i.Q6(e.state)),[e])}},12205:(e,t,n)=>{n.d(t,{J:()=>a});var s=n(86628),i=n(80444);function a(){const{currentSpaceStore:e}=(0,s.Kw)(i.default);return(0,s.VK)((()=>(null==e?void 0:e.canAdmin())??!1),[e])}},28410:(e,t,n)=>{n.d(t,{RV:()=>r,Th:()=>i});n(57658);var s=n(97880);const i=12e3,a={"ft:gpt-4-0613:makenotion:qa-1000-kenny:8VYnFLJP":{name:"Kenny's Model 1000",createdTime:Date.parse("2023-12-13T07:56:00-04:00"),description:"Kenny's model trained on 1000 examples",variants:["exploratory"]},"ft:gpt-4-0613:makenotion:qa-100-kenny:8V91GG9C":{name:"Kenny's Model 100",createdTime:Date.parse("2023-12-12T08:55:00-04:00"),description:"Kenny's model trained on 100 examples",variants:["exploratory"]},"ft:gpt-3.5-turbo-1106:makenotion::8W3ZKTGG":{name:"Assistant Fast Model",createdTime:Date.parse("2023-12-14T02:27:00-04:00"),description:"Linus's speedy assistant model",variants:["exploratory"]},"ft:gpt-4-0613:makenotion::8SDS0jPI":{name:"JavaScript Assistant",createdTime:Date.parse("2023-12-03T10:58:00-04:00"),description:"Simon's JavaScript assistant",variants:["wild_west"]}},o=((0,s.qP)(a).reduce(((e,t)=>{let[n,{name:s}]=t;return e[s]=n,e}),{}),Object.values(a).map((e=>{let{name:t}=e;return t})));const r=function(){const e={};for(const n of Object.values(a))for(const t of n.variants)e[t]||(e[t]=[]),e[t].push(n);const t={};for(const[n,i]of(0,s.qP)(e))t[n]=i.sort(((e,t)=>e.createdTime-t.createdTime));return t}(),l=["openai-1.1","openai-2","openai-4","openai-5","openai-6","openai-7","openai-8","openai-9",...o];const d=["anthropic-1","anthropic-2","anthropic-qa-alpha","anthropic-3"]}}]);