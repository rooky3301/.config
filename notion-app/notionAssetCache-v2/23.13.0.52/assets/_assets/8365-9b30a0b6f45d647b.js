"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8365],{78365:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ie});o(57658),o(67294);var r=o(83355),n=o(1302),i=o(15145),a=o(92996),s=o(99036),l=o(80951),c=o(43690),d=o(1800),u=o(77657),p=o(42875),h=o(47453),g=o(59753),m=o(4615),y=o(74446),S=o(21202),f=o(3791),v=o(9291),P=o(50906),R=o(8406),C=o(54642),b=o(893),M=o(47307),I=o(9953),x=o(8055),k=o(82530),w=o(12170),_=(o(21703),o(68626)),F=o(91155),Z=o(52821),j=o(77907),D=o(51741);async function U(e){let{environment:t,query:o,targetCollectionStore:r,propertySchema:n,blockPointers:i}=e;try{const e=await j.deps.searchActions.loader(),{results:a}=await e.searchPagesInCollection({environment:t,query:o.query,collectionId:r.id,limit:o.limit,spaceId:r.getSpaceId(),excludeTemplates:!0,source:"relation_menu",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!0,ignoresHighlight:!0});return V({results:a,targetCollectionStore:r,propertySchema:n,blockPointers:i})}catch(a){return _.log({level:"error",from:"relationPropertySearchRequest",type:"performSearchRequest",error:(0,F.Ui)(a)}),[]}}function V(e){let{results:t,targetCollectionStore:o,propertySchema:r,blockPointers:n}=e;const i=new Set(n.map((e=>e.id))),a=[];return t.forEach((e=>{const t={spaceId:o.getSpaceId(),id:e,table:S.iU},n=(0,Z.dN)({targetCollectionStore:o,propertySchema:r,pointer:t});if(i.has(e)){const o={key:e,type:D.Rt.SelectedPage,pointer:t};a.push({pageResult:o,canEdit:n})}else{const o={key:e,type:D.Rt.SearchPage,pointer:t};a.push({pageResult:o,canEdit:n})}})),a}const q={relationPropertySearchRequest:{extensionPoint:"relationPropertySearchRequest",behaviorFnMap:{default:U,"notion://sprints_collection":async function(e){const{environment:t,query:o,targetCollectionStore:r,propertySchema:n,blockPointers:i}=e;try{return V({results:await async function(e){const{environment:t,sprintCollectionStore:o,searchQuery:r}=e,n=o.getPropertyMapping(),i=null==n?void 0:n[a.b0.StatusV2],s=null==n?void 0:n[a.b0.Dates];if(!i||!s)throw new Error("Sprints database does not have the required properties");const l="results",c={type:"reducer",userTimeZone:(0,p.r)(),searchQuery:r,sort:[{property:i,direction:"ascending"},{property:s,direction:"ascending"}],reducers:{[l]:{type:"results",limit:100}}},d=o.getParentBlockStore();if(!d)return[];await d.load();const u=d.getCollectionViewStores()[0];if(!u)return[];const h=o.getSpaceId(),g=await C.queryCollection(t,{source:{type:"collection",id:o.id,spaceId:h},collectionView:{id:u.id,spaceId:h},loader:c},void 0,{src:"relation_property_menu"});if("success"!==g.type)return[];const m=g.data.result.reducerResults[l];if("results"!==m.type)return[];return m.blockIds}({environment:t,sprintCollectionStore:r,searchQuery:o.query}),targetCollectionStore:r,propertySchema:n,blockPointers:i})}catch(s){_.log({level:"error",from:"relationPropertySearchRequest",type:"performSprintSearchRequest",error:(0,F.Ui)(s)});return await U(e)}}}}};var B=o(52275),T=o(36488),G=o(68894),O=o(78140),A=o(53437),Q=o(31278),L=o(76798),E=o(72495),N=o(46247),W=o(9897),K=o(66890),z=o(23586),Y=o(77472),$=o(70764),H=o(75079),X=o(33929),J=o(87279),ee=o(70219),te=o(65598),oe=o(29376),re=o(18514),ne=o(18245),ie=o(75822),ae=o(80444),se=o(77080),le=o(30874),ce=o(26136),de=o(72087),ue=o(88280),pe=o(30926),he=o(480),ge=o(86628),me=o(24405),ye=o(82990),Se=o(74194),fe=o(84076),ve=o(85893);const Pe=(0,v.defineMessages)({inputPlaceholder:{defaultMessage:"Link or create a page…",id:"relationPropertyMenuInput.searchPlaceholder"},searchLinkedInputPlaceholder:{defaultMessage:"Search linked pages…",id:"relationPropertyMenuInput.viewExisting.searchPlaceholder"},syncedCollectionInputPlaceholder:{defaultMessage:"Link a page",id:"relationPropertyMenuInput.syncedCollection.searchPlaceholder"},connectedRelationInputPlaceholder:{defaultMessage:"Find a page",id:"relationPropertyMenuInput.connectedRelation.searchPlaceholder"},connectedRelationGoogleDriveInputPlaceholder:{defaultMessage:"Paste in Google Drive or Google Docs link",id:"relationPropertyMenuInput.connectedRelationGoogleDrive.searchPlaceholder"},connectedRelationFigmaInputPlaceholder:{defaultMessage:"Paste in https://figma.com/...",id:"relationPropertyMenuInput.connectedRelationFigma.searchPlaceholder"},connectedRelationGithubInputPlaceholder:{defaultMessage:"Paste in https://github.com/...",id:"relationPropertyMenuInput.connectedRelationGithub.searchPlaceholder"},sprintTypedPropertyInputAddPlaceholder:{defaultMessage:"Search...",id:"relationPropertyMenuInput.sprintTypedPropertyInputAddPlaceholder.searchPlaceholder"}});function Re(e){window.__c={n:"RelationPropertyMenuInput"};const{store:t,renderState:o,analyticsFrom:r,disabled:n,overlayMode:i,addPage:s}=e,l=(0,he.O7)(),c=(0,he.Fy)(),{targetParentUrl:d,targetCollectionStore:u,connectedRelationFlags:p}=o,{menuState:h,menuStore:g}=(0,ge.VK)((()=>({menuState:t.state,menuStore:t})),[t]),{searchQuery:m,searchPopupOpen:y}=(0,ge.VK)((()=>h),[h]),S=(0,ge.VK)((()=>u.getIcon()),[u]),f=(0,me.yK)((e=>({regular:{color:e.mediumTextColor,whiteSpace:"nowrap",marginLeft:4},headerWrap:{display:"flex",width:"100%",position:"relative",zIndex:2,padding:"6px 10px",fontSize:14,background:e.inputBackground,boxShadow:`\n\t\t\t\t\t0 1px 0 ${e.darkDividerColor}\n\t\t\t\t`},recordTitle:{fontWeight:ye.Z.fontWeight.semibold,fontSize:14,marginLeft:D.Qi*(c.isRetina?.5:1)},searchIcon:{fill:e.mediumIconColor,width:14,height:14,marginRight:10}})),[c.isRetina]),{getInputPlaceholderMessage:R,getShowTargetDatabase:C}=(0,ge.VK)((()=>function(e){const{collectionStore:t,connectedRelationFlags:o,overlayMode:r,disabled:n}=e;switch(t.getFormatStore().getKeyStore("app_config_uri").getValue()){case a.p$:return{getInputPlaceholderMessage:Ce,getShowTargetDatabase:()=>!1};default:return{getInputPlaceholderMessage:()=>function(e){const{connectedRelationFlags:{isSyncedCollectionRelation:t,isGithubPrRelation:o,isGoogleDriveRelation:r,isFigmaRelation:n,isConnectedRelation:i},overlayMode:a,disabled:s}=e;return t?Pe.syncedCollectionInputPlaceholder:o?Pe.connectedRelationGithubInputPlaceholder:r?Pe.connectedRelationGoogleDriveInputPlaceholder:n?Pe.connectedRelationFigmaInputPlaceholder:i?Pe.connectedRelationInputPlaceholder:"view"===(null==a?void 0:a.type)||s?Pe.searchLinkedInputPlaceholder:Pe.inputPlaceholder}({connectedRelationFlags:o,overlayMode:r,disabled:n}),getShowTargetDatabase:()=>!o.isConnectedRelation}}}({collectionStore:u,connectedRelationFlags:p,overlayMode:i,disabled:n})),[u,p,i,n]),b=R(),M=C();return(0,ve.jsxs)("div",{style:f.headerWrap,children:[(0,ve.jsx)(Se.Z,{style:{flexGrow:1},value:m,placeholder:X.default.formatMessage(b),forceShowClearButton:Boolean(m||y),focus:!0,onChange:e=>{const t=e.target.value;g.setState({...h,searchQuery:t,searchPopupOpen:!!t,searchLimit:pe.Z.limitIncrement})},onClearButtonClick:()=>{g.setState(g.getInitialState())},onClick:()=>{g.setState({...h,searchQuery:m,searchPopupOpen:!0,searchLimit:pe.Z.limitIncrement})},onKeyDown:e=>{"Escape"===e.key&&g.setState(g.getInitialState())},format:Se.B.Transparent,onSubmit:()=>{const e=u.getFormat().integration_id,t=le.Z.integrations.state.find((t=>t.id===e)),o=u.getFormat().pattern_name;if(!t||!o)return;(0,oe.DB)({integration:t,patternName:o,url:m})&&s()}}),M&&(0,ve.jsx)("div",{style:{display:"flex",marginLeft:10,alignItems:"center"},children:(0,ve.jsx)(v.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>(0,ve.jsx)("span",{style:f.regular,children:e}),databaseWithIcon:(0,ve.jsxs)(fe.Z,{href:d,style:{marginLeft:D.Qi},innerStyle:{display:"flex"},onClick:()=>{P.ZZ8(l,{from:r})},children:[(0,ve.jsx)(Q.Z,{disabled:!0,icon:S,isEmptyPage:!1,size:20}),(0,ve.jsx)(L.Z,{store:u,underline:!0,style:f.recordTitle})]})}})})]})}function Ce(){return Pe.sprintTypedPropertyInputAddPlaceholder}var be=o(54780);class Me extends r.Z{constructor(){super(...arguments),this.storeTypes={store:pe.Z,requestStore:de.Z},this.maybeOverwriteBaseUrlFromSpaceId=(0,ee.b)(this.environment),this.isMemberOfSpace=this.createComputedStore((()=>{var e;return null===(e=ae.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()})),this.addPage=async e=>{const{collectionStore:t,blockPropertyValueOverlayStore:o,blockStore:r,schema:n,property:i}=this.props,a=this.getRenderState();if(!a)return;const{targetCollectionStore:s}=a,c=s.getFormat().integration_id,d=le.Z.externalAuthentications.state.filter((e=>e.integration_id===c))[0],p=s.getFormat().pattern_name,h=le.Z.integrations.state.find((e=>e.id===c)),{searchQuery:g}=this.stores.store.state,m=(0,te.OY)(r)?r:void 0,y=(0,te.OY)(r)?r.getPropertyStore(i):void 0;this.stores.store.setState({...this.stores.store.state,addingPage:!0});try{var x,_;if(!(t&&h&&m&&y))return;const r=l.rq(y.getValue()),a=e||g||"";if(!(0,oe.DB)({integration:h,patternName:p,url:a}))return void M.showDialog({items:[{label:(0,ve.jsx)(v.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:()=>{b.RD({environment:this.environment,stringValue:JSON.stringify({botId:null==d?void 0:d.parent_id,url:a},null,2),copiedMessage:b.tq.copiedToClipboard})}},{label:(0,ve.jsx)(v.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:(0,ve.jsx)(v.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const c=n[i],F=l.Kp(c),Z=F?y.id:void 0,j=l.gg(c),D=l.ic(c),U=l.U8(c),V=l.yF(c),q=D&&se.default.checkGate("figma_connected_relation"),B=U&&se.default.checkGate("zendesk_connected_relation"),T=V&&se.default.checkGate("cron_connected_relation"),G=U&&se.default.checkGate("zendesk_ai_enabled"),O=j&&se.default.checkGate("google_drive_connected_relation"),A=(0,$.NP)(h.id),Q=(null==h?void 0:h.id)===u.U9?null===(x=A[0])||void 0===x?void 0:x.id:null==d?void 0:d.parent_id,L=F||O||B||T||q?A.map((e=>e.id)):[Q],E=await w.yp({environment:this.environment,url:a,botIds:L,userDefinedExternalCollectionStore:s,relatedPageId:Z});if(!E)return;const N=(null===(_=ue.subscriptionDataStoreInstance.state)||void 0===_?void 0:_.addOns)??[];if(G&&(0,f.de)(N)){const e=this.environment;C.getZendeskTicketConversation(e,{ticketUrl:a,spaceId:E.getSpaceId(),botId:L[0],pageId:y.id}),Y.j(e,"zendesk_unfurl_ai")}k.createAndCommit({userAction:"connectedRelationPropertyMenuResults.createRelationPage",environment:this.environment,perform:e=>{const t={id:E.id,table:S.iU,spaceId:E.getSpaceId()},n=null!=c&&c.limit?[t]:[...r,t],a=l.ow(n);I.sO({store:y,value:a,transaction:e}),o&&o.state.isOpen&&o.state.collectionContextStore&&(R.rv({environment:this.environment,collectionContextStore:o.state.collectionContextStore,block_id:m.id,property:i,property_type:"relation",from:"relation_section",isFromBulkActionsToolbar:!1,integration_id:h.id,action:"add"}),P.W2j(this.environment,{...(0,H.Pn)(o.state.collectionContextStore),from:"relation_menu",type:"page",integration_id:h.id,creating_block_id:m.id}))}}),this.stores.store.reset()}finally{this.stores.store.setState({...this.stores.store.state,addingPage:!1})}},this.handleSearchInputChange=e=>{const t=e.target.value;this.stores.store.setState({...this.stores.store.state,searchQuery:t,searchLimit:pe.Z.limitIncrement})},this.handleMobileTargetCollectionClick=()=>{const e=this.getRenderState();e&&(x.c4({environment:this.environment,url:e.targetParentUrl}),P.ZZ8(this.environment,{from:this.props.analyticsFrom}))},this.handleMobileSearchInputClick=()=>{const e=this.stores.store.state;this.stores.store.setState({...this.stores.store.state,searchQuery:e.searchQuery,searchPopupOpen:!0,searchLimit:pe.Z.limitIncrement})},this.handleSelectedPageClick=(e,t)=>{const{mainEditorCurrentBlockStore:o}=ae.default.state;if(!o)return;let r;if(t){const t=ce.G.createChildStore(o,e.pointer),n=t.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(t.getSpaceId()):void 0;r=(0,d.Z)({pageId:e.pointer.id,pageModel:t.getModel(),baseUrl:n,pageVisitSource:i.tY.LinkInPage})}else{const t=o.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(o.getSpaceId()):void 0;r=(0,d.Z)({pageId:o.id,pageModel:o.getModel(),baseUrl:t,peekViewBlockId:e.pointer.id,pageVisitSource:i.tY.LinkInPage})}x.c4({environment:this.environment,url:r,openInNew:t}),P.XXm(this.environment,{from:this.props.analyticsFrom,meta_click:Boolean(t)})},this.handleValueRelationPropertyMenuResultsAccept=(e,t)=>{e.type===D.Rt.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleSearchRelationPropertyMenuResultsAccept=(e,t)=>{var o;if(this.props.disabled)return;const{value:r,onChange:n,overlayMode:i}=this.props,{mainEditorCurrentBlockStore:a}=ae.default.state;if(!a)return;const s=null===(o=this.getRenderState())||void 0===o?void 0:o.propertySchema.limit;if(e.type===D.Rt.SearchPage){var l,c,d,u;n({value:s?[e.pointer]:"add"===(null==i?void 0:i.type)?[...r.slice(0,i.index),e.pointer,...r.slice(i.index)]:[...r,e.pointer]}),P.dw6(this.environment,{from:this.props.analyticsFrom,collection_id:null===(l=this.props.collectionStore)||void 0===l?void 0:l.id,collection_view_id:null===(c=this.context.collectionContextStore)||void 0===c||null===(c=c.collectionViewStore())||void 0===c?void 0:c.id,collection_view_block_id:null===(d=this.context.collectionContextStore)||void 0===d||null===(d=d.collectionViewBlockStore())||void 0===d?void 0:d.id,target_collection_id:null===(u=this.getRenderState())||void 0===u||null===(u=u.targetCollectionStore)||void 0===u?void 0:u.id})}else e.type===D.Rt.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleCreateNewPage=e=>{var t,o,r;const{searchQuery:n}=this.stores.store.state,i=(0,m.ZP)(),a=null===(t=this.getRenderState())||void 0===t?void 0:t.targetCollectionStore.getSpaceId(),{value:s,onChange:l}=this.props,c=null===(o=this.getRenderState())||void 0===o?void 0:o.propertySchema.limit,d={id:i,table:S.iU,spaceId:a};l({newPage:{id:i,spaceId:a,name:n},value:c?[d]:e?[...s.slice(0,e),d,...s.slice(e)]:[...s,d]}),P.W2j(this.environment,{...(0,H.Pn)(this.context.collectionContextStore),from:"relation_menu",type:"page",target_collection_id:null===(r=this.getRenderState())||void 0===r||null===(r=r.targetCollectionStore)||void 0===r?void 0:r.id,new_page_id:i,creating_block_id:i})},this.handleClickActionButton=e=>{var t;const{value:o,onChange:r,overlayMode:n}=this.props,{mainEditorCurrentBlockStore:i}=ae.default.state;if(!i)return;const a=null===(t=this.getRenderState())||void 0===t?void 0:t.propertySchema.limit;if(e.type===D.Rt.SearchPage){var s;r({value:a?[e.pointer]:"add"===(null==n?void 0:n.type)?[...o.slice(0,n.index),e.pointer,...o.slice(n.index)]:[...o,e.pointer]}),P.dw6(this.environment,{from:this.props.analyticsFrom,...(0,H.Pn)(this.context.collectionContextStore),target_collection_id:null===(s=this.getRenderState())||void 0===s||null===(s=s.targetCollectionStore)||void 0===s?void 0:s.id})}else if(e.type===D.Rt.SelectedPage){var l;r({value:a?[]:o.filter((t=>t.id!==e.pointer.id))}),P.WFT(this.environment,{...(0,H.Pn)(this.context.collectionContextStore),from:this.props.analyticsFrom,target_collection_id:null===(l=this.getRenderState())||void 0===l||null===(l=l.targetCollectionStore)||void 0===l?void 0:l.id})}var c;a&&(null===(c=this.props.blockPropertyValueOverlayStore)||void 0===c||c.setState({isOpen:!1}))},this.handleMobileSearchMenuClickRight=()=>{this.resetInputState()},this.handleSearchScrollOffsetChange=e=>{const{store:t,requestStore:o}=this.stores,{loading:r,result:n}=o.state;e<pe.Z.incrementScrollOffset&&n&&!r&&n.results.length>=t.state.searchLimit&&t.setState({...t.state,searchLimit:t.state.searchLimit+pe.Z.limitIncrement})},this.performSearchRequest=async e=>{const{disabled:t}=this.props,o=this.getRenderState();if(!o)return[];if(t)return[];if(l.gg(o.propertySchema)||l.ic(o.propertySchema))return[];const{targetCollectionStore:r,propertySchema:n}=o;return await function(e){let{extensionPoint:t,appConfigUri:o,behaviorFnArgs:r}=e;const{behaviorFnMap:n}=q[t],i=n.default;if(!o)return i(r);const a=n[o];return a?a(r):i(r)}({extensionPoint:"relationPropertySearchRequest",appConfigUri:r.getDatabaseType(),behaviorFnArgs:{environment:this.environment,query:e,targetCollectionStore:r,propertySchema:n,blockPointers:this.props.value}})},this.getRecordModel=g.om.fromMonomorphicFunctionUnsafe((e=>ce.G.createChildStore(this.props.blockStore,e).getRecordModel(e)),y.mF.fromMonomorphicFunctionUnsafe((e=>{const t=ce.G.createChildStore(this.props.blockStore,e);return t.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:o}=e;return o(t)}))})))}didMount(){super.didMount(),n.default.afterNextFlush((()=>{n.default.afterNextFlush((()=>{const e=this.getRenderState();if(e){0===this.getValueResults(e).length&&this.stores.store.setState({searchPopupOpen:this.environment.device.isMobile,searchQuery:this.props.insertChar??"",searchLimit:pe.Z.limitIncrement,addingPage:!1})}}))}))}renderComponent(){const{device:e}=this.environment,t=this.getRenderState();if(t)return(0,ve.jsx)(T.Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowUndo:!0,allowTabUntab:!0,render:()=>e.isMobile?this.renderMobileMenu(t):this.renderDesktopMenu(t)})}renderDesktopMenu(e){const{searchQuery:t}=this.stores.store.state,o=this.stores.requestStore.state.result,{disabled:r,analyticsFrom:n,overlayMode:i}=this.props,{targetCollectionStore:a,connectedRelationFlags:{isGithubPrRelation:s,isGoogleDriveRelation:l,isFigmaRelation:c,isZendeskRelation:d}}=e,p=Boolean(le.Z.bots.state.find((e=>e.integration_id===u.U9))),h=s&&!p||(l||c||d)&&!this.isMemberOfSpace.state,g=i&&"add"===i.type?i.index:void 0;return(0,ve.jsx)(O.Z,{menuType:J.og.Popup,header:h?null:(0,ve.jsx)(Re,{store:this.stores.store,renderState:e,overlayMode:i,disabled:r,analyticsFrom:n,addPage:this.addPage}),footer:this.renderFooter({requestStateResult:o,searchQuery:t,overlayMode:i,disabled:r,targetCollectionStore:a,index:g,propertySchema:e.propertySchema}),children:(0,ve.jsx)("div",{style:{overflow:"hidden",maxHeight:"70vh"},children:this.renderSearchResults(e)})})}renderFooter(e){const{requestStateResult:t,searchQuery:o,overlayMode:r,disabled:n,targetCollectionStore:i,index:s,propertySchema:l}=e;return!(i.getFormatStore().getKeyStore("app_config_uri").getValue()===a.p$)&&"view"===(null==r?void 0:r.type)||n||l.connectedRelation?null:t&&t.results.length>0&&o&&(0,ve.jsx)(W.Z,{targetCollectionStore:i,title:o,onClick:this.handleCreateNewPage,focused:!1,isSection:!0,index:s})}renderMobileMenu(e){const{device:t}=this.environment,{searchPopupOpen:o}=this.stores.store.state,{collectionStore:r,property:n,schema:i,blockStore:a,blockPropertyValueOverlayStore:s,disabled:l,canConfigureCollection:c,onDismiss:d}=this.props,{showProperties:p,targetCollectionStore:g,connectedRelationFlags:{isGithubPrRelation:m,isGoogleDriveRelation:y,isFigmaRelation:S,isConnectedRelation:f}}=e,{mediumTextColor:P}=this.theme,R=this.getValueResults(e),C=Boolean(le.Z.bots.state.find((e=>e.integration_id===u.U9))),b=Boolean(le.Z.bots.state.find((e=>e.integration_id===u.f3))),M=Boolean(le.Z.bots.state.find((e=>e.integration_id===u.mQ))),I=m&&!C||y&&!b||S&&!M;return(0,ve.jsxs)(O.Z,{menuType:J.og.Modal,title:e.propertySchema.name,right:(0,ve.jsx)(v.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileMenuDone.button"}),onClickRight:d,children:[f?null:(0,ve.jsx)(E.Z,{disableMobilePadding:!0,children:(0,ve.jsx)(B.Z,{focused:!1,title:(0,ve.jsx)("div",{style:{display:"flex"},children:(0,ve.jsx)(v.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>e,databaseWithIcon:(0,ve.jsxs)("div",{style:{display:"flex",marginLeft:2*D.Qi},children:[(0,ve.jsx)(Q.Z,{disabled:!0,icon:g.getIcon(),isEmptyPage:!1,size:20}),(0,ve.jsx)(L.Z,{store:g,underline:!0,style:{marginLeft:D.Qi}})]})}})}),showExtensionArrow:!1,onClick:this.handleMobileTargetCollectionClick})}),I?null:(0,ve.jsx)(E.Z,{topBorder:!0,disableMobilePadding:!1,children:(0,ve.jsx)(A.GI,{popupType:A.kQ.SlideUp,open:o,origin:(0,ve.jsx)(B.Z,{focused:!1,title:(0,ve.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[(0,h.R)({marginRight:8,width:t.isMobile?16:14,height:t.isMobile?16:14}),(0,ve.jsx)(v.FormattedMessage,{defaultMessage:"Add a page",id:"relationPropertyMenu.addAPage.button"})]}),onClick:this.handleMobileSearchInputClick,style:{color:P}}),render:()=>this.renderSearchResults(e)})}),(0,ve.jsx)(be.Z,{collectionStore:r,targetCollectionStore:g,showProperties:p,results:R,resultsType:"existing",property:n,schema:i,parentStore:a,disabled:l,canConfigureCollection:c,loading:!1,canDrag:!1,blockPropertyValueOverlayStore:s,onAccept:this.handleValueRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onCreatePage:this.handleCreateNewPage,handleClearProperty:()=>ke(this.props.onChange),relationPropertyMenuStore:this.stores.store,addPage:this.addPage,addingPage:this.stores.store.state.addingPage})]})}renderSearchResults(e){const{device:t}=this.environment,{collectionStore:o,value:r,property:n,schema:i,blockStore:a,blockPropertyValueOverlayStore:d,disabled:u,canConfigureCollection:h,overlayMode:g}=this.props,{requestStore:m}=this.stores,{showProperties:y,targetCollectionStore:f,propertySchema:R}=e,{searchQuery:C,searchLimit:b}=this.stores.store.state;let M=ne.default.mark("rum.relation_search_query");const I=R.limit?r.slice(0,1):r,x={request:{query:C,limit:b},debounce:ie.vp,performRequest:async e=>({results:await this.performSearchRequest(e),query:e.query}),render:(r,m)=>{let b=[];b=C?this.getValueResults(e).filter((e=>{let{pageResult:t}=e;const o=ce.G.createChildStore(this.props.blockStore,t.pointer),r=o.getModel();if(r)return(0,c.fY)({block:r,query:C,getRecordModel:o.getRecordModel,userTimeZone:(0,p.r)(),schema:i,intl:X.default.getIntl(),onlyPropertyIds:["title"]})})):this.getValueResults(e);const x=!m&&0===b.length,k=b;m&&m.results.forEach((e=>{const t=e.pageResult;if((t.type===D.Rt.SelectedPage||t.type===D.Rt.SearchPage)&&b.find((e=>(e.pageResult.type===D.Rt.SelectedPage||e.pageResult.type===D.Rt.SearchPage)&&e.pageResult.pointer.id===t.pointer.id)))return;const o=e.pageResult.type!==D.Rt.NewPage?I.map((e=>e.id)).includes(e.pageResult.pointer.id):void 0;o&&!C&&"add"===(null==g?void 0:g.type)||(e.pageResult.type===D.Rt.SearchPage&&o?k.push({...e,pageResult:{...e.pageResult,type:D.Rt.SelectedPage}}):e.pageResult.type!==D.Rt.SelectedPage||o?k.push(e):k.push({...e,pageResult:{...e.pageResult,type:D.Rt.SearchPage}}))})),!x&&""!==C&&M&&m&&m.query===C&&(ne.default.measure(M,{environment:this.environment}),M=void 0);const w=(0,ve.jsx)(be.Z,{collectionStore:o,targetCollectionStore:f,showProperties:y,results:k,resultsType:0===k.length&&0===this.getValueResults(e).length?"existing":"search",property:n,schema:i,parentStore:a,disabled:u,canConfigureCollection:h,loading:x,canDrag:!u&&0===C.length,blockPropertyValueOverlayStore:d,onAccept:this.handleSearchRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onScrollOffsetChange:this.handleSearchScrollOffsetChange,onDrag:e=>function(e,t,o,r,n){o({value:e.map((e=>({id:e,spaceId:t.pointer.spaceId,table:S.iU})))}),P.yT1(n,{from:r})}(e,this.props.collectionStore,this.props.onChange,this.props.analyticsFrom,this.environment),onCreatePage:this.handleCreateNewPage,handleClearProperty:()=>ke(this.props.onChange),searchQuery:C,overlayMode:g,relationPropertyMenuStore:this.stores.store,addPage:this.addPage,addingPage:this.stores.store.state.addingPage});if(t.isMobile){let e=X.default.formatMessage(Pe.inputPlaceholder);const o=s.NK(R);return o&&(e=X.default.formatMessage(Pe.connectedRelationInputPlaceholder)),l.gg(R)&&(e=X.default.formatMessage(Pe.connectedRelationGoogleDriveInputPlaceholder)),l.ic(R)&&(e=X.default.formatMessage(Pe.connectedRelationFigmaInputPlaceholder)),l.Kp(R)&&(e=X.default.formatMessage(Pe.connectedRelationGithubInputPlaceholder)),(0,ve.jsx)(O.Z,{menuType:J.og.Modal,title:(0,ve.jsx)(v.FormattedMessage,{defaultMessage:"Relation",id:"relationPropertyMenu.mobileRelationMenu.title"}),left:(0,ve.jsx)(xe,{}),right:(0,ve.jsx)(v.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileDoneButton"}),header:(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(G.ZP,{value:C,disabled:u,onChange:this.handleSearchInputChange,placeholder:e,showClearButton:!0,focus:!t.isMobile||void 0,focusInitial:!0,style:{...t.isAndroid&&{borderBottom:"none"}}}),C&&!u&&!o&&(0,ve.jsx)(W.Z,{targetCollectionStore:f,title:C,onClick:this.handleCreateNewPage,focused:!1,isSection:!0})]}),onClickRight:this.handleMobileSearchMenuClickRight,children:w})}return w}};return(0,ve.jsx)(z.Z,{...x,requestStore:m})}getRenderState(){const{schema:e,property:t,blockStore:o,collectionStore:r}=this.props,n=e[t];if(!n||"relation"!==n.type)return;const i=s.j0(n);if(!i)return;const a=ce.NW.createChildStore(o,i),c=a.getParentId();if(!c)return;const u=ce.G.createChildStore(a,{table:S.iU,id:c}),p=s.oC({id:a.id,schema:a.getSchema(),format:a.getFormat(),space_id:a.getSpaceId()}),h=[p[`${l.UU}title`]?`${l.UU}title`:"title"],g=u.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(u.getSpaceId()):void 0,m=(0,d.Z)({pageId:u.id,pageModel:u.getModel(),baseUrl:g,pageVisitSource:void 0});return{propertySchema:n,property:t,targetCollectionStore:a,targetParentBlock:u,showProperties:h,targetCollectionSchema:p,targetParentUrl:m,collectionStore:r,connectedRelationFlags:we({targetCollectionStore:a,propertySchema:n})}}resetInputState(){this.stores.store.reset()}getValueResults(e){const{value:t,overlayMode:o}=this.props,{propertySchema:r,targetCollectionStore:n}=e,{searchQuery:i}=this.stores.store.state;return i||"add"!==(null==o?void 0:o.type)?l.j$({relationValue:t,propertySchema:r,getRecordModel:this.getRecordModel}).map((e=>({pageResult:{key:e.id,type:D.Rt.SelectedPage,pointer:e},canEdit:(0,Z.dN)({targetCollectionStore:n,propertySchema:r,pointer:e})}))):[]}}Me.displayName="RelationPropertyMenu",Me.contextTypes={...r.w,...K.xm};const Ie=Me;function xe(){return(0,ve.jsx)(N.Z,{href:(0,re.UY)("guides.relations"),analyticsFrom:"relation_menu"})}function ke(e){e({value:[]})}function we(e){const{targetCollectionStore:t,propertySchema:o}=e;return{isSyncedCollectionRelation:t.isSyncedCollection(),isGithubPrRelation:l.Kp(o),isGoogleDriveRelation:l.gg(o),isFigmaRelation:l.ic(o),isZendeskRelation:l.U8(o),isConnectedRelation:s.NK(o)}}}}]);