"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7233],{37233:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Pe});r(57658),r(21703),r(67294);var o=r(83355),i=r(1302),n=r(480),a=r(86628),s=r(24405),l=r(15145),c=r(92996),d=r(61514),p=r(99036),u=r(80951),h=r(43690),g=r(1800),y=r(77657),m=r(68626),S=r(42875),f=r(47453),v=r(91155),P=r(59753),R=r(4615),C=r(74446),b=r(21202),M=r(3791),I=r(82990),x=r(9291),k=r(50906),_=r(8406),w=r(54642),F=r(893),Z=r(47307),j=r(9953),V=r(8055),U=r(82530),B=r(12170),D=r(52275),T=r(36488),O=r(74194),q=r(68894),A=r(84076),Q=r(78140),G=r(53437),E=r(31278),L=r(76798),N=r(72495),K=r(46247),W=r(9897),z=r(66890),$=r(23586),Y=r(77472),H=r(70764),X=r(75079),J=r(33929),ee=r(87279),te=r(70219),re=r(65598),oe=r(18514),ie=r(77907),ne=r(18245),ae=r(75822),se=r(80444),le=r(77080),ce=r(30874),de=r(26136),pe=r(72087),ue=r(88280),he=r(51741),ge=r(30926),ye=r(54780),me=r(85893);const Se=(0,x.defineMessages)({inputPlaceholder:{defaultMessage:"Link or create a page…",id:"relationPropertyMenu2.searchPlaceholder"},searchLinkedInputPlaceholder:{defaultMessage:"Search linked pages…",id:"relationPropertyMenu2.viewExisting.searchPlaceholder"},syncedCollectionInputPlaceholder:{defaultMessage:"Link a page",id:"relationPropertyMenu2.syncedCollection.searchPlaceholder"},connectedRelationInputPlaceholder:{defaultMessage:"Find a page",id:"relationPropertyMenu2.connectedRelation.searchPlaceholder"},connectedRelationGoogleDriveInputPlaceholder:{defaultMessage:"Paste in Google Drive or Google Docs link",id:"relationPropertyMenu2.connectedRelationGoogleDrive.searchPlaceholder"},connectedRelationFigmaInputPlaceholder:{defaultMessage:"Paste in https://figma.com/...",id:"relationPropertyMenu2.connectedRelationFigma.searchPlaceholder"},connectedRelationGithubInputPlaceholder:{defaultMessage:"Paste in https://github.com/...",id:"relationPropertyMenu2.connectedRelationGithub.searchPlaceholder"},sprintTypedPropertyInputAddPlaceholder:{defaultMessage:"Search...",id:"relationPropertyMenu2.sprintTypedPropertyInputAddPlaceholder.searchPlaceholder"},sprintTypedPropertyInputViewPlaceholder:{defaultMessage:"Search linked sprints…",id:"relationPropertyMenu2.sprintTypedPropertyInputViewPlaceholder.searchPlaceholder"}});class fe extends o.Z{constructor(){super(...arguments),this.storeTypes={store:ge.Z,requestStore:pe.Z},this.maybeOverwriteBaseUrlFromSpaceId=(0,te.b)(this.environment),this.isMemberOfSpace=this.createComputedStore((()=>{var e;return null===(e=se.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()})),this.addPage=async e=>{const{collectionStore:t,blockPropertyValueOverlayStore:r,blockStore:o,schema:i,property:n}=this.props,a=this.getRenderState();if(!a)return;const{targetCollectionStore:s}=a,l=s.getFormat().integration_id,c=ce.Z.externalAuthentications.state.filter((e=>e.integration_id===l))[0],d=s.getFormat().pattern_name,p=ce.Z.integrations.state.find((e=>e.id===l)),{searchQuery:h}=this.stores.store.state,g=(0,re.OY)(o)?o:void 0,m=(0,re.OY)(o)?o.getPropertyStore(n):void 0;this.stores.store.setState({...this.stores.store.state,addingPage:!0});try{var S,f;if(!(t&&p&&g&&m))return;const o=u.rq(m.getValue()),a=e||h||"";if(!Re({integration:p,patternName:d,url:a}))return void Z.showDialog({items:[{label:(0,me.jsx)(x.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:()=>{F.RD({environment:this.environment,stringValue:JSON.stringify({botId:null==c?void 0:c.parent_id,url:a},null,2),copiedMessage:F.tq.copiedToClipboard})}},{label:(0,me.jsx)(x.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:(0,me.jsx)(x.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const l=i[n],v=u.Kp(l),P=v?m.id:void 0,R=u.gg(l),C=u.ic(l),I=u.U8(l),V=u.yF(l),D=C&&le.default.checkGate("figma_connected_relation"),T=I&&le.default.checkGate("zendesk_connected_relation"),O=V&&le.default.checkGate("cron_connected_relation"),q=I&&le.default.checkGate("zendesk_ai_enabled"),A=R&&le.default.checkGate("google_drive_connected_relation"),Q=(0,H.NP)(p.id),G=(null==p?void 0:p.id)===y.U9?null===(S=Q[0])||void 0===S?void 0:S.id:null==c?void 0:c.parent_id,E=v||A||T||O||D?Q.map((e=>e.id)):[G],L=await B.yp({environment:this.environment,url:a,botIds:E,userDefinedExternalCollectionStore:s,relatedPageId:P});if(!L)return;const N=(null===(f=ue.subscriptionDataStoreInstance.state)||void 0===f?void 0:f.addOns)??[];if(q&&(0,M.de)(N)){const e=this.environment;w.getZendeskTicketConversation(e,{ticketUrl:a,spaceId:L.getSpaceId(),botId:E[0],pageId:m.id}),Y.j(e,"zendesk_unfurl_ai")}U.createAndCommit({userAction:"connectedRelationPropertyMenuResults.createRelationPage",environment:this.environment,perform:e=>{const t={id:L.id,table:b.iU,spaceId:L.getSpaceId()},i=null!=l&&l.limit?[t]:[...o,t],a=u.ow(i);j.sO({store:m,value:a,transaction:e}),r&&r.state.isOpen&&r.state.collectionContextStore&&(_.rv({environment:this.environment,collectionContextStore:r.state.collectionContextStore,block_id:g.id,property:n,property_type:"relation",from:"relation_section",isFromBulkActionsToolbar:!1,integration_id:p.id,action:"add"}),k.W2j(this.environment,{...(0,X.Pn)(r.state.collectionContextStore),from:"relation_menu",type:"page",integration_id:p.id,creating_block_id:g.id}))}}),this.stores.store.reset()}finally{this.stores.store.setState({...this.stores.store.state,addingPage:!1})}},this.handleSearchInputChange=e=>{const t=e.target.value;this.stores.store.setState({...this.stores.store.state,searchQuery:t,searchLimit:ge.Z.limitIncrement})},this.handleMobileTargetCollectionClick=()=>{const e=this.getRenderState();e&&(V.c4({environment:this.environment,url:e.targetParentUrl}),k.ZZ8(this.environment,{from:this.props.analyticsFrom}))},this.handleMobileSearchInputClick=()=>{const e=this.stores.store.state;this.stores.store.setState({...this.stores.store.state,searchQuery:e.searchQuery,searchPopupOpen:!0,searchLimit:ge.Z.limitIncrement})},this.handleSelectedPageClick=(e,t)=>{const{mainEditorCurrentBlockStore:r}=se.default.state;if(!r)return;let o;if(t){const t=de.G.createChildStore(r,e.pointer),i=t.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(t.getSpaceId()):void 0;o=(0,g.Z)({pageId:e.pointer.id,pageModel:t.getModel(),baseUrl:i,pageVisitSource:l.tY.LinkInPage})}else{const t=r.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(r.getSpaceId()):void 0;o=(0,g.Z)({pageId:r.id,pageModel:r.getModel(),baseUrl:t,peekViewBlockId:e.pointer.id,pageVisitSource:l.tY.LinkInPage})}V.c4({environment:this.environment,url:o,openInNew:t}),k.XXm(this.environment,{from:this.props.analyticsFrom,meta_click:Boolean(t)})},this.handleValueRelationPropertyMenuResultsAccept=(e,t)=>{e.type===he.Rt.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleSearchRelationPropertyMenuResultsAccept=(e,t)=>{var r;if(this.props.disabled)return;const{value:o,onChange:i,overlayMode:n}=this.props,{mainEditorCurrentBlockStore:a}=se.default.state;if(!a)return;const s=null===(r=this.getRenderState())||void 0===r?void 0:r.propertySchema.limit;if(e.type===he.Rt.SearchPage){var l,c,d,p;i({value:s?[e.pointer]:"add"===(null==n?void 0:n.type)?[...o.slice(0,n.index),e.pointer,...o.slice(n.index)]:[...o,e.pointer]}),k.dw6(this.environment,{from:this.props.analyticsFrom,collection_id:null===(l=this.props.collectionStore)||void 0===l?void 0:l.id,collection_view_id:null===(c=this.context.collectionContextStore)||void 0===c||null===(c=c.collectionViewStore())||void 0===c?void 0:c.id,collection_view_block_id:null===(d=this.context.collectionContextStore)||void 0===d||null===(d=d.collectionViewBlockStore())||void 0===d?void 0:d.id,target_collection_id:null===(p=this.getRenderState())||void 0===p||null===(p=p.targetCollectionStore)||void 0===p?void 0:p.id})}else e.type===he.Rt.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleCreateNewPage=e=>{var t,r,o;const{searchQuery:i}=this.stores.store.state,n=(0,R.ZP)(),a=null===(t=this.getRenderState())||void 0===t?void 0:t.targetCollectionStore.getSpaceId(),{value:s,onChange:l}=this.props,c=null===(r=this.getRenderState())||void 0===r?void 0:r.propertySchema.limit,d={id:n,table:b.iU,spaceId:a};l({newPage:{id:n,spaceId:a,name:i},value:c?[d]:e?[...s.slice(0,e),d,...s.slice(e)]:[...s,d]}),k.W2j(this.environment,{...(0,X.Pn)(this.context.collectionContextStore),from:"relation_menu",type:"page",target_collection_id:null===(o=this.getRenderState())||void 0===o||null===(o=o.targetCollectionStore)||void 0===o?void 0:o.id,new_page_id:n,creating_block_id:n})},this.handleClickActionButton=e=>{var t;const{value:r,onChange:o,overlayMode:i}=this.props,{mainEditorCurrentBlockStore:n}=se.default.state;if(!n)return;const a=null===(t=this.getRenderState())||void 0===t?void 0:t.propertySchema.limit;if(e.type===he.Rt.SearchPage){var s;o({value:a?[e.pointer]:"add"===(null==i?void 0:i.type)?[...r.slice(0,i.index),e.pointer,...r.slice(i.index)]:[...r,e.pointer]}),k.dw6(this.environment,{from:this.props.analyticsFrom,...(0,X.Pn)(this.context.collectionContextStore),target_collection_id:null===(s=this.getRenderState())||void 0===s||null===(s=s.targetCollectionStore)||void 0===s?void 0:s.id})}else if(e.type===he.Rt.SelectedPage){var l;o({value:a?[]:r.filter((t=>t.id!==e.pointer.id))}),k.WFT(this.environment,{...(0,X.Pn)(this.context.collectionContextStore),from:this.props.analyticsFrom,target_collection_id:null===(l=this.getRenderState())||void 0===l||null===(l=l.targetCollectionStore)||void 0===l?void 0:l.id})}var c;a&&(null===(c=this.props.blockPropertyValueOverlayStore)||void 0===c||c.setState({isOpen:!1}))},this.handleMobileSearchMenuClickRight=()=>{this.resetInputState()},this.handleSearchScrollOffsetChange=e=>{const{store:t,requestStore:r}=this.stores,{loading:o,result:i}=r.state;e<ge.Z.incrementScrollOffset&&i&&!o&&i.results.length>=t.state.searchLimit&&t.setState({...t.state,searchLimit:t.state.searchLimit+ge.Z.limitIncrement})},this.performSearchRequest=async e=>{const{disabled:t}=this.props,r={results:[],query:e.query},o=this.getRenderState();if(!o)return r;if(t)return r;if(u.gg(o.propertySchema)||u.ic(o.propertySchema))return r;const{targetCollectionStore:i}=o;let n=[];if(i.getFormatStore().getKeyStore("app_config_uri").getValue()===c.p$)try{return n=Me(await async function(e){const{environment:t,sprintCollectionStore:r,searchQuery:o}=e,i=r.getPropertyMapping(),n=null==i?void 0:i[d.b0.StatusV2],a=null==i?void 0:i[d.b0.Dates];if(!n||!a)throw new Error("Sprints database does not have the required properties");const s="results",l={type:"reducer",userTimeZone:(0,S.r)(),searchQuery:o,sort:[{property:n,direction:"ascending"},{property:a,direction:"ascending"}],reducers:{[s]:{type:"results",limit:100}}},c=r.getParentBlockStore();if(!c)return[];await c.load();const p=c.getCollectionViewStores()[0];if(!p)return[];const u=r.getSpaceId(),h=await w.queryCollection(t,{source:{type:"collection",id:r.id,spaceId:u},collectionView:{id:p.id,spaceId:u},loader:l},void 0,{src:"relation_property_menu"});if("success"!==h.type)return[];const g=h.data.result.reducerResults[s];if("results"!==g.type)return[];return g.blockIds}({environment:this.environment,sprintCollectionStore:i,searchQuery:e.query}),i,o.propertySchema,this.props.value),{results:n,query:e.query}}catch(a){}try{const t=await ie.deps.searchActions.loader(),{results:r}=await t.searchPagesInCollection({environment:this.environment,query:e.query,collectionId:i.id,limit:e.limit,spaceId:i.getSpaceId(),excludeTemplates:!0,source:"relation_menu",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!0,ignoresHighlight:!0});n=Me(r,i,o.propertySchema,this.props.value)}catch(a){m.log({level:"error",from:"relationPropertyMenu",type:"search",error:(0,v.Ui)(a)})}return{results:n,query:e.query}},this.getRecordModel=P.om.fromMonomorphicFunctionUnsafe((e=>de.G.createChildStore(this.props.blockStore,e).getRecordModel(e)),C.mF.fromMonomorphicFunctionUnsafe((e=>{const t=de.G.createChildStore(this.props.blockStore,e);return t.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:r}=e;return r(t)}))})))}didMount(){super.didMount(),i.default.afterNextFlush((()=>{i.default.afterNextFlush((()=>{const e=this.getRenderState();if(e){0===this.getValueResults(e).length&&this.stores.store.setState({searchPopupOpen:this.environment.device.isMobile,searchQuery:this.props.insertChar??"",searchLimit:ge.Z.limitIncrement,addingPage:!1})}}))}))}renderComponent(){const{device:e}=this.environment,t=this.getRenderState();if(t)return(0,me.jsx)(T.Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowUndo:!0,allowTabUntab:!0,render:()=>e.isMobile?this.renderMobileMenu(t):this.renderDesktopMenu(t)})}renderDesktopMenu(e){const{searchQuery:t}=this.stores.store.state,r=this.stores.requestStore.state.result,{blockStore:o,disabled:i,analyticsFrom:n,overlayMode:a}=this.props,{targetCollectionStore:s}=e,l=Boolean(ce.Z.bots.state.find((e=>e.integration_id===y.U9))),c=u.Kp(e.propertySchema),d=u.gg(e.propertySchema),p=u.ic(e.propertySchema),h=u.U8(e.propertySchema),g=c&&!l||(d||p||h)&&!this.isMemberOfSpace.state,m=a&&"add"===a.type?a.index:void 0;return(0,me.jsx)(Q.Z,{menuType:ee.og.Popup,header:g?null:(0,me.jsx)(ve,{store:this.stores.store,disabled:i,renderState:e,blockStore:o,analyticsFrom:n,isConnectedRelation:Boolean(e.propertySchema.connectedRelation),overlayMode:a,addPage:this.addPage}),footer:this.renderFooter({requestStateResult:r,searchQuery:t,overlayMode:a,disabled:i,targetCollectionStore:s,index:m,propertySchema:e.propertySchema}),children:(0,me.jsx)("div",{style:{overflow:"hidden",maxHeight:"70vh"},children:this.renderSearchResults(e)})})}renderFooter(e){const{requestStateResult:t,searchQuery:r,overlayMode:o,disabled:i,targetCollectionStore:n,index:a,propertySchema:s}=e;return!(n.getFormatStore().getKeyStore("app_config_uri").getValue()===c.p$)&&"view"===(null==o?void 0:o.type)||i||s.connectedRelation?null:t&&t.results.length>0&&r&&(0,me.jsx)(W.Z,{targetCollectionStore:n,title:r,onClick:this.handleCreateNewPage,focused:!1,isSection:!0,index:a})}renderMobileMenu(e){const{device:t}=this.environment,{searchPopupOpen:r}=this.stores.store.state,{collectionStore:o,property:i,schema:n,blockStore:a,blockPropertyValueOverlayStore:s,disabled:l,canConfigureCollection:c,onDismiss:d}=this.props,{showProperties:h,targetCollectionStore:g}=e,{mediumTextColor:m}=this.theme,S=this.getValueResults(e),v=n[i],P=v&&p.NK(v),R=Boolean(ce.Z.bots.state.find((e=>e.integration_id===y.U9))),C=Boolean(ce.Z.bots.state.find((e=>e.integration_id===y.f3))),b=Boolean(ce.Z.bots.state.find((e=>e.integration_id===y.mQ))),M=u.Kp(e.propertySchema),I=u.gg(e.propertySchema),k=u.ic(e.propertySchema),_=M&&!R||I&&!C||k&&!b;return(0,me.jsxs)(Q.Z,{menuType:ee.og.Modal,title:e.propertySchema.name,right:(0,me.jsx)(x.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileMenuDone.button"}),onClickRight:d,children:[P?null:(0,me.jsx)(N.Z,{disableMobilePadding:!0,children:(0,me.jsx)(D.Z,{focused:!1,title:(0,me.jsx)("div",{style:{display:"flex"},children:(0,me.jsx)(x.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>e,databaseWithIcon:(0,me.jsxs)("div",{style:{display:"flex",marginLeft:2*he.Qi},children:[(0,me.jsx)(E.Z,{disabled:!0,icon:g.getIcon(),isEmptyPage:!1,size:20}),(0,me.jsx)(L.Z,{store:g,underline:!0,style:{marginLeft:he.Qi}})]})}})}),showExtensionArrow:!1,onClick:this.handleMobileTargetCollectionClick})}),_?null:(0,me.jsx)(N.Z,{topBorder:!0,disableMobilePadding:!1,children:(0,me.jsx)(G.GI,{popupType:G.kQ.SlideUp,open:r,origin:(0,me.jsx)(D.Z,{focused:!1,title:(0,me.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[(0,f.R)({marginRight:8,width:t.isMobile?16:14,height:t.isMobile?16:14}),(0,me.jsx)(x.FormattedMessage,{defaultMessage:"Add a page",id:"relationPropertyMenu.addAPage.button"})]}),onClick:this.handleMobileSearchInputClick,style:{color:m}}),render:()=>this.renderSearchResults(e)})}),(0,me.jsx)(ye.Z,{collectionStore:o,targetCollectionStore:g,showProperties:h,results:S,resultsType:"existing",property:i,schema:n,parentStore:a,disabled:l,canConfigureCollection:c,loading:!1,canDrag:!1,blockPropertyValueOverlayStore:s,onAccept:this.handleValueRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onCreatePage:this.handleCreateNewPage,handleClearProperty:()=>Ie(this.props.onChange),relationPropertyMenuStore:this.stores.store,addPage:this.addPage,addingPage:this.stores.store.state.addingPage})]})}renderSearchResults(e){const{device:t}=this.environment,{collectionStore:r,value:o,property:i,schema:n,blockStore:a,blockPropertyValueOverlayStore:s,disabled:l,canConfigureCollection:c,overlayMode:d}=this.props,{requestStore:g}=this.stores,{showProperties:y,targetCollectionStore:m,propertySchema:f}=e,{searchQuery:v,searchLimit:P}=this.stores.store.state;let R=ne.default.mark("rum.relation_search_query");const C=f.limit?o.slice(0,1):o,M={request:{query:v,limit:P},debounce:ae.vp,performRequest:this.performSearchRequest,render:(o,g)=>{let P=[];P=v?this.getValueResults(e).filter((e=>{let{pageResult:t}=e;const r=de.G.createChildStore(this.props.blockStore,t.pointer),o=r.getModel();if(o)return(0,h.fY)({block:o,query:v,getRecordModel:r.getRecordModel,userTimeZone:(0,S.r)(),schema:n,intl:J.default.getIntl(),onlyPropertyIds:["title"]})})):this.getValueResults(e);const M=!g&&0===P.length,I=P;g&&g.results.forEach((e=>{const t=e.pageResult;if((t.type===he.Rt.SelectedPage||t.type===he.Rt.SearchPage)&&P.find((e=>(e.pageResult.type===he.Rt.SelectedPage||e.pageResult.type===he.Rt.SearchPage)&&e.pageResult.pointer.id===t.pointer.id)))return;const r=e.pageResult.type!==he.Rt.NewPage?C.map((e=>e.id)).includes(e.pageResult.pointer.id):void 0;r&&!v&&"add"===(null==d?void 0:d.type)||(e.pageResult.type===he.Rt.SearchPage&&r?I.push({...e,pageResult:{...e.pageResult,type:he.Rt.SelectedPage}}):e.pageResult.type!==he.Rt.SelectedPage||r?I.push(e):I.push({...e,pageResult:{...e.pageResult,type:he.Rt.SearchPage}}))})),!M&&""!==v&&R&&g&&g.query===v&&(ne.default.measure(R,{environment:this.environment}),R=void 0);const _=(0,me.jsx)(ye.Z,{collectionStore:r,targetCollectionStore:m,showProperties:y,results:I,resultsType:0===I.length&&0===this.getValueResults(e).length?"existing":"search",property:i,schema:n,parentStore:a,disabled:l,canConfigureCollection:c,loading:M,canDrag:!l&&0===v.length,blockPropertyValueOverlayStore:s,onAccept:this.handleSearchRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onScrollOffsetChange:this.handleSearchScrollOffsetChange,onDrag:e=>function(e,t,r,o,i){r({value:e.map((e=>({id:e,spaceId:t.pointer.spaceId,table:b.iU})))}),k.yT1(i,{from:o})}(e,this.props.collectionStore,this.props.onChange,this.props.analyticsFrom,this.environment),onCreatePage:this.handleCreateNewPage,handleClearProperty:()=>Ie(this.props.onChange),searchQuery:v,overlayMode:d,relationPropertyMenuStore:this.stores.store,addPage:this.addPage,addingPage:this.stores.store.state.addingPage});if(t.isMobile){let e=J.default.formatMessage(Se.inputPlaceholder);const r=p.NK(f);return r&&(e=J.default.formatMessage(Se.connectedRelationInputPlaceholder)),u.gg(f)&&(e=J.default.formatMessage(Se.connectedRelationGoogleDriveInputPlaceholder)),u.ic(f)&&(e=J.default.formatMessage(Se.connectedRelationFigmaInputPlaceholder)),u.Kp(f)&&(e=J.default.formatMessage(Se.connectedRelationGithubInputPlaceholder)),(0,me.jsx)(Q.Z,{menuType:ee.og.Modal,title:(0,me.jsx)(x.FormattedMessage,{defaultMessage:"Relation",id:"relationPropertyMenu.mobileRelationMenu.title"}),left:(0,me.jsx)(be,{}),right:(0,me.jsx)(x.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileDoneButton"}),header:(0,me.jsxs)(me.Fragment,{children:[(0,me.jsx)(q.ZP,{value:v,disabled:l,onChange:this.handleSearchInputChange,placeholder:e,showClearButton:!0,focus:!t.isMobile||void 0,focusInitial:!0,style:{...t.isAndroid&&{borderBottom:"none"}}}),v&&!l&&!r&&(0,me.jsx)(W.Z,{targetCollectionStore:m,title:v,onClick:this.handleCreateNewPage,focused:!1,isSection:!0})]}),onClickRight:this.handleMobileSearchMenuClickRight,children:_})}return _}};return(0,me.jsx)($.Z,{...M,requestStore:g})}getRenderState(){const{schema:e,property:t,blockStore:r,collectionStore:o}=this.props,i=e[t];if(!i||"relation"!==i.type)return;const n=p.j0(i);if(!n)return;const a=de.NW.createChildStore(r,n),s=a.getParentId();if(!s)return;const l=de.G.createChildStore(a,{table:b.iU,id:s}),c=p.oC({id:a.id,schema:a.getSchema(),format:a.getFormat(),space_id:a.getSpaceId()}),d=[c[`${u.UU}title`]?`${u.UU}title`:"title"],h=l.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(l.getSpaceId()):void 0,y=(0,g.Z)({pageId:l.id,pageModel:l.getModel(),baseUrl:h,pageVisitSource:void 0});return{propertySchema:i,property:t,targetCollectionStore:a,targetParentBlock:l,showProperties:d,targetCollectionSchema:c,targetParentUrl:y,collectionStore:o}}resetInputState(){this.stores.store.reset()}getValueResults(e){const{value:t,overlayMode:r}=this.props,{propertySchema:o,targetCollectionStore:i}=e,{searchQuery:n}=this.stores.store.state;return n||"add"!==(null==r?void 0:r.type)?u.j$({relationValue:t,propertySchema:o,getRecordModel:this.getRecordModel}).map((e=>({pageResult:{key:e.id,type:he.Rt.SelectedPage,pointer:e},canEdit:Ce(i,o,e)}))):[]}}function ve(e){var t;window.__c={n:"RelationPropertyMenuInput"};const r=(0,n.O7)(),o=(0,n.Fy)(),{targetParentUrl:i,targetCollectionStore:l,propertySchema:d}=e.renderState,[p,h,g]=(0,a.AF)(e.store),{searchQuery:y,searchPopupOpen:m}=p,S=(0,a.VK)((()=>l.getIcon()),[l]),f=(0,a.VK)((()=>l.isSyncedCollection()),[l]),v=(0,a.VK)((()=>u.Kp(d)),[d]),P=(0,a.VK)((()=>u.gg(d)),[d]),R=(0,a.VK)((()=>u.ic(d)),[d]),C=(0,a.VK)((()=>l.getFormatStore().getKeyStore("app_config_uri").getValue()===c.p$),[l]),b=(0,s.yK)((e=>({regular:{color:e.mediumTextColor,whiteSpace:"nowrap",marginLeft:4},headerWrap:{display:"flex",width:"100%",position:"relative",zIndex:2,padding:"6px 10px",fontSize:14,background:e.inputBackground,boxShadow:`\n\t\t\t\t\t0 1px 0 ${e.darkDividerColor}\n\t\t\t\t`},recordTitle:{fontWeight:I.Z.fontWeight.semibold,fontSize:14,marginLeft:he.Qi*(o.isRetina?.5:1)},searchIcon:{fill:e.mediumIconColor,width:14,height:14,marginRight:10}})),[o.isRetina]);let M=Se.inputPlaceholder;if(f)M=Se.syncedCollectionInputPlaceholder;else if(v)M=Se.connectedRelationGithubInputPlaceholder;else if(P)M=Se.connectedRelationGoogleDriveInputPlaceholder;else if(R)M=Se.connectedRelationFigmaInputPlaceholder;else if(C){var _;"view"===(null===(_=e.overlayMode)||void 0===_?void 0:_.type)&&(M=Se.sprintTypedPropertyInputViewPlaceholder),M=Se.sprintTypedPropertyInputAddPlaceholder}else e.isConnectedRelation?M=Se.connectedRelationInputPlaceholder:("view"===(null===(t=e.overlayMode)||void 0===t?void 0:t.type)||e.disabled)&&(M=Se.searchLinkedInputPlaceholder);const w=J.default.formatMessage(M);return(0,me.jsxs)("div",{style:b.headerWrap,children:[(0,me.jsx)(O.Z,{style:{flexGrow:1},value:y,placeholder:w,forceShowClearButton:Boolean(y||m),focus:!0,onChange:e=>{const t=e.target.value;h({...p,searchQuery:t,searchPopupOpen:!!t,searchLimit:ge.Z.limitIncrement})},onClearButtonClick:()=>{h(g.getInitialState())},onClick:()=>{h({...p,searchQuery:p.searchQuery,searchPopupOpen:!0,searchLimit:ge.Z.limitIncrement})},onKeyDown:e=>{"Escape"===e.key&&h(g.getInitialState())},format:O.B.Transparent,onSubmit:()=>(()=>{const t=l.getFormat().integration_id,r=ce.Z.integrations.state.find((e=>e.id===t)),o=l.getFormat().pattern_name;if(!r||!o)return;Re({integration:r,patternName:o,url:p.searchQuery})&&e.addPage()})()}),!e.isConnectedRelation&&!C&&(0,me.jsx)("div",{style:{display:"flex",marginLeft:10,alignItems:"center"},children:(0,me.jsx)(x.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>(0,me.jsx)("span",{style:b.regular,children:e}),databaseWithIcon:(0,me.jsxs)(A.Z,{href:i,style:{marginLeft:he.Qi},innerStyle:{display:"flex"},onClick:()=>{k.ZZ8(r,{from:e.analyticsFrom})},children:[(0,me.jsx)(E.Z,{disabled:!0,icon:S,isEmptyPage:!1,size:20}),(0,me.jsx)(L.Z,{store:l,underline:!0,style:b.recordTitle})]})}})})]})}fe.displayName="RelationPropertyMenu",fe.contextTypes={...o.w,...z.xm};const Pe=fe,Re=e=>{var t;if(e.patternName)return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((t=>{var r;return t.name===e.patternName&&(null===(r=t.additional_types)||void 0===r?void 0:r.connectedRelation)})).find((t=>{let{regex:r}=t;return new RegExp(r).test(e.url)}))};function Ce(e,t,r){if(!(Boolean(t.property)&&le.default.checkGate("collections_relation_picker_require_edit_perms")))return!0;return de.G.createChildStore(e,r).canEdit()}function be(){return(0,me.jsx)(K.Z,{href:(0,oe.UY)("guides.relations"),analyticsFrom:"relation_menu"})}function Me(e,t,r,o){const i=new Set(o.map((e=>e.id))),n=[];return e.forEach((e=>{const o={spaceId:t.getSpaceId(),id:e,table:b.iU},a=Ce(t,r,o);if(i.has(e)){const t={key:e,type:he.Rt.SelectedPage,pointer:o};n.push({pageResult:t,canEdit:a})}else{const t={key:e,type:he.Rt.SearchPage,pointer:o};n.push({pageResult:t,canEdit:a})}})),n}function Ie(e){e({value:[]})}}}]);