"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9342],{76463:(e,t,n)=>{n.d(t,{P0:()=>Z,RN:()=>T,VG:()=>k,Yw:()=>A,jX:()=>_,k2:()=>N,lz:()=>C,v2:()=>P});var i=n(86517),o=n(72141),s=n(45953),a=n(21202),r=n(77420),l=n(15047),c=n(19889),d=n(97880),u=n(9291),g=n(47307),p=n(33929),m=n(67669),h=n(26136),f=n(54642),v=n(92625),y=n(76464),S=n(9953),b=n(64964),x=n(28014),j=n(82530),M=n(12170);const I=(0,u.defineMessages)({duplicatingTemplate:{id:"botActions.duplicatingTemplate.loadingMessage",defaultMessage:"Duplicating template..."},duplicatingTemplateError:{id:"botActions.duplicateTemplateAndShareWithBot.snackbar.failure",defaultMessage:"Failed to duplicate template for to your workspace"}});function w(e,t){const{environment:n,spaceStore:i,spaceRole:o}=t,s=function(e){const{name:t,spaceStore:n,userId:i,icon:o,type:s}=e,a=Date.now(),r={name:t,created_at:a,created_by_table:c.KJ,created_by_id:i,alive:!0,icon:o,space_id:n.id,last_edited_at:a,last_edited_by_id:i,last_edited_by_table:c.KJ};switch(s){case"guest":return{...r,type:"guest",capabilities:e.capabilities,parent_table:l.bx,parent_id:n.id,integration_id:void 0};case"scim":return{...r,type:"scim",parent_table:c.KJ,parent_id:i};default:(0,d.t1)(s)}}(t),a=S.ae({environment:n,table:r.cZ,value:s,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:e});return y.ep({environment:n,store:i,permissionItems:[{type:"bot_permission",role:o,bot_id:a.id}],transaction:e}),{botStore:a}}function C(e){const{environment:t}=e,{serverCommitResult:n,performResult:{botStore:i}}=j.createAndCommit({userAction:"botActions.createSpaceBot",environment:t,perform:t=>w(t,e)});return{botStore:i,transactionPromise:n}}async function Z(e){const{environment:t,botId:n,onSuccess:i}=e,o=await f.deleteBot(t,{botId:n});"failed"===o.type?g.showError(o):"success"===o.type&&i&&(await M.pJ({environment:t}),i())}async function A(e){const{environment:t,table:n,id:i,type:o}=e,s=await f.getBots(t,{table:n,id:i,type:o});if("failed"===s.type)throw g.showError(s),s;return{botIds:s.data.botIds,recordMap:s.data.recordMap}}async function k(e){const{environment:t,botId:n}=e,i=await f.getBotToken(t,{botId:n});if("failed"!==i.type)return i.data.token;g.showError(i)}function P(e){const{botValue:t,store:n,environment:o}=e,{id:s,parent_id:a,parent_table:r,capabilities:l}=t,c={type:"bot_permission",bot_id:s,parent_id:a,parent_table:r,role:(0,i.uH)(l)};j.createAndCommit({userAction:"TopbarMoreButton.handleAddingConnection",environment:o,perform:e=>{y.ep({environment:o,store:n,permissionItems:[c],transaction:e})}})}function T(e){const{botId:t,store:n,environment:i}=e,s=n.getPermissionItems().filter((0,d.AO)((e=>(0,o.FB)(e)?{true:e}:{false:e})));for(const o of s)if(o.bot_id===t){const e={...o,role:"none"};j.createAndCommit({userAction:"TopbarMoreButton.handleRemovingConnection",environment:i,perform:t=>{y.ep({environment:i,store:n,permissionItems:[e],transaction:t})}})}}function _(e){const{currentSpaceStore:t,environment:n,pages:i,botStore:o,addPermission:s}=e;if(!t)return;const r=(0,m.zT)({botStore:o,addPermission:s});i.forEach((e=>{const i=h.t1.createChildStore(t,{table:a.iU,id:e});j.createAndCommit({userAction:"botActions.updateBlockPermissionsForBot",environment:n,perform:e=>{y.ep({environment:n,store:i,permissionItems:[r],transaction:e})}})}))}async function N(e){const{environment:t,spaceStore:n,spaceViewStore:i,templatePageId:o,botValue:a,pages:l}=e;if(!n)return;const c=h.t1.createChildStore(n,{table:r.cZ,id:a.id});if(o)return await async function(e){const{environment:t,spaceStore:n,spaceViewStore:i,templatePageId:o,botStore:a}=e;if(!n||!i)return;try{v.j({message:I.duplicatingTemplate});const e=await f.loadBlockSubtree(t,{block:{id:o,spaceId:n.id},shallow:!1});if("failed"===e.type)return;const r=s.PF.create(e.data.subtreeRecordMap),{performResult:l}=j.createAndCommit({userAction:"botActions.duplicateTemplateAndShareWithBot",environment:t,perform:e=>{const s=x.cc({environment:t,recordMap:r,copyPageId:o,isPrivate:!0,spaceStore:n,spaceViewStore:i,transaction:e,allowCopyExternalObjectInstances:!1}),l=i.getPrivatePageIds();l.length>0&&S.sW({store:i,data:{private_pages:[s.id,...l]},transaction:e});const c=(0,m.zT)({botStore:a,addPermission:!0});return y.ep({environment:t,store:s,permissionItems:[c],transaction:e}),s}});return l}catch(r){b.oV({label:p.default.formatMessage(I.duplicatingTemplateError)})}finally{v.x()}}({environment:t,templatePageId:o,botStore:c,spaceStore:n,spaceViewStore:i});_({environment:t,currentSpaceStore:n,botStore:c,pages:l,addPermission:!0})}},22711:(e,t,n)=>{n.d(t,{C:()=>a,DP:()=>c,LN:()=>s,Lm:()=>l,Ow:()=>r});var i=n(57549),o=n(54642);async function s(e,t){const n=await o.getConnectedAppsStatus(e,{spaceId:t});if("failed"===n.type){const e=n.error;return console.error(e),{drive:[],evernote:void 0,trello:void 0,asana:void 0,confluence:void 0}}return n.data}async function a(e,t){await o.disconnectTrello(e,{}),await t.refresh(),i.qJ(e,{integration_name:"trello"})}async function r(e,t){await o.disconnectAsana(e,{}),await t.refresh(),i.qJ(e,{integration_name:"asana"})}async function l(e,t){await o.disconnectEvernote(e,{}),await t.refresh(),i.qJ(e,{integration_name:"evernote"})}async function c(e,t,n){await o.disconnectConfluence(e,{spaceId:n}),await t.refresh()}},83805:(e,t,n)=>{n.d(t,{B:()=>x,e:()=>b});var i=n(99405),o=n(64002),s=n(9291),a=n(57549),r=n(47307),l=n(95477),c=n(68821),d=n(91924),u=n(53833),g=n(90365),p=n(47593),m=n(67940),h=n(92083),f=n(54642),v=n(92625),y=n(15356);const S=(0,s.defineMessages)({authenticatingWithEvernote:{id:"evernoteActions.authenticatingWithEvernote.loadingMessage",defaultMessage:"Authenticating with Evernote…"},titleMessage:{defaultMessage:"Evernote login",id:"evernoteActions.loginPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,s=(0,d.eC)(t);let u=(0,i.Qp)(l.default.domainBaseUrl,{authType:s,userId:t.currentUser.id});u=s.redirectToAuth?u:await(0,d.HU)(t,u);const b=await y.M(t,{width:580,height:700,url:u,titleMessage:S.titleMessage});if(!b)return;const j=o.Qc(b),M=j.query.oauth_token,I=j.query.oauth_verifier;if(!M||!I)return;v.j({message:S.authenticatingWithEvernote});const w=await f.authWithEvernote(t,{requestToken:M,verifier:I}),C=m.Z.getOrCreateFlowId();if("failed"===w.type)return a.a1(t,{import_source:"evernote",data:{import_type:"api",status:"failure",error:w.error,userId:t.currentUser.id},flowId:C}),console.error(w.error),r.showError(w),void v.x();a.a1(t,{import_source:"evernote",data:{import_type:"api",status:"success",userId:t.currentUser.id},flowId:C}),a.L3(t,{integration_name:"evernote"}),await n.refresh(),g.Z.setState({open:!0}),(0,c.c)()?h.Z.setState({...h.Z.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}):p.Z.setState({open:!0}),await x({environment:t,requestStore:n}),v.x()}async function x(e){const{environment:t,requestStore:n}=e;try{u.Z.setState({...u.Z.state,isFetchingNotebooks:!0,showLoader:!0});const e=await f.getEvernoteNotebooks(t,{});if(await n.refresh(),"success"===e.type){u.Z.setState({...u.Z.state,notebooksResponse:e.data,isFetchingNotebooks:!1,showLoader:!1});const{userInfo:t,notebooks:n}=e.data;return{userInfo:t,notebooks:n}}return console.error(e.error),{notebooks:[],userInfo:void 0}}catch(i){return console.error(i),{notebooks:[],userInfo:void 0}}}},52192:(e,t,n)=>{n.d(t,{M:()=>b,u:()=>x});var i=n(99405),o=n(64002),s=n(9291),a=n(57549),r=n(47307),l=n(95477),c=n(68821),d=n(91924),u=n(47593),g=n(82066),p=n(92083),m=n(81676),h=n(54642),f=n(47839),v=n(92625),y=n(15356);const S=(0,s.defineMessages)({authenticatingWithTrello:{id:"trelloActions.authenticatingWithTrello.loadingMessage",defaultMessage:"Authenticating with Trello…"},titleMessage:{defaultMessage:"Trello login",id:"trelloActions.loginPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,s=(0,d.eC)(t);let m=(0,i.ae)(l.default.domainBaseUrl,{authType:s,userId:t.currentUser.id,isElectronDevice:t.device.isElectron});if(m=s.redirectToAuth?m:await(0,d.HU)(t,m),t.device.isElectron)return void f.openExternalUrl(m);const b=await y.M(t,{width:580,height:700,url:m,titleMessage:S.titleMessage});if(!b)return;const j=o.Qc(b),M=j.query.oauth_token,I=j.query.oauth_verifier;if(!M||!I)return;v.j({message:S.authenticatingWithTrello});const w=await h.authWithTrello(t,{requestToken:M,verifier:I});"failed"===w.type?(console.error(w.error),r.showError(w),v.x()):(a.L3(t,{integration_name:"trello"}),await n.refresh(),g.Z.setState({open:!0}),(0,c.c)()?p.Z.setState({...p.Z.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}):u.Z.setState({open:!0}),await x(t,n),v.x())}async function x(e,t){m.Z.setState({...m.Z.state,isFetchingBoards:!0,showLoader:!0});const n=await h.getTrelloBoards(e,{});return await t.refresh(),"success"===n.type?(m.Z.setState({...m.Z.state,boardsResponse:n.data,isFetchingBoards:!1,showLoader:!1}),n.data):(console.error(n.error),{boards:[]})}},35878:(e,t,n)=>{n.d(t,{cP:()=>De,ZP:()=>Fe,a_:()=>Ne});n(57658);var i=n(67294),o=n(13991),s=n(480),a=n(86628),r=n(24405),l=n(8848),c=n(7057),d=n(77657),u=n(80920),g=n(54497),p=n(74181),m=n(77420),h=n(9844),f=n(35794),v=n(90965),y=n(94826),S=n(97880),b=n(82990),x=n(7928),j=n(9291),M=(n(95477),n(38755)),I=n(80444),w=n(77080),C=n(26136),Z=n(20454),A=n(15070),k=n(58573),P=n(19889),T=n(57549),_=n(76463),N=n(12714),F=n(64964),D=n(82530),B=n(87279),L=n(18514),U=n(61766),V=n(74021),R=n(24736),K=n(86517),E=n(15025),W=n(28992),O=n(85893);function q(e){window.__c={n:"BotCapabilitiesTooltip"};const{capabilities:t}=e,n=(0,j.useIntl)(),{device:i}=(0,s.O7)(),o=(0,K.uH)(t),a=(0,K.Rh)(t),r=(0,K.WM)(e.capabilities),l=[...(0,E.zq)(o),...(0,E.ac)(a),...(0,E.VR)(r)];return(0,O.jsx)(W.Z,{...e,title:n.formatMessage((0,K.Gx)(o,void 0).label),shouldWrapCaption:!0,style:i.isMobile?{padding:"12px 4px"}:{padding:4,marginTop:2,marginBottom:2},captionStyle:{marginTop:4},caption:(0,O.jsx)("div",{children:l})})}var z=n(52275),G=n(31945),H=n(68894),$=n(68785),J=n(78140),Y=n(32163),Q=n(50506),X=n(63296),ee=n(53437),te=n(72495),ne=n(64369),ie=n(29302);function oe(e){window.__c={n:"AdminIntegrationSettingsActionMenu"};const{integrationId:t,integrationTable:n,isLegacy:o,disableDisconnectUser:r,disableDisconnectAll:l,disableDisallow:c,botIds:u}=e,g=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),f=(0,s.Fy)(),y=(0,s.O7)(),b=(0,j.useIntl)(),x=be(),[M,w]=(0,i.useState)(void 0),[A,T]=(0,i.useState)(!1),[_,N]=(0,i.useState)(!1),[F,U]=(0,i.useState)(!1),[V,K]=(0,i.useState)(void 0),E=(0,a.VK)((()=>g&&n?(0,C.Kv)(g,{table:n,id:t}):void 0),[g,t,n]),W=(0,a.VK)((()=>{if(o){const e=p.ns.find((e=>e.id===t));return{name:null==e?void 0:e.name,url:(0,L.UY)("guides.connectedApps")}}if(g&&n){const o=g.getRecordModel({table:n,id:t});if(n===h.K2&&!(0,d.BP)({integrationId:t,env:"production"})){var e,i;const t=o;return{name:null==o?void 0:o.name,url:null==t||null===(e=t.getInfo())||void 0===e?void 0:e.website_url,email:null==t||null===(i=t.getInfo())||void 0===i?void 0:i.email}}return{name:null==o?void 0:o.name}}}),[g,t,n,o]),q=(0,a.VK)((()=>u&&!r?u.map((e=>g&&E?C.t1.createChildStore(E,{table:m.cZ,id:e,spaceId:g.id}):void 0)):[]),[g,u,E,r]).filter(S.$K),z=(0,a.VK)((()=>q.filter((e=>e.getAlive()))),[q]),$=(0,a.VK)((()=>{if(g&&z&&!r){return z.map((e=>e.getCreatedById())).filter(S.$K).map((e=>Z.U.createChildStore(g,{table:P.KJ,id:e}))).filter((e=>e.isDefined()))}return[]}),[z,g,r]),X=(0,a.VK)((()=>null==g?void 0:g.getBotSettingsStore().getValue()),[g]),ee=(0,a.VK)((()=>null==z?void 0:z.reduce(((e,t)=>{const n=$.find((e=>e.id===t.getCreatedById()));return e[t.id]={userStore:n,botCapabilities:t.getCapabilities()},e}),{})),[z,$]),ne=(0,a.VK)((()=>M?(0,k.ZP)(M,Object.entries(ee),(e=>{let[,{userStore:t}]=e;return t.getSearchName(b)})):Object.entries(ee)),[ee,M,b]),ie=!r&&(null==u?void 0:u.length)&&(0,O.jsx)(te.Z,{isInput:!0,style:{padding:8},children:(0,O.jsx)(H.ZP,{textWrapperStyle:{margin:0},focus:!f.isMobile||void 0,focusAfterAnimation:!0,value:M||"",onChange:e=>w(e.target.value),placeholder:b.formatMessage({id:"integrationInstallerFilter.userSearch.placeholder",defaultMessage:"Filter by user"})})}),oe=ne.length?[{key:"disconnect user section",render:e=>(0,O.jsx)(te.Z,{...e}),items:ae({users:ne,disableDisconnectUser:r,showDisplayModal:()=>N(!0),setSelectedUser:K,intl:b})}]:[],re=(null==W?void 0:W.url)||(null==W?void 0:W.email),Se=Boolean(null==u?void 0:u.length)||(0,v.CJ)(X)&&!c,xe=(0,O.jsxs)(O.Fragment,{children:[re&&(0,O.jsxs)(te.Z,{topBorder:Boolean(ne.length),children:[(null==W?void 0:W.url)&&(0,O.jsx)(le,{environment:y,developerWebsite:W.url}),(null==W?void 0:W.email)&&(0,O.jsx)(ce,{environment:y,developerEmail:W.email})]},"app-links"),Se&&(0,O.jsxs)(te.Z,{topBorder:Boolean(ne.length||re),children:[Boolean(null==u?void 0:u.length)&&(0,O.jsx)(de,{showDisplayModal:()=>U(!0)}),(0,v.CJ)(X)&&!c&&(0,O.jsx)(ue,{showDisplayModal:()=>T(!0)})]})]});return(re||Se)&&W?(0,O.jsx)(G.ZP,{popupType:f.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,O.jsx)(R.Z,{...e,isMobile:f.isMobile,style:{marginLeft:8,marginRight:8}}),render:()=>(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(J.Z,{menuType:f.isMobile?B.og.ActionSheet:B.og.Popup,header:!r&&ie,footer:xe,width:230,children:(0,O.jsx)(Y.Z,{type:Y.i.Vertical,sections:oe,initialFocus:void 0})}),(0,O.jsx)(Q.Z,{open:!r&&_,onDismiss:()=>{N(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:x.innerModal,render:()=>(0,O.jsx)(ge,{title:(0,O.jsx)(ve,{integrationName:W.name}),caption:(0,O.jsx)(ye,{integrationName:W.name,userName:null==V?void 0:V.userName}),type:"disconnect",handleCancel:()=>{N(!1),K(void 0)},handleConfirmation:async()=>{V&&(await se({botIds:[V.botId],environment:y}),K(void 0)),N(!1)}})}),(0,O.jsx)(Q.Z,{open:!l&&F,onDismiss:()=>{U(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:x.innerModal,render:()=>(0,O.jsx)(ge,{title:(0,O.jsx)(he,{integrationName:W.name}),caption:(0,O.jsx)(fe,{integrationName:W.name}),type:"disconnect",handleCancel:()=>U(!1),handleConfirmation:async()=>{await se({botIds:u,environment:y}),U(!1)}})}),(0,O.jsx)(Q.Z,{open:!c&&A,onDismiss:()=>{T(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:x.innerModal,render:()=>(0,O.jsx)(ge,{title:(0,O.jsx)(pe,{integrationName:W.name}),caption:(0,O.jsx)(me,{integrationName:W.name,disableDisconnectAll:l}),type:"disapprove",handleCancel:()=>T(!1),handleConfirmation:async()=>{!function(e){const{currentSpaceStore:t,environment:n,integrationId:i}=e;t&&D.createAndCommit({userAction:"AdminIntegrationSettingsActionMenu.handleDisapproveIntegration",environment:n,perform:e=>{D.applyOperation({store:t,operation:{pointer:t.pointer,path:["bot_settings","integration_approval_statuses"],command:"update",args:{[i]:null}},transaction:e})}})}({currentSpaceStore:g,environment:y,integrationId:t}),l||await se({botIds:u,environment:y}),T(!1)}})})]})}):null}async function se(e){let{botIds:t,environment:n}=e;t&&await Promise.all(t.map((e=>_.P0({environment:n,botId:e,onSuccess:()=>{T.IN(n,{type:"public"})}}))))}function ae(e){const{intl:t,disableDisconnectUser:n,users:i,showDisplayModal:o,setSelectedUser:s}=e;return n?[]:i.map((e=>{let[n,{userStore:i,botCapabilities:a}]=e;return{key:i.id,render:e=>(0,O.jsx)(re,{buttonMenuProps:e,userStore:i,botCapabilities:a,selectAction:()=>{o(),s({botId:n,userName:i.getDisplayName(t)})}}),action:()=>{o(),s({botId:n,userName:i.getDisplayName(t)})}}}))}function re(e){window.__c={n:"UserMenuActionItem"};const{buttonMenuProps:t,userStore:n,botCapabilities:o,selectAction:a}=e,r=(0,s.Fy)(),[c,d]=(0,i.useState)(!1);return(0,O.jsx)(ee.ZP,{popupType:r.isMobile?G.Z4.SlideUp:G.Z4.Popup,placementToOrigin:G.pO.Right,open:c,onDismiss:()=>d(!1),origin:(0,O.jsx)(z.Z,{...t,title:(0,O.jsx)("div",{style:{display:"flex",alignContent:"center",justifyContent:"space-between"},children:(0,O.jsx)(ie.Z,{userStore:n,avatarSize:18,inline:!0,avatarShouldShowShadow:!0,style:{flexShrink:1}})}),textWrapperStyle:{marginLeft:12,marginRight:12},focused:!1,onClick:()=>d(!0)}),render:()=>(0,O.jsx)(J.Z,{width:240,menuType:r.isMobile?B.og.ActionSheet:B.og.Popup,header:(0,O.jsx)("div",{style:{padding:2,marginTop:4,marginBottom:4},children:(0,O.jsx)(q,{capabilities:o})}),children:(0,O.jsx)(Y.Z,{type:Y.i.Vertical,sections:[{key:"integration capabilities",render:e=>(0,O.jsx)(te.Z,{...e,topBorder:!0}),items:[{key:"remove",render:e=>(0,O.jsx)(z.Z,{...e,focused:!1,title:(0,O.jsx)("div",{style:{color:l.ZP.red},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.revokeUserAccess.label",defaultMessage:"Disconnect user"})})}),action:a}]}],initialFocus:void 0})})})}function le(e){let{environment:t,developerWebsite:n}=e;return(0,O.jsx)(z.Z,{onClick:()=>{N.D({environment:t,url:n}),T.fc(t,{href:n,from:"integration-settings"})},title:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.visitDeveloperWebsite.label",defaultMessage:"Visit developer website"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12}})}function ce(e){let{environment:t,developerEmail:n}=e;return(0,O.jsx)(z.Z,{onClick:()=>{N.D({environment:t,url:`mailto:${n}`}),T.Z9(t,{from:"integration-settings"})},title:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.contactDeveloperSupport.label",defaultMessage:"Contact support"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12}})}function de(e){let{showDisplayModal:t}=e;return(0,O.jsx)(z.Z,{onClick:t,title:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.label",defaultMessage:"Disconnect all users"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12,color:l.ZP.red}})}function ue(e){let{showDisplayModal:t}=e;return(0,O.jsx)(z.Z,{onClick:t,title:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.label",defaultMessage:"Remove from approved list"}),focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12,color:l.ZP.red}})}function ge(e){let{title:t,caption:n,handleConfirmation:o,handleCancel:s,type:a}=e;window.__c={n:"ModalContent"};const[r,c]=(0,i.useState)(!1);return(0,O.jsxs)("div",{style:{padding:20,width:333},children:[(0,O.jsx)(ne.Z,{isMultiline:!0,style:{marginBottom:8,fontWeight:b.Z.fontWeight.semibold,paddingRight:30},children:t}),(0,O.jsx)(ne.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8},children:n}),(0,O.jsxs)("div",{style:{display:"flex",marginTop:12},children:[(0,O.jsx)(X.Z,{style:{width:140,marginRight:9},isLarge:!0,onClick:s,disabled:r,children:(0,O.jsx)(ne.Z,{children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"})})}),(0,O.jsx)(X.Z,{style:{width:140},isLarge:!0,onClick:async()=>await o(c),backgroundColor:l.ZP.red,disabled:r,children:(0,O.jsxs)(ne.Z,{style:{color:l.ZP.white},children:["disconnect"===a&&!0===r&&(0,O.jsx)($.Z,{isWhite:!0}),"disconnect"===a&&!1===r&&(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.disconnect",defaultMessage:"Disconnect"}),"disapprove"===a&&(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.remove",defaultMessage:"Remove"})]})})]})]})}function pe(e){let{integrationName:t}=e;return(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.title",defaultMessage:"Remove {integrationName} from approved integrations",values:{integrationName:t}})}function me(e){let{integrationName:t,disableDisconnectAll:n}=e;return n?(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.caption",defaultMessage:"Prevent members from installing {integrationName}.",values:{integrationName:t}}):(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApprovalAndDisconnectAll.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace and prevent members from installing {integrationName}.",values:{integrationName:t}})}function he(e){let{integrationName:t}=e;return(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.label",defaultMessage:"Disconnect {integrationName} for all users in workspace",values:{integrationName:t}})}function fe(e){let{integrationName:t}=e;return(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace.",values:{integrationName:t}})}function ve(e){let{integrationName:t}=e;return(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.label",defaultMessage:"Disconnect {integrationName}?",values:{integrationName:t}})}function ye(e){let{integrationName:t,userName:n}=e;return(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.caption",defaultMessage:"Revoke access for {integrationName} for {userName}",values:{integrationName:t,userName:n}})}function Se(e){window.__c={n:"AdminComplianceIntegrationSettingsActionMenu"};const{adminIntegrationConfig:t,botId:n,maybeWebhookSubscriptionId:o}=e,r=(0,s.Fy)(),l=(0,s.O7)(),[c,d]=(0,i.useState)(!1),u=be(),g=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),p=(0,a.VK)((()=>{const e=null==g?void 0:g.getRecordModel({table:m.cZ,id:n});return null==e?void 0:e.getCapabilities()}),[g,n]),h=t.developer_name;if(!h)return null;const f=new U.Z,v={key:"manage",action:()=>{V.Z.setState({open:!0,integrationId:t.id,webhookSubscriptionId:o}),f.setState({open:!1})},render:e=>(0,O.jsx)(z.Z,{...e,title:(0,O.jsx)(j.FormattedMessage,{id:"complianceIntegrationSettings.actionMenu.manage",defaultMessage:"Manage"})})},S={key:"learn more",action:()=>{N.D({environment:l,url:t.integrationGalleryUrl})},render:e=>(0,O.jsx)(z.Z,{...e,title:(0,O.jsx)(j.FormattedMessage,{id:"complianceIntegrationSettings.actionMenu.learnMore",defaultMessage:"Learn more"})})},b={key:"disconnect",action:()=>{f.setState({open:!1}),d(!0)},render:e=>(0,O.jsx)(z.Z,{...e,title:(0,O.jsx)("span",{style:u.disconnect,children:(0,O.jsx)(j.FormattedMessage,{id:"complianceIntegrationSettings.actionMenu.disconnect",defaultMessage:"Disconnect"})})})},x=[...t.oauth||(0,A.ms)(p)||(0,y.Uw)(t.id)?[]:[v],...t.oauth||(0,A.ms)(p)?[S]:[],b];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(G.ZP,{popupType:r.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,O.jsx)(R.Z,{...e,isMobile:r.isMobile,style:{marginLeft:8,marginRight:8}}),buttonPopupStore:f,render:()=>(0,O.jsx)(J.Z,{menuType:r.isMobile?B.og.ActionSheet:B.og.Popup,width:230,children:(0,O.jsx)(Y.Z,{type:Y.i.Vertical,sections:[{key:"options",render:e=>(0,O.jsx)(te.Z,{...e}),items:x}],initialFocus:void 0})})}),(0,O.jsx)(Q.Z,{open:c,onDismiss:()=>d(!1),disableAnimation:!0,showCloseIcon:!0,innerStyle:u.innerModal,render:()=>(0,O.jsx)(ge,{title:(0,O.jsx)(j.FormattedMessage,{id:"complianceIntegrationSettings.disconnectModal.title",defaultMessage:"Disconnect {integrationName}?",values:{integrationName:h}}),caption:(0,O.jsx)(j.FormattedMessage,{id:"complianceIntegrationSettings.disconnectModal.subtitle",defaultMessage:"Revoke {integrationName}'s access to this workspace. Workspace events will no longer be sent to {integrationName}.",values:{integrationName:h}}),type:"disconnect",handleCancel:()=>d(!1),handleConfirmation:async()=>{await _.P0({environment:l,botId:n,onSuccess:()=>{}}),T.wi(l,{integration_id:t.id}),F.oV({label:(0,O.jsx)(j.FormattedMessage,{id:"complianceIntegrationSettings.snackbar.title",defaultMessage:"Disconnected {integrationName} from your workspace",values:{integrationName:h}})})}})})]})}function be(){return(0,r.yK)((()=>({disconnect:{color:l.ZP.red},innerModal:{borderRadius:10}})),[])}var xe=n(74136),je=n(31278),Me=n(69219),Ie=n(26388),we=n(45653),Ce=n(59054),Ze=n(4615),Ae=n(893),ke=n(8055);function Pe(e){window.__c={n:"InternalIntegrationActionMenu"};const{botId:t}=e,[,,n]=(0,a.AF)(void 0,U.Z),o=(0,s.Fy)(),r=(0,s.O7)(),c=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),[d,u]=(0,i.useState)(!1),g=(0,a.VK)((()=>c?C.t1.createChildStore(c,{table:m.cZ,id:t,spaceId:c.id}):void 0),[t,c]),p=(0,a.VK)((()=>(0,A.Mh)(null==g?void 0:g.getModel())),[g]),[{value:h}]=(0,Ce.r5)((async()=>{if(g){return await _.VG({environment:r,botId:null==g?void 0:g.id})}}),[r,g]);if(!g)return null;let f;return f=o.isMobile?{menuType:B.og.ActionSheet}:{menuType:B.og.Popup},(0,O.jsx)(G.ZP,{popupType:o.isMobile?G.Z4.SlideUp:G.Z4.Popup,buttonPopupStore:n,renderOrigin:e=>(0,O.jsx)(R.Z,{isMobile:o.isMobile,...e,style:{marginLeft:8,marginRight:8}}),render:()=>(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(J.Z,{...f,children:(0,O.jsx)(Y.Z,{type:Y.i.Vertical,sections:[{key:"integration options",render:e=>(0,O.jsx)(te.Z,{...e}),items:[...h?[Te({environment:r,botToken:h})]:[],{key:"manage",action:()=>ke.c4({environment:r,url:`/my-integrations/internal/${Ze.cj(t)}`,openInNew:"tab"}),render:e=>(0,O.jsx)(z.Z,{title:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.manageIntegration.label",defaultMessage:"Manage in developer portal"}),...e})},{key:"delete",action:()=>u(!0),render:e=>(0,O.jsx)(z.Z,{title:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectIntegrationButton.label",defaultMessage:"Disconnect {integrationName}",values:{integrationName:p}}),style:{color:l.ZP.red},...e})}]}],initialFocus:void 0})}),(0,O.jsx)(Q.Z,{open:d,onDismiss:()=>{u(!1)},disableAnimation:!0,render:()=>(0,O.jsxs)("div",{style:{padding:20,width:333},children:[(0,O.jsx)(ne.Z,{isMultiline:!0,style:{marginBottom:8,fontWeight:b.Z.fontWeight.semibold},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.title",defaultMessage:"Disconnect {integrationName} in workspace",values:{integrationName:p}})}),(0,O.jsx)(ne.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.caption",defaultMessage:"Revoke access for {integrationName} in workspace",values:{integrationName:p}})}),(0,O.jsxs)("div",{style:{display:"flex",marginTop:12},children:[(0,O.jsx)(X.Z,{style:{width:140,marginRight:9},isLarge:!0,onClick:()=>u(!1),children:(0,O.jsx)(ne.Z,{children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"})})}),(0,O.jsx)(X.Z,{style:{width:140},isLarge:!0,onClick:async()=>{u(!1),await _.P0({environment:r,botId:g.id,onSuccess:()=>{T.IN(r,{type:"internal"})}})},backgroundColor:l.ZP.red,children:(0,O.jsx)(ne.Z,{style:{color:l.ZP.white},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectIntegration..modal.button.disconnect",defaultMessage:"Disconnect"})})})]})]})})]})})}function Te(e){const{botToken:t,environment:n}=e;return{key:"copy bot token",action:()=>{Ae.RD({environment:n,stringValue:t,copiedMessage:Ae.tq.copiedLinkToClipboard}),T.IV(n,{from:"integration-settings",table:m.cZ})},render:e=>(0,O.jsx)(z.Z,{title:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.copyInternalIntegrationTokenButton.label",defaultMessage:"Copy internal integration token"}),...e})}}var _e=n(40235);const Ne={internal:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.internal",defaultMessage:"INTERNAL"}),databaseSync:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.sync",defaultMessage:"SYNC"}),linkPreview:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.preview",defaultMessage:"LINK PREVIEW"}),importer:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.importer",defaultMessage:"IMPORTER"}),dlp:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.dlp",defaultMessage:"DLP"}),siem:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.siem",defaultMessage:"SIEM"}),ediscovery:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.ediscovery",defaultMessage:"eDISCOVERY"})};function Fe(e){window.__c={n:"AdminIntegrationSettingsTable"};const{integrationIdToBotIds:t,internalIntegrationIds:n,integrationIdToUsers:i}=e,o=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),s=(0,r.Fg)(),l=(0,a.VK)((()=>null==o?void 0:o.getBotSettingsStore().getValue()),[o]),c=(0,a.VK)((()=>"approved_or_built_by_notion"===(null==l?void 0:l.integration_restrictions)),[l]),u=(0,a.VK)((()=>Boolean(null==l?void 0:l.integration_restrictions)),[l]),g=(0,a.VK)((()=>null!=l&&l.integration_approval_statuses?Object.keys(l.integration_approval_statuses):[]),[l]),f=g.filter((e=>!Object.keys(t).includes(e)&&!p.T2.includes(e))),y=f.some((e=>e===d.f3)),S=(0,a.VK)((()=>null==o?void 0:o.id),[o]),b=t?Object.entries(t).map((e=>{let[t,n]=e;return Be({integrationPointer:{table:h.K2,id:t},userStores:i[t],botIds:n,autoApproveBuiltByNotion:c})})):[],x=S?n.map((e=>Be({integrationPointer:{table:m.cZ,id:e,spaceId:S},userStores:i[e],botIds:[e]}))):[],M=u?f.map((e=>Be({integrationPointer:{table:h.K2,id:e},userStores:[],botIds:[],autoApproveBuiltByNotion:c}))):[],w=p.ns.filter((e=>!(0,v.CJ)(l)||g.includes(e.id)&&(e.id!==p._o||!y))).map((e=>function(e){const{legacyIntegration:t}=e,{id:n,name:i,info:o}=t;return{key:n,columns:[(0,O.jsxs)("div",{style:{display:"flex",alignItems:"center",maxWidth:300},children:[(0,O.jsx)("img",{src:o.icon,style:{height:28}}),(0,O.jsxs)("div",{style:{minWidth:0,marginLeft:15},children:[(0,O.jsx)("div",{style:{display:"flex"},children:(0,O.jsx)(ne.Z,{children:i})}),(0,O.jsx)(ne.Z,{isSmall:!0,style:{display:"flex"},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.legacy",defaultMessage:"Notion Connected App"})})]})]},0),(0,O.jsx)(We,{renderedUsers:void 0,displayUsers:!1},1),(0,O.jsx)("div",{children:(0,O.jsx)(oe,{integrationId:n,isLegacy:!0,disableDisconnectAll:!0,disableDisconnectUser:!0})},2)]}}({botSettings:l,legacyIntegration:e}))),C=b.length+x.length+M.length+w.length;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(_e.Z,{columns:[{key:"integration",header:(0,O.jsx)(j.FormattedMessage,{id:"spaceConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"40%"}},{key:"added_by",header:(0,O.jsx)(j.FormattedMessage,{id:"spaceConnectionsSettings.connectionsTable.creationInfoColumn.title",defaultMessage:"Users and access"})},{key:"more",header:void 0,style:{width:"5%"}}],rows:[...b,...x,...M,...w]}),0===C?(0,O.jsx)("div",{style:{height:120,width:"100%",fontSize:12,color:s.lightTextColor,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:`1px solid ${s.lightDividerColor}`},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.emptyTable.message",defaultMessage:"No integration installed"})}):void 0]})}function De(e){window.__c={n:"AdminIntegrationComplianceSettingsTable"};const{botIdToWebhookSubscriptionId:t,complianceIntegrationsIdToBotIds:n}=e,i=(0,r.yK)((e=>({emptyTable:{height:120,width:"100%",fontSize:12,color:e.lightTextColor,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:`1px solid ${e.lightDividerColor}`}})),[]),o=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),s=(0,a.VK)((()=>{if(!o)return[];return Object.entries(n).flatMap((e=>{let[n,i]=e;return i.map((e=>{const i=C.Qx.createChildStore(o,{table:m.cZ,id:e,spaceId:o.id});return{integrationPointer:{table:h.K2,id:n},botId:e,lastEditedAt:Number(i.getLastEditedAt()),lastEditedByPointer:i.getLastEditedByPointer(),webhookSubscriptionId:t[e]}}))})).filter(S.$K)}),[t,o,n]).map((e=>function(e){const{integrationPointer:t,lastEditedAt:n,lastEditedByPointer:i,botId:o,webhookSubscriptionId:s}=e,a=t.id,r=(0,y.EY)(a);if(!r)return;const l=y.ZB[r];if(!l)return;return{key:`${a}:${o}`,columns:[(0,O.jsx)(Le,{integrationTable:h.K2,integrationId:a,maybeWebhookSubscriptionId:s},"integration-title"),(0,O.jsx)(Ke,{editedByPointer:i},"integration-edited-by"),(0,O.jsx)(Ee,{lastEditedOn:n},"integration-last-edited-on"),(0,O.jsx)(Se,{adminIntegrationConfig:l,maybeWebhookSubscriptionId:s,botId:o},"integration-menu")]}}(e))).filter(S.$K);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(_e.Z,{columns:[{key:"integration",header:(0,O.jsx)(j.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"30%"}},{key:"integration-edited-by",header:(0,O.jsx)(j.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.integrationEditorColumn.title",defaultMessage:"Edited by"}),style:{width:"30%"}},{key:"integration-edited-on",header:(0,O.jsx)(j.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.integrationDateLastEdited.title",defaultMessage:"Edited on"})},{key:"more",header:void 0,style:{width:"5%"}}],rows:s,tableStyle:{borderTop:"none"}}),0===s.length?(0,O.jsx)("div",{style:i.emptyTable,children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.emptyTable.message",defaultMessage:"No integration installed"})}):void 0]})}function Be(e){const{integrationPointer:t,userStores:n,botIds:i,autoApproveBuiltByNotion:o}=e;if(t.table===h.K2){const e=t.id,s=(0,d.BP)({integrationId:e,env:"production"});return{key:e,columns:[(0,O.jsx)(Le,{integrationTable:h.K2,integrationId:e},"integration-title"),(0,O.jsx)(We,{renderedUsers:n,displayUsers:!s},"integration-installer-info"),(0,O.jsx)(oe,{integrationId:e,integrationTable:h.K2,botIds:i,disableDisconnectUser:s||void 0,disableDisallow:s&&o},"admin-integration-settings-menu")]}}if(t.table===m.cZ)return{key:t.id,columns:[(0,O.jsx)(Le,{integrationTable:m.cZ,integrationId:t.id},"integration-title"),(0,O.jsx)(We,{renderedUsers:n,displayUsers:!1},"integration-installer-info"),(0,O.jsx)(Pe,{botId:t.id},"integration-settings-menu")]};(0,S.t1)(t)}function Le(e){window.__c={n:"IntegrationTitle"};const{integrationId:t,integrationTable:n,maybeWebhookSubscriptionId:i}=e,o=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),s=(0,a.VK)((()=>{if(o)return o.getRecordModel({table:n,id:t})}),[o,t,n]),r=(0,a.VK)((()=>{var e;if(o&&i)return null===(e=o.getRecordModel({table:f.b,id:i,spaceId:o.id}))||void 0===e?void 0:e.getHealth()}),[o,i]),c=(0,a.VK)((()=>w.default.checkGate("inactive_webhook_subscription_ui")),[]),[d,u,v,b]=(0,a.VK)((()=>{if(!s)return[];let e;const i=[];let o;if(n===m.cZ){const a=s;a.icon&&(e={pointer:{table:n,id:t},icon:a.icon}),i.push("internal"),o=(0,O.jsx)(Ue,{botId:a.id})}else if(n===h.K2){const a=s,r=a.getInfo();r.icon&&(e={pointer:{table:n,id:t},icon:r.icon}),(0,p.mo)(a)&&(i.push("linkPreview"),(0,p.zc)(a)&&i.push("databaseSync")),o=(0,y.z6)(a.id)?null:(0,O.jsx)(Ve,{integrationId:a.id})}else(0,S.t1)(n);return[null==s?void 0:s.name,e,i,o]}),[n,t,s]);if(!s||!v)return(0,O.jsx)($.Z,{});let x=null;return c&&r&&(x=(0,O.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:3},children:[(0,g.t)({width:12,color:l.FN.light.red[500]}),(0,O.jsx)(ne.Z,{isSmall:!0,style:{color:l.FN.light.red[500]},children:(0,O.jsx)(j.FormattedMessage,{id:"workspaceIntegrationSettings.integrationTable.titleColumn.webhookError",defaultMessage:"Webhook error"})})]})),(0,O.jsxs)("div",{style:{display:"flex",alignItems:"center",maxWidth:300},children:[(0,O.jsx)(je.Z,{disabled:!0,icon:u,title:d,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),(0,O.jsxs)("div",{style:{minWidth:0,marginLeft:15},children:[(0,O.jsxs)("div",{style:{display:"flex",marginRight:16},children:[(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,O.jsx)(ne.Z,{children:d}),x]}),v.map((e=>e&&(0,O.jsx)(xe.Z,{desktopStyle:{marginLeft:4},children:Ne[e]},e)))]}),b]})]})}const Ue=e=>{let{botId:t}=e;window.__c={n:"InternalIntegrationDeveloperName"};const n=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),i=(0,j.useIntl)(),o=(0,a.VK)((()=>null==n?void 0:n.getRecordModel({table:m.cZ,id:t})),[n,t]),s=(0,a.VK)((()=>{if(n&&o){const e=n.getRecordModel({table:o.created_by_table,id:o.created_by_id});return(0,x.Nz)(i,e)}}),[n,o,i]);return s?(0,O.jsx)(ne.Z,{className:"notranslate",isSmall:!0,children:s}):(0,O.jsx)(Re,{})},Ve=e=>{let{integrationId:t}=e;window.__c={n:"PublicIntegrationDeveloperName"};const n=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),i=(0,r.Fg)(),o=(0,a.VK)((()=>{const e=null==n?void 0:n.getRecordModel({table:h.K2,id:t});return null==e?void 0:e.getInfo().developer_name}),[n,t]);return(0,d.BP)({integrationId:t,env:"production"})?(0,O.jsx)(ne.Z,{isSmall:!0,style:{display:"flex",alignItems:"center"},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.notion",defaultMessage:"Notion {icon}",values:{icon:(0,O.jsx)(Ie.ZP,{renderTooltip:()=>(0,O.jsx)("div",{children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfo.notion.tooltip",defaultMessage:"Developed by Notion"})}),placement:Ie.ug.Right,render:e=>(0,O.jsx)("div",{...e,children:(0,u.X)({width:12,height:12,fill:i.invoiceGreen})})})}})}):o?(0,O.jsx)(ne.Z,{className:"notranslate",isSmall:!0,children:o}):(0,O.jsx)(Re,{})},Re=()=>(0,O.jsx)(ne.Z,{isSmall:!0,children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.label.unverifiedDeveloper",defaultMessage:"Unverified developer"})});function Ke(e){window.__c={n:"AdminComplianceEditedBy"};const{editedByPointer:t}=e,n=(0,j.useIntl)(),i=(0,a.VK)((()=>{const e=I.default.state.currentSpaceStore;if(e)return e&&t?Z.U.createChildStore(e,t):void 0}),[t]),o=(0,a.VK)((()=>null==i?void 0:i.getDisplayName(n)),[i,n]);return i&&o?(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:8,alignItems:"center",width:"100%"},children:[(0,O.jsx)(we.Z,{userStore:i,size:18}),(0,O.jsx)(ne.Z,{children:o})]}):null}function Ee(e){const{lastEditedOn:t}=e;return void 0===t?null:(0,O.jsx)(Me.i,{useThinTitle:!0,title:(0,c.Yx)(t,"long",o.SP)})}function We(e){window.__c={n:"IntegrationInstallerInfo"};const{renderedUsers:t,displayUsers:n}=e,o=(0,a.VK)((()=>I.default.state.currentSpaceStore),[]),r=(0,j.useIntl)(),l=(0,s.O7)(),c=(0,a.VK)((()=>{if(o)return(0,M.rn)(l,o)}),[l,o]),d=(0,i.useMemo)((()=>t&&t.length),[t]),u=(0,a.VK)((()=>t&&t.length>0?t[0]:void 0),[t]),g=(0,a.VK)((()=>u?u.getDisplayName(r):void 0),[u,r]);return n&&void 0!==d?u?(0,O.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(we.Z,{userStore:u,avatarShouldShowShadow:!0,style:{marginRight:8},size:28}),(0,O.jsx)(ne.Z,{children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.listOfUsers",defaultMessage:"{remainingCount, plural, =0 {{firstUser}} one {{firstUser} +{remainingCount}} other {{firstUser} +{remainingCount}}}",values:{firstUser:g,remainingCount:d-1}})})]}):(0,O.jsx)(ne.Z,{isSecondaryColor:!0,style:{display:"flex",alignItems:"center"},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.noUsers",defaultMessage:"No users"})}):(0,O.jsx)(ne.Z,{style:{display:"flex",alignItems:"center"},children:(0,O.jsx)(j.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.anyone",defaultMessage:"Anyone in {spaceName}",values:{spaceName:(0,O.jsx)(ne.Z,{style:{fontWeight:b.Z.fontWeight.medium},children:c})}})})}},73084:(e,t,n)=>{n.d(t,{Z:()=>H});n(57658),n(67294);var i=n(83355),o=n(480),s=n(86628),a=n(49085),r=n(8848),l=n(35840),c=n(72141),d=n(21202),u=n(29369),g=n(9291),p=n(65452),m=n(28020),h=n(98165),f=n(38755),v=n(80444),y=n(26136),S=n(28517),b=n(24405),x=n(52275),j=n(60458),M=n(31278),I=n(76798),w=n(14694),C=n(85893);const Z={display:"flex",alignItems:"center"};const A=function(e){const{nestingLevel:t,isChecked:n,onClick:i,store:o,isMobile:s}=e;return(0,C.jsx)(x.Z,{...e,title:(0,C.jsx)(w.Z,{childrenStyle:Z,left:(0,C.jsx)(k,{isChecked:n,onClick:i}),icon:(0,C.jsx)(P,{store:o,isMobile:s}),style:{marginLeft:8*t},children:(0,C.jsx)(I.Z,{store:o})})})};function k(e){let{isChecked:t,onClick:n}=e;return(0,C.jsx)(j.Z,{size:16,checked:t,onClick:n})}function P(e){let{store:t,isMobile:n}=e;window.__c={n:"IconComponent"};const i=(0,b.Fg)(),o=(0,s.VK)((()=>t.getIcon()),[t]),a=(0,s.VK)((()=>t.isEmptyPage()),[t]);return(0,C.jsx)(M.Z,{disabled:!0,icon:o,title:void 0,isEmptyPage:a,size:n?24:20,pageIconStyle:{fill:i.mediumIconColor}})}var T=n(68894),_=n(68785),N=n(32163),F=n(53437),D=n(72495),B=n(59054),L=n(97880),U=n(87279),V=n(77907),R=n(75822),K=n(78140),E=n(43765),W=n(11470),O=n(78948);function q(e){window.__c={n:"OauthPageSearchResults"};const{spaceId:t,onSelectPage:n,query:i,source:s,findSelectedBlockAncestorId:a}=e,r=(0,o.O7)();let l=null;const u=(0,V.useDependency)(V.deps.searchActions),[{status:p,value:m}]=(0,B.r5)((async()=>{if("resolved"!==u.status)return;const e=u.value;return await e.searchPagesInSpace({environment:r,query:i,limit:10,requireEditPermissions:!0,spaceId:t,excludeTemplates:!0,source:s,boostRecentlyViewedPages:!1})}),[r,i,t,s,u.status,u.value],{debounce:R.vp});if("idle"===p||"pending"===p)l=(0,C.jsx)(D.Z,{children:(0,C.jsx)(O.Z,{})});else{const e=((null==m?void 0:m.results)||[]).map((e=>{let{id:t}=e;const i=new y.G(r,{table:d.iU,id:t});return function(e){const{store:t,environment:n,alreadySelectedAncestorId:i,onSelectPage:o}=e;if(i&&i===t.id)return{key:t.id,action:()=>{},render:e=>(0,C.jsx)(W.Z,{...e,store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:(0,C.jsx)(g.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.bySelf.message",defaultMessage:"Already added"})})};if(i){const e=new y.G(n,{table:d.iU,id:i});return{key:t.id,action:()=>{},render:n=>(0,C.jsx)(W.Z,{...n,store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:(0,C.jsx)(g.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.byAncestor.message",defaultMessage:"Already added via {ancestorPageName}",values:{ancestorPageName:(0,C.jsx)(I.Z,{store:e,style:{display:"inline"}})}})})}}const s=t.getRole();return s&&c.zz(s)?{key:t.id,action:()=>o(t.id),render:e=>(0,C.jsx)(W.Z,{store:t,hidePath:!1,...e})}:void 0}({store:i,alreadySelectedAncestorId:a(i),environment:r,onSelectPage:n})})).filter(L.$K);l=0===e.length?(0,C.jsx)(D.Z,{children:(0,C.jsx)(E.Z,{title:(0,C.jsx)(g.FormattedMessage,{id:"oauthPageSearchResults.noResults.placeholder",defaultMessage:"No results"})})}):function(e){return(0,C.jsx)(N.Z,{type:N.i.Vertical,initialFocus:void 0,sections:[{key:"results",items:e,render:e=>(0,C.jsx)(D.Z,{...e})}]})}(e)}const h={menuType:U.og.Popup};return(0,C.jsx)(K.Z,{...h,children:l})}class z extends i.Z{constructor(){super(...arguments),this.storeTypes={selectedBlockIdsStore:a.default.createClass({}),searchStore:a.default.createClass({open:!1,query:void 0})},this.getPageSection=(e,t,n)=>{const i=n.filter((e=>c.zz(e.getRole()||"none")));return{key:e,render:e=>(0,C.jsx)(D.Z,{...e}),items:[this.getPageSectionHeader(t,i),...0===i.length?[(o=this.theme,{key:"empty",action:()=>{},render:e=>(0,C.jsx)(x.Z,{...e,title:(0,C.jsx)(w.Z,{style:{fontSize:14,color:o.mediumTextColor,padding:"2px 32px"},children:(0,C.jsx)(g.FormattedMessage,{id:"oauthAuthorizationPage.selectPageStep.empty",defaultMessage:"No pages inside"})})})})]:i.map((e=>this.getPageItem(e,1)))]};var o},this.getPageItem=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores,{device:i}=this.environment,o=Boolean(n.state[e.id]);return{key:e.id,action:()=>this.handleClickPage(e.id,o),render:n=>(0,C.jsx)(A,{...n,isMobile:i.isMobile,store:e,isChecked:o,disabled:!1,nestingLevel:t})}},this.getPageSectionHeader=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores,i=t.length>0&&t.every((e=>n.state[e.id]));return{key:e,action:()=>this.handleClickSection(t),render:t=>(0,C.jsx)(x.Z,{...t,title:(0,C.jsx)(w.Z,{left:(0,C.jsx)(j.Z,{onClick:t.onClick,checked:i,size:16}),style:$(),children:e})})}},this.handleClickPage=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores;n.setState({...n.state,[e]:!t})},this.handleClickSection=e=>{const{selectedBlockIdsStore:t}=this.stores,n=e.every((e=>t.state[e.id]));t.setState({...t.state,...e.reduce(((e,t)=>(e[t.id]=!n,e)),{})})},this.handleSearchQueryChange=e=>{const t=this.stores.searchStore.state,n=e.length>0;this.stores.searchStore.setState({...t,query:e,open:n})},this.handleSearchCancel=()=>{const e=this.stores.searchStore.state;this.stores.searchStore.setState({...e,open:!1,query:void 0})},this.findSelectedBlockAncestorId=e=>{const{selectedBlockIdsStore:t}=this.stores;if(t.state[e.id])return e.id;const n=h.fJ(e).find((e=>e.table===d.iU&&Boolean(t.state[e.value.id])));return n?n.value.id:void 0}}renderComponent(){const{intl:e}=this.props,{searchStore:t,selectedBlockIdsStore:n}=this.stores,i=(0,m.k_)(this.environment).state;if(!i)return(0,C.jsx)(_.Z,{style:{alignSelf:"center"}});const{allSharedPagesStores:o,showWorkspaceSection:s,showTeamSection:a,showSharedSection:c,showPrivateSection:p,showOnlyPrivateSection:h}=i,{currentSpaceViewStore:S,currentSpaceStore:b}=v.default.state;if(!S||!b)return;const x=[];if(a){const e=S.getTeamsStores();x.push(...e.map((e=>[e,e.getTeamPagesStores().filter(G)])))}const j=S.getWorkspacePages().filter(G),M=S.getPrivatePages(this.environment).filter(G),I=Object.keys(n.state).filter((e=>n.state[e])).map((e=>new y.G(this.environment,{table:d.iU,id:e}))).filter((e=>e.getSpaceId()===b.id&&e.isNavigableBlock()&&!e.isTopLevelPrivatePage({spaceStore:b,environment:this.environment})&&!e.isTopLevelWorkspacePage(b.id)&&!(e.getParentTable()===u.e0)&&!o.some((t=>t.id===e.id)))),Z=(0,f.rn)(this.environment,b),A=[];if(I.length>0&&A.push({key:"manual",render:e=>(0,C.jsx)(D.Z,{...e,title:(0,C.jsx)(w.Z,{style:$(),children:(0,C.jsx)(g.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.pagePicker.manuallyAddedPagesSection.title",defaultMessage:"Manually added"})}),isTitleUppercase:!0}),items:I.map((e=>this.getPageItem(e,0)))}),s&&A.push(this.getPageSection("workspace",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.workspaceSection.title",defaultMessage:"Workspace"}),j)),a)for(const[r,l]of x){const e=r.id,t=r.getName();e&&void 0!==t&&A.push(this.getPageSection(`team-${e}`,t,l))}if(c&&A.push(this.getPageSection("shared",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.sharedSection.title",defaultMessage:"Shared"}),o)),p){const t=h?Z||"":e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.privateSection.title",defaultMessage:"Private"});A.push(this.getPageSection("private",t,M))}const k={width:14,height:14,marginLeft:8,marginRight:8,flexGrow:0,flexShrink:0,fill:r.ZP.mediumIconColor};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(F.GI,{origin:(0,C.jsx)(T.ZP,{style:{marginBottom:8},itemMarginLeft:0,itemMarginRight:0,focus:!0,focusAfterAnimation:!0,value:t.state.query||"",onChange:e=>{this.handleSearchQueryChange(e.target.value)},placeholder:e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.search.placeholder",defaultMessage:"Search for pages in {workspaceName}"},{workspaceName:Z}),inputLeft:(0,l.R)(k)}),sameWidthAsOrigin:!0,popupType:F.GI.PopupType.Popup,open:t.state.open,render:()=>(0,C.jsx)(q,{spaceId:b.id,onSelectPage:e=>this.handleClickPage(e,!1),query:t.state.query||"",source:"oauth",findSelectedBlockAncestorId:this.findSelectedBlockAncestorId}),onDismiss:this.handleSearchCancel}),(0,C.jsx)("div",{style:{alignItems:"left",width:"100%",height:380,borderWidth:1,borderStyle:"solid",borderColor:r.ZP.contentBorder,borderRadius:4,overflowY:"auto"},children:(0,C.jsx)(N.Z,{type:N.i.Vertical,sections:A,initialFocus:void 0})})]})}}function G(e){return e.isDefined()&&"copy_indicator"!==e.getType()}z.displayName="BotAccessPagePicker";const H=function(e){window.__c={n:"BotAccessPagePickerWrapper"};const t=(0,o.O7)(),n=(0,s.VK)((()=>{var e;return null===(e=v.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),i=t.currentUser.id,a=(0,g.useIntl)();return(0,s.VK)((()=>{n&&i&&(p.h({environment:t,spaceId:n,userId:i}),S.I({environment:t,spaceId:n,userId:i}))}),[t,n,i]),(0,C.jsx)(z,{intl:a,...e})};function $(){return{textTransform:"uppercase",fontSize:12,fontWeight:600,color:r.ZP.mediumTextColor,padding:"2px 0"}}},94512:(e,t,n)=>{n.d(t,{Z:()=>y});var i=n(67294),o=n(480),s=n(24405),a=n(16184),r=n(97880),l=n(82990),c=n(9291),d=n(57549),u=n(35878),g=n(64921),p=n(74420),m=n(74136),h=n(89728),f=n(23189),v=n(85893);function y(e){window.__c={n:"ConnectedAppsSettingsDiscoverSection"};const{apps:t,numberOfConnectedApps:n,title:s,subtitle:a,numberOfDisplayRows:l}=e,u=(0,o.O7)(),[g,p]=(0,i.useState)(!1),m=3*(l||1),y=t.filter((e=>!e.shouldHideInDiscover)),b=y.length>m&&!g,x=g?y:y.slice(0,m);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(f.Z,{large:!0,divider:"none",children:[s,a]}),(0,v.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:x.map((e=>{var t;return"string"==typeof e.logo&&e.onConnect&&(0,v.jsx)(S,{appName:e.appName,caption:e.caption,shouldShowNewBadge:e.shouldShowNewBadge,shouldShowUpsell:e.shouldShowUpsell,logo:e.logo,integrationTypes:null===(t=e.integrationTypes)||void 0===t?void 0:t.slice(0,2),onConnect:e.onConnect},e.id)})).filter((e=>(0,r.$K)(e)))}),b&&(0,v.jsx)(h.Z,{style:{marginTop:10,gap:10,marginLeft:-8},isGray:!0,onClick:()=>{g||(p(!0),d.EU(u,{numberOfConnectedApps:n}))},children:(0,v.jsx)(c.FormattedMessage,{id:"connectedAppsSettings.discoverNewAppSection.seeAll.label",defaultMessage:"See all"})})]})}function S(e){window.__c={n:"ConnectedAppsSettingsDiscoverItem"};const{appName:t,caption:n,logo:i,shouldShowNewBadge:o,shouldShowUpsell:r,integrationTypes:d,onConnect:f}=e,y=(0,s.yK)((e=>({card:{display:"flex",flexDirection:"column",borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:"#E3E2E0",padding:16,height:"100%"},upsellCard:{backgroundColor:e.whiteButtonBackground},image:{width:40,height:40,borderRadius:4,float:"left"},titleAndPillContainer:{display:"block",float:"left",marginLeft:4},titleAndNewBadgeContainer:{alignItems:"center",display:"flex",marginLeft:4},title:{fontWeight:l.Z.fontWeight.medium,fontSize:16},caption:{marginTop:8,fontWeight:l.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:12,maxHeight:72,overflow:"hidden"},pillContainer:{marginTop:2,display:"flex"},pill:{marginLeft:4},cardHover:{borderRadius:6,background:e.outlineBlueButtonHoveredBackground},connectButton:{marginLeft:-8,marginTop:3},connectButtonHoveredOrPressed:{background:"transparent"},lockedIcon:{color:e.mediumIconColor,width:16,height:16,marginLeft:6}})),[]),S=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("img",{style:y.image,src:i}),(0,v.jsxs)("div",{style:y.titleAndPillContainer,children:[(0,v.jsxs)("div",{style:y.titleAndNewBadgeContainer,children:[(0,v.jsx)("div",{style:y.title,children:t}),o&&(0,v.jsx)(p.Z,{}),r&&(0,a.Q)(y.lockedIcon)]}),(0,v.jsx)("div",{style:y.pillContainer,children:null==d?void 0:d.map((e=>e&&(0,v.jsx)("div",{style:y.pill,children:(0,v.jsx)(m.Z,{children:u.a_[e]})},e)))})]})]}),(0,v.jsx)("div",{style:y.caption,children:n})]});return r?(0,v.jsx)("div",{style:{...y.card,...y.upsellCard},children:S}):(0,v.jsx)(g.Z,{onClick:f,hoveredStyle:y.cardHover,children:(0,v.jsxs)("div",{style:y.card,children:[S,(0,v.jsx)(h.Z,{isBlue:!0,style:y.connectButton,hoveredStyle:y.connectButtonHoveredOrPressed,pressedStyle:y.connectButtonHoveredOrPressed,onClick:f,children:(0,v.jsx)(c.FormattedMessage,{id:"connectedAppSettingsDiscoverItem.connectButton.label",defaultMessage:"Connect"})})]})})}},70578:(e,t,n)=>{n.d(t,{Z:()=>p});n(67294);var i=n(480),o=n(9999),s=n(84169),a=n(89101),r=n(9291),l=n(57549),c=n(18514),d=n(16354),u=n(89728),g=n(85893);function p(){window.__c={n:"ConnectionsSettingsLinks"};const e=(0,i.O7)();return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(d.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:`${a._j.integrations}/all`,external:!0,onClick:()=>{l.uy(e,{from:"integration-settings",href:`${a._j.integrations}/all`})},children:(0,g.jsx)(u.Z,{icon:o.J,isSmall:!0,isLightGray:!0,children:(0,g.jsx)(r.FormattedMessage,{id:"connectionsSettingsLinks.connectionsGallery",defaultMessage:"Browse connections in Gallery"})})}),(0,g.jsx)(d.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:a._j.myIntegrations,external:!0,onClick:()=>{l.YY(e,{from:"integration-settings",href:a._j.myIntegrations})},children:(0,g.jsx)(u.Z,{icon:o.J,isSmall:!0,isLightGray:!0,children:(0,g.jsx)(r.FormattedMessage,{id:"connectionsSettingsLinks.manageConnections",defaultMessage:"Develop or manage integrations"})})}),(0,g.jsx)(d.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:(0,c.UY)("guides.publicAPI"),external:!0,children:(0,g.jsx)(u.Z,{icon:s.m,isSmall:!0,isLightGray:!0,children:(0,g.jsx)(r.FormattedMessage,{id:"connectionsSettingsLinks.helpCenter",defaultMessage:"Learn more about connections"})})})]})}},38493:(e,t,n)=>{n.d(t,{Z:()=>Ze,O:()=>Ce});n(57658);var i=n(67294),o=n(83355),s=n(41892),a=n(15070),r=n(77657),l=n(74181),c=n(72126),d=n(77420),u=n(15047),g=n(90965),p=n(94826),m=n(97880),h=n(9291),f=n(57549),v=n(54642),y=n(99405),S=n(64002),b=n(47307),x=n(95477),j=n(68821),M=n(91924),I=n(46190),w=n(47593),C=n(92625),Z=n(15356);const A=(0,h.defineMessages)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});var k=n(76463),P=n(22711),T=n(91584),_=n(83805),N=n(89475),F=n(52192),D=n(12170),B=n(23586);var L=n(38755),U=n(34859),V=n(80444),R=n(88632),K=n(30874),E=n(26136),W=n(72087),O=n(88280),q=n(94512),z=n(70578),G=n(61519),H=n(68785),$=n(53336),J=n(64369),Y=n(27386),Q=n(23189),X=n(31278),ee=n(40235),te=n(480),ne=n(86628),ie=n(49085),oe=n(8848),se=n(87279),ae=n(88893),re=n(24736),le=n(73084),ce=n(42922),de=n(52275),ue=n(31945),ge=n(78140),pe=n(32163),me=n(63296),he=n(72495),fe=n(42782),ve=n(85893);function ye(e){window.__c={n:"UserConnectionsSettingsActionMenu"};const{botId:t,canSelectPageAccess:n,onConnect:o,onDisconnect:s}=e,[a,r]=(0,i.useState)(!1),[l]=(0,i.useState)(ie.default.createValue({})),c=(0,ne.VK)((()=>V.default.state.currentSpaceStore),[]),u=(0,te.O7)(),g=(0,te.Fy)(),p=(0,ne.VK)((()=>O.subscriptionDataStoreInstance.state),[]),m=(p?(0,ae.NM)(p):[]).find((e=>e.botId===t)),f=(0,i.useMemo)((()=>(null==m?void 0:m.pageIds.reduce(((e,t)=>(e[t]=!0,e)),{}))??{}),[null==m?void 0:m.pageIds]);(0,i.useEffect)((()=>{n&&c&&!a&&(l.setState(f),r(!0))}),[n,c,a,f,l]);const v=[];n&&c&&v.push({key:"actions for user guest connections",render:e=>(0,ve.jsx)(he.Z,{...e}),items:[{key:"update selected pages",render:(e,n)=>(0,ve.jsx)(fe.Z,{...e,onFocus:n.onFocus,disableDefaultClick:!0,renderOrigin:e=>(0,ve.jsx)(de.Z,{...e,title:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.actionMenu.selectPages.label",defaultMessage:"Access selected pages"})}),renderExtension:(e,n)=>{return(0,ve.jsxs)("div",{style:{width:400,padding:20},children:[(0,ve.jsx)(le.Z,{selectedBlockIdsStore:l}),(i={leftText:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.cancel",defaultMessage:"Cancel"}),leftAction:()=>{l.setState(f),n.close()},rightText:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.update",defaultMessage:"Update access"}),rightAction:()=>{!function(e){const{botId:t,currentSpaceStore:n,environment:i,selectedBlockIdsStore:o,currentAccessedPages:s}=e,a=[],r=[],l=o.state;Object.keys(l).forEach((e=>{s.hasOwnProperty(e)&&!l[e]?a.push(e):!s.hasOwnProperty(e)&&l[e]&&r.push(e)}));const c=E.t1.createChildStore(n,{table:d.cZ,id:t});k.jX({environment:i,currentSpaceStore:n,botStore:c,pages:a}),k.jX({environment:i,currentSpaceStore:n,botStore:c,pages:r,addPermission:!0})}({selectedBlockIdsStore:l,environment:u,currentSpaceStore:c,botId:t,currentAccessedPages:f}),n.close()}},(0,ve.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:24},children:[(0,ve.jsx)(me.Z,{isLarge:!0,onClick:i.leftAction,style:{height:32},children:i.leftText}),(0,ve.jsx)(ce.Z,{isLarge:!0,onClick:i.rightAction,children:i.rightText})]}))]});var i}}),action:()=>{}}]});const y=[];return o&&y.push({key:"connect account",render:e=>(0,ve.jsx)(de.Z,{...e,title:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.actionMenu.connectAccount.label",defaultMessage:"Connect another account"}),onClick:o}),action:o}),y.push({key:"disconnect account",render:e=>(0,ve.jsx)(de.Z,{...e,title:(0,ve.jsx)("div",{style:{color:oe.ZP.red},children:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.actionMenu.disconnectAccount.label",defaultMessage:"Disconnect account"})}),onClick:()=>{s()}}),action:()=>s()}),v.push({key:"actions for all user connections",render:e=>(0,ve.jsx)(he.Z,{...e}),items:y}),(0,ve.jsx)(ue.ZP,{popupType:g.isMobile?ue.Z4.SlideUp:ue.Z4.Popup,renderOrigin:e=>(0,ve.jsx)(re.Z,{...e,isMobile:g.isMobile}),render:()=>(0,ve.jsx)(ge.Z,{menuType:g.isMobile?se.og.ActionSheet:se.og.Popup,children:(0,ve.jsx)(pe.Z,{type:pe.i.Vertical,sections:v,initialFocus:void 0})})})}function Se(e){const{userConnections:t}=e;return(0,ve.jsx)(ee.Z,{columns:[{key:"connection",header:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"40%"}},{key:"access",header:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.title",defaultMessage:"Access"}),style:{width:"40%"}},{key:"more",header:void 0,style:{width:"5%"}}],rows:be(t)})}function be(e){const t=[];return e.forEach((e=>{const{account:n,onDisconnect:i}=e;if(Array.isArray(n)){const o=n.map((t=>xe({connection:{...e,onDisconnect:()=>{i(t)}},account:t})));t.push(...o)}else t.push(xe({connection:e,account:n}))})),t}function xe(e){const{account:t,connection:{id:n,appName:i,canSelectPageAccess:o,capabilities:s,logo:a,onConnect:r,onDisconnect:l}}=e,c=void 0!==t&&"string"!=typeof t,d=c?t.accountName:t,u=c?t.accountId:n;return{key:`${n}-${d}`,columns:[(0,ve.jsx)(je,{accountName:d,connectionLogo:a,connectionName:i},"connection-title"),s,(0,ve.jsx)(ye,{botId:u,canSelectPageAccess:o,connectionName:i,onConnect:r,onDisconnect:l},"connection-action-menu")]}}function je(e){const{accountName:t,connectionLogo:n,connectionName:i}=e;return(0,ve.jsxs)("div",{style:{display:"flex",alignItems:"center",marginRight:12},children:["string"==typeof n?(0,ve.jsx)("img",{src:n,style:{height:28}}):(0,ve.jsx)(X.Z,{disabled:!0,icon:n,title:i,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),(0,ve.jsxs)("div",{style:{marginLeft:15},children:[(0,ve.jsx)(J.Z,{children:i}),t&&(0,ve.jsx)(J.Z,{isSmall:!0,children:t})]})]})}const Me={height:"100%",padding:"36px 60px"},Ie={alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"};class we extends o.Z{constructor(){super(...arguments),this.storeTypes={requestStore:W.Z}}renderComponent(){return R.Z.state.online?(0,ve.jsx)(B.Z,{request:this.environment,performRequest:()=>async function(e){const{currentSpaceStore:t}=V.default.state;return{guestBotIds:await _e(e),connectionStatus:await P.LN(e,null==t?void 0:t.id)}}(this.environment),requestStore:this.stores.requestStore,render:(e,t)=>null!=t&&t.connectionStatus?this.renderConnectedAppsSettings(t.guestBotIds):(0,ve.jsx)("div",{style:Ie,children:(0,ve.jsx)(H.Z,{})})}):(0,ve.jsx)(ke,{})}renderConnectedAppsSettings(e){const{connected:t,discover:n}=this.getAppsByCategory(e),i=t.length>0;return(0,ve.jsx)("div",{style:(o=this.props.location,{display:"flex",flexDirection:"column",height:"100%",width:"sidebar-modal"===o?"100%":"auto"}),children:(0,ve.jsxs)($.Z,{style:Me,type:U.Z.Y,children:[i&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(Q.Z,{large:!0,divider:"full",style:{borderBottom:"none",marginBottom:0},children:(0,ve.jsx)(h.FormattedMessage,{id:"connectionsSettings.connectionsSection.title",defaultMessage:"My connections"})}),(0,ve.jsx)(Se,{userConnections:t})]}),(0,ve.jsxs)("div",{style:{marginTop:i?32:void 0},children:[(0,ve.jsx)(q.Z,{apps:n,numberOfConnectedApps:t.length,title:(0,ve.jsx)("div",{style:{display:"flex",justifyContent:"space-between",height:28,fontSize:16,fontWeight:510},children:(0,ve.jsx)(h.FormattedMessage,{id:"connectionsSettings.discoverNewConnectionsSection.title",defaultMessage:"Discover new connections"})})}),(0,ve.jsx)(G.Z,{size:16,style:{marginTop:16}})]}),(0,ve.jsx)("div",{style:{marginTop:8},children:(0,ve.jsx)(z.Z,{})})]})});var o}async handleDriveAuth(){f.SO(this.environment,{integration_name:"google",from:"connected_apps"}),await T.qN(this.environment),await P.LN(this.environment),await this.stores.requestStore.refresh()}handleDisconnectDrive(e){const{intl:t}=this.props;b.showDialog({message:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.message",defaultMessage:"Disconnecting disables file preview on Google Drive files embedded in all of your workspaces. It would not delete your embeds from Notion, so you can re-connect at anytime."}),showCancel:!0,keepFocus:!0,items:[{label:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.disconnectButton.label",defaultMessage:"Disconnect"}),color:"red",onAccept:async()=>{await v.disconnectDrive(this.environment,{googleUserId:e.accountId}),await P.LN(this.environment),await this.stores.requestStore.refresh()}}]})}getAppsByCategory(e){const t=c.vM([...Te(this.environment),...this.getLegacyConnectedApps()],(e=>e.account&&e.account.length>0?"connected":"discover"));return{connected:[...Pe(e,this.environment),...t.connected||[]],discover:t.discover||[]}}getLegacyConnectedApps(){var e;const{intl:t}=this.props,n=this.stores.requestStore;let i=!1;const{currentSpaceStore:o}=V.default.state,a=null===(e=n.state.result)||void 0===e?void 0:e.connectionStatus,c=(null==a?void 0:a.drive)&&(null==a?void 0:a.drive.length)>0,d=function(){const{integrations:{state:e}}=K.Z;return!e.some((e=>e.id===r.f3))}();if(d){const e=null==o?void 0:o.getBotSettingsStore().getValue();i=!(0,g.CJ)(e)||Boolean((null==e?void 0:e.integration_approval_statuses)&&e.integration_approval_statuses[l._o])}const u=(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.legacyImporter",defaultMessage:"Can only add pages"});return[...d&&(i||c)?[{id:"drive",appName:"Google Drive",caption:t.formatMessage({id:"connectedAppsSettings.googleDrive.caption",defaultMessage:"Find and embed your files."}),shouldHideConnectAccount:!i,shouldHideInDiscover:!d,logo:s.Z.images.import.googleDrivePng,account:null==a?void 0:a.drive,capabilities:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.googleDrive",defaultMessage:"Can embed content"}),canSelectPageAccess:!1,onConnect:()=>this.handleDriveAuth(),onDisconnect:e=>{e&&this.handleDisconnectDrive(e)}}]:[],{id:"evernote",appName:"Evernote",caption:t.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks."}),logo:s.Z.images.import.evernotePng,account:null==a?void 0:a.evernote,capabilities:u,canSelectPageAccess:!1,integrationTypes:["importer"],onConnect:()=>_.e({environment:this.environment,requestStore:n}),onDisconnect:()=>P.Lm(this.environment,n)},{id:"trello",appName:"Trello",caption:t.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards."}),logo:s.Z.images.import.trelloPng,shouldHideInDiscover:!0,account:null==a?void 0:a.trello,capabilities:u,integrationTypes:["importer"],canSelectPageAccess:!1,onConnect:()=>F.M({environment:this.environment,requestStore:n}),onDisconnect:()=>P.C(this.environment,n)},{id:"asana",appName:"Asana",caption:t.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists."}),logo:s.Z.images.import.asanaPng,shouldHideInDiscover:!0,integrationTypes:["importer"],account:null==a?void 0:a.asana,capabilities:u,canSelectPageAccess:!1,onConnect:()=>async function(e){const{environment:t,requestStore:n}=e,i=(0,M.eC)(t);let o=(0,y.s1)(x.default.domainBaseUrl,{authType:i,userId:t.currentUser.id});o=i.redirectToAuth?o:await(0,M.HU)(t,o);const s=await Z.M(t,{width:580,height:800,url:o,titleMessage:A.titleMessage});if(!s)return;const a=S.Qc(s);if(!a.query.code||!a.query.state)return;C.j({message:A.authenticatingWithAsana});const r=await v.authWithAsana(t,{code:a.query.code,encryptedState:a.query.state});"failed"===r.type?(console.error(r.error),b.showError(r),C.x()):(f.L3(t,{integration_name:"asana"}),await n.refresh(),I.Z.setState({open:!0}),(0,j.c)()||w.Z.setState({open:!0}),C.x())}({environment:this.environment,requestStore:n}),onDisconnect:()=>P.Ow(this.environment,n)},...null!=o&&o.id?[{id:"confluence",appName:"Confluence",caption:t.formatMessage({id:"connectedAppsSettings.confluence.caption",defaultMessage:"Import Spaces from Confluence."}),logo:s.Z.images.import.confluencePng,shouldHideInDiscover:!0,account:null==a?void 0:a.confluence,capabilities:u,integrationTypes:["importer"],canSelectPageAccess:!1,onDisconnect:()=>P.DP(this.environment,n,o.id)}]:[]]}}function Ce(e){const t=[];return null!=e&&e.read_content&&t.push((0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.readContent",defaultMessage:"view"})),null!=e&&e.insert_content&&t.push((0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.insertContent",defaultMessage:"insert"})),null!=e&&e.update_content&&t.push((0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.updateContent",defaultMessage:"update"})),t}we.displayName="UserConnectionsSettings";const Ze=(0,h.injectIntl)(we);function Ae(e){const t=[(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.previewLinks",defaultMessage:"preview links"},"previewLinks")];return function(e){return!!e.info.original_url_patterns&&e.info.original_url_patterns.some((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection}))}(e)&&t.push((0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.syncDatabases",defaultMessage:"sync databases"},"syncedDatabase")),t}function ke(){return(0,ve.jsx)(Y.ZP,{children:(0,ve.jsx)(J.Z,{isSmall:!0,style:{textAlign:"center"},children:(0,ve.jsx)(h.FormattedMessage,{id:"connectedAppsSettings.offline.message",defaultMessage:"Please go online to manage connecting to apps."})})})}function Pe(e,t){const{currentSpaceStore:n}=V.default.state;if(!n||(0,L.Cx)(n))return[];return e.map((e=>{const i=E.t1.createChildStore(n,{table:d.cZ,id:e}),o=i.getName(),s=i.getIntegrationId();if(!i.getAlive()||!o||!s)return;const a=i.getIntegrationPointer(),r=i.getIcon(),l=r&&a?{pointer:a,icon:r}:void 0;return{id:i.id,appName:o,caption:void 0,account:void 0,logo:l,capabilities:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.userGuest",defaultMessage:"Can {capabilities} content",values:{capabilities:(0,ve.jsx)(h.FormattedList,{value:Ce(i.getCapabilities()),type:"conjunction"})}}),canSelectPageAccess:!0,onDisconnect:async()=>{await b.confirmUserAction({message:(0,ve.jsx)("span",{children:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"})}),acceptLabel:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&await k.P0({environment:t,botId:i.id,onSuccess:()=>{}})}}})).filter(m.$K)}function Te(e){const{currentSpaceStore:t}=V.default.state;if(!t||!t.canEdit())return[];const n=t.getBotSettingsStore().getValue(),i=t.id,{integrations:{state:o},bots:{state:s},externalAuthentications:{state:u}}=K.Z,v=t.canAdmin(),y=r.Gw,S={[r.U9]:1,[y]:2};o.sort(((e,t)=>(S[e.id]??1/0)-(S[t.id]??1/0)));const x=[r.U9];return o.map((o=>{if(!o.info.icon)return;if(!v&&x.includes(o.id))return;if((0,p.I$)(o.id))return;const m=s.filter((e=>e.integration_id===o.id)),y=c.oA(m.map((e=>{const t=u.find((t=>t.parent_id===e.id));if(t)return{accountId:e.id,accountName:t.account_name}}))),S=(0,g.hU)({spaceBotSettings:n,integrationId:o.id,env:"production"}),j=y.length>0;if(!S&&!j)return;if(!j&&o.id===r.Dv)return;const M=!S,I=(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.external",defaultMessage:"Can {capabilities}",values:{capabilities:(0,ve.jsx)(h.FormattedList,{value:Ae(o),type:"conjunction"})}}),w=(0,a.ms)(o.capabilities),C=o.capabilities.inherit_creator_permissions,Z=w&&!C,A=[];return(0,l.mo)(o)&&A.push("linkPreview"),(0,l.zc)(o)&&A.push("databaseSync"),{id:o.id,appName:o.name,caption:o.info.tagline,logo:o.info.icon,account:y,shouldHideConnectAccount:M,shouldShowNewBadge:!o.info.hide_new_badge,integrationTypes:A,capabilities:(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("div",{children:I}),w?(0,ve.jsx)("div",{children:(0,ve.jsx)(h.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.externalWithCapabilities",defaultMessage:"Can {capabilities} content",values:{capabilities:(0,ve.jsx)(h.FormattedList,{value:Ce(o.capabilities),type:"conjunction"})}})}):null]}),canSelectPageAccess:Z,onConnect:async()=>{await N.hM({environment:e,integration:o,spaceId:i,from:"connected_apps_settings"}),D.pJ({environment:e})},onDisconnect:async n=>{const i=s.find((e=>e.id===(null==n?void 0:n.accountId)));if(i){const s=E.t1.createChildStore(t,{table:d.cZ,id:i.id,spaceId:i.space_id}),a=null!=n&&n.accountName?(0,ve.jsx)(h.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for {accountName}?",values:{accountName:n.accountName}}):(0,ve.jsx)(h.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"});await b.confirmUserAction({message:(0,ve.jsx)("span",{children:a}),acceptLabel:(0,ve.jsx)(h.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&(await k.P0({environment:e,botId:s.id,onSuccess:()=>{}}),f.lL(e,{integrationId:o.id}))}}}})).filter(m.$K)}async function _e(e){const{currentSpaceStore:t,currentUserStore:n}=V.default.state;if(!t||!n||!O.subscriptionDataStoreInstance.state)return[];return(await k.Yw({environment:e,table:u.bx,id:t.id,type:"guest"})).botIds.filter((e=>E.t1.createChildStore(t,{table:d.cZ,id:e}).getCreatedById()===n.id))}},41623:(e,t,n)=>{n.d(t,{Nq:()=>o,f_:()=>s,yh:()=>a});var i=n(15070);function o(e,t){const n=t.getAlive(),o=(0,i.hA)(t),s=Boolean(!t.getIntegrationId()),a=Boolean(t.getIntegrationId()),r=Boolean(e.currentUser.id===t.getParentId());return n&&o&&(a&&r||s)}function s(e){return e.getAlive()&&(0,i.hA)(e)&&Boolean(e.getIntegrationId())}function a(e){const{externalIntegrationStoreState:t,integrationId:n}=e;if(!t.loaded)return;const o=t.externalAuthentications.map((e=>{let{parent_id:t}=e;return t})),s=new Set(o),a=t.bots.filter((e=>e.alive&&s.has(e.id)&&(0,i.U9)(e)&&e.integration_id===n));return a.length?a[0]:void 0}},74021:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(49085);class o extends i.default{getInitialState(){return{open:!1}}}const s=new o},53833:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(49085);class o extends i.default{getInitialState(){return{notebooksResponse:{notebooks:[]},isFetchingNotebooks:!0,showLoader:!1}}}const s=new o},46190:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},90365:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},47593:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(49085);class o extends i.default{getInitialState(){return{open:!1}}}const s=new o},82066:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},67940:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(49085),o=n(4615);class s extends i.default{getInitialState(){return{flowId:void 0}}getOrCreateFlowId(){const e=this.state.flowId||(0,o.ZP)();return this.state.flowId&&this.setState({flowId:e}),e}}const a=new s},81676:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(49085);class o extends i.default{getInitialState(){return{boardsResponse:{boards:[]},isFetchingBoards:!0,showLoader:!1}}}const s=new o}}]);