"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7304],{84437:(e,t,n)=>{n.d(t,{WS:()=>g,fW:()=>m,sh:()=>p});var r=n(72126),o=n(4615),i=n(64002),c=n(50906),a=n(54642),s=n(47839),u=n(12714),l=n(82530),d=n(37181),f=n(95477),v=n(71574);function p(e){const{environment:t,spaceStore:n,collectionViewStore:r}=e;if(!!n&&!(0,v.tE)())return void async function(e){const{environment:t,spaceStore:n,collectionViewStore:r}=e,c=w({spaceStore:n,collectionViewStore:r}),a=(0,o.ZP)(),s=i.bf({url:f.default.cron.notionAuthUrl,query:{...c,csrf:a}});await(0,v.PQ)({environment:t,csrf:a}),u.D({environment:t,url:s})}(e);const c=r?f.default.cron.openNotionDatabaseUrl:f.default.cron.domainBaseUrl,a=w({collectionViewStore:r,spaceStore:n});!async function(e){const{environment:t,url:n,targetSelf:r}=e;if(!t.device.isElectron)return u.D({environment:t,url:n,targetSelf:r});const{desktopProtocol:o}=f.default.cron;if(!(await s.isProtocolRegistered(o)))return u.D({environment:t,url:n,targetSelf:r});const i=n.replace(/^https?:/,`${o}:`);s.openExternalUrl(i)}({environment:t,url:i.bf({url:c,query:a})})}async function m(e){const{environment:t,csrf:n,calendarCsrf:o,spaceId:i,integration:s,redirectUri:u,state:l}=e;if(!(await(0,v.Bs)({environment:t,csrf:n})))return void S({environment:t,redirectUri:u,query:r.GM({state:l},r.o8)});const d=await a.createOauthAuthorizationCode(t,{integrationId:s.id,spaceId:i,redirectUri:u,acceptedIntegrationCapabilities:s.capabilities});if("failed"===d.type)return void S({environment:t,redirectUri:u,query:r.GM({state:l},r.o8)});c.dld(t);const f={code:d.data.code,calendarCsrf:o,state:l};S({environment:t,redirectUri:u,query:r.GM(f,r.o8)})}function S(e){const{environment:t,redirectUri:n,query:r}=e,o=i.bf({url:n,query:r});u.D({environment:t,url:o,targetSelf:!0})}function w(e){const{spaceStore:t,collectionViewStore:n}=e;if(!t&&!n)return{};const o={env:"production",collection_view_id:null==n?void 0:n.id,workspace_id:null==t?void 0:t.id};return r.GM(o,r.o8)}function g(e,t){const{phase:n,transactionUserAction:r,userSettingsStore:o}=t;l.createAndCommit({environment:e,userAction:r,perform:e=>{d.d2({userSettingsStore:o,transaction:e,data:{notion_calendar_launch_modal_phase:n}})}})}},67943:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var r=n(67294),o=n(480),i=n(86628),c=n(77657),a=n(9844),s=n(80444),u=n(26136),l=n(84437);function d(e){window.__c={n:"NotionCalendarAuthorization"};const{csrf:t,calendarCsrf:n,redirectUri:d,spaceId:f,state:v}=e,p=(0,o.O7)(),m=function(){const e=(0,i.VK)((()=>s.default.state.currentUserRootStore),[]);return(0,i.VK)((()=>{if(!e)return;const t=(0,u.Kv)(e,{id:c.Dv,table:a.K2}).getKeyStore("capabilities").getValue();return t?{id:c.Dv,capabilities:t}:void 0}),[e])}(),S=(0,r.useRef)(!1);return(0,r.useEffect)((()=>{S.current||m&&f&&(S.current=!0,(0,l.fW)({environment:p,csrf:t,calendarCsrf:n,redirectUri:d,spaceId:f,integration:m,state:v}))}),[m,p,t,n,d,f,v]),null}},71574:(e,t,n)=>{n.d(t,{Bs:()=>p,PQ:()=>v,ZH:()=>l,tE:()=>d});var r=n(77657),o=n(4615),i=n(95477),c=n(12955),a=n(53410),s=n(77080),u=n(30874);async function l(e){const{environment:t}=e;return!!s.default.checkGate("notion_calendar")&&(!t.device.isMobile&&(!t.device.isElectron||async function(){if(!d())return!1;if(null===a.C||void 0===a.C||!a.C.isProtocolRegistered)return!1;return await a.C.isProtocolRegistered(i.default.cron.desktopProtocol)}()))}function d(){const{bots:e,externalAuthentications:t}=u.Z,n=e.state.find((e=>e.integration_id===r.Dv));if(!n)return!1;const o=t.state.find((e=>e.parent_id===n.id));return Boolean(o)}const f="notion_calendar_csrf";async function v(e){const{environment:t,csrf:n}=e;await(0,c.setCookie)(t,{name:f,value:n})}async function p(e){const{environment:t,csrf:n}=e,r=await(0,c.getCookie)(t,f),i=!!r&&(0,o.t)(r)&&r===n;return(0,c.removeCookie)(f),i}}}]);