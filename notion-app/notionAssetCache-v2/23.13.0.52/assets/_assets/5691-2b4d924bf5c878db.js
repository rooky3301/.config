"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5691],{47082:(e,t,i)=>{i.d(t,{U:()=>y,Z:()=>k});i(67294);var n=i(83355),s=i(480),o=i(24405),r=i(53465),a=i(72126),l=i(87279),c=i(98742),d=i(34859),u=i(64113),p=i(64921),v=i(37601),g=i(74194),m=i(3386),h=i(53336),f=i(64369),S=i(85893);let y=function(e){return e[e.Select=0]="Select",e[e.Person=1]="Person",e[e.Relation=2]="Relation",e[e.FilterValue=3]="FilterValue",e[e.Share=4]="Share",e[e.Group=5]="Group",e}({});class I extends n.Z{constructor(){super(...arguments),this.storeTypes={store:u.Z},this.handleFocused=()=>{this.stores.store.setState({focused:!0})},this.handleBlurred=()=>{this.stores.store.setState({focused:!1})},this.handleContainerClick=()=>{var e,t;this.props.disabled||(this.input.focusInput(),null===(e=(t=this.props).onClick)||void 0===e||e.call(t))}}UNSAFE_willMount(){(this.props.focus||this.props.focusInitial)&&this.stores.store.setState({focused:!0})}UNSAFE_willUpdate(){void 0!==this.props.focus&&this.stores.store.setState({focused:this.props.focus})}renderComponent(){const{disabled:e}=this.props;return(0,S.jsx)(m.Z,{capture:!e,onLeft:a.yR,onRight:a.yR,onSelectAll:a.yR,onRedo:a.yR,onUndo:a.yR,onToggleBold:a.yR,onToggleItalics:a.yR,onToggleCode:a.yR,onCut:a.yR,onCopy:a.yR,onPaste:a.yR,onKeypress:a.yR,children:(0,S.jsx)(m.Z,{capture:!e&&this.props.value.length>0,onDelete:a.yR,onBackspace:a.yR,children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"stretch",width:"100%",gap:this.props.message?4:void 0},children:[this.renderTokenInput(),this.props.message&&(0,S.jsx)(f.Z,{isSmall:!0,children:this.props.message})]})})})}renderTokenInput(){const{right:e,showClearButton:t}=this.props;return e||t?(0,S.jsxs)(h.Z,{type:d.Z.All,style:{...this.getWrapStyle(),flexWrap:"nowrap",...this.props.style},onClick:this.handleContainerClick,children:[(0,S.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",flexGrow:1,minWidth:0,...this.props.inputAndTokenWrapRightStyle},children:[this.props.tokens,!this.props.hideInput&&this.renderInput()]}),(0,S.jsx)("div",{style:{flexShrink:0},children:(0,S.jsx)(b,{showClearButton:this.props.showClearButton,right:this.props.right,onClearButtonClick:this.props.onClearButtonClick,tokens:this.props.tokens,value:this.props.value})})]}):this.environment.device.isMobile?(0,S.jsxs)("div",{style:{...this.getWrapStyle(),flexWrap:"nowrap",...this.props.style},onClick:this.handleContainerClick,children:[(0,S.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",flexGrow:1,minWidth:0,overflow:"hidden",marginRight:x(this.props.format)?6:0},children:[this.props.tokens,!this.props.hideInput&&this.renderInput()]}),(0,S.jsx)(v.Z,{show:this.stores.store.state.focused})]}):(0,S.jsxs)(h.Z,{type:d.Z.All,style:{...this.getWrapStyle(),...this.props.style},onClick:this.handleContainerClick,children:[this.props.tokens,!this.props.hideInput&&this.renderInput()]})}renderInput(){const e=0===this.props.tokens.length;return(0,S.jsx)(g.Z,{disabled:this.props.disabled,format:g.B.Transparent,...(0,c.Z)({onKeyDown:e=>function(e,t,i,n){"Backspace"===e.key&&0===t.length&&i();n&&n(e)}(e,this.props.value,this.props.onRemoveLastToken,this.props.onKeyDown)},{onChange:this.props.onChange}),value:this.props.value,focus:this.props.focus,focusInitial:this.props.focusInitial,focusAfterAnimation:this.props.focusAfterAnimation,style:(t=this.props.format,i=this.environment,n=this.theme,s=this.props.inputFullWidth,o=this.props.inputDivStyle,{flexGrow:1,flexShrink:1,flexBasis:s?"100%":60,minWidth:60,width:"auto",lineHeight:"20px",...i.device.isMobile?{margin:"0 8px 8px 0"}:w(n)[t].inputDivDesktopStyle,...o}),inputStyle:this.props.inputStyle||{height:this.environment.device.isMobile?24:x(this.props.format)?20:18},size:1,ref:e=>e&&(this.input=e),type:this.props.type,placeholder:e?this.props.placeholder:"",onSubmit:e=>function(e,t,i,n){0===t.length&&i&&i();n&&n(e)}(e,this.props.value,this.props.onEmptySubmit,this.props.onSubmit),onFocus:this.handleFocused,onBlur:this.handleBlurred,textarea:this.props.textarea,autoComplete:this.props.autoComplete});var t,i,n,s,o}getWrapStyle(){var e,t;const{focus:i,format:n}=this.props,{WindowSizeStore:s}=this.environment;return{...this.environment.device.isMobile?{...(o=this.theme,{display:"flex",flexWrap:"wrap",alignItems:"flex-start",flexShrink:0,minHeight:44,borderBottom:`1px solid ${o.regularDividerColor}`,fontSize:16,background:o.popoverBackground}),paddingTop:14,paddingBottom:8,paddingLeft:(null===(e=this.context.menu)||void 0===e?void 0:e.menuType)!==l.og.Popup?s.getSafePaddingLeftCSS(16):16,paddingRight:(null===(t=this.context.menu)||void 0===t?void 0:t.menuType)!==l.og.Popup?s.getSafePaddingRightCSS(16):16,...this.props.dontShowBorderBottom&&{borderBottom:"none"}}:{..._(this.theme,this.props.disabled),...w(this.theme)[n].desktopWrapStyle},...this.props.showBorder&&{boxShadow:"rgba(15, 15, 15, 0.1) 0px 0px 0px 1px inset"},...this.props.showBorder&&this.props.focus&&{boxShadow:"rgba(35, 131, 226, 0.57) 0px 0px 0px 1px inset, rgba(35, 131, 226, 0.35) 0px 0px 0px 2px"},...!this.environment.device.isMobile&&i&&w(this.theme)[this.props.format].inputDivDesktopFocusStyle};var o}}I.displayName="TokenInputMenuItem",I.contextTypes={...l.mw,...n.w};const k=I;function x(e){return e===y.Group}function _(e,t){return{display:"flex",flexWrap:"wrap",alignItems:"flex-start",background:t?"none":e.tokenInputMenuItemBackground,cursor:"text",overflow:"hidden"}}function w(e){const t={desktopWrapStyle:{padding:"8px 9px 1px",width:"100%",minHeight:34,fontSize:14},inputDivDesktopStyle:{margin:"0 6px 6px 0",borderTopLeftRadius:4,borderTopRightRadius:4},inputDivDesktopFocusStyle:{}};return{[y.Select]:t,[y.Person]:t,[y.Relation]:t,[y.Group]:t,[y.FilterValue]:{desktopWrapStyle:{padding:"6px 6px 1px",boxShadow:e.inputBoxShadow,background:e.inputBackground,margin:"6px 8px 2px 8px",minHeight:30,fontSize:12,borderRadius:4},inputDivDesktopStyle:{margin:"0 6px 4px 0"},inputDivDesktopFocusStyle:{boxShadow:"rgba(35, 131, 226, 0.57) 0px 0px 0px 1px inset, rgba(35, 131, 226, 0.35) 0px 0px 0px 2px"}},[y.Share]:{desktopWrapStyle:{padding:"8px 9px 1px",width:"100%",minHeight:34,fontSize:14},inputDivDesktopStyle:{margin:"0 0 0 2px",borderTopLeftRadius:4,borderTopRightRadius:4},inputDivDesktopFocusStyle:{}}}}function b(e){let{showClearButton:t,right:i,onClearButtonClick:n,tokens:a,value:l}=e;window.__c={n:"RightComponent"};const c=(0,o.Fg)(),d=(0,s.O7)(),{isMobile:u}=d.device;return i?(0,S.jsx)(S.Fragment,{children:i}):t&&(a.length>0||l.length>0)?(0,S.jsx)(p.Z,{onClick:n,style:{flexShrink:0,flexGrow:0,borderRadius:u?24:20,marginTop:2},children:(0,r.X)({width:u?16:14,height:u?16:14,fill:c.lightIconColor})}):null}},22508:(e,t,i)=>{i.d(t,{Co:()=>j,E6:()=>_,GZ:()=>w,TW:()=>R,Uw:()=>T,YQ:()=>C,rw:()=>b});i(57658),i(67294);var n=i(33728),s=i(7406),o=i(68626),r=i(91155),a=i(72141),l=i(4615),c=i(9291),d=i(81918),u=i(54642),p=i(76464),v=i(95209),g=i(64964),m=i(19306),h=i(26907),f=i(67669),S=i(95697),y=i(88893),I=i(35057),k=i(73466),x=i(85893);async function _(e){const{environment:t,onInviteComplete:i,flowId:n,intl:a,spaceStore:l,invitedUsers:c,inviteTargetsStore:u,inviteOrigin:p,disable_invite_email:v}=e;let g={success:!1};try{g=await C({environment:t,spaceStore:l,invitedUsers:c,from:p,flowId:n,intl:a,inviteTargetsStore:u,disable_invite_email:v}),g.success?d.pR(t,{invited_user_count:Object.keys(g.invitedUsers).length,invite_flow_id:n,origin:p}):(d.S4(t,{invite_stage:"invite_member",invite_flow_id:n,error:g.error}),o.log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite"}))}catch(m){const e=(0,s.tg)(m);d.S4(t,{invite_stage:"invite_member",invite_flow_id:n,error:e}),o.log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,r.Ui)(m)})}finally{null==i||i(g)}}async function w(e){const{environment:t,blockStore:i,inviteTargetsStore:c,sudoModeStore:u,onInviteComplete:v,inviteOrigin:g,role:m,emailMessage:S,flowId:y}=e;let I={success:!1};try{if(I=await async function(e){const{environment:t,blockStore:i,sudoModeStore:s,inviteTargetsStore:o,role:r,inviteOrigin:c,emailMessage:d,onInviteStart:u}=e,v=e.flowId||(0,l.ZP)();if(!(0,a.iC)(r))return{success:!1};const{tokenQuery:g,inviteTargets:m}=o.state;if((0,n.oH)(g.trim())&&0===m.length){const e={type:"newUser",value:{email:g.trim()},source:"email"};h.H({target:e,inviteTargetsStore:o})||o.setState({inviteTargets:[...o.state.inviteTargets,e],tokenQuery:""})}const S=f.mU(i,h.B({inviteTargetsStore:o}));null==u||u();return await p.n_({environment:t,store:i,sudoModeStore:s,inviteTargets:S,inviteRole:r,isOnboarding:!1,invite:{inviteFlowId:v,inviteMessage:d,inviteOrigin:c}})}({environment:t,blockStore:i,sudoModeStore:u,inviteTargetsStore:c,role:m,emailMessage:S,inviteOrigin:g,flowId:y}),!I.success)return}catch(k){const e=(0,s.tg)(k);d.S4(t,{invite_stage:"invite_guest",invite_flow_id:y,error:e}),o.log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,r.Ui)(k)})}finally{I.success&&d.Vi(t,{invited_user_count:Object.keys(I.invitedUsers).length,origin:g,invite_flow_id:y}),null==v||v(I)}return I}async function b(e){const{environment:t,spaceStore:i,originId:n,originType:r,reasonMessage:a,intl:l,flowId:c,onInviteComplete:p,invitedUsers:v,inviteOrigin:g}=e,m=[];let h={success:!1};try{const e=Object.entries(v).map((e=>{let[s,o]=e;return u.requestAccess(t,{type:"actor-to-space",forActorId:o,spaceId:i.id,message:a,attributes:{origin_id:n,origin_type:r,origin_table:"block",add_permissions_on_approval:!1}}).catch((()=>m.push([s,o])))}));await Promise.all(e),h={success:!0,invitedUsers:v,requestedUsers:{}}}catch(f){const e=(0,s.tg)(f);return d.S4(t,{invite_stage:"request_member",invite_flow_id:c,error:e}),M(l,v),o.log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:m}}}),h}finally{h.success&&d.TJ(t,{invited_user_count:Object.keys(h.invitedUsers).length,origin:g,invite_flow_id:c}),null==p||p(h)}return h}async function C(e){const{environment:t,spaceStore:i,from:n,invitedUsers:s,intl:r,flowId:a,onInviteStart:l,inviteTargetsStore:c,disable_invite_email:d}=e,u=function(e){const t=[];if(!e)return t;for(const[i,n]of Object.entries(e))t.push({type:"existingUser",value:{id:n,email:i,version:1}});return t}(s),v=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(c),h=[...u];for(const o of v){u.some((e=>e.value.email===o.value.email))||h.push(o)}const f=(0,I.zt)(),x=f&&(0,y.o9)(f)?"editor":e.inviteRole??"read_and_write";let _={success:!1};if((0,S.$)(t)){if(!(await k.HD({environment:t,flowId:a,trackCreateTeamComplete:!1})))return _}try{null==l||l(),_=await p.n_({environment:t,store:i,inviteTargets:h,inviteRole:x,isOnboarding:!1,invite:{inviteOrigin:n,inviteFlowId:a,disable_invite_email:d}})}catch(w){return((e,t)=>{0!==t.length&&g.oV({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"Failed to invite to {users} as members"},{users:(0,m.W)(t.flatMap((e=>e.value.email||[])))})})})(r,h),o.log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:h}}}),_}return _}async function T(e){const{environment:t,inviteTargetsStore:i,allowShowEmptyError:s,personPropertyInviteStore:o}=e,r=i.state.tokenQuery;if(""===r)return void(0===i.state.inviteTargets.length&&s&&o.setState({...o.state,showEmptyError:!0}));const a=(0,n.CU)(r),l=await v.M5(t,a);let c=[];0===l.length&&(c=[{type:"invalidUser",value:{text:r}}]);const d=l.filter((e=>!h.H({inviteTargetsStore:i,target:e}))),u=[...i.state.inviteTargets,...d,...c];i.setState({...i.state,inviteTargets:u,tokenQuery:""})}function j(e){const{email:t,inviteTargetsStore:i}=e,n={type:"newUser",value:{email:t},source:"email"},s=[...i.state.inviteTargets];h.H({inviteTargetsStore:i,target:n})||s.push(n),i.setState({...i.state,inviteTargets:s})}const M=(e,t)=>{const i=Object.keys(t);0!==i.length&&g.oV({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,m.W)(i)})})};function R(e){const{success:t,invitedUserEmails:i,isRequestMember:n}=e;t?0!==i.length&&(n?g.oV({label:(0,x.jsx)(c.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,m.W)(i)}})}):g.oV({label:(0,x.jsx)(c.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,m.W)(i)}})})):g.oV({label:(0,x.jsx)(c.FormattedMessage,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,m.W)(i)}})})}},35691:(e,t,i)=>{i.r(t),i.d(t,{default:()=>de,shouldEnableSlackImportsInvite:()=>ue});var n=i(67294),s=i(480),o=i(86628),r=i(24405),a=i(41892),l=i(72126),c=i(9291),d=i(81575),u=i(51077),p=i(9019),v=i(56678),g=i(77080),m=i(55899),h=i(35057),f=i(49085),S=i(4615);let y=function(e){return e.SearchInput="search_input",e.NoFocus="no_focus",e}({});class I extends f.default{getInitialState(){return{flowId:(0,S.ZP)(),modalOpen:!1,focus:y.NoFocus}}}const k=I;var x=i(7406),_=i(77657),w=i(68626),b=i(91155),C=i(54642),T=i(78140),j=i(43250),M=i(87279),R=i(80444),Z=i(30874),O=i(29798),B=i(42922),F=i(22508);var U=i(85893);function K(e){window.__c={n:"SlackImportsInviteButton"};const{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:a,onInviteComplete:l,onInviteClick:u}=e,p=(0,s.O7)(),v=(0,c.useIntl)(),g=(0,r.yK)((e=>({footerStyle:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:60,padding:"12px 16px 16px 16px",borderTop:`1px solid ${e.stroke.deemphasized}`}})),[]),m=(0,o.VK)((()=>R.default.state.currentSpaceStore),[]),h=(0,o.VK)((()=>t.state.flowId),[t]),f=(0,o.VK)((()=>i.state.inviteTargets.length),[i]),S=(0,o.VK)((()=>function(e){return 0===e?(0,U.jsx)(c.FormattedMessage,{id:"invite.slack_imports.button.title.no_selected",defaultMessage:"Add members",values:{totalInviteCount:e}}):(0,U.jsx)(c.FormattedMessage,{id:"invite.slack_imports.button.title.selected",defaultMessage:"Add {totalInviteCount} {totalInviteCount, plural, one {member} other {members}}",values:{totalInviteCount:e}})}(f)),[f]),I=(0,n.useCallback)((e=>{const{response:i,invitedUserEmails:n}=e;d.u0(p,{invite_stage:"invite_complete",invite_flow_id:h,origin:a,is_success:i.success,invited_user_count:n.length}),i.success&&t.setState({...t.state,modalOpen:!1}),null==l||l(i),F.TW({success:i.success,invitedUserEmails:n})}),[a,p,h,l,t]),k=(0,n.useCallback)((async()=>{const e=i.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(!m)return null;await async function(e){const{environment:t,onInviteComplete:i,onInviteClick:n,flowId:s,intl:o,spaceStore:r,inviteTargetsStore:a,inviteOrigin:l}=e;let c={success:!1};const u=a.state.inviteTargets.length;try{c=await F.YQ({environment:t,spaceStore:r,from:l,flowId:s,intl:o,inviteTargetsStore:a,onInviteStart:()=>{null==n||n()}})}catch(p){const e=(0,x.tg)(p);d.u0(t,{invite_stage:"invite_member",invited_user_count:u,invite_flow_id:s,error:e,origin:l,is_success:!1}),w.log({level:"error",from:"slackImportsInviteActions",type:"handleMemberInvite",error:(0,b.Ui)(p)})}finally{null==i||i(c)}}({environment:p,spaceStore:m,flowId:h,intl:v,inviteTargetsStore:i,inviteOrigin:a,onInviteComplete:t=>I({response:t,invitedUserEmails:e}),onInviteClick:u}),i.reset()}),[m,p,h,i,v,a,u,I]),_=(0,n.useCallback)((async()=>{t.setState({...t.state,focus:y.NoFocus});const e=i.state.inviteTargets.length;d.AK(p,{invited_user_count:e,origin:a,inviteTargets:i.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:i.state.tokenQuery,invite_flow_id:h}),await k()}),[k,p,h,a,t,i]);return(0,U.jsx)("div",{style:g.footerStyle,children:(0,U.jsx)(B.Z,{isLarge:!0,style:{borderRadius:6},onClick:_,disabled:0===f,children:S})})}var L=i(82990),W=i(68785),A=i(64369);function V(e){window.__c={n:"SlackImportsInviteHeader"};const{isLoading:t}=e,i=(0,r.yK)((e=>({topContainer:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"0 16px",borderBottom:`1px solid ${e.stroke.deemphasized}`},sendInviteLabel:{color:e.text.primary,fontSize:14,fontWeight:L.Z.fontWeight.medium,textAlign:"left",verticalAlign:"top"}})),[]),n=t?(0,U.jsx)(W.Z,{style:{marginLeft:6}}):null;return(0,U.jsxs)("div",{style:i.topContainer,children:[(0,U.jsx)(A.Z,{style:i.sendInviteLabel,children:(0,U.jsx)(c.FormattedMessage,{id:"invite.slack_imports.header_title",defaultMessage:"Import from Slack"})}),n]})}var D=i(91219),P=i(47082);function z(e){window.__c={n:"SlackImportsInviteInput"};const{inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:a}=e,l=(0,c.useIntl)(),d=(0,s.O7)(),{tokenQuery:u}=(0,o.VK)((()=>{const{tokenQuery:e}=t.state;return{tokenQuery:e}}),[t]),{focus:p,flowId:v}=(0,o.VK)((()=>({focus:i.state.focus===y.SearchInput,flowId:i.state.flowId})),[i]),g=function(e){const{focus:t}=e;return(0,r.yK)((e=>({searchBar:{padding:16},inputStyle:{minWidth:60,width:"auto",borderTopLeftRadius:4,borderTopRightRadius:4,fontSize:14,fontWeight:L.Z.fontWeight.regular},tokenInputMenuItem:{padding:6,borderRadius:6,height:20,alignItems:"center",minHeight:32,background:e.accentColors.gray[30],...t&&{background:"none"}}})),[t])}({focus:p}),m=l.formatMessage({id:"invite.slack_imports.search.placeholder",defaultMessage:"Search people, emails..."}),f=(0,n.useCallback)((e=>{t.setState({...t.state,tokenQuery:e.target.value}),E({environment:d,flowId:v,subscriptionTier:(0,h.zt)(),origin:a})}),[t,v,a,d]);return(0,U.jsx)("div",{style:g.searchBar,children:(0,U.jsx)(P.Z,{focus:p,onClick:()=>{i.setState({...i.state,focus:y.SearchInput})},format:P.U.Share,value:u,onChange:f,type:"email",tokens:[],autoComplete:"off",placeholder:m,onRemoveLastToken:()=>{},showBorder:!0,style:g.tokenInputMenuItem,inputFullWidth:!0})})}const E=l.Ds((e=>{let{environment:t,flowId:i,subscriptionTier:n,origin:s}=e;D.UW(t,{invite_flow_id:i,subscription_tier:n,invite_origin:s})}),1e3);i(57658);var q=i(8848),Q=i(59054),H=i(36591),G=i(95209),N=i(21752),$=i(52275),J=i(61519),Y=i(32163),X=i(43765),ee=i(72495),te=i(69507),ie=i(26907);function ne(e){window.__c={n:"SlackImportsInviteSearchRequest"};const{inviteTargetsStore:t,slackImportsInviteStore:i}=e,n=(0,s.O7)(),r=(0,c.useIntl)(),a=(0,o.VK)((()=>t.state.tokenQuery),[t]),l=(0,o.VK)((()=>i.state.flowId),[i]),[{value:d,status:u}]=(0,Q.r5)((async()=>G.jL({query:a,sectionLimit:{userLimit:0,botLimit:0,groupLimit:0,importContactLimit:1e3},environment:n,intl:r,membersOnly:!1})),[n,r,a],{debounce:40});return(0,U.jsx)(se,{...e,tokenQuery:a,ready:"pending"!==u,error:"rejected"===u,result:d,flowId:l,environment:n})}function se(e){window.__c={n:"SlackImportsInviteSearchRequestImpl"};const{inviteTargetsStore:t,slackImportsInviteStore:i,tokenQuery:n,error:s,ready:a,result:l,inviteOrigin:u,flowId:p,environment:v}=e,g=(0,r.yK)((e=>({selectAllSectionStyle:{display:"flex",flexDirection:"column",gap:2,padding:"8px 0px 16px 0px"},sectionMenuItem:{padding:"12px 0px 0px 2px",display:"flex",flexDirection:"column",gap:2},dividerStyle:{margin:"0px 16px"},dividerInnerStyle:{borderBottom:`1px solid ${e.stroke.deemphasized}`},selectAllStyle:{display:"flex",fontSize:14,color:e.text.primary},totalCountsStyle:{paddingLeft:3,fontSize:14,color:e.text.tertiary}})),[]),m=(0,o.VK)((()=>(null==l?void 0:l.importedContacts)??[]),[l]),f=(0,o.qz)(e.menuListStore,O.Z),S={key:"select all",render:e=>(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(ee.Z,{...e,style:g.selectAllSectionStyle}),(0,U.jsx)(J.Z,{size:1,innerStyle:g.dividerInnerStyle,style:g.dividerStyle})]}),items:[{key:"select all item",render:e=>(0,U.jsx)($.Z,{...e,title:(0,U.jsxs)("div",{style:g.selectAllStyle,children:[(0,U.jsx)(c.FormattedMessage,{id:"invite.slack_imports.select_all.title",defaultMessage:"Select all"}),(0,U.jsx)(A.Z,{style:g.totalCountsStyle,isSmall:!0,children:`(${m.length})`})]}),right:(0,U.jsx)(ae,{checked:le({filteredImportedContacts:m,inviteTargetsStore:t})})}),action:()=>{!function(e){const{filteredImportedContacts:t,inviteTargetsStore:i,environment:n,origin:s,flowId:o,tokenQuery:r}=e;if(i.state.inviteTargets.length===t.length)return i.setState({...i.state,inviteTargets:[]}),void d.hc(n,{origin:s,invite_flow_id:o,invited_user_count:0,is_unselect:!0,invite_token_query:r});d.hc(n,{origin:s,invite_flow_id:o,invited_user_count:t.length,is_unselect:!1,invite_token_query:r}),i.setState({...i.state,inviteTargets:t})}({filteredImportedContacts:m,inviteTargetsStore:t,origin:u,flowId:p,environment:v,tokenQuery:n}),i.setState({...i.state,focus:y.NoFocus})}}]},I=function(e){const{filteredImportedContacts:t}=e,i={};return t.forEach(((e,t)=>{const n=e.value.email[0].toUpperCase(),s=/^[A-Za-z]$/.test(n)?n:"#";i[s]||(i[s]=[]),i[s].push(e)})),i}({filteredImportedContacts:m}),k=Object.keys(I).sort(((e,t)=>"#"===e?1:"#"===t?-1:e.localeCompare(t))).map((e=>function(e){const{charKey:t,importedContacts:i,inviteTargetsStore:n,slackImportsInviteStore:s,menuListStore:o,style:r,tokenQuery:a,environment:l}=e;return{key:`imported contacts with ${t}`,render:e=>(0,U.jsx)(ee.Z,{...e,style:r,title:(0,U.jsx)(c.FormattedMessage,{id:"invite.slack_imports.grouped_section.title",defaultMessage:"{charKey}",values:{charKey:t}})}),items:i.sort(((e,t)=>(e.value.name||"").localeCompare(t.value.name||""))).map(((e,t)=>({key:e.value.email,render:t=>(0,U.jsx)(oe,{...t,invited:!1,inviteTarget:e,isInInviteTargets:ie.H({target:e,inviteTargetsStore:n})}),action:()=>{ie.H({target:e,inviteTargetsStore:n})?n.setState({...n.state,inviteTargets:n.state.inviteTargets.filter((t=>"newUser"!==t.type||e.value.email!==t.value.email))}):(D.hE(l,{invite_token_query:a,selected_user_token:e,selected_user_token_rank:t,from:"slack_imports_space_setting",subscription_tier:(0,h.zt)(),type:"slack"}),s.setState({...s.state,focus:y.NoFocus}),n.setState({...n.state,inviteTargets:[...n.state.inviteTargets,e]}),o.unsetFocus())}})))}}({charKey:e,importedContacts:I[e],inviteTargetsStore:t,slackImportsInviteStore:i,menuListStore:f,style:g.sectionMenuItem,tokenQuery:n,environment:v})));return s?(0,U.jsx)(te.l,{loading:!a,children:(0,U.jsx)(X.Z,{title:(0,U.jsx)(c.FormattedMessage,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})})}):(0,U.jsx)(Y.Z,{type:Y.i.Vertical,initialFocus:n.length>0?0:void 0,sections:[S,...k],store:f})}const oe=n.forwardRef(((e,t)=>{const{inviteTarget:i}=e;return(0,U.jsx)(re,{...e,ref:t,inviteTarget:i})})),re=n.forwardRef(((e,t)=>{window.__c={n:"SlackSearchUserResultItem"};const{inviteTarget:i,isInInviteTargets:s,...o}=e,l=(0,r.yK)((()=>({cellMemberAvatarContainer:{paddingTop:8,paddingBottom:8},iconBox:{position:"absolute",bottom:-3,right:-3},iconBoxImage:{background:"white",padding:2,borderRadius:"100%"}})),[]),c=(0,n.useMemo)((()=>({actorStore:void 0,avatar:{email:i.value.email,name:"slack"===i.source?i.value.name:void 0,avatarUrl:"slack"===i.source?i.value.avatar_url:void 0}})),[i]);return(0,U.jsx)($.Z,{...o,ref:t,title:(0,U.jsx)(N.Z,{isLarge:!0,...c,containerStyle:l.cellMemberAvatarContainer,avatarBadge:(0,U.jsx)(u.Z,{type:"image_url",imageURL:a.Z.images.externalIntegrations.slackIconPng,size:18,style:l.iconBox,imageStyle:l.iconBoxImage})}),right:(0,U.jsx)(ae,{checked:s})})}));function ae(e){window.__c={n:"CircleCheckmark"};const{checked:t}=e,i=(0,r.yK)((e=>({circleCheckmark:{display:"flex",justifyContent:"center",alignItems:"center",width:18,height:18,borderRadius:"50%",borderStyle:"solid",borderWidth:1.75,borderColor:t?q.ZP.blue:e.buttonPressedBackground,backgroundColor:t?q.ZP.blue:"transparent"},checkIcon:{height:12,width:12,color:"white"}})),[t]);return(0,U.jsx)("div",{style:i.circleCheckmark,children:t&&(0,H.e)(i.checkIcon)})}function le(e){const{filteredImportedContacts:t,inviteTargetsStore:i}=e,n=i.state.inviteTargets.length;return 0!==n&&n===t.length}function ce(e){window.__c={n:"SlackImportsInvite"};const{inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:r,onInviteComplete:a,onInviteClick:l}=e,c=(0,s.O7)(),[u,p]=(0,n.useState)(!1),v=(0,o.VK)((()=>Z.Z.completeSlackAuthentications.state),[]),g=(0,o.VK)((()=>R.default.state.currentSpaceStore),[]),m=(0,o.VK)((()=>i.state.flowId),[i]),h=(0,o.qz)(void 0,O.Z);(0,n.useEffect)((()=>{d.e8(c,{invite_flow_id:i.state.flowId,origin:r}),async function(){if(g&&!u){for(const e of v)await C.loadContacts(c,{botId:e.id,spaceId:g.id,integrationId:_.nO}).catch((e=>{const t=(0,x.tg)(e);d.u0(c,{invite_stage:"load_slack_contacts",invited_user_count:0,invite_flow_id:m,error:t,origin:r,is_success:!1}),w.log({level:"error",from:"SlackImportsInvite",type:"loadSlackContacts",error:(0,b.Ui)(e)})}));p(!0)}}()}),[g,v,c,u,r,i,m]);const f=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,isLoading:s}=e;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(V,{isLoading:s}),(0,U.jsx)(z,{inviteTargetsStore:i,slackImportsInviteStore:t,inviteOrigin:n})]})}({inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:r,isLoading:!u}),S=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:s,onInviteClick:o}=e;return(0,U.jsx)(K,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:s,onInviteClick:o})}({slackImportsInviteStore:i,inviteTargetsStore:t,inviteOrigin:r,onInviteComplete:a,onInviteClick:l}),y=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:s,isLoading:o}=e;if(o)return null;return(0,U.jsx)(ne,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:s})}({slackImportsInviteStore:i,inviteTargetsStore:t,inviteOrigin:r,menuListStore:h,isLoading:!u}),I={menuType:M.og.Popup,width:480,height:"60vh",header:f,footer:S,tokenInputHeader:!1,disableScroller:!1};return(0,U.jsx)(T.Z,{...I,className:j.FJA,children:(0,U.jsx)("div",{children:y})})}function de(e){window.__c={n:"SlackImportsInviteWithModal"};const t=(0,s.O7)(),{inviteOrigin:i,canEditPermission:l,onInviteComplete:g,onInviteClick:f,slackButtonLabel:S,slackButtonStyle:y,slackButtonContainerStyle:I}=e,{isMobile:x}=(0,s.Fy)(),_=function(e,t){return(0,r.yK)((i=>({slackTitle:{display:"flex",fontSize:14,color:i.text.primary},integrationIcon:{marginRight:4},slackButtonContainer:{padding:"0 8px",...t},slackButton:{height:32,borderRadius:4,border:`1px solid ${i.stroke.regular}`,...e}})),[e,t])}(y,I),w=(0,o.qz)(void 0,k),b=(0,o.qz)(void 0,m.ZP),C=(0,o.VK)((()=>w.state.modalOpen),[w]),T=(0,o.VK)((()=>w.state.flowId),[w]),j=(0,n.useCallback)((()=>{!function(e){e.reset()}(w),d.Td(t,{origin:i,invite_flow_id:T})}),[w,i,t,T]),M=(0,n.useMemo)((()=>(0,U.jsxs)("div",{style:_.slackTitle,children:[(0,U.jsx)(u.Z,{type:"image_url",imageURL:a.Z.images.externalIntegrations.slackIconPng,size:16,imageStyle:_.integrationIcon}),(0,U.jsx)(c.FormattedMessage,{defaultMessage:"Import from Slack",id:"invite.slack_imports.button.label"})]})),[_]),R=(0,n.useCallback)((()=>function(e){const{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:s,onInviteClick:o}=e;return(0,U.jsx)(ce,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:s,onInviteClick:o})}({inviteTargetsStore:b,slackImportsInviteStore:w,inviteOrigin:i,onInviteComplete:g,onInviteClick:f})),[b,w,i,f,g]);return(0,o.VK)((()=>{const e=ue({canEditPermission:l,isMobile:x,subscriptionTier:(0,h.zt)()});return e&&pe({environment:t,flowId:T,origin:i}),e}),[l,x,t,T,i])?(0,U.jsx)(p.Z,{open:C,onDismiss:j,renderContent:R,origin:(0,U.jsx)(v.Z,{onClickAuthenticated:()=>{!function(e){e.setState({...e.state,modalOpen:!0})}(w)},title:S??M,hideChevronIcon:!0,containerStyle:_.slackButtonContainer,buttonStyle:_.slackButton,from:"space_settings",inviteOrigin:i,flowId:T,loadContacts:!1})}):null}function ue(e){const{canEditPermission:t,isMobile:i}=e,n="enterprise"===e.subscriptionTier;return!(i||n||!t)&&"on"===g.default.getEligibleGroup({experimentId:"acq_slack_imports_invite_v1",defaultGroup:"control"})}const pe=l.Ds((e=>{let{environment:t,flowId:i,origin:n}=e;d.gV(t,{origin:n,invite_flow_id:i})}),2e3)},56678:(e,t,i)=>{i.d(t,{Z:()=>k});var n=i(67294),s=i(480),o=i(86628),r=i(24405),a=i(8848),l=i(77657),c=i(5257),d=i(91315),u=i(29477),p=i(149),v=i(81575),g=i(54642),m=i(89475),h=i(68785),f=i(89728),S=i(80444),y=i(30874),I=i(85893);function k(e){window.__c={n:"ImportContactsButton"};const{onClickAuthenticated:t,title:i,hideChevronIcon:k,containerStyle:x,buttonStyle:_,from:w,inviteOrigin:b,flowId:C,loadContacts:T}=e,j=(0,s.O7)(),[M,R]=n.useState(!1),Z=(0,o.VK)((()=>S.default.state.currentSpaceStore),[]),O=(0,o.VK)((()=>{const e=null==Z?void 0:Z.getBotSettingsStore().getValue();return"approved_only"!==(null==e?void 0:e.integration_restrictions)||Boolean((null==e?void 0:e.integration_approval_statuses)&&e.integration_approval_statuses[l.nO])}),[Z]),B=(0,o.VK)((()=>y.Z.integrations.state.find((e=>e.id===l.nO))),[]),F=(0,o.VK)((()=>y.Z.completeSlackAuthentications.state),[]),U=(0,r.yK)((e=>({circleCheck:{height:14,width:14,color:a.ZP.blue},chevron:{height:12,width:12},title:{display:"flex",alignItems:"center",color:a.ZP.uiLightBlack,size:14,gap:6},loadingSpinner:{width:14,height:14,marginLeft:6}})),[]);if(!Z)return(0,I.jsx)(I.Fragment,{});if(!O)return(0,I.jsx)(I.Fragment,{});const K=M?(0,I.jsx)(h.Z,{style:U.loadingSpinner}):(0,I.jsxs)(I.Fragment,{children:[F.length>0&&(0,d.r)(U.circleCheck),!k&&(0,c.o)(U.chevron)]});return(0,I.jsx)("div",{style:x,children:(0,I.jsx)(f.Z,{style:_,onClick:async()=>{0===F.length?await async function(e){const{from:i,inviteOrigin:n,flowId:s}=e,o=j.currentUser.id;if(!B||!Z||!o)return;try{var r;R(!0),v.n0(j,{origin:n,from:i,invite_flow_id:s});const e=await m.hM({environment:j,integration:B,spaceId:Z.id,from:i});if(p.x.isFail(e))return void v.ZK(j,{origin:n,from:i,invite_flow_id:s,is_success:!1});const o=null===(r=e.value.externalAuthentication)||void 0===r?void 0:r.parent_id;if(!o)return;v.ZK(j,{origin:n,from:i,invite_flow_id:s,is_success:!0}),T&&await Promise.race([g.loadContacts(j,{botId:o,spaceId:Z.id,integrationId:B.id}),(0,u.Vs)(2e3)]),null==t||t()}finally{R(!1)}}({from:w,inviteOrigin:b,flowId:C,loadContacts:T}):F.length>0&&(null==t||t())},children:(0,I.jsxs)("div",{style:U.title,children:[i,K]})})})}}}]);