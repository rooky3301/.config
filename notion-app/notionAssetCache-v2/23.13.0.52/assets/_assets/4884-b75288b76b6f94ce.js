"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4884],{16287:(e,t,i)=>{i.d(t,{A:()=>r,h:()=>d});var n=i(53877),s=i(72126),o=i(23867),a=i(54642);async function r(e,t){const{store:i,activityIds:n,spaceId:r,filterActivityTypes:d,filterDateRange:c,navigableBlockId:u,collectionId:p}=t,g=s.Ps(n),m=await a.getActivityLog(e,{spaceId:r,navigableBlock:u?{id:u,spaceId:(0,o.C)(void 0)}:void 0,collection:p?{id:p,spaceId:(0,o.C)(void 0)}:void 0,endingBeforeId:g,limit:20,activityTypes:d,...l(c)});if("failed"===m.type)throw m.error;const h=m.data.activityIds;i.update((e=>({...e,shouldLoadNewerActivities:!1,activityIds:h.concat(n)})))}async function d(e,t){const{store:i,activityIds:n,spaceId:r,filterActivityTypes:d,filterDateRange:c,navigableBlockId:u,collectionId:p}=t,g=s.Z$(n),m=await a.getActivityLog(e,{spaceId:r,navigableBlock:u?{id:u,spaceId:(0,o.C)(void 0)}:void 0,collection:p?{id:p,spaceId:(0,o.C)(void 0)}:void 0,startingAfterId:g,limit:20,activityTypes:d,...l(c)});if("failed"===m.type)throw m.error;const h=m.data.activityIds;i.update((e=>({...e,shouldLoadOlderActivities:!1,activityIds:n.concat(h),hasOlderActivities:h.length>0})))}function l(e){var t,i;const s=null!==(t=e.ending)&&void 0!==t&&t.start_date?n.OQ.isoToUnixMs(e.ending.start_date):void 0;return{startingAfterTimeMs:null!==(i=e.starting)&&void 0!==i&&i.start_date?n.OQ.isoToUnixMs(e.starting.start_date):void 0,endingBeforeTimeMs:s?n.Xz({date:s,daysToAdd:1}):void 0}}},84708:(e,t,i)=>{i.d(t,{Z:()=>z});var n=i(67294),s=i(83355),o=i(480),a=i(24405),r=i(69651),d=i(72050),l=i(72126),c=i(44615),u=i(70921),p=i(63143),g=i(9291),m=i(16287),h=i(19719),f=i(23586),y=i(65598),v=i(95697),x=i(51811),b=i(77907),S=i(2688),w=i(5162),M=i(44904),j=i(80444),C=i(61766),k=i(88632),I=i(49085);class T extends I.default{getInitialState(){return{selectedItems:[]}}}const Z=T;var A=i(4761),_=i(68785),F=i(43145),P=i(93481),R=i(52275),B=i(255),U=i(8319),L=i(85893);class N extends s.Z{constructor(){super(...arguments),this.storeTypes={store:Z},this.renderFilterListItem=(e,t)=>{var i,n;let{disabled:s,onRemove:o,onClick:a}=t;const r={menuItem:{minHeight:void 0,paddingTop:(d=this.environment).device.isMobile?12:4,paddingBottom:d.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}};var d;const l=(0,L.jsx)(B.Z,{disabled:s,onClick:o});return(0,L.jsx)(R.Z,{title:(null===(i=(n=this.props).getItemLabel)||void 0===i?void 0:i.call(n,e))||e,disabled:s,focused:!1,right:l,style:r.menuItem,desktopTitleStyle:r.menuItemTitle,onClick:a},e)},this.renderResultMenuItem=(e,t)=>{var i,s;return(0,n.createElement)(R.Z,{...t,key:e,title:(null===(i=(s=this.props).getItemLabel)||void 0===i?void 0:i.call(s,e))||e,checkState:this.props.mode===U.z.Pill&&this.stores.store.state.selectedItems.includes(e)})}}UNSAFE_willMountOrUpdate(e){this.stores.store.setState({selectedItems:e.items})}renderComponent(){const{mode:e,title:t,onChange:i,disabled:n,focused:s,onMenuDismiss:o,items:a,addItemLabel:r,tokenInputPlaceholder:d,resultSectionTitle:l,componentDebugName:c,icon:u}=this.props;return(0,L.jsx)(U.Z,{mode:e,hasItemsSelected:this.stores.store.state.selectedItems.length>0,title:t,icon:u,items:a,onChange:e=>{i(e)},disabled:n,focused:s,renderFilter:(e,t)=>this.renderFilterListItem(e,t),renderToken:e=>(0,L.jsx)(E,{item:e}),renderItemForSummary:e=>(0,L.jsx)(D,{item:e}),addItemLabel:r,labelText:{title:t,tokenInputPlaceholder:d,resultSectionTitle:l,componentDebugName:c},performRequest:e=>function(e,t){let{query:i}=e;return Promise.resolve(t.filter((e=>e.includes(i))))}(e,this.props.options),renderResultMenuItem:(e,t)=>this.renderResultMenuItem(e,t),onMenuDismiss:o})}}N.displayName="SearchListFilter";const O=N;function D(e){let{item:t}=e;return(0,L.jsx)(L.Fragment,{children:`hello${t}`})}function E(e){let{item:t}=e;return(0,L.jsx)(L.Fragment,{children:t})}var K=i(70268);class V extends s.Z{constructor(){super(...arguments),this.searchListFilterStore=new Z,this.storeTypes={activityUpdatesStore:M.o,filterPopupStore:C.Z},this.closeAddFilterMenu=()=>{const{filterPopupStore:e}=this.stores;e.setState({...e.state,open:!1})},this.renderActivityTypeFilter=()=>{const{collectionId:e}=this.props,t=e=>(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(O,{store:this.searchListFilterStore,focused:!1,icon:d.A,options:[...e].sort(),items:this.stores.activityUpdatesStore.state.filterActivityTypes,mode:U.z.Pill,title:(0,L.jsx)(g.FormattedMessage,{id:"activityUpdates.filterMenu.byType.title",defaultMessage:"Activity type"}),tokenInputPlaceholder:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.search",defaultMessage:"Search for a type"}),resultSectionTitle:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.resultSectionTitle",defaultMessage:"Activity Types"}),addItemLabel:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.addItemLabel",defaultMessage:"Add an activity type"}),componentDebugName:"ActivityUpdatesSearchEditTypesFilter",onChange:e=>this.updateFiltersAndTrackChange((()=>this.stores.activityUpdatesStore.update((t=>({...t,filterActivityTypes:e,activityIds:[],hasOlderActivities:!0,shouldLoadOlderActivities:!0,shouldLoadNewerActivities:!1}))))),onMenuDismiss:this.closeAddFilterMenu,getItemLabel:e=>e.split("-").map((e=>e.replace(/(^.)/,(e=>e.toUpperCase())))).join(" ")})});return t(e?u.Se:u.Py)},this.renderActivityTimeFilter=()=>(0,L.jsx)(P.Z,{mode:U.z.Pill,focused:!1,showButtons:!0,title:(0,L.jsx)(g.FormattedMessage,{id:"activityUpdates.filterMenu.byDate",defaultMessage:"Date Range"}),icon:r.C,value:this.stores.activityUpdatesStore.state.filterDateRange,onMenuDismiss:this.closeAddFilterMenu,onChange:e=>this.updateFiltersAndTrackChange((()=>this.stores.activityUpdatesStore.update((t=>({...t,filterDateRange:e,activityIds:[],hasOlderActivities:!0,shouldLoadOlderActivities:!0})))))}),this.renderSearchFilters=()=>{const{currentUserStore:e,currentSpaceStore:t}=j.default.state;if(!e||!t)return;const i=this.stores.activityUpdatesStore.state.filterActivityTypes.length>0||this.stores.activityUpdatesStore.state.filterDateRange.ending||this.stores.activityUpdatesStore.state.filterDateRange.starting;return(0,L.jsxs)("div",{style:{display:"flex",flexDirection:"row",padding:"12px 10px",width:"100%",gap:6},children:[this.renderActivityTypeFilter(),this.renderActivityTimeFilter(),i&&this.renderClearButton()]})},this.handleActivityEmit=e=>{this.stores.activityUpdatesStore.update((e=>({...e,shouldLoadNewerActivities:!0})))},this.handleActivityEmitThrottled=l.P2(this.handleActivityEmit,1e3),this.handleNavigableBlockEmit=p.YX(this.handleActivityEmitThrottled),this.handleCollectionEmit=p.YX(this.handleActivityEmitThrottled),this.navigableBlockListenerReference=void 0,this.collectionListenerReference=void 0}UNSAFE_willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return k.Z.state.online?this.renderOnline():(0,L.jsx)(q,{})}renderClearButton(){return(0,L.jsx)("div",{style:{flexGrow:1,textAlign:"right",cursor:"pointer",fontSize:14,color:this.theme.mediumTextColor,marginRight:8},onClick:()=>this.updateFiltersAndTrackChange((()=>this.stores.activityUpdatesStore.reset())),children:(0,L.jsx)(g.FormattedMessage,{defaultMessage:"Clear",id:"activityUpdates.clearFilters"})})}updateFiltersAndTrackChange(e){const t=this.getFilterDataForTracking();e();const i=this.getFilterDataForTracking();h.Q6({environment:this.environment,activityUpdatesSource:this.props.source,filters:i,prevFilters:t})}renderOnline(){const{spaceId:e,navigableBlock:t,collectionId:i,source:n}=this.props,{currentUserStore:s,currentSpaceStore:o}=j.default.state;if(!s||!o)return;const a=o,{shouldLoadOlderActivities:r,shouldLoadNewerActivities:d,filterActivityTypes:c,filterDateRange:u,activityIds:p,hasOlderActivities:h}=this.stores.activityUpdatesStore.state,S=s.id,M=null==t?void 0:t.id;return(0,L.jsx)(f.Z,{throttle:1e3,request:{spaceId:e,navigableBlockId:M,collectionId:i,shouldLoadOlderActivities:r,shouldLoadNewerActivities:d,filterActivityTypes:c,filterDateRange:u,hasOlderActivities:h,activityIds:p},performRequest:async e=>{const{spaceId:t,navigableBlockId:i,collectionId:n,shouldLoadOlderActivities:s,shouldLoadNewerActivities:o,filterDateRange:a,filterActivityTypes:r,hasOlderActivities:d,activityIds:l}=e,c=A.ZP.startLoading();o?await m.A(this.environment,{store:this.stores.activityUpdatesStore,activityIds:l,spaceId:t,filterActivityTypes:r,filterDateRange:a,navigableBlockId:i,collectionId:n}):s&&d&&await m.h(this.environment,{store:this.stores.activityUpdatesStore,activityIds:l,spaceId:t,filterActivityTypes:r,filterDateRange:a,navigableBlockId:i,collectionId:n}),A.ZP.endLoading(c)},render:(t,s,o)=>{var d,p;const{activityIds:m}=this.stores.activityUpdatesStore.state;if(t)return(0,L.jsx)("div",{style:W(this.environment,this.theme),children:(0,L.jsx)(g.FormattedMessage,{defaultMessage:"Something went wrong.",id:"activityUpdate.unknownErrorLoadingActivities.message"})});const f=(0,v.oI)(),C=(0,w.Y)("supportsNativeHome"),k={spaceId:e,userId:S,navigableBlockId:M,collectionId:i,filterDateRange:u,filterActivityTypes:c},I=C&&0===m.length&&!o?x.IS(k):m;if(C&&o&&x.HB(k,m),0===I.length&&!o)return(0,L.jsxs)("div",{children:[f&&this.renderSearchFilters(),(0,L.jsx)(K.B,{areaHeight:window.innerHeight})]});const T=function(e){return l.oA(e.map((e=>function(e){const{currentUserStore:t,currentSpaceStore:i}=j.default.state;if(!t||!i)return;const n=(0,y.No)(i,e,i.id).getModel();return n&&!n.invalid?n:null}(e))))}(I),Z=this.stores.activityUpdatesStore.state,A=0===Z.filterActivityTypes.length&&void 0===Z.filterDateRange.ending&&void 0===Z.filterDateRange.starting,_=0===T.length&&!h&&o;return(0,L.jsxs)("div",{children:[f&&this.renderSearchFilters(),(0,L.jsxs)("div",{style:_?W(this.environment,this.theme):H(this.environment),className:_?"":"notranslate",children:[_?null===(d=(p=this.props).empty)||void 0===d?void 0:d.call(p,{hasFiltersOn:!A}):null,(0,L.jsx)("section",{role:"feed",children:T.map(((e,t,i)=>{const s=i.length-1===t,o="notifications_tab"===n?{tab:"all",source:n}:{tab:"pageUpdatesSidebar",source:n};return(0,L.jsx)(b.LazyActivityUpdate,{activity:e,rootStore:a,isLast:s,tabArgs:o},e.id)}))}),(0,L.jsx)(F.Z,{onChange:e=>{e<200&&o&&!r&&h&&(A||I.length>0)&&this.stores.activityUpdatesStore.update((e=>({...e,shouldLoadOlderActivities:!0})))},children:!o&&h?(0,L.jsx)(G,{isPaginated:!0}):null})]})]})}})}startMessageListeners(){const{navigableBlock:e,collectionId:t}=this.props,i=null==e?void 0:e.id;if(i){const e=(0,c.bS)(i);this.navigableBlockListenerReference=S.Z.addListener(e,this.handleNavigableBlockEmit,void 0,this.environment)}if(t){const e=(0,c.Cy)(t);this.collectionListenerReference=S.Z.addListener(e,this.handleCollectionEmit,void 0,this.environment)}}stopMessageListeners(){this.navigableBlockListenerReference&&(S.Z.removeListener(this.navigableBlockListenerReference,this.environment),this.navigableBlockListenerReference=void 0),this.collectionListenerReference&&(S.Z.removeListener(this.collectionListenerReference,this.environment),this.collectionListenerReference=void 0)}getFilterDataForTracking(){var e,t;const{filterActivityTypes:i,filterDateRange:n}=this.stores.activityUpdatesStore.state;return{activityTypes:i,dateRange:{start:null===(e=n.starting)||void 0===e?void 0:e.start_date,end:null===(t=n.ending)||void 0===t?void 0:t.start_date}}}}V.displayName="ActivityUpdates";const z=(0,g.injectIntl)(V);function H(e){return{minHeight:e.device.isMobile?void 0:"75vh"}}function W(e,t){const{device:i}=e;return{...H(e),paddingTop:i.isMobile?64:void 0,minHeight:i.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:t.mediumTextColor,flexDirection:"column",flex:"1 1 0%"}}function q(){window.__c={n:"OfflineComponent"};const e=(0,a.Fg)(),t=(0,o.O7)();return(0,L.jsx)("div",{style:W(t,e),children:(0,L.jsx)(g.FormattedMessage,{defaultMessage:"Please go online to view updates.",id:"activityUpdates.offlineMessage"})})}function Y(e,t,i){return{...W(e,t),minHeight:i?64:220}}function G(e){let{isPaginated:t}=e;window.__c={n:"SpinnerComponent"};const i=(0,a.Fg)(),n=(0,o.O7)();return(0,L.jsx)("div",{style:Y(n,i,t),children:(0,L.jsx)(_.Z,{})})}},61208:(e,t,i)=>{i.d(t,{Z:()=>a});i(67294);var n=i(24405),s=i(96640),o=i(85893);function a(e){window.__c={n:"MobileUpdatesModalEmptyTab"};const{message:t,title:i}=e,a=(0,n.yK)((e=>({wrapper:{textAlign:"center",paddingLeft:20,paddingRight:20,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minHeight:220},icon:{width:48,fill:e.mediumTextColor},message:{fontSize:14,color:e.lightTextColor,marginTop:2,marginBottom:4,maxWidth:380},title:{fontSize:14,fontWeight:500,color:e.mediumTextColor,maxWidth:380}})),[]),r=e.icon||s.r;return(0,o.jsxs)("div",{style:a.wrapper,children:[(0,o.jsx)("div",{style:{paddingBottom:12},children:r(a.icon)}),(0,o.jsx)("div",{style:a.title,children:i}),(0,o.jsx)("div",{style:a.message,children:t})]})}},56258:(e,t,i)=>{i.d(t,{Z:()=>U,o:()=>R});i(57658),i(30541);var n=i(67294),s=i(83355),o=i(480),a=i(24405),r=i(49085),d=i(72126),l=i(44615),c=i(65311),u=i(63143),p=i(9291),g=i(54642),m=i(17659),h=i(82530),f=i(23586),y=i(65598),v=i(51811),x=i(77907),b=i(2688),S=i(41549),w=i(45428),M=i(70564),j=i(50770),C=i(5162),k=i(80444),I=i(88632),T=i(26136),Z=i(4761),A=i(43145),_=i(70268),F=i(85893);const P={mentions:!0,archive:!1};function R(e){window.__c={n:"NotificationPerformanceMeasurer"};const t=(0,o.O7)();return(0,n.useEffect)((()=>{void 0!==e.requestId&&M.L(e.requestId,t)}),[e.requestId,t]),(0,F.jsx)(F.Fragment,{children:e.children})}class B extends s.Z{constructor(){super(...arguments),this.storeTypes={size:r.default.createClass(20),checkpoint:r.default.createClass(Math.random())},this.renderRequest=(e,t,i,n,s)=>{const o=this.renderRequestInner(e,t,i,n);return w.setState({request:e,result:i}),(0,F.jsx)(R,{requestId:s,children:o})},this.renderRequestInner=(e,t,i,n)=>{const s=k.default.state.currentSpaceStore;if(!s||t)return(0,F.jsx)("div",{style:N(this.props.type,this.environment,this.theme),children:(0,F.jsx)(p.FormattedMessage,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"})});const o=(0,C.Y)("supportsNativeHome");let a=o?i??v.Tj(e):i;if(o&&i&&v.yW(e,i),"mentions"===Z.ZP.state.currentTab&&Z.ZP.state.showOnlyUnreadNotifications&&(a=Z.ZP.state.unreadNotificationIds),!a)return(0,F.jsx)("div",{style:L(this.props.type,this.environment),children:(0,F.jsx)(_.B,{areaHeight:window.innerHeight})});const r=a.map((e=>T.t1.createChildStore(s,{table:c.uX,id:e}))),l=(0,j.H)(),u=[],g=d.oA(r.map((e=>{const t=e.getValue();if(!t)return;if(t.invalid)return;if(!l&&(t.visited&&P[this.props.type]||!t.visited&&"archive"===this.props.type))return;const i=y.sl(e);if(!i||!i.isReady())return;const n=i.getModel();if(n){if(!n.invalid)return{activity:n,notification:t};u.push(t)}else u.push(t)})));!function(e,t,i){const n=e.filter((e=>!e.read));if(0===n.length)return;h.createAndCommit({userAction:"NotificationUpdates.unreadNotificationNotRendered",environment:i,perform:e=>{for(const i of n)m.$h({notification:i,rootStore:t,transaction:e,read:!0})}})}(u,s,this.environment);const f=this.stores.size.state,b=g.some((e=>{let{notification:t}=e;return!t.read})),w=b&&g.some((e=>{let{notification:t}=e;return t.read}));let M,I;if(l){const t=S.H$(g,e.type);I=(0,F.jsx)(x.LazyNotificationGroups,{notifications:t,rootStore:s,source:this.props.source,tab:this.props.tab}),M=0===t.size}else I=g.map(((e,t,i)=>{let{activity:n,notification:o}=e;const a=0===t,r=i.length-1===t,d={source:this.props.source,tab:this.props.tab,notification:o};return(0,F.jsx)(x.LazyActivityNotification,{activity:n,rootStore:s,isFirst:a,isLast:r,tabArgs:d,useInboxRedesign:!1},n.id)})),M=0===g.length;return"mentions"===Z.ZP.state.currentTab?Z.ZP.setState({...Z.ZP.state,isCurrentTabEmpty:M,containsBothReadAndUnreadNotifications:w,containsUnreadNotifications:b}):Z.ZP.setState({...Z.ZP.state,isCurrentTabEmpty:M}),(0,F.jsxs)("div",{style:M?N(this.props.type,this.environment,this.theme):L(this.props.type,this.environment),children:[M&&this.props.empty,(0,F.jsx)("section",{role:"feed",className:"notranslate",children:I}),(0,F.jsx)(A.Z,{onChange:e=>{e<200&&a&&a.length>=f&&this.stores.size.setState(a.length+20)},children:!a&&(0,F.jsx)(_.B,{areaHeight:window.innerHeight})})]})},this.handleActivityEmit=(e,t)=>{String(t).includes("unreadCount")||this.stores.checkpoint.setState(Math.random())},this.handleActivityEmitThrottled=d.P2(this.handleActivityEmit,1e3),this.handleNotificationEmit=u.YX(this.handleActivityEmitThrottled),this.notificationListenerReference=void 0}UNSAFE_willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return I.Z.state.online?this.renderOnline():(0,F.jsx)(O,{type:this.props.type})}renderOnline(){const{currentUserStore:e,currentSpaceStore:t}=k.default.state;if(!e||!t)return;const i=t.id,n=this.stores.size.state,s=this.stores.checkpoint.state,o=this.props.type,a=e.id,r=(0,j.H)();return(0,F.jsx)(f.Z,{throttle:1e3,request:{spaceId:i,size:n,type:o,checkpoint:s},performRequest:async e=>{let{spaceId:t,size:i,type:n}=e;const s=Z.ZP.startLoading();M.B(s,{size:i,type:n});const o=r&&"mentions"===n?await g.getNotificationLogV2(this.environment,{spaceId:t,size:i,type:"unread_and_read"}):await g.getNotificationLog(this.environment,{spaceId:t,size:i,type:n});if(Z.ZP.endLoading(s),"failed"===o.type)throw o.error;if("mentions"===Z.ZP.state.currentTab&&Z.ZP.state.showOnlyUnreadNotifications){const e=await m.Qy({environment:this.environment}),t=[...Z.ZP.state.unreadNotificationIds];for(const i of e)t.includes(i)||t.unshift(i);Z.ZP.setState({...Z.ZP.state,unreadNotificationIds:t})}return{notificationIds:o.data.notificationIds,requestId:s}},render:(e,t,n)=>this.renderRequest({spaceId:i,userId:a,type:o},e,null==t?void 0:t.notificationIds,n,null==t?void 0:t.requestId)})}startMessageListeners(){const{currentUserStore:e}=k.default.state;if(e){const t=(0,l.Lp)(e.id);this.notificationListenerReference=b.Z.addListener(t,this.handleNotificationEmit,void 0,this.environment)}}stopMessageListeners(){this.notificationListenerReference&&(b.Z.removeListener(this.notificationListenerReference,this.environment),this.notificationListenerReference=void 0)}}B.displayName="NotificationUpdates";const U=B;function L(e,t){const{device:i}=t;return{minHeight:i.isMobile||"mentions"===e?void 0:"75vh"}}function N(e,t,i){const{device:n}=t;return{...L(e,t),paddingTop:n.isMobile?64:void 0,minHeight:n.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:i.regularTextColor,overflow:"hidden"}}function O(e){let{type:t}=e;window.__c={n:"OfflineComponent"};const i=(0,a.Fg)(),n=(0,o.O7)();return(0,F.jsx)("div",{style:N(t,n,i),children:(0,F.jsx)("div",{children:(0,F.jsx)(p.FormattedMessage,{defaultMessage:"Please go online to view updates.",id:"notificationUpdates.offline.message"})})})}},55064:(e,t,i)=>{i.d(t,{Z:()=>_});var n=i(67294),s=i(83355),o=i(480),a=i(86628),r=i(24405),d=i(97880),l=i(51454),c=i(9291),u=i(17659),p=i(99553),g=i(24677),m=i(28651),h=i(98742),f=i(89224),y=i(35350),v=i(41549),x=i(74948),b=i(24646),S=i(38676),w=i(36391),M=i(96049),j=i(66353),C=i(45325),k=i(88923),I=i(6685),T=i(26388),Z=i(85893);class A extends s.Z{constructor(){super(...arguments),this.didDragMove=!1,this.storeTypes={mouseStore:m.Z},this.handleDragStart=()=>{g.ZH(this.environment),this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!0}),this.didDragMove=!1,F({...S.sidebarResizingStore.state,isResizing:!0},this.props.type)},this.handleDragMove=e=>{const{type:t}=this.props;switch(f.clear(this.environment),this.didDragMove=!0,t){case"page":x.setWidth({width:R(e.currentX,this.props.type),environment:this.environment});break;case"update":x.setUpdateWidth({width:R(e.currentX,this.props.type),environment:this.environment});break;case"peek":x.setPeekWidth({width:R(e.currentX,this.props.type),environment:this.environment});break;case"inbox":y.c(R(e.currentX,this.props.type));break;default:(0,d.t1)(t)}},this.handleDragEnd=()=>{const{type:e}=this.props;if(!this.didDragMove){switch(e){case"page":x.setExpand({environment:this.environment,isExpanded:!S.sidebarExpandedStore.state,from:"sidebar_resizer"}),S.sidebarOpenStore.setState(!1);break;case"update":x.setUpdateExpand({environment:this.environment,isExpanded:!(0,b.Sx)(this.environment),from:"drag"});break;case"peek":p.xv(this.environment,"resizer_click");break;case"inbox":u.qQ({environment:this.environment,open:!C.default.isOpen()});break;default:(0,d.t1)(e)}this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})}this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1}),F({isResizing:!1},this.props.type)},this.handleDragCancel=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1}),F({isResizing:!1},this.props.type)}}renderComponent(){const{device:e}=this.environment,{type:t}=this.props,i=function(e){const t=function(e){switch(e){case"page":return S.sidebarWidthStore.state;case"inbox":return v.l5();case"update":return w.ZP.state.width;case"peek":return k.default.state.preferredSidePeekWidth;default:(0,d.t1)(e)}}(e);switch(e){case"page":return t;case"inbox":return S.sidebarWidthStore.state+v.l5();case"peek":case"update":return window.innerWidth-t;default:(0,d.t1)(e)}}(this.props.type),n=S.sidebarMouseEnterYStore.state;if(!M.Z.state&&!e.isChromebook)return(0,Z.jsx)(T.ZP,{renderTooltip:()=>(0,Z.jsx)(U,{type:this.props.type}),originRect:new DOMRect(i,n,0,0),delayThreshold:500,placement:"page"===t||"inbox"===t?T.ug.Right:T.ug.Left,originGap:10,render:e=>(0,Z.jsx)("div",{style:B(this.props.type,this.environment),...(0,h.Z)(e,{onMouseMove:()=>function(e){F({isResizerHovered:!0},e)}(this.props.type),onMouseLeave:()=>function(e){F({isResizerHovered:!1},e)}(this.props.type),onMouseEnter:L}),children:(0,Z.jsx)(I.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>(0,Z.jsx)("div",{style:P(this.props.type),...e})})})})}}A.displayName="SidebarResizer";const _=A;function F(e,t){switch(t){case"page":S.sidebarResizingStore.update((t=>({...t,...e})));break;case"update":w.ZP.update((t=>({...t,...e})));break;case"inbox":C.default.update((t=>({...t,...e})));break;case"peek":break;default:(0,d.t1)(t)}}function P(e){return{cursor:"col-resize",height:"100%",width:12,marginLeft:"update"===e?-w.ZP.state.width:-6}}function R(e,t){let i;switch(t){case"page":i=e;break;case"inbox":i=e-(S.sidebarExpandedStore.state?S.sidebarWidthStore.state:0);break;case"peek":case"update":i=window.innerWidth-e;break;default:(0,d.t1)(t)}const n=function(e){const t=window.innerWidth;switch(e){case"page":return 480;case"update":return Math.min(t/2,b.Nc);case"peek":return t>2*k.sidePeekMinWidth?t/1.5:t;case"inbox":return j.Rx;default:(0,d.t1)(e)}}(t),s=function(e){switch(e){case"page":return S.SidebarMinWidth;case"update":return w.AO;case"peek":return k.sidePeekMinWidth;case"inbox":return j.fK;default:(0,d.t1)(e)}}(t);return i>n?n:i<s?s:i}function B(e,t){const i=(0,b.in)(t);return{position:"absolute",left:"peek"===e?0:void 0,right:"peek"!==e?0:void 0,width:0,flexGrow:0,zIndex:"peek"===e?l.YO:1,top:i?0:-1,bottom:i?0:-1,pointerEvents:"auto"}}function U(e){let{type:t}=e;window.__c={n:"TooltipComponent"};const i=(0,r.Fg)(),s=(0,o.O7)(),l=(0,a.VK)((()=>function(e,t){switch(e){case"page":return(0,b.in)(t);case"update":return(0,b.Sx)(t);case"peek":return k.default.state.open;case"inbox":return C.default.isOpen();default:(0,d.t1)(e)}}(t,s)),[t,s]),u=i.mediumInvertedTextColor;return(0,Z.jsxs)("div",{style:{textAlign:"center"},children:[(0,Z.jsx)(c.FormattedMessage,{defaultMessage:"Drag <invertedcolor>to resize</invertedcolor>",id:"sidebarResizer.tooltip.dragMessage",values:{invertedcolor:e=>(0,Z.jsx)("span",{style:{color:u},children:e})}}),(0,Z.jsxs)(n.Fragment,{children:[(0,Z.jsx)("br",{}),(0,Z.jsx)(c.FormattedMessage,{defaultMessage:"Click <invertedcolor>to {expanded, select, true {close} other {lock open}}</invertedcolor>",id:"sidebarResizer.clickToToggleSidebar.message",values:{expanded:l,invertedcolor:e=>(0,Z.jsx)("span",{style:{color:u},children:e})}})]})]})}function L(e){S.sidebarMouseEnterYStore.setState(e.clientY)}},70268:(e,t,i)=>{i.d(t,{B:()=>a});i(67294);var n=i(24405),s=i(36596),o=i(85893);function a(e){window.__c={n:"UpdateSidebarLoadingSkeleton"};let t=Math.floor(e.areaHeight/124);0===t&&(t=1);const i=(0,n.yK)((e=>({skeletonRect:{height:8,borderRadius:4,margin:10,backgroundColor:e.lightDividerColor},skeletonCircle:{display:"flex",width:28,height:28,marginRight:8,backgroundColor:e.lightDividerColor,borderRadius:20},skeletonSection:{display:"flex",width:"100%",margin:20,flexDirection:"row"}})),[8,10,20]),a=[...Array(t)].map(((e,t)=>(0,o.jsxs)("div",{style:i.skeletonSection,children:[(0,o.jsx)(s.Z,{style:i.skeletonCircle}),(0,o.jsxs)("div",{style:{width:"80%"},children:[(0,o.jsx)(s.Z,{style:{width:"80%",...i.skeletonRect,marginTop:0}}),(0,o.jsx)(s.Z,{style:{width:"50%",...i.skeletonRect}}),(0,o.jsx)(s.Z,{style:{width:"60%",...i.skeletonRect}}),(0,o.jsx)(s.Z,{style:{width:"50%",...i.skeletonRect}})]})]},t)));return(0,o.jsx)("div",{children:a})}},35767:(e,t,i)=>{i.d(t,{J:()=>te});var n=i(67294),s=i(74725),o=i(480),a=i(86628),r=i(24405),d=i(7057),l=i(42875),c=i(17880),u=i(72126),p=i(80503),g=i(82990),m=i(9291),h=i(54564),f=i(17707),y=i(34047),v=i(43250),x=i(33929),b=i(65598),S=i(77546),w=i(24646),M=i(36391),j=i(34859),C=i(80444),k=i(24229),I=i(29798),T=i(32163),Z=i(53336),A=i(36591),_=i(42853),F=i(74948),P=i(52275),R=i(89728),B=i(53437),U=i(72495),L=i(64921),N=i(85893);function O(){window.__c={n:"UpdateSidebarTabCommentsSegmentedControl"};const e=(0,a.VK)((()=>M.ZP.state.commentsMode),[]),t=(0,r.yK)((e=>({container:{background:e.buttonHoveredBackground,width:"calc(100% - 32px)",height:36,borderRadius:10,display:"flex",margin:"10px 16px 6px 16px",marginTop:20,padding:4,gap:2,pointerEvents:"auto"},defaultButton:{borderRadius:8,fontSize:13,fontWeight:g.Z.fontWeight.medium,textAlign:"center",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:1.8,color:e.regularTextColor,letterSpacing:-.08},selectedButton:{fontWeight:g.Z.fontWeight.semibold,background:e.segmentedControlActiveBackground,border:`0.5px solid ${e.outlineButtonBorder}`}})),[]);return(0,N.jsxs)("div",{style:t.container,className:v.rG8,children:[(0,N.jsx)(L.Z,{style:{...t.defaultButton,...e===M.F7.Unresolved?t.selectedButton:{}},onClick:()=>{F.setUpdateSidebarCommentsMode(M.F7.Unresolved)},children:(0,N.jsx)("span",{children:(0,N.jsx)(m.FormattedMessage,{id:"updateSidebarTabCommentsSegmentedControl.option.open",defaultMessage:"Open"})})}),(0,N.jsx)(L.Z,{style:{...t.defaultButton,...e===M.F7.Resolved?t.selectedButton:{}},onClick:()=>{F.setUpdateSidebarCommentsMode(M.F7.Resolved)},children:(0,N.jsx)("span",{children:(0,N.jsx)(m.FormattedMessage,{id:"updateSidebarTabCommentsSegmentedControl.option.resolved",defaultMessage:"Resolved"})})})]})}const D=[M.F7.Unresolved,M.F7.Resolved],E={[M.F7.Unresolved]:v.oc0,[M.F7.Resolved]:v.Y7r},K=(0,m.defineMessages)({[M.F7.Unresolved]:{id:"updateSidebar.comments.mode.unresolvedOption",defaultMessage:"Open comments"},[M.F7.Resolved]:{id:"updateSidebar.comments.mode.resolvedOption",defaultMessage:"Resolved comments"}}),V=(0,m.defineMessages)({[M.F7.Unresolved]:{id:"updateSidebar.comments.filter.button.unresolvedMode",defaultMessage:"Open"},[M.F7.Resolved]:{id:"updateSidebar.comments.filter.button.resolvedMode",defaultMessage:"Resolved"}});function z(){window.__c={n:"UpdateSidebarCommentsFilterControl"};return(0,o.O7)().device.isMobile?(0,N.jsx)(O,{}):(0,N.jsx)(H,{})}function H(){window.__c={n:"DesktopUpdateSidebarCommentsFilterControl"};const[e,t]=(0,n.useState)(!1),{commentsMode:i}=(0,a.Kw)(M.ZP),s=(0,r.yK)((e=>({container:{display:"flex",flexDirection:"column"},commentsHeader:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${e.regularDividerColor}`,alignItems:"center",pointerEvents:"auto"},label:{fontSize:14,color:e.regularTextColor,fontWeight:g.Z.fontWeight.medium,display:"flex",alignItems:"center",padding:"12px 12px 12px 16px"},toggleButton:{justifyContent:"center",display:"flex",color:e.mediumTextColor},toggleButtonContainer:{paddingLeft:12,paddingRight:8,display:"flex"},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor},getNotifiedContainer:{paddingRight:6,paddingLeft:6}})),[]),o=(0,n.useCallback)((()=>(0,N.jsx)(T.Z,{type:T.i.Vertical,initialFocus:void 0,sections:[{key:"commentFilter",render:e=>(0,N.jsx)(U.Z,{...e}),items:D.map((e=>({key:e,render:t=>(0,N.jsx)(P.Z,{...t,className:E[e],title:x.default.formatMessage(K[e]),right:(0,N.jsx)("div",{style:{width:14,opacity:i===e?1:0},children:(0,A.e)()})}),action:()=>{F.setUpdateSidebarCommentsMode(e),t(!1)}})))}]})),[i]);return(0,N.jsx)(N.Fragment,{children:(0,N.jsx)("div",{style:s.container,children:(0,N.jsxs)("div",{style:s.commentsHeader,className:v.I9j,children:[(0,N.jsx)("div",{style:s.label,children:(0,N.jsx)(m.FormattedMessage,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})}),(0,N.jsx)("div",{style:s.toggleButtonContainer,className:v.CBT,children:(0,N.jsx)(B.ZP,{popupType:B.ZP.PopupType.Popup,open:e,origin:(0,N.jsxs)(R.Z,{style:s.toggleButton,onClick:()=>{t(!0)},children:[x.default.formatMessage(V[i]),(0,_.i)(s.chevronIcon)]}),placementToOrigin:B.ZP.Placement.Bottom,alignmentToOrigin:B.ZP.Alignment.Center,originGap:4,render:o,onDismiss:()=>{t(!1)}})})]})})})}var W=i(21202),q=i(92120),Y=i(77907),G=i(26136),$=i(28992);const X=n.forwardRef(((e,t)=>{window.__c={n:"UpdateSidebarDiscussionItem"};const{currentBlockStore:i,discussion:s,showAllRepliesAfterTimestamp:d,focused:l,isLast:c,location:u}=e,p=(0,a.VK)((()=>k.Z.state.open&&k.Z.state.discussionIds||[]),[]),g=(0,o.O7)();(0,n.useEffect)((()=>{var e;if(l){q.Z.setState({source:"update_sidebar",discussionIds:[s.id]});const e=setTimeout((()=>{var e;(null===(e=q.Z.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===s.id&&f.AM([s.id])}),1500);return()=>{clearTimeout(e)}}(null===(e=q.Z.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===s.id&&q.Z.setState({discussionIds:[]})}),[l,s,g]);const m=(0,a.VK)((()=>{var e;return(null===(e=q.Z.state)||void 0===e?void 0:e.discussionIds)||[]}),[]),h=s.id,{parentId:x,currentSpaceId:b}=(0,a.VK)((()=>({parentId:s.getParentId(),currentSpaceId:s.getSpaceId()})),[s]),S=x?G.G.createChildStore(s,{table:W.iU,id:x}):void 0,w=p.includes(h),M=m.includes(h),j=(0,r.yK)((e=>({discussionContainer:{paddingTop:g.device.isMobile?4:10,borderBottom:c||g.device.isMobile?void 0:`1px solid ${e.regularDividerColor}`,transition:"background 300ms ease"},replyButton:{color:e.blueColor,marginLeft:23,fontSize:14},hoveredStyle:{background:"sidebar"===u?e.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===u?e.focusDiscussionBackground:void 0}})),[u,c,g]);if(!S||!b)return null;const C=(0,N.jsx)("div",{className:`sidebar-discussion-${h} ${v.s$o}`,onClick:e.onClick,onMouseEnter:e.onMouseEnter,ref:t,style:{...j.discussionContainer,...l||M?j.hoveredStyle:{},...w?j.pressedStyle:{}},children:(0,N.jsx)(Y.LazyDiscussion,{store:s,blockStore:i,format:y.O2.Sidebar,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"updates_sidebar",showAllRepliesAfterTimestamp:d})});return(0,N.jsx)($.Z,{allowTextSelection:!0,title:C,style:{marginLeft:-14,marginRight:-14,width:"calc(100% + 28px)",lineHeight:void 0,cursor:"pointer"}})}));function J(e){window.__c={n:"UpdateSidebarDiscussionSection"};const{firstItemId:t}=e,i=(0,a.VK)((()=>{var e;return null===(e=q.Z.state)||void 0===e?void 0:e.discussionIds.some((e=>e===t))}),[t]),n=(0,a.VK)((()=>k.Z.state.open&&k.Z.state.discussionIds&&k.Z.state.discussionIds.some((e=>e===t))),[t]),s=(0,r.yK)((t=>({hoveredStyle:{background:"sidebar"===e.location?t.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===e.location?t.focusDiscussionBackground:void 0},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:g.Z.fontWeight.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[e.location]);return(0,N.jsx)(U.Z,{desktopTitleStyle:{...s.basicDesktopTitleStyle,...i?s.hoveredStyle:{},...n?s.pressedStyle:{}},mobileTitleStyle:s.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}var Q=i(70268);const ee=new I.Z;function te(e){window.__c={n:"UpdateSidebarTabComments"};const{timeMounted:t,location:i}=e,I=(0,o.O7)(),[A,_]=(0,n.useState)(!1),F=(0,a.VK)((()=>C.default.state.mainEditorCurrentBlockStore),[]),P=(0,a.VK)((()=>I.currentUser.id),[I]),R=(0,a.VK)((()=>(0,y.DF)({blockStore:F,ignoreAfterTime:t,currentUserId:P})),[F,t,P]),B=(0,a.VK)((()=>M.ZP.state),[]),U=(0,a.VK)((()=>(0,w._c)(I)),[I]),L=(0,a.VK)((()=>k.Z.state.open&&k.Z.state.discussionIds||[]),[]),{resolved:O,unresolved:D}=(0,a.VK)((()=>(0,b.bB)(R)),[R]),E=B.commentsMode===M.F7.Unresolved,K=E?D:O,V=K.map((e=>e.id));(0,n.useEffect)((()=>{if("popup"===i&&A)return()=>{f.AM(V)}}),[i,V,A]);const H=(0,r.yK)((e=>({commentsEmptyStyle:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,position:"relative",background:e.contentBackground,marginRight:U?2:0,pointerEvents:"auto",paddingTop:10},commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:U?2:0,pointerEvents:"auto",height:"100%"},commentsIconStyle:{height:54,width:54,marginBottom:12,fill:e.mediumIconColor}})),[U]),W=(0,n.useRef)(null),q=(0,a.VK)((()=>(0,w.Sx)(I)),[I]);(0,s.O)({active:q,closeHandler:h.LZ,ref:W});const Y=(0,a.VK)((()=>{const e=u.vM(K,(e=>{const t=(0,y.Qg)({recordStore:e,currentUserId:P});return t?(0,d.$6)(t.getCreatedTime()):""}));return delete e[""],e}),[K,P]),G=(0,a.VK)((()=>(0,y.W5)(K)),[K]);if((0,n.useEffect)((()=>{A||G||_(!0)}),[A,G]),!F||!Y||!A)return(0,N.jsx)(Q.B,{areaHeight:window.innerHeight});if(0===K.length)return(0,N.jsxs)("div",{style:H.commentsContentStyle,children:[(0,N.jsx)(z,{}),(0,N.jsxs)("div",{style:H.commentsEmptyStyle,children:[(0,c.W)(H.commentsIconStyle),(0,N.jsx)("div",{style:{fontWeight:g.Z.fontWeight.semibold,marginBottom:4},children:E?(0,N.jsx)(m.FormattedMessage,{id:"updateSidebar.commentContainer.emptyTitleUnresolved",defaultMessage:"No open comments yet"}):(0,N.jsx)(m.FormattedMessage,{id:"updateSidebar.commentContainer.emptyTitleResolved",defaultMessage:"No resolved comments yet"})}),(0,N.jsx)("div",{style:{width:200,alignSelf:"center"},children:E?(0,N.jsx)(m.FormattedMessage,{id:"updateSidebar.commentContainer.emptyUnresolved",defaultMessage:"Open comments on this page will appear here"}):(0,N.jsx)(m.FormattedMessage,{id:"updateSidebar.commentContainer.emptyResolved",defaultMessage:"Resolved comments on this page will appear here"})})]})]});const $=Object.keys(Y).sort().reverse(),te=$.map(((e,n)=>{const s=(0,d.ZV)({value:{type:"date",start_date:e},date_format:"relative",userTimeZone:(0,l.r)(),intl:x.default.getIntl(),allowRelativeDates:!0}),o=Y[e];return{key:e,render:e=>(0,N.jsx)(J,{title:s,firstItemId:o[0].id,location:i,...e}),items:o.map(((e,s)=>({key:e.id,render:a=>(0,N.jsx)(X,{...a,currentBlockStore:F,discussion:e,isFirstInSection:0===s,location:i,isLast:s===o.length-1&&n===$.length-1,showAllRepliesAfterTimestamp:t}),action:()=>{f.Ri({discussionStore:e,currentBlockStore:F,environment:I,analyticsFrom:"updates_sidebar",currentEl:W.current})}})))}})),ie=te.flatMap((e=>e.items)).findIndex((e=>L.includes(e.key.toString())));return(0,N.jsxs)("div",{style:H.commentsContentStyle,ref:W,children:[(0,N.jsx)(z,{}),(0,N.jsx)(Z.Z,{type:j.Z.Y,style:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0},className:v.Xsh,children:(0,N.jsx)(T.Z,{disableKeyboard:!0,store:ee,type:T.i.Vertical,initialFocus:ie>=0?ie:void 0,scrollElIntoView:e=>{if(e instanceof Element){const t=e.getBoundingClientRect(),i=p.R6(I.device.isElectronMac),n=window.innerHeight,s=i+50,o=n-s;if(t.height>=o)return;const a=t.top>=s&&t.top<=n,r=a&&t.bottom>=n,d=t.bottom>=s&&t.bottom<=n,l=d&&t.top-s<0,c=a||d,u=.4*t.height;r&&Math.abs(t.top-n)<u?(0,S.Wr)(e,{edgeDist:n-t.height-s,animate:!0}):l&&Math.abs(t.bottom-s)<u?(0,S.Wr)(e,{edgeDist:0,animate:!0}):c||(0,S.Wr)(e,{edgeDist:0,animate:!0})}},sections:te})})]})}},13630:(e,t,i)=>{i.d(t,{Tf:()=>a,bl:()=>o,q0:()=>r});var n=i(25651),s=i(70406);const o={pageLayoutSchema:[{type:"cover"},{type:"titleWithIcon"},{type:"properties"},{type:"inlinePageSections"},{type:"expandedBacklinks"},{type:"discussions"},{type:"bottomControls"},{type:"editor"}],pageInfoLayoutSchema:[]},a={pageLayoutSchema:[{type:"cover"},{type:"titleWithIcon"},{type:"properties"},{type:"inlinePageSections"},{type:"expandedBacklinks"},{type:"discussions"},{type:"bottomControls"},{type:"tabs",style:"left-aligned",tabs:[{icon:"pencil",label:"Notes",content:[{type:"editor"}]},{icon:"transcript",label:"Transcript",content:[{type:"transcript"}]}]}],pageInfoLayoutSchema:[]},r={pencil:n.R,transcript:s.p}},3712:(e,t,i)=>{i.d(t,{Z:()=>y});var n=i(67294),s=i(480),o=i(24405),a=i(18442),r=i(97880),d=i(9291),l=i(19719),c=i(97799),u=i(92083),p=i(62820),g=i(73063),m=i(26388),h=i(85893);function f(e){let{location:t}=e;window.__c={n:"InboxNotificationSettingsButton"};const i=(0,d.useIntl)(),f=(0,s.O7)(),y=(0,n.useCallback)((()=>{const{device:e}=f;l.FR(f),e.isMobile?c.Z.setState({open:!0,source:c.Y.Updates}):(p.Z.setState({...p.Z.state,open:!1}),u.Z.setState({...u.Z.state,currentTab:"notifications",defaultSubtab:void 0}),u.Z.setState({...u.Z.state,open:!0}))}),[f]),v=(0,o.yK)((e=>({mobileTopBarIcon:{height:18,width:18,fill:e.regularTextColor},webUpdatesModalIcon:{width:16,height:16}})),[]);let x;switch(t){case"mobileTopBar":x=v.mobileTopBarIcon;break;case"webUpdatesModal":x=v.webUpdatesModalIcon;break;default:(0,r.t1)(t)}return(0,h.jsx)(m.ZP,{renderTooltip:()=>(0,h.jsx)(d.FormattedMessage,{defaultMessage:"Open notifications settings",id:"updatesModal.openNotifications.tooltip"}),render:e=>(0,h.jsx)(g.Z,{icon:a.H,iconStyle:x,onClick:y,ariaLabel:i.formatMessage({id:"updatesModal.openNotifications.tooltipAriaLabel",defaultMessage:"Open notifications settings button"}),...e})})}const y=n.memo(f)},67579:(e,t,i)=>{i.d(t,{f:()=>y});var n=i(67294),s=i(24405),o=i(69651),a=i(73123),r=i(33929),d=i(87279),l=i(33338),c=i(52275),u=i(78140),p=i(32163),g=i(53437),m=i(72495),h=i(91642),f=i(85893);function y(e){window.__c={n:"DateFilter"};const t=(0,s.yK)((e=>({popup:{width:125,marginLeft:5},pillStyle:{display:"flex",alignItems:"center"}})),[]),{currentFilter:i,hideAllTime:y}=e,[v,x]=(0,n.useState)(!1),b=a.Hz.filter((e=>!y||"all_time"!==e)).map((t=>{const i=()=>{e.onChangeFilter(t),x(!1)};return{key:t,action:()=>{},render:()=>(0,f.jsx)(c.Z,{focused:!1,onClick:i,title:r.default.formatMessage(a.Rh[t])})}})),S=(0,f.jsx)(l.Z,{on:Boolean(i),wrapStyle:t.pillStyle,icon:(0,o.C)({width:16,marginRight:6,fill:"currentColor"}),title:r.default.formatMessage(a.Rh[i]),onClick:()=>{x(!0)}}),w=[{key:"filters",items:b,render:e=>(0,f.jsx)(m.Z,{...e,title:null,loading:!1})}],M=(0,f.jsx)(u.Z,{menuType:d.og.Popup,header:null,children:(0,f.jsx)(p.Z,{type:p.i.Vertical,initialFocus:0,sections:w})});return(0,f.jsx)(h.Z,{marginAfter:!1,children:(0,f.jsx)(g.ZP,{popupType:g.ZP.PopupType.Popup,placementToOrigin:g.ZP.Placement.Bottom,alignmentToOrigin:g.ZP.Alignment.Start,open:v,render:()=>M,onDismiss:()=>x(!1),keepFocus:!0,origin:S,preventScaleTransition:!0,style:t.popup})})}},48603:(e,t,i)=>{i.r(t),i.d(t,{PageAnalyticsPageOptOut:()=>T,TopbarPageAnalyticsOptOutMenu:()=>I,TopbarPageAnalyticsOptOutMenuStore:()=>k,pageAnalyticsMenu:()=>C});i(67294);var n=i(480),s=i(86628),o=i(49085),a=i(83176),r=i(18442),d=i(9291),l=i(62967),c=i(97627),u=i(19037),p=i(18514),g=i(74948),m=i(36391),h=i(80444),f=i(73420),y=i(53437),v=i(72495),x=i(42402),b=i(55422),S=i(61881),w=i(85893);const M=(0,d.defineMessages)({pageAnalyticsName:{id:"action.pageAnalytics.name",defaultMessage:"Page analytics"},viewAnalyticsName:{id:"action.viewAnalytics.name",defaultMessage:"View analytics"},privacySettingsName:{id:"action.privacySettings.name",defaultMessage:"Privacy settings"}}),j=e=>{const t=e.blocks[0];if(!t)return!1;return(0,S.W2)({canEditPage:t.canEdit(),device:e.environment.device})},C=(0,l.MV)({key:"page analytics menu",displayName:M.pageAnalyticsName,analyticsName:M.pageAnalyticsName.defaultMessage,validators:[u.DF],svg:a.z,subActions:e=>[{key:"view analytics",render:e=>(0,w.jsx)(v.Z,{...e}),actions:[(0,l.cN)({key:"view analytics",displayName:M.viewAnalyticsName,analyticsName:M.viewAnalyticsName.defaultMessage,svg:a.z,validators:[j],closeParentMenu:!0,action:()=>{g.handleSidebarButtonClick(e.environment,e.blocks[0],m.gY.Updates,"more_menu"),m.ZP.setState({...m.ZP.state,currentSubTab:m.uF.Analytics})}}),(0,l.cN)({key:"privacy settings",displayName:M.privacySettingsName,analyticsName:M.privacySettingsName.defaultMessage,svg:r.H,validators:[],closeParentMenu:!0,action:e=>{k.setState({isOpen:!0,rect:e.originRect})}})]}]}),k=o.default.createValue({isOpen:!1,rect:void 0}),I=()=>{window.__c={n:"TopbarPageAnalyticsOptOutMenu"};const e=(0,n.O7)(),t=(0,s.VK)((()=>k.state.isOpen),[]),i=(0,s.VK)((()=>k.state.rect),[]),o=(0,s.VK)((()=>h.default.state.mainEditorCurrentBlockStore),[]);return o?(0,w.jsx)(y.ZP,{popupType:e.device.isMobile?y.ZP.PopupType.SlideUp:y.ZP.PopupType.Popup,alignmentToOrigin:y.ZP.Alignment.Center,open:t,render:()=>(0,w.jsx)("div",{style:{minWidth:360,padding:16},children:(0,w.jsxs)(f.sg,{gap:16,children:[(0,w.jsx)("div",{style:{fontSize:16,fontWeight:500},children:(0,w.jsx)(d.FormattedMessage,{id:"TopbarPageAnalyticsOptOutMenu.heading",defaultMessage:"Privacy settings"})}),(0,w.jsx)(T,{store:o})]})}),originRect:i,onDismiss:()=>k.setState({isOpen:!1,rect:void 0})}):null};function T(e){window.__c={n:"PageAnalyticsPageOptOut"};const t=(0,n.O7)(),i=(0,s.VK)((()=>{const e=h.default.state.currentSpaceViewStore;return null==e?void 0:e.getSettings()}),[]),o=(0,s.VK)((()=>{const t=null==i?void 0:i.page_analytics_opt_out_list;return null==t?void 0:t.includes(e.store.id)}),[i,e.store.id]);return(0,w.jsx)(b.Z,{type:"dropdown",currentOption:o?"do_not_record":"record",options:[{key:"record",label:(0,w.jsx)(d.FormattedMessage,{id:"page_analytics.opt_out.record",defaultMessage:"Record"})},{key:"do_not_record",label:(0,w.jsx)(d.FormattedMessage,{id:"page_analytics.opt_out.do_not_record",defaultMessage:"Don't record"})}],onSelectOption:i=>{"do_not_record"===i?c.kY(t,e.store.id):c.pu(t,e.store.id)},isMobile:t.device.isMobile,title:(0,w.jsx)(d.FormattedMessage,{id:"page_analytics.opt_out.title",defaultMessage:"My view history"}),caption:(0,w.jsx)(d.FormattedMessage,{id:"page_analytics.opt_out.caption",defaultMessage:"Page editors can see my view history for this page. <inlinelink>Learn more</inlinelink>.",values:{inlinelink:e=>(0,w.jsx)(x.Z,{external:!0,href:(0,p.UY)("guides.pageAnalytics"),children:e})}}),captionStyle:{maxWidth:270}})}},83420:(e,t,i)=>{i.d(t,{TL:()=>u,nc:()=>c,ue:()=>l});var n=i(66897),s=i(54368),o=i(77420),a=i(19889),r=i(97880),d=i(26136);function l(e){const{parentStore:t,pointer:i}=e,s=(0,d.Kv)(t,i).getValue();if(s)return(0,n.LU)({table:i.table,value:s})}function c(e){const{parentStore:t,pointer:i}=e;return i.table===o.cZ?d.Qx.createChildStore(t,i):i.table===a.KJ?d.U6.createChildStore(t,i):i.table===s.y?d.fg.createChildStore(t,i):void(0,r.t1)(i)}function u(e){return e.table===o.cZ?(0,n.ON)(e.getValue()):e.table===a.KJ?(0,n.m3)(e.getValue()):e.table===s.y?(0,n.I4)(e.getValue()):void(0,r.t1)(e)}},35314:(e,t,i)=>{i.d(t,{e:()=>a});var n=i(67294),s=i(86628),o=i(77794);function a(){const[e,t]=(0,n.useState)(0),[i]=(0,n.useState)((()=>new o.E)),a=(0,n.createRef)();return(0,n.useEffect)((()=>{a.current&&i.observe(a.current)}),[a,i]),(0,s.VK)((()=>{e!==i.rect.state.width&&t(i.rect.state.width)}),[e,i.rect]),[a,e]}},35350:(e,t,i)=>{i.d(t,{T:()=>a,c:()=>r});var n=i(19719),s=i(41549),o=i(66353);function a(e,t){o.ZP.setState({...s.yJ(),filter:t}),n.bE(e,{tab:t})}function r(e){o.ZP.setState({...s.yJ(),width:e})}},24764:(e,t,i)=>{i.d(t,{t0:()=>w,Zk:()=>b,CA:()=>x});i(67294);var n=i(92996),s=i(98519),o=i(97880),a=i(9291),r=i(62967),d=i(57883),l=i(19719),c=i(9953),u=i(82530);function p(e){const{environment:t,key:i,selectedKey:n,following:s,followSettings:o,navigableBlockId:a,userId:r,spaceId:p,from:g}=e;u.createAndCommit({userAction:"UpdateSidebarFollowControl.setFollowing",environment:e.environment,canUndo:!1,perform:t=>{c.Ue({environment:e.environment,table:d.t0,args:{following:s,followSettings:o,navigableBlockId:a,userId:r,spaceId:p},inMemoryRecordCache:e.environment.defaultRecordCache.inMemoryRecordCache,transaction:t})}}),s?l.RJ(t,{from:"page_updates"}):l.ub(t,{from:"page_updates"}),n!==i&&l.kL(t,{from:g,navigableBlockId:a,oldSetting:n,newSetting:i})}var g=i(64964),m=i(93405),h=i(64369),f=i(80444),y=i(57538),v=i(85893);function x(e){const{followSettingsKey:t,environment:i,blockStore:s,from:o}=e,r=S({key:"none",selectedKey:t,title:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.repliesAndMentions.label",defaultMessage:"Replies and @mentions"}),environment:i,blockStore:s,from:o}),d=S({key:"comments",selectedKey:t,title:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.allComments.label",defaultMessage:"All comments"}),environment:i,blockStore:s,from:o}),l=S({key:"all",selectedKey:t,title:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.allUpdates.label",defaultMessage:"All updates"}),caption:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.simpleAllUpdates.caption",defaultMessage:"All comments and property changes"}),environment:i,blockStore:s,from:o}),c=s.getAssociatedCollectionStore();if(!c)return[d,r];const u=c.getDatabaseType();if(u===n.iS){return[l,S({key:"important",selectedKey:t,title:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.importantUpdatesTasks.label",defaultMessage:"Important updates"}),caption:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.importantUpdatesTasks.caption",defaultMessage:"All comments and changes to Status, Assignee, or Due Date"}),environment:i,blockStore:s,from:o}),r]}if(u===n.wW){return[l,S({key:"important",selectedKey:t,title:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.importantUpdatesProjects.label",defaultMessage:"Important updates"}),caption:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.importantUpdatesProjects.caption",defaultMessage:"All comments and changes to Status or Date"}),environment:i,blockStore:s,from:o}),r]}return[l,S({key:"comments",selectedKey:t,title:(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.onlyCommentsAllComments.label",defaultMessage:"All comments"}),environment:i,blockStore:s,from:o}),r]}function b(e){const{followSettingsKey:t,environment:i,blockStore:n,from:s}=e;return[S({key:"important",selectedKey:t,title:(0,v.jsx)(a.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.allComments.label",defaultMessage:"All comments"}),caption:(0,v.jsx)(a.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.allComments.caption",defaultMessage:"Notified of all comments and @mentions"}),environment:i,blockStore:n,from:s}),S({key:"none",selectedKey:t,title:(0,v.jsx)(a.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.mentionsAndReplies.label",defaultMessage:"Replies and @mentions"}),caption:(0,v.jsx)(a.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.mentionsAndReplies.caption",defaultMessage:"Notified of comment replies and @mentions"}),environment:i,blockStore:n,from:s})]}function S(e){const{key:t,title:i,caption:n,selectedKey:o,environment:a,blockStore:d,from:l}=e,c=w({key:t,userSelectedKey:o}),u={icon:{width:14,height:14},rightWrapper:n?{alignSelf:"flex-start",paddingTop:2}:{}};return{action:(0,r.cN)({key:t,displayName:void 0,analyticsName:t,validators:[],closeParentMenu:!0,action:()=>{const{currentUserRootStore:e}=f.default.state;if(e){const{following:i,followSettings:n}=(0,y.Z)(t),s=e.id,r=d.id,c=d.getSpaceId();p({environment:a,following:i,followSettings:n,navigableBlockId:r,spaceId:c,userId:s,from:l,key:t,selectedKey:o}),"inbox"!==l&&"more_menu"!==l||g.d4({item:{label:M(t)},undoFunc:()=>{const{following:e,followSettings:i}=(0,y.Z)(o);p({environment:a,following:e,followSettings:i,navigableBlockId:r,spaceId:c,userId:s,from:l,key:t,selectedKey:o})}})}},render:e=>(0,v.jsx)(m.Z,{...e,title:(0,v.jsx)(h.Z,{children:i}),caption:n,shouldWrapCaption:!0,right:c?(0,s.k)(u.icon):(0,v.jsx)("div",{style:u.icon}),rightStyle:u.right})}),title:i,isSelectedOption:c}}function w(e){const{key:t,userSelectedKey:i}=e;return"important"===i||"comments"===i?"important"===t||"comments"===t:t===i}function M(e){switch(e){case"none":return(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.subscribedRepliesAndMentionsSuccess.snackbarMessage",defaultMessage:"Subscribed to replies and @mentions"});case"comments":return(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.subscribedAllCommentsSuccess.snackbarMessage",defaultMessage:"Subscribed to all comments"});case"important":return(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.subscribedImportantUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to important updates"});case"all":return(0,v.jsx)(a.FormattedMessage,{id:"GetNotifiedDropdown.subscribedAllUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to all updates"});default:(0,o.t1)(e)}}},45428:(e,t,i)=>{i.r(t),i.d(t,{getNotificationValues:()=>l,getState:()=>d,setState:()=>r});var n=i(70921),s=i(65311),o=i(80444);let a={};function r(e){a={...a,...e}}function d(){return a}function l(){const e=a.result;if(!e)return null;const t=o.default.state.currentSpaceStore;return t?e.map((e=>{const i={table:s.uX,id:e,spaceId:t.getSpaceId()},o=t.getRecordValue(i),a=null==o?void 0:o.activity_id;if(a&&o){const e={table:n.TY,id:a,spaceId:t.getSpaceId()};o.activity=t.getRecordValue(e)}return o})):null}},70564:(e,t,i)=>{i.d(t,{B:()=>o,L:()=>a});var n=i(18245);const s={};function o(e,t){e in s||(s[e]={measured:!1,startTime:performance.now(),size:t.size,type:t.type})}function a(e,t){if(!(e in s))return;const i=s[e];if(i.measured)return;i.measured=!0;const{startTime:o,size:a,type:r}=i;n.default.measure({metricName:"notification_render",startTime:o},{environment:t,data:{size:a,type:r}})}},84178:(e,t,i)=>{i.r(t),i.d(t,{GetNotifiedFor:()=>C,MobileInboxPopup:()=>bi,NotificationInboxPanel:()=>oi,TopbarUpdatesMenu:()=>B,UpdateSidebar:()=>ot});var n=i(67294),s=i(86628),o=i(24405),a=i(82990),r=i(9291),d=i(480),l=i(90792),c=i(42853),u=i(62967),p=i(19719),g=i(48019),m=i(31945),h=i(78140),f=i(89728),y=i(72495),v=i(87279),x=i(98742),b=i(77080),S=i(24764),w=i(57538),M=i(85893);function j(e){var t;window.__c={n:"GetNotifiedDropdown"};const{blockStore:i,from:r,buttonPopupStore:j}=e,C=e.moreProminentStyling??!1,k=(0,d.O7)(),I=(0,s.VK)((()=>i.isPageBlock()),[i]),T=(0,s.VK)((()=>i.getFollowSettingsKey()),[i]),Z=(0,n.useCallback)((()=>p.Z8({environment:k,pageId:i.pointer.id,isCurrentlyFollowing:(0,w.Z)(T).following,from:"page_updates"===r?"page_updates":void 0})),[i.pointer.id,k,T,r]),A=(0,s.VK)((()=>b.default.checkGate("property_updates_notifications")?S.CA({followSettingsKey:T,environment:k,blockStore:i,from:r}):S.Zk({followSettingsKey:T,environment:k,blockStore:i,from:r})),[T,k,i,r]),_=(0,o.yK)((e=>({buttonContainer:{display:"flex",alignItems:"center",color:e.mediumTextColor,padding:C?"4px 10px":4,borderRadius:4,marginRight:C?0:4,fontSize:a.Z.fontSize.UIRegular.desktop},bellIcon:{width:14,height:14,marginRight:4},chevronIcon:{marginLeft:4,width:10,height:10},spacer:{flexGrow:1},footerLabel:{padding:12,backgroundColor:e.sidebarSecondaryBackground,boxShadow:`0 -1px 0 ${e.regularDividerColor}`,marginTop:1}})),[C]),F=null===(t=A.find((e=>S.t0({key:e.action.analyticsName,userSelectedKey:T}))))||void 0===t?void 0:t.title;return I?(0,M.jsx)(m.ZP,{popupType:m.Z4.Popup,alignmentToOrigin:m.vR.End,placementToOrigin:m.pO.Bottom,sameWidthAsOrigin:C,buttonPopupStore:j,render:e=>(0,M.jsx)(h.Z,{menuType:v.og.Popup,minWidth:290,maxHeight:"50vh",children:(0,M.jsx)(g.Z,{context:{blocks:[],environment:k,publicEditMode:void 0},sections:[(0,u.$J)({key:"in-app-notifications-section",render:e=>(0,M.jsx)(y.Z,{...e}),actions:A.map((e=>e.action))})],initialFocus:void 0,onAccept:()=>e.close()})}),renderOrigin:e=>(0,M.jsxs)(f.Z,{...(0,x.Z)(e,{onClick:Z}),style:_.buttonContainer,children:[(0,l.t)(_.bellIcon),F,C&&(0,M.jsx)("div",{style:_.spacer}),(0,c.i)(_.chevronIcon)]})}):null}function C(e){window.__c={n:"GetNotifiedFor"};const{navigableBlock:t,from:i,buttonPopupStore:n}=e,d=(0,s.VK)((()=>t.isPageBlock()),[t]),l=(0,o.yK)((e=>({label:{fontSize:a.Z.fontSize.UIRegular.desktop,color:e.regularTextColor,fontWeight:a.Z.fontWeight.medium},border:{border:`1px solid ${e.outlineButtonBorder}`,borderRadius:4,marginTop:8}})),[]);return d?(0,M.jsxs)("div",{children:[(0,M.jsx)("div",{style:l.label,children:(0,M.jsx)(r.FormattedMessage,{id:"UpdateSidebarTabUpdatesHeader.pageNotificationSettings.label",defaultMessage:"Page notification settings"})}),(0,M.jsx)("div",{style:l.border,children:(0,M.jsx)(j,{blockStore:t,moreProminentStyling:!0,from:i,buttonPopupStore:n})})]}):null}var k=i(84708),I=i(80503),T=i(43250),Z=i(36391),A=i(81258);const _=new(i(61766).Z);var F=i(66957);function P(){return(0,M.jsx)(r.FormattedMessage,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}function R(e){window.__c={n:"UpdateSidebarTabUpdatesHeader"};const t=(0,d.O7)(),{enablePageAnalytics:i,popOutMode:n,navigableBlock:l,inPeekView:c}=e,u=(0,o.yK)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:n?0:I.R6(t.device.isElectronMac),paddingTop:4,width:n&&!c?"calc(100% - 2px)":"100%",background:c?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},getNotifiedFor:{marginTop:2,marginBottom:14},label:{fontSize:14,color:e.regularTextColor,fontWeight:a.Z.fontWeight.medium}})),[n,t,c]),p=(0,s.VK)((()=>Z.ZP.state.currentSubTab),[]),g=c?_:A.Z;return(0,M.jsxs)("div",{style:{...u.updatesHeaderStyle,...i?{padding:"0 6px"}:{}},className:T.cFM,children:[(0,M.jsx)("div",{style:u.getNotifiedFor,children:(0,M.jsx)(C,{navigableBlock:l,from:"page_updates",buttonPopupStore:g})}),i?(0,M.jsx)(F.Z,{tabs:[(0,M.jsx)(P,{},"updates"),(0,M.jsx)(r.FormattedMessage,{id:"updateSidebar.header.analyticsLabel",defaultMessage:"Analytics"},"analytics")],selectedIndex:p,onChange:e.onTabChange,style:{...u.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"}}):(0,M.jsx)("div",{style:u.label,children:(0,M.jsx)(P,{})})]})}function B(e){window.__c={n:"TopbarUpdatesMenu"};const{blockStore:t,spaceStore:i}=e,n=function(e){const{spaceStore:t,blockStore:i}=e,n=(0,s.VK)((()=>{var e,t;return(null==i||null===(e=i.getModel())||void 0===e?void 0:e.isCollectionView())?null===(t=i.getCollectionPointer())||void 0===t?void 0:t.id:void 0}),[i]);if(!t)return;const o=i.id,a=t.id;return{navigableBlockId:o,collectionId:n,spaceId:a}}({blockStore:t,spaceStore:i});return n?(0,M.jsx)(h.Z,{menuType:v.og.Popup,className:T.KLh,header:(0,M.jsx)(R,{navigableBlock:t,enablePageAnalytics:!1,popOutMode:!0,inPeekView:!0}),children:(0,M.jsx)(k.Z,{empty:()=>(0,M.jsx)(U,{}),source:"updates_sidebar",navigableBlock:t,...n},t.id)}):null}function U(){window.__c={n:"EmptyState"};const e=(0,o.yK)((e=>({container:{marginTop:64,textAlign:"center",paddingLeft:18,paddingRight:18,marginBottom:64},content:{fontSize:14,color:e.mediumTextColor,marginTop:4}})),[]);return(0,M.jsx)("div",{style:e.container,children:(0,M.jsx)("div",{style:e.content,children:(0,M.jsx)("span",{children:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"No edits in this page yet.",id:"topbar.updatesButton.emptyState"})})})})}var L=i(74725),N=i(92996),O=i(70475),D=i(97880),E=i(51454),K=i(50906),V=i(23063),z=i(13630),H=i(77907);const W=(0,H.lazyComponent)(H.deps.UpdateSidebarTabAiContext,(e=>e.default));var q=i(34541),Y=i(55064),G=i(70268),$=i(35767),X=(i(21703),i(30120)),J=i(45010),Q=i(24646),ee=i(34859),te=i(80444),ie=i(53336),ne=i(30251),se=i(13991),oe=i(7057),ae=i(53877),re=i(83176),de=i(82855),le=i(16880),ce=i(84169),ue=i(18442),pe=i(72126),ge=i(38737),me=i(54368),he=i(77420),fe=i(19889),ye=i(62965),ve=i(16287),xe=i(54642),be=i(25320),Se=i(83420),we=i(20095),Me=i(65598),je=i(18514),Ce=i(35314),ke=i(44904),Ie=i(26136),Te=i(88893),Ze=i(73420),Ae=i(68785),_e=i(63296),Fe=i(70301),Pe=i(64369),Re=i(45653),Be=i(67579),Ue=i(48603);const Le=Date.now();function Ne(e){let{store:t,spaceId:i,isDisabledForWorkspace:a}=e;window.__c={n:"PageAnalytics"};const[l,c]=(0,n.useState)("last_28_days"),[u,p]=(0,n.useState)({state:a?"disabled-for-workspace":"loading"}),g=(0,d.O7)(),f=(0,o.Fg)(),y=(0,s.VK)((()=>{const{currentSpaceStore:e}=te.default.state;return null==e?void 0:e.getName()}),[]),x=(0,s.VK)((()=>{switch(l){case"last_7_days":return 7;case"last_28_days":return 28;case"last_90_days":return 90;case"all_time":return}}),[l]);(0,n.useEffect)((()=>{a||async function(){const e=await xe.getPageAnalytics(g,{pageId:t.id,spaceId:i,days:x});if("failed"===e.type)return void p({state:"empty"});const n=e.data.map((e=>{let{ds:t,total_views:i,unique_views:n}=e;return{ds:t,values:{total_views:i,unique_views:n}}}));n.filter((e=>{let{ds:t}=e;return ae.OQ.isoToUnixMs(t,"UTC")??Le<=Le})).every((e=>{let{values:t}=e;return 0===t.total_views}))?p({state:"empty"}):p({state:"loaded",data:n})}()}),[g,t.id,a,i,x]);const b=(0,o.yK)((e=>({fullHeight:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},spinner:{width:32,height:32}})),[]);return"loading"===u.state?(0,M.jsx)("div",{style:b.fullHeight,children:(0,M.jsx)(Ae.Z,{style:b.spinner})}):"empty"===u.state?(0,M.jsx)("div",{style:b.fullHeight,children:(0,M.jsx)(Ye,{heading:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.empty.heading",defaultMessage:"No page analytics yet"}),description:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.empty.description",defaultMessage:"It may take some time for page view information to appear."})})}):"disabled-for-workspace"===u.state?(0,M.jsx)("div",{style:b.fullHeight,children:(0,M.jsx)(Ye,{heading:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.disabled.heading",defaultMessage:"Page viewership tracking is disabled"}),description:(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[y?(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.disabled.description",defaultMessage:"Page viewership and analytics is turned off for all pages in {name}",values:{name:y}}):(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.disabled.description.unnamed",defaultMessage:"Page viewership and analytics is turned off for all pages in your space"}),(0,M.jsxs)("a",{href:(0,je.UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:f.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,ce.m)({width:14,height:14}),(0,M.jsx)(Pe.Z,{isSmall:!0,children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.disabled.learnMore",defaultMessage:"Learn more"})})]})]})})}):(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},children:[(0,M.jsxs)(Ze.sg,{grow:1,gap:16,children:[(0,M.jsx)(De,{store:t,data:u.data,currentFilter:l,onChangeFilter:c}),(0,M.jsx)(Ke,{store:t}),(0,M.jsx)(qe,{spaceId:i,store:t})]}),(0,M.jsxs)("div",{style:{borderTop:`1px solid ${f.regularDividerColor}`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,M.jsx)(m.ZP,{renderOrigin:e=>{let{onClick:t}=e;return(0,M.jsx)(_e.Z,{onClick:t,icon:ue.H,children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.timeseries.settings",defaultMessage:"Settings"})})},popupType:g.device.isMobile?m.Z4.SlideUp:m.Z4.Popup,render:()=>(0,M.jsx)(h.Z,{menuType:v.og.Popup,width:460,children:(0,M.jsx)("div",{style:Oe,children:(0,M.jsx)(Ue.PageAnalyticsPageOptOut,{store:t})})})}),(0,M.jsxs)("a",{href:(0,je.UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:f.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,ce.m)({width:14,height:14}),(0,M.jsx)(Pe.Z,{isSmall:!0,children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.timeseries.learnMore",defaultMessage:"Learn more"})})]})]})]})}const Oe={margin:"8px 16px",pointerEvents:"auto",cursor:"default"};function De(e){window.__c={n:"PageAnalyticsGraph"};const[t,i]=(0,Ce.e)(),{blueLayer:s,yellowLayer:o}=(0,ne.useTimeSeriesPalette)(),a=(0,n.useMemo)((()=>{if(0===e.data.length)return Le;const t=ae.OQ.isoToUnixMs(e.data[0].ds,"UTC")??Le;return Math.min(t,Le)}),[e.data]);return(0,M.jsxs)("div",{children:[(0,M.jsx)(Ee,{store:e.store,data:e.data,currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter}),(0,M.jsx)("div",{ref:t,style:{...Oe,marginBottom:0},children:(0,M.jsx)(H.LazyTimeSeries,{startDate:(0,oe.$6)(a,!0),endDate:(0,oe.$6)(Le,!0),width:i,height:175,data:e.data,layers:[{key:"total_views",...s,renderLabel:e=>(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.timeseries.total_views",defaultMessage:"{views, plural, one {1 total view} other {{views} total views}}",values:{views:e}})},{key:"unique_views",...o,renderLabel:e=>(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.timeseries.unique_views",defaultMessage:"{uniqueViews, plural, one {1 unique view} other {{uniqueViews} unique views}}",values:{uniqueViews:e}})}]})})]})}function Ee(e){window.__c={n:"PageAnalyticsHeader"};const t=(0,r.useIntl)(),i=(0,n.useMemo)((()=>e.data.reduce(((e,t)=>{let{values:i}=t;return e+i.total_views}),0)),[e.data]);return(0,M.jsx)("div",{style:{margin:"14px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,M.jsxs)(Ze.X2,{justifyContent:"space-between",alignItems:"center",grow:1,children:[(0,M.jsxs)(Ze.X2,{gap:4,children:[(0,M.jsx)(Pe.Z,{style:{fontWeight:500},children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.timeseries.title",defaultMessage:"Views"})}),(0,M.jsx)(Pe.Z,{isSecondaryColor:!0,children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.timeseries.totalViews",defaultMessage:"({totalViews} total)",values:{totalViews:(0,ge.uf)(i,"number_with_commas",t)}})})]}),(0,M.jsx)(Be.f,{currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter})]})})}function Ke(e){window.__c={n:"PageAnalyticsViewers"};const{store:t}=e,{pageVisitStore:i,presenceStore:o}=(0,s.Kw)(te.default),a=(0,d.O7)();(0,n.useEffect)((()=>{be.Ri(a,{block:t,pageVisitStore:i,incremental:!1,limit:be.s4})}),[a,t,i]);const l=(0,s.VK)((()=>(0,we.AQ)(i,o)),[i,o]);if(0===l.length)return null;const c=l.map((e=>{let{userId:i,activityTimestampNearestMinuteMs:n}=e;return{actorStore:Ie.U6.createChildStore(t,{id:i,table:fe.KJ}),timestamp:n}}));return(0,M.jsxs)("div",{style:{...Oe,display:"flex",flexDirection:"column",gap:12},children:[(0,M.jsx)(Pe.Z,{style:{fontWeight:500},children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.viewers.title",defaultMessage:"Viewers"})}),(0,M.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:(0,M.jsx)(Ve,{store:t,actorStores:c,collapsedLabel:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.viewers.expand",defaultMessage:"Show more viewers"}),expandedLabel:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.viewers.collapse",defaultMessage:"Show less viewers"})})})]})}function Ve(e){window.__c={n:"PageAnalyticsActorList"};const{store:t,actorStores:i,collapsedLabel:s,expandedLabel:o}=e,[a,r]=(0,n.useState)(!0),d=a?i.slice(0,5):i;return(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[d.map((e=>{let{actorStore:i,timestamp:n}=e;return(0,M.jsx)(ze,{store:t,actorStore:i,timestamp:n},i.id)})),i.length>5&&(0,M.jsx)("button",{onClick:e=>{e.preventDefault(),r(!a)},style:{background:"none",border:"none",textAlign:"left",padding:0,marginTop:4},children:(0,M.jsxs)(Pe.Z,{isSecondaryColor:!0,isSmall:!0,style:{display:"flex",gap:3,alignItems:"center"},children:[a?s:o,a?(0,de.E)({width:12}):(0,le.R)({width:12})]})},"toggle")]})}function ze(e){window.__c={n:"PageAnalyticsActor"};const{actorStore:t,timestamp:i}=e,o=(0,r.useIntl)(),a=(0,n.useMemo)((()=>{const e=Date.now();return(0,oe.tv)(Math.min(i??e,e),se.SP)}),[i]),d=(0,s.VK)((()=>t.getDisplayName(o)),[t,o]);return(0,M.jsxs)(Ze.X2,{alignItems:"center",justifyContent:"space-between",children:[(0,M.jsxs)(Ze.X2,{gap:4,children:[(0,M.jsx)(He,{actorStore:t}),(0,M.jsx)(Pe.Z,{style:{fontWeight:500},children:d})]}),(0,M.jsx)(Pe.Z,{isSecondaryColor:!0,children:i?(0,M.jsx)("span",{title:(0,oe.Yx)(i,"medium_with_time",se.SP),children:a}):a})]})}function He(e){const{actorStore:t}=e;return t.table===he.cZ?(0,M.jsx)(Fe.Z,{botStore:t,size:18}):t.table===fe.KJ?(0,M.jsx)(Re.Z,{userStore:t,size:18}):t.table===me.y?(0,M.jsx)(Re.Z,{userStore:void 0,size:18}):void(0,D.t1)(t)}function We(e){const{environment:t,store:i,spaceId:o,hasAccessToEditors:a}=e,[,,r]=(0,s.AF)(void 0,ke.o),[d,l]=(0,n.useState)([]);(0,n.useEffect)((()=>{a&&ve.h(t,{store:r,activityIds:d,spaceId:o,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0},navigableBlockId:i.id})}),[d,r,o,i.id,t,a]);return(0,s.VK)((()=>{if(!a)return[];const e=r.state.activityIds;(0,ye.Z)(d,e)||l(e);const{currentSpaceStore:t}=te.default.state;if(!t)return[];const n=d.map((e=>(0,Me.No)(t,e,t.id))).flatMap((e=>{const t=e.getValue();return t?"top-level-block-created"!==t.type&&"top-level-block-deleted"!==t.type&&"block-edited"!==t.type?[]:function(e,t){var i;return pe.oA(null===(i=e.edits)||void 0===i?void 0:i.flatMap((e=>{var i;return null===(i=e.authors)||void 0===i?void 0:i.map((i=>({actorStore:(0,Se.nc)({parentStore:t,pointer:i}),timestamp:e.timestamp})))})))}(t,i):[]})),s=pe.MR(n,"timestamp").reverse();return pe.mN(s,"userId")}),[d,r,a,i])}function qe(e){window.__c={n:"PageAnalyticsEditors"};const{spaceId:t,store:i}=e,n=(0,d.O7)(),o=(0,s.VK)((()=>(0,Te.qb)(n,"business")||(0,Te.qb)(n,"enterprise")),[n]),a=We({environment:n,hasAccessToEditors:o,spaceId:t,store:i}),l=(0,s.VK)((()=>{const e=i.getCreatedByPointer(),t=i.getCreatedTime();if(e&&t)return{actorStore:(0,Se.nc)({parentStore:i,pointer:e}),createdTime:t}}),[i]);return(0,M.jsxs)("div",{style:{...Oe,display:"flex",flexDirection:"column",gap:12},children:[(0,M.jsx)(Pe.Z,{style:{fontWeight:500},children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.editors.title",defaultMessage:"Editors"})}),l&&(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,marginBottom:6},children:[(0,M.jsx)(Pe.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.editors.createdBy",defaultMessage:"Created by"})}),(0,M.jsx)(ze,{store:i,actorStore:l.actorStore,timestamp:l.createdTime})]}),o&&a.length>0&&(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,M.jsx)(Pe.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.editors.editedBy",defaultMessage:"Recently edited by"})}),(0,M.jsx)(Ve,{actorStores:a,store:i,collapsedLabel:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.editors.expand",defaultMessage:"Show more editors"}),expandedLabel:(0,M.jsx)(r.FormattedMessage,{id:"page_analytics.editors.collapse",defaultMessage:"Show less editors"})})]})]})}function Ye(e){window.__c={n:"PageAnalyticsEmptyState"};const t=(0,o.yK)((e=>({column:{display:"flex",flexDirection:"column"},row:{display:"flex"},centered:{textAlign:"center",alignItems:"center",width:250},analyticsIcon:{position:"relative",top:-8,left:-4},secondaryIcon:{fill:e.mediumTextColor},settingsButton:{padding:"7.5px 10px",alignSelf:"center"},link:{cursor:"pointer",justifyContent:"center",alignItems:"center",padding:8,alignSelf:"center"}})),[]);return(0,M.jsx)("div",{style:{...t.column,gap:24},children:(0,M.jsxs)("div",{style:{...t.column,...t.centered,gap:4},children:[(0,re.z)({...t.secondaryIcon,...t.analyticsIcon,width:62,height:62}),(0,M.jsx)(Pe.Z,{isSecondaryColor:!0,style:{fontSize:16,fontWeight:500},children:e.heading}),(0,M.jsx)(Pe.Z,{isSecondaryColor:!0,style:{whiteSpace:"normal",overflow:"visible"},children:e.description})]})})}function Ge(e){let{enablePageAnalytics:t}=e;window.__c={n:"UpdateSidebarTabUpdates"};const i=(0,s.VK)((()=>te.default.state.mainEditorCurrentBlockStore),[]),n=(0,s.VK)((()=>{const e=X.ou.now().minus({years:1}).valueOf();return!!i&&i.getCreatedTime()<e}),[i]),a=(0,s.VK)((()=>te.default.state.currentSpaceStore),[]),l=(0,s.VK)((()=>!(null!=i&&i.canRead())),[i]),c=(0,d.O7)(),u=(0,s.VK)((()=>(0,Q._c)(c)),[c]),p=(0,s.VK)((()=>{var e;const t=null==i?void 0:i.getModel();return i&&null!=t&&t.isCollectionView()?null===(e=i.getCollectionPointer())||void 0===e?void 0:e.id:void 0}),[i]),g=(0,s.VK)((()=>Boolean(null==a?void 0:a.getSettings().disable_page_analytics)),[a]),m=(0,o.yK)((e=>({updatesEmptyStyle:{flex:1,display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,background:e.contentBackground,marginRight:u?2:0,pointerEvents:"auto",height:"100%"},updatesNotEmptyStyle:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:u?2:0,pointerEvents:"auto",marginTop:1,height:"100%"}})),[u]),h=(0,s.VK)((()=>Z.ZP.state.currentSubTab),[]);if(l)return(0,M.jsx)(ie.Z,{type:ee.Z.Y,style:m.updatesEmptyStyle,children:(0,M.jsx)("div",{style:{width:200,alignSelf:"center"},children:(0,M.jsx)(r.FormattedMessage,{id:"updateSidebar.commentContainer.restricted",defaultMessage:"You don't have permission to view the updates of this restricted page."})})});if(a&&i)return(0,M.jsxs)(ie.Z,{type:ee.Z.Y,ref:e=>{J.Z.UpdateSidebarScroller=e},style:m.updatesNotEmptyStyle,children:[t&&(0,M.jsx)("div",{style:{display:h===Z.uF.Analytics?"block":"none",height:"100%"},children:(0,M.jsx)(Ne,{spaceId:a.id,store:i,isDisabledForWorkspace:g})}),(0,M.jsx)("div",{style:{display:h===Z.uF.Updates?"block":"none"},children:(0,M.jsx)(k.Z,{collectionId:p,navigableBlock:i,spaceId:a.id,source:"updates_sidebar",empty:e=>(0,M.jsx)(ie.Z,{type:ee.Z.Y,style:m.updatesEmptyStyle,ref:e=>{J.Z.UpdateSidebarScroller=e},children:(0,M.jsx)("div",{style:{width:200,alignSelf:"center"},children:e.hasFiltersOn?(0,M.jsx)(r.FormattedMessage,{id:"updateSidebar.updatesContainer.emptyAfterSearch",defaultMessage:"No updates match the requested filters."}):n?(0,M.jsx)(r.FormattedMessage,{id:"updateSidebar.updatesContainer.emptyMaybePurged",defaultMessage:"There are no recent updates on this page. Page updates are retained for one year."}):(0,M.jsx)(r.FormattedMessage,{id:"updateSidebar.updatesContainer.empty",defaultMessage:"No updates on this page yet."})})})},i.id)})]});throw new Error("Loaded sidebar without AppStore initialized.")}var $e=i(38755),Xe=i(74948),Je=i(33784),Qe=i(38302),et=i(88923);function tt(e){window.__c={n:"UpdateSidebarContent"};const{currentTab:t}=e,i=(0,s.VK)((()=>te.default.state.mainEditorCurrentBlockStore),[]),o=(0,s.VK)((()=>te.default.state.currentSpaceStore),[]),a=(0,s.VK)((()=>te.default.state.renderPhase),[]),[r,d]=(0,n.useState)(!1),l=(0,n.useMemo)((()=>(new Date).getTime()),[]),c=(0,s.VK)((()=>{var e,t;if(!i)return null;return Boolean(b.default.checkGate("enable_transcript_tab")&&(null===(e=i.getCollectionStore())||void 0===e?void 0:e.getDatabaseType())===N.Fi&&(null===(t=i.getFormatStore().getKeyStore("content_tabs"))||void 0===t?void 0:t[O.Z]))?z.Tf.pageInfoLayoutSchema:z.bl.pageInfoLayoutSchema}),[i]);if((0,n.useEffect)((()=>{r||"rendered"!==a||d(!0)}),[null==i?void 0:i.id,r,a]),!i||!o||!r)return(0,M.jsx)(G.B,{areaHeight:window.innerHeight});switch(t){case Z.gY.Comments:return(0,M.jsx)($.J,{timeMounted:l,location:"sidebar"});case Z.gY.Updates:return(0,M.jsx)(Ge,{enablePageAnalytics:e.enablePageAnalytics});case Z.gY.AiContext:return(0,M.jsx)(W,{});case Z.gY.Info:return(0,M.jsx)(H.LazyUpdateSidebarTabInfo,{infoLayoutSchema:c});default:(0,D.t1)(t)}}function it(e){window.__c={n:"UpdateSidebar"};const t=(0,s.VK)((()=>({width:Z.ZP.state.width,isAnimating:Z.ZP.state.isAnimating})),[]),i=(0,d.O7)(),{shouldLoadSidebarComponents:a,isExpanded:r,popOutMode:l,closeSidebar:c}=e,u=(0,s.VK)((()=>r&&l&&!Qe.Z.state.isOpen&&!Je.Z.state.open),[r,l]),p=(0,n.useRef)(null),g=(0,n.useMemo)((()=>[`.${T.zar}`,`.${T.hzx}`,`.${T.G6g}`,`.${T.K3y}`,`.${T.p0b}`,`.${T.mJW}`]),[]);(0,L.O)({active:u,closeHandler:c,ref:p,excludedSelectors:g});const m=I.R6(i.device.isElectronMac),h=(0,o.yK)((e=>({container:{flexGrow:0,flexShrink:0,zIndex:E.XB,borderLeft:(l?"unset":!r&&"1px solid rgba(0,0,0,0)")||`1px solid ${e.regularDividerColor}`,alignSelf:"flex-end",position:"absolute",right:0,top:0,height:"100vh",pointerEvents:"none"},popOutContainer:{boxShadow:e.mediumBoxShadow,background:e.popoverBackground,borderRadius:4,border:r?`1px solid ${e.regularDividerColor}`:void 0,height:`calc(100% - 20px - ${m}px)`,marginTop:m+10,marginRight:r?10:0},wrap:{height:"100%"},content:{position:"absolute",top:0,bottom:0,display:r?"flex":"none",flexDirection:"column",overflow:"visible",zIndex:E.XB,width:t.width}})),[t.width,m,l,r]);return a?(0,M.jsx)("aside",{"aria-hidden":!r||void 0,ref:p,style:{...h.container,...l?h.popOutContainer:{}},onMouseMove:()=>{t.isAnimating||Z.ZP.setState({...Z.ZP.state,mouseEntered:!0})},onMouseLeave:()=>{t.isAnimating||Z.ZP.setState({...Z.ZP.state,mouseEntered:!1})},children:(0,M.jsx)("div",{style:h.wrap,children:(0,M.jsx)("div",{style:h.content,children:(0,M.jsx)(st,{...e})})})}):null}function nt(e){let{enablePageAnalytics:t,navigableBlock:i,onTabChange:n}=e;window.__c={n:"SidebarHeader"};const a=(0,d.O7)(),{popOutMode:r}=(0,s.VK)((()=>({popOutMode:(0,Q._c)(a)})),[a]),l=(0,s.VK)((()=>Z.ZP.state.currentTab),[]),c=(0,o.yK)((()=>({commentsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:r?0:I.R6(a.device.isElectronMac)}})),[a,r]);switch(l){case Z.gY.Comments:return(0,M.jsx)("div",{style:c.commentsHeaderStyle});case Z.gY.Updates:return(0,M.jsx)(R,{popOutMode:r,navigableBlock:i,enablePageAnalytics:t,onTabChange:n});case Z.gY.AiContext:case Z.gY.Info:return(0,M.jsx)("div",{style:c.commentsHeaderStyle});default:(0,D.t1)(l)}}function st(e){window.__c={n:"SidebarActivityFeed"};const{isResizerHovered:t,isResizing:i,currentTab:a,expanded:r}=(0,s.VK)((()=>{const{isResizerHovered:e,isResizing:t,currentTab:i,expanded:n}=Z.ZP.state;return{isResizerHovered:e,isResizing:t,currentTab:i,expanded:n}}),[]),{currentBlockStore:l}=e,c=(0,d.O7)(),{currentTabToRender:u,popOutMode:p}=(0,s.VK)((()=>({currentTabToRender:l.isCollectionView()&&!l.isCollectionViewPageWithContent()?Z.gY.Updates:a,popOutMode:(0,Q._c)(c)})),[l,a,c]),g=(0,s.VK)((()=>{const{currentSpaceStore:e}=te.default.state;return!(0,$e.Cx)(e)}),[]),m=n.useCallback((e=>{K.Zmw(c,{tab:e===Z.uF.Updates?"updates":"analytics",origin:et.default.state.open?"peek_view":"page"}),Z.ZP.setState({...Z.ZP.state,currentSubTab:e})}),[c]),h=(0,o.yK)((e=>({pane:{display:"flex",flexDirection:"column",height:"100%",position:"relative",pointerEvents:"none",maxHeight:"100%",backgroundColor:a===Z.gY.Comments?void 0:"inherit"},resizerStyle:{position:"absolute",top:0,left:-3,bottom:0,right:0,height:"100vh",width:3,zIndex:-1,display:"block",transition:"box-shadow 300ms ease-in",...(t||i)&&r?{boxShadow:e.sidebarResizerBoxShadow}:{}},controlsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:p?0:I.R6(c.device.isElectronMac),paddingTop:4,width:p?"calc(100% - 2px)":"100%",background:e.contentBackground,borderRadius:4,paddingBottom:1}})),[a,t,i,c,r,p]);return(0,M.jsxs)("div",{style:h.pane,className:T.zar,children:[(0,M.jsx)("div",{style:h.resizerStyle}),(0,M.jsx)(nt,{enablePageAnalytics:g,navigableBlock:l,onTabChange:m}),(0,M.jsx)(tt,{currentTab:u,enablePageAnalytics:g}),r&&(0,M.jsx)(Y.Z,{type:"update"})]})}function ot(e){window.__c={n:"UpdateSidebarAnimatedWrapper"};const{isElectronMac:t,currentBlockStore:i}=e,o=(0,s.VK)((()=>({width:Z.ZP.state.width,isAnimating:Z.ZP.state.isAnimating,canRender:Z.ZP.state.canRender})),[]),a=(0,s.VK)((()=>te.default.state.currentSpaceStore),[]),r=(0,n.useMemo)((()=>null==a?void 0:a.clone()),[a]),l=(0,d.O7)(),c=(0,s.VK)((()=>l.currentUser.isLoggedIn()&&(0,Q.Sx)(l)),[l]),{isExpanded:u,popOutMode:p,closeSidebar:g}=(0,s.VK)((()=>({isExpanded:(0,Q.Sx)(l),popOutMode:(0,Q._c)(l),closeSidebar:()=>Xe.setUpdateExpand({environment:l,isExpanded:!1,from:"close_for_space"})})),[l]),[m,h]=(0,n.useState)(!1),[f,y]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{(void 0===f||f===i.id)&&u&&(h(!0),y(i.id))}),[f,i,u]),o.canRender&&r?(0,M.jsx)(V.Z,{isVisible:!0,useCompositeLayer:!0,animationStyle:{width:c?o.width:0},render:()=>(0,M.jsx)(q.Z,{store:r,droppable:!0,render:()=>(0,M.jsx)(it,{isElectronMac:t,isFullyExpanded:!o.isAnimating,currentBlockStore:i,isExpanded:u,popOutMode:p,closeSidebar:g,shouldLoadSidebarComponents:m})},r.id),onAnimationStart:()=>{Z.ZP.setState({...Z.ZP.state,isAnimating:!0})},onAnimationEnd:()=>{Z.ZP.setState({...Z.ZP.state,isAnimating:!1})}}):null}var at=i(97439),rt=i(6637),dt=i(53392),lt=(i(25651),i(17659)),ct=i(11066),ut=i(73063),pt=i(58261),gt=i(43145),mt=i(26388),ht=i(61208),ft=i(22165),yt=(i(95477),i(41549)),vt=i(24042),xt=i(45325),bt=i(4761),St=i(52867),wt=i(90334),Mt=i(5686),jt=i(52275),Ct=i(32163),kt=i(19034);function It(){window.__c={n:"InboxEllipsisButton"};const e=(0,d.Fy)(),t=(0,r.useIntl)(),i=(0,s.VK)((()=>{const e=yt.Fz(),{currentTab:t,isCurrentTabEmpty:i}=bt.ZP.state;if("all_updates"===e||"archived_only"===e||"mentions"!==t||i)return;const{containsUnreadNotifications:n,containsBothReadAndUnreadNotifications:s}=bt.ZP.state;return{containsUnreadNotifications:n,containsBothReadAndUnreadNotifications:s,showOnlyUnreadNotifications:"unread_only"===e}}),[]),n=(0,o.yK)((()=>({popup:{...e.isMobile&&{borderTopLeftRadius:12,borderTopRightRadius:12,overflow:"hidden"}},ellipsisIcon:{height:16}})),[e]);if(!i)return null;const a=t.formatMessage({defaultMessage:"More actions",id:"inbox.ellipsisButton.tooltip"});return(0,M.jsx)(m.ZP,{style:n.popup,popupType:e.isMobile?m.Z4.SlideUp:m.Z4.Popup,renderOrigin:e=>{let{onClick:i}=e;return(0,M.jsx)(mt.ZP,{renderTooltip:()=>a,placement:mt.ug.Bottom,alignment:mt.v2.Start,delayThreshold:0,originGap:6,render:e=>(0,M.jsx)(ut.Z,{ariaLabel:t.formatMessage(_t.moreActionsButtonAriaLabel),icon:wt.O,iconStyle:n.ellipsisIcon,onClick:i,...e})})},render:e=>(0,M.jsx)(Tt,{...i,closePopup:e.close}),alignmentToOrigin:m.vR.Start,originGap:2})}function Tt(e){window.__c={n:"InboxEllipsisMenu"};const{containsUnreadNotifications:t,containsBothReadAndUnreadNotifications:i,showOnlyUnreadNotifications:s,closePopup:l}=e,c=(0,d.O7)(),u=(0,d.Fy)(),g=(0,n.useCallback)((()=>{p.Xf(c),lt.go(c)}),[c]),m=(0,n.useCallback)((()=>{const e=yt.Fz();let t="none";s||"unread_only"===e?t="unread":i&&(t="read"),p.zD(c,{readFilter:t}),lt.rG(c,"mentions",t)}),[c,i,s]),f=(0,o.yK)((e=>({menuScroller:u.isMobile?{background:e.sidebarBackground}:{},header:u.isMobile?{display:"flex",justifyContent:"center",alignItems:"center",fontSize:16,fontWeight:a.Z.fontWeight.semibold,background:e.sidebarBackground,height:40}:{paddingLeft:16,paddingRight:16,paddingTop:10,fontWeight:a.Z.fontWeight.semibold},sectionMenuItem:u.isMobile?{overflow:"hidden",background:e.buttonBackground,borderRadius:12,marginLeft:16,marginRight:16,marginBottom:16,borderWidth:1,borderStyle:"solid",borderColor:e.stroke.deemphasized,padding:void 0}:{}})),[u]);return(0,M.jsx)(h.Z,{menuType:v.og.Popup,height:u.isMobile?"50vh":void 0,maxWidth:u.isMobile?"100vw":void 0,header:u.isMobile?(0,M.jsx)(Pe.Z,{style:f.header,isSmall:!u.isMobile,isSecondaryColor:!u.isMobile,children:(0,M.jsx)(r.FormattedMessage,{id:"inbox.moreActionsMenu.header",defaultMessage:"Actions"})}):void 0,minWidth:250,scrollerStyle:f.menuScroller,children:(0,M.jsx)(Ct.Z,{type:Ct.i.Vertical,sections:[{key:"inbox global actions",render:e=>(0,M.jsx)(y.Z,{...e,topBorder:0!==e.index,style:f.sectionMenuItem}),items:["markAllAsRead","archiveAll"].map((e=>({key:e,render:n=>"archiveAll"===e?(0,M.jsx)(At,{...n,containsBothReadAndUnreadNotifications:i,showOnlyUnreadNotifications:s}):"markAllAsRead"===e?(0,M.jsx)(Zt,{...n,containsUnreadNotifications:t}):void(0,D.t1)(e),action:()=>{l(),"archiveAll"===e?m():"markAllAsRead"===e?g():(0,D.t1)(e)}})))}],initialFocus:void 0,onAccept:()=>l()})})}const Zt=n.forwardRef(((e,t)=>{window.__c={n:"InboxMarkReadButtonMenuItem"};const{containsUnreadNotifications:i,...n}=e,a=(0,d.Fy)(),l=(0,s.VK)((()=>kt.Z.getUnreadCountForCurrentSpace().mentions>0),[]),c=!(i||l),u=(0,o.yK)((e=>({buttonMenuItem:a.isMobile?{backgroundColor:e.surface.elevated,paddingTop:12,paddingBottom:12,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:e.stroke.deemphasized}:{},title:{fontSize:a.isMobile?16:14},icon:a.isMobile?{width:20,height:20}:{width:16,height:16}})),[a]);return(0,M.jsx)(mt.ZP,{placement:mt.ug.Left,disableTooltip:!c,renderTooltip:()=>(0,M.jsx)(r.FormattedMessage,{defaultMessage:"All notifications have been marked as read.",id:"updatesModal.spaceUpdatesTab.markAllReadButton.disabledTooltip"}),render:e=>(0,M.jsx)(jt.Z,{...(0,x.Z)(n,e),ref:t,icon:(0,Mt.J)(u.icon),title:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"Mark all as read",id:"updatesModal.spaceUpdates.mentionsTab.markAllReadButtonTitle"}),titleStyle:u.title,disabled:c,disabledFeedback:c,style:u.buttonMenuItem})})})),At=n.forwardRef(((e,t)=>{window.__c={n:"InboxArchiveButtonMenuItem"};const{containsBothReadAndUnreadNotifications:i,showOnlyUnreadNotifications:n,...s}=e,a=(0,d.Fy)(),l=(0,o.yK)((e=>({buttonMenuItem:a.isMobile?{backgroundColor:e.surface.elevated,paddingTop:12,paddingBottom:12}:{},title:{fontSize:a.isMobile?16:14},icon:a.isMobile?{width:20,height:20}:{width:16,height:16}})),[a]);return(0,M.jsx)(jt.Z,{...s,ref:t,icon:(0,St.H)(l.icon),title:n?(0,M.jsx)(r.FormattedMessage,{defaultMessage:"Archive unread",id:"updatesModal.spaceUpdatesTab.archiveUnread.tooltip"}):i?(0,M.jsx)(r.FormattedMessage,{defaultMessage:"Archive read",id:"updatesModal.spaceUpdatesTab.archiveRead.tooltip"}):(0,M.jsx)(r.FormattedMessage,{defaultMessage:"Archive all",id:"updatesModal.spaceUpdatesTab.archiveAll.tooltip"}),titleStyle:l.title,style:l.buttonMenuItem})})),_t=(0,r.defineMessages)({moreActionsButtonAriaLabel:{defaultMessage:"More actions",id:"inbox.button.moreActionsButtonAriaLabel"}});var Ft=i(8843),Pt=i(98519),Rt=i(44292),Bt=i(35350);function Ut(e){window.__c={n:"InboxFilterMenu"};const{closePopup:t}=e,i=(0,d.O7)(),l=(0,d.Fy)(),c=(0,s.VK)((()=>yt.Fz()),[]),u=(0,n.useCallback)((e=>Bt.T(i,e)),[i]),p=(0,o.yK)((e=>({menuScroller:l.isMobile?{background:e.sidebarBackground}:{},header:l.isMobile?{display:"flex",justifyContent:"center",alignItems:"center",fontSize:16,fontWeight:a.Z.fontWeight.semibold,background:e.sidebarBackground,height:40}:{paddingLeft:16,paddingRight:16,paddingTop:10,fontWeight:a.Z.fontWeight.semibold},sectionMenuItem:l.isMobile?{overflow:"hidden",background:e.buttonBackground,borderRadius:12,marginLeft:16,marginRight:16,marginBottom:16,borderWidth:1,borderStyle:"solid",borderColor:e.stroke.deemphasized,padding:void 0}:{},buttonMenuItem:l.isMobile?{backgroundColor:e.surface.elevated,paddingTop:12,paddingBottom:12}:{},buttonMenuItemPressed:{background:e.buttonPressedBackground},buttonMenuItemBorder:{borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:e.stroke.deemphasized},title:l.isMobile?{fontSize:16}:{},icon:{...l.isMobile?{height:20,width:20}:{height:16,width:16}}})),[l]),g=[{type:"unread_and_read",title:(0,M.jsx)(r.FormattedMessage,{id:"inboxFilterMenu.readAndUnreadOption.label",defaultMessage:"Unread and read"}),icon:Mt.J},{type:"unread_only",title:(0,M.jsx)(r.FormattedMessage,{id:"inboxFilterMenu.unreadOption.label",defaultMessage:"Unread only"}),icon:Ft.h},{type:"archived_only",title:(0,M.jsx)(r.FormattedMessage,{id:"inboxFilterMenu.archivedOption.label",defaultMessage:"Archived only"}),icon:St.H},{type:"all_updates",title:(0,M.jsx)(r.FormattedMessage,{id:"inboxFilterMenu.allUpdatesOption.label",defaultMessage:"All updates in the workspace"}),icon:Rt.d}];return(0,M.jsx)(h.Z,{menuType:v.og.Popup,height:l.isMobile?"50vh":void 0,minWidth:250,maxWidth:l.isMobile?"100vw":void 0,scrollerStyle:p.menuScroller,header:(0,M.jsx)(Pe.Z,{style:p.header,isSmall:!l.isMobile,isSecondaryColor:!l.isMobile,children:l.isMobile?(0,M.jsx)(r.FormattedMessage,{id:"inbox.filterOptionsMenu.headerMobile",defaultMessage:"Filter"}):(0,M.jsx)(r.FormattedMessage,{id:"inbox.filterOptionsMenu.header",defaultMessage:"Filter options"})}),children:(0,M.jsx)(Ct.Z,{type:Ct.i.Vertical,sections:[{key:"inbox filters",render:e=>(0,M.jsx)(y.Z,{...e,topBorder:0!==e.index,style:p.sectionMenuItem}),items:g.map(((e,i)=>{const n=e.type===c,s=i===g.length-1,o=l.isMobile&&!s;return{key:e.type,render:t=>(0,M.jsx)(jt.Z,{...t,style:{...p.buttonMenuItem,...o&&p.buttonMenuItemBorder},pressedStyle:p.buttonMenuItemPressed,title:e.title,titleStyle:p.title,icon:e.icon(p.icon),right:n?(0,Pt.k)(p.icon):void 0}),action:()=>{u(e.type),t()}}}))}],initialFocus:void 0,onAccept:()=>t()})})}i(57658);var Lt=i(83355),Nt=i(49085),Ot=i(44615),Dt=i(65311),Et=i(63143),Kt=i(82530),Vt=i(56258),zt=i(23586),Ht=i(51811),Wt=i(2688),qt=i(5162),Yt=i(88632),Gt=i(45428),$t=i(70564);class Xt extends Lt.Z{constructor(){super(...arguments),this.storeTypes={size:Nt.default.createClass(20),checkpoint:Nt.default.createClass(Math.random())},this.renderRequest=(e,t,i,n,s)=>{const o=this.renderRequestInner(e,t,i,n);return Gt.setState({request:e,result:i}),(0,M.jsx)(Vt.o,{requestId:s,children:o})},this.renderRequestInner=(e,t,i,n)=>{const s=te.default.state.currentSpaceStore;if(!s||t)return(0,M.jsx)("div",{style:ti(this.props.type,this.environment,this.theme),children:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"})});const o=(0,qt.Y)("supportsNativeHome"),a=o?i??Ht.Tj(e):i;if(o&&i&&Ht.yW(e,i),!a)return(0,M.jsx)("div",{style:ei(this.props.type,this.environment),children:(0,M.jsx)(G.B,{areaHeight:window.innerHeight})});const d=a.map((e=>Ie.t1.createChildStore(s,{table:Dt.uX,id:e}))),l=[],c=pe.oA(d.map((e=>{const t=e.getValue();if(!t)return;if(t.invalid)return;const i=Me.sl(e);if(!i||!i.isReady())return;const n=i.getModel();if(n){if(!n.invalid)return{activity:n,notification:t};l.push(t)}else l.push(t)})));!function(e,t,i){const n=e.filter((e=>!e.read));if(0===n.length)return;Kt.createAndCommit({userAction:"NotificationUpdates.unreadNotificationNotRendered",environment:i,perform:e=>{for(const i of n)lt.$h({notification:i,rootStore:t,transaction:e,read:!0})}})}(l,s,this.environment);const u=this.stores.size.state,p=c.some((e=>{let{notification:t}=e;return!t.read&&!t.visited})),g=p&&c.some((e=>{let{notification:t}=e;return t.read&&!t.visited})),m=yt.H$(c,e.type),h=0===m.size,f=yt.Fz();switch(f){case"unread_and_read":case"unread_only":bt.ZP.setState({...bt.ZP.state,currentTab:"mentions",isCurrentTabEmpty:h,containsBothReadAndUnreadNotifications:g,containsUnreadNotifications:p,showOnlyUnreadNotifications:"unread_only"===f,unreadNotificationIds:[]});break;case"archived_only":bt.ZP.setState({...bt.ZP.state,isCurrentTabEmpty:h,currentTab:"archive"});break;case"all_updates":break;default:(0,D.t1)(f)}return(0,M.jsxs)("div",{style:h?ti(this.props.type,this.environment,this.theme):ei(this.props.type,this.environment),children:[h&&this.props.empty,(0,M.jsx)("section",{role:"feed",className:"notranslate",children:(0,M.jsx)(H.LazyNotificationGroups,{notifications:m,rootStore:s,source:this.props.source,tab:this.props.tab})}),(0,M.jsx)(gt.Z,{onChange:e=>{"closed"!==xt.default.state.openState&&e<200&&a&&a.length>=u&&this.stores.size.setState(a.length+20)},children:!a&&(0,M.jsx)(G.B,{areaHeight:window.innerHeight})})]})},this.handleActivityEmit=(e,t)=>{String(t).includes("unreadCount")||this.stores.checkpoint.setState(Math.random())},this.handleActivityEmitThrottled=pe.P2(this.handleActivityEmit,1e3),this.handleNotificationEmit=Et.YX(this.handleActivityEmitThrottled),this.notificationListenerReference=void 0}UNSAFE_willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return Yt.Z.state.online?this.renderOnline():(0,M.jsx)(ii,{type:this.props.type})}renderOnline(){const{currentUserStore:e,currentSpaceStore:t}=te.default.state;if(!e||!t)return;const i=this.props.type,n=t.id,s=e.id,o=this.stores.size.state,a=this.stores.checkpoint.state,r="unread_only"===yt.Fz();return(0,M.jsx)(zt.Z,{throttle:1e3,request:{spaceId:n,size:o,type:i,showOnlyUnreadNotifications:r,checkpoint:a},performRequest:async e=>{let{spaceId:t,size:i,type:n,showOnlyUnreadNotifications:s}=e;const o=bt.ZP.startLoading();$t.B(o,{size:i,type:n});const a=await xe.getNotificationLogV2(this.environment,{spaceId:t,size:i,type:Qt(n,s)});if(bt.ZP.endLoading(o),"failed"===a.type)throw a.error;return xt.default.setState({...xt.default.state,discussionIdToExpansionStartPointMap:a.data.discussionIdToExpansionStartPointMap}),{notificationIds:a.data.notificationIds,requestId:o}},render:(e,t,o)=>this.renderRequest({spaceId:n,userId:s,type:i},e,null==t?void 0:t.notificationIds,o,null==t?void 0:t.requestId)})}startMessageListeners(){const{currentUserStore:e}=te.default.state;if(e){const t=(0,Ot.Lp)(e.id);this.notificationListenerReference=Wt.Z.addListener(t,this.handleNotificationEmit,void 0,this.environment)}}stopMessageListeners(){this.notificationListenerReference&&(Wt.Z.removeListener(this.notificationListenerReference,this.environment),this.notificationListenerReference=void 0)}}Xt.displayName="NotificationInbox";const Jt=Xt;function Qt(e,t){switch(e){case"mentions":return t?"unread_only":"unread_and_read";case"archive":return"archived";default:(0,D.t1)(e)}}function ei(e,t){const{device:i}=t;return{minHeight:i.isMobile||"mentions"===e?void 0:"75vh"}}function ti(e,t,i){const{device:n}=t;return{...ei(e,t),paddingTop:n.isMobile?64:void 0,minHeight:n.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:i.regularTextColor,overflow:"hidden"}}function ii(e){let{type:t}=e;window.__c={n:"OfflineComponent"};const i=(0,o.Fg)(),n=(0,d.O7)();return(0,M.jsx)("div",{style:ti(t,n,i),children:(0,M.jsx)("div",{children:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"Please go online to view your inbox.",id:"notificationInbox.offline.message"})})})}var ni=i(34700);function si(){window.__c={n:"NotificationInboxPanelDesktopOnlyTopBar"};const e=(0,d.O7)(),t=(0,d.Fy)(),{isElectronMac:i}=t,n=(0,s.VK)((()=>vt.Z.state.isShowingTabBar),[]),a=(0,s.VK)((()=>!n&&!(0,Q.in)(e)&&i),[e,n,i]),r=(0,o.yK)((()=>({container:{...(0,ni.X)({drag:i&&!n}),display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:11,height:I.br,flexShrink:0}})),[i,n]);return a?(0,M.jsx)(V.Z,{animationStyle:{height:a?I.br:0},render:()=>(0,M.jsx)("div",{style:r.container}),isVisible:!0}):null}const oi=n.memo((function(){window.__c={n:"NotificationInboxPanel"};const{openState:e,isOpen:t,isTransitioningOpenState:i}=(0,s.VK)((()=>{const{openState:e}=xt.default.state;return{openState:e,isOpen:xt.default.isOpen(),isTransitioningOpenState:xt.default.isTransitioningOpenState()}}),[]),n=(0,s.VK)((()=>yt.pe()),[]);return(0,M.jsx)(V.Z,{isVisible:!0,useCompositeLayer:!0,animationStyle:{width:t?n:0,translateX:t?0:-n},skipAnimation:!i,onAnimationEnd:()=>{"opening"===e?xt.default.setState({...xt.default.state,openState:"open"}):"closing"===e&&xt.default.setState({...xt.default.state,openState:"closed"})},render:()=>(0,M.jsxs)("div",{style:{position:"relative"},children:[(0,M.jsx)(ai,{}),!1]})})}));function ai(){window.__c={n:"NotificationInboxPanelContent"};const e=(0,d.O7)(),t=(0,d.Fy)(),i=(0,r.useIntl)(),n=(0,s.VK)((()=>{const{currentSpaceStore:e}=te.default.state;if(e)return e.id}),[]),l=(0,s.VK)((()=>xt.default.state.openState),[]),c=(0,s.VK)((()=>xt.default.state.isResizerHovered&&xt.default.isOpen()),[]),u=(0,s.VK)((()=>yt.l5()),[]),p=(0,s.VK)((()=>(0,I.R6)(t.isElectronMac)),[t]),g=(0,o.yK)((e=>{const t={transition:"box-shadow 300ms ease",boxShadow:c?e.inboxPanelResizerBoxShadow:e.inboxPanelBoxShadow};return{container:{cursor:"default",display:"flex",flexDirection:"column",background:e.contentBackground,zIndex:E.MU,width:u,height:"100%"},header:{cursor:"auto",width:"100%",..."closed"===l&&{display:"none"}},scroller:{minHeight:0,display:"flex",flexDirection:"column",marginRight:0,pointerEvents:"auto",width:"100%"},emptyState:{marginTop:100,cursor:"auto"},editorEmptyState:{background:e.contentBackground,display:"flex",flexDirection:"column",width:"100%",height:"100%",fontSize:26,alignItems:"center",justifyContent:"center",color:e.lightTextColor,fontWeight:500},editorEmptyStateIcon:{width:80,height:80,fill:e.lightTextColor},sidebarToggleAndFilterTitleContainer:{display:"flex",gap:4},inboxFilterTitle:{display:"flex",alignItems:"center",height:24,fontSize:14,fontWeight:a.Z.fontWeight.semibold},expandSidebar:{marginLeft:-8},inboxActionsContainer:{display:"flex",justifyContent:"center",alignItems:"center",gap:10},headerContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",height:p,paddingTop:8,paddingBottom:8,paddingLeft:16,paddingRight:16},resizer:{position:"absolute",top:0,right:0,zIndex:1,height:"100%",width:2,display:"closed"!==l?"block":"none",...t}}}),[c,l,p,u]),m=(0,s.VK)((()=>yt.Fz()),[]);return t.isMobile?null:(0,M.jsxs)("div",{style:g.container,children:[(0,M.jsx)(si,{}),(0,M.jsx)("div",{className:T.JiD,style:g.header,children:(0,M.jsxs)("div",{style:g.headerContainer,children:[(0,M.jsxs)("div",{style:g.sidebarToggleAndFilterTitleContainer,children:[(0,M.jsx)("div",{style:g.expandSidebar,children:(0,M.jsx)(ci,{})}),(0,M.jsx)("div",{style:g.inboxFilterTitle,children:(0,M.jsx)(ri,{filter:m})})]}),(0,M.jsxs)("div",{style:g.inboxActionsContainer,children:[("unread_and_read"===m||"unread_only"===m)&&(0,M.jsx)(It,{}),(0,M.jsx)(li,{}),(0,M.jsx)(ft.C,{shouldHide:!1,icon:at.D,caption:i.formatMessage({id:"notificationSidebar.close.tooltip",defaultMessage:"Close Inbox"}),onClick:()=>{lt.qQ({environment:e,open:!1})},keyboardShortcutName:"toggleAllUpdates",isElectron:!1,style:{marginLeft:0}})]})]})}),(0,M.jsxs)(ie.Z,{type:ee.Z.Y,style:g.scroller,children:[(0,M.jsx)(gt.Z,{onChange:(e,t)=>{let{offsetFromTop:i}=t;bt.n_.setState(i<=0)}}),"all_updates"!==m?(0,M.jsx)(Jt,{type:"archived_only"===m?"archive":"mentions",source:"notifications_tab",tab:"inbox",empty:(0,M.jsx)("div",{style:g.emptyState,children:(0,M.jsx)(di,{filter:m})})},m):n&&(0,M.jsx)(k.Z,{spaceId:n,source:"notifications_tab",empty:()=>(0,M.jsx)("div",{style:g.emptyState,children:(0,M.jsx)(di,{filter:m})})},m)]}),(0,M.jsx)("div",{style:g.resizer}),(0,M.jsx)(Y.Z,{type:"inbox"})]})}function ri(e){const{filter:t}=e;switch(t){case"unread_and_read":return(0,M.jsx)(r.FormattedMessage,{id:"inbox.unreadAndUnreadFilter.title",defaultMessage:"Unread and read"});case"unread_only":return(0,M.jsx)(r.FormattedMessage,{id:"inbox.unreadOnlyFilter.title",defaultMessage:"Unread only"});case"archived_only":return(0,M.jsx)(r.FormattedMessage,{id:"inbox.archivedFilter.title",defaultMessage:"Archived only"});case"all_updates":return(0,M.jsx)(r.FormattedMessage,{id:"inbox.allUpdatesFilter.title",defaultMessage:"All updates in the workspace"});default:return(0,D.t1)(t)}}function di(e){let{filter:t}=e;switch(t){case"unread_and_read":case"unread_only":return(0,M.jsx)(ht.Z,{message:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"You'll be notified here for @mentions, page activity, and page invites",id:"inbox.filterEmptyState.nonArchivedMessage"}),title:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"You're all caught up",id:"inbox.filterEmptyState.nonArchivedTitle"})});case"archived_only":return(0,M.jsx)(ht.Z,{message:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"Any Inbox updates you archived will show up here.",id:"inbox.filterEmptyState.archivedMessage"}),title:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"No archived updates",id:"inbox.filterEmptyState.archivedTitle"})});case"all_updates":return(0,M.jsx)(ht.Z,{message:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"Any activity in the workspace will show up here.",id:"inbox.filterEmptyState.allPagesMessage"}),title:(0,M.jsx)(r.FormattedMessage,{defaultMessage:"No activity in the workspace",id:"inbox.filterEmptyState.allPagesTitle"})});default:(0,D.t1)(t)}}function li(){window.__c={n:"InboxFilterButton"};const e=(0,r.useIntl)(),t=(0,o.yK)((e=>({button:{display:"flex",alignItems:"center",gap:6,borderRadius:4,paddingLeft:8,paddingRight:8,height:24},icon:{height:16,width:16,color:e.mediumIconColor}})),[]),i=e.formatMessage({defaultMessage:"Change the default inbox filter",id:"inbox.filterButton.tooltip"});return(0,M.jsx)(m.ZP,{popupType:m.Z4.Popup,renderOrigin:e=>{let{onClick:n}=e;return(0,M.jsx)(mt.ZP,{renderTooltip:()=>i,placement:mt.ug.Bottom,alignment:mt.v2.Start,delayThreshold:0,originGap:6,render:e=>(0,M.jsx)(ut.Z,{ariaLabel:i,icon:rt.I,iconStyle:t.icon,onClick:n,className:T.exn,...e})})},render:e=>(0,M.jsx)(Ut,{closePopup:e.close}),alignmentToOrigin:m.vR.Start,originGap:2})}function ci(){window.__c={n:"ExpandSidebarButton"};const e=(0,d.O7)(),t=(0,r.useIntl)(),i=(0,s.VK)((()=>{const t=vt.Z.state.isShowingTabBar;return!(0,Q.in)(e)&&!t}),[e]),n=(0,o.yK)((e=>({icon:{width:16,height:16},keyboardShortcut:{color:e.mediumInvertedTextColor}})),[]),a=t.formatMessage({defaultMessage:"Lock sidebar open",id:"sidebarExpandButton.tooltip"});return i?(0,M.jsx)(mt.ZP,{renderTooltip:()=>(0,M.jsxs)("div",{children:[(0,M.jsx)("div",{children:a}),(0,M.jsx)(pt.Z,{style:n.keyboardShortcut,name:"toggleSidebar"})]}),placement:mt.ug.Bottom,alignment:mt.v2.Start,delayThreshold:0,originGap:6,render:t=>(0,M.jsx)(ut.Z,{ariaLabel:a,icon:dt.K,iconStyle:n.icon,onClick:()=>Xe.setExpand({environment:e,isExpanded:!0,from:"topbar_sidebar_button"}),className:T.exn,...t})}):null}var ui=i(17693),pi=i(1464),gi=i(29477),mi=i(36488),hi=i(30506),fi=i(83785),yi=i(3712),vi=i(12457);const xi=[{tab:"mentions"},{tab:"archive"},{tab:"allPages",showSeparatorBefore:!0}];class bi extends Lt.Z{constructor(){super(...arguments),this.storeTypes={refreshCountStore:Nt.default.createClass(0)},this.handleRefreshAll=()=>{const{refreshCountStore:e}=this.stores;e.setState(e.state+1)},this.handleRefreshAllThrottled=pe.Ds(this.handleRefreshAll,1e3,{leading:!0})}willUnmount(){var e;e=this.environment,p.nI(e),lt.G7({environment:e,newTab:"mentions",shouldTrack:!1})}renderComponent(){const{device:e}=this.environment;let t;if(e.isMobile){const i="mobileTopBar";t={menuType:v.og.Modal,title:(0,M.jsx)(m.ZP,{style:{...e.isMobile&&{borderTopLeftRadius:12,borderTopRightRadius:12,overflow:"hidden"}},popupType:m.Z4.SlideUp,alignmentToOrigin:m.vR.Start,placementToOrigin:m.pO.Bottom,renderOrigin:e=>(0,M.jsxs)(ct.Z,{style:{display:"flex",alignItems:"center",gap:6,borderRadius:4,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},...e,children:[(0,M.jsx)(ri,{filter:yt.Fz()}),(0,ui.A)({width:16,height:16,fill:this.theme.mediumIconColor})]}),render:e=>(0,M.jsx)(Ut,{closePopup:e.close})}),width:this.props.format===Ht.EX.RenderAsPage?"100vw":void 0,renderAsPage:this.props.format===Ht.EX.RenderAsPage,right:[(0,M.jsx)(It,{},"InboxEllipsisButton"),(0,M.jsx)("span",{style:{width:8}},"paddingSpan"),(0,M.jsx)(yi.Z,{location:i},"InboxNotificationSettingsButton")],left:[Mi(),e.isPhone&&(0,qt.Y)("supportsNativeHome")&&this.props.format===Ht.EX.RenderAsPage&&!(0,qt.Y)("supportsNativeInbox")?void 0:(0,pi.k)({fill:this.theme.regularTextColor,width:26,height:26})],onClickLeft:this.props.onClose,whiteBackground:!0,disableHeaderShadow:!0}}else t={menuType:v.og.Popup,height:"auto"};return(0,M.jsx)(hi.Z,{onSwipeLeft:()=>function(e){const t=xi.findIndex((e=>e.tab===bt.ZP.state.currentTab)),i=xi[t+1].tab;void 0!==i&&lt.G7({environment:e,newTab:i,shouldTrack:!0})}(this.environment),onSwipeRight:()=>function(e){const t=xi.findIndex((e=>e.tab===bt.ZP.state.currentTab)),i=xi[t-1].tab;void 0!==i&&lt.G7({environment:e,newTab:i,shouldTrack:!0})}(this.environment),render:e=>(0,M.jsxs)(h.Z,{...t,...e,className:T.C18,children:[(0,M.jsx)(gt.Z,{onChange:(e,t)=>{let{offsetFromTop:i}=t;bt.n_.setState(i<=0)}}),(0,M.jsx)(mi.Z,{capture:!0,allowUndo:!0,allowEsc:!0,allowMobileAutoScroll:!0,render:()=>this.props.format===Ht.EX.RenderAsPage?(0,M.jsx)(wi,{}):(0,M.jsx)(Si,{})})]})})}}function Si(){window.__c={n:"ContentComponent"};const e=(0,s.VK)((()=>{var e;return null===(e=te.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),t=(0,s.VK)((()=>yt.Fz()),[]),i={emptyState:{marginTop:100,cursor:"auto"}};return(0,M.jsx)(M.Fragment,{children:"all_updates"!==t?(0,M.jsx)(Jt,{type:"archived_only"===t?"archive":"mentions",source:"notifications_tab",tab:"inbox",empty:(0,M.jsx)("div",{style:i.emptyState,children:(0,M.jsx)(di,{filter:t})})},t):e&&(0,M.jsx)(k.Z,{spaceId:e,source:"notifications_tab",empty:()=>(0,M.jsx)("div",{style:i.emptyState,children:(0,M.jsx)(di,{filter:t})})},t)})}function wi(){window.__c={n:"ContentAsPageWithLazyLoaderComponent"};const e=(0,d.O7)();return(0,M.jsx)(fi.Z,{fetch:async()=>{await gi.Vs(0),await te.default.waitUntil((()=>void 0!==te.default.state.currentSpaceStore))},loading:()=>(0,M.jsx)(n.Fragment,{}),willRender:()=>{var t;null===(t=e.mobileNative)||void 0===t||t.markTransitionReady({type:"updates"})},render:()=>(0,M.jsx)(V.Z,{isVisible:!0,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},blockRenderQueueOnEnter:!0,render:()=>(0,M.jsx)(Si,{})})})}function Mi(){if((0,qt.Y)("supportsNativeHome"))return(0,M.jsx)(vi.Z,{show:void 0!==bt.ZP.state.loadingId,showDelay:400,showHold:0,render:e=>e?(0,M.jsx)(Ae.Z,{style:{width:14}}):(0,M.jsx)("div",{style:{width:14}})})}bi.displayName="MobileInboxPopup"},44904:(e,t,i)=>{i.d(t,{o:()=>s});var n=i(49085);class s extends n.default{getInitialState(){return{activityIds:[],shouldLoadNewerActivities:!1,shouldLoadOlderActivities:!0,hasOlderActivities:!0,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0}}}}},47054:(e,t,i)=>{i.d(t,{AD:()=>d});i(57658);var n=i(30120),s=i(59730),o=i(63143);function a(e){if(void 0===e)return n.ou.utc();const t={zone:"utc"};return"number"==typeof e?n.ou.fromMillis(e,t):n.ou.fromISO(e,t)}function r(e,t){const i=t?a(t):n.ou.utc(),o=a(e??function(e){const{days:t,endDate:i,startDate:o}=e;if(t<=0)throw new s.p8("Days must be greater than 0");const r=i?a(i):n.ou.utc();if(!r.isValid)throw new s.p8(`endDate ${i} is in an invalid format`);const d=o?a(o).toMillis():0,l=r.minus({days:t-1}).toMillis();return Math.max(l,d)}({days:7,endDate:t}));if(!o.isValid)throw new s.p8(`startDate ${e} is in an invalid format`);if(!i.isValid)throw new s.p8(`endDate ${t} is in an invalid format`);if(o>i)throw new s.p8(`startDate ${e} => ${o.toISO()} is after endDate ${t} => ${i.toISO()}`);return{startTimestamp:o.toMillis(),endTimestamp:i.toMillis()}}function d(e,t){const{startTimestamp:i,endTimestamp:n}=r(e,t),s=[];for(var d=i;d<=n;)s.push(a(d).toISODate()),d+=o.A0;return s}},70406:(e,t,i)=>{i.d(t,{p:()=>o});i(67294);var n=i(45238),s=i(85893);const o=(0,n.I)("transcript",{viewBox:"0 0 16 16",svg:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("path",{d:"M3.99805 5.92188C3.85352 5.92188 3.72656 5.86719 3.61719 5.75781C3.50781 5.64844 3.45312 5.52148 3.45312 5.37695C3.45312 5.22852 3.50781 5.09961 3.61719 4.99023C3.72656 4.88086 3.85352 4.82617 3.99805 4.82617C4.15039 4.82617 4.2793 4.88086 4.38477 4.99023C4.49023 5.0957 4.54297 5.22461 4.54297 5.37695C4.54297 5.52539 4.49023 5.6543 4.38477 5.76367C4.2793 5.86914 4.15039 5.92188 3.99805 5.92188ZM3.99805 7.65625C3.85352 7.65625 3.72656 7.60352 3.61719 7.49805C3.50781 7.38867 3.45312 7.25977 3.45312 7.11133C3.45312 6.96289 3.50781 6.83594 3.61719 6.73047C3.72656 6.62109 3.85352 6.56641 3.99805 6.56641C4.15039 6.56641 4.2793 6.61914 4.38477 6.72461C4.49023 6.83008 4.54297 6.95898 4.54297 7.11133C4.54297 7.26367 4.49023 7.39258 4.38477 7.49805C4.2793 7.60352 4.15039 7.65625 3.99805 7.65625ZM3.99805 9.38477C3.84961 9.38477 3.7207 9.33203 3.61133 9.22656C3.50586 9.12109 3.45312 8.99219 3.45312 8.83984C3.45312 8.69141 3.50586 8.56445 3.61133 8.45898C3.7207 8.35352 3.84961 8.30078 3.99805 8.30078C4.15039 8.30078 4.2793 8.35352 4.38477 8.45898C4.49023 8.56445 4.54297 8.69141 4.54297 8.83984C4.54297 8.99219 4.49023 9.12109 4.38477 9.22656C4.2793 9.33203 4.15039 9.38477 3.99805 9.38477ZM3.99805 11.2129C3.85352 11.2129 3.72656 11.1582 3.61719 11.0488C3.50781 10.9395 3.45312 10.8105 3.45312 10.6621C3.45312 10.5137 3.50781 10.3848 3.61719 10.2754C3.72656 10.166 3.85352 10.1113 3.99805 10.1113C4.15039 10.1113 4.2793 10.166 4.38477 10.2754C4.49023 10.3809 4.54297 10.5098 4.54297 10.6621C4.54297 10.8145 4.49023 10.9453 4.38477 11.0547C4.2793 11.1602 4.15039 11.2129 3.99805 11.2129ZM5.67383 5.75195C5.56836 5.75195 5.47852 5.71484 5.4043 5.64062C5.33008 5.56641 5.29297 5.47852 5.29297 5.37695C5.29297 5.27148 5.33008 5.18164 5.4043 5.10742C5.48242 5.0293 5.57227 4.99023 5.67383 4.99023H12.1836C12.2891 4.99023 12.3789 5.0293 12.4531 5.10742C12.5312 5.18164 12.5703 5.27148 12.5703 5.37695C12.5703 5.47852 12.5332 5.56641 12.459 5.64062C12.3848 5.71484 12.293 5.75195 12.1836 5.75195H5.67383ZM5.67383 7.49219C5.57227 7.49219 5.48242 7.45508 5.4043 7.38086C5.33008 7.30664 5.29297 7.2168 5.29297 7.11133C5.29297 7.00586 5.33008 6.91602 5.4043 6.8418C5.47852 6.76367 5.56836 6.72461 5.67383 6.72461H9.31836C9.42383 6.72461 9.51367 6.76367 9.58789 6.8418C9.66211 6.91602 9.69922 7.00586 9.69922 7.11133C9.69922 7.2168 9.66211 7.30664 9.58789 7.38086C9.51367 7.45508 9.42383 7.49219 9.31836 7.49219H5.67383ZM5.67383 9.22656C5.56836 9.22656 5.47852 9.18945 5.4043 9.11523C5.33008 9.04102 5.29297 8.94922 5.29297 8.83984C5.29297 8.73828 5.33008 8.65039 5.4043 8.57617C5.47852 8.50195 5.56836 8.46484 5.67383 8.46484H12.1836C12.293 8.46484 12.3848 8.50195 12.459 8.57617C12.5332 8.65039 12.5703 8.73828 12.5703 8.83984C12.5703 8.94922 12.5332 9.04102 12.459 9.11523C12.3848 9.18945 12.293 9.22656 12.1836 9.22656H5.67383ZM5.67383 11.043C5.57227 11.043 5.48242 11.0059 5.4043 10.9316C5.33008 10.8535 5.29297 10.7637 5.29297 10.6621C5.29297 10.5566 5.33008 10.4668 5.4043 10.3926C5.47852 10.3184 5.56836 10.2812 5.67383 10.2812H9.31836C9.42383 10.2812 9.51367 10.3184 9.58789 10.3926C9.66211 10.4668 9.69922 10.5566 9.69922 10.6621C9.69922 10.7637 9.66211 10.8535 9.58789 10.9316C9.51367 11.0059 9.42383 11.043 9.31836 11.043H5.67383ZM2.97852 13.4922C2.3457 13.4922 1.86719 13.332 1.54297 13.0117C1.21875 12.6914 1.05664 12.2188 1.05664 11.5938V4.45703C1.05664 3.83203 1.21875 3.35938 1.54297 3.03906C1.86719 2.71484 2.3457 2.55273 2.97852 2.55273H13.0098C13.6465 2.55273 14.127 2.71484 14.4512 3.03906C14.7754 3.35938 14.9375 3.83203 14.9375 4.45703V11.5938C14.9375 12.2188 14.7754 12.6914 14.4512 13.0117C14.127 13.332 13.6465 13.4922 13.0098 13.4922H2.97852ZM3.04883 12.3438H12.9453C13.2148 12.3438 13.4219 12.2734 13.5664 12.1328C13.7109 11.9883 13.7832 11.7754 13.7832 11.4941V4.55664C13.7832 4.27539 13.7109 4.06445 13.5664 3.92383C13.4219 3.7793 13.2148 3.70703 12.9453 3.70703H3.04883C2.77539 3.70703 2.56641 3.7793 2.42188 3.92383C2.28125 4.06445 2.21094 4.27539 2.21094 4.55664V11.4941C2.21094 11.7754 2.28125 11.9883 2.42188 12.1328C2.56641 12.2734 2.77539 12.3438 3.04883 12.3438Z"})})})}}]);