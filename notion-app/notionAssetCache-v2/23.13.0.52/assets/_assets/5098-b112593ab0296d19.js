"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5098],{3992:(e,t,o)=>{o.r(t),o.d(t,{addRecurrence:()=>g,createRecurrenceInner:()=>h,disableRecurrence:()=>y});var n=o(40506),i=o(4615),r=o(98963),a=o(18844),l=o(6287),s=o(80444),c=o(26136),d=o(50906),u=o(96802),p=o(9953),m=o(82530);function g(e){let{environment:t,blockStore:o,recurrence:s}=e;const u=o.getAutomationId(),g=function(e){return{...e,start_date:(0,n.Io)(new Date(e.start_date))}}(s);u?function(e,t,o,n){const s=o.getParentStore();if(!s||s.table!==l.v)return;const u=o.getSpaceId(),g={table:r.cv,id:t,spaceId:u},y=c.Mz.createChildStore(o,g),h=y.getTrigger();if(!h)return;const S=y.getActionStores()[0];m.createAndCommit({environment:e,userAction:"recurrenceActions.updateRecurrence",perform:t=>{const r=f({automationId:y.id,spaceId:u,collectionPointer:s.getSpaceShardedPointer(),templatePageId:o.id});let l;S?(l=S.id,p.sW({store:S,data:r,transaction:t})):(l=(0,i.ZP)(),p.ae({environment:e,table:a.Xj,inMemoryRecordCache:y.inMemoryRecordCache,transaction:t,value:{id:l,...r}})),p.sW({store:y,data:{status:"active",trigger:{id:h.id,type:"recurrence",recurrence:n},action_ids:[l]},transaction:t})}}),d.h$X(e,{type:"updated",frequency:n.frequency})}(t,u,o,g):function(e,t,o){m.createAndCommit({environment:e,userAction:"recurrenceActions.createRecurrence",perform:n=>{h(n,e,t,o)}})}(t,o,g)}function y(e){let{environment:t,blockStore:o}=e;const n=o.getAutomationId();if(!n)return;const i={table:r.cv,id:n,spaceId:o.getSpaceId()};m.createAndCommit({environment:t,userAction:"recurrenceActions.disableRecurrence",perform:e=>{p.sW({store:(0,c.Kv)(o,i),data:{status:"disabled",run_at:void 0},transaction:e})}}),d.h$X(t,{type:"disabled"})}function h(e,t,o,n){const{currentUserRootStore:c}=s.default.state;if(!c)return;const m=o.getParentStore();if(!m||m.table!==l.v)return;if(!m.getParentBlockStore())return;const g=o.getSpaceId(),y=(0,i.ZP)(),h=(0,i.ZP)();p.ae({environment:t,table:r.cv,inMemoryRecordCache:o.inMemoryRecordCache,value:{id:y,parent_id:o.id,parent_table:o.table,alive:!0,space_id:g,status:"active",trigger:{id:(0,i.ZP)(),type:"recurrence",recurrence:n},action_ids:[h]},transaction:e}),u.FH({stores:[o],update:{automation_id:y},transaction:e}),p.ae({environment:t,table:a.Xj,inMemoryRecordCache:o.inMemoryRecordCache,transaction:e,value:{id:h,...f({automationId:y,spaceId:g,collectionPointer:m.getSpaceShardedPointer(),templatePageId:o.id})}}),d.h$X(t,{type:"created",frequency:n.frequency})}function f(e){const{automationId:t,spaceId:o,collectionPointer:n,templatePageId:i}=e;return{parent_id:t,parent_table:r.cv,type:"create_page",alive:!0,space_id:o,config:{collection:n,template_page_id:i}}}},20804:(e,t,o)=>{o.d(t,{e:()=>T});var n=o(67294),i=o(480),r=o(86628),a=o(63362),l=o(40745),s=o(8597),c=o(88437),d=o(1230),u=o(41490),p=o(25651),m=o(37612),g=o(97880),y=o(9291),h=o(52275),f=o(91839),S=o(78140),v=o(32163),x=o(72495),b=o(63474),C=o(2553),k=o(12455),w=o(95193),M=o(10383),j=o(26247),_=o(85893);const A=(0,y.defineMessages)({addStepAboveMenuItemLabel:{defaultMessage:"Add step above",id:"automations.actionContextMenu.addStepAboveMenuItemLabel"},addStepBelowMenuItemLabel:{defaultMessage:"Add step below",id:"automations.actionContextMenu.addStepBelowMenuItemLabel"},deleteMenuItemLabel:{defaultMessage:"Delete",id:"automations.actionContextMenu.deleteMenuItemLabel"},duplicateAboveMenuItemLabel:{defaultMessage:"Duplicate above",id:"automations.actionContextMenu.duplicateAboveMenuItemLabel"},duplicateBelowMenuItemLabel:{defaultMessage:"Duplicate below",id:"automations.actionContextMenu.duplicateBelowMenuItemLabel"},duplicatingMenuItemLabel:{defaultMessage:"Duplicating…",id:"automations.actionContextMenu.duplicatingMenuItemLabel"},editMenuItemLabel:{defaultMessage:"Edit",id:"automations.actionContextMenu.editMenuItemLabel"},moveDownMenuItemLabel:{defaultMessage:"Move down",id:"automations.actionContextMenu.moveDownMenuItemLabel"},moveUpMenuItemLabel:{defaultMessage:"Move up",id:"automations.actionContextMenu.moveUpMenuItemLabel"}});function T(e){window.__c={n:"ActionContextMenu"};const{actionStore:t,closeMenu:o}=e,{automationContextStore:l,maybePersistedTransactionActions:s}=(0,k.i)(),c=(0,i.O7)(),d=(0,y.useIntl)(),u=(0,b.D)(),[p,m]=(0,n.useState)(),g=(0,r.VK)((()=>null==l?void 0:l.context.automationStore),[l]),h=(0,r.VK)((()=>(null==g?void 0:g.getActionIds())??[]),[g]),f=(0,r.VK)((()=>h.indexOf(t.id)),[t.id,h]),S=(0,r.VK)((()=>(0,j.r)(l,t)),[t,l]),v=(0,r.VK)((()=>{if(!S||!t.isType("update_pages"))return;const e=t.getConfigStore().getKeyStore("properties").getValue();return null==e?void 0:e[0]}),[t,S]),x=0===f,w=f===h.length-1,A=(0,n.useCallback)((()=>{m(void 0),null==o||o()}),[o]),T=(0,n.useCallback)((async()=>{if(!g)return;const e=s.createAndCommit({perform:e=>C.AN({actionStore:t,automationStore:g,environment:c,insertionPoint:{beforeActionId:t.id},intl:d,transaction:e}),userAction:"AutomationAction.duplicateAction"});await e.performResult.onComplete,t.isDefined()&&(0,a.eI)(u,{automation_action_id:t.id,automation_action_type:t.getType(),automation_id:g.id,from:"duplicate"}),A()}),[t,g,c,u,A,d,s]),V=(0,n.useCallback)((async()=>{if(!g)return;const e=s.createAndCommit({perform:e=>C.AN({actionStore:t,automationStore:g,environment:c,insertionPoint:{afterActionId:t.id},intl:d,transaction:e}),userAction:"AutomationAction.duplicateAction"});await e.performResult.onComplete,t.isDefined()&&(0,a.eI)(u,{automation_action_id:t.id,automation_action_type:t.getType(),automation_id:g.id,from:"duplicate"}),A()}),[t,g,c,u,A,d,s]),F=(0,n.useCallback)((()=>{const e=null==l?void 0:l.context;return e?(s.createAndCommit({perform:o=>{C.sl({actionStore:t,clientContext:e,transaction:o}),t.isDefined()&&(0,a.co)(u,{automation_action_id:t.id,automation_action_type:t.getType(),automation_id:e.automationStore.id})},userAction:"AutomationAction.removeAction"}),A(),Promise.resolve()):Promise.resolve()}),[t,null==l?void 0:l.context,u,A,s]),Z=(0,n.useCallback)((()=>{const e=null==l?void 0:l.context;if(!e)return Promise.resolve();s.createAndCommit({perform:t=>{const o=I(h,f-1,f);C.kM({clientContext:e,newActionIds:o,transaction:t})},userAction:"AutomationAction.moveAction"}),A()}),[h,null==l?void 0:l.context,f,A,s]),B=(0,n.useCallback)((()=>{const e=null==l?void 0:l.context;if(!e)return Promise.resolve();s.createAndCommit({perform:t=>{const o=I(h,f+1,f);C.kM({clientContext:e,newActionIds:o,transaction:t})},userAction:"AutomationAction.moveAction"}),A()}),[h,null==l?void 0:l.context,f,A,s]),K=(0,n.useMemo)((()=>{if(S&&v)return function(){m({initialState:{actionId:t.id,propertyId:v,type:"eventActionProperty"},insertionPoint:void 0})}}),[t.id,S,v]),R=(0,n.useCallback)((()=>{m({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{beforeActionId:t.id}})}),[t.id]),O=(0,n.useCallback)((()=>{m({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{afterActionId:t.id}})}),[t.id]);return(0,_.jsxs)(_.Fragment,{children:[!p&&(0,_.jsx)(P,{onAddStepAbove:R,onAddStepBelow:O,onDelete:F,onDuplicateAbove:T,onDuplicateBelow:V,onEdit:K,onMoveDown:w?void 0:B,onMoveUp:x?void 0:Z}),p&&(0,_.jsx)(M.Z,{initialState:p.initialState,insertionPoint:p.insertionPoint,onClose:A})]})}function P(e){window.__c={n:"BaseActionContextMenu"};const{onAddStepAbove:t,onAddStepBelow:o,onDelete:i,onDuplicateAbove:r,onDuplicateBelow:a,onEdit:h,onMoveDown:f,onMoveUp:b}=e,C=(0,w.F)(),k=function(e){const{hasSeparator:t,onMoveDown:o,onMoveUp:i}=e,r=(0,n.useMemo)((()=>{if(i)return{action:i,key:"moveUp",render:e=>(0,_.jsx)(V,{...e,icon:(0,s.Z)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.moveUpMenuItemLabel})})}}),[i]),a=(0,n.useMemo)((()=>{if(o)return{action:o,key:"moveDown",render:e=>(0,_.jsx)(V,{...e,icon:(0,l.M)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.moveDownMenuItemLabel})})}}),[o]),c=[r,a].filter(g.$K);if(0===c.length)return;return{items:c,key:"moveSteps",render:e=>(0,_.jsx)(x.Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({onMoveDown:f,onMoveUp:b}),M=function(e){const{hasSeparator:t,onAddStepAbove:o,onAddStepBelow:i}=e,r=(0,n.useMemo)((()=>{if(o)return{action:o,key:"addStepAbove",render:e=>(0,_.jsx)(V,{...e,icon:(0,u.F)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.addStepAboveMenuItemLabel})})}}),[o]),a=(0,n.useMemo)((()=>{if(i)return{action:i,key:"addStepBelow",render:e=>(0,_.jsx)(V,{...e,icon:(0,d.H)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.addStepBelowMenuItemLabel})})}}),[i]),l=[r,a].filter(g.$K);if(0===l.length)return;return{items:l,key:"addSteps",render:e=>(0,_.jsx)(x.Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:Boolean(k),onAddStepAbove:t,onAddStepBelow:o}),j=function(e){const{hasSeparator:t,onDuplicateAbove:o,onDuplicateBelow:i}=e,[r,a]=(0,n.useState)(!1),l=(0,n.useMemo)((()=>{if(o)return{action:async()=>{a(!0);try{await o()}finally{a(!1)}},key:"duplicateAbove",render:e=>(0,_.jsx)(V,{...e,icon:(0,c.a)({height:16,width:16}),isLoading:r,children:r?(0,_.jsx)(y.FormattedMessage,{...A.duplicatingMenuItemLabel}):(0,_.jsx)(y.FormattedMessage,{...A.duplicateAboveMenuItemLabel})})}}),[r,o]),s=(0,n.useMemo)((()=>{if(i)return{action:async()=>{a(!0);try{await i()}finally{a(!1)}},key:"duplicateBelow",render:e=>(0,_.jsx)(V,{...e,icon:(0,c.a)({height:16,width:16}),isLoading:r,children:r?(0,_.jsx)(y.FormattedMessage,{...A.duplicatingMenuItemLabel}):(0,_.jsx)(y.FormattedMessage,{...A.duplicateBelowMenuItemLabel})})}}),[r,i]),d=[l,s].filter(g.$K);if(0===d.length)return;return{items:d,key:"duplicateSteps",render:e=>(0,_.jsx)(x.Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:Boolean(k||M),onDuplicateAbove:r,onDuplicateBelow:a}),T=function(e){const{hasSeparator:t,onDelete:o,onEdit:i}=e,r=(0,n.useMemo)((()=>{if(i)return{action:i,key:"edit",render:e=>(0,_.jsx)(V,{...e,icon:(0,p.R)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.editMenuItemLabel})})}}),[i]),a=(0,n.useMemo)((()=>{if(o)return{action:o,key:"delete",render:e=>(0,_.jsx)(V,{...e,icon:(0,m.y)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.deleteMenuItemLabel})})}}),[o]),l=[r,a].filter(g.$K);if(0===l.length)return;return{items:l,key:"otherActions",render:e=>(0,_.jsx)(x.Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:Boolean(k||M||j),onDelete:i,onEdit:h});return(0,_.jsx)(S.Z,{...C,children:(0,_.jsx)(v.Z,{type:v.i.Vertical,sections:[k,M,j,T].filter(g.$K),initialFocus:0})})}function V(e){const{children:t,icon:o,isLoading:n,...i}=e,r=n?(0,_.jsx)(f.Z,{}):o;return(0,_.jsx)(h.Z,{...i,disabled:n,disabledFeedback:n,icon:r,title:t})}function I(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}},19454:(e,t,o)=>{o.d(t,{v:()=>M});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(63362),s=o(28751),c=o(4615),d=o(97880),u=o(9291),p=o(82530),m=o(52275),g=o(78140),y=o(32163),h=o(72495),f=o(26388),S=o(60442),v=o(49117),x=o(98742),b=o(63474),C=o(2553),k=o(95193),w=o(85893);function M(e){window.__c={n:"AddActionMenu"};const{contextStore:t,onActionAdded:o,insertionPoint:a}=e,M=(0,u.useIntl)(),_=(0,i.O7)(),A=(0,b.D)(),T=(0,k.F)({width:280}),P=function(e){const{contextStore:t}=e,[o,i]=(0,n.useState)([]),a=(0,r.VK)((()=>(0,v.uV)(t.context.automationStore,t.context.type)),[t.context.automationStore,t.context.type]),l=(0,n.useMemo)((()=>(0,s.P)("display")),[]);return(0,r.VK)((async()=>{if(a){const e=await Promise.all(l.map((async e=>await e.isAvailableForContext(a))));return i(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(l.filter(((t,o)=>e[o]))))}o.length>0&&i([])}),[a,o.length,l]),o}({contextStore:t}).map((e=>{const{display:n}=e;return{key:e.type,render:e=>{const t=t=>(0,w.jsx)(m.Z,{...(0,x.Z)(t??{},e),icon:(0,w.jsx)(j,{display:n}),disabled:!1,title:M.formatMessage(n.name)}),o=n.description;return o?(0,w.jsx)(f.ZP,{renderTooltip:()=>(0,w.jsx)(S.Z,{caption:M.formatMessage(o)}),placement:f.ug.Right,delayThreshold:0,render:t}):t()},action:()=>{const n=(0,c.ZP)(),i=t.context.automationStore;p.createAndCommit({userAction:"AutomationActionList.addAction",environment:_,perform:t=>{C.zY({actionId:n,actionType:e.type,automationStore:i,environment:_,intl:M,transaction:t,insertionPoint:a})}}),(0,l.eI)(A,{automation_id:i.id,automation_action_id:n,automation_action_type:e.type}),o(n)}}})).filter(d.$K);return(0,w.jsx)(g.Z,{...T,children:(0,w.jsx)(y.Z,{type:y.i.Vertical,sections:[{key:0,render:e=>(0,w.jsx)(h.Z,{enableActionSheetTitle:!0,...e}),items:P}],initialFocus:0})})}function j(e){window.__c={n:"AddActionIcon"};const{display:t}=e,o=(0,a.yK)((e=>({icon:{width:13,height:13,fill:t.hasSideEffects?e.blueColor:e.mediumIconColor},iconWrapper:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],borderRadius:4,marginLeft:-2}})),[t.hasSideEffects]);return(0,w.jsx)("div",{style:o.iconWrapper,children:t.icon(o.icon)})}},48312:(e,t,o)=>{o.d(t,{X:()=>D});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(63362),s=o(28751),c=o(40745),d=o(8597),u=o(56666),p=o(88437),m=o(1230),g=o(41490),y=o(37612),h=o(98963),f=o(97880),S=o(82990),v=o(9291),x=o(82530),b=o(30583),C=o(23063),k=o(52275),w=o(31945),M=o(50478),j=o(73063),_=o(91839),A=o(78140),T=o(32163),P=o(53437),V=o(72495),I=o(28267),F=o(63474),Z=o(2553),B=o(95193),K=o(35294),R=o(19454),O=o(85893);const W=(0,v.defineMessages)({moreActionsButtonAriaLabel:{defaultMessage:"More actions",id:"buttonBlock.button.moreActionsButtonAriaLabel"}});function D(e){window.__c={n:"AutomationActionHeader"};const{contextStore:t,actionStore:o,disabled:i,dragging:l,title:c,picker:d,onActionAdded:u}=e,p=(0,n.useRef)(null),m=(0,I.X)(p),g=(0,n.useMemo)((()=>Boolean(m&&m.width<320)),[m]),[y,h]=(0,n.useState)(!1),f=(0,n.useMemo)((()=>l||!i&&y),[i,l,y]),v=(0,a.yK)((e=>({iconHandle:{display:"flex",justifyContent:"center",left:0,position:"absolute",top:0,width:24},iconWrap:{position:"relative",width:24},nameRow:{display:"flex",alignItems:g?"flex-start":"center"},name:{flexGrow:1,fontWeight:S.Z.fontWeight.medium,display:"flex",overflow:"hidden",...g?{flexDirection:"row",flexWrap:"wrap",marginLeft:8,alignItems:"center"}:{alignItems:"center",marginLeft:8}},title:{whiteSpace:"nowrap"},picker:{position:"relative",left:-4,...g?{flexShrink:1,display:"inline-flex",minWidth:0}:{flexGrow:1,width:0}}})),[g]),x=(0,r.VK)((()=>o.getType()),[o]);if(!x)return null;const b=(0,s.z)(x),{display:k}=b;return(0,O.jsxs)("div",{onMouseLeave:()=>h(!1),onMouseEnter:()=>h(!0),style:v.nameRow,ref:p,children:[(0,O.jsxs)("div",{style:v.iconWrap,children:[(0,O.jsx)(C.Z,{isVisible:!0,animationStyle:{opacity:f?0:1},enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:1},render:()=>(0,O.jsx)(E,{display:k})}),(0,O.jsx)(C.Z,{isVisible:!i,animationStyle:{opacity:f?1:0},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>(0,O.jsx)("div",{style:v.iconHandle,children:(0,O.jsx)(M.ZP,{hideClickMessage:!0})})})]}),(0,O.jsxs)("div",{style:v.name,children:[(0,O.jsx)("div",{style:v.title,children:c}),!g&&(0,O.jsx)(O.Fragment,{children:" "}),d&&(0,O.jsx)("div",{style:v.picker,children:d})]}),!i&&(0,O.jsx)(N,{contextStore:t,actionStore:o,onActionAdded:u})]})}function E(e){window.__c={n:"ActionIcon"};const{display:t}=e,o=(0,a.yK)((e=>({iconWrap:{width:24,height:24,display:"flex",alignItems:"center",borderRadius:4,background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],flexShrink:0},icon:{width:14,height:14,fill:t.hasSideEffects?e.blueColor:e.accentColors.gray[500],margin:"0 auto"}})),[t.hasSideEffects]);return(0,O.jsx)("div",{style:o.iconWrap,children:t.icon(o.icon)})}function N(e){window.__c={n:"MoreActionsButton"};const{contextStore:t,actionStore:o,onActionAdded:i}=e,r=(0,v.useIntl)(),a=(0,K.d)(),[l,s]=(0,n.useState)("closed"),[c,d]=n.useState(void 0);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(w.ZP,{popupType:a,alignmentToOrigin:w.vR.Center,placementToOrigin:w.pO.Bottom,originGap:0,renderOrigin:e=>(0,O.jsx)(j.Z,{ariaLabel:r.formatMessage(W.moreActionsButtonAriaLabel),icon:u.o,...e}),render:t=>(0,O.jsx)(z,{onClose:()=>t.close(),onAddStep:e=>{d(new DOMRect(b.IL.x,b.IL.y,1,1)),s(e?"above":"below"),t.close()},...e})}),(0,O.jsx)(P.ZP,{popupType:a,open:"closed"!==l,originRect:c,placementToOrigin:P.ZP.Placement.Bottom,alignmentToOrigin:P.ZP.Alignment.Center,render:()=>(0,O.jsx)(R.v,{contextStore:t,onActionAdded:e=>{i(e),s("closed")},insertionPoint:"above"===l?{beforeActionId:o.id}:{afterActionId:o.id}}),onDismiss:()=>s("closed")})]})}function L(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}function z(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,contextStore:o,actionStore:a,onAddStep:s}=e,u=(0,v.useIntl)(),S=(0,i.O7)(),b=(0,F.D)(),C=(0,r.VK)((()=>o.context.automationStore),[o]),w=(0,r.VK)((()=>C.getActionIds()),[C]),[M,j]=(0,n.useState)(!1),P=w.length<h.FT,I=w.indexOf(a.id),K=0===I,R=I===w.length-1,W=(0,B.F)(),D={key:"duplicate",action:async()=>{j(!0);const e=x.createAndCommit({userAction:"AutomationAction.duplicateAction",environment:S,perform:e=>Z.AN({actionStore:a,automationStore:C,environment:S,intl:u,transaction:e})});a.isDefined()&&(0,l.eI)(b,{automation_id:o.context.automationStore.id,automation_action_id:a.id,automation_action_type:a.getType(),from:"duplicate"});try{await e.performResult.onComplete}finally{j(!1)}t()},render:e=>{const t=M?(0,O.jsx)(_.Z,{}):(0,p.a)({height:16,width:16}),o=M?(0,O.jsx)(v.FormattedMessage,{id:"automations.duplicatingActionButton.label",defaultMessage:"Duplicating..."}):(0,O.jsx)(v.FormattedMessage,{id:"automations.duplicateBelowActionButton.label",defaultMessage:"Duplicate below"});return(0,O.jsx)(k.Z,{...e,disabled:M,icon:t,title:o})}},E={key:"delete",action:()=>{x.createAndCommit({userAction:"AutomationAction.removeAction",environment:S,perform:e=>{Z.sl({clientContext:o.context,actionStore:a,transaction:e}),a.isDefined()&&(0,l.co)(b,{automation_id:o.context.automationStore.id,automation_action_id:a.id,automation_action_type:a.getType()})}}),t()},render:e=>(0,O.jsx)(k.Z,{...e,icon:(0,y.y)({height:16,width:16}),title:(0,O.jsx)(v.FormattedMessage,{id:"automations.deleteActionButton.label",defaultMessage:"Delete"})})},N=[!0,!1].map((e=>{if(!(e&&K||!e&&R))return{key:e?"moveUp":"moveDown",action:()=>{x.createAndCommit({userAction:"AutomationAction.moveAction",environment:S,perform:t=>{let n;n=L(w,e?I-1:I+1,I),Z.kM({clientContext:o.context,transaction:t,newActionIds:n})}}),t()},render:t=>(0,O.jsx)(k.Z,{...t,icon:(e?d.Z:c.M)({width:16,height:16}),title:e?(0,O.jsx)(v.FormattedMessage,{id:"automations.moveUpButton.label",defaultMessage:"Move up"}):(0,O.jsx)(v.FormattedMessage,{id:"automations.moveDownButton.label",defaultMessage:"Move down"})})}})).filter(f.$K),z=[!0,!1].map((e=>({key:e?"addStepAbove":"addStepBelow",action:()=>{s(e)},render:t=>(0,O.jsx)(k.Z,{...t,disabledFeedback:!0,icon:e?(0,g.F)({width:16,height:16}):(0,m.H)({width:16,height:16}),title:e?(0,O.jsx)(v.FormattedMessage,{id:"automations.addStepAboveButton.label",defaultMessage:"Add step above"}):(0,O.jsx)(v.FormattedMessage,{id:"automations.addStepBelowButton.label",defaultMessage:"Add step below"})})})));return(0,O.jsx)(A.Z,{...W,children:(0,O.jsx)(T.Z,{type:T.i.Vertical,sections:[...N.length>0?[{key:"movement",render:e=>(0,O.jsx)(V.Z,{enableActionSheetTitle:!0,...e}),items:N}]:[],...P?[{key:"addSteps",render:e=>(0,O.jsx)(V.Z,{enableActionSheetTitle:!0,topBorder:!0,...e}),items:z},{key:"duplicate",render:e=>(0,O.jsx)(V.Z,{enableActionSheetTitle:!0,topBorder:!0,...e}),items:[D]}]:[],{key:"delete",render:e=>(0,O.jsx)(V.Z,{enableActionSheetTitle:!0,topBorder:!0,...e}),items:[E]}],initialFocus:0})})}},32984:(e,t,o)=>{o.d(t,{vV:()=>le,QF:()=>re,li:()=>me});var n=o(67294),i=o(86628),r=o(24405),a=o(3865),l=o(48777),s=o(23290),c=o(76218),d=o(72126),u=o(6287),p=o(97880),m=o(9291),g=o(9953),y=o(52275),h=o(31945),f=o(78140),S=o(32163),v=o(72495),x=o(480),b=o(40190),C=o(61766),k=o(53437),w=o(72865),M=o(149),j=o(87279),_=o(77907),A=o(40721),T=o(74648),P=o(85893);const V=(0,_.withDependency)(_.deps.formulas,((e,t)=>(0,P.jsx)(I,{...t,formulas:e})));function I(e){window.__c={n:"FormulaInputMenu"};const{value:t,onChange:o,onClose:r,disabled:a,contextStore:l,formulas:s}=e,c=(0,x.Fy)(),d=(0,n.useCallback)((()=>{o({type:"simple",value:null==t?void 0:t.value}),r()}),[o,r,null==t?void 0:t.value]),u=(0,n.useCallback)((e=>{void 0!==e&&e[0][0].length?o({type:"formula",value:e}):o(void 0),r()}),[o,r]),p=(0,i.VK)((()=>l.context.parentRecordStore.getSpaceId()),[l.context.parentRecordStore]),m=(0,i.Kw)(l.compilationResultStore),g=(0,n.useMemo)((()=>s.createFormulaDataRequestHandler(l.context.parentRecordStore.getRecordModel,l.context.parentRecordStore.loadRecordModel)),[l.context.parentRecordStore.getRecordModel,l.context.parentRecordStore.loadRecordModel,s]),y=(0,i.VK)((()=>{if(M.x.isFail(m))return;return{valueTypes:m.value.valueTypes,handleDataRequest:g}}),[m,g],{useDeepEqual:!0});let h;return h=c.isMobile?{menuType:j.og.Modal,right:(0,P.jsx)(A.DoneMenuText,{}),onClickRight:parent.close}:{menuType:j.og.Popup,maxHeight:"50vh",width:600,height:320,disableHeaderBorder:!0},p&&y?(0,P.jsx)(f.Z,{...h,children:(0,P.jsx)(T.Z,{formulas:s,initialCode:null==t?void 0:t.value,typecheckContext:y,handleClose:u,handleBack:d,parentSpaceId:p,disabled:a,focus:!0,evaluationErrors:[],getRecordModel:l.context.parentRecordStore.getRecordModel})}):null}var F=o(70203),Z=o(17809),B=o(65187);function K(e){window.__c={n:"NumberInput"};const{value:t,disabled:o,buttonPopupStore:i,onChange:a}=e,l=(0,r.yK)((e=>({wrap:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,borderRadius:4,padding:4}})),[]),s=(0,n.useCallback)((e=>{"="===(0,F.QaF)(e)&&(0,Z.NY)()?(a({type:"formula",value:void 0}),i.setState({open:!0})):a({type:"simple",value:e})}),[a,i]),{store:c}=(0,Z.Cl)({initialValue:null==t?void 0:t.value,onChange:s});return(0,P.jsx)("div",{style:l.wrap,children:(0,P.jsx)(B.Z,{disabled:o,store:c,pasteBehavior:"inline",disableSlashCommands:!0,disableEmojiCommands:!0,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableEmbedMenu:!0,disableMobileActionBar:!0,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEquationInteraction:!0})})}var R=o(53498),O=o(18466),W=o(13991),D=o(32426),E=o(82990),N=o(60682),L=o(14976),z=o(75311),H=o(30387);function U(e){window.__c={n:"ValuePickerValue"};const{value:t,type:o,currentSimpleFormulaValueTokens:n,contextStore:a,context:l}=e,{collectionStore:s,property:c}=l,d=(0,r.yK)((()=>({tokenWrap:{display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginTop:6}})),[]),u=(0,z.M)(s,c),m=(0,i.VK)((()=>(0,Z.NY)()),[]);if("formula"===(null==t?void 0:t.type)&&t.value&&m)return(0,P.jsx)(q,{...e});if("text"===o.type||"number"===o.type)return null;if("date"===o.type||"select"===o.type||"checkbox"===o.type){const e=n[0];return void 0===e?(0,P.jsx)($,{}):(0,P.jsx)("div",{style:d.tokenWrap,children:(0,P.jsx)(R.K,{token:e,contextStore:a,disabled:!0,currentSimpleFormulaValueTokens:n,context:l})})}if("person_array"===o.type||"block_array"===o.type||"select_array"===o.type)return 0===n.length?(0,P.jsx)($,{}):(0,P.jsx)("div",{style:d.tokenWrap,children:u(n,"first").map(((e,t)=>(0,P.jsx)(R.K,{token:e,contextStore:a,disabled:!0,currentSimpleFormulaValueTokens:n,context:l},t)))});(0,p.t1)(o)}function $(){window.__c={n:"ValueEmptyPlaceholder"};const e=(0,r.yK)((e=>({placeholderText:{color:e.lightTextColor}})),[]);return(0,P.jsx)("div",{style:e.placeholderText,children:(0,P.jsx)(m.FormattedMessage,{...H.s.personSelect})})}function q(e){window.__c={n:"MinimalFormulaText"};const{value:t,contextStore:o}=e,a=(0,x.O7)(),l=(0,r.Fg)(),s=(0,r.yK)((e=>({wrap:{display:"flex",alignItems:"center",pointerEvents:"none",fontFamily:E.Z.getCompositeFontFamily(W.SP).githubMono,fontSize:12,flexGrow:1,...E.Z.textOverflowStyle},icon:{width:14,fill:e.mediumIconColor,marginRight:6}})),[]),c=(0,N.kw)(),d=(0,i.VK)((()=>a.KatexStore.getKatex()),[a]),u=(0,i.VK)((()=>o.context.parentRecordStore.getSpaceId()),[o.context.parentRecordStore]),p=(0,i.Kw)(o.compilationResultStore),m=M.x.isSuccess(p)?p.value.valueTypes:void 0,g=(0,n.useMemo)((()=>O.Z.withListenerIgnored((()=>(0,L.IY)({environment:a,textValue:null!=t&&t.value&&u?{value:t.value,spaceId:u}:void 0,parentStore:o.context.parentRecordStore,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:l,emojiType:c,katex:d,parentBlockId:void 0,renderedPageBlockId:void 0,formulaValueTypes:m||[]})))),[t,u,a,o.context.parentRecordStore,c,d,l,m]);return(0,P.jsxs)("div",{style:s.wrap,children:[(0,D.D)(s.icon),g]})}function G(e){window.__c={n:"SimpleFormulaValuePicker"};const{type:t,value:o,disabled:n}=e,a=(0,x.Fy)(),l=!o||"simple"===o.type,s=(0,i.VK)((()=>(0,c.A6)(null==o?void 0:o.value)),[o]),d=(0,r.yK)((e=>({button:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow}})),[]),u=(0,i.qz)(void 0,C.Z);return"number"===t.type&&l?(0,P.jsx)(K,{...e,buttonPopupStore:u}):"text"===t.type?(0,P.jsx)(w.D,{...e}):(0,P.jsx)(h.ZP,{popupType:a.isMobile?k.kQ.SlideUp:k.kQ.Popup,alignmentToOrigin:h.vR.End,placementToOrigin:h.pO.Bottom,originGap:0,buttonPopupStore:u,disabled:n,renderOrigin:t=>(0,P.jsx)(b.S,{disabled:n,variant:"gray",...t,style:d.button,children:(0,P.jsx)(U,{...e,currentSimpleFormulaValueTokens:s})}),render:t=>l?(0,P.jsx)(R.a,{...e,onClose:t.close,currentSimpleFormulaValueTokens:s}):(0,P.jsx)(V,{...e,onClose:t.close})})}var Q=o(28267),Y=o(12455),X=o(73266),J=o(95193),ee=o(35294),te=o(39068),oe=o(61053);function ne(e){window.__c={n:"AutomationPropertyPicker"};const{alreadyHaveProperties:t,availablePropertyIds:o,collectionStore:a,currentValue:l,disabled:s,onChange:c,onRemove:d}=e,u=(0,x.O7)(),p=(0,r.Fg)(),{device:g}=u,y=(0,i.VK)((()=>a.getSchema()??{}),[a]),S=(0,i.VK)((()=>a.getFormat()??{}),[a]),v=(0,i.VK)((()=>l?a.getSchema()[l]:void 0),[l,a]),C=(0,r.yK)((e=>({propertyIcon:{fill:e.lightTextColor,height:"auto",marginRight:4,width:16}})),[]),k=(0,n.useCallback)((()=>o),[o]),w=(0,ee.d)();return(0,P.jsx)(h.ZP,{popupType:w,alignmentToOrigin:h.vR.End,placementToOrigin:h.pO.Bottom,originGap:0,disabled:s,renderOrigin:e=>(0,P.jsx)(b.S,{...e,disabled:s,icon:v?e=>(0,P.jsx)(te.ZP,{icon:void 0,type:v.type,size:16,theme:p,style:{...e,...C.propertyIcon}}):void 0,variant:t||v?v?"default":"gray":"blue",children:v?(0,P.jsx)(P.Fragment,{children:(0,P.jsx)("div",{style:{fontWeight:E.Z.fontWeight.medium,...E.Z.textOverflowStyle},children:v.name})}):t?(0,P.jsx)(m.FormattedMessage,{id:"automations.propertyPicker.buttonPlaceholderAlreadyHaveProperties",defaultMessage:"Edit another property"}):(0,P.jsx)(m.FormattedMessage,{id:"automations.propertyPicker.buttonPlaceholder",defaultMessage:"Edit a property"})}),render:e=>{const t=(0,J.U)({device:g,width:280,paddingTop:4});return(0,P.jsx)(f.Z,{...t,children:(0,P.jsx)(oe.Z,{schema:y,format:S,showRemoveOption:Boolean(d),currentProperty:l,getProperties:k,onAccept:t=>{t&&t!==l?c(t):void 0===t&&(null==d||d(l)),e.close()}})})}})}const ie=(0,m.defineMessages)({replaceActionLabel:{id:"automations.AutomationActionSetPropertiesSection.replaceAction.label",defaultMessage:"Replace with"},appendActionLabel:{id:"automations.AutomationActionSetPropertiesSection.appendAction.label",defaultMessage:"Add"},removeActionLabel:{id:"automations.AutomationActionSetPropertiesSection.removeAction.label",defaultMessage:"Remove"},titlePlaceholder:{id:"automations.AutomationActionSetPropertiesSection.titlePlaceholder",defaultMessage:"Untitled"}});function re(e){window.__c={n:"ButtonAutomationActionSetPropertiesSection"};const{contextStore:t,actionStore:o,collectionStore:r,disabled:a,showSetPropertyActions:l}=e,s=(0,i.VK)((()=>o.id),[o.id]),{maybePersistedTransactionActions:c}=(0,Y.i)(),d=(0,i.VK)((()=>{var e;return(null===(e=o.getConfig())||void 0===e?void 0:e.values)??{}}),[o]),u=(0,i.VK)((()=>{var e;return(null===(e=o.getConfig())||void 0===e?void 0:e.properties)??[]}),[o]),p=(0,n.useMemo)((()=>({properties:u,values:d})),[u,d]),m=(0,n.useCallback)((e=>{const t=u.concat([e]),n={...d,[e]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.propertiesChange",perform:e=>{ae({configStore:o.getConfigStore(),properties:t,transaction:e,values:n})}})}),[u,d,c,o]),g=(0,n.useCallback)(((e,t)=>{const n=u.indexOf(e);if(-1===n)return;const i=u.slice(0);i[n]=t;const r={...d,[t]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.setProperties",perform:e=>{ae({configStore:o.getConfigStore(),properties:i,transaction:e,values:r})}})}),[u,d,c,o]),y=(0,n.useCallback)((e=>{const t=u.filter((t=>t!==e)),n={...d,[e]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.removeProperty",perform:e=>{ae({configStore:o.getConfigStore(),properties:t,transaction:e,values:n})}})}),[u,d,c,o]),h=(0,n.useCallback)(((e,t)=>{const n={...d,[e]:t};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.handleValueChange",perform:e=>{ae({configStore:o.getConfigStore(),properties:u,transaction:e,values:n})}})}),[d,c,o,u]);return(0,P.jsx)(le,{contextStore:t,actionId:s,config:p,onPropertyAdd:m,onPropertyChange:g,onPropertyRemove:y,onPropertyValueChange:h,collectionStore:r,showSetPropertyActions:l,disabled:a})}function ae(e){const{configStore:t,properties:o,transaction:n,values:i}=e;g.sW({store:t,data:{properties:o,values:i},transaction:n})}function le(e){window.__c={n:"AutomationActionSetPropertiesSection"};const{contextStore:t,actionId:o,config:n,collectionStore:l,onPropertyAdd:s,onPropertyChange:c,onPropertyRemove:d,onPropertyValueChange:u,disabled:p,showSetPropertyActions:m}=e,g=(0,r.yK)((e=>({addPropertyValuePlaceholder:{color:e.mediumTextColor,flexGrow:1,textAlign:"right"},addPropertyRow:{display:"flex",alignItems:"center"}})),[]),y=(0,i.VK)((()=>(0,a.cO)({collectionFormat:l.getFormat(),collectionSchema:l.getSchema(),sort:!1,sourcePropertyIds:n.properties})),[l,n.properties]),h=(0,i.VK)((()=>(0,a.cO)({collectionFormat:l.getFormat(),collectionSchema:l.getSchema(),filter:e=>{let[t]=e;return!y.includes(t)}})),[l,y]),f=0===h.length;return(0,P.jsxs)(P.Fragment,{children:[y.length>0&&(0,P.jsx)(se,{availablePropertyIds:h,contextStore:t,actionId:o,config:{properties:y,values:n.values},collectionStore:l,onPropertyChange:c,onPropertyRemove:d,onPropertyValueChange:u,showSetPropertyActions:m,disabled:p}),!p&&!f&&(0,P.jsx)("div",{style:g.addPropertyRow,children:(0,P.jsx)(ne,{availablePropertyIds:h,currentValue:void 0,collectionStore:l,onChange:s,disabled:p,alreadyHaveProperties:y.length>0})})]})}function se(e){window.__c={n:"PropertySectionList"};const{availablePropertyIds:t,contextStore:o,actionId:i,config:a,collectionStore:l,onPropertyChange:s,onPropertyRemove:c,onPropertyValueChange:d,showSetPropertyActions:u,disabled:p}=e,m=(0,n.useRef)(null),g=(0,Q.X)(m),y=(0,X.a)(g),h=(0,r.yK)((()=>({wrap:{alignItems:"center",columnGap:4,display:"grid",gridTemplateColumns:y?"100%":"160px 1fr",minWidth:0,rowGap:y?4:8},propertyValue:{...y?{fontSize:14,marginBlockEnd:16}:{}},lastPropertyValue:{...y?{fontSize:14,marginBlockEnd:0}:{}}})),[y]);return(0,P.jsx)("div",{style:h.wrap,ref:m,children:a.properties.map(((e,n)=>{const r=n===a.properties.length-1;return(0,P.jsx)(ce,{actionId:i,availablePropertyIds:t,collectionStore:l,contextStore:o,disabled:p,onPropertyChange:s,onPropertyRemove:c,onPropertyValueChange:d,property:e,showSetPropertyActions:u,value:a.values[e],valueStyle:r?h.lastPropertyValue:h.propertyValue},e)}))})}function ce(e){window.__c={n:"PropertySection"};const{actionId:t,availablePropertyIds:o,collectionStore:a,contextStore:d,disabled:p,onPropertyChange:g,onPropertyRemove:y,onPropertyValueChange:h,property:f,showSetPropertyActions:S,value:v,valueStyle:x}=e,b={type:"collection",collectionStore:a,property:f},C=(0,m.useIntl)(),k=(0,r.yK)((e=>({propertyName:{},propertyValue:{display:"flex",gap:4,minWidth:50,...x}})),[x]),w=(0,n.useMemo)((()=>{if("title"===f)return C.formatMessage(ie.titlePlaceholder)}),[C,f]),M=(0,i.VK)((()=>{const e=a.getSchema()[f];if(e)return e}),[a,f]),j=(0,i.VK)((()=>{if(M)return(0,c.qW)({table:u.v,id:a.id,spaceId:a.getSpaceId()},f,M)}),[a,M,f]),_=(0,i.VK)((()=>null==M?void 0:M.type),[M]),A=null==v?void 0:v.value,T=(0,i.VK)((()=>(0,s.o9)(v)),[v]),V=(0,i.VK)((()=>d.context.parentRecordStore.getSpaceId()),[d.context.parentRecordStore]),I=(0,i.VK)((()=>d.getContextValuesForAction(t)),[d,t]),F=(0,n.useCallback)((e=>{g(f,e)}),[g,f]),Z=(0,n.useCallback)((()=>y(f)),[y,f]),B=(0,n.useCallback)((e=>{h(f,e)}),[h,f]),K=(0,n.useCallback)((e=>{B({action:e,value:A})}),[A,B]),R=(0,n.useCallback)((e=>{B({action:T,value:e})}),[T,B]);if(!j||!V)return null;const O=me(_);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:k.propertyName,children:(0,P.jsx)(ne,{availablePropertyIds:o,currentValue:f,collectionStore:a,onChange:F,disabled:p,onRemove:Z})}),(0,P.jsxs)("div",{style:k.propertyValue,children:[S&&M&&l.Y[M.type]&&(0,P.jsx)(de,{disabled:p,onChange:K,value:T}),(0,P.jsx)(G,{...O,type:j,value:null==v?void 0:v.value,onChange:R,disabled:p,contextStore:d,context:b,placeholder:w,disableMobileActionBar:!0,formulaTypecheckContextValues:I,disableTemplateVariableMentions:!0})]})]})}function de(e){window.__c={n:"SetPropertyListActionDropdownButton"};const{disabled:t,onChange:o,value:n}=e,i=(0,r.yK)((e=>({button:{boxShadow:e.inputBoxShadow}})),[]),a=(0,ee.d)();return(0,P.jsx)(h.ZP,{popupType:a,alignmentToOrigin:h.vR.End,placementToOrigin:h.pO.Bottom,originGap:0,disabled:t,renderOrigin:e=>(0,P.jsx)(b.S,{...e,disabled:t,style:i.button,variant:"gray",children:(0,P.jsx)(pe,{action:n})}),render:e=>(0,P.jsx)(ue,{onChange:o,parent:e,value:n})})}function ue(e){window.__c={n:"SetPropertyListActionDropdownMenu"};const{value:t,onChange:o,parent:n}=e,i=(0,J.F)({width:250}),r=d.oA(s.E2.map(((e,i)=>({key:i,render:o=>(0,P.jsx)(y.Z,{...o,disabled:!1,title:(0,P.jsx)(pe,{action:e}),checkState:t===e}),action:()=>{e!==t&&o(e),n.close()}}))));return(0,P.jsx)(f.Z,{...i,children:(0,P.jsx)(S.Z,{type:S.i.Vertical,sections:[{key:0,render:e=>(0,P.jsx)(v.Z,{enableActionSheetTitle:!0,...e}),items:r}],initialFocus:0})})}function pe(e){const{action:t}=e;return"replace"===t?(0,P.jsx)(m.FormattedMessage,{...ie.replaceActionLabel}):"append"===t?(0,P.jsx)(m.FormattedMessage,{...ie.appendActionLabel}):"remove"===t?(0,P.jsx)(m.FormattedMessage,{...ie.removeActionLabel}):void(0,p.t1)(t)}function me(e){return"email"===e||"phone_number"===e||"url"===e?{disableEmojiCommands:!0,disableFormattingAndMentions:!0}:{}}},64973:(e,t,o)=>{o.d(t,{mv:()=>w,pW:()=>k,rn:()=>M});var n=o(67294),i=o(480),r=o(6740),a=o(37989),l=o(86628),s=o(24405),c=o(25651),d=o(37612),u=o(77744),p=o(97880),m=o(9291),g=o(64921),y=o(52275),h=o(78140),f=o(32163),S=o(72495),v=o(61766),x=o(95193),b=o(74197),C=o(85893);function k(e){window.__c={n:"AutomationBaseStepElement"};const{icon:t,onBlur:o,onClick:c,onFocus:d,onMouseDown:p,onMouseEnter:m,onMouseLeave:y,title:h,caption:f,onEdit:S,onDelete:x,disabled:b}=e,{isMobile:k}=(0,i.Fy)(),[M,j]=(0,r.Z)(),[_,A]=(0,a.Z)(),[T,P]=(0,n.useState)(!1),V=T||j||A,I=(0,u.lq)(M,_),F=(0,l.qz)(void 0,v.Z),Z=(0,s.yK)((e=>({button:{position:"relative"},moreButtonWrap:{display:V||k?"block":"none",position:"absolute",right:12,top:14},container:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:8,justifyContent:"center",paddingBlock:16,paddingInline:12},title:{alignItems:"center",display:"flex",flexDirection:"row",gap:6},iconWrap:{flexShrink:0,alignSelf:"baseline",height:"24px",display:"flex",alignItems:"center"},iconStyle:{width:16,height:16,color:e.mediumIconColor},body:{flex:"1 1 auto",fontSize:14,lineHeight:1.3,minWidth:0,whiteSpace:"pre"}})),[V,k]),B=(0,n.useCallback)((e=>{P(!0),m&&m(e)}),[m]),K=(0,n.useCallback)((e=>{P(!1),y&&y(e)}),[y]);return(0,C.jsxs)(g.Z,{onBlur:o,onClick:()=>{null==c||c(F)},onFocus:d,onMouseDown:p,onMouseEnter:B,onMouseLeave:K,style:Z.button,disabled:b,disabledFeedback:b,ref:I,focused:V,children:[!b&&(S||x)&&(0,C.jsx)("div",{style:Z.moreButtonWrap,children:(0,C.jsx)(w,{onEdit:S,onDelete:x,disabled:b,buttonPopupStore:F})}),(0,C.jsxs)("div",{style:Z.container,children:[(0,C.jsxs)("div",{style:Z.title,children:[t&&(0,C.jsx)("div",{"aria-hidden":"true",style:Z.iconWrap,children:t(Z.iconStyle)}),(0,C.jsx)("div",{style:Z.body,children:h})]}),f]})]})}function w(e){window.__c={n:"MoreActionsButton"};const{onDelete:t,onEdit:o,disabled:i,buttonPopupStore:r}=e,a=(0,l.qz)(r,v.Z),s=(0,n.useCallback)((()=>a.setState({open:!1})),[a]),c=(0,n.useMemo)((()=>(0,C.jsx)(M,{onClose:s,onEdit:o,onDelete:t})),[s,t,o]);return(0,C.jsx)(b.f,{actionMenu:c,buttonPopupStore:a,disabled:i})}function M(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:n}=e,i=(0,x.F)(),r=[o?{action:()=>{null==t||t(),o()},key:"edit",render:e=>(0,C.jsx)(y.Z,{...e,icon:(0,c.R)({height:16,width:16}),title:(0,C.jsx)(m.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit"})})}:void 0,n?{action:()=>{null==t||t(),n()},key:"delete",render:e=>(0,C.jsx)(y.Z,{...e,icon:(0,d.y)({height:16,width:16}),title:(0,C.jsx)(m.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete"})})}:void 0].filter(p.$K);return(0,C.jsx)(h.Z,{...i,children:(0,C.jsx)(f.Z,{type:f.i.Vertical,sections:[{items:r,key:"items",render:e=>(0,C.jsx)(S.Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}},73239:(e,t,o)=>{o.d(t,{a:()=>h});var n=o(67294),i=o(86628),r=o(84619),a=o(9291),l=o(31945),s=o(76798),c=o(21396),d=o(61766),u=o(26136),p=o(35294),m=o(40190),g=o(8808),y=o(85893);function h(e){window.__c={n:"AutomationCollectionPicker"};const{actionStore:t,currentValue:o,contextStore:h,onChange:f,disabled:S,dropdownButtonStyle:v,errorMessage:x,skipVariables:b}=e,C=(0,i.qz)(void 0,d.Z),k=(0,i.VK)((()=>o&&"collection"===o.type?u.NW.createChildStore(h.context.parentRecordStore,o.collection):void 0),[o,h.context.parentRecordStore]),w=(0,i.VK)((()=>{if(t&&o&&"variable"===o.type)return h.getContextValueForActionById(t.id,o.id)}),[t,o,h]),M=(0,n.useCallback)((e=>{"collection"!==e.type&&"variable"!==e.type||(f(e),C.reset())}),[f,C]),j=(0,n.useCallback)((()=>C.reset()),[C]),_=(0,p.d)(),A=(0,m.d)({errorMessage:x,hasValue:Boolean(k||w)});return(0,y.jsx)(l.ZP,{buttonPopupStore:C,popupType:_,alignmentToOrigin:l.vR.End,placementToOrigin:l.pO.Bottom,originGap:0,disabled:S,renderOrigin:e=>(0,y.jsx)(m.S,{...A,...e,disabled:S,style:v,children:k?(0,y.jsx)(s.Z,{store:k}):w?(0,y.jsx)(c.F,{format:r.lo.Medium,isSingle:!0,value:w}):(0,y.jsx)(a.FormattedMessage,{id:"automations.databasePicker.buttonPlaceholder",defaultMessage:"Select database"})}),render:e=>(0,y.jsx)(g.L,{actionId:null==t?void 0:t.id,automationContextStore:h,onChange:M,onClose:j,selectedTarget:o,skipPages:!0,skipVariables:b})})}},29180:(e,t,o)=>{o.d(t,{f:()=>b});var n=o(67294),i=o(480),r=o(86628),a=o(72126),l=o(21202),s=o(9291),c=o(40071),d=o(31945),u=o(78140),p=o(32163),m=o(76798),g=o(72495),y=o(26136),h=o(64737),f=o(95193),S=o(35294),v=o(40190),x=o(85893);function b(e){window.__c={n:"AutomationCollectionTemplatePicker"};const{collectionStore:t,currentTemplateId:o,onChange:n,disabled:a,errorMessage:c,dropdownButtonStyle:p}=e,g=(0,i.O7)(),{device:b}=g,k=(0,r.VK)((()=>{if(!t)return;if(o){const e=y.G.createChildStore(t,{id:o,spaceId:t.getSpaceId(),table:l.iU});if(!e.pathIsDead())return e}const e=t.getDefaultTemplatePageStore();return e&&!e.pathIsDead()?e:void 0}),[t,o]),w=(0,S.d)(),M=(0,v.d)({errorMessage:c,hasValue:!0}),j=(0,r.VK)((()=>(0,h.q)(t)),[t]),_=Boolean(o);return(0,x.jsx)(d.ZP,{popupType:w,alignmentToOrigin:d.vR.End,placementToOrigin:d.pO.Bottom,originGap:0,disabled:a,renderOrigin:e=>(0,x.jsx)(v.S,{...M,...e,disabled:a,style:{...p,minWidth:50},children:k&&(_||(0,h.w)(k))?(0,x.jsx)(m.Z,{store:k}):(0,x.jsx)(s.FormattedMessage,{id:"automations.templatePicker.buttonPlaceholder",defaultMessage:"Empty"})}),render:e=>{const o=(0,f.U)({device:b,width:280});return(0,x.jsx)(u.Z,{...o,children:t&&(0,x.jsx)(C,{collectionStore:t,templatePageStores:j,parent:e,onChange:n})})}})}function C(e){window.__c={n:"AutomationCollectionTemplateMenuList"};const{collectionStore:t,templatePageStores:o,parent:l,onChange:d}=e,u=(0,i.O7)(),{device:m}=u,y=(0,r.VK)((()=>t.getDefaultTemplatePageStore()),[t]),h=o.map((e=>({key:e.id,render:o=>(0,n.createElement)(c.Z,{...o,key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:m.isMobile,locked:!0,isDefault:y===e,onCancelClick:()=>{},draggable:!1}),action:t=>{d(e.id),l.close()}}))),f={key:"empty",render:e=>(0,n.createElement)(c.Z,{...e,key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isMobile:m.isMobile,locked:!0,onCancelClick:()=>{},draggable:!1}),action:e=>{d(void 0),l.close()}};return(0,x.jsx)(p.Z,{type:p.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,x.jsx)(g.Z,{...e,title:(0,x.jsx)(s.FormattedMessage,{id:"automations.templatePicker.menuHeader",defaultMessage:"Select a template"})}),items:a.oA([...h,y?void 0:f])}]})}},52105:(e,t,o)=>{o.d(t,{W:()=>f,m:()=>S});var n=o(67294),i=o(86628),r=o(76205),a=o(9291),l=o(6758),s=o(42917),c=o(31945),d=o(8982),u=o(78140),p=o(72495),m=o(95193),g=o(35294),y=o(40190),h=o(85893);function f(e){var t;window.__c={n:"AutomationCombinatorFilterPopup"};const{filter:o,onChange:n,noFiltersMessage:i,collectionStore:l,disabled:s}=e,d=(0,g.d)({tabletBehavior:"slideUp"}),u=(null==o||null===(t=o.filters)||void 0===t?void 0:t.length)||0;return(0,h.jsx)(c.ZP,{popupType:d,alignmentToOrigin:c.vR.End,placementToOrigin:c.pO.Bottom,originGap:0,disabled:s,renderOrigin:e=>(0,h.jsx)(y.S,{disabled:s,variant:"gray",...e,onClick:t=>{e.onClick(t),0===u&&n(r.TI)},children:u>0?(0,h.jsx)(a.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.QueryCollectionAction.filterRuleCount.label",values:{ruleCount:u}}):i}),render:e=>(0,h.jsx)(S,{collectionStore:l,disabled:s,filter:o,onChange:n,onClose:()=>e.close()})})}function S(e){window.__c={n:"AutomationCombinatorFilterMenu"};const{filter:t,onChange:o,onClose:c,collectionStore:g}=e,y=(0,i.VK)((()=>g.getSchema()),[g]),f=(0,m.F)({minWidth:300,tabletBehavior:"actionSheet"}),S=(0,n.useCallback)(((e,t)=>o(t)),[o]),v=(0,n.useCallback)((()=>{o(void 0),c()}),[o,c]);return(0,h.jsxs)(u.Z,{...f,children:[(0,h.jsx)(d.D,{children:(0,h.jsx)(l.Pq,{collectionViewId:"Automation.FilterMenu",collectionViewType:"table",combinatorFilter:t||r.hh,index:0,level:0,onChange:S,parentStore:g,schema:y})}),(0,h.jsx)(p.Z,{topBorder:!0,children:(0,h.jsx)(s.Z,{title:(0,h.jsx)(a.FormattedMessage,{defaultMessage:"Delete filter",id:"automations.AutomationCombinatorFilterPopup.deleteFilter.label"}),onClick:v})})]})}},40190:(e,t,o)=>{o.d(t,{S:()=>g,d:()=>y});var n=o(67294),i=o(480),r=o(24405),a=o(42853),l=o(54497),s=o(82990),c=o(24677),d=o(98104),u=o(89728),p=o(26388),m=o(85893);const g=n.forwardRef(((e,t)=>{window.__c={n:"AutomationDropdownButton"};const{variant:o,onClick:g,style:y,icon:h,children:f,disabled:S}=e,v=(0,i.O7)(),x=(0,r.yK)((e=>({button:{..."gray"===o&&{color:e.mediumTextColor},..."blue"===o&&{color:e.blueColor,fontWeight:500},..."error"===o&&{color:e.errorText},maxWidth:"calc(100% + 2px)",marginLeft:1,padding:"0 8px 0 5px",...y},warningIcon:{width:12,height:12,marginLeft:-6,marginLeft:6,fill:e.errorText,color:e.errorText},chevronIcon:{width:10,height:10,marginLeft:4,marginTop:2,fill:e.lightIconColor},spacer:{flexGrow:1}})),[o,y]),b=(0,n.useCallback)((e=>{d.ZH(v),c.ZH(v),null==g||g(e)}),[g,v]);return(0,m.jsx)(p.ZP,{renderTooltip:()=>"error"===o?e.errorMessage:null,placement:p.ug.Bottom,disableTooltip:"error"!==o,delayThreshold:0,render:e=>(0,m.jsxs)(u.Z,{...e,style:x.button,icon:h,onClick:b,ref:t,shouldShrink:!0,disabled:S,disabledFeedback:S,children:[(0,m.jsx)("div",{style:{...s.Z.textOverflowStyle},children:f}),(0,m.jsx)("div",{style:x.spacer}),"error"===o&&(0,l.t)(x.warningIcon),(0,a.i)(x.chevronIcon)]})})}));function y(e){const{errorMessage:t,hasValue:o}=e;return(0,n.useMemo)((()=>t?{variant:"error",errorMessage:t}:o?{variant:"gray"}:{variant:"blue"}),[t,o])}},28607:(e,t,o)=>{o.d(t,{D:()=>a});o(67294);var n=o(24405),i=o(64921),r=o(85893);function a(e){window.__c={n:"AutomationEmptyStepButton"};const{ariaLabel:t,icon:o,onClick:a,title:l}=e,s=(0,n.yK)((e=>({button:{alignItems:"center",background:e.sidebarBackground,border:`1px dashed ${e.stroke.regular}`,borderRadius:6,display:"flex",color:e.accentColors.gray[900],gap:6,justifyContent:"center",padding:16},buttonWrap:{background:e.sidebarBackground,position:"relative"},iconWrap:{fill:e.accentColors.gray[600]},title:{fontSize:14,lineHeight:1.3}})),[]);return(0,r.jsx)("div",{style:s.buttonWrap,children:(0,r.jsxs)(i.Z,{ariaLabel:t,onClick:a,style:s.button,children:[o&&(0,r.jsx)("div",{"aria-hidden":"true",style:s.iconWrap,children:o}),(0,r.jsx)("div",{style:s.title,children:l})]})})}},27681:(e,t,o)=>{o.d(t,{_v:()=>ye,mR:()=>pe,vs:()=>me});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(47453),s=o(97880),c=o(82990),d=o(9291),u=o(52275),p=o(31945),m=o(73063),g=o(26388),y=o(7944),h=o(61766),f=o(12455),S=o(73266),v=o(35294),x=o(10383),b=o(28751),C=o(9953),k=o(51592),w=o(41301),M=o(64737),j=o(20804),_=o(32984),A=o(73239),T=o(29180),P=o(80253),V=o(85893);function I(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,errorMessage:i,onChange:l,value:s}=e,u=(0,a.yK)((()=>({b:{fontWeight:c.Z.fontWeight.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]),p=(0,r.VK)((()=>{let e;if("collection"===(null==s?void 0:s.type)){const o=t.getRecordModel(s.collection);e=null==o?void 0:o.getDatabaseType()}return(0,k.sN)(e)}),[t,s]);return(0,V.jsxs)("div",{style:u.title,children:[(0,V.jsx)(d.FormattedMessage,{defaultMessage:"<span>Add <b>{itemType}</b> to </span>{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{b:e=>(0,V.jsx)("b",{style:u.b,children:e}),collectionPicker:(0,V.jsx)("div",{style:u.picker,children:(0,V.jsx)(A.a,{actionStore:t,contextStore:o,currentValue:s,disabled:n,dropdownButtonStyle:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},errorMessage:i,onChange:l})}),itemType:p,span:e=>(0,V.jsx)("span",{style:u.span,children:e})}})," "]})}function F(e){window.__c={n:"CollectionTemplateTitle"};const{collectionStore:t,disabled:o,errorMessage:n,onChange:i,value:r}=e,l=(0,a.yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,V.jsx)("div",{style:l.title,children:(0,V.jsx)(d.FormattedMessage,{defaultMessage:"<span>as </span>{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,V.jsx)(T.f,{collectionStore:t,currentTemplateId:r,disabled:o,dropdownButtonStyle:{height:"auto",marginBlock:-6,marginInline:-5,paddingBlock:6,paddingInline:5},errorMessage:n,onChange:i}),span:e=>(0,V.jsx)("span",{style:l.span,children:e})}})})}var Z=o(26612),B=o(98963),K=o(72865),R=o(19471);const O=(0,d.defineMessages)({confirmationMessageLabel:{defaultMessage:"Confirmation message",id:"automations.BaseModalAction.confirmationMessageLabel"},continueButtonTextLabel:{defaultMessage:"Continue button text",id:"automations.BaseModalAction.continueButtonTextLabel"},cancelButtonTextLabel:{defaultMessage:"Cancel button text",id:"automations.BaseModalAction.cancelButtonTextLabel"}});var W=o(23877),D=o(78140),E=o(32163),N=o(72495),L=o(95193),z=o(40190),H=o(48309);function U(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,errorMessage:i,onChange:r,value:l}=e,s=(0,a.yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,V.jsxs)("div",{style:s.title,children:[(0,V.jsx)(d.FormattedMessage,{defaultMessage:"<span>Open </span>{pagePicker}",id:"automations.OpenPageAction.action.title",values:{pagePicker:(0,V.jsx)("div",{style:s.picker,children:(0,V.jsx)(H.s,{actionStore:t,contextStore:o,disabled:n,dropdownButtonStyle:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},errorMessage:i,onChange:r,target:l})}),span:e=>(0,V.jsx)("span",{style:s.span,children:e})}})," "]})}function $(e){window.__c={n:"PeekModeTitle"};const{actionStore:t,disabled:o,onChange:n}=e,i=(0,a.yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]),l=(0,r.VK)((()=>t.getOpenPageIn()),[t]);return(0,V.jsx)("div",{style:i.title,children:(0,V.jsx)(d.FormattedMessage,{defaultMessage:"<span>in </span>{peekModePicker}",id:"automations.OpenPageAction.peekMode.title",values:{peekModePicker:(0,V.jsx)("div",{style:i.picker,children:(0,V.jsx)(q,{disabled:o,dropdownButtonStyle:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},onChange:n,value:l})}),span:e=>(0,V.jsx)("span",{style:i.span,children:e})}})})}function q(e){window.__c={n:"AutomationPeekModePicker"};const{disabled:t,dropdownButtonStyle:o,onChange:i,value:l}=e,s=(0,a.Fg)(),c=(0,r.qz)(void 0,h.Z),d=(0,r.VK)((()=>(0,W.v)({currentViewType:void 0,theme:s}).find((e=>e.key===l))),[l,s]),u=(0,n.useCallback)((()=>c.reset()),[c]),m=(0,n.useCallback)((e=>{e!==(null==d?void 0:d.key)&&i(e),u()}),[u,null==d?void 0:d.key,i]),g=(0,v.d)();return d?(0,V.jsx)(p.ZP,{alignmentToOrigin:p.vR.End,buttonPopupStore:c,disabled:t,originGap:0,placementToOrigin:p.pO.Bottom,popupType:g,renderOrigin:e=>(0,V.jsx)(z.S,{...e,disabled:t,style:o,variant:"gray",children:d.title}),render:e=>(0,V.jsx)(G,{onChange:m,value:l})}):null}function G(e){window.__c={n:"PeekModeMenu"};const{onChange:t,value:o}=e,n=(0,a.Fg)(),i=(0,a.yK)((()=>({menuItem:{paddingBlock:8}})),[]),l=(0,L.F)({maxWidth:360,width:280}),s=[{key:0,render:e=>(0,V.jsx)(N.Z,{enableActionSheetTitle:!0,...e}),items:(0,r.VK)((()=>(0,W.v)({currentViewType:void 0,theme:n}).map(((e,n)=>({action:()=>t(e.key),key:n,render:t=>(0,V.jsx)(u.Z,{...t,body:e.body,caption:e.caption,checkState:o===e.key,disabled:!1,icon:e.icon,style:i.menuItem,title:e.title})})))),[t,i.menuItem,n,o])}];return(0,V.jsx)(D.Z,{...l,children:(0,V.jsx)(E.Z,{initialFocus:0,sections:s,type:E.i.Vertical})})}var Q=o(67174);const Y=()=>null,X={create_page:function(e){window.__c={n:"CreatePageAction"};const{actionStore:t,disabled:o}=e,{automationContextStore:i,suppressActionErrors:a,maybePersistedTransactionActions:l}=(0,f.i)(),c=(0,b.z)("create_page"),{display:d}=c,[u,p]=(0,r.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),[m,g]=(0,r.VK)((()=>{const e=t.getCollectionStore();return null!=e&&e.isDefined()?[e,{collection:e.getSpaceShardedPointer(),type:"collection"}]:[void 0,void 0]}),[t]),y=(0,r.VK)((()=>(0,M.q)(m).length>0),[m]),S=(0,r.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),v=(0,n.useMemo)((()=>({values:p??{},properties:u??[]})),[p,u]),x=(0,r.qz)(void 0,h.Z),k=(0,n.useCallback)((()=>x.reset()),[x]),A=(0,n.useMemo)((()=>(0,V.jsx)(j.e,{actionStore:t,closeMenu:k})),[t,k]),T=(0,n.useCallback)((e=>{"collection"===e.type&&l.createAndCommit({perform:o=>{C.sW({data:{collection:e.collection,properties:["title"],template_page_id:null,values:null},store:t.getConfigStore(),transaction:o})},userAction:"CreatePageAction.setCollection"})}),[t,l]),Z=(0,n.useCallback)((e=>{const{properties:o,values:n}=v;let i=!1;if(e&&o&&1===o.length&&o.includes("title")){var r;const e=null==n?void 0:n.title;e&&null!==(r=e.value)&&void 0!==r&&r.value||(i=!0)}l.createAndCommit({perform:o=>{C.sW({store:t.getConfigStore(),data:{template_page_id:e??null,...i&&{properties:[]}},transaction:o})},userAction:"CreatePageAction.onTemplateChange"})}),[t,l,v]),B=(0,n.useMemo)((()=>!a.includes(t.id)),[a,t]),K=(0,w.TU)({actionId:t.id,contextStore:i,errorKey:"collection",shouldShow:B}),R=(0,w.TU)({actionId:t.id,contextStore:i,errorKey:"template",shouldShow:B});if(!i)return null;const O=Boolean(o);return(0,V.jsxs)(P.Ao,{actionMenu:A,buttonPopupStore:x,disabled:O,children:[(0,V.jsxs)(P.vu,{disabled:O,icon:d.icon,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:[(0,V.jsx)(I,{actionStore:t,automationContextStore:i,disabled:O,errorMessage:K,onChange:T,value:g}),(0,s.$K)(m)&&y&&(0,V.jsx)(F,{collectionStore:m,disabled:O,errorMessage:R,onChange:Z,value:S})]}),m&&(0,V.jsx)(P.R7,{disabled:O,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,V.jsx)(_.QF,{actionStore:t,collectionStore:m,contextStore:i,disabled:O,showSetPropertyActions:!1})})]})},update_pages:o(26247).B,query_collection:Y,open_page:function(e){window.__c={n:"OpenPageAction"};const{actionStore:t,disabled:o}=e,{automationContextStore:i,maybePersistedTransactionActions:a,suppressActionErrors:l}=(0,f.i)(),s=(0,r.qz)(void 0,h.Z),c=(0,b.z)("open_page"),{display:d}=c,u=(0,r.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),p=(0,n.useMemo)((()=>({headerWrap:{paddingInlineEnd:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}})),[]),m=(0,n.useCallback)((e=>{a.createAndCommit({perform:o=>{C.sW({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"OpenPageAction.setTarget"})}),[a,t]),g=(0,n.useCallback)((e=>{a.createAndCommit({perform:o=>{C.sW({store:t.getConfigStore(),data:{open_in:e},transaction:o})},userAction:"OpenPageAction.setPeekMode"})}),[a,t]),y=(0,n.useCallback)((()=>s.reset()),[s]),S=(0,n.useMemo)((()=>!l.includes(t.id)),[l,t]),v=(0,w.TU)({actionId:t.id,contextStore:i,shouldShow:S}),x=(0,n.useMemo)((()=>(0,V.jsx)(j.e,{actionStore:t,closeMenu:y})),[t,y]);if(!i)return null;const k=Boolean(o);return(0,V.jsx)(P.Ao,{actionMenu:x,buttonPopupStore:s,children:(0,V.jsxs)(P.vu,{disabled:k,icon:d.icon,styles:p,children:[(0,V.jsx)(U,{actionStore:t,automationContextStore:i,disabled:k,errorMessage:v,onChange:m,value:u}),(0,V.jsx)($,{actionStore:t,disabled:k,onChange:g})]})})},duplicate_blocks:Z.JM,modal_confirmation:function(e){window.__c={n:"ModalConfirmationAction"};const{actionStore:t,disabled:o}=e,l=(0,d.useIntl)(),{automationContextStore:s,maybePersistedTransactionActions:u}=(0,f.i)(),p=function(){const{isMobile:e}=(0,i.Fy)();return(0,a.yK)((t=>({wrap:{display:"flex",flexDirection:"column",gap:10},inputLabel:{color:t.lightTextColor,fontSize:e?14:12,lineHeight:1.3,fontWeight:c.Z.fontWeight.medium},input:{backgroundColor:t.contentBackground,paddingTop:6,paddingBottom:6}})),[e])}(),m=(0,b.z)("modal_confirmation"),g=(0,r.qz)(void 0,h.Z),y=(0,n.useCallback)((()=>g.reset()),[g]),S=(0,n.useMemo)((()=>(0,V.jsx)(j.e,{actionStore:t,closeMenu:y})),[t,y]),v=(0,r.VK)((()=>t.getConfigStore().getKeyStore("text")),[t]),x=(0,r.VK)((()=>v.getValue()),[v]),k=(0,r.VK)((()=>t.getConfigStore().getKeyStore("continue_button").getKeyStore("text")),[t]),w=(0,r.VK)((()=>t.getConfigStore().getKeyStore("cancel_button").getKeyStore("text")),[t]),M=(0,n.useCallback)((e=>{u.createAndCommit({userAction:"BaseModalAction.handleTextChange",perform:t=>{C.sO({store:v,value:e,transaction:t})}})}),[u,v]);if(!s)return null;const _=Boolean(o);return(0,V.jsxs)(P.Ao,{actionMenu:S,buttonPopupStore:g,disabled:_,children:[(0,V.jsx)(P.vu,{disabled:_,icon:m.display.icon,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,V.jsx)(d.FormattedMessage,{...m.display.name})}),(0,V.jsxs)(P.R7,{disabled:_,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,V.jsx)("label",{style:p.inputLabel,children:(0,V.jsx)(d.FormattedMessage,{...O.confirmationMessageLabel})}),(0,V.jsx)(K.D,{disabled:_,value:x,onChange:M,multiline:!0,placeholder:l.formatMessage(O.confirmationMessageLabel),disableFormattingAndMentions:!0,disableMobileActionBar:!0}),(0,V.jsx)("label",{style:p.inputLabel,children:(0,V.jsx)(d.FormattedMessage,{...O.continueButtonTextLabel})}),(0,V.jsx)(R.W_,{disabled:_,maxlength:B.OO,style:p.input,store:k}),(0,V.jsx)("label",{style:p.inputLabel,children:(0,V.jsx)(d.FormattedMessage,{...O.cancelButtonTextLabel})}),(0,V.jsx)(R.W_,{disabled:_,maxlength:B.OO,style:p.input,store:w})]})]})},slack_notification:Q.e,assistant:Y};var J=o(28607),ee=o(93060),te=o(8161),oe=o(56812),ne=o(66315);function ie(){window.__c={n:"ButtonClickedTrigger"};const e=(0,d.useIntl)(),{automationContextStore:t}=(0,f.i)();if(!ae((0,r.VK)((()=>null==t?void 0:t.context.automationStore),[t])))return null;const o=e.formatMessage(oe.Bo.triggerButtonClicked,{b:re});return(0,V.jsx)(ne.R,{icon:te.e,tooltip:o,children:o})}function re(e){return(0,V.jsx)("span",{style:{fontWeight:c.Z.fontWeight.medium},children:e})}function ae(e){return(0,r.VK)((()=>Boolean(null==e?void 0:e.isTriggerType("button"))),[e])}var le=o(53570);function se(){window.__c={n:"PageAddedTrigger"};const{automationStore:e}=(0,f.i)(),{removePageAddedTrigger:t}=(0,le.i)(),o=(0,d.useIntl)(),n=(0,a.yK)((()=>({title:{fontWeight:c.Z.fontWeight.medium}})),[]);if(!ce(e))return null;const i=oe.Mz(o);return(0,V.jsx)(ne.R,{icon:l.R,onDelete:t,tooltip:i,children:(0,V.jsx)("div",{style:n.title,children:i})})}function ce(e){return(0,r.VK)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("notification_event")))return!1;const t=e.getEventConfiguration();return Boolean(null==t?void 0:t.pagesAdded)}),[e])}var de=o(61036),ue=o(55307);const pe="automation-list-item",me="automation-list-item-narrow";function ge(e){window.__c={n:"List"};const{children:t,ruleTopOffset:o}=e,n=(0,S.Z)(),i=(0,a.yK)((e=>({wrap:{position:"relative"},list:{display:"grid",gap:n?0:8,gridTemplateColumns:"1fr"},verticalRule:{background:e.stroke.regular,bottom:0,left:20,position:"absolute",top:o??0,width:1}})),[n,o]);return(0,V.jsxs)("div",{style:i.wrap,children:[(0,V.jsx)("div",{style:i.verticalRule}),(0,V.jsx)("div",{style:i.list,children:t})]})}function ye(e){window.__c={n:"AutomationWorkflowEditor"};const{areActionsEditable:t,areTriggersEditable:o}=e,n=(0,a.yK)((e=>({verticalRule:{background:e.stroke.regular,marginLeft:20,height:36,width:1}})),[]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(fe,{isEditable:o}),(0,V.jsx)("div",{style:n.verticalRule}),(0,V.jsx)(ve,{isEditable:t})]})}function he(e){window.__c={n:"AddTriggerButton"};const{variant:t}=e,o=(0,v.d)(),i=(0,d.useIntl)(),r=(0,n.useMemo)((()=>({type:"eventTriggers"})),[]);return(0,V.jsx)(p.ZP,{alignmentToOrigin:p.vR.End,placementToOrigin:p.pO.Bottom,popupType:o,render:e=>(0,V.jsx)(ue.Z,{initialState:r,buttonPopupParent:e}),renderOrigin:e=>"icon"===t?(0,V.jsx)(m.Z,{...e,ariaLabel:i.formatMessage(y.s.addTriggerAriaLabel),icon:l.R}):(0,V.jsx)(J.D,{...e,ariaLabel:i.formatMessage(y.s.addTriggerAriaLabel),icon:(0,l.R)({height:24,width:12}),title:(0,V.jsx)(d.FormattedMessage,{...y.s.addTriggerLabel})})})}function fe(e){window.__c={n:"AutomationTriggerList"};const{isEditable:t}=e,{isMobile:o}=(0,i.Fy)(),{showAnyPropertyTriggers:n,showButtonClickedTrigger:l,showPageAddedTrigger:s}=function(){const{automationContextStore:e}=(0,f.i)(),t=(0,r.VK)((()=>null==e?void 0:e.context.automationStore),[e]),o=ae(t),n=ce(t);return{showAnyPropertyTriggers:(0,de.Zr)(t),showPageAddedTrigger:n,showButtonClickedTrigger:o}}(),u=n||l||s,p=(0,a.yK)((e=>({section:{display:"flex",flexDirection:"column",gap:6},header:{alignItems:"center",display:"flex",flexDirection:"row"},headerAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0,visibility:u?void 0:"hidden"},title:{color:e.lightTextColor,fontSize:o?14:12,lineHeight:1.3,fontWeight:c.Z.fontWeight.medium}})),[u,o]);return(0,V.jsxs)("section",{style:p.section,children:[(0,V.jsxs)("header",{style:p.header,children:[(0,V.jsx)("div",{style:p.title,children:(0,V.jsx)(d.FormattedMessage,{...y.s.triggerTitle})}),t&&(0,V.jsx)("div",{style:p.headerAdd,children:(0,V.jsx)(he,{variant:"icon"})})]}),(0,V.jsxs)(ge,{children:[l&&(0,V.jsx)(ie,{}),s&&(0,V.jsx)(se,{}),n&&(0,V.jsx)(de.Dl,{}),!u&&t&&(0,V.jsx)(he,{variant:"button"})]})]})}function Se(e){window.__c={n:"AddActionButton"};const{actionCount:t,variant:o}=e,{isMobile:s}=(0,i.Fy)(),c=(0,v.d)(),g=(0,d.useIntl)(),f=(0,n.useMemo)((()=>({availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"})),[]),S=(0,r.qz)(void 0,h.Z),b=(0,n.useCallback)((()=>S.reset()),[S]),C=(0,a.yK)((e=>({buttonWrap:{boxShadow:"initial",background:"transparent"},button:{color:e.mediumTextColor,fill:e.mediumIconColor,margin:0,width:"100%"},buttonIcon:{height:s?18:16,width:24}})),[s]),k=t>0;return(0,V.jsx)(p.ZP,{alignmentToOrigin:p.vR.Start,buttonPopupStore:S,placementToOrigin:p.pO.Bottom,popupType:c,render:()=>(0,V.jsx)(x.Z,{initialState:f,onClose:b}),renderOrigin:e=>"icon"===o?(0,V.jsx)(m.Z,{...e,ariaLabel:g.formatMessage(y.s.addActionAriaLabel),icon:l.R}):"button"===o?(0,V.jsx)(J.D,{...e,ariaLabel:g.formatMessage(y.s.addActionAriaLabel),icon:(0,l.R)({height:24,width:12}),title:(0,V.jsx)(d.FormattedMessage,{...y.s.addActionLabel})}):(0,V.jsx)(u.Z,{...e,buttonStyle:C.button,focused:!1,icon:(0,l.R)(C.buttonIcon),style:C.buttonWrap,title:k?(0,V.jsx)(d.FormattedMessage,{id:"automations.addActionButton.nonEmpty.label",defaultMessage:"Add another step"}):(0,V.jsx)(d.FormattedMessage,{id:"automations.addActionButton.empty.label",defaultMessage:"Add a step"})})})}function ve(e){window.__c={n:"AutomationActionList"};const{isEditable:t}=e,{isMobile:o}=(0,i.Fy)(),{automationContextStore:n}=(0,f.i)(),l=(0,r.VK)((()=>{var e;return(null==n||null===(e=n.context.automationStore)||void 0===e?void 0:e.getActionStores().map((e=>{if(!e.hasConcern("display"))return;const t=e.getType();return t?{store:e,type:t}:void 0})).filter(s.$K))??[]}),[n]),u=l.length>0,p=(0,a.yK)((e=>({section:{display:"flex",flexDirection:"column",gap:6},header:{alignItems:"center",display:"flex",flexDirection:"row"},headerAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0,visibility:u?void 0:"hidden"},title:{color:e.lightTextColor,fontSize:o?14:12,lineHeight:1.3,fontWeight:c.Z.fontWeight.medium}})),[u,o]);return(0,V.jsxs)("section",{style:p.section,children:[(0,V.jsxs)("header",{style:p.header,children:[(0,V.jsx)("div",{style:p.title,children:(0,V.jsx)(d.FormattedMessage,{...y.s.actionTitle})}),t&&(0,V.jsx)("div",{style:p.headerAdd,children:(0,V.jsx)(Se,{actionCount:l.length,variant:"icon"})})]}),(0,V.jsxs)(ge,{ruleTopOffset:-6,children:[l.map(((e,t,o)=>(0,V.jsx)(xe,{actionStore:e.store,actionType:e.type},e.store.id))),!u&&t&&(0,V.jsx)(Se,{actionCount:l.length,variant:"button"})]}),t&&u&&(0,V.jsx)("footer",{children:(0,V.jsx)(Se,{actionCount:l.length,variant:"menuitem"})})]})}function xe(e){window.__c={n:"AutomationActionListItem"};const{actionStore:t,actionType:o}=e,{disabled:i,disableTooltip:r}=(0,f.i)(),a=(0,S.Z)(),l=X[o];const s=(0,n.useMemo)((()=>`${pe} ${a?me:""}`),[a]),c=(0,n.useCallback)((e=>(0,V.jsx)(l,{...e,actionStore:t,disabled:Boolean(i)})),[l,t,i]);return(0,V.jsx)("div",{className:s,children:(0,V.jsx)(ee.y,{disable:r,renderOrigin:c,title:"Tooltip title",tooltipAlignment:g.v2.Center,tooltipPlacement:g.ug.Left})})}},48309:(e,t,o)=>{o.d(t,{s:()=>h});var n=o(67294),i=o(86628),r=o(84619),a=o(9291),l=o(31945),s=o(76798),c=o(21396),d=o(61766),u=o(26136),p=o(35294),m=o(40190),g=o(8808),y=o(85893);function h(e){window.__c={n:"AutomationPagePicker"};const{contextStore:t,actionStore:o,target:h,onChange:f,disabled:S,errorMessage:v,dropdownButtonStyle:x}=e,b=(0,i.qz)(void 0,d.Z),C=(0,i.VK)((()=>{if(h&&"variable"===h.type)return t.getContextValueForActionById(o.id,h.id)}),[h,t,o.id]),k=(0,p.d)(),w=(0,m.d)({errorMessage:v,hasValue:Boolean(h)}),M=(0,n.useCallback)((e=>{"page"!==e.type&&"variable"!==e.type||(f(e),b.reset())}),[f,b]),j=(0,n.useCallback)((()=>b.reset()),[b]);return(0,y.jsx)(l.ZP,{buttonPopupStore:b,popupType:k,alignmentToOrigin:l.vR.End,placementToOrigin:l.pO.Bottom,originGap:0,disabled:S,renderOrigin:e=>(0,y.jsx)(m.S,{...e,...w,disabled:S,style:x,children:h&&"page"===h.type?(0,y.jsx)(s.Z,{store:u.G.createChildStore(t.context.parentRecordStore,h.page)}):C?(0,y.jsx)(c.F,{value:C,format:r.lo.Medium,isSingle:!0}):(0,y.jsx)(a.FormattedMessage,{id:"automations.AutomationPagePicker.pagesDropdown.label",defaultMessage:"Select page"})}),render:e=>(0,y.jsx)(g.L,{actionId:o.id,automationContextStore:t,onChange:M,onClose:j,selectedTarget:h,skipCollections:!0})})}},8808:(e,t,o)=>{o.d(t,{H:()=>L,L:()=>N});o(57658),o(21703);var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(84619),s=o(23790),c=o(84116),d=o(78106),u=o(58573),p=o(59054),m=o(56666),g=o(72126),y=o(4615),h=o(21202),f=o(6287),S=o(97880),v=o(9291),x=o(8406),b=o(73657),C=o(71846),k=o(52275),w=o(68894),M=o(78140),j=o(32163),_=o(11470),A=o(72495),T=o(26388),P=o(21396),V=o(78948),I=o(87279),F=o(98742),Z=o(77907),B=o(75822),K=o(80444),R=o(29798),O=o(26136),W=o(95193),D=o(85893);const E=(0,v.defineMessages)({searchInputPlaceholder:{defaultMessage:"Select blocks to edit…",id:"automations.AutomationTargetPickerMenu.search.placeholder"}});function N(e){window.__c={n:"AutomationTargetPickerMenu"};const t=(0,i.O7)(),o=(0,W.F)({maxWidth:360,paddingTop:12,width:280}),r=(0,n.useMemo)((()=>(0,y.ZP)()),[]),a=(0,n.useCallback)((()=>{x.tW({environment:t,eventName:"abandoned_search",sessionId:r,source:C.S.Automation})}),[t,r]);return o.menuType===I.og.Popup&&(o.onClickOutside=a),(0,D.jsx)(M.Z,{...o,children:(0,D.jsx)(L,{...e,searchSessionId:r})})}function L(e){window.__c={n:"AutomationTargetPickerMenuChildren"};const{actionId:t,automationContextStore:o,onChange:a,onClose:m,selectedTarget:y,skipCollections:w,skipPages:M,skipVariables:I,searchSessionId:W}=e,E=(0,i.O7)(),N=(0,r.qz)(void 0,R.Z),L=(0,r.VK)((()=>{const{context:e}=o;if("button_property"===e.type)return e.collectionContextStore.collectionViewBlockStore()}),[o]),q=(0,r.VK)((()=>{if(I)return[];const e=(0,S.$K)(t)?o.getContextValuesForAction(t):o.getAllContextValues();if(e){return Object.values(e).filter((e=>{if(!(0,s.uy)(e.type,{type:"block"}))return!1;if("event"===o.context.type&&e.kind===c.yp.ContextValue){const t=(0,d.MY)(e.id);return!("global"===t.source&&"button_page"===t.global)}return!0}))}return[]}),[I,o,t],{useDeepEqual:!0}),G=(0,n.useMemo)((()=>o.context.parentRecordStore),[o.context]),Q=(0,r.VK)((()=>G.getSpaceId()),[G]),[Y,X]=(0,n.useReducer)(U,{automationVariables:[],collectionQueryLimit:5,pageQueryLimit:5,searchTerm:""});(0,n.useEffect)((()=>{if(Y.searchTerm){const e=(0,u.ZP)(Y.searchTerm,q,(e=>e.kind===c.yp.ContextValue?e.name:""));X({type:"set_variables",variables:e})}else X({type:"set_variables",variables:q})}),[Y.searchTerm,q]);const J=function(e){const{collectionViewBlockStore:t,limit:o,parentStore:a,searchTerm:l,skip:s}=e,c=(0,i.O7)(),d=(0,r.VK)((()=>K.default.state.currentSpaceStore),[]),[u,m]=(0,n.useReducer)($,{error:void 0,isLoading:Boolean(s),results:void 0,total:void 0}),g=(0,Z.useDependency)(Z.deps.searchActions),[y]=(0,p.r5)((async()=>{if(s||"resolved"!==g.status)return;const e=g.value,n=await e.searchCollectionsWithRecents({collectionViewBlockStore:t,environment:c,spaceStore:d,limit:o,parentStore:a,query:l,requireEditPermissions:!0});return{results:n.results,total:n.total}}),[t,c,o,a,l,s,g.status,g.value,d],{debounce:B.vp});return(0,n.useEffect)((()=>{if("pending"===y.status||"idle"===y.status)m({type:"query_loadstart"});else if("resolved"===y.status){var e,t;m({results:null===(e=y.value)||void 0===e?void 0:e.results,total:null===(t=y.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===y.status?m({error:y.error,type:"query_error"}):(0,S.t1)(y)}),[y]),u}({collectionViewBlockStore:L,limit:Y.collectionQueryLimit,parentStore:G,searchTerm:Y.searchTerm,skip:w}),ee=function(e){const{limit:t,searchTerm:o,skip:r,spaceId:a}=e,l=(0,i.O7)(),[s,c]=(0,n.useReducer)($,{error:void 0,isLoading:Boolean(r),results:void 0,total:void 0}),[d]=(0,p.r5)((async()=>{if(r||!a)return;const e=await Z.deps.searchActions.loader(),n=await e.searchPagesInSpace({boostRecentlyViewedPages:!0,environment:l,excludeTemplates:!0,limit:t,query:o,requireEditPermissions:!1,source:"automation_page_picker",spaceId:a});return{results:n.results.map((e=>e.id)),total:n.total}}),[l,t,o,r,a],{debounce:B.vp});return(0,n.useEffect)((()=>{if("pending"===d.status||"idle"===d.status)c({type:"query_loadstart"});else if("resolved"===d.status){var e,t;c({results:null===(e=d.value)||void 0===e?void 0:e.results,total:null===(t=d.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===d.status?c({error:d.error,type:"query_error"}):(0,S.t1)(d)}),[d]),s}({limit:Y.pageQueryLimit,searchTerm:Y.searchTerm,skip:M,spaceId:Q}),te=(0,n.useCallback)((e=>{"collection"===e.type&&x.tW({environment:E,eventName:"select_search_item",queryLength:Y.searchTerm.length,sessionId:W,source:C.S.Automation,totalResults:J.total}),y&&!g.Xy(y,e)?a(e):y?m():a(e)}),[E,W,Y.searchTerm,J.total,y,a,m]),oe=(0,n.useCallback)((e=>{const t=e.target.value;X({searchTerm:t,type:"set_search_term"}),N.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[N]),ne=(0,n.useCallback)((()=>{X({queryLimit:Y.collectionQueryLimit+20,type:"set_collection_query_limit"})}),[Y.collectionQueryLimit]),ie=(0,n.useCallback)((()=>{X({queryLimit:Y.pageQueryLimit+20,type:"set_page_query_limit"})}),[Y.pageQueryLimit]),re="variable"===(null==y?void 0:y.type)?y.id:void 0,ae="collection"===(null==y?void 0:y.type)?y.collection.id:void 0,le="page"===(null==y?void 0:y.type)?y.page.id:void 0,se=[],ce=function(e){const{automationVariables:t,onClick:o,selectedVariableId:n}=e,i=t.map((e=>{if(e.kind!==c.yp.ContextValue)throw new Error("Not implemented yet.");return{action:()=>o({id:e.id,type:"variable"}),key:e.id,render:t=>(0,D.jsx)(T.ZP,{placement:T.ug.Right,render:o=>(0,D.jsx)(k.Z,{...(0,F.Z)(o,t),checkState:e.id===n,title:(0,D.jsx)("div",{style:{display:"flex"},children:(0,D.jsx)(P.F,{value:e,format:l.lo.Medium,isSingle:!0,shouldShrink:!0})})}),renderTooltip:()=>e.name,textWrap:!0})}}));if(0===i.length)return;return{key:"variable_results",items:i,render:e=>(0,D.jsx)(A.Z,{...e,title:(0,D.jsx)(v.FormattedMessage,{defaultMessage:"From this automation",id:"automations.AutomationTargetPickerMenu.variablesSection.title"})})}}({automationVariables:Y.automationVariables,onClick:te,selectedVariableId:re});ce&&se.push(ce);const de=function(e){const{collectionQueryResult:t,onCollectionMenuItemClick:o,onShowMoreItemClick:n,parentRecordStore:i,selectedCollectionId:r}=e;if(t.isLoading)return;let a=[];if(t.error)a.push({action:n,key:"show_more_collection_results",render:e=>(0,D.jsx)(b.Z,{...e,caption:(0,D.jsx)(v.FormattedMessage,{defaultMessage:"Sorry, something went wrong while searching for databases.",id:"automations.AutomationTargetPickerMenu.errorCollections.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],l=e.length;a=e.map((e=>{const t=O.NW.createChildStore(i,{table:f.v,id:e});return{action:()=>o({collection:t.getSpaceShardedPointer(),type:"collection"}),key:e,render:o=>(0,D.jsx)(_.Z,{...o,checkState:e===r,store:t})}}));const s=t.total??0,c=Math.max(0,s-l);c>0&&a.push({action:n,key:"show_more_collection_results",render:e=>(0,D.jsx)(H,{...e,showMoreCount:c})})}if(0===a.length)return;return{key:"collection_results",items:a,render:e=>(0,D.jsx)(A.Z,{...e,title:(0,D.jsx)(v.FormattedMessage,{defaultMessage:"Databases",id:"automations.AutomationTargetPickerMenu.collectionsSection.title"})})}}({collectionQueryResult:J,onCollectionMenuItemClick:te,onShowMoreItemClick:ne,parentRecordStore:G,selectedCollectionId:ae});de&&se.push(de);const ue=function(e){const{pageQueryResult:t,onPageMenuItemClick:o,onShowMoreItemClick:n,parentRecordStore:i,selectedPageId:r}=e;if(t.isLoading)return;let a=[];if(t.error)a.push({action:n,key:"show_more_collection_results",render:e=>(0,D.jsx)(b.Z,{...e,caption:(0,D.jsx)(v.FormattedMessage,{defaultMessage:"Sorry, something went wrong while searching for pages.",id:"automations.AutomationTargetPickerMenu.errorPages.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],l=e.length;a=e.map((e=>{const t=O.G.createChildStore(i,{table:h.iU,id:e});return{key:e,render:o=>(0,D.jsx)(_.Z,{...o,checkState:e===r,store:t}),action:()=>o({page:t.getSpaceShardedPointer(),type:"page"})}}));const s=t.total??0,c=Math.max(0,s-l);c>0&&a.push({action:n,key:"show_more_page_results",render:e=>(0,D.jsx)(H,{...e,showMoreCount:c})})}if(0===a.length)return;return{key:"page_results",items:a,render:e=>(0,D.jsx)(A.Z,{...e,title:(0,D.jsx)(v.FormattedMessage,{defaultMessage:"Pages",id:"automations.AutomationTargetPickerMenu.pagesSection.title"})})}}({onPageMenuItemClick:te,onShowMoreItemClick:ie,pageQueryResult:ee,parentRecordStore:G,selectedPageId:le});ue&&se.push(ue);const pe=J.isLoading||ee.isLoading;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(z,{onChange:oe,value:Y.searchTerm}),pe?(0,D.jsx)(A.Z,{children:(0,D.jsx)(V.Z,{})}):!pe&&se.length>0?(0,D.jsx)(j.Z,{initialFocus:0,sections:se,store:N,type:j.i.Vertical}):(0,D.jsx)(b.Z,{caption:(0,D.jsx)(v.FormattedMessage,{defaultMessage:"No results",id:"automations.AutomationTargetPickerMenu.noResults.label"})})]})}function z(e){window.__c={n:"SearchInputSection"};const{onChange:t,value:o}=e,{isMobile:n}=(0,i.Fy)(),r=(0,v.useIntl)(),l=(0,a.yK)((()=>({section:{paddingBlockStart:0}})),[]);return(0,D.jsx)(A.Z,{style:l.section,children:(0,D.jsx)(w.ZP,{focusInitial:!n||void 0,onChange:t,placeholder:r.formatMessage(E.searchInputPlaceholder),showClearButton:!0,value:o??""})})}const H=(0,n.forwardRef)((function(e,t){window.__c={n:"ShowMoreButtonMenuItem"};const{showMoreCount:o}=e,n=(0,a.yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]);return(0,D.jsx)(k.Z,{...e,icon:(0,m.o)({width:16,height:16}),ref:t,style:n.showMoreButton,title:(0,D.jsx)(v.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"automations.AutomationTargetPickerMenu.showMore.label",values:{showMore:Math.min(o,20)}})})}));function U(e,t){if("set_variables"===t.type)return{...e,automationVariables:t.variables.slice(0)};if("set_search_term"===t.type){const o=t.searchTerm?20:5;return{...e,collectionQueryLimit:o,pageQueryLimit:o,searchTerm:t.searchTerm}}if("set_collection_query_limit"===t.type){if(e.collectionQueryLimit!==t.queryLimit)return{...e,collectionQueryLimit:t.queryLimit}}else if("set_page_query_limit"===t.type){if(e.pageQueryLimit!==t.queryLimit)return{...e,pageQueryLimit:t.queryLimit}}else(0,S.t1)(t);return e}function $(e,t){if("query_loadstart"===t.type){if(!e.isLoading)return{...e,isLoading:!0}}else{if("query_finish"===t.type)return{...e,error:void 0,isLoading:!1,results:t.results,total:t.total};if("query_error"===t.type)return{...e,error:t.error,isLoading:!1,results:void 0,total:void 0};(0,S.t1)(t)}return e}},14648:(e,t,o)=>{o.d(t,{F:()=>k,Z:()=>v});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(80721),s=o(12392),c=o(82990),d=o(9291),u=o(73063),p=o(78140),m=o(32163),g=o(40721),y=o(89728),h=o(87279),f=o(85893);const S=(0,d.defineMessages)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step"}});function v(e){window.__c={n:"AutomationTriggerActionMenu"};const{type:t,automationTriggerActionMenuStore:o,headerTitle:n,onClose:i,width:r,onDone:a}=e,l=k({automationTriggerActionMenuStore:o,onClose:i,onDone:a,title:n,width:r});return"custom"===t?(0,f.jsx)(b,{...e,menuProps:l}):(0,f.jsx)(x,{...e,menuProps:l})}function x(e){const{sections:t,menuProps:o}=e;return(0,f.jsx)(p.Z,{...o,children:(0,f.jsx)(m.Z,{type:m.i.Vertical,initialFocus:0,sections:t})})}function b(e){const{children:t,menuProps:o}=e;return(0,f.jsx)(p.Z,{...o,children:t})}function C(e){window.__c={n:"BackToPreviousStepButton"};const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:n}=e,i=(0,d.useIntl)(),s=(0,r.VK)((()=>t.state.stack.length>1),[t]),p=(0,a.yK)((e=>({header:{display:"flex",alignItems:"center",margin:8,color:e.mediumTextColor,fontWeight:c.Z.fontWeight.medium,fontSize:c.Z.fontSize.UISmall.desktop},iconButtonStyle:{marginRight:8,marginLeft:-2,height:22},iconButtonIconStyle:{width:16,height:16},doneButtonStyle:{marginLeft:"auto"}})),[]);return void 0!==o||s?(0,f.jsxs)("div",{style:p.header,children:[s&&(0,f.jsx)(u.Z,{ariaLabel:i.formatMessage(S.backButtonAriaLabel),icon:l.W,style:p.iconButtonStyle,iconStyle:p.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o,n&&(0,f.jsx)(y.Z,{onClick:n,isBlue:!0,style:p.doneButtonStyle,children:(0,f.jsx)(d.FormattedMessage,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done"})})]}):null}function k(e){const{automationTriggerActionMenuStore:t,leftStyle:o,onClose:r,onDone:a,rightStyle:l,title:c,titleStyle:p,width:m}=e,{isMobile:y}=(0,i.Fy)(),v=(0,d.useIntl)(),x=(0,n.useCallback)((()=>{1===t.getState().stack.length?r():t.popSettingsItem()}),[t,r]);return(0,n.useMemo)((()=>{let e;return e=y?{leftOuterStyle:o,menuType:h.og.Modal,title:c,titleOuterStyle:p,left:(0,f.jsx)(u.Z,{ariaLabel:v.formatMessage(S.backButtonAriaLabel),icon:s.S,onClick:x}),right:(0,f.jsx)(g.DoneMenuText,{}),rightOuterStyle:l,onClickRight:()=>{null==a||a(),r()}}:{width:m??266,menuType:h.og.Popup,maxHeight:"50vh",header:(0,f.jsx)(C,{automationActionMenuStore:t,menuHeaderTitle:c,onDone:a})},e}),[t,v,y,o,r,a,x,l,c,p,m])}},93060:(e,t,o)=>{o.d(t,{y:()=>l});var n=o(67294),i=o(24405),r=o(26388),a=o(85893);function l(e){window.__c={n:"AutomationTriggerActionTooltip"};const{caption:t,disable:o,renderOrigin:l,title:s,tooltipAlignment:c,tooltipPlacement:d}=e,u=(0,i.yK)((e=>({tooltipTitle:{margin:0},tooltipCaption:{color:e.mediumInvertedTextColor,margin:0}})),[]),p=(0,n.useCallback)((()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{style:u.tooltipTitle,children:s}),(0,a.jsx)("p",{style:u.tooltipCaption,children:t})]})),[t,s,u.tooltipCaption,u.tooltipTitle]);return(0,a.jsx)(r.ZP,{alignment:c,delayThreshold:800,disableTooltip:o,placement:d,render:l,renderTooltip:p,textWrap:!0})}},74197:(e,t,o)=>{o.d(t,{f:()=>p});o(67294);var n=o(480),i=o(24405),r=o(56666),a=o(9291),l=o(31945),s=o(73063),c=o(53437),d=o(85893);const u=(0,a.defineMessages)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More"}});function p(e){window.__c={n:"BaseStepActionsButton"};const{actionMenu:t,disabled:o,buttonPopupStore:p}=e,{device:m}=(0,n.O7)(),g=(0,a.useIntl)(),y=(0,i.yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26},icon:{height:14,width:14}})),[]);return(0,d.jsx)(l.ZP,{alignmentToOrigin:l.vR.Center,buttonPopupStore:p,originGap:0,placementToOrigin:l.pO.Bottom,popupType:m.isMobile?c.kQ.SlideUp:c.kQ.Popup,render:()=>t,renderOrigin:e=>(0,d.jsx)(s.Z,{...e,ariaLabel:g.formatMessage(u.moreLabel),disabled:o,disabledFeedback:o,hasBackground:!0,icon:r.o,iconStyle:y.icon,style:y.iconButton})})}},80253:(e,t,o)=>{o.d(t,{Ao:()=>x,R7:()=>C,YG:()=>v,_S:()=>S,vu:()=>b});var n=o(67294),i=o(480),r=o(6740),a=o(37989),l=o(86628),s=o(24405),c=o(77744),d=o(98104),u=o(64921),p=o(75024),m=o(35948),g=o(61766),y=o(73266),h=o(74197),f=o(85893);function S(e){window.__c={n:"BaseStepLabel"};const{actionMenu:t,buttonPopupStore:o,children:r,disabled:s,icon:d,onClick:u,onMouseDown:p,onMouseEnter:S,onMouseLeave:v,subtitle:x,styles:b}=e,{isMobile:C}=(0,i.Fy)(),w=(0,l.qz)(o,g.Z),[M,j]=(0,a.Z)(),[_,A]=(0,m.C)(),T=(0,l.VK)((()=>w.getState()),[w]),P=C||A||j||T.open,V=k({disabled:s,hasActionMenu:Boolean(t),isActionMenuVisible:P,overrideStyles:b}),I=(0,y.Z)(),F=(0,c.lq)(M,_),Z=(0,n.useMemo)((()=>({...V.componentWrap,...V.border})),[V.border,V.componentWrap]);return(0,f.jsxs)("div",{onClick:u,onMouseDown:p,onMouseEnter:S,onMouseLeave:v,ref:F,style:Z,children:[(0,f.jsxs)("div",{style:V.headerWrap,children:[!I&&d&&(0,f.jsx)("div",{"aria-hidden":"true",style:V.iconWrap,children:d(V.icon)}),(0,f.jsx)("div",{style:V.titleWrap,children:r})]}),x&&(0,f.jsx)("div",{style:V.subtitleWrap,children:x}),t&&(0,f.jsx)("div",{style:V.actionMenuWrap,children:(0,f.jsx)(h.f,{actionMenu:t,buttonPopupStore:w,disabled:s})})]})}function v(e){window.__c={n:"BaseStepButton"};const{actionMenu:t,buttonPopupStore:o,children:n,disabled:s,icon:p,onBlur:S,onClick:v,onFocus:x,onMouseDown:b,onMouseEnter:C,onMouseLeave:w,styles:M,subtitle:j}=e,{isMobile:_}=(0,i.Fy)(),[A,T]=(0,r.Z)(),[P,V]=(0,a.Z)(),[I,F]=(0,m.C)(),Z=(0,l.qz)(o,g.Z),B=(0,l.VK)((()=>Z.getState()),[Z]),K=(0,c.lq)(I,P),R=_||F||T||V||B.open;(0,l.VK)((()=>{B.open||d.sD()}),[B]);const O=k({disabled:s,hasActionMenu:Boolean(t),isActionMenuVisible:R,overrideStyles:M}),W=(0,y.Z)();return(0,f.jsxs)("div",{ref:K,style:O.buttonWrap,children:[(0,f.jsxs)(u.Z,{disabled:s,disabledFeedback:s,hovered:F,ignoreLocalHoverState:!0,onBlur:S,onClick:v,onFocus:x,onMouseDown:b,onMouseEnter:C,onMouseLeave:w,ref:A,style:O.componentWrap,children:[(0,f.jsxs)("div",{style:O.headerWrap,children:[!W&&p&&(0,f.jsx)("div",{"aria-hidden":"true",style:O.iconWrap,children:p(O.icon)}),(0,f.jsx)("div",{style:O.titleWrap,children:n})]}),j&&(0,f.jsx)("div",{style:O.subtitleWrap,children:j})]}),t&&(0,f.jsx)("div",{style:O.actionMenuWrap,children:(0,f.jsx)(h.f,{actionMenu:t,buttonPopupStore:Z,disabled:s})})]})}function x(e){window.__c={n:"BaseStepElement"};const{actionMenu:t,buttonPopupStore:o,children:r,disabled:s,forceShowActionMenu:u,onMouseEnter:p,onMouseLeave:y,styles:S}=e,{isMobile:v}=(0,i.Fy)(),[x,b]=(0,a.Z)(),[C,w]=(0,m.C)(),M=(0,l.qz)(o,g.Z),j=(0,l.VK)((()=>M.getState()),[M]),_=(0,c.lq)(C,x),A=u||v||w||b||j.open;(0,l.VK)((()=>{j.open||d.sD()}),[j]);const T=k({disabled:s,hasActionMenu:Boolean(t),isActionMenuVisible:A,overrideStyles:S}),P=(0,n.useMemo)((()=>({...T.componentWrap,...T.border})),[T.border,T.componentWrap]);return(0,f.jsxs)("div",{onMouseEnter:p,onMouseLeave:y,ref:_,style:P,children:[t&&(0,f.jsx)("div",{style:T.actionMenuWrap,children:(0,f.jsx)(h.f,{actionMenu:t,buttonPopupStore:M,disabled:s})}),r]})}function b(e){window.__c={n:"BaseStepElementHeader"};const{children:t,disabled:o,icon:n,onMouseEnter:i,onMouseLeave:r,styles:a}=e,l=k({disabled:o,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:a}),s=(0,y.Z)();return(0,f.jsxs)("header",{onMouseEnter:i,onMouseLeave:r,style:l.headerWrap,children:[!s&&n&&(0,f.jsx)("div",{"aria-hidden":"true",style:l.iconWrap,children:n(l.icon)}),(0,f.jsx)("div",{style:l.titleWrap,children:t})]})}function C(e){window.__c={n:"BaseStepElementBody"};const{children:t,disabled:o,styles:n}=e,i=k({disabled:o,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:n});return(0,f.jsx)("div",{style:i.bodyWrap,children:t})}function k(e){const{disabled:t,hasActionMenu:o,isActionMenuVisible:n,overrideStyles:i}=e;return(0,s.yK)((e=>({border:{border:`1px solid ${e.stroke.regular}`},buttonWrap:{background:e.cardContentBackground,border:`1px solid ${e.stroke.regular}`,overflow:"hidden",position:"relative"},componentWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:16,paddingInline:12,paddingBlock:16,position:"relative",...t?{cursor:"default",opacity:.4}:{},...null==i?void 0:i.componentWrap},headerWrap:{display:"flex",flexDirection:"row",gap:4,marginInlineEnd:o?38:0,...null==i?void 0:i.headerWrap},iconWrap:{flex:"0 0 auto",marginBlockStart:2,...null==i?void 0:i.iconWrap},icon:{fill:e.text.secondary,height:"auto",width:16,...null==i?void 0:i.icon},titleWrap:{alignSelf:"center",flex:"1 1 auto",fontSize:14,lineHeight:1.285,marginBlockStart:1,minWidth:0,whiteSpace:"pre",...null==i?void 0:i.titleWrap},subtitleWrap:{...null==i?void 0:i.subtitleWrap},bodyWrap:{fontSize:14,...null==i?void 0:i.bodyWrap},actionMenuWrap:{flex:"0 0 auto",height:26,position:"absolute",right:12,top:14,width:26,...n?{}:p.jy}})),[t,o,n,i])}},37867:(e,t,o)=>{o.d(t,{Z:()=>u});o(67294);var n=o(480),i=o(24405),r=o(84619),a=o(54497),l=o(9291),s=o(85567),c=o(56812),d=o(85893);function u(e){let{key:t,tokenFormat:o=r.lo.Medium,isSingle:u,showRemoveButton:p,onClickRemove:m}=e;window.__c={n:"DeletedOptionToken"};const{isMobile:g}=(0,n.Fy)(),y=(0,l.useIntl)(),h=(0,i.yK)((e=>{const t="light"===e.mode?400:800,o="light"===e.mode?50:200,n="light"===e.mode?700:900;return{tokenValueWrap:{display:"inline-flex",gap:"4px",alignItems:"baseline"},warning:{color:e.accentColors.orange[t],height:"auto",width:g?16:14},warningWrap:{alignSelf:"center"},token:{backgroundColor:e.accentColors.yellow[o]},textWrap:{color:e.accentColors.yellow[n]}}}),[g]);return(0,d.jsx)(s.Z,{format:o,isSingle:u??!0,showRemoveButton:p??!1,onClickRemove:m,style:h.token,value:(0,d.jsxs)("span",{style:h.tokenValueWrap,children:[(0,d.jsx)("span",{style:h.warningWrap,children:(0,a.t)(h.warning)}),(0,d.jsx)("span",{style:h.textWrap,children:(0,c.ST)(y)})]})},t)}},10383:(e,t,o)=>{o.d(t,{Z:()=>se});var n=o(67294),i=o(86628),r=o(97880),a=o(91738),l=(o(57658),o(43261)),s=o.n(l),c=o(480),d=o(24405),u=o(63362),p=o(3865),m=o(39068),g=o(9999),y=o(65422),h=o(5257),f=o(4615),S=o(9291),v=o(52275),x=o(68894),b=o(78140),C=o(32163),k=o(72495),w=o(49117),M=o(52821),j=o(33929),_=o(63474),A=o(44041),T=o(35057),P=o(2553),V=o(12455),I=o(95193),F=o(28751),Z=o(59054);var B=o(85893);const K=(0,S.defineMessages)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search for action…"}}),R=["automation_actions","update_this_page_actions"],O=["update_this_page_actions","automation_actions"];function W(e){window.__c={n:"AddActionsMenu"};const{automationActionMenuStore:t,hasSearch:o,hasUpdateThisPagePropertyActions:a,onClose:l}=e,{isMobile:d}=(0,c.Fy)(),m=(0,c.O7)(),g=(0,S.useIntl)(),y=(0,_.D)(),{automationContextStore:h,automationStore:x,maybePersistedTransactionActions:K,onActionAdded:W}=(0,V.i)(),N=(0,i.VK)((()=>null==h?void 0:h.getCollectionStore()),[h]),z=function(){const{automationContextStore:e}=(0,V.i)(),[t,o]=(0,n.useState)([]),r=(0,i.VK)((()=>e?(0,w.uV)(e.context.automationStore,e.context.type):void 0),[e]),a=(0,n.useMemo)((()=>(0,F.P)("display")),[]),l=(0,i.VK)((()=>r?a.map((e=>e.isAvailableForContext(r))):[]),[a,r]);return(0,Z.r5)((async()=>{const e=await Promise.all(l);o(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(a.filter(((t,o)=>e[o]))))}),[a,l]),t}(),U=(0,n.useMemo)((()=>"event"===(null==h?void 0:h.context.type)?O:R),[null==h?void 0:h.context.type]),$=(0,i.VK)((()=>t.getInsertionPoint()),[t]),[q,G]=n.useState(""),Q=(0,i.VK)((()=>o?function(e){const{availableActions:t,searchInput:o}=e;if(0===t.length)return[];const n=new Map,i=t.map((e=>{const t=j.default.formatMessage(e.display.name);return n.set(e.type,t),t})),r=new Set(s().filter(o,i).map((e=>{let{original:t}=e;return t})));return t.filter((e=>{const t=n.get(e.type);return t&&r.has(t)}))}({availableActions:z,searchInput:q}):z),[z,o,q]),Y=(0,n.useCallback)((e=>{if(!x)return;const{performResult:t}=K.createAndCommit({userAction:"AutomationActionList.addAction",perform:t=>P.zY({actionId:(0,f.ZP)(),actionType:e,automationStore:x,environment:m,insertionPoint:$,intl:g,transaction:t})});t&&((0,u.eI)(y,{automation_id:x.id,automation_action_id:t.id,automation_action_type:e}),null==W||W(t)),l()}),[x,K,l,m,$,g,y,W]),X=(0,i.VK)((()=>a&&N&&x?function(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),a=o.getFormat(),l=o.getSchema(),c=(0,p.cO)({collectionFormat:a,collectionSchema:l,filter:e=>{let[t]=e;return!i.has(t)}}),d=new Map,u=c.map((e=>{const t=l[e];if(t){const o=`${t.name} ${M.SO[t.type]}`;return d.set(e,o),o}})).filter(r.$K),m=new Set(s().filter(n,u).map((e=>{let{original:t}=e;return t})));return c.filter((e=>{const t=d.get(e);return t&&m.has(t)}))}({automationStore:x,collectionStore:N,searchInput:q}):[]),[x,N,a,q]),J=(0,i.VK)((()=>null==N?void 0:N.getSchema()),[N]),ee=(0,n.useCallback)((()=>{l(),A.y(m,{for:"plus",from:"database_automation_action_item"})}),[m,l]),te=(0,w.Rr)({environment:m}),oe=(0,i.VK)((()=>!(0,T.sX)()),[]),ne=0===z.length&&oe,ie=(0,n.useMemo)((()=>{const e=[];o&&!ne&&e.push(function(e){const{onChange:t,value:o}=e;return{items:[{action:()=>{},key:"search-input",render:e=>(0,B.jsx)(D,{...e,onChange:t,value:o})}],key:"search",render:e=>(0,B.jsx)(k.Z,{...e})}}({onChange:e=>G(e.target.value),value:q}));const n=U.reduce(((e,o)=>{if("automation_actions"===o){const t=function(e){const{actionRegistryItems:t,hasTopBorder:o,onMenuItemClick:n}=e,i=t.map((e=>function(e){const{actionRegistryItem:t,onClick:o}=e;return{action:()=>o(t.type),key:`${t.type}_action`,render:e=>(0,B.jsx)(E,{...e,actionRegistryItem:t})}}({actionRegistryItem:e,onClick:n}))).filter(r.$K);if(0===i.length)return;return{key:"automation_actions_section",items:i,render:e=>(0,B.jsx)(k.Z,{...e,topBorder:o})}}({actionRegistryItems:Q,hasTopBorder:e.length>0,onMenuItemClick:Y});t&&e.push(t)}else if("update_this_page_actions"===o){const o=J&&!oe&&function(e){const{automationActionMenuStore:t,hasTopBorder:o,normalizedBlockSchema:n,propertyIds:i}=e;if(0===i.length)return;const a=i.map((e=>{const o=n[e];if(o)return function(e){const{automationActionMenuStore:t,propertyId:o,propertySchema:n}=e;return{action:()=>{t.pushSettingsItem({actionId:void 0,propertyId:o,type:"eventActionProperty"})},key:`update_this_page_property_${o}_action`,render:e=>(0,B.jsx)(L,{...e,propertySchema:n})}}({automationActionMenuStore:t,propertyId:e,propertySchema:o})})).filter(r.$K);if(0===a.length)return;return{key:"automation_update_this_page_section",items:a,render:e=>(0,B.jsx)(k.Z,{...e,title:(0,B.jsx)(S.FormattedMessage,{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}),topBorder:o})}}({automationActionMenuStore:t,hasTopBorder:e.length>0,normalizedBlockSchema:J,propertyIds:X});o&&e.push(o)}else(0,r.t1)(o);return e}),[]);return 0===n.length?e.push({key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,B.jsx)(v.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,B.jsx)(S.FormattedMessage,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,B.jsx)(k.Z,{...e})}):e.push(...n),oe&&te&&e.push(function(e){const{onUpsellClick:t,hasTopBorder:o}=e;return{key:"upsell_section",items:[{action:t,key:"upsell_item",render:e=>(0,B.jsx)(H,{...e})}],render:e=>(0,B.jsx)(k.Z,{...e,topBorder:o})}}({hasTopBorder:e.length>0,onUpsellClick:ee})),e}),[t,X,Q,te,J,o,oe,ne,Y,ee,q,U]),re=(0,I.F)({paddingBottom:6,paddingTop:6,width:266});return d||(re.maxHeight="50vh"),(0,B.jsx)(b.Z,{...re,children:(0,B.jsx)(C.Z,{initialFocus:0,sections:ie,type:C.i.Vertical})})}function D(e){window.__c={n:"SearchInputMenuItem"};const{onChange:t,value:o,...n}=e,i=(0,S.useIntl)(),r=(0,d.yK)((()=>({input:{margin:0,padding:0}})),[]);return(0,B.jsx)(x.ZP,{...n,inputOuterStyle:{margin:0},onChange:t,placeholder:i.formatMessage(K.searchInputPlaceholder),style:r.input,value:o})}function E(e){const{actionRegistryItem:t,...o}=e;return(0,B.jsx)(v.Z,{...o,icon:(0,B.jsx)(N,{actionRegistryItem:t}),title:(0,B.jsx)(S.FormattedMessage,{...t.display.name})})}function N(e){window.__c={n:"AutomationActionMenuItemIcon"};const{actionRegistryItem:t}=e,o="slack_notification"===t.type,n=(0,d.yK)((e=>({icon:{fill:o?void 0:e.blueColor,height:"auto",width:o?16:12},iconWrap:{alignItems:"center",background:o?void 0:"rgba(35, 131, 226, 0.14)",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[o]);return(0,B.jsx)("div",{style:n.iconWrap,children:t.display.icon(n.icon)})}function L(e){window.__c={n:"UpdateThisPagePropertyMenuItem"};const{propertySchema:t,...o}=e,n=(0,d.yK)((e=>({chevronIcon:{marginInlineStart:6,width:12,height:"auto"}})),[]);return(0,B.jsx)(v.Z,{...o,icon:(0,B.jsx)(z,{propertySchema:t}),right:(0,h.o)(n.chevronIcon),title:t.name})}function z(e){window.__c={n:"UpdateThisPagePropertyMenuItemIcon"};const{propertySchema:t}=e,o=(0,d.Fg)(),n=(0,d.yK)((e=>({icon:{fill:e.blueColor,height:"auto",width:12},iconWrap:{alignItems:"center",background:"rgba(35, 131, 226, 0.14)",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[]);return(0,B.jsx)("div",{style:n.iconWrap,children:(0,B.jsx)(m.ZP,{icon:t.icon,size:16,style:n.icon,theme:o,type:t.type})})}function H(e){window.__c={n:"UpsellMenuItem"};const t=(0,d.yK)((e=>({aliasIcon:{height:"auto",marginBlockStart:2,width:12},icon:{fill:e.icon.yellow,height:"100%",width:"100%"},iconWrap:{background:e.accentColors.yellow[50],borderRadius:4,height:20,padding:3,width:20},right:{alignSelf:"start"}})),[]);return(0,B.jsx)(v.Z,{...e,caption:(0,B.jsx)(S.FormattedMessage,{defaultMessage:"Automatically set properties, create new pages, and more with automations.",id:"automationEventActionMenu.upsellSection.caption"}),icon:(0,B.jsx)("div",{style:t.iconWrap,children:(0,y.K)(t.icon)}),right:(0,g.J)(t.aliasIcon),rightStyle:t.right,shouldWrapCaption:!0,title:(0,B.jsx)(S.FormattedMessage,{defaultMessage:"Upgrade for more actions",id:"automationEventActionMenu.upsellSection.title"})})}var U=o(10450),$=o(30823),q=o(99036),G=o(76218),Q=o(70203),Y=o(82990),X=o(9953),J=o(53498),ee=o(32984),te=o(14648);const oe=(0,S.defineMessages)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"}});function ne(e){var t;window.__c={n:"UpdateThisPagePropertyActionMenu"};const{actionId:o,automationActionMenuStore:r,onClose:a,propertyId:l}=e,{automationContextStore:s,automationStore:d,maybePersistedTransactionActions:p,onActionAdded:m}=(0,V.i)(),g=(0,S.useIntl)(),y=(0,c.O7)(),h=(0,_.D)(),v=(0,i.VK)((()=>r.getInsertionPoint()),[r]),x=(0,i.VK)((()=>null==s?void 0:s.getCollectionStore()),[s]),b=(0,n.useMemo)((()=>x?{collectionStore:x,property:l,type:"collection"}:void 0),[x,l]),C=o??(0,f.ZP)(),k=(0,i.VK)((()=>{const e=((null==d?void 0:d.getActionStores())??[]).find((e=>e.id===C));if(e&&e.isType("update_pages"))return e}),[d,C]),w=(0,i.VK)((()=>null==x?void 0:x.getSchema()[l]),[x,l]),M=(0,n.useMemo)((()=>!!w&&("multi_select"===w.type||(0,q.en)(w)&&1!==w.limit)),[w]),j=Boolean(w&&"button"!==w.type&&"rollup"!==w.type&&"formula"!==w.type&&"text"===(0,$.vc)(w.type)),A=Boolean(w&&"button"!==w.type&&"rollup"!==w.type&&"formula"!==w.type&&"number"===(0,$.vc)(w.type)),T=Boolean(w&&"date"===w.type),I=Boolean(w&&"status"===w.type),F=(0,i.VK)((()=>{if(x&&w)return(0,G.qW)(x.getSpaceShardedPointer(),l,w)}),[x,w,l]),Z=(0,i.VK)((()=>{if(k)return k.getConfigStore().getKeyStore("values").getKeyStore(l).getValue()}),[k,l]),[K,R]=(0,n.useState)(Z),O=(0,n.useRef)(null==Z?void 0:Z.value),W=(0,G.A6)(null==K||null===(t=K.value)||void 0===t?void 0:t.value),D=(0,i.VK)((()=>s?k?s.getContextValuesForAction(k.id):s.getAllContextValues():[]),[k,s]),E=(0,n.useCallback)((e=>{if(!d)return;const{performResult:t}=p.createAndCommit({perform:t=>{if(!k)return P.zY({actionId:C,actionType:"update_pages",automationStore:d,config:{properties:[l],target:{id:(0,U.J0)(),type:"variable"},values:{[l]:{action:"replace",value:e}}},environment:y,intl:g,insertionPoint:v,transaction:t});X.sW({data:{[l]:{action:"replace",value:e}},store:k.getConfigStore().getKeyStore("values"),transaction:t})},userAction:"UpdateThisPagePropertyActionMenu.saveChanges"});t&&((0,u.eI)(h,{automation_id:d.id,automation_action_id:t.id,automation_action_type:"update_pages"}),null==m||m(t))}),[k,d,y,h,C,v,g,p,m,l]),N=(0,n.useCallback)((()=>{E(O.current),a()}),[E,a]),L=(0,n.useCallback)((e=>{if(O.current=e,j||A||M)R({action:"replace",value:e});else if(T){const t=(0,G.A6)(null==e?void 0:e.value);0===t.length?N():(0,G.S3)(t[0])&&(0,Q.fpG)(t[0])&&R({action:"replace",value:e})}}),[T,j,A,M,N]),z=(0,te.F)({automationTriggerActionMenuStore:r,leftStyle:{flexGrow:0},onClose:N,onDone:M||j||A?N:void 0,rightStyle:{flexGrow:0},title:(0,B.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:g.formatMessage(oe.menuHeaderTitle,{propertyName:(0,B.jsx)("div",{style:{...Y.Z.textOverflowStyle},children:(null==w?void 0:w.name)??""})})}),titleStyle:{minWidth:0}});if(!(w&&F&&s&&b))return null;const H=(0,ee.li)(w.type);return(0,B.jsx)(J.a,{context:b,contextStore:s,currentSimpleFormulaValueTokens:W,disabled:!1,formulaTypecheckContextValues:D,menuProps:z,onChange:L,onClose:N,showClearButton:!I,type:F,value:null==K?void 0:K.value,...H})}var ie=o(55132),re=o(42876);function ae(e){window.__c={n:"SlackSelectChannelMenu"};const{actionStore:t,automationActionMenuStore:o,onClose:i}=e,{maybePersistedTransactionActions:a}=(0,V.i)(),l=n.useCallback(((e,o)=>{t&&a.createAndCommit({perform:n=>{X.sW({data:{config:{external_bot_id:o.parent_id,target:e}},store:t,transaction:n})},userAction:"SlackSelectChannelMenu.handleChannelSelect"}),i()}),[t,a,i]),s=(0,n.useCallback)((()=>{const e=o.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?o.popSettingsItem():o.replaceSettingsItem({actionStore:t,type:"selectWorkspace"}))}),[t,o]);return(0,B.jsx)(re.ZP,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannel:"selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,r.t1)(e),onClose:i,onNotificationChannelSelect:l,onNewSlackAccountAdded:s,renderMenu:e=>(0,B.jsx)(te.Z,{type:"default",automationTriggerActionMenuStore:o,headerTitle:(0,B.jsx)(S.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:i})})}var le=o(9139);function se(e){window.__c={n:"ActionMenuController"};const{initialState:t,insertionPoint:o,onClose:l}=e,s=(0,i.VK)((()=>{const e=new a.H0;return e.setState({insertionPoint:o,stack:[t]}),e}),[t,o]),c=(0,i.VK)((()=>s.getCurrentTab()),[s]),d=(0,n.useCallback)((()=>null==l?void 0:l()),[l]);if(!c)return null;if("connectToSlackDefault"===c.type)return(0,B.jsx)(ie.Z,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:d,type:"connectToSlackDefault"});if("connectToSlackReconnect"===c.type)return(0,B.jsx)(ie.Z,{actionStore:c.actionStore,automationActionMenuStore:s,externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,onClose:d,type:"connectToSlackReconnect"});if("selectWorkspace"===c.type)return(0,B.jsx)(le.Z,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:d});if("selectChannelNew"===c.type)return(0,B.jsx)(ae,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:d,type:"selectChannelNew"});if("selectChannelUpdate"===c.type)return(0,B.jsx)(ae,{actionStore:c.actionStore,automationActionMenuStore:s,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,onClose:d,type:"selectChannelUpdate"});if("eventActions"===c.type)return(0,B.jsx)(W,{automationActionMenuStore:s,hasUpdateThisPagePropertyActions:c.hasUpdateThisPagePropertyActions,hasSearch:c.hasSearch,onClose:d});if("eventActionProperty"===c.type){const{propertyId:e,actionId:t}=c;return(0,B.jsx)(ne,{actionId:t,automationActionMenuStore:s,onClose:d,propertyId:e})}return"eventActionCreatePage"===c.type||"eventActionUpdatePages"===c.type?(0,B.jsx)("div",{children:"WILL BE REMOVED"}):(0,r.t1)(c)}},55132:(e,t,o)=>{o.d(t,{Z:()=>k});o(67294);var n=o(480),i=o(86628),r=o(24405),a=o(41892),l=o(77657),s=o(149),c=o(32161),d=o(97880),u=o(82990),p=o(9291),m=o(89475),g=o(42922),y=o(89728),h=o(72495),f=o(18441),S=o(80444),v=o(30874),x=o(26136),b=o(14648),C=o(85893);function k(e){window.__c={n:"SlackConnectToSlackView"};const{type:t,automationActionMenuStore:o,onClose:n}=e,r=A(),a=(0,i.VK)((()=>{var e;return null===(e=S.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),l=(0,i.VK)((()=>S.default.state.currentUserStore),[]),s=(0,i.VK)((()=>{if("connectToSlackReconnect"===t&&l)return(0,x.Kv)(l,{table:c.P,id:e.externalBotId,spaceId:a}).getValue()}),[a,l,e,t]);let d,u=_({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!s)return null;const{accountName:e,organizationName:t}=(0,f.jg)(s);d=(0,f.jc)(s),u=_({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return(0,C.jsx)(b.Z,{type:"custom",automationTriggerActionMenuStore:o,onClose:n,children:(0,C.jsx)(h.Z,{children:(0,C.jsxs)("div",{style:r.container,children:[(0,C.jsx)(M,{}),(0,C.jsxs)("div",{style:r.connectToSlackBody,children:[(0,C.jsx)("div",{style:r.connectToSlackTitleText,children:j(t)}),(0,C.jsx)("div",{style:r.connectToSlackDescriptionText,children:u})]}),(0,C.jsx)(w,{...e,slackWorkspaceId:d})]})})})}function w(e){window.__c={n:"AuthActionButtons"};const{automationActionMenuStore:t,slackWorkspaceId:o}=e,r=(0,n.O7)(),a=A(),c=(0,i.VK)((()=>{var e;return null===(e=S.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),u=(0,i.VK)((()=>v.Z.integrations.state.find((e=>e.id===l.nO))),[]);return u&&c?(0,C.jsxs)("div",{style:a.buttonGroup,children:[(0,C.jsx)(g.Z,{style:a.connectToSlackButton,isLarge:!0,onClick:async()=>{const n=await m.hM({environment:r,integration:u,spaceId:c,from:"collection_view_settings",options:{slackWorkspaceId:o}});s.x.isFail(n)?t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?n.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:n.value.externalAuthentication,actionStore:e.actionStore}):t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):(0,d.t1)(e))},children:(0,C.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})}),(0,C.jsx)(y.Z,{style:a.cancelButton,isLarge:!0,onClick:()=>{t.popSettingsItem()},children:(0,C.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"})})]}):null}function M(){window.__c={n:"SlackIcon"};const e=A();return(0,C.jsx)("div",{children:(0,C.jsx)("img",{src:a.Z.images.externalIntegrations.slackIconPng,style:e.slackIcon})})}function j(e){return"connectToSlackDefault"===e?(0,C.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"}):"connectToSlackReconnect"===e?(0,C.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"}):void(0,d.t1)(e)}function _(e){const{viewType:t}=e;return"connectToSlackDefault"===t?(0,C.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?(0,C.jsx)(p.FormattedMessage,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',values:{accountName:e.accountName,hasOrganizationName:(0,d.$K)(e.organizationName),organizationName:e.organizationName}}):void(0,d.t1)(t)}function A(){return(0,r.yK)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:u.Z.fontWeight.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.mediumTextColor},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.mediumTextColor,width:"100%",justifyContent:"center",fontWeight:u.Z.fontWeight.medium,fontSize:13,marginTop:8}})),[])}},9139:(e,t,o)=>{o.d(t,{Z:()=>M});var n=o(67294),i=o(9291),r=(o(30541),o(57658),o(480)),a=o(86628),l=o(24405),s=o(41892),c=o(77657),d=o(5257),u=o(35840),p=o(149),m=o(89475),g=o(33929),y=o(18441),h=o(80444),f=o(30874),S=o(52275),v=o(68894),x=o(72495),b=o(85893);const C=(0,i.defineMessages)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…"}});function k(e){window.__c={n:"SlackSelectWorkspaceView"};const{onWorkspaceSelect:t,renderMenu:o,workspaceFilter:k,onNewSlackAccountAdded:w}=e,M=(0,r.O7)(),{isMobile:j}=(0,r.Fy)(),_=(0,a.VK)((()=>{var e;return null===(e=h.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),A=(0,a.VK)((()=>(0,y.P9)(f.Z.completeSlackAuthentications.state,k)),[k]),T=(0,a.VK)((()=>f.Z.integrations.state.find((e=>e.id===c.nO))),[]),[P,V]=n.useState(""),I=(0,l.yK)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!T)return null;const F=Object.entries((0,y.YJ)(A,P)).map(((e,o)=>{let[n,r]=e;return{key:n,items:r.map((e=>{let{workspaceName:o,externalAuthentication:n}=e;return{key:n.id,action:()=>{t(n)},render:e=>(0,b.jsx)(S.Z,{...e,title:o??(0,b.jsx)(i.FormattedMessage,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,d.o)(I.chevronRight)})}})),render:e=>(0,b.jsx)(x.Z,{...e,title:n,topBorder:0!==o})}}));return F.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,b.jsx)("div",{children:(0,b.jsx)(v.ZP,{...e,inputLeft:(0,b.jsx)(v.f_,{icon:u.R}),showClearButton:!0,placeholder:g.default.formatMessage(C.workspaceSearchPlaceholder),focus:!j||void 0,value:P,onChange:e=>{V(e.target.value)}})})}],render:e=>(0,b.jsx)(x.Z,{...e})}),F.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!_)return;const e=await m.hM({environment:M,integration:T,spaceId:_,from:"collection_view_settings"});p.x.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==w||w())},render:e=>(0,b.jsx)(S.Z,{...e,icon:(0,b.jsx)("img",{src:s.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,b.jsx)(i.FormattedMessage,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,b.jsx)(x.Z,{...e,topBorder:!0})}),(0,b.jsx)(b.Fragment,{children:o(F)})}var w=o(14648);function M(e){const{automationActionMenuStore:t,onClose:o}=e,r=n.useCallback((o=>{t.pushSettingsItem({actionStore:e.actionStore,type:"selectChannelNew",currentExternalAuthentication:o})}),[t,e.actionStore]);return(0,b.jsx)(k,{onWorkspaceSelect:r,renderMenu:e=>(0,b.jsx)(w.Z,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,b.jsx)(i.FormattedMessage,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}},60781:(e,t,o)=>{o.d(t,{JM:()=>j,YB:()=>_});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(72126),s=o(9291),c=o(9953),d=o(82530),u=o(15201),p=o(68709),m=o(31945),g=o(55217),y=o(79954),h=o(43250),f=o(12534),S=o(61766),v=o(26136),x=o(2553),b=o(35294),C=o(26612),k=o(48312),w=o(40190),M=o(85893);function j(e){window.__c={n:"DuplicateBlocksAction"};const{actionStore:t,disabled:o}=e,a=(0,i.O7)(),u=(0,r.VK)((()=>l.Ps(t.getBlockPointers())),[t],{useDeepEqual:!0}),p=(0,r.VK)((()=>(0,C.xy)(t.getInsertionPoint())),[t]),m=(0,n.useCallback)((e=>{d.createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:a,perform:o=>{c.sW({store:t.getConfigStore(),data:{insertion_point:e},transaction:o})}})}),[a,t]);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(k.X,{...e,title:(0,M.jsx)(s.FormattedMessage,{id:"automations.DuplicateBlocksAction.header",defaultMessage:"Insert blocks"}),picker:(0,M.jsx)(A,{currentOption:p,disabled:o,onChange:m})}),u?(0,M.jsx)(_,{...e,contentParentPointer:u}):null]})}function _(e){window.__c={n:"DuplicateBlocksActionEditor"};const{actionStore:t,disabled:o,contentParentPointer:l,buttonPlacement:c}=e,m=(0,i.O7)(),S=(0,a.yK)((e=>({listWrap:{background:e.contentBackground,borderRadius:5,boxShadow:e.inputBoxShadow,fontSize:14,minHeight:64,paddingBlock:3,paddingInline:10,..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"}})),[]),b=(0,r.VK)((()=>v.G.createChildStore(t,l)),[t,l]),C=(0,r.VK)((()=>b.getContentStore()),[b]),k=(0,n.useCallback)((e=>{(0,f.ZP)({event:e,context:f.Af.EditorClick,callback:()=>{if(!C)return;(C.getValue()||[]).length>0||d.createAndCommit({userAction:"DuplicateBlocksAction.handleListClick",environment:m,perform:e=>{x.Nj({environment:m,parentStore:C,transaction:e})}})}})}),[m,C]);if(!C)return null;const w="inline"===(null==c?void 0:c.type);return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(y.Z,{store:b,analyticsName:"duplicate_blocks_action",isListContainer:!0,children:(0,M.jsx)(p.p,{allowSelectionWithin:!0,children:(0,M.jsx)("div",{style:S.listWrap,onClick:k,className:h.Wh_,children:(0,M.jsx)(u.O,{displayName:"DuplicateBlocksActionContent",disabled:o,children:(0,M.jsx)(g.Z,{disabled:o,store:C,emptyPlaceholder:(0,M.jsx)("div",{style:S.emptyPlaceholder,children:w?(0,M.jsx)(s.FormattedMessage,{id:"automations.DuplicateBlocksAction.emptyPlaceholder",defaultMessage:"Click to edit or drop blocks here…"}):(0,M.jsx)(s.FormattedMessage,{id:"automations.DuplicateBlocksAction.emptyCannotDropPlaceholder",defaultMessage:"Click to edit blocks here…"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})})})}function A(e){window.__c={n:"InsertBlockInDropdownButton"};const{currentOption:t,disabled:o,onChange:i}=e,a=(0,s.useIntl)(),l=(0,b.d)(),c=(0,r.qz)(void 0,S.Z),d=(0,n.useCallback)((e=>{i&&t.key!==e&&i(e),c.setState({open:!1})}),[c,t,i]);return(0,M.jsx)(m.ZP,{alignmentToOrigin:m.vR.End,buttonPopupStore:c,disabled:o,originGap:0,placementToOrigin:m.pO.Bottom,popupType:l,render:()=>(0,M.jsx)(C.A3,{currentOption:t,onChange:d}),renderOrigin:e=>(0,M.jsx)(w.S,{...e,disabled:o,variant:"gray",children:a.formatMessage(t.menuItemLabel)})})}},29804:(e,t,o)=>{o.d(t,{Z:()=>g,u:()=>y});var n=o(67294),i=o(24405),r=o(84619),a=o(54497),l=o(82990),s=o(9291),c=o(52821),d=o(4023),u=o(64973),p=o(93060),m=o(85893);function g(e){window.__c={n:"UnsupportedPropertyTriggerAction"};const{disabled:t,onClick:o,onDelete:s,propertySchema:c}=e,g=(0,i.Fg)(),h="light"===g.mode?50:200,f="light"===g.mode?700:900,S=(0,i.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]},title:{flexShrink:1,fontSize:12,fontWeight:l.Z.fontWeight.medium},titleWrap:{display:"flex"}}}),[]),v=y({propertySchema:c}),x=(0,n.useCallback)((e=>(0,m.jsx)(u.pW,{...e,disabled:t,icon:e=>(0,a.t)({...e,...S.warning}),onClick:o,onDelete:s,title:(0,m.jsx)("div",{style:S.titleWrap,children:(0,m.jsx)(r.ZP,{backgroundColor:g.accentColors.yellow[h],color:g.accentColors.yellow[f],format:r.lo.Medium,isSingle:!0,shouldShrink:!0,style:S.title,theme:g,value:v})})})),[h,t,o,s,S.title,S.titleWrap,S.warning,f,g,v]);return(0,m.jsx)(p.y,{renderOrigin:x,title:v,tooltipAlignment:d.v.Center,tooltipPlacement:d.u.Left})}function y(e){const{propertySchema:t}=e,o=c.SO[t.type];return(0,m.jsx)(s.FormattedMessage,{id:"UnsupportedPropertyTriggerAction.unsupportedProperty.title",defaultMessage:"{propertyType} property not supported",values:{propertyType:o}})}},26612:(e,t,o)=>{o.d(t,{A3:()=>Z,JM:()=>I,xy:()=>B});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(28751),s=o(1230),c=o(41490),d=o(72126),u=o(82990),p=o(9291),m=o(9953),g=o(82530),y=o(52275),h=o(31945),f=o(78140),S=o(32163),v=o(72495),x=o(61766),b=o(12455),C=o(95193),k=o(35294),w=o(20804),M=o(60781),j=o(40190),_=o(80253),A=o(85893);const T=(0,p.defineMessages)({aboveMenuItemLabel:{id:"automations.DuplicateBlocksAction.aboveButtonLabel",defaultMessage:"Above button"},aboveTitle:{id:"automations.DuplicateBlocksAction.aboveTitle",defaultMessage:"above button"},belowMenuItemLabel:{id:"automations.DuplicateBlocksAction.belowButtonLabel",defaultMessage:"Below button"},belowTitle:{id:"automations.DuplicateBlocksAction.belowTitle",defaultMessage:"below button"},title:{defaultMessage:"Insert blocks {insertionPicker}",id:"automations.DuplicateBlocksAction.title"}}),P={before:{icon:(0,c.F)({width:16}),key:"before",menuItemLabel:T.aboveMenuItemLabel,title:T.aboveTitle},after:{icon:(0,s.H)({width:16}),key:"after",menuItemLabel:T.belowMenuItemLabel,title:T.belowTitle}},V=P.after;function I(e){window.__c={n:"DuplicateBlocksAction"};const{actionStore:t,disabled:o}=e,{editorPlacement:s}=(0,b.i)(),c=(0,i.O7)(),u=(0,a.yK)((()=>({title:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0",whiteSpace:"pre-wrap"}})),[]),y=(0,r.VK)((()=>(0,d.Ps)(t.getBlockPointers())),[t],{useDeepEqual:!0}),h=(0,r.VK)((()=>B(t.getInsertionPoint())),[t]),f=(0,n.useCallback)((e=>function(e,t,o){g.createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:e,perform:e=>{m.sW({store:t.getConfigStore(),data:{insertion_point:o},transaction:e})}})}(c,t,e)),[t,c]),S=(0,r.qz)(void 0,x.Z),v=(0,n.useCallback)((()=>S.reset()),[S]),C=(0,n.useMemo)((()=>(0,A.jsx)(w.e,{actionStore:t,closeMenu:v})),[t,v]),k=(0,l.z)("duplicate_blocks"),{display:j}=k;return(0,A.jsxs)(_.Ao,{actionMenu:C,buttonPopupStore:S,children:[(0,A.jsx)(_.vu,{icon:j.icon,children:(0,A.jsx)("div",{style:u.title,children:(0,A.jsx)(p.FormattedMessage,{...T.title,values:{insertionPicker:(0,A.jsx)(F,{currentOption:h,disabled:Boolean(o),onChange:f})}})})}),(0,A.jsx)(_.R7,{children:y?(0,A.jsx)(M.YB,{actionStore:t,buttonPlacement:s,contentParentPointer:y,disabled:Boolean(o)}):null})]})}function F(e){window.__c={n:"InsertBlockInDropdownButton"};const{currentOption:t,disabled:o,onChange:i}=e,l=(0,p.useIntl)(),s=(0,a.yK)((e=>({button:{color:e.text.primary,fontWeight:u.Z.fontWeight.medium,height:"auto",marginBlock:-6,marginInline:-5,paddingBlock:6,paddingInline:5}})),[]),c=(0,k.d)(),d=(0,r.qz)(void 0,x.Z),m=(0,n.useCallback)((e=>{i&&t.key!==e&&i(e),d.setState({open:!1})}),[d,t,i]);return(0,A.jsx)(h.ZP,{alignmentToOrigin:h.vR.End,buttonPopupStore:d,disabled:o,originGap:0,placementToOrigin:h.pO.Bottom,popupType:c,render:()=>(0,A.jsx)(Z,{currentOption:t,onChange:m}),renderOrigin:e=>(0,A.jsx)(j.S,{...e,disabled:o,style:s.button,variant:"gray",children:l.formatMessage(t.title)})})}function Z(e){window.__c={n:"InsertBlockInDropdownMenu"};const{currentOption:t,onChange:o}=e,n=(0,p.useIntl)(),i=(0,C.F)({maxWidth:360}),r=Object.values(P).map((e=>({key:e.key,render:o=>(0,A.jsx)(y.Z,{...o,checkState:t.key===e.key,icon:e.icon,title:n.formatMessage(e.menuItemLabel)}),action:()=>o(e.key)})));return(0,A.jsx)(f.Z,{...i,children:(0,A.jsx)(S.Z,{initialFocus:0,sections:[{key:0,render:e=>(0,A.jsx)(v.Z,{enableActionSheetTitle:!0,...e}),items:r}],type:S.i.Vertical})})}function B(e){return Object.values(P).find((t=>t.key===e))??V}},67174:(e,t,o)=>{o.d(t,{e:()=>_,p:()=>P});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(28751),s=o(90199),c=o(606),d=o(97880),u=o(82990),p=o(9291),m=o(31945),g=o(28020),y=o(67669),h=o(80444),f=o(61766),S=o(30874),v=o(41301),x=o(12455),b=o(35294),C=o(20804),k=o(10383),w=o(40190),M=o(80253),j=o(85893);function _(e){window.__c={n:"SlackNotificationAction"};const{actionStore:t,disabled:o}=e,{automationContextStore:i,automationStore:a,suppressActionErrors:s}=(0,x.i)(),c=(0,l.z)("slack_notification"),{display:d}=c,u=Boolean(o),m=B(a)?(0,j.jsx)(v.So,{content:(0,j.jsx)(p.FormattedMessage,{...v.Mm.slackNotificationAuthenticationError})}):null,g=(0,r.qz)(void 0,f.Z),y=(0,n.useCallback)((()=>g.reset()),[g]),h=(0,n.useMemo)((()=>(0,j.jsx)(C.e,{actionStore:t,closeMenu:y})),[t,y]),S=(0,n.useMemo)((()=>!s.includes(t.id)),[s,t]),b=(0,v.TU)({actionId:t.id,contextStore:i,errorKey:"external_bot_id",shouldShow:S}),k=(0,v.TU)({actionId:t.id,contextStore:i,errorKey:"target",shouldShow:S});return(0,j.jsx)(M.Ao,{actionMenu:h,buttonPopupStore:g,disabled:u,children:(0,j.jsx)(M.vu,{disabled:u,icon:d.icon,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,j.jsx)(A,{actionStore:t,automationStore:a,disabled:u,errorMessage:m??b??k})})})}function A(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationStore:o,disabled:n,errorMessage:i}=e,r=(0,a.yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,j.jsx)("div",{style:r.title,children:(0,j.jsx)(p.FormattedMessage,{defaultMessage:"<span><b>Notify</b> </span>{slackTargetPicker}",id:"automations.slackNotificationAction.action.title",values:{b:e=>(0,j.jsx)("b",{style:{fontWeight:u.Z.fontWeight.medium},children:e}),slackTargetPicker:(0,j.jsx)("div",{style:r.picker,children:(0,j.jsx)(T,{actionStore:t,automationStore:o,disabled:n,errorMessage:i})}),span:e=>(0,j.jsx)("span",{style:r.span,children:e})}})})}function T(e){window.__c={n:"AutomationSlackTargetPicker"};const{actionStore:t,automationStore:o,disabled:i,errorMessage:a}=e,[l,s]=(0,r.VK)((()=>[void 0!==t.getConfigStore().getKeyStore("external_bot_id").getValue(),t.getConfigStore().getKeyStore("target").getValue()]),[t]),u=(0,r.VK)((()=>{const e=h.default.state.currentUserStore,t=null==e?void 0:e.pointer,n=o.getCreatedByPointer();return!(!(0,d.$K)(t)||!(0,d.$K)(n))&&c.dr.isEqual(t,n)}),[o]),g=(0,r.qz)(void 0,f.Z),y=(0,n.useCallback)((()=>g.reset()),[g]),v=function(e){const{actionStore:t,automationStore:o}=e,[n,i]=(0,r.VK)((()=>{const e=t.getConfigStore();return[e.getKeyStore("target").getValue(),e.getKeyStore("external_bot_id").getValue()]}),[t]),a=B(o),l=function(e){return(0,r.VK)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(t)return S.Z.completeSlackAuthentications.state.find((e=>t===e.id))}),[e])}(t),s=(0,r.VK)((()=>S.Z.completeSlackAuthentications.state.length??0),[]);if((0,d.$K)(n)&&(0,d.$K)(i))return a?{actionStore:t,externalBotId:i,notificationActionConfigStore:t,type:"connectToSlackReconnect"}:(0,d.$K)(l)?{actionStore:t,currentExternalAuthentication:l,currentNotificationChannel:n,type:"selectChannelUpdate"}:{actionStore:t,type:"connectToSlackDefault"};return 0===s?{actionStore:t,type:"connectToSlackDefault"}:s>1?{actionStore:t,type:"selectWorkspace"}:{actionStore:t,type:"selectChannelNew"}}({actionStore:t,automationStore:o}),x=(0,b.d)(),C=l&&(0,d.$K)(s),M=(0,w.d)({errorMessage:a,hasValue:C});return(0,j.jsx)(m.ZP,{alignmentToOrigin:m.vR.End,buttonPopupStore:g,disabled:i,originGap:0,placementToOrigin:m.pO.Bottom,popupType:x,renderOrigin:e=>(0,j.jsx)(w.S,{...M,...e,disabled:i,style:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},children:C?(0,j.jsx)(P,{channel:s,isAutomationOwner:u}):(0,j.jsx)(p.FormattedMessage,{id:"slackNotificationAction.targetPicker.noTarget",defaultMessage:"Select Slack channel"})}),render:()=>(0,j.jsx)(k.Z,{initialState:v,onClose:y})})}function P(e){window.__c={n:"SlackChannelWithIcon"};const{channel:t,isAutomationOwner:o}=e,n=(0,i.O7)(),a=(0,r.VK)((()=>{const e=(0,g.RM)();return!(0,d.$K)(e)||Boolean((0,y.IJ)(n,e))}),[n]);return t&&!a&&o?"public"===t.type?(0,j.jsx)(V,{channelName:t.name}):"private"===t.type?(0,j.jsx)(I,{channelName:t.name}):"me"===t.type?(0,j.jsx)(F,{channelName:t.name}):(0,d.t1)(t.type):(0,j.jsx)(Z,{})}function V(e){return(0,j.jsx)("span",{style:u.Z.textOverflowStyle,children:`#${e.channelName}`})}function I(e){window.__c={n:"PrivateSlackChannel"};const{channelName:t}=e,o=K();return(0,j.jsxs)("div",{style:o.container,children:[(0,s.b)(o.lockIcon),(0,j.jsx)("span",{style:u.Z.textOverflowStyle,children:t})]})}function F(e){const{channelName:t}=e;return(0,j.jsx)("span",{style:u.Z.textOverflowStyle,children:`@${t}`})}function Z(){window.__c={n:"NonOwnerPrivateChannel"};const e=K();return(0,j.jsxs)("div",{style:e.container,children:[(0,s.b)(e.lockIcon),(0,j.jsx)("span",{style:u.Z.textOverflowStyle,children:(0,j.jsx)(p.FormattedMessage,{defaultMessage:"Private channel",id:"slackNotificationAction.slackTargetPersonalChannel.displayName"})})]})}function B(e){return(0,r.VK)((()=>"disabled_auth"===e.getStatus()),[e])}function K(){const{isMobile:e}=(0,i.Fy)(),t=e?u.Z.fontSize.UISmall.mobile:u.Z.fontSize.UISmall.desktop;return(0,a.yK)((()=>({container:{alignItems:"baseline",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:t}})),[t])}},26247:(e,t,o)=>{o.d(t,{B:()=>J,r:()=>ee});var n=o(67294),i=o(86628),r=o(78106),a=o(12455),l=(o(21703),o(480)),s=o(24405),c=o(28751),d=o(76205),u=o(43690),p=o(84619),m=o(149),g=o(97880),y=o(82990),h=o(9291),f=o(9953),S=o(82530),v=o(51592),x=o(31945),b=o(76798),C=o(21396),k=o(54802),w=o(61766),M=o(26136),j=o(41301),_=o(35294),A=o(20804),T=o(32984),P=o(52105),V=o(40190),I=o(8808),F=o(80253),Z=o(85893);const B=(0,h.defineMessages)({multipleTargetsFilter:{defaultMessage:"<span>Edit </span>{filterPicker}",id:"automations.UpdatePagesAction.multipleTargetsFilter"},multipleTargetsPicker:{defaultMessage:"<span>in </span>{targetPicker}",id:"automations.UpdatePagesAction.multipleTargetsPicker"},singleTarget:{defaultMessage:"<span>Edit </span>{targetPicker}",id:"automations.UpdatePagesAction.singleTarget"}});function K(e){window.__c={n:"UpdatePagesAction"};const{actionStore:t,disabled:o}=e,r=Boolean(o),s=(0,c.z)("update_pages"),{display:d}=s,p=(0,l.O7)(),{automationContextStore:m,suppressActionErrors:y}=(0,a.i)(),h=(0,i.VK)((()=>t.getTargetStore()),[t]),v=(0,i.VK)((()=>(0,g.$K)(m)?E(t,m):void 0),[m,t]),x=(0,i.VK)((()=>{var e;const o=t.getCollectionTargetStore(),n=null==o||null===(e=o.getKeyStore("filter"))||void 0===e?void 0:e.getValue();if(n)return(0,u.Ih)(n,(null==v?void 0:v.getSchema())||{})}),[t,v]),b=(0,i.VK)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),C=(0,i.VK)((()=>{if(!b||"variable"!==b.type||!m)return!1;const e=m.getContextValueForActionById(t.id,b.id);return"block"===(null==e?void 0:e.type.type)}),[t.id,m,b]),k=(0,i.qz)(void 0,w.Z),M=(0,n.useCallback)((()=>k.reset()),[k]),_=(0,n.useMemo)((()=>(0,Z.jsx)(A.e,{actionStore:t,closeMenu:M})),[t,M]),P=(0,n.useMemo)((()=>!y.includes(t.id)),[y,t]),V=(0,j.TU)({contextStore:m,actionId:t.id,shouldShow:P}),I=(0,n.useCallback)((e=>{S.createAndCommit({userAction:"UpdatePagesAction.filterChange",environment:p,perform:t=>{f.sW({data:{filter:e},store:h,transaction:t})}})}),[p,h]),B=(0,n.useCallback)((e=>{let o;if("collection"===e.type)o="UpdatePageAction.updateCollection";else if("variable"===e.type)o="UpdatePageAction.updateVariable";else{if("page"===e.type)throw new Error("Not implemented yet.");(0,g.t1)(e)}S.createAndCommit({userAction:o,environment:p,perform:o=>{f.sW({data:{properties:null,target:e,values:null},store:t.getConfigStore(),transaction:o})}})}),[p,t]);return m?(0,Z.jsxs)(F.Ao,{actionMenu:_,buttonPopupStore:k,disabled:r,children:[(0,Z.jsx)(F.vu,{disabled:r,icon:d.icon,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:C||!v?(0,Z.jsx)(R,{actionStore:t,automationContextStore:m,disabled:r,errorMessage:V,onTargetChange:B,value:b}):(0,Z.jsx)(O,{actionStore:t,automationContextStore:m,collectionStore:v,disabled:r,errorMessage:V,filter:x,onFilterChange:I,onTargetChange:B,value:b})}),v&&(0,Z.jsx)(F.R7,{disabled:r,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Z.jsx)(T.QF,{actionStore:t,collectionStore:v,contextStore:m,disabled:r,showSetPropertyActions:!0})})]}):null}function R(e){window.__c={n:"ActionSingleTitle"};const{actionStore:t,automationContextStore:o,disabled:n,errorMessage:i,onTargetChange:r,value:a}=e,l=(0,s.yK)((()=>({b:{fontWeight:y.Z.fontWeight.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,Z.jsx)("div",{style:l.title,children:(0,Z.jsx)(h.FormattedMessage,{...B.singleTarget,values:{b:e=>(0,Z.jsx)("b",{style:l.b,children:e}),targetPicker:(0,Z.jsx)(D,{actionStore:t,automationContextStore:o,disabled:n,errorMessage:i,onChange:r,value:a}),span:e=>(0,Z.jsx)("span",{style:l.span,children:e})}})})}function O(e){window.__c={n:"ActionMultipleTitle"};const{actionStore:t,automationContextStore:o,collectionStore:n,disabled:i,errorMessage:r,filter:a,onFilterChange:l,onTargetChange:c,value:d}=e,u=(0,s.yK)((()=>({b:{fontWeight:y.Z.fontWeight.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("div",{style:u.title,children:[(0,Z.jsx)(h.FormattedMessage,{...B.multipleTargetsFilter,values:{filterPicker:(0,Z.jsx)(W,{collectionStore:n,disabled:i,filter:a,onChange:l}),span:e=>(0,Z.jsx)("span",{style:u.span,children:e})}})," "]}),(0,Z.jsx)("div",{style:u.title,children:(0,Z.jsx)(h.FormattedMessage,{...B.multipleTargetsPicker,values:{targetPicker:(0,Z.jsx)(D,{actionStore:t,automationContextStore:o,disabled:i,errorMessage:r,onChange:c,value:d}),span:e=>(0,Z.jsx)("span",{style:u.span,children:e})}})})]})}function W(e){var t;window.__c={n:"FilterPicker"};const{collectionStore:o,disabled:r,filter:a,onChange:l}=e,c=(0,s.yK)((()=>({b:{fontWeight:y.Z.fontWeight.medium}})),[]),u=(0,i.qz)(void 0,w.Z),p=(0,_.d)({tabletBehavior:"slideUp"}),m=(0,n.useCallback)((()=>u.reset()),[u]),g=(0,i.VK)((()=>{const e=o.getModel(),t=null==e?void 0:e.getDatabaseType();return(0,v.Q_)(t)}),[o]),f=(null==a||null===(t=a.filters)||void 0===t?void 0:t.length)||0;return(0,Z.jsx)(x.ZP,{alignmentToOrigin:x.vR.End,disabled:r,originGap:0,placementToOrigin:x.pO.Bottom,popupType:p,renderOrigin:e=>(0,Z.jsx)(V.S,{...e,disabled:r,variant:"gray",onClick:t=>{e.onClick(t),0===f&&l(d.TI)},style:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},children:f>0?(0,Z.jsx)(h.FormattedMessage,{defaultMessage:"<b>{itemType}</b> that match {ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.UpdatePagesAction.FilterPicker.withRules",values:{b:e=>(0,Z.jsx)("b",{style:c.b,children:e}),itemType:g,ruleCount:f}}):(0,Z.jsx)(h.FormattedMessage,{defaultMessage:"all <b>{itemType}</b>",id:"automations.UpdatePagesAction.FilterPicker.noRules",values:{b:e=>(0,Z.jsx)("b",{style:c.b,children:e}),itemType:g}})}),render:()=>(0,Z.jsx)(P.m,{collectionStore:o,disabled:r,filter:a,onChange:l,onClose:m})})}function D(e){window.__c={n:"TargetPicker"};const{actionStore:t,automationContextStore:o,disabled:r,errorMessage:a,onChange:l,value:s}=e,c=(0,i.VK)((()=>{if("collection"===(null==s?void 0:s.type))return M.NW.createChildStore(t,s.collection)}),[t,s]),d=(0,i.VK)((()=>{if(s&&"variable"===s.type)return o.getContextValueForActionById(t.id,s.id)}),[s,o,t.id]),u=(0,V.d)({errorMessage:a,hasValue:Boolean(s||d)}),m=(0,i.qz)(void 0,w.Z),y=(0,_.d)(),f=(0,n.useCallback)((()=>m.reset()),[m]),S=(0,n.useCallback)((e=>{l(e),f()}),[l,f]);return(0,Z.jsx)(x.ZP,{buttonPopupStore:m,popupType:y,alignmentToOrigin:x.vR.End,placementToOrigin:x.pO.Bottom,originGap:0,disabled:r,renderOrigin:e=>(0,Z.jsx)(V.S,{disabled:r,...u,...e,style:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},children:(0,g.$K)(c)?(0,Z.jsx)(b.Z,{store:c}):d?(0,Z.jsx)(C.F,{format:p.lo.Medium,isSingle:!0,value:d}):(0,Z.jsx)(h.FormattedMessage,{id:"automations.UpdatePagesAction.pagesDropdown.label",defaultMessage:"Select database"})}),render:e=>(0,Z.jsx)(I.L,{actionId:t.id,automationContextStore:o,onChange:S,onClose:f,selectedTarget:s,skipPages:!0})})}function E(e,t){const o=e.getTargetStore().getValue();if(o){if("collection"===o.type)return M.NW.createChildStore(e,o.collection);if("variable"===o.type){if(!t)return;const n=t.compilationResultStore.state;if(m.x.isFail(n))return;const i=(0,r.vx)(n.value.valueTypes,o.id);if(i)return(0,k.wB)(i,e)}else{if("page"===o.type)return;(0,g.t1)(o)}}}var N=o(10383),L=o(29723),z=o(23704),H=o(93377),U=o(82207),$=o(84799),q=o(99144),G=o(4328),Q=o(73427);function Y(e){var t;window.__c={n:"UpdateThisPageAction"};const{actionStore:o,disabled:r}=e,{automationContextStore:l}=(0,a.i)(),s=(0,i.VK)((()=>o.getConfig()),[o]),c=(0,i.VK)((()=>(0,g.$K)(l)?E(o,l):void 0),[l,o]),d=(0,i.VK)((()=>null==c?void 0:c.getSchema()),[c]),u=(0,i.qz)(void 0,w.Z),p=(0,n.useCallback)((()=>u.reset()),[u]),m=(0,n.useMemo)((()=>(0,Z.jsx)(A.e,{actionStore:o,closeMenu:p})),[o,p]),y=((null==s?void 0:s.properties)??[])[0],h=null==d?void 0:d[y],f=null==s||null===(t=s.values)||void 0===t?void 0:t[y],S={actionMenu:m,buttonPopupStore:u,disabled:Boolean(r),value:null==f?void 0:f.value};return h&&f&&c?"person"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(U.ZP,{...e,...S,propertySchema:h})}):"status"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(G.yr,{...e,...S,propertySchema:h})}):"select"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(q.D9,{...e,...S,propertySchema:h})}):"multi_select"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(H.m,{...e,...S,propertySchema:h})}):"date"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(z.er,{...e,...S,propertySchema:h,valueContext:{collectionStore:c,property:y,type:"collection"}})}):"relation"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)($.ZP,{...e,...S,collectionStore:c,propertySchema:h})}):"checkbox"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(L.Q2,{...e,...S,propertySchema:h})}):"title"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(Q.QQ,{...e,...S,propertySchema:h})}):"text"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(Q.Vk,{...e,...S,propertySchema:h})}):"email"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(Q.Kh,{...e,...S,propertySchema:h})}):"url"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(Q.GJ,{...e,...S,propertySchema:h})}):"number"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(Q.go,{...e,...S,propertySchema:h})}):"phone_number"===h.type?(0,Z.jsx)(X,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,Z.jsx)(Q.gi,{...e,...S,propertySchema:h})}):null:null}function X(e){window.__c={n:"EditActionMenuButtonPopup"};const{actionId:t,propertyId:o,renderOrigin:r}=e,a=(0,_.d)(),l=(0,i.qz)(void 0,w.Z),s=(0,n.useCallback)((()=>l.reset()),[l]),c=(0,n.useMemo)((()=>({actionId:t,propertyId:o,type:"eventActionProperty"})),[t,o]);return(0,Z.jsx)(x.ZP,{buttonPopupStore:l,popupType:a,render:()=>(0,Z.jsx)(N.Z,{initialState:c,onClose:s}),renderOrigin:r})}function J(e){window.__c={n:"UpdatePagesActionResolver"};const{actionStore:t}=e,{automationContextStore:o}=(0,a.i)();return(0,i.VK)((()=>ee(o,t)),[t,o])?(0,Z.jsx)(Y,{...e}):(0,Z.jsx)(K,{...e})}function ee(e,t){var o;if(!t.isType("update_pages"))return!1;const n=t.getConfig(),i="variable"===(null==n||null===(o=n.target)||void 0===o?void 0:o.type)?(0,r.MY)(n.target.id):void 0;return"event"===(null==e?void 0:e.context.type)&&i&&"global"===i.source&&"button_page"===i.global}},29723:(e,t,o)=>{o.d(t,{G7:()=>S,LJ:()=>f,Q2:()=>h});var n=o(67294),i=o(24405),r=o(76218),a=o(42283),l=o(82990),s=o(9291),c=o(87011),d=o(20776),u=o(4023),p=o(56812),m=o(93060),g=o(80253),y=o(85893);function h(e){window.__c={n:"UpdateThisPageCheckboxPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:s,propertySchema:c,value:d}=e,p=(0,i.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...l.Z.textOverflowStyle,fontWeight:l.Z.fontWeight.semibold}})),[]),h=f({propertySchema:c,styles:p,value:d}),v=S({propertySchema:c,value:d}),x=(0,n.useCallback)((e=>(0,y.jsx)(g.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:r,icon:a.r,onClick:s,children:(0,y.jsx)("div",{style:p.content,children:h})})),[t,o,r,s,p.content,h]);return(0,y.jsx)(m.y,{renderOrigin:x,title:v,tooltipAlignment:u.v.Center,tooltipPlacement:u.u.Left})}function f(e){const{propertySchema:t,styles:o,value:n}=e,i=(0,r.A6)(null==n?void 0:n.value)[0],a=t.name,l=!0===i?(0,c.c$e)({width:12}):(0,c.UmH)({width:10}),u=!0===i?(0,y.jsx)(s.FormattedMessage,{...p.Bo.actionCheckboxPropertyChecked}):(0,y.jsx)(s.FormattedMessage,{...p.Bo.actionCheckboxPropertyUnchecked});return(0,y.jsx)(s.FormattedMessage,{...p.hW({propertyName:(0,y.jsx)("span",{style:o.propertyName,children:a}),propertyValue:(0,y.jsx)(d.o,{icon:l,shouldTruncateChildren:!0,children:u})})})}function S(e){const{propertySchema:t,value:o}=e,n=!0===(0,r.A6)(null==o?void 0:o.value)[0]?(0,y.jsx)(s.FormattedMessage,{...p.Bo.actionCheckboxPropertyChecked}):(0,y.jsx)(s.FormattedMessage,{...p.Bo.actionCheckboxPropertyUnchecked});return(0,y.jsx)(s.FormattedMessage,{...p.hW({propertyName:t.name,propertyValue:n})})}},23704:(e,t,o)=>{o.d(t,{Sg:()=>_,er:()=>j,kD:()=>A});var n=o(67294),i=o(86628),r=o(24405),a=o(84619),l=o(7057),s=o(78106),c=o(76218),d=o(42875),u=o(53016),p=o(70203),m=o(97880),g=o(82990),y=o(9291),h=o(26388),f=o(21396),S=o(75311),v=o(85567),x=o(54802),b=o(56812),C=o(12455),k=o(93060),w=o(80253),M=o(85893);function j(e){window.__c={n:"UpdateThisPageDatePropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:a,onClick:l,propertySchema:s,value:c,valueContext:d}=e,{automationContextStore:p}=(0,C.i)(),m=(0,y.useIntl)(),f=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...g.Z.textOverflowStyle,fontWeight:g.Z.fontWeight.semibold}})),[]),S=(0,i.VK)((()=>p?_({automationContextStore:p,intl:m,propertySchema:s,styles:f,value:c,valueContext:d}):void 0),[p,m,s,f,c,d]),v=(0,i.VK)((()=>p?A({automationContextStore:p,intl:m,propertySchema:s,value:c,valueContext:d}):void 0),[p,m,s,c,d]),x=(0,n.useCallback)((e=>(0,M.jsx)(w.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:a,icon:u.V,onClick:l,children:(0,M.jsx)("div",{style:f.content,children:S})})),[t,o,a,l,f.content,S]);return p&&S&&v?(0,M.jsx)(k.y,{renderOrigin:x,title:v,tooltipAlignment:h.v2.Center,tooltipPlacement:h.ug.Left}):null}function _(e){const{automationContextStore:t,intl:o,propertySchema:n,styles:i,value:r,valueContext:u}=e,g=(0,M.jsx)("span",{style:i.propertyName,children:n.name});if(void 0===(null==r?void 0:r.value))return(0,M.jsx)(y.FormattedMessage,{...b.xf({propertyName:g})});let h;const v=x.tk(t),C=(0,S._)(u),k=(0,c.A6)(null==r?void 0:r.value)[0];if("string"!=typeof k&&"boolean"!=typeof k&&!(0,p.IWo)(k)&&!(0,p.STW)(k)){if((0,p.wjk)(k)){const e=(0,p.vmO)(k).id,t=(0,s.vx)(v,e);h=t?(0,M.jsx)(f.F,{value:t,format:a.lo.Medium,isSingle:!1,shouldShrink:!0}):void 0}else if((0,p.fpG)(k)){const e=(0,p.zyO)(k);h=e?(0,l.OB)({value:e,date_format:C.dateFormat,time_format:C.timeFormat,userTimeZone:(0,d.r)(),allowRelativeDates:!0,intl:o,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:n}=e;return(0,m.$K)(o)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(T,{value:n})," → ",(0,M.jsx)(T,{value:o})]}):(0,m.$K)(t)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(T,{value:n})," → ",(0,M.jsx)(T,{value:t})]}):(0,M.jsx)(T,{value:n})}}):null}else(0,m.t1)(k);return void 0===h?void 0:(0,M.jsx)(y.FormattedMessage,{...b.zU({propertyName:g,propertyValue:h})})}}function A(e){const{automationContextStore:t,intl:o,propertySchema:n,value:i,valueContext:r}=e,a=n.name;if(void 0===(null==i?void 0:i.value))return(0,M.jsx)(y.FormattedMessage,{...b.xf({propertyName:a})});let u;const g=x.tk(t),h=(0,S._)(r),v=(0,c.A6)(null==i?void 0:i.value)[0];if("string"!=typeof v&&"boolean"!=typeof v&&!(0,p.IWo)(v)&&!(0,p.STW)(v)){if((0,p.wjk)(v)){const e=(0,p.vmO)(v).id,t=(0,s.vx)(g,e);u=t?(0,f.e)(t):void 0}else if((0,p.fpG)(v)){const e=(0,p.zyO)(v);u=e?(0,l.ZV)({value:e,date_format:h.dateFormat,time_format:h.timeFormat,userTimeZone:(0,d.r)(),allowRelativeDates:!0,intl:o,shortenDateAndRange:!0,displayInUserTimezone:!0}):null}else(0,m.t1)(v);return void 0===u?void 0:(0,M.jsx)(y.FormattedMessage,{...b.zU({propertyName:a,propertyValue:u})})}}function T(e){window.__c={n:"AutomationDateToken"};const{value:t}=e,o=(0,r.Fg)();return(0,M.jsx)(v.Z,{backgroundColor:o.accentColors.gray[75],format:a.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:{marginBlockEnd:4},value:t})}},93377:(e,t,o)=>{o.d(t,{H:()=>f,m:()=>S});var n=o(67294),i=o(86628),r=o(24405),a=o(76218),l=o(72050),s=o(97880),c=o(82990),d=o(9291),u=o(26388),p=o(56812),m=o(93060),g=o(80253),y=o(99144),h=o(85893);const f=5;function S(e){window.__c={n:"UpdateThisPageMultiSelectPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:S,limit:v=f,onClick:x,propertySchema:b,value:C}=e,k=(0,d.useIntl)(),w=null!=C&&C.value?(0,a.A6)(null==C?void 0:C.value):[],M=p.oJ({limit:v,optionValues:w.map((e=>"string"==typeof e?e:void 0)).filter(s.$K),propertySchema:b}),j=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:M.length<=1?"nowrap":"wrap",whiteSpace:"pre"},propertyName:{...c.Z.textOverflowStyle,fontWeight:c.Z.fontWeight.semibold}})),[M.length]),_=(0,i.VK)((()=>(0,y.F0)({intl:k,propertySchema:b,styles:j,values:M})),[k,M,b,j]),A=(0,i.VK)((()=>(0,y.I7)({intl:k,propertySchema:b,values:M})),[k,M,b]),T=(0,n.useCallback)((e=>(0,h.jsx)(g.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:S,icon:l.A,onClick:x,children:(0,h.jsx)("div",{style:j.content,children:_})})),[t,o,S,x,j.content,_]);return(0,h.jsx)(m.y,{renderOrigin:T,title:A,tooltipAlignment:u.v2.Center,tooltipPlacement:u.ug.Left})}},82207:(e,t,o)=>{o.d(t,{UD:()=>x,ZP:()=>v,iT:()=>b,y3:()=>C});var n=o(67294),i=o(86628),r=o(24405),a=o(66897),l=o(80951),s=o(26774),c=o(97880),d=o(82990),u=o(9291),p=o(26388),m=o(92864),g=o(56812),y=o(12455),h=o(93060),f=o(80253),S=o(85893);function v(e){window.__c={n:"UpdateThisPagePersonPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:a,onClick:l,propertySchema:m,value:g}=e,{automationContextStore:v}=(0,y.i)(),k=(0,u.useIntl)(),w=(0,i.VK)((()=>{const e=null==v?void 0:v.context.automationStore;return(0,c.$K)(e)?x({getRecordModel:e.getRecordModel,propertySchema:m,value:g}):[]}),[null==v?void 0:v.context.automationStore,m,g]),M=(0,r.yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:w.length>1?"wrap":"nowrap",whiteSpace:"pre"},propertyName:{...d.Z.textOverflowStyle,fontWeight:d.Z.fontWeight.semibold},propertyValue:{...d.Z.textOverflowStyle,paddingBlockStart:4},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:4}})),[w.length]),j=(0,i.VK)((()=>b({actors:w,propertySchema:m,styles:M})),[w,m,M]),_=(0,i.VK)((()=>C({actors:w,intl:k,propertySchema:m})),[w,k,m]),A=(0,n.useCallback)((e=>(0,S.jsx)(f.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:a,icon:s.O,onClick:l,children:(0,S.jsx)("div",{style:M.content,children:j})})),[t,o,a,l,M.content,j]);return(0,S.jsx)(h.y,{renderOrigin:A,title:_,tooltipAlignment:p.v2.Center,tooltipPlacement:p.ug.Left})}function x(e){const{getRecordModel:t,propertySchema:o,value:n}=e;return(0,l.DW)({textValue:null==n?void 0:n.value,propertySchema:o,blockCreatorPointer:void 0}).map((e=>(0,a.Hl)({getRecordModel:t,pointer:e}))).filter(c.$K)}function b(e){const{actors:t,propertySchema:o,styles:n}=e,i=(0,S.jsx)("span",{style:n.propertyName,children:o.name}),r=function(e){const{actors:t,styles:o}=e;return 1===t.length?(0,S.jsx)("div",{style:o.propertyValue,children:(0,S.jsx)(m.ZP,{actor:t[0],showRemoveButton:!1,format:m.ZP.Format.Medium,isSingle:!1})}):(0,S.jsx)("ul",{style:o.propertyValueList,children:t.map(((e,t)=>(0,S.jsx)("li",{children:(0,S.jsx)("div",{style:o.propertyValue,children:(0,S.jsx)(m.ZP,{actor:e,showRemoveButton:!1,format:m.ZP.Format.Medium,isSingle:!1})},t)},t)))})}({actors:t,styles:n});let a;return a=0===t.length?g.ht({propertyName:i}):1===t.length?g.wE({propertyName:i,propertyValue:r}):g.Oq({propertyName:i,propertyValue:r}),(0,S.jsx)(u.FormattedMessage,{...a})}function C(e){const{actors:t,intl:o,propertySchema:n}=e,i=t.map((e=>(0,a.$4)(o,e))),r=n.name,l=o.formatList(i,{style:"long",type:"conjunction"});let s;return s=0===t.length?g.ht({propertyName:r}):1===t.length?g.wE({propertyName:r,propertyValue:l}):g.Oq({propertyName:r,propertyValue:l}),(0,S.jsx)(u.FormattedMessage,{...s})}},84799:(e,t,o)=>{o.d(t,{ZP:()=>j,vT:()=>A,wr:()=>T});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(84619),s=o(78106),c=o(76218),d=o(92607),u=o(21202),p=o(70203),m=o(97880),g=o(82990),y=o(9291),h=o(26388),f=o(21396),S=o(10009),v=o(37034),x=o(26136),b=o(56812),C=o(12455),k=o(93060),w=o(80253),M=o(85893);function j(e){window.__c={n:"UpdateThisPageRelationPropertyAction"};const{actionMenu:t,buttonPopupStore:o,collectionStore:l,disabled:s,onClick:c,propertySchema:u,value:p}=e,{automationContextStore:m}=(0,C.i)(),f=(0,i.O7)(),S=(0,y.useIntl)(),v=(0,r.VK)((()=>(null==m?void 0:m.getAllContextValues())??[]),[m]),x=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",minWidth:0,whiteSpace:"pre"},propertyName:{...g.Z.textOverflowStyle,fontWeight:g.Z.fontWeight.semibold,minWidth:20},propertyValue:{...g.Z.textOverflowStyle,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10},propertyValueListItem:{display:"flex"}})),[]),b=(0,r.VK)((()=>A({automationContextValues:v,collectionStore:l,propertySchema:u,styles:x,value:p})),[v,l,u,x,p]),j=(0,r.VK)((()=>T({automationContextValues:v,collectionStore:l,environment:f,intl:S,propertySchema:u,value:p})),[v,l,f,S,u,p]),_=(0,n.useCallback)((e=>(0,M.jsx)(w.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:s,icon:d.v,onClick:c,children:b})),[t,o,s,c,b]);return(0,M.jsx)(k.y,{renderOrigin:_,title:j,tooltipAlignment:h.v2.Center,tooltipPlacement:h.ug.Left})}function _(e){const{collectionStore:t,value:o}=e;return"string"==typeof o?(0,M.jsx)(S.Z,{blockId:o,format:l.lo.Medium,isSingle:!0,noUnderline:!0,parentStore:t,shouldShrink:!0}):(0,M.jsx)(f.F,{format:l.lo.Medium,isSingle:!0,shouldShrink:!0,value:o})}function A(e){const{automationContextValues:t,collectionStore:o,propertySchema:n,styles:i,value:r}=e,a=r?P({automationContextValues:t,limit:n.limit,value:r}):[],l=(0,M.jsx)("span",{style:i.propertyName,children:n.name});let s;return s=0===a.length?(0,M.jsx)("div",{style:i.content,children:(0,M.jsx)(y.FormattedMessage,{...b.Iu({propertyName:l})})}):1===a.length?(0,M.jsx)("div",{style:i.content,children:(0,M.jsx)(y.FormattedMessage,{...b.S0({propertyName:l,propertyValue:(0,M.jsx)("span",{style:i.propertyValue,children:(0,M.jsx)(_,{collectionStore:o,value:a[0]})})})})}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{style:i.content,children:(0,M.jsx)(y.FormattedMessage,{...b.om({propertyName:l,propertyValue:[]})})}),(0,M.jsx)("ul",{style:i.propertyValueList,children:a.map(((e,t)=>(0,M.jsx)("li",{style:i.propertyValueListItem,children:(0,M.jsx)(_,{collectionStore:o,value:e})},t)))})]}),s}function T(e){const{automationContextValues:t,collectionStore:o,environment:n,intl:i,propertySchema:r,value:a}=e,l=(a?P({automationContextValues:t,limit:r.limit,value:a}):[]).map((e=>{if("string"==typeof e){const t=x.G.createChildStore(o,{id:e,table:u.iU});return(0,v.vU)({environment:n,intl:i,store:t})}return(0,f.e)(e)})).filter(m.$K),s=r.name;let c;return c=0===l.length?b.Iu({propertyName:s}):1===l.length?b.S0({propertyName:s,propertyValue:l[0]}):b.om({propertyName:s,propertyValue:i.formatList(l,{style:"long",type:"conjunction"})}),(0,M.jsx)(y.FormattedMessage,{...c})}function P(e){const{automationContextValues:t,limit:o,value:n}=e;return(0,c.A6)(n.value).slice(0,o).map((e=>{if("string"!=typeof e&&"boolean"!=typeof e){if((0,p.wjk)(e)){const o=(0,p.vmO)(e).id,n=(0,s.vx)(t,o);if(!n)return;return n}if((0,p.STW)(e)){const t=(0,p.TOT)(e);if(!t)return;return t}}})).filter(m.$K)}},99144:(e,t,o)=>{o.d(t,{D9:()=>C,F0:()=>k,I7:()=>w});var n=o(67294),i=o(86628),r=o(24405),a=o(84619),l=o(76218),s=o(53866),c=o(72126),d=o(97880),u=o(82990),p=o(9291),m=o(26388),g=o(22084),y=o(85567),h=o(65380),f=o(56812),S=o(93060),v=o(80253),x=o(37867),b=o(85893);function C(e){window.__c={n:"UpdateThisPageSelectPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:a,onClick:d,propertySchema:g,value:y}=e,h=(0,p.useIntl)(),x=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...u.Z.textOverflowStyle,fontWeight:u.Z.fontWeight.semibold}})),[]),C=null!=y&&y.value?(0,l.A6)(null==y?void 0:y.value)[0]:void 0,M=f.oJ({propertySchema:g,optionValues:(0,c.HD)(C)?[C]:[]}),j=(0,i.VK)((()=>k({intl:h,propertySchema:g,styles:x,values:M})),[h,M,g,x]),_=(0,i.VK)((()=>w({intl:h,propertySchema:g,values:M})),[h,M,g]),A=(0,n.useCallback)((e=>(0,b.jsx)(v.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:a,icon:s.w,onClick:d,children:(0,b.jsx)("div",{style:x.content,children:j})})),[t,o,a,d,x.content,j]);return(0,b.jsx)(S.y,{renderOrigin:A,title:_,tooltipAlignment:m.v2.Center,tooltipPlacement:m.ug.Left})}function k(e){const{intl:t,propertySchema:o,styles:n,tokenFormat:i,values:r}=e,l=i??a.lo.Medium,s=(0,b.jsx)("span",{style:n.propertyName,children:o.name}),c=r.map((e=>"deleted"===e.type?(0,b.jsx)(x.Z,{tokenFormat:l},`missing_option_value_${e.value}`):"option"===e.type?(0,b.jsx)(g.a,{color:e.value.color,format:l,isSingle:!0,showRemoveButton:!1,value:e.value.value},e.value.id):"truncation"===e.type?(0,b.jsx)(y.Z,{format:l,isRound:!0,isSingle:!0,showRemoveButton:!1,value:e.value},"More tokens"):void(0,d.t1)(e)));return 0===c.length?(0,b.jsx)(p.FormattedMessage,{...f.Mw({propertyName:s})}):1===c.length?(0,b.jsx)(p.FormattedMessage,{...f.rf({propertyName:s,propertyValue:c[0]})}):(0,b.jsx)(p.FormattedMessage,{...f.Sj({propertyName:s,propertyValue:(0,h.H)(t.formatList(c,{style:"long",type:"conjunction"}))})})}function w(e){const{intl:t,propertySchema:o,values:n}=e,i=o.name,r=n.map((e=>"deleted"===e.type?f.ST(t):"option"===e.type?e.value.value:"truncation"===e.type?e.value:void(0,d.t1)(e)));return 0===r.length?(0,b.jsx)(p.FormattedMessage,{...f.Mw({propertyName:i})}):1===r.length?(0,b.jsx)(p.FormattedMessage,{...f.rf({propertyName:i,propertyValue:r[0]})}):(0,b.jsx)(p.FormattedMessage,{...f.Sj({propertyName:i,propertyValue:(0,h.H)(t.formatList(r,{style:"long",type:"conjunction"}))})})}},4328:(e,t,o)=>{o.d(t,{LQ:()=>S,O3:()=>f,yr:()=>h});var n=o(67294),i=o(86628),r=o(24405),a=o(76218),l=o(3729),s=o(82990),c=o(9291),d=o(26388),u=o(56812),p=o(93060),m=o(80253),g=o(87181),y=o(85893);function h(e){window.__c={n:"UpdateThisPageStatusPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:u,onClick:g,propertySchema:h,value:v}=e,x=(0,c.useIntl)(),b=(0,a.A6)(null==v?void 0:v.value)[0],C=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.semibold}})),[]),k=(0,i.VK)((()=>f({intl:x,propertySchema:h,styles:C,value:b})),[x,h,b,C]),w=(0,i.VK)((()=>S({intl:x,propertySchema:h,value:b})),[x,h,b]),M=(0,n.useCallback)((e=>(0,y.jsx)(m.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:u,icon:l.T,onClick:g,children:(0,y.jsx)("div",{style:C.content,children:k})})),[t,o,u,g,C.content,k]);return k&&w?(0,y.jsx)(p.y,{renderOrigin:M,title:w,tooltipAlignment:d.v2.Center,tooltipPlacement:d.ug.Left}):null}function f(e){const{intl:t,propertySchema:o,styles:n,value:i}=e;if(!i||"string"!=typeof i)return;const r=(0,y.jsx)("span",{style:n.propertyName,children:o.name}),a=(0,g.L)({intl:t,groupValues:[],optionValues:[i],propertySchema:o});return 0!==a.length?(0,y.jsx)(c.FormattedMessage,{...(0,u.Ig)({propertyName:r,propertyValue:a})}):void 0}function S(e){const{intl:t,propertySchema:o,value:n}=e;if(!n||"string"!=typeof n)return;const i=o.name,r=(0,g.L)({intl:t,isText:!0,groupValues:[],optionValues:[n],propertySchema:o});return 0!==r.length?(0,y.jsx)(c.FormattedMessage,{...(0,u.Ig)({propertyName:i,propertyValue:r})}):void 0}},73427:(e,t,o)=>{o.d(t,{GJ:()=>I,Kh:()=>V,QQ:()=>T,Ut:()=>_,Vk:()=>P,gi:()=>Z,go:()=>F,lG:()=>A});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(84619),s=o(48524),c=o(55159),d=o(34093),u=o(108),p=o(83303),m=o(8938),g=o(23867),y=o(82990),h=o(9291),f=o(26388),S=o(85567),v=o(60682),x=o(14976),b=o(56812),C=o(12455),k=o(93060),w=o(80253),M=o(85893);function j(e){window.__c={n:"UpdateThisPageBaseTextPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:l,icon:s,onClick:c,propertySchema:d,value:u}=e,{automationStore:p}=(0,C.i)(),m=(0,i.O7)(),g=(0,a.Fg)(),h=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]),S=(0,r.VK)((()=>_({automationStore:p,environment:m,propertySchema:d,styles:h,theme:g,value:u})),[p,m,d,h,g,u]),v=(0,r.VK)((()=>A({automationStore:p,environment:m,propertySchema:d,theme:g,value:u})),[p,m,d,g,u]),x=(0,n.useCallback)((e=>(0,M.jsx)(w.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:l,icon:s,onClick:c,children:(0,M.jsx)("div",{style:h.content,children:S})})),[t,o,l,s,c,h.content,S]);return S&&v?(0,M.jsx)(k.y,{renderOrigin:x,title:v,tooltipAlignment:f.v2.Center,tooltipPlacement:f.ug.Left}):null}function _(e){const{automationStore:t,environment:o,propertySchema:n,styles:i,theme:r,value:a}=e,s=void 0===(null==a?void 0:a.value),c=null!=a&&a.value?(0,x.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,emojiType:(0,v.e_)(o),environment:o,formulaValueTypes:[],katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==a?void 0:a.value,spaceId:(0,g.C)(t.pointer.spaceId)},theme:r}):null,d=(0,M.jsx)("span",{style:i.propertyName,children:n.name}),u=(0,M.jsx)(S.Z,{format:l.lo.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,M.jsx)("span",{style:y.Z.textOverflowStyle,children:c})}),p=s?b.NZ({propertyName:d}):b.vE({propertyName:d,propertyValue:u});return(0,M.jsx)(h.FormattedMessage,{...p})}function A(e){const{automationStore:t,environment:o,propertySchema:n,theme:i,value:r}=e,a=void 0===(null==r?void 0:r.value),l=null!=r&&r.value?(0,x.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,emojiType:(0,v.e_)(o),environment:o,formulaValueTypes:[],katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==r?void 0:r.value,spaceId:(0,g.C)(t.pointer.spaceId)},theme:i}):null,s=n.name,c=l,d=a?b.NZ({propertyName:s}):b.vE({propertyName:s,propertyValue:c});return(0,M.jsx)(h.FormattedMessage,{...d})}function T(e){return(0,M.jsx)(j,{...e,icon:p.c})}function P(e){return(0,M.jsx)(j,{...e,icon:u.p})}function V(e){return(0,M.jsx)(j,{...e,icon:s.n})}function I(e){return(0,M.jsx)(j,{...e,icon:m.O})}function F(e){return(0,M.jsx)(j,{...e,icon:c.J})}function Z(e){return(0,M.jsx)(j,{...e,icon:d.u})}},66315:(e,t,o)=>{o.d(t,{R:()=>g});o(21703);var n=o(67294),i=o(86628),r=o(26388),a=o(61766),l=o(12455),s=o(73266),c=o(64973),d=o(27681),u=o(93060),p=o(80253),m=o(85893);function g(e){window.__c={n:"AutomationTriggerListItem"};const{onDelete:t}=e,{disabled:o,disableTooltip:g}=(0,l.i)(),y=(0,s.Z)(),h=(0,i.qz)(void 0,a.Z),f=(0,n.useMemo)((()=>`${d.mR} ${y?d.vs:""}`),[y]),S=(0,n.useCallback)((()=>{if(!t)throw new Error("onDelete is not implemented for trigger");t(),h.setState({open:!1})}),[h,t]),v=(0,n.useMemo)((()=>t?(0,m.jsx)(c.rn,{onDelete:S}):null),[t,S]),x=(0,n.useCallback)((t=>{const n=e.onClick?p.YG:p._S;return(0,m.jsx)("div",{className:f,children:(0,m.jsx)(n,{...t,actionMenu:v,buttonPopupStore:h,disabled:o,icon:e.icon,onClick:e.onClick,children:e.children})})}),[e.onClick,e.icon,e.children,f,v,h,o]);return(0,m.jsx)(u.y,{disable:g,renderOrigin:x,title:e.tooltip,tooltipAlignment:r.v2.Center,tooltipPlacement:r.ug.Left})}},55307:(e,t,o)=>{o.d(t,{Z:()=>H});var n=o(67294),i=o(86628),r=o(97880),a=o(91738),l=o(43261),s=o.n(l),c=o(24405),d=o(3865),u=o(39068),p=o(5257),m=o(25651),g=o(47453),y=o(9291),h=o(47307),f=o(52275),S=o(68894),v=o(78140),x=o(32163),b=o(72495),C=o(54802),k=o(12455),w=o(95193),M=o(53570),j=o(85893);const _=(0,y.defineMessages)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search for trigger…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property"}});function A(e){window.__c={n:"AutomationEventTriggerMenu"};const{automationTriggerMenuStore:t,onClose:o}=e,{automationStore:a,collectionStore:l}=(0,k.P)(),A=(0,c.Fg)(),T=(0,y.useIntl)(),P=(0,M.i)(),V=(0,n.useMemo)((()=>({...P,closeMenu:o})),[P,o]),[I,F]=n.useState(""),Z=(0,i.VK)((()=>l.getSchema()),[l]),B=(0,i.VK)((()=>a.getTrigger()),[a]),K=(0,i.VK)((()=>("event"===(null==B?void 0:B.type)||"notification_event"===(null==B?void 0:B.type))&&B.event.pagesAdded),[B]),R=(0,i.VK)((()=>(0,d._X)({collectionFormat:l.getFormat(),collectionSchema:Z})),[l,Z]),O=(0,C.EF)({collectionSchema:Z,propertyIds:R,searchTerm:I}),W=(0,c.yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),D=(0,w.F)({maxHeight:"50vh",width:266}),E=(0,j.jsx)(S.ZP,{focus:!0,style:{marginTop:12,marginBottom:6},value:I,onChange:e=>{F(e.target.value)},placeholder:T.formatMessage(_.searchInputPlaceholder)}),N=K?void 0:function(e){const{intl:t,searchInput:o,styles:n,actions:i}=e,r=t.formatMessage(_.pageAddedCopy);if(!s().test(o,r))return;return{key:"page_added_section",items:[{key:"page_added",action(){i.addPageAddedTrigger(),i.closeMenu()},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,g.R)(n.propertyIcon),title:r})}],render:e=>(0,j.jsx)(b.Z,{...e})}}({intl:T,searchInput:I,actions:V,styles:W}),L=(0,i.VK)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:n,properties:i,collectionSchema:a,theme:l,intl:c,searchInput:g,styles:S,actions:v}=e,x=c.formatMessage(_.pagePropertiesEditedCopy);let C=!1,k=[];"event"!==(null==t?void 0:t.type)&&"notification_event"!==(null==t?void 0:t.type)||(C="any"===t.event.pagePropertiesEdited.type,k="some"===t.event.pagePropertiesEdited.type?t.event.pagePropertiesEdited.some:[]);const w=[C||!s().test(g,x)?void 0:{key:"any_property_edited",action:async()=>{await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await h.confirmUserAction({message:(0,j.jsx)(y.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,j.jsx)(y.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,j.jsx)(y.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})})}({hasSpecificPropertyChangedFilters:k.length>0})&&(v.addAnyPropertyEditedTrigger(),v.closeMenu())},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,m.R)(S.propertyIcon),title:x})},...i.map((e=>{if(!k.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:n,theme:i,actions:r}=e,a=n[o];if(!a)return;const l=(0,d.bD)(a);return{key:o,action:()=>{l?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(r.addPropertyTrigger({property:o,filter:{operator:"changes_to_any"}}),r.closeMenu())},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,j.jsx)(u.ZP,{icon:a.icon,type:a.type,size:16,theme:i}),title:a.name,right:l?(0,p.o)({marginLeft:6,width:12,height:"auto"}):void 0})}}({propertyId:e,collectionSchema:a,theme:l,automationTriggerMenuStore:o,actions:v})})).filter(r.$K)].filter(r.$K);if(0===w.length)return;return{key:"page_properties_edited_section",items:w,render:e=>(0,j.jsx)(b.Z,{...e,topBorder:n,title:(0,j.jsx)(y.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property edited"})})}}({automationTriggerValue:B,automationTriggerMenuStore:t,showTopBorder:Boolean(N),properties:O,collectionSchema:Z,theme:A,searchInput:I,intl:T,styles:W,actions:V})),[B,t,N,O,Z,A,I,T,W,V]),z=n.useMemo((()=>{const e=[N,L].filter(r.$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,j.jsx)(f.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,j.jsx)(y.FormattedMessage,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,j.jsx)(b.Z,{...e})}]:e}),[N,L]);return(0,j.jsx)(v.Z,{...D,header:E,children:(0,j.jsx)(x.Z,{type:x.i.Vertical,sections:z,initialFocus:0})})}var T=o(76205),P=o(14648);function V(e){window.__c={n:"AutomationCheckboxPropertyChangedFilterMenu"};const{propertyId:t,automationTriggerMenuStore:o,propertySchema:r,propertyChangedFilter:a,onClose:l}=e,{updatePropertyTrigger:s}=(0,M.i)(),c=(0,i.VK)((()=>"changes_to_any"===a.operator?[{type:"exact",value:!0},{type:"exact",value:!1}]:(0,T.XA)(a)&&(0,T.vR)(a)?Array.isArray(a.value)?a.value:[a.value]:[]),[a]),[d,u]=(0,n.useState)(c),p=(0,n.useMemo)((()=>1===d.length?{operator:"checkbox_is",value:d[0]}:{operator:"changes_to_any"}),[d]),m=(0,n.useMemo)((()=>2===d.length||1===d.length&&"partial"),[d]),g=(0,n.useCallback)((e=>{const t=Boolean(d.find((t=>t.value===e)));u(t?d.filter((t=>t.value!==e)):[...d,{type:"exact",value:e}])}),[d]),h=(0,n.useCallback)((()=>{s({anyOptionCheckState:m,propertyId:t,currentFilter:p}),l()}),[m,p,l,t,s]),S=Boolean(d.find((e=>!0===e.value))),v=Boolean(d.find((e=>!1===e.value)));return(0,j.jsx)(P.Z,{type:"default",automationTriggerActionMenuStore:o,onDone:h,onClose:l,sections:[{key:"select",render:e=>(0,j.jsx)(b.Z,{...e,topBorder:!0}),items:[{key:"unchecked",render:e=>(0,j.jsx)(f.Z,{...e,checkState:v,isTokenTitle:!0,title:(0,j.jsx)(y.FormattedMessage,{defaultMessage:"Unchecked",id:"automations.propertyTrigger.checkbox.unchecked"})}),action:()=>g(!1)},{key:"checked",render:e=>(0,j.jsx)(f.Z,{...e,checkState:S,isTokenTitle:!0,title:(0,j.jsx)(y.FormattedMessage,{defaultMessage:"Checked",id:"automations.propertyTrigger.checkbox.checked"})}),action:()=>g(!0)}]}],headerTitle:(0,j.jsx)(y.FormattedMessage,{id:"automations.propertyTrigger.checkbox.title",defaultMessage:"{propertyName} set to",values:{propertyName:r.name}})})}var I=o(480),F=o(80951),Z=o(84619),B=o(72126),K=o(56416),R=o(60458),O=o(22084),W=o(47082);function D(e){window.__c={n:"AutomationSelectPropertyChangedFilterMenu"};const{propertyId:t,automationTriggerMenuStore:o,propertySchema:a,propertyChangedFilter:l,onClose:s}=e,{isMobile:c,isAndroid:d}=(0,I.Fy)(),u=(0,y.useIntl)(),{updatePropertyTrigger:p}=(0,M.i)(),m=(0,i.VK)((()=>{if("changes_to_any"===l.operator){return(a.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,T.dx)(l)&&!(0,T.NU)(l))return[];if((0,T.vR)(l)){const e=(a.options??[]).map((e=>e.value));return(Array.isArray(l.value)?l.value:[l.value]).filter((t=>(0,r.$K)(t.value)&&e.includes(t.value)))}return[]}),[a,l]),[g,h]=n.useState(m),S=(0,i.VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let n=!1,i=!0;const r=t.options??[];for(const a of r){const e=o.some((e=>e.value===a.value));n||=e,i&&=e}return!!i||!!n&&"partial"}({propertySchema:a,selectedOptions:g})),[a,g]),v=n.useMemo((()=>(a.options??[]).map((e=>({type:"exact",value:e.value})))),[a]),x=n.useMemo((()=>"multi_select"===a.type?{operator:"enum_contains",value:g}:"select"===a.type?{operator:"enum_is",value:g}:(0,r.t1)(a)),[a,g]),C=!0===S?[]:g.map((e=>{if(!e.value||!a.options)return;const t=(0,F.i7)(a.options,e.value);return t?(0,j.jsx)(O.a,{format:c?Z.lo.Large:Z.lo.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=B.zu(g,e);h(t)}},t.id):void 0})),[k,w]=n.useState(""),_=(0,K.I4)({query:k,propertySchema:a,selectedValues:g,updateValue:e=>{w(""),h(e)},isMobile:c,styles:{}}),A=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,j.jsx)(W.Z,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:W.U.FilterValue,tokens:C,placeholder:S?u.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):u.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=g.slice(0,g.length-1);h(e)},onClearButtonClick:()=>{h([]),s()},value:k,onChange:e=>{w(e.target.value)},dontShowBorderBottom:d,showClearButton:!0})}],render:e=>(0,j.jsx)(b.Z,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===S?h([]):!1===S||"partial"===S?h(v):(0,r.t1)(S),w("")},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,j.jsx)(R.Z,{checked:S,size:14,onClick:e.onClick}),title:(0,j.jsx)(y.FormattedMessage,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,j.jsx)(b.Z,{...e,topBorder:!0})},_.length>0?{key:"items",items:_,render:e=>(0,j.jsx)(b.Z,{...e,topBorder:!0})}:void 0].filter(r.$K);return(0,j.jsx)(P.Z,{type:"default",automationTriggerActionMenuStore:o,onDone:()=>{p({anyOptionCheckState:S,propertyId:t,currentFilter:x}),s()},onClose:s,sections:A,headerTitle:(0,j.jsx)(y.FormattedMessage,{id:"automations.propertyChangedFilterHeader.select.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}var E=o(11299),N=o(97004);function L(e){window.__c={n:"AutomationStatusPropertyChangedFilterMenu"};const{propertyId:t,automationTriggerMenuStore:o,propertySchema:a,propertyChangedFilter:l,onClose:s}=e,{isMobile:c}=(0,I.Fy)(),{updatePropertyTrigger:d}=(0,M.i)(),u=(0,i.VK)((()=>{if("changes_to_any"===l.operator){return(a.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,T.r2)(l)&&(0,T.vR)(l)?(0,T.wB)(l):[]}),[a,l]),[p,m]=n.useState(u),g=(0,i.VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,n=t.groups??[],i=t.options??[],r=n.map((e=>(0,N.IX)({group:e,options:i,filterValues:o}))),a=r.every((e=>!0===e.groupCheckState)),l=r.some((e=>!1!==e.groupCheckState));return!!a||!!l&&"partial"}({propertySchema:a,selectedStatusOptions:p})),[a,p]),h=n.useMemo((()=>(a.groups??[]).map((e=>({type:"is_group",value:e.name})))),[a]),S=(0,E.S)({propertySchema:a,statusFilterValues:p,updateValue:e=>{m(e)},isMobile:c,styles:{},visibleOptions:a.options??[]});return(0,j.jsx)(P.Z,{type:"default",automationTriggerActionMenuStore:o,onDone:()=>{d({anyOptionCheckState:g,propertyId:t,currentFilter:{operator:"status_is",value:p}}),s()},onClose:()=>{s()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===g?m([]):!1===g||"partial"===g?m(h):(0,r.t1)(g)},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,j.jsx)(R.Z,{checked:g,size:14,onClick:e.onClick}),title:(0,j.jsx)(y.FormattedMessage,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,j.jsx)(b.Z,{...e})},{key:"items",items:S,render:e=>(0,j.jsx)(b.Z,{...e,topBorder:!0})}],headerTitle:(0,j.jsx)(y.FormattedMessage,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}function z(e){window.__c={n:"AutomationEventTriggerPropertyChangedFilterMenu"};const{propertyId:t,automationTriggerMenuStore:o,onClose:n}=e,{automationStore:r,collectionStore:a}=(0,k.P)(),l=(0,i.VK)((()=>a.getSchema()),[a])[t],s=(0,i.VK)((()=>r.getTrigger()),[r]);let c=[];"event"!==(null==s?void 0:s.type)&&"notification_event"!==(null==s?void 0:s.type)||(c="some"===s.event.pagePropertiesEdited.type?s.event.pagePropertiesEdited.some:[]);const u=c.find((e=>e.property===t))??{property:t,filter:{operator:"changes_to_any"}};if(!l)return null;return(0,d.bD)(l)?"multi_select"===l.type||"select"===l.type?(0,j.jsx)(D,{propertyId:t,automationTriggerMenuStore:o,propertySchema:l,propertyChangedFilter:u.filter,onClose:n}):"status"===l.type?(0,j.jsx)(L,{propertyId:t,automationTriggerMenuStore:o,propertySchema:l,propertyChangedFilter:u.filter,onClose:n}):"checkbox"===l.type?(0,j.jsx)(V,{automationTriggerMenuStore:o,onClose:n,propertyChangedFilter:u.filter,propertyId:t,propertySchema:l}):null:null}function H(e){window.__c={n:"AutomationTriggerMenuController"};const{initialState:t,buttonPopupParent:o}=e,l=(0,i.VK)((()=>{const e=new a.Bh;return e.setState({insertionPoint:void 0,stack:[t]}),e}),[t]),s=(0,i.VK)((()=>l.getCurrentTab()),[l]),c=(0,n.useCallback)((()=>o.close()),[o]);return s?"eventTriggers"===s.type?(0,j.jsx)(A,{automationTriggerMenuStore:l,onClose:c}):"propertyChangedFilter"===s.type?(0,j.jsx)(z,{propertyId:s.property,automationTriggerMenuStore:l,onClose:c}):(0,r.t1)(s):null}},61036:(e,t,o)=>{o.d(t,{Dl:()=>B,ew:()=>Z,Zr:()=>K});var n=o(67294),i=o(86628),r=o(12455),a=o(47453),l=o(9291),s=o(56812),c=o(53570),d=o(66315),u=o(85893);function p(){window.__c={n:"AnyPropertyEditedTrigger"};const e=(0,l.useIntl)(),{removeAnyPropertyEditedTrigger:t}=(0,c.i)();return(0,u.jsx)(d.R,{icon:a.R,onDelete:t,children:s.c5(e)})}var m=o(3865),g=o(76205),y=o(31945),h=o(35294),f=o(55307);function S(e){window.__c={n:"EditAutomationTriggerPopup"};const{renderOrigin:t,property:o}=e,n=(0,h.d)();return(0,u.jsx)(y.ZP,{popupType:n,renderOrigin:t,render:e=>(0,u.jsx)(f.Z,{initialState:{type:"propertyChangedFilter",property:o},buttonPopupParent:e})})}var v=o(20239),x=o(24405),b=o(82990),C=o(51230),k=o(61410);function w(e){let{propertySchema:t,onClick:o}=e;return(0,u.jsx)(k.n,{onClick:o,icon:e=>(0,u.jsx)(C.Y,{propertySchema:t,style:e}),tooltip:(0,u.jsx)(j,{propertyName:t.name}),children:(0,u.jsx)(M,{propertyName:t.name})})}function M(e){let{propertyName:t}=e;window.__c={n:"PropertyEditedTriggerTitle"};const o=(0,l.useIntl)(),n=(0,x.yK)((()=>({propertyName:{...b.Z.textOverflowStyle,fontWeight:b.Z.fontWeight.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),i=s.$G(o,{propertyName:(0,u.jsx)("span",{style:n.propertyName,children:t})});return(0,u.jsx)("span",{style:n.wrap,children:i})}function j(e){let{propertyName:t}=e;window.__c={n:"PropertyEditedTriggerTooltip"};const o=(0,l.useIntl)();return(0,u.jsx)(u.Fragment,{children:s.$G(o,{propertyName:t})})}function _(e){let{property:t}=e;window.__c={n:"PropertyWasDeletedTrigger"};const{collectionStore:o}=(0,r.P)(),n=(0,i.VK)((()=>{var e;return null===(e=o.getDeletedSchema())||void 0===e?void 0:e[t]}),[o,t]),a=(0,u.jsx)(l.FormattedMessage,{id:"deletedPropertyStep.deletedProperty.title",defaultMessage:"{propertyName} property deleted",values:{propertyName:null==n?void 0:n.name}});return(0,u.jsx)(k.n,{tooltip:a,children:a})}var A=o(76954),T=o(87181),P=o(52821);function V(e){let{propertySchema:t}=e;const o=P.SO[t.type],n=(0,u.jsx)(l.FormattedMessage,{id:"UnsupportedPropertyTriggerAction.unsupportedProperty.title",defaultMessage:"{propertyType} property not supported",values:{propertyType:o}});return(0,u.jsx)(k.n,{tooltip:n,children:n})}function I(e){window.__c={n:"PropertyEditedTriggerRouter"};const{collectionStore:t}=(0,r.P)(),{property:o,filter:n}=e,a=(0,i.VK)((()=>{var e;return null===(e=t.getSchema())||void 0===e?void 0:e[o]}),[t,o]);return a?m.Ym[a.type]?(0,m.bD)(a)?(0,u.jsx)(F,{property:o,propertySchema:a,filter:n}):(0,u.jsx)(w,{propertySchema:a}):(0,u.jsx)(V,{propertySchema:a}):(0,u.jsx)(_,{property:o})}function F(e){window.__c={n:"EditablePropertyTrigger"};const{filter:t,propertySchema:o,property:i}=e,r=(0,n.useMemo)((()=>function(e){let{filter:t,propertySchema:o}=e;return e=>"changes_to_any"!==t.operator&&(0,g.vR)(t)?"checkbox"===o.type&&(0,g.XA)(t)?(0,u.jsx)(v.Ij,{...e,filter:t,propertySchema:o}):"status"===o.type&&(0,g.r2)(t)?(0,u.jsx)(T.V,{...e,filter:t,propertySchema:o}):"select"===o.type&&(0,g.dx)(t)||"multi_select"===o.type&&(0,g.NU)(t)?(0,u.jsx)(A.v,{...e,filter:t,propertySchema:o}):(0,u.jsx)(w,{...e,propertySchema:o}):(0,u.jsx)(w,{...e,propertySchema:o})}({filter:t,propertySchema:o})),[t,o]);return(0,u.jsx)(S,{renderOrigin:r,property:i})}const Z=(0,n.createContext)({pagePropertiesEdited:[],property:""});function B(){window.__c={n:"AllPropertyEditedTriggers"};const{automationContextStore:e,collectionStore:t}=(0,r.i)(),o=(0,i.VK)((()=>null==e?void 0:e.context.automationStore),[e]),n=K(o),a=(0,i.VK)((()=>{var e;if(!o||!o.isTriggerType("event")&&!o.isTriggerType("notification_event"))return;const t=null===(e=o.getEventConfiguration())||void 0===e?void 0:e.pagePropertiesEdited;return"none"===(null==t?void 0:t.type)?void 0:t}),[o]),l=(0,i.VK)((()=>null==t?void 0:t.getSchema()),[t]);return n&&a?"any"===a.type?(0,u.jsx)(p,{}):l?(0,u.jsx)(u.Fragment,{children:a.some.map((e=>{let{property:t,filter:o}=e;return(0,u.jsx)(Z.Provider,{value:{property:t,pagePropertiesEdited:a.some},children:(0,u.jsx)(I,{property:t,filter:o})},t)}))}):null:null}function K(e){return(0,i.VK)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("notification_event")))return!1;const t=e.getEventConfiguration();return Boolean("none"!==(null==t?void 0:t.pagePropertiesEdited.type))}),[e])}},20239:(e,t,o)=>{o.d(t,{Ij:()=>u,l4:()=>g,zR:()=>m});o(67294);var n=o(24405),i=o(82990),r=o(9291),a=o(87011),l=o(20776),s=o(56812),c=o(61410),d=o(85893);function u(e){window.__c={n:"CheckboxPropertyTrigger"};const t=(0,r.useIntl)(),{propertySchema:o,filter:n,onClick:i}=e;return(0,d.jsx)(c.n,{onClick:i,tooltip:g({filter:n,intl:t,propertySchema:o}),children:(0,d.jsx)(p,{propertySchema:o,filter:n})})}function p(e){let{propertySchema:t,filter:o}=e;window.__c={n:"CheckboxPropertyTriggerTitle"};const a=(0,r.useIntl)(),l=(0,n.yK)((()=>({propertyName:{...i.Z.textOverflowStyle,fontWeight:i.Z.fontWeight.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),s=m({filter:o,intl:a,propertySchema:t,styles:l});return(0,d.jsx)("span",{style:l.wrap,children:s})}function m(e){const{filter:t,intl:o,propertySchema:n,styles:i}=e,r=n.name,a=t.value,l={propertyName:(0,d.jsx)("span",{style:i.propertyName,children:r}),propertyValues:(0,d.jsx)(y,{checkboxValue:a.value??!1})};return(0,s.vz)(o,l)}function g(e){const{filter:t,intl:o,propertySchema:n}=e,i={propertyName:n.name,propertyValues:!0===t.value.value?(0,d.jsx)(r.FormattedMessage,{...s.Bo.actionCheckboxPropertyChecked}):(0,d.jsx)(r.FormattedMessage,{...s.Bo.actionCheckboxPropertyUnchecked})};return(0,s.vz)(o,i)}function y(e){const{checkboxValue:t}=e,o=!0===t?(0,a.c$e)({width:12}):(0,a.UmH)({width:10}),n=!0===t?(0,d.jsx)(r.FormattedMessage,{...s.Bo.actionCheckboxPropertyChecked}):(0,d.jsx)(r.FormattedMessage,{...s.Bo.actionCheckboxPropertyUnchecked});return(0,d.jsx)(l.o,{icon:o,children:n})}},61410:(e,t,o)=>{o.d(t,{n:()=>u});var n=o(67294),i=o(86628),r=o(12455),a=o(53570),l=o(66315),s=o(51230),c=o(61036),d=o(85893);function u(e){window.__c={n:"PropertyEditedTrigger"};const{property:t}=(0,n.useContext)(c.ew),{collectionStore:o}=(0,r.P)(),{removePropertyTrigger:u}=(0,a.i)(),p=(0,n.useCallback)((()=>{u(t)}),[t,u]),m=(0,i.VK)((()=>o.getSchema()),[o])[t],g=m?e=>(0,d.jsx)(s.Y,{propertySchema:m,style:e}):void 0;return(0,d.jsx)(l.R,{icon:g,onDelete:p,...e,children:e.children})}},76954:(e,t,o)=>{o.d(t,{v:()=>h,z:()=>S});o(67294);var n=o(24405),i=o(80951),r=o(84619),a=o(97880),l=o(82990),s=o(9291),c=o(22084),d=o(85567),u=o(65380),p=o(56812),m=o(37867),g=o(61410),y=o(85893);function h(e){window.__c={n:"SelectPropertyTrigger"};const t=(0,s.useIntl)(),{filter:o,propertySchema:n,onClick:i}=e,r={...l.Z.textOverflowStyle,fontWeight:l.Z.fontWeight.medium},c=o.value,d=n.name,m=S({intl:t,isText:!0,limit:5,optionValues:(Array.isArray(c)?c:[c]).map((e=>e.value)).filter(a.$K),propertySchema:n}),h=t.formatList(m,{style:"long",type:"disjunction"}),v=(0,p.XJ)(t,{propertyName:(0,y.jsx)("span",{style:r,children:d}),propertyValues:(0,u.H)(h)});return(0,y.jsx)(g.n,{tooltip:v,onClick:i,children:(0,y.jsx)(f,{filter:o,propertySchema:n})})}function f(e){window.__c={n:"SelectPropertyTriggerTitle"};const{filter:t,propertySchema:o}=e,i=(0,s.useIntl)(),r=t.value,c=o.name,d=S({intl:i,limit:5,optionValues:(Array.isArray(r)?r:[r]).map((e=>e.value)).filter(a.$K),propertySchema:o}),m=i.formatList(d,{style:"long",type:"disjunction"}),g=(0,n.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...l.Z.textOverflowStyle,fontWeight:l.Z.fontWeight.semibold}})),[]),h=(0,p.XJ)(i,{propertyName:(0,y.jsx)("span",{style:g.propertyName,children:c}),propertyValues:(0,u.H)(m)});return(0,y.jsx)("div",{style:g.content,children:h})}function S(e){let{intl:t,isText:o,limit:n,optionValues:a,propertySchema:l,tokenFormat:s=r.lo.Medium}=e;const u=l.options??[],g=a.map((e=>{const n=(0,i.i7)(u,e);return n?o?n.value:(0,y.jsx)(c.a,{value:n.value,color:n.color,format:s,isSingle:!0,showRemoveButton:!1},n.id):o?(0,p.ST)(t):(0,y.jsx)(m.Z,{tokenFormat:s},`missing_option_value_${e}`)}));let h;if(void 0!==n&&g.length>n){const e=g.length-n,t=o?`+${e}`:(0,y.jsx)(d.Z,{format:r.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");h=[...g.slice(0,n),t]}else h=g;return h}},87181:(e,t,o)=>{o.d(t,{L:()=>b,V:()=>S});o(67294);var n=o(24405),i=o(76205),r=o(80951),a=o(84619),l=o(97880),s=o(82990),c=o(9291),d=o(22084),u=o(85567),p=o(65380),m=o(56812),g=o(37867),y=o(61410),h=o(85893);const f=5;function S(e){window.__c={n:"StatusPropertyTrigger"};const t=(0,c.useIntl)(),{filter:o,limit:n=f,propertySchema:r,onClick:a}=e,s=r.name,d=(0,i.wB)(o),u=d.map((e=>"is_group"===e.type?e.value:void 0)).filter(l.$K),p=d.map((e=>"is_option"===e.type?e.value:void 0)).filter(l.$K),m=b({intl:t,groupValues:u,limit:n,optionValues:p,propertySchema:r}),g=b({intl:t,isText:!0,groupValues:u,limit:n,optionValues:p,propertySchema:r});return(0,h.jsx)(y.n,{onClick:a,tooltip:(0,h.jsx)(x,{propertyName:s,statusValues:g}),children:(0,h.jsx)(v,{propertyName:s,statusValues:m})})}function v(e){let{propertyName:t,statusValues:o}=e;window.__c={n:"StatusPropertyTriggerTitle"};const i=(0,c.useIntl)(),r=(0,n.yK)((()=>({propertyName:{...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.semibold}})),[]),a=i.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)(h.Fragment,{children:(0,m.VO)(i,{propertyName:(0,h.jsx)("span",{style:r.propertyName,children:t}),propertyValues:(0,p.H)(a)})})}function x(e){let{propertyName:t,statusValues:o}=e;window.__c={n:"StatusPropertyTriggerTooltip"};const i=(0,c.useIntl)(),r=(0,n.yK)((()=>({propertyName:{...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.semibold}})),[]),a=i.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)(h.Fragment,{children:(0,m.VO)(i,{propertyName:(0,h.jsx)("span",{style:r.propertyName,children:t}),propertyValues:(0,p.H)(a)})})}function b(e){let{groupValues:t,intl:o,isText:n,limit:i,optionValues:s,propertySchema:c,tokenFormat:p=a.lo.Medium}=e;const y=c.groups||[],f=c.options||[],S=t.map((e=>{const t=y.find((t=>t.name===e));if(t)return n?t.name:(0,h.jsx)("span",{children:t.name},t.id)})).filter(l.$K),v=s.map((e=>{const t=(0,r.i7)(f,e);if(void 0===t)return n?(0,m.ST)(o):(0,h.jsx)(g.Z,{tokenFormat:p},`missing_option_value_${e}`);if(n)return t.value;const i=y.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,h.jsx)(d.F,{format:p,isSingle:!0,value:t.value,color:t.color,groupColor:null==i?void 0:i.color,showRemoveButton:!1,showEllipsis:!0},t.id)})),x=[...S,...v];let b=[];if(void 0!==i&&x.length>i){const e=v.length-i,t=n?`+${e}`:(0,h.jsx)(u.Z,{format:a.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");b=[...v.slice(0,i),t]}else b=x;return b}},51230:(e,t,o)=>{o.d(t,{Y:()=>a});o(67294);var n=o(24405),i=o(39068),r=o(85893);function a(e){let{style:t,propertySchema:o}=e;window.__c={n:"TriggerPropertyIcon"};const a=(0,n.Fg)();return(0,r.jsx)(i.ZP,{size:16,theme:a,icon:o.icon,style:t,type:o.type})}},64737:(e,t,o)=>{o.d(t,{q:()=>r,w:()=>i});var n=o(97880);function i(e){return!e.pathIsDead()&&e.isDefined()}function r(e){if(!(0,n.$K)(e))return[];return e.getTemplatePageStores().filter((e=>i(e)))}},65380:(e,t,o)=>{o.d(t,{H:()=>i});o(57658),o(67294);var n=o(85893);function i(e){if(!Array.isArray(e))return[e];const t=[];for(const o of e)if("string"==typeof o&&" "!==o[0]){const e=t.pop();t.push((0,n.jsxs)("div",{children:[e,o]}))}else t.push(o);return t}},56812:(e,t,o)=>{o.d(t,{$G:()=>w,Bo:()=>i,Ig:()=>f,Iu:()=>u,Mw:()=>g,Mz:()=>b,NZ:()=>S,Oq:()=>d,S0:()=>p,ST:()=>A,Sj:()=>h,VO:()=>_,XJ:()=>j,aD:()=>x,c5:()=>C,hW:()=>r,ht:()=>s,nf:()=>k,oJ:()=>T,om:()=>m,rf:()=>y,vE:()=>v,vz:()=>M,wE:()=>c,xf:()=>a,zU:()=>l});var n=o(80951);const i=(0,o(9291).defineMessages)({actionCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.action.checkboxProperty.checked"},actionCheckboxPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.checkboxProperty.single"},actionCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.action.checkboxProperty.unchecked"},actionDatePropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.dateProperty.clear"},actionDatePropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.dateProperty.single"},actionPersonPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.personProperty.clear"},actionPersonPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.personProperty.single"},actionPersonPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.personProperty.multiple"},actionRelationPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.relationProperty.clear"},actionRelationPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.relationProperty.multiple"},actionRelationPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.relationProperty.single"},actionSelectPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.selectProperty.clear"},actionSelectPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.selectProperty.multiple"},actionSelectPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.selectProperty.single"},actionStatusPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.statusProperty.single"},actionTextPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.textProperty.clear"},actionTextPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.textProperty.single"},actionDeletedProperty:{defaultMessage:"Edit a deleted property",id:"automations.action.deletedProperty"},triggerAnyPageAdded:{defaultMessage:"Page added",id:"automations.trigger.pageAdded.title"},triggerAnyPagePropertyEdit:{defaultMessage:"Any property edited",id:"automations.trigger.anyPagePropertyEdited.title"},triggerAnyPropertyEdit:{defaultMessage:"{propertyName} is edited",id:"automations.trigger.propertyChangesToAny.title"},triggerButtonClicked:{defaultMessage:"<b>Button</b> is clicked",id:"automations.trigger.button.clicked"},triggerCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.trigger.checkboxProperty.checked"},triggerCheckboxPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.checkboxPropertySet.title"},triggerCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.trigger.checkboxProperty.unchecked"},triggerSelectPropertySet:{id:"automations.trigger.selectPropertySet.title",defaultMessage:"{propertyName} set to {propertyValues}"},triggerStatusPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.statusPropertySet.singleProperty"},triggerDeletedPropertyEdit:{defaultMessage:"Deleted property is edited",id:"automations.trigger.deletedPropertyEdited"},deletedPropertyOption:{defaultMessage:"Deleted option",id:"automations.values.deletedPropertyOption"}});function r(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionCheckboxPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function a(e){const{propertyName:t}=e;return{...i.actionDatePropertyClear,values:{propertyName:t}}}function l(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionDatePropertySetSingle,values:{propertyName:t,propertyValue:o}}}function s(e){const{propertyName:t}=e;return{...i.actionPersonPropertyClear,values:{propertyName:t}}}function c(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionPersonPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function d(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionPersonPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function u(e){const{propertyName:t}=e;return{...i.actionRelationPropertyClear,values:{propertyName:t}}}function p(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionRelationPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function m(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionRelationPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function g(e){const{propertyName:t}=e;return{...i.actionSelectPropertyClear,values:{propertyName:t}}}function y(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionSelectPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function h(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionSelectPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function f(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionStatusPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function S(e){const{propertyName:t}=e;return{...i.actionTextPropertyClear,values:{propertyName:t}}}function v(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionTextPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function x(e){return e.formatMessage(i.actionDeletedProperty)}function b(e){return e.formatMessage(i.triggerAnyPageAdded)}function C(e){return e.formatMessage(i.triggerAnyPagePropertyEdit)}function k(e){return e.formatMessage(i.triggerDeletedPropertyEdit)}function w(e,t){const{propertyName:o}=t;return e.formatMessage(i.triggerAnyPropertyEdit,{propertyName:o})}function M(e,t){return e.formatMessage(i.triggerCheckboxPropertySet,t)}function j(e,t){return e.formatMessage(i.triggerSelectPropertySet,t)}function _(e,t){return e.formatMessage(i.triggerStatusPropertySet,t)}function A(e){return e.formatMessage(i.deletedPropertyOption)}function T(e){const{limit:t,optionValues:o,propertySchema:i}=e,r=i.options??[],a=r.length>0,l=o.map((e=>{const t=a?(0,n.i7)(r,e):void 0;return t?{type:"option",value:t}:{type:"deleted",value:e}}));let s=l;if(void 0!==t&&l.length>t){const e=l.length-t;s=[...l.slice(0,t),{type:"truncation",value:`+${e}`}]}return s}},91494:(e,t,o)=>{o.d(t,{X:()=>a});var n=o(86628),i=o(33929),r=o(68910);function a(e){const{automationStore:t,collectionStore:o}=e;return(0,n.VK)((()=>{if(!o||!t)return;const e=o.getSpaceShardedPointer();return new r.L({automationStore:t,parentPointer:e,type:"event",persisted:!0,intl:i.default.getIntl(),parentRecordStore:o})}),[o,t])}},73266:(e,t,o)=>{o.d(t,{Z:()=>a,a:()=>r});var n=o(67294),i=o(9015);function r(e){return(0,n.useMemo)((()=>Boolean(e&&e.width<400)),[e])}function a(){const e=(0,n.useContext)(i.Z),{editorWidth:t}=e;return t<500}},53570:(e,t,o)=>{o.d(t,{i:()=>a});o(57658);var n=o(67294),i=o(82530),r=o(12455);function a(){const{automationStore:e,maybePersistedTransactionActions:t}=(0,r.P)(),o=(0,n.useCallback)((()=>{var t;const o=null===(t=e.getTrigger())||void 0===t?void 0:t.event.pagePropertiesEdited,n="some"===(null==o?void 0:o.type)&&o.some;return n||[]}),[e]),a=(0,n.useCallback)((o=>{t.createAndCommit({userAction:"automations.removePropertyTrigger",perform:t=>{i.applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:0===o.length?{type:"none"}:{type:"some",some:o}}},transaction:t})}})}),[e,t]);return{addPropertyTrigger:(0,n.useCallback)((e=>{a([...o(),e])}),[o,a]),updatePropertyTrigger:(0,n.useCallback)((e=>{const{anyOptionCheckState:t,propertyId:n,currentFilter:i}=e,r=o();a((()=>{switch(t){case"partial":return l(r,(e=>e.property===n),(e=>({...e,filter:i})),{property:n,filter:i});case!0:return l(r,(e=>e.property===n),(e=>({...e,filter:{operator:"changes_to_any"}})),{property:n,filter:{operator:"changes_to_any"}});case!1:return r.filter((e=>e.property!==n))}})())}),[o,a]),removePropertyTrigger:(0,n.useCallback)((e=>{a(o().filter((t=>t.property!==e)))}),[o,a]),addPageAddedTrigger:(0,n.useCallback)((()=>{t.createAndCommit({userAction:"automations.addPageAddedTrigger",perform:t=>{i.applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!0}},transaction:t})}})}),[e,t]),removePageAddedTrigger:(0,n.useCallback)((()=>{t.createAndCommit({userAction:"automations.removePageAddedTrigger",perform:t=>{i.applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!1}},transaction:t})}})}),[e,t]),addAnyPropertyEditedTrigger:(0,n.useCallback)((()=>{t.createAndCommit({userAction:"automations.addAnyPagePropertyEditedTrigger",perform:t=>{i.applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:{type:"any"}}},transaction:t})}})}),[e,t]),removeAnyPropertyEditedTrigger:(0,n.useCallback)((()=>{t.createAndCommit({userAction:"automations.removeAnyPropertyEditedTrigger",perform:t=>{i.applyOperation({store:e,operation:{path:["trigger","event"],args:{pagePropertiesEdited:{type:"none"}},pointer:e.pointer,command:"update"},transaction:t})}})}),[e,t])}}function l(e,t,o,n){let i=!1;const r=e.map((e=>t(e)?(i=!0,o(e)):e));return i||r.push(n),r}},21269:(e,t,o)=>{o.d(t,{Z:()=>c});o(67294);var n=o(480),i=o(84169),r=o(25888),a=o(42917),l=o(16354),s=o(85893);const c=function(e){window.__c={n:"CollectionSettingsLearnMoreButton"};const{title:t,href:o,analyticsFrom:c}=e,d=(0,n.O7)();return(0,s.jsx)(l.Z,{href:o,onClick:()=>r.Fs(d,{from:c}),external:!0,children:(0,s.jsx)(a.Z,{icon:i.m,title:t,isGray:!0})})}},61053:(e,t,o)=>{o.d(t,{Z:()=>M});o(57658);var n=o(43261),i=o.n(n),r=o(67294),a=o(83355),l=o(49085),s=o(6695),c=o(56666),d=o(37612),u=o(72126),p=o(9291),m=o(52821),g=o(33929),y=o(29798),h=o(73657),f=o(52275),S=o(68894),v=o(32163),x=o(72495),b=o(69872),C=o(85893);const k=(0,p.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"},none:{defaultMessage:"None",id:"database.viewSettings.propertySelect.noneMessage"},remove:{defaultMessage:"Remove",id:"database.viewSettings.propertySelect.removeMessage"}});class w extends a.Z{constructor(){super(...arguments),this.storeTypes={inputStore:l.default.createClass(""),menuListStore:y.Z,showAllProperties:l.default.createClass(!1)}}renderComponent(){const{currentProperty:e,showNoneOption:t,showRemoveOption:o,getProperties:n,onAccept:a,intl:l,inputPlaceholder:y,defaultShowPropertyCount:w,schema:M,format:j}=this.props,{device:_}=this.environment,{inputStore:A,menuListStore:T}=this.stores,P=A.state,V=(0,s.iB)(j,M,void 0,s.j5.Page).collection_page_properties||[],I=!w||this.stores.showAllProperties.state,F=l.formatMessage(k.none),Z=t?{key:"none",render:t=>(0,C.jsx)(f.Z,{...t,checkState:!e,title:F}),action:()=>{a(void 0)}}:void 0,B=o?{key:"remove",render:e=>(0,C.jsx)(f.Z,{...e,icon:(0,d.y)({width:16,fill:this.theme.mediumTextColor,marginLeft:4,marginRight:2}),title:l.formatMessage(k.remove)}),action:()=>{a(void 0)}}:void 0,K=n();let R=u.MR(K,(e=>V.findIndex((t=>t.property===e))));if(P){const e=new Map;let t=R.map((t=>{const o=M[t],n=o?`${o.name} ${m.SO[o.type]}`:"";return e.set(t,n),n}));t=i().filter(P,t).map((e=>{let{original:t}=e;return t})),R=R.filter((o=>t.includes(e.get(o)||"")))}else!I&&w&&(R=R.slice(0,w));const O=u.oA([!P||i().test(P,F)?Z:void 0,...R.map((e=>function(e,t,o,n,i){const r=t[e];if(!r)return;return{key:e,render:t=>{const o=e===n;return i?i(t,e,o,r):(0,C.jsx)(b.Z,{...t,propertySchema:r,format:b.L.Name,checkState:o})},action:()=>{o(e)}}}(e,this.props.schema,this.props.onAccept,this.props.currentProperty,this.props.renderProperty)))]);if(!I&&K.length>R.length&&!P){const e={key:"show_more",render:e=>(0,C.jsx)(f.Z,{...e,icon:(0,c.o)({width:16,fill:this.theme.mediumTextColor,marginLeft:4,marginRight:2}),style:{color:this.theme.mediumTextColor},title:(0,C.jsx)(p.FormattedMessage,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:K.length-R.length}})}),action:()=>{this.stores.showAllProperties.setState(!0)}};O.push(e)}const W=O.length>0,D=Boolean(P),E=!B||W||D;E&&!W&&O.push({action:u.ZT,key:"noResults",render:e=>(0,C.jsx)(h.Z,{...e,caption:(0,C.jsx)(p.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});const N=[];return E&&N.push({key:"input",comp:(0,C.jsx)(x.Z,{children:(0,C.jsx)(S.ZP,{focusInitial:!_.isMobile||void 0,focus:!_.isMobile||void 0,value:P,onChange:e=>{A.setState(e.target.value),T.setState({...T.state,focus:{section:0,indexLocal:0,indexGlobal:0}}),this.stores.showAllProperties.setState(!1)},placeholder:y||g.default.formatMessage(k.inputPlaceholder)})})}),(O.length>0||B)&&N.push({key:"properties",comp:(0,C.jsx)(v.Z,{type:v.i.Vertical,initialFocus:0,sections:[...O.length>0?[{key:"results",render:e=>(0,C.jsx)(x.Z,{...e}),items:O}]:[],...B?[{key:"remove",render:e=>(0,C.jsx)(x.Z,{topBorder:O.length>0,...e}),items:[B]}]:[]],store:T})}),(0,C.jsx)(C.Fragment,{children:N.map((e=>{let{key:t,comp:o}=e;return(0,C.jsx)(r.Fragment,{children:o},t)}))})}}w.displayName="CollectionSettingsPropertySelectMenu";const M=(0,p.injectIntl)(w)},71846:(e,t,o)=>{o.d(t,{S:()=>j,Z:()=>T});o(57658),o(67294);var n=o(83355),i=o(49085),r=o(56666),a=o(44495),l=o(6287),s=o(9291),c=o(8406),d=o(23586),u=o(33929),p=o(77907),m=o(75822),g=o(80444),y=o(29798),h=o(26136),f=o(73657),S=o(52275),v=o(68894),x=o(32163),b=o(11470),C=o(72495),k=o(26388),w=o(78948),M=o(85893);let j=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e[e.Automation=2]="Automation",e}({});const _=(0,s.defineMessages)({linkedInputPlaceholder:{defaultMessage:"Link to a database…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a database…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"},automationInputPlaceholder:{id:"automations.databasePicker.automationInputPlaceholder",defaultMessage:"Select a database…"}});class A extends n.Z{constructor(){super(...arguments),this.storeTypes={inputStore:i.default.createClass(""),limitStore:i.default.createClass(5),menuListStore:y.Z}}renderComponent(){const{collectionContextStore:e,selectedCollectionStore:t,context:o,parentStore:n}=this.props,{device:i}=this.environment,{limitStore:a,inputStore:c,menuListStore:y}=this.stores,k=c.state,A="linked"===(null==e?void 0:e.getCollectionViewBlockSourceState())||o===j.Relation?_.linkedInputPlaceholder:o===j.Source?_.linkedOrSourceInputPlaceholder:_.automationInputPlaceholder;return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(C.Z,{children:(0,M.jsx)(v.ZP,{focusInitial:!i.isMobile||void 0,value:k,onChange:e=>{c.setState(e.target.value),a.setState(e.target.value?20:5),y.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:u.default.formatMessage(A),showClearButton:!0})}),(0,M.jsx)(d.Z,{request:{query:k,limit:a.state},performRequest:e=>async function(e,t,o,n,i){const{query:r,limit:a}=e,{currentSpaceStore:l}=g.default.state,s=null==n?void 0:n.collectionViewBlockStore(),c=await p.deps.searchActions.loader(),d=await c.searchCollectionsWithRecents({environment:o,collectionViewBlockStore:s,parentStore:t,spaceStore:l,query:r,limit:a,requireEditPermissions:i});return{results:d.results,showMore:Math.max(0,d.total-d.results.length)}}(e,this.props.parentStore,this.environment,this.props.collectionContextStore,this.props.requireEditPermissions),debounce:m.vp,render:(i,c,d)=>{if(!c)return(0,M.jsx)(C.Z,{children:(0,M.jsx)(w.Z,{})});const{results:u,showMore:p}=c,m=u.map((i=>{const r=h.NW.createChildStore(n,{table:l.v,id:i});return{key:i,render:n=>{var a;return(0,M.jsx)(b.Z,{...n,checkState:t&&t.id===i,store:r,right:o===j.Relation&&(null==e||null===(a=e.collectionStore())||void 0===a?void 0:a.id)===i&&(0,M.jsx)(P,{})})},action:e=>{const{index:t}=e;this.handleAcceptExistingCollection({collectionStore:r,totalResults:u.length,clickedIndex:t})}}}));if(p>0){const e={key:"showMore",render:e=>(0,M.jsx)(S.Z,{...e,buttonStyle:{color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},icon:(0,r.o)({width:16,height:16}),title:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title",values:{showMore:Math.min(p,20)}})}),action:()=>{a.setState(a.state+20)}};m.push(e)}return(0,M.jsxs)(M.Fragment,{children:[u.length>0&&(0,M.jsx)(x.Z,{type:x.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,M.jsx)(C.Z,{...e}),items:m}],store:y}),0===u.length&&(0,M.jsx)(f.Z,{caption:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResultsTitle"})})]})}})]})}handleAcceptExistingCollection(e){const{collectionStore:t,totalResults:o,clickedIndex:n}=e,{collectionContextStore:i,searchSessionId:r,context:a}=this.props,{inputStore:l}=this.stores;i&&c.wd({environment:this.environment,collectionContextStore:i,action:"select_existing_collection"});const{onAccept:s}=this.props;s(t),c.tW({environment:this.environment,eventName:"select_search_item",totalResults:o,clickedIndex:n,sessionId:r,source:a,queryLength:l.state.length})}}A.displayName="CollectionSettingsSearchCollections";const T=(0,s.injectIntl)(A);function P(){return(0,M.jsx)(k.ZP,{renderTooltip:()=>(0,M.jsx)(s.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettigs.searchCollections.thisDatabase.tooltip"}),render:e=>(0,M.jsx)("div",{...e,children:(0,a.D)({width:14,height:14})})})}},23877:(e,t,o)=>{o.d(t,{Z:()=>le,v:()=>ae});o(21703),o(67294);var n=o(83355),i=o(480),r=o(86628),a=o(24405),l=o(49085),s=o(15145),c=o(6906),d=o(99036),u=o(39068),p=o(53877),m=o(6695),g=o(72126),y=o(4615),h=o(82990),f=o(9291),S=o(50906),v=o(8406),x=o(5149),b=o(14900),C=o(96802),k=o(8055),w=o(80402),M=o(82530),j=o(28020),_=o(40863),A=o(33929);const T=(0,f.defineMessages)({none:{defaultMessage:"None",id:"database.viewPropertiesMenu.coverFormat.none"},page_content:{defaultMessage:"Page content",id:"database.viewPropertiesMenu.coverFormat.pageContent"},page_cover:{defaultMessage:"Page cover",id:"database.viewPropertiesMenu.coverFormat.pageCover"}}),P=(0,f.defineMessages)({small:{defaultMessage:"Small",id:"database.viewPropertiesMenu.coverSize.small"},medium:{defaultMessage:"Medium",id:"database.viewPropertiesMenu.coverSize.medium"},large:{defaultMessage:"Large",id:"database.viewPropertiesMenu.coverSize.large"}}),V=function(e){return e?"page_content"===e.type?A.default.formatMessage(T.page_content):"page_cover"===e.type?A.default.formatMessage(T.page_cover):void 0:A.default.formatMessage(T.none)},I=e=>{switch(e){case"small":return A.default.formatMessage(P.small);case"medium":return A.default.formatMessage(P.medium);case"large":return A.default.formatMessage(P.large)}};var F=o(92918),Z=o(52821),B=o(48543),K=o(65742),R=o(78316),O=o(84210),W=o(87279),D=o(18514),E=o(80444),N=o(61766),L=o(36857),z=o(88923),H=o(21269),U=o(42917),$=o(13709),q=o(61053),G=o(75544),Q=o(42922),Y=o(64921),X=o(31945),J=o(74194),ee=o(78140),te=o(53437),oe=o(72495),ne=o(86825),ie=o(85893);class re extends n.Z{constructor(){super(...arguments),this.storeTypes={hoveredType:l.default.createClass(void 0),timelineByButtonPopupStore:N.Z,timelineByEndButtonPopupStore:N.Z,calendarByButtonPopupStore:N.Z},this.renderViewTypeButton=e=>{const{intl:t,collectionContextStore:o}=this.props,n=ce(this.props.collectionContextStore),i=o.permissionScopes.state,r=n===e,a=r||!i.canConfigureBlock;return(0,ie.jsxs)(Y.Z,{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"calc(33% - 12px)",flexGrow:0,flexShrink:0,fontSize:11,borderRadius:4,margin:6,padding:6,boxShadow:`0 0 0 1px ${this.theme.regularDividerColor}`,color:this.theme.mediumTextColor,fill:this.theme.mediumTextColor,...r&&{boxShadow:`0 0 0 2px ${this.theme.blueColor}`,color:this.theme.blueColor,fill:this.theme.blueColor,fontWeight:500}},disabled:a,onClick:()=>{M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderViewTypeButton",environment:this.environment,perform:n=>{b.z2({environment:this.environment,collectionContextStore:o,newViewType:e,transaction:n,intl:t})}}),v.wd({environment:this.environment,collectionContextStore:o,action:"change_type",original_view_type:n})},onMouseMove:()=>{this.stores.hoveredType.setState(e)},children:[Z.aW[e]({width:void 0,height:20,marginBottom:4,marginTop:4}),(0,ie.jsx)("div",{children:Z.Bh[e]})]},e)},this.handleViewTypeAreaMouseLeave=()=>{this.stores.hoveredType.setState(void 0)}}renderComponent(){const{collectionContextStore:e,showDoneButton:t}=this.props,{hoveredType:o}=this.stores,{device:n}=this.environment,i=e.normalizedQueryStore.state,r=e.normalizedSchemaStore.state,a=e.normalizedFormatStore.state,l=e.isFullScreen.state,s=e.isRootChild.state,c=ce(this.props.collectionContextStore),u=Boolean(de(this.props.collectionContextStore)),p="table"===c||"board"===c||"gallery"===c,m="table"===c,g=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,d.Lt)(t)})),y="timeline"===c&&g.length>0,h="timeline"===c&&g.length>1,S="timeline"===c&&Boolean(null==i?void 0:i.timeline_by_end),b="calendar"===c&&g.length>0,k="calendar"===c,w="board"===c,j=(0,K.d$)({environment:this.environment,isFullScreen:l,isRootChild:s}),_="timeline"===c&&Boolean(a.timeline_show_table)&&j,A="timeline"===c&&j,T=e.collectionViewBlockStore();if(!T)return;const P=T.getCollectionViewSourceCollectionStore(),V=!("collectionTypedView"===e.contextType||P&&l),I=e.permissionScopes.state,F="page"===c;return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(oe.Z,{topBorder:!1,shouldShowBottomDivider:n.isMobile,children:(0,ie.jsxs)("div",{style:{...!n.isMobile&&{width:"100%",paddingLeft:8,paddingRight:8},...n.isMobile&&{background:this.theme.contentBackground,width:"100%",paddingTop:12,paddingBottom:12}},onMouseLeave:this.handleViewTypeAreaMouseLeave,children:[(0,ie.jsx)("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"},children:["table","board","timeline","calendar","list","gallery"].map(this.renderViewTypeButton)}),(0,ie.jsx)("div",{style:{color:this.theme.lightTextColor,fontSize:12,margin:"6px 8px 0px 8px"},children:Z.sN[o.state||c]})]})}),(0,ie.jsxs)(oe.Z,{children:[V&&(0,ie.jsx)(ne.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.layoutTab.showDatabaseTitle.title"}),focused:!1,on:e.shouldShowSource.state,onClick:()=>function(e,t){const o=t.collectionViewStore();if(!o)return;const n=!t.shouldShowSource.state;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleShowCollectionTitleClick",environment:e,perform:e=>{C.FH({stores:[o],update:{hide_linked_collection_name:!n},transaction:e})}}),v.wd({environment:e,collectionContextStore:t,action:"toggle_show_collection_title"})}(this.environment,this.props.collectionContextStore),disabled:!I.canConfigureBlock,textWrapperStyle:{opacity:1}}),u&&this.renderCardSettings(),m&&(0,ie.jsx)(be,{collectionContextStore:this.props.collectionContextStore}),p&&(0,ie.jsx)(Ce,{collectionContextStore:this.props.collectionContextStore}),F&&(0,ie.jsx)(ge,{collectionContextStore:this.props.collectionContextStore}),y&&(0,ie.jsx)(ye,{collectionContextStore:this.props.collectionContextStore}),S&&(0,ie.jsx)(he,{collectionContextStore:this.props.collectionContextStore}),h&&(0,ie.jsx)(ke,{collectionContextStore:this.props.collectionContextStore}),b&&(0,ie.jsx)(fe,{collectionContextStore:this.props.collectionContextStore}),k&&(0,ie.jsx)(we,{collectionContextStore:this.props.collectionContextStore}),A&&(0,ie.jsx)(G.N,{collectionContextStore:e}),_&&(0,ie.jsx)(Se,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),w&&(0,ie.jsx)(ve,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ie.jsx)(Me,{collectionContextStore:this.props.collectionContextStore})]}),t&&(0,ie.jsx)(oe.Z,{disableMobileBorders:!0,children:(0,ie.jsx)(Q.Z,{style:{display:"flex",margin:"0 14px"},onClick:()=>function(e,t,o){x.wl({collectionSettingsStore:t,item:{type:"main"}}),v.wd({environment:e,collectionContextStore:o,action:"click_create_view_done"})}(this.environment,this.props.collectionSettingsStore,this.props.collectionContextStore),children:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Done",id:"database.viewSettings.createViewTab.doneButton.title"})})}),(0,ie.jsx)(oe.Z,{topBorder:!1,children:(0,ie.jsx)(H.Z,{href:(0,D.UY)("guides.databaseView"),title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Learn about views",id:"database.viewSettings.layoutTab.learnMoreButton.title"}),analyticsFrom:"view_settings_layout"})})]})}renderCardSettings(){const{device:e}=this.environment,{collectionContextStore:t}=this.props,o=function(e){const t=e.normalizedFormatStore.state,o=de(e);if(o&&t)return t[o]}(this.props.collectionContextStore),n=function(e){const t=e.normalizedFormatStore.state,o=ue(e);if(o&&t){const e=t[o];if(e)return e}return m.PZ}(this.props.collectionContextStore),i=!e.isMobile||"board"===ce(this.props.collectionContextStore),r=t.permissionScopes.state;return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)($.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Card preview",id:"database.viewSettings.layoutTab.cardPreviewButtonTitle"}),selectedKey:o,popupStyle:{minWidth:190},options:this.getCoverFormatOptions(),onChange:e=>function(e,t,o){const n=de(o),i=o.collectionViewStore();if(!n||!i)return;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverFormatChange",environment:t,perform:t=>{C.FH({stores:[i],update:{[n]:e},transaction:t})}}),v.wd({environment:t,collectionContextStore:o,action:"update_cover_format"})}(e,this.environment,this.props.collectionContextStore),disabled:!r.canConfigureBlock}),i&&(0,ie.jsx)($.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Card size",id:"databdatabase.viewSettings.layoutTab.cardSizeButtonTitle"}),selectedKey:n,popupStyle:{minWidth:190},options:se(),onChange:e=>function(e,t,o){const n=ue(o),i=o.collectionViewStore();if(!n||!i)return;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverSizeFormatChange",environment:t,perform:t=>{C.FH({stores:[i],update:{[n]:e},transaction:t})}}),v.wd({environment:t,collectionContextStore:o,action:"toggle_cover_size_format"})}(e,this.environment,this.props.collectionContextStore),disabled:!r.canConfigureBlock}),o&&(0,ie.jsx)(ne.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Fit image",id:"databdatabase.viewSettings.layoutTab.fitImageButtonTitle"}),on:"contain"===me(this.props.collectionContextStore),focused:!1,onClick:()=>function(e,t){const o=pe(t),n=t.collectionViewStore(),i=t.normalizedFormatStore.state;if(!o||!n)return;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverAspectFormatToggle",environment:e,perform:e=>{C.FH({stores:[n],update:{[o]:"contain"===i[o]?"cover":"contain"},transaction:e})}}),v.wd({environment:e,collectionContextStore:t,action:"toggle_cover_aspect_format"})}(this.environment,this.props.collectionContextStore),disabled:!r.canConfigureBlock,textWrapperStyle:{opacity:1}})]})}getCoverFormatOptions(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state;let o=Object.keys(t);o=g.MR(o,(e=>{const o=t[e];return o?o.name:""}));const{theme:n}=this,i=g.oA(o.map((e=>{const o=t[e];if(o&&"file"===o.type){return{key:{type:"property",property:e},title:o.name,icon:(0,ie.jsx)(u.ZP,{type:o.type,icon:o.icon,size:this.environment.device.isMobile?16:14,theme:n,style:{fill:n.regularIconColor}})}}})));return[...[void 0,{type:"page_cover"},{type:"page_content"}].map((e=>({key:e,title:V(e)}))),...i]}}function ae(e){const{currentViewType:t,theme:o}=e,n=t?B.Ls[t]:void 0;return["side_peek","center_peek","full_page"].map((e=>({key:e,title:(0,B.LQ)(e),body:(0,ie.jsxs)(ie.Fragment,{children:[(0,B.RI)(e),n&&t&&e===n&&(0,ie.jsx)("div",{style:{marginTop:2,fontWeight:500,color:o.blueColor},children:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Default for {view}",id:"database.viewPropertiesMenu.peekMode.defaultForView",values:{view:(0,c.Z)(t)}})})]}),icon:(0,B.RO)(e)({width:16,fill:o.mediumTextColor})})))}re.displayName="CollectionSettingsViewLayoutMenu";const le=(0,f.injectIntl)(re);function se(){return["small","medium","large"].map((e=>({key:e,title:I(e)})))}function ce(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function de(e){return Z.DL[ce(e)]}function ue(e){return Z.oy[ce(e)]}function pe(e){return Z._Y[ce(e)]}function me(e){const t=e.normalizedFormatStore.state,o=pe(e);if(o&&t)return t[o]}function ge(e){let{collectionContextStore:t}=e;window.__c={n:"PageViewSetting"};const o=(0,i.O7)(),n=(0,r.VK)((()=>t.collectionViewStore()),[t]);return n?(0,ie.jsx)("div",{style:{padding:5},children:(0,ie.jsx)(J.Z,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{L.Z.setState({pageId:e.target.value})},onSubmit:e=>{const t=L.Z.state.pageId;t&&M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderPageViewSettings",environment:o,perform:e=>{C.FH({stores:[n],update:{page_pointer:{id:(0,y.Mt)(t),spaceId:e.spaceId,table:"block"}},transaction:e})}})}})}):null}function ye(e){let{collectionContextStore:t}=e;window.__c={n:"TimelineBySetting"};const o=(0,i.O7)(),n=(0,i.MO)(),a=(0,r.VK)((()=>{var e;return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by}),[t]),l=(0,r.VK)((()=>{var e;return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by_end}),[t]),s=(0,r.VK)((()=>t.permissionScopes.state),[t]),c=(0,r.VK)((()=>t.normalizedSchemaStore.state),[t]),u=(0,r.VK)((()=>t.collectionViewStore()),[t]),p=(0,r.VK)((()=>t.collectionStore()),[t]),m=(0,r.VK)((()=>null==p?void 0:p.getSchema()),[p]),g=(0,r.VK)((()=>null==p?void 0:p.getFormat()),[p]);if(!(a&&u&&p&&g&&m))return null;const y=c[a];return y?(0,ie.jsx)(X.ZP,{popupType:n?te.kQ.SlideUp:te.kQ.Popup,alignmentToOrigin:X.vR.End,placementToOrigin:X.pO.Bottom,originGap:0,renderOrigin:e=>(0,ie.jsx)(U.Z,{title:l?(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Start date",id:"database.viewSettings.layoutTab.timelineStartDate.title"}):(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Show timeline by",id:"database.viewSettings.layoutTab.showTimelineByProperty.title"}),disabled:!s.canConfigureBlock,showChevron:!0,right:(0,ie.jsx)("div",{style:h.Z.textOverflowStyle,children:y.name}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},...e}),render:e=>{let i;return i=n?{menuType:W.og.ActionSheet}:{menuType:W.og.Popup,width:300},(0,ie.jsx)(ee.Z,{...i,children:(0,ie.jsx)(q.Z,{schema:m,format:g,currentProperty:a,getProperties:()=>Object.keys(c).filter((e=>{const t=c[e];return t&&(0,d.Lt)(t)})),onAccept:n=>{n&&(M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderTimelineBySetting",environment:o,perform:e=>{b.Es({collectionViewStore:u,update:{timeline_by:n},transaction:e})}}),e.close(),v.wd({environment:o,collectionContextStore:t,action:"update_timeline_by",original_view_type:void 0,property_type:y[n].type}))}})})}}):null}function he(e){let{collectionContextStore:t}=e;window.__c={n:"TimelineEndSetting"};const o=(0,i.O7)(),n=(0,i.MO)(),a=(0,r.VK)((()=>{var e;return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by_end}),[t]),l=(0,r.VK)((()=>t.permissionScopes.state),[t]),s=(0,r.VK)((()=>t.normalizedSchemaStore.state),[t]),c=(0,r.VK)((()=>t.collectionViewStore()),[t]),u=(0,r.VK)((()=>t.collectionStore()),[t]),p=(0,r.VK)((()=>null==u?void 0:u.getSchema()),[u]),m=(0,r.VK)((()=>null==u?void 0:u.getFormat()),[u]);if(!(a&&c&&u&&m&&p))return null;const g=s[a];return g?(0,ie.jsx)(X.ZP,{popupType:n?te.kQ.SlideUp:te.kQ.Popup,alignmentToOrigin:X.vR.End,placementToOrigin:X.pO.Bottom,originGap:0,renderOrigin:e=>(0,ie.jsx)(U.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"End date",id:"database.viewSettings.layoutTab.timelineEndDate.title"}),showChevron:!0,right:g.name,disabled:!l.canConfigureBlock,...e}),render:e=>{let i;return i=n?{menuType:W.og.ActionSheet}:{menuType:W.og.Popup,width:300},(0,ie.jsx)(ee.Z,{...i,children:(0,ie.jsx)(q.Z,{schema:p,format:m,currentProperty:a,getProperties:()=>Object.keys(s).filter((e=>{const t=s[e];return t&&(0,d.Lt)(t)})),onAccept:n=>{n&&(M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderTimelineEndSetting",environment:o,perform:e=>{b.Es({collectionViewStore:c,update:{timeline_by_end:n},transaction:e})}}),e.close(),v.wd({environment:o,collectionContextStore:t,action:"update_timeline_by_end",original_view_type:void 0,property_type:g[n].type}))}})})}}):null}function fe(e){let{collectionContextStore:t}=e;window.__c={n:"CalendarBySetting"};const o=(0,i.O7)(),n=(0,i.MO)(),a=(0,r.VK)((()=>{var e;return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.calendar_by}),[t]),l=(0,r.VK)((()=>t.permissionScopes.state),[t]),s=(0,r.VK)((()=>t.normalizedSchemaStore.state),[t]),c=(0,r.VK)((()=>t.collectionViewStore()),[t]),u=(0,r.VK)((()=>t.collectionStore()),[t]),p=(0,r.VK)((()=>null==u?void 0:u.getSchema()),[u]),m=(0,r.VK)((()=>null==u?void 0:u.getFormat()),[u]);if(!(a&&c&&u&&m&&p))return null;const g=s[a];return g?(0,ie.jsx)(X.ZP,{popupType:n?te.kQ.SlideUp:te.kQ.Popup,alignmentToOrigin:X.vR.End,placementToOrigin:X.pO.Bottom,originGap:0,renderOrigin:e=>(0,ie.jsx)(U.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Show calendar by",id:"database.viewSettings.layoutTab.showCalendarByProperty.title"}),disabled:!l.canConfigureBlock,showChevron:!0,right:(0,ie.jsx)("div",{style:h.Z.textOverflowStyle,children:g.name}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},...e}),render:e=>{let i;return i=n?{menuType:W.og.ActionSheet}:{menuType:W.og.Popup,width:300},(0,ie.jsx)(ee.Z,{...i,children:(0,ie.jsx)(q.Z,{schema:p,format:m,currentProperty:a,getProperties:()=>Object.keys(s).filter((e=>{const t=s[e];return t&&(0,d.Lt)(t)})),onAccept:n=>{n&&(M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderCalendarBySetting",environment:o,perform:e=>{b.Es({collectionViewStore:c,update:{calendar_by:n},transaction:e})}}),e.close(),v.wd({environment:o,collectionContextStore:t,action:"update_calendar_by",original_view_type:void 0,property_type:g[n].type}))}})})}}):null}function Se(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"TimelineTableProperties"};const n=(0,i.O7)(),a=((0,r.VK)((()=>t.normalizedFormatStore.state),[t]).timeline_table_properties||[]).filter((e=>Boolean(e.visible))).length,l=(0,r.VK)((()=>t.permissionScopes.state),[t]);return(0,ie.jsx)(U.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Table properties",id:"database.viewSettings.layoutTab.tablePropertiesButton.title"}),showChevron:!0,right:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.layoutTab.propertiesButton.propertiesShown.title",values:{propertiesShown:a}}),onClick:()=>{x.H4({collectionSettingsStore:o,item:{type:"properties",timelineViewTab:"table"}}),v.wd({environment:n,collectionContextStore:t,action:"click_timeline_table_properties"})},disabled:!l.canConfigureBlock})}function ve(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"BoardGroupByShortcuts"};const n=(0,i.O7)(),a=(0,r.VK)((()=>t.normalizedFormatStore.state.board_columns_by),[t]),l=(0,r.VK)((()=>t.normalizedSchemaStore.state),[t]),s=(0,r.VK)((()=>t.permissionScopes.state),[t]),c=(0,r.VK)((()=>(0,F.h6)(n,t)),[t,n]);if(!a)return null;const d=l[a.property];return d?(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(U.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Group by",id:"database.viewSettings.layoutTab.boardGroupByButton.title"}),showChevron:!0,right:d.name,onClick:()=>{x.H4({collectionSettingsStore:o,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}}),v.wd({environment:n,collectionContextStore:t,action:"click_board_group_by",original_view_type:void 0,property_type:d.type})},disabled:!s.canConfigureBlock}),(0,ie.jsx)(ne.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Color columns",id:"database.viewSettings.groupTab.colorColumns"}),on:!c,focused:!1,onClick:()=>{x.iN({environment:n,collectionContextStore:t})},disabled:!s.canConfigureBlock,textWrapperStyle:{opacity:1}})]}):null}function xe(e,t,o){const n=o.collectionViewStore();if(!n)return;const{serverCommitResult:i}=M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleViewRangeOptionClick",environment:t,perform:t=>{C.FH({stores:[n],update:{calendar_view_range:e},transaction:t})}}),r=j.AK.state,a=o.dateRangeStart.state,l=o.dateRangeEnd.state,{newDateRangeStart:s,newDateRangeEnd:c}=function(e){const{newViewRange:t,oldCalendarEnd:o,startOfWeekSetting:n}=e;if("month"===t){const e=(0,p.IS)((0,p.kl)(o),n);return{newDateRangeStart:e,newDateRangeEnd:(0,p.V7)((0,p._)({date:e,monthsToAdd:1}),n)}}{const e=(0,p.IS)(o,n);return{newDateRangeStart:e,newDateRangeEnd:(0,p.V7)(e,n)}}}({oldCalendarEnd:l,newViewRange:e,startOfWeekSetting:r});b.t5({dateRangeStart:s,dateRangeEnd:c,collectionContextStore:o}),i.then((()=>{v.wd({environment:t,collectionContextStore:o,action:"update_calendar_view_range"})})).catch((()=>{b.t5({dateRangeStart:a,dateRangeEnd:l,collectionContextStore:o})}))}function be(e){let{collectionContextStore:t}=e;window.__c={n:"TableVerticalLinesSettingComponent"};const o=(0,i.O7)(),n=(0,r.VK)((()=>t.permissionScopes.state),[t]),a=(0,r.VK)((()=>!Boolean(t.normalizedFormatStore.state.hide_table_vertical_lines)),[t]);return(0,ie.jsx)(ne.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Show vertical lines",id:"database.viewSettings.layoutTab.tableShowVerticalLines"}),on:a,focused:!1,onClick:()=>function(e,t){const o=t.collectionViewStore();if(!o)return;const n=Boolean(t.normalizedFormatStore.state.hide_table_vertical_lines);w.AU({environment:e,collectionViewStore:o,currentValue:n}),v.wd({environment:e,collectionContextStore:t,action:"toggle_table_vertical_lines"})}(o,t),disabled:!n.canConfigureBlock,textWrapperStyle:{opacity:1}})}function Ce(e){let{collectionContextStore:t}=e;window.__c={n:"TableWrapCellsSettingComponent"};const o=(0,i.O7)(),n=(0,r.VK)((()=>t.normalizedFormatStore.state),[t]),a=(0,r.VK)((()=>t.permissionScopes.state),[t]),l=(0,r.VK)((()=>ce(t)),[t]);return(0,ie.jsx)(ne.Z,{title:"table"===l?(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Wrap all columns",id:"database.viewSettings.layoutTab.tableWrapAllColumns"}):(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Wrap all properties",id:"database.viewSettings.layoutTab.tableWrapAllProperties"}),on:Boolean(n.table_wrap),focused:!1,onClick:()=>function(e,t){const o=t.collectionViewStore();if(!o)return;const n=Boolean(t.normalizedFormatStore.state.table_wrap);w.qY({environment:e,collectionViewStore:o,currentValue:n}),S.wds(e,{view_type:ce(t),action:"set_first_load_limit"}),v.wd({environment:e,collectionContextStore:t,action:"toggle_table_wrap_cells"})}(o,t),disabled:!a.canConfigureBlock,textWrapperStyle:{opacity:1}})}function ke(e){let{collectionContextStore:t}=e;window.__c={n:"TimelineSeparateDatesSettingComponent"};const o=(0,i.O7)(),n=(0,r.VK)((()=>t.normalizedQueryStore.state),[t]),a=null==n?void 0:n.timeline_by_end,l=(0,r.VK)((()=>t.permissionScopes.state),[t]);return(0,ie.jsx)(ne.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Separate start and end dates",id:"database.viewSettings.layoutTab.timelineUseSeparateDates.title"}),focused:!1,on:Boolean(a),onClick:()=>function(e,t){const o=t.normalizedQueryStore.state,n=t.collectionViewStore(),i=null==o?void 0:o.timeline_by,r=null==o?void 0:o.timeline_by_end;if(!i||!n)return;const a=r?void 0:i;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleTimelineSeparateDatesClick",environment:e,perform:e=>{b.Es({collectionViewStore:n,update:{timeline_by_end:a??null},transaction:e})}}),v.wd({environment:e,collectionContextStore:t,action:"toggle_timeline_separate_dates"})}(o,t),disabled:!l.canConfigureBlock,textWrapperStyle:{opacity:1}})}function we(e){let{collectionContextStore:t}=e;window.__c={n:"CalendarViewRangeSettingComponent"};const o=(0,i.O7)(),n=(0,r.VK)((()=>t.permissionScopes.state),[t]),a=(0,r.VK)((()=>function(e){const t=e.normalizedFormatStore.state;return(null==t?void 0:t.calendar_view_range)||"month"}(t)),[t]),l=(0,r.VK)((()=>"peekModeFormat"===t.settingsStore.state.openButtonPopup),[t]);return(0,ie.jsx)($.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Show calendar as",id:"database.viewSettings.layoutTab.showCalendarAs.title"}),collectionContextStore:t,openButtonPopup:l,selectedKey:a,popupStyle:{minWidth:190},options:["month","week"].map((e=>({key:e,title:A.default.formatMessage(_.Lh[e])}))),onChange:e=>xe(e,o,t),disabled:!n.canConfigureBlock})}function Me(e){let{collectionContextStore:t}=e;window.__c={n:"PeekModeSettingComponent"};const o=(0,a.Fg)(),n=(0,i.O7)(),l=(0,r.VK)((()=>t.permissionScopes.state),[t]),c=(0,r.VK)((()=>function(e){const t=e.normalizedFormatStore.state,o=ce(e);return(null==t?void 0:t.collection_peek_mode)||B.Ls[o]}(t)),[t]),d=(0,r.VK)((()=>"peekModeFormat"===t.settingsStore.state.openButtonPopup),[t]),u=(0,r.VK)((()=>ce(t)),[t]);return(0,ie.jsx)($.Z,{title:(0,ie.jsx)(f.FormattedMessage,{defaultMessage:"Open pages in",id:"database.viewSettings.layoutTab.peekModeTitle"}),collectionContextStore:t,openButtonPopup:d,selectedKey:c,popupStyle:{minWidth:190},options:ae({currentViewType:u,theme:o}),menuItemOptionsStyle:{paddingTop:8,paddingBottom:8},onClick:()=>function(e,t){v.nS({environment:e,collectionContextStore:t,from:"collection_view_settings"})}(n,t),onChange:e=>function(e,t,o){const n=o.collectionViewStore();if(n&&e&&(M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handlePeekModeFormatClick",environment:t,perform:t=>{C.FH({stores:[n],update:{collection_peek_mode:e},transaction:t})}}),v.gl({environment:t,collectionContextStore:o,peek_mode:e,from:"collection_view_settings"}),z.default.state.open&&z.default.state.collectionContextStore===o)){const{mainEditorCurrentBlockStore:o}=E.default.state,n="full_page"===e?(0,O.ZP)({store:z.default.state.target,fullyQualified:!1,pageVisitSource:s.tY.Expand}):(0,R.mb)({store:z.default.state.target,mainEditorCurrentBlockStore:o,collectionContextStore:z.default.state.collectionContextStore,fullyQualified:!1,overridePeekMode:(0,z.getPeekModeFromCollectionPeekModeFormat)(e)});n&&k.c4({environment:t,url:n})}}(e,n,t),disabled:!l.canConfigureBlock})}},75544:(e,t,o)=>{o.d(t,{N:()=>ne,Z:()=>ie});var n=o(43261),i=o.n(n),r=(o(67294),o(83355)),a=o(480),l=o(86628),s=o(49085),c=o(99036),d=o(80951),u=o(39068),p=o(6695),m=o(5257),g=o(39132),y=o(61061),h=o(47453),f=o(37612),S=o(72126),v=o(97880),x=o(82990),b=o(9291),C=o(8406),k=o(5149),w=o(87085),M=o(14900),j=o(96802),_=o(82530),A=o(52821),T=o(68641),P=o(43224),V=o(65742),I=o(19124),F=o(33929),Z=o(98742),B=o(18514),K=o(4023),R=o(29798),O=o(73657),W=o(21269),D=o(13005),E=o(42917),N=o(54119),L=o(52275),z=o(79131),H=o(5145),U=o(73063),$=o(68894),q=o(32163),G=o(89728),Q=o(72495),Y=o(86825),X=o(26388),J=o(66957),ee=o(85893);const te=(0,b.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertiesTab.inputPlaceholder"},toggleFrozenColumnsAriaLabel:{defaultMessage:"Toggle frozen columns",id:"database.viewSettings.propertiesTab.toggleFrozenColumnsAriaLabel"},togglePropertyVisibilityAriaLabel:{defaultMessage:"Toggle property visibility",id:"database.viewSettings.propertiesTab.togglePropertyVisibilityAriaLabel"}});class oe extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:s.default.createClass(""),menuListStore:R.Z},this.handlePropertyReorder=e=>{const{formatKey:t,newPropertyKeys:o}=e,{collectionContextStore:n}=this.props,i=n.collectionViewStore();if(!i)return;const r=n.normalizedFormatStore.state[t]||[],a=o.indexOf("group-header-hidden-property"),l=[...S.oA(o.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const o=r.find((t=>t.property===e));if(o)return a>=0?{...o,visible:Boolean(t<a)}:o}))),...r.filter((e=>!o.includes(e.property)))];_.createAndCommit({userAction:"CollectionSettingsViewProperties.handlePropertyReorder",environment:this.environment,perform:e=>{j.FH({stores:[i],update:{[t]:l},transaction:e})}}),C.wd({environment:this.environment,collectionContextStore:n,action:"reorder_properties",original_view_type:i.getType()}),this.stores.menuListStore.reset()},this.handleTogglePropertyVisibility=e=>{var t;const{formatKey:o,propertyFormat:n}=e,{collectionContextStore:i}=this.props,r=i.collectionViewStore();if(!r)return;const a=i.normalizedFormatStore.state,l=(a[o]||[]).filter((e=>e.property!==n.property)),s=l.filter((e=>e.visible)),c=l.filter((e=>!e.visible)),d={...n,visible:!n.visible},u=[...s,d,...c],p={...a,[o]:u};_.createAndCommit({userAction:"CollectionSettingsViewProperties.handleTogglePropertyVisibility",environment:this.environment,perform:e=>{M.iG({collectionViewStore:r,update:{format:p},transaction:e})}}),C.wd({environment:this.environment,collectionContextStore:i,action:"toggle_property_visibility",original_view_type:r.getType(),property_type:null===(t=r.getCollectionStore())||void 0===t||null===(t=t.getSchema()[d.property])||void 0===t?void 0:t.type}),this.clearInput()},this.handleTabChange=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;C.wd({environment:this.environment,collectionContextStore:o,action:0===e?"click_properties_tab_timeline":"click_properties_tab_table"}),k.FK({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:0===e?"timeline":"table"}}),this.clearInput()},this.handleShowTableClick=()=>{this.clearInput()}}renderComponent(){const{collectionContextStore:e,timelineViewTab:t}=this.props,{device:o}=this.environment,{inputStore:n,menuListStore:i}=this.stores,r=n.state,a=(0,T.WY)({collectionContextStore:e}),l=(0,T.jI)({timelineViewTab:t,collectionContextStore:e}),s=(0,V.d$)({environment:this.environment,isFullScreen:e.isFullScreen.state,isRootChild:e.isRootChild.state});return(0,ee.jsxs)(D.ZP,{...this.props,title:(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Properties",id:"database.viewSettings.propertiesTab.title"}),header:(0,ee.jsx)(Q.Z,{children:(0,ee.jsx)($.ZP,{focusInitial:!o.isMobile,value:r,showClearButton:!0,onChange:e=>{n.setState(e.target.value),i.setState({...i.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:F.default.formatMessage(te.inputPlaceholder)})}),footer:(0,ee.jsx)(se,{collectionContextStore:this.props.collectionContextStore,timelineViewTab:this.props.timelineViewTab}),children:["timeline"===a&&s&&this.renderTimelineControls(),l&&this.renderPropertyFormatList(l),(0,ee.jsx)(Q.Z,{children:(0,ee.jsx)(ce,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore,timelineViewTab:this.props.timelineViewTab})})]})}renderTimelineControls(){const{timelineViewTab:e,collectionContextStore:t}=this.props,o="timeline"===e?0:1;return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(J.Z,{tabs:[(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Timeline",id:"database.viewSettings.propertiesTab.timelineProperties"},"database.viewSettings.propertiesTab.timelineProperties"),(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Table",id:"database.viewSettings.propertiesTab.tableProperties"},"database.viewSettings.propertiesTab.tableProperties")],selectedIndex:o,onChange:this.handleTabChange}),"table"===e&&(0,ee.jsx)(Q.Z,{children:(0,ee.jsx)(ne,{collectionContextStore:t,onClick:this.handleShowTableClick})})]})}renderPropertyFormatList(e){const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,n=t.normalizedFormatStore.state,r=t.normalizedSchemaStore.state,{inputStore:a}=this.stores,l=a.state;let s=n[e]||[];if(l){let e=s.map((e=>{const t=(0,d.Qm)({schema:r,property:e.property});return null==t?void 0:t.name}));e=i().filter(l,e).map((e=>{let{original:t}=e;return t})),s=s.filter((t=>{const o=r[t.property];return o&&o.name&&e.includes(o.name)}))}const c=s.filter((e=>Boolean(e.visible))),u=s.filter((e=>!Boolean(e.visible))),p="timeline_table_properties"===e?"table":(0,T.WY)({collectionContextStore:t});return(0,ee.jsxs)(ee.Fragment,{children:[0===s.length&&(0,ee.jsx)(Q.Z,{children:(0,ee.jsx)(O.Z,{caption:(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertiesTab.noResults"})})}),s.length>0&&(0,ee.jsx)(q.Z,{type:q.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:S.oA([c.length>0&&{key:"visible_and_hidden_properties",render:t=>(0,ee.jsx)(Q.Z,{...t,noTextOverflow:!0,isTitleUppercase:!1,title:(0,ee.jsx)(re,{viewType:p}),desktopTitleStyle:{height:19},right:!l&&o.canConfigureBlock&&(0,ee.jsx)(G.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:()=>function(e,t,o){C.wd({environment:t,collectionContextStore:o,action:"click_hide_all_properties"}),le({formatKey:e,visibility:!1},o,t)}(e,this.environment,this.props.collectionContextStore),children:(0,ee.jsx)(b.FormattedMessage,{id:"database.viewSettings.propertiesTab.hideAllProperties",defaultMessage:"Hide all"})}),children:this.renderPropertySortList({formatKey:e,visibleProperties:c,hiddenProperties:u,children:t.children})}),items:S.oA([...this.renderPropertySortListItems({formatKey:e,properties:c}),u.length>0&&{key:"group-header-hidden-property",render:t=>this.renderHiddenPropertySectionHeader({props:t,formatKey:e,children:(0,ee.jsx)(ee.Fragment,{})}),action:()=>{}},...this.renderPropertySortListItems({formatKey:e,properties:u})])},0===c.length&&u.length>0&&{key:"hidden_properties",render:t=>this.renderHiddenPropertySectionHeader({props:t,formatKey:e,children:this.renderPropertySortList({formatKey:e,visibleProperties:c,hiddenProperties:u,children:t.children})}),items:this.renderPropertySortListItems({formatKey:e,properties:u})}])})]})}renderHiddenPropertySectionHeader(e){const{props:t,formatKey:o,children:n}=e,{collectionContextStore:i}=this.props,r=i.permissionScopes.state,{inputStore:a}=this.stores,l=a.state,s="timeline_table_properties"===o?"table":(0,T.WY)({collectionContextStore:i});return(0,ee.jsx)(Q.Z,{...t,noTextOverflow:!0,isTitleUppercase:!1,title:(0,ee.jsx)(ae,{viewType:s}),desktopTitleStyle:{height:19},right:!l&&r.canConfigureBlock&&(0,ee.jsx)(G.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:()=>function(e,t,o){C.wd({environment:t,collectionContextStore:o,action:"click_show_all_properties"}),le({formatKey:e,visibility:!0},o,t)}(o,this.environment,this.props.collectionContextStore),children:(0,ee.jsx)(b.FormattedMessage,{id:"database.viewSettings.propertiesTab.showAllProperties",defaultMessage:"Show all"})}),style:{width:"100%",paddingBottom:0},children:n})}renderPropertySortList(e){const{formatKey:t,visibleProperties:o,hiddenProperties:n,children:i}=e,r=S.oA([...o.map((e=>e.property)),o.length>0&&n.length>0&&{key:"group-header-hidden-property",draggable:!1},...n.map((e=>e.property))]);return this.canReorder()?(0,ee.jsx)(z.ZP,{direction:"vertical",keys:r,renderKey:(e,t)=>i[t],onDrop:(e,o)=>{this.handlePropertyReorder({formatKey:t,newPropertyKeys:e})}}):i}renderPropertySortListItems(e){const{formatKey:t,properties:o}=e;return S.oA(o.map((e=>this.renderPropertySortListItem({formatKey:t,propertyFormat:e}))))}renderPropertySortListItem(e){var t;const{formatKey:o,propertyFormat:n}=e,{collectionContextStore:i}=this.props,r=null===(t=i.collectionStore())||void 0===t?void 0:t.isSyncedCollection(),a=i.permissionScopes.state,l=!n.visible,s=i.normalizedSchemaStore.state,h=(0,d.Qm)({schema:s,property:n.property}),f="title"!==n.property||function(e,t){const o=t.normalizedFormatStore.state,n=(0,T.WY)({collectionContextStore:t});if("board"===n)return(0,p.Lw)(o.board_cover);if("gallery"===n)return(0,p.Lw)(o.gallery_cover);if("timeline"===n)return"timeline_table_properties"===e||(0,p.vP)(Boolean(o.timeline_show_table),o.timeline_table_properties||[]);return!1}(o,this.props.collectionContextStore);let S=!a.canConfigureCollection||r&&((0,d.wl)(n.property)||(0,c.HF)(n.property));if("collectionTypedView"===i.contextType&&a.canConfigureBlock&&(S=!1),!h)return;const{theme:v}=this;return{key:n.property,render:e=>{var t;return(0,ee.jsx)(X.ZP,{disableTooltip:!(null!==(t=h.description)&&void 0!==t&&t.length),renderTooltip:e=>(0,ee.jsxs)("div",{...e,style:P.F6,children:[(0,ee.jsx)("div",{children:h.name}),void 0!==(null==h?void 0:h.description)&&h.description.length>0?(0,ee.jsx)("div",{style:{color:this.theme.mediumInvertedTextColor},children:h.description}):null]}),placement:K.u.Left,render:t=>(0,ee.jsx)(L.Z,{...(0,Z.Z)(e,t),title:(0,ee.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.canReorder()&&(0,ee.jsx)(H.ZP,{iconSize:12,style:{marginRight:8}}),(0,ee.jsx)(u.ZP,{type:h.type,icon:h.icon,size:16,theme:v,style:{fill:v.regularIconColor}}),(0,ee.jsx)("span",{style:{marginLeft:8,...x.Z.textOverflowStyle},children:h.name}),(0,c.qQ)(h)&&(0,c.q3)(h)&&("text"===h.type||(0,I.KZ)())&&(0,ee.jsx)(N.Z,{})]}),right:(0,ee.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,ee.jsx)(U.Z,{icon:l?y.B:g.c,iconStyle:{width:16,height:16},isDarkIconColor:!l,onClick:()=>{this.handleTogglePropertyVisibility({formatKey:o,propertyFormat:n})},ariaLabel:this.props.intl.formatMessage(te.togglePropertyVisibilityAriaLabel),disabled:!f||!a.canConfigureBlock}),!S&&(0,m.o)({width:12,fill:v.lightTextColor,marginLeft:5})]})})})},action:()=>{S||function(e,t,o,n){var i,r,a;const l=(null===(i=n.collectionStore())||void 0===i?void 0:i.getSchema())||n.normalizedSchemaStore.state||{},{formatKey:s,propertyFormat:c}=e;C.wd({environment:t,collectionContextStore:n,action:"click_property",original_view_type:null==n||null===(r=n.collectionViewStore())||void 0===r?void 0:r.getType(),property_type:null===(a=l[c.property])||void 0===a?void 0:a.type}),k.H4({collectionSettingsStore:o,item:{type:"property",formatKey:s,property:c.property}})}({formatKey:o,propertyFormat:n},this.environment,this.props.collectionSettingsStore,this.props.collectionContextStore)}}}canReorder(){const{inputStore:e}=this.stores,t=e.state,{collectionContextStore:o}=this.props,n=o.permissionScopes.state;return!this.environment.device.isMobile&&n.canConfigureBlock&&!t}clearInput(){this.stores.inputStore.reset()}}function ne(e){window.__c={n:"TimelineShowTableSwitcher"};const{collectionContextStore:t,onClick:o}=e,n=(0,a.O7)(),i=(0,l.Kw)(t.normalizedFormatStore),r=Boolean(i.timeline_show_table),s=(0,l.Kw)(t.permissionScopes);return(0,ee.jsx)(Y.Z,{title:(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Show table",id:"database.viewSettings.propertiesTab.showTable"}),on:r,focused:!1,onClick:()=>{const e=t.collectionViewStore();e&&(_.createAndCommit({userAction:"CollectionSettingsViewProperties.TimelineShowTableSwitcher",environment:n,perform:t=>{j.FH({stores:[e],update:{timeline_show_table:!r,timeline_table_properties:[{property:"name",visible:!0}]},transaction:t})}}),null==o||o(),C.wd({environment:n,collectionContextStore:t,action:"timeline_toggle_show_table"}))},disabled:!s.canConfigureBlock,textWrapperStyle:{opacity:1}})}oe.displayName="CollectionSettingsViewProperties";const ie=(0,b.injectIntl)(oe);function re(e){let{viewType:t}=e;return"table"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Shown in table",id:"database.viewSettings.propertiesTab.shownInTableTitle"}):"timeline"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Shown in timeline",id:"database.viewSettings.propertiesTab.shownInTimelineTitle"}):"board"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Shown in board",id:"database.viewSettings.propertiesTab.shownInBoardTitle"}):"list"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Shown in list",id:"database.viewSettings.propertiesTab.shownInListTitle"}):"gallery"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Shown in gallery",id:"database.viewSettings.propertiesTab.shownInGalleryTitle"}):"calendar"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Shown in calendar",id:"database.viewSettings.propertiesTab.shownInCalendarTitle"}):"page"===t?null:void(0,v.t1)(t)}function ae(e){let{viewType:t}=e;return"table"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Hidden in table",id:"database.viewSettings.propertiesTab.hiddenInTableTitle"}):"timeline"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Hidden in timeline",id:"database.viewSettings.propertiesTab.hiddenInTimelineTitle"}):"board"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Hidden in board",id:"database.viewSettings.propertiesTab.hiddenInBoardTitle"}):"list"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Hidden in list",id:"database.viewSettings.propertiesTab.hiddenInListTitle"}):"gallery"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Hidden in gallery",id:"database.viewSettings.propertiesTab.hiddenInGalleryTitle"}):"calendar"===t?(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Hidden in calendar",id:"database.viewSettings.propertiesTab.hiddenInCalendarTitle"}):"page"===t?null:void(0,v.t1)(t)}function le(e,t,o){const{formatKey:n,visibility:i}=e,r=t.collectionViewStore();if(!r)return;const a=t.normalizedFormatStore.state[n]||[],l=a.filter((e=>Boolean(e.visible))),s=a.filter((e=>!Boolean(e.visible))),c=[...l.map((e=>({...e,visible:i}))),...s.map((e=>({...e,visible:i})))];_.createAndCommit({userAction:"CollectionSettingsViewProperties.setAllPropertiesVisibility",environment:o,perform:e=>{j.FH({stores:[r],update:{[n]:c},transaction:e})}})}function se(e){let{collectionContextStore:t,timelineViewTab:o}=e;window.__c={n:"FooterComponent"};const n=(0,a.O7)(),i=(0,l.VK)((()=>t.permissionScopes.state),[t]),r=(0,l.VK)((()=>"timeline"===(0,T.WY)({collectionContextStore:t})&&"table"===o&&!(0,T.vw)({collectionContextStore:t})),[t,o]),s=i.canConfigureCollection&&!r;return(0,ee.jsxs)(Q.Z,{topBorder:!0,children:[s&&(0,ee.jsx)(E.Z,{icon:h.R,title:(0,ee.jsx)(b.FormattedMessage,{id:"database.viewSettings.propertiesTab.newProperty",defaultMessage:"New property"}),isGray:!0,onClick:()=>function(e,t){const o=t.collectionStore();o&&(C.wd({environment:e,collectionContextStore:t,action:"click_new_property"}),k.wl({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",propertyTypes:(0,A.TP)({isSyncedCollection:o.isSyncedCollection(),collectionContextStore:t,environment:e}),onAccept:(o,n)=>{w.PW({environment:e,propertyType:o,propertyName:n,collectionContextStore:t,from:"view_settings"})}}}))}(n,t)}),(0,ee.jsx)(W.Z,{href:(0,B.UY)("guides.databaseProperties"),title:(0,ee.jsx)(b.FormattedMessage,{defaultMessage:"Learn about properties",id:"database.viewSettings.propertiesTab.learnMoreButton.title"}),analyticsFrom:"view_settings_properties"})]})}function ce(e){let{collectionContextStore:t,collectionSettingsStore:o,timelineViewTab:n}=e;window.__c={n:"DeletedPropertiesComponent"};const i=(0,a.O7)(),r=(0,l.VK)((()=>t.normalizedDeletedSchemaStore.state),[t]),s=Object.keys(r).length;return(0,l.VK)((()=>t.permissionScopes.state),[t]).canConfigureCollection&&s>0?(0,ee.jsx)(E.Z,{icon:f.y,title:(0,ee.jsx)(b.FormattedMessage,{id:"database.viewSettings.propertiesTab.deletedProperties",defaultMessage:"Deleted properties"}),isGray:!0,onClick:()=>function(e,t,o,n){o.collectionStore()&&(C.wd({environment:e,collectionContextStore:o,action:"click_deleted_properties"}),k.H4({collectionSettingsStore:t,item:{type:"deletedProperties",timelineViewTab:n}}))}(i,o,t,n),right:s,showChevron:!0}):null}},40071:(e,t,o)=>{o.d(t,{Z:()=>ee});var n=o(94184),i=o.n(n),r=(o(67294),o(83355)),a=o(15145),l=o(88437),s=o(39132),c=o(18557),d=o(53470),u=o(37612),p=o(72126),m=o(9291),g=o(50906),y=o(81193),h=o(98834),f=o(47307),S=o(96802),v=o(3992),x=o(8055),b=o(82530),C=o(66890),k=o(66213),w=o(28651),M=o(19037),j=o(43250),_=o(84210),A=o(33929),T=o(87279),P=o(98742),V=o(25498),I=o(77907),F=o(17031),Z=o(80444),B=o(61766),K=o(77080),R=o(96049),O=o(26136),W=o(24736),D=o(45669),E=o(93405),N=o(31945),L=o(78140),z=o(32163),H=o(53437),U=o(31278),$=o(76798),q=o(72495),G=o(26388),Q=o(34574),Y=o(85893);const X=(0,m.defineMessages)({emptyPageTitle:{defaultMessage:"Empty",id:"database.templatePicker.emptyPageTitle"}});class J extends r.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:w.Z,buttonPopupStore:B.Z},this.renderActionMenuPopup=e=>{const{device:t}=this.environment,o=!!this.props.templateStore&&(0,M.J5)({environment:this.environment,blocks:[this.props.templateStore],publicEditMode:void 0}),n={key:"section",render:e=>(0,Y.jsx)(q.Z,{...e}),items:p.oA([this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"repeatControl",render:(e,t)=>this.props.templateStore&&(0,Y.jsx)(I.LazyRecurrenceConfigMenu,{...e,templateStore:this.props.templateStore,parent:t,cannotEditRecurrence:this.cannotEditRecurrence.state}),action:()=>{return e=this.environment,t=this.props.recurrence,void g.efr(e,{isConfigured:void 0!==t});var e,t}},this.props.isOverlay&&!this.canEditContentOnly.state&&{key:"Set default",render:e=>(0,Y.jsx)(E.Z,{...e,title:(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"Set as default",id:"database.collectionTemplatePickerItem.actionMenu.setAsDefault"}),svg:c.z}),action:()=>this.handleSetAsDefault(e)},this.props.templateStore&&{key:"Edit",render:e=>(0,Y.jsx)(E.Z,{...e,title:o?(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"Edit",id:"database.templatePickerItem.actionMenu.edit"}):(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"View",id:"database.templatePickerItem.actionMenu.view"}),svg:o?d.H:s.c}),action:this.handleEdit},this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"Duplicate",render:e=>(0,Y.jsx)(E.Z,{...e,title:(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"Duplicate",id:"database.templatePickerItem.actionMenu.duplicate"}),svg:l.a}),action:this.handleDuplicate},this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"Delete",render:e=>(0,Y.jsx)(E.Z,{...e,title:(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"Delete",id:"database.templatePickerItem.actionMenu.delete"}),svg:u.y}),action:o?()=>async function(e,t,o){if(!o)return;if(!(await f.confirmUserAction({message:(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"Are you sure you would like to delete this template?",id:"database.confirmDialog.templatePickerItem.deleteMessage"}),acceptLabel:(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"Delete",id:"database.confirmDialog.templatePickerItem.deleteButton.label"})})))return;b.createAndCommit({userAction:"CollectionTemplatePickerItem.handleDelete",environment:e,perform:e=>h.R5({collectionStore:t,templateStore:o,transaction:e})}),y.sY(e,{template_action:"delete"})}(this.environment,this.props.collectionStore,this.props.templateStore):()=>{}}])};let i;return i=t.isMobile?{menuType:T.og.ActionSheet}:{menuType:T.og.Popup,width:230},(0,Y.jsx)(L.Z,{...i,children:(0,Y.jsx)(z.Z,{type:z.i.Vertical,initialFocus:void 0,sections:[n]})})},this.handleEdit=()=>{var e,t;const{buttonPopupStore:o}=this.stores;this.props.templateStore&&(null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t),this.navigateToBlock(this.props.templateStore),o.reset(),y.sY(this.environment,{template_action:"edit"}))},this.handleDuplicate=()=>{var e,t;const{buttonPopupStore:o}=this.stores,{templateStore:n,collectionStore:i}=this.props;if(!n)return;null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t);const{performResult:r}=b.createAndCommit({userAction:"CollectionTemplatePickerItem.duplicatedStore",environment:this.environment,perform:e=>{const t=h.Zh({environment:this.environment,collectionStore:i,templateStore:n,transaction:e});if(n.getAutomationId()){const o=O.Mz.fromBlockStore(n),i=null==o?void 0:o.getRecurrence();o&&null!=o&&o.isActive()&&i&&v.createRecurrenceInner(e,this.environment,t,i)}return t}});r&&this.navigateToBlock(r),o.reset(),y.sY(this.environment,{template_action:"duplicate"})},this.handleSetAsDefault=e=>{var t,o;const{collectionContextStore:n}=this.context,i=null==n?void 0:n.collectionStore(),r=null==n?void 0:n.collectionViewStore();if(!i||null==r||!r.isDefined())return;const a=null!==(t=this.props.templateStore)&&void 0!==t&&t.id?{template_page_id:null===(o=this.props.templateStore)||void 0===o?void 0:o.id}:"empty";f.showDialog({showCancel:!0,keepFocus:!1,message:(0,Y.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.message",defaultMessage:"<span>Use “{pageName}” as default template when creating new pages?</span>",values:{span:e=>(0,Y.jsx)("span",{children:e}),pageName:this.props.templateStore?(0,Y.jsx)($.Z,{store:this.props.templateStore,style:{display:"inline"}}):A.default.formatMessage(X.emptyPageTitle)}}),items:[{label:(0,Y.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollection",defaultMessage:"For all views in “{databaseName}”",values:{databaseName:(0,Y.jsx)($.Z,{store:i,style:{display:"inline"}})}}),onAccept:()=>{e.close(),b.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collection",perform:e=>{S.FH({stores:[i],update:{collection_default_template:a},transaction:e}),S.FH({stores:[r],update:{collection_view_default_template:a},transaction:e})}})}},{label:(0,Y.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollectionView",defaultMessage:"Only on “{viewName}” view",values:{viewName:(0,Y.jsx)(D.Z,{collectionViewName:r.getName(),collectionViewType:r.getType()})}}),onAccept:()=>{e.close(),b.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collectionView",perform:e=>{S.FH({stores:[r],update:{collection_view_default_template:a},transaction:e})}})}}]})},this.handleMouseMove=()=>{R.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.getRecordModel=this.props.collectionStore.getRecordModel,this.canEditContentOnly=this.createComputedStore((()=>{var e;return Boolean(null===(e=this.props.collectionStore.getParentBlockStore())||void 0===e?void 0:e.canEditContentOnly())})),this.cannotEditRecurrence=this.createComputedStore((()=>{if(!K.default.checkGate("recurrence_queue_task_improvements"))return!1;if(!this.props.templateStore)return!1;const e=(0,V.w)(this.props.templateStore);return!e.automationStoresReady||e.violatesConstraint}))}get registries(){return[F.Z]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):x.c4({environment:this.environment,url:e})}renderComponent(){var e;const{device:t}=this.environment,{templateStore:o,isMobile:n,isOverlay:i,focused:r,locked:a,canConfigureCollection:l,draggable:s}=this.props,{mouseStore:c,buttonPopupStore:d}=this.stores,u=!o&&!i,p=(!a||a&&!s)&&(l||this.canEditContentOnly.state)&&(c.state.mouseEntered||d.state.open||n||i)&&!u,m=o?(0,Y.jsx)($.Z,{store:o}):A.default.formatMessage(X.emptyPageTitle),g=null==o||null===(e=o.getModel())||void 0===e?void 0:e.getRenderIcon({getRecordModel:this.getRecordModel});return(0,Y.jsx)(Q.Z,{className:j.$ji,type:o?"custom_template":"empty_page",format:i?"collection-overlay":"page-menu-item",locked:a||!l||!s,icon:(0,Y.jsx)(U.Z,{disabled:!0,icon:g,isEmptyPage:(null==o?void 0:o.isEmptyPage())??!0,size:t.isMobile&&i?24:20,isLarge:!i,style:{...!i&&{pointerEvents:"none",marginRight:10}},pageIconStyle:{...!i&&{fill:this.theme.lightIconColor}}}),title:m,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,right:p&&this.renderActionMenuButton(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,focused:r,isDefault:this.props.isDefault,recurrence:this.props.recurrence})}renderActionMenuButton(){const{isMobile:e,isOverlay:t}=this.props,{buttonPopupStore:o}=this.stores,n=!!this.props.templateStore&&(0,M.J5)({environment:this.environment,blocks:[this.props.templateStore],publicEditMode:void 0});return(0,Y.jsx)(G.ZP,{renderTooltip:()=>n?(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"Edit this template",id:"database.templatePickerItem.editTemplate.tooltip"}):(0,Y.jsx)(m.FormattedMessage,{defaultMessage:"View this template",id:"database.templatePickerItem.viewTemplate.tooltip"}),delayThreshold:300,render:n=>(0,Y.jsx)(N.ZP,{popupType:e?H.ZP.PopupType.SlideUp:H.ZP.PopupType.Popup,placementToOrigin:N.pO.Right,originGap:12,buttonPopupStore:o,renderOrigin:o=>(0,Y.jsx)(W.Z,{className:i()(j.C_N,{[j.JiD]:e||t}),isMobile:e&&t,style:{...!t&&{marginRight:0}},...(0,P.Z)(n,o)}),render:this.renderActionMenuPopup,onClick:()=>{y.sY(this.environment,{template_action:"open_menu"})}})})}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=Z.default.state,o=t?(0,_.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:a.tY.PeekOpen}):(0,_.ZP)({store:e,fullyQualified:!1,pageVisitSource:a.tY.LinkInPage});this.navigate(o)}}J.displayName="CollectionTemplatePickerItem",J.contextTypes={...r.w,...k.wK,...C.xm};const ee=J},45669:(e,t,o)=>{o.d(t,{Z:()=>l});o(67294);var n=o(9291),i=o(78316),r=o(62896),a=o(85893);const l=function(e){let{collectionViewName:t,collectionViewType:o}=e;return t?(0,a.jsx)(r.Z,{children:t}):"page"===o?(0,a.jsx)(n.FormattedMessage,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled"}):(0,a.jsx)(n.FormattedMessage,{...i.b1[o]})}},34574:(e,t,o)=>{o.d(t,{Z:()=>h});o(67294);var n=o(83355),i=o(480),r=o(24405),a=o(49271),l=o(8848),s=o(53523),c=o(82990),d=o(9291),u=o(19124),p=o(64921),m=o(52275),g=o(85893);class y extends n.Z{constructor(){super(...arguments),this.completionsEnabledStore=this.createComputedStore((()=>{var e;const t=null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state;return(0,u.GD)(t)}))}renderComponent(){return"collection-overlay"===this.props.format?(0,g.jsx)(S,{className:this.props.className,icon:this.props.icon,format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence,right:this.props.right,focused:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,locked:this.props.locked,type:this.props.type}):"phone-modal"===this.props.format?(0,g.jsx)(v,{icon:this.props.icon,format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence,focused:this.props.focused,onClick:this.props.onClick}):this.renderPageMenuItem()}renderPageMenuItem(){return(0,g.jsxs)(p.Z,{style:this.getWrapStyle(),hovered:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,hoveredStyle:{background:this.theme.buttonHoveredBackground,color:this.theme.regularTextColor},pressedStyle:{background:this.theme.buttonPressedBackground},children:[(0,g.jsx)("div",{style:{display:"flex",alignItems:"center",width:24,height:24,marginRight:10},children:this.props.icon}),(0,g.jsx)(f,{format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence}),this.props.right&&(0,g.jsx)("div",{style:{marginLeft:"auto",marginRight:4},children:this.props.right})]})}getWrapStyle(){const{device:e}=this.environment;return{...a.ZD,display:"flex",alignItems:"center",flexGrow:1,height:e.isMobile?36:32,fontSize:16,borderRadius:4,paddingLeft:8,marginBottom:2,color:this.completionsEnabledStore.state?this.theme.mediumTextColor:this.theme.lightTextColor}}}y.displayName="TemplatePickerMenuItem";const h=y;function f(e){let{format:t,title:o,isDefault:n,recurrence:i}=e;window.__c={n:"TitleComponent"};const a=(0,r.Fg)();return"collection-overlay"!==t?(0,g.jsx)(g.Fragment,{children:o}):(0,g.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o,(0,g.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n&&(0,g.jsx)("span",{style:{fontSize:12,fontWeight:c.Z.fontWeight.medium,color:a.mediumTextColor},children:(0,g.jsx)(d.FormattedMessage,{defaultMessage:"DEFAULT",id:"database.templatePickerMenuItem.default"})}),i&&(0,s.N)({width:14,color:l.ZP.blue,marginLeft:8})]})]})}function S(e){let{className:t,icon:o,format:n,title:r,isDefault:a,recurrence:l,right:s,focused:c,onClick:d,onMouseMove:u,onMouseEnter:p,onMouseLeave:y,locked:h,type:S}=e;window.__c={n:"CollectionOverlayMenuItemComponent"};const v=(0,i.O7)(),{device:x}=v;return(0,g.jsx)(m.Z,{className:t,icon:o,title:(0,g.jsx)(f,{format:n,title:r,isDefault:a,recurrence:l}),right:s,focused:c,onClick:d,onMouseMove:u,onMouseEnter:p,onMouseLeave:y,showDragHandle:!x.isMobile&&!h,dragHandleDisabled:"empty_page"===S})}function v(e){let{icon:t,format:o,title:n,isDefault:i,recurrence:r,focused:a,onClick:l}=e;return(0,g.jsx)(m.Z,{icon:t,title:(0,g.jsx)(f,{format:o,title:n,isDefault:i,recurrence:r}),focused:a,onClick:l,showDragHandle:!1})}},72865:(e,t,o)=>{o.d(t,{D:()=>y});var n=o(67294),i=o(480),r=o(24405),a=o(20852),l=o(993),s=o(82530),c=o(43250),d=o(17809),u=o(24666),p=o(28385),m=o(65187),g=o(85893);function y(e){window.__c={n:"SimpleFormulaValueTextInput"};const{value:t,disabled:o,onChange:y,multiline:h,placeholder:f,disableFormattingAndMentions:S,disableMobileActionBar:v,disableEmojiCommands:x,disableTemplateVariableMentions:b,code:C}=e,k=(0,i.O7)(),w=(0,r.yK)((e=>({wrap:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,borderRadius:4,padding:h?"6px 10px":"4px 8px",overflow:"hidden",..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},text:h?{minHeight:60}:{whiteSpace:"pre"},placeholder:h?{minHeight:60}:{}})),[h]),M=(0,n.useCallback)((e=>{y({type:"simple",value:e})}),[y]),{store:j}=(0,d.Cl)({initialValue:null==t?void 0:t.value,onChange:M}),_=(0,n.useMemo)((()=>h?()=>{const e=u.default.state;"editing"===e.mode&&s.createAndCommit({userAction:"SimpleFormulaValueTextInput.handleEnter",environment:k,perform:t=>{l.hJ({environment:k,string:"\n",multiSelection:e.multiSelection,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})}:void 0),[k,h]);return C?(0,g.jsx)("div",{style:w.wrap,className:c.Wh_,children:(0,g.jsx)(p.Z,{disabled:o,store:j,language:a.PrismLanguages.jsx,blockStore:void 0,codeWrap:!1,isQuickFind:!1,parentSpaceId:"",style:{padding:0}})}):(0,g.jsx)("div",{style:w.wrap,className:c.Wh_,children:(0,g.jsx)(m.Z,{placeholder:f,disabled:o,store:j,style:w.text,placeholderStyle:w.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:x,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,onEnter:_,disableMobileActionBar:v,disableTemplateVariableMentions:b,...S?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{}})})}},53498:(e,t,o)=>{o.d(t,{a:()=>Ce,K:()=>M});var n=o(67294),i=o(480),r=o(86628),a=o(66897),l=o(99036),s=o(80951),c=o(84619),d=o(78106),u=o(76218),p=o(149),m=o(19889),g=o(70203),y=o(97880),h=o(37867),f=o(60458),S=o(92864),v=o(89845),x=o(10009),b=o(22084),C=o(21396),k=o(75311),w=o(85893);function M(e){window.__c={n:"ValuePickerMenuToken"};const{token:t,contextStore:o,disabled:n,setCurrentTokens:M,currentSimpleFormulaValueTokens:j,context:_}=e,A=(0,i.Fy)(),T=(0,r.Kw)(o.compilationResultStore),P=(0,r.VK)((()=>{if((0,u.S3)(t)&&(0,g.IWo)(t)){const e=(0,g.zEN)(t);if(e)return(0,a.Hl)({pointer:{table:m.KJ,id:e},getRecordValue:o.context.parentRecordStore.getRecordValue})}}),[o.context.parentRecordStore,t]),V=(0,r.VK)((()=>(0,k._)(_)),[_]),I=(0,r.VK)((()=>_.collectionStore.getSchema()[_.property]),[_]);if("string"==typeof t){if(!I||!(0,l.t)(I))return null;const e=(0,s.i7)((null==I?void 0:I.options)??[],t);if(!e)return(0,w.jsx)(h.Z,{isSingle:!1,showRemoveButton:!n,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))}},`deleted_option_value_${t}`);const o={value:e.value,color:e.color,isSingle:!1,showRemoveButton:!n,format:A.isMobile?c.lo.Medium:c.lo.Small,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))}};if((0,l.gB)(I)){var F;const t=null===(F=I.groups)||void 0===F||null===(F=F.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})))||void 0===F?void 0:F.color;return(0,w.jsx)(b.F,{...o,groupColor:t})}return(0,w.jsx)(b.a,{...o})}if("boolean"==typeof t)return(0,w.jsx)(f.Z,{checked:t,disabled:!0,size:16,checkSize:12,style:{marginBottom:6}},t.toString());if((0,g.IWo)(t))return null!=P&&P.asActor?(0,w.jsx)(S.ZP,{actor:P,format:A.isMobile?S.ZP.Format.Medium:S.ZP.Format.Small,showRemoveButton:!n,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))},shouldShrink:!0,isSingle:!1},P.id):null;if((0,g.wjk)(t)){const e=(0,g.vmO)(t).id,o=p.x.isSuccess(T)?(0,d.vx)(T.value.valueTypes,e):void 0;return o?(0,w.jsx)(C.F,{value:o,format:c.lo.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!n,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))}}):null}if((0,g.fpG)(t)){const e=j[0],t=e&&(0,u.S3)(e)&&(0,g.fpG)(e)?(0,g.zyO)(e):void 0;return t?(0,w.jsx)(v.Z,{value:t,dateFormat:V.dateFormat,timeFormat:V.timeFormat,style:{marginBottom:6}}):null}if((0,g.STW)(t)){const e=(0,g.TOT)(t);return e?(0,w.jsx)(x.Z,{format:A.isMobile?c.lo.Medium:c.lo.Small,blockId:e,shouldWrap:!1,shouldShrink:!0,isSingle:!1,parentStore:o.context.parentRecordStore,showRemoveButton:!n,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))}},e):null}(0,y.t1)(t)}o(57658);var j=o(23790),_=o(84116),A=o(58573),T=o(59054),P=o(72126),V=o(9291),I=o(17809),F=o(87279),Z=o(77907),B=o(75822),K=o(29798),R=o(78140),O=o(32163),W=o(43765),D=o(40721),E=o(72495),N=o(78948),L=o(47082),z=o(30387),H=o(32426),U=o(24405),$=o(5257),q=o(52275);function G(e){window.__c={n:"IconMenuItem"};const t=(0,U.yK)((e=>({icon:{width:14,fill:e.mediumIconColor},chevronRight:{width:12,fill:e.mediumIconColor}})),[]);return(0,w.jsx)(q.Z,{icon:e.icon(t.icon),title:e.title,focused:!1,right:(0,$.o)(t.chevronRight),onClick:e.onClick})}function Q(e){window.__c={n:"CustomFormulaItem"};const{value:t,onChange:o}=e,i=(0,n.useCallback)((()=>{o({type:"formula",value:null==t?void 0:t.value})}),[t,o]);return(0,w.jsx)(G,{icon:H.D,title:(0,w.jsx)(V.FormattedMessage,{...z.s.customFormula}),onClick:i})}o(21703);var Y=o(21202),X=o(26136),J=o(11470),ee=o(26388);function te(e){window.__c={n:"ValuePickerMenuItem"};const{token:t,contextStore:o,args:n,checkState:h,checkType:v,context:x,onCheckboxClick:k}=e,M=(0,i.Fy)(),j=(0,r.VK)((()=>o.context.parentRecordStore.getSpaceId()),[o.context.parentRecordStore]),_=(0,r.VK)((()=>{if((0,u.S3)(t)&&(0,g.IWo)(t)){const e=(0,g.zEN)(t);if(e)return(0,a.Hl)({pointer:{table:m.KJ,id:e},getRecordValue:o.context.parentRecordStore.getRecordValue})}}),[o.context.parentRecordStore,t]),A=(0,r.VK)((()=>x.collectionStore.getSchema()[x.property]),[x]),T=(0,r.VK)((()=>A&&(0,l.t)(A)?A.options??[]:[]),[A]),P=(0,r.VK)((()=>A&&(0,l.gB)(A)?A.groups??[]:[]),[A]),V=(0,r.Kw)(o.compilationResultStore),I=Boolean(A&&(0,l.gB)(A)),F="single"===v?{checkState:h}:{icon:(0,w.jsx)(f.Z,{checked:h,size:14,onClick:k})};if("string"==typeof t){if(I){const e=(0,s.i7)(T,t),o=P.find((t=>{var o;return e&&(null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id))}));return e?(0,w.jsx)(q.Z,{...n,...F,title:(0,w.jsx)(b.F,{format:M.isMobile?c.lo.Large:c.lo.Small,isSingle:!0,value:e.value,color:e.color,groupColor:null==o?void 0:o.color,shouldShrink:!0,showRemoveButton:!1},t),isTokenTitle:!0,...n}):null}{const e=(0,s.i7)(T,t);return e?(0,w.jsx)(q.Z,{...n,...F,title:(0,w.jsx)(b.a,{value:e.value,color:e.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:M.isMobile?c.lo.Large:c.lo.Small}),isTokenTitle:!0,...n}):null}}if("boolean"==typeof t)return null;if((0,g.IWo)(t))return null!=_&&_.asActor&&_.table===m.KJ?(0,w.jsx)(q.Z,{...n,...F,title:(0,w.jsx)(S.vw,{isSingle:!0,shouldShrink:!0,format:M.isMobile?S.vw.Format.Large:S.vw.Format.Medium,userValue:_.asActor}),isTokenTitle:!0}):null;if((0,g.wjk)(t)){const e=(0,g.vmO)(t).id,o=p.x.isSuccess(V)?(0,d.vx)(V.value.valueTypes,e):void 0;return o?(0,w.jsx)(q.Z,{...F,title:(0,w.jsx)(ee.ZP,{renderTooltip:()=>(0,C.e)(o),placement:ee.ug.Right,render:e=>(0,w.jsx)("div",{style:{display:"flex"},...e,children:(0,w.jsx)(C.F,{value:o,format:c.lo.Medium,isSingle:!0,shouldShrink:!0})})}),...n}):null}if((0,g.fpG)(t))return null;if((0,g.STW)(t)){const e=(0,g.TOT)(t);if(!e)return null;if(!j)return null;const i=X.G.createChildStore(o.context.parentRecordStore,{table:Y.iU,id:e,spaceId:j});return(0,w.jsx)(J.Z,{store:i,checkState:h,hidePath:!0,...n})}(0,y.t1)(t)}function oe(e){const{currentSimpleFormulaValueTokens:t,value:o,contextStore:n,setCurrentTokens:i,action:r,context:a,checkType:l,onCheckboxClick:s}=e;if(o.kind!==_.yp.ContextValue)throw new Error("Not implemented yet.");const c=Boolean(t.find((e=>(0,u.S3)(e)&&(0,g.wjk)(e)&&(0,g.vmO)(e).id===o.id))),d=(0,g._QF)({id:o.id}),p=()=>{i("append"===r?c?(0,u.Ck)(t,d):[...t,d]:[d]),null==s||s()};return{key:o.id,render:e=>(0,w.jsx)(te,{token:d,contextStore:n,args:e,checkState:c,checkType:l,context:a,onCheckboxClick:p}),action:p}}function ne(e){var t,o;window.__c={n:"ValuePickerMenuBlockArray"};const{currentSimpleFormulaValueTokens:a,menuProps:s,onClose:c,onChange:d,contextStore:p,formulaTypecheckContextValues:m,context:y,showClearButton:h,showInputMenuItem:f,type:S}=e,v=(0,i.Fy)(),x=(0,V.useIntl)(),b=(0,i.O7)(),[C,H]=(0,n.useState)(""),U=(0,r.qz)(void 0,K.Z),{collectionStore:$,property:q}=y,G=(0,k.M)($,q),Y=G(a,"first"),X=(0,r.VK)((()=>$.getSchema()[y.property]),[$,y.property]),J=(0,r.VK)((()=>!(!X||!(0,l.en)(X))&&1===X.limit),[X]),ee=(0,n.useMemo)((()=>{const e="relation"===(null==X?void 0:X.type)?(0,l.j0)(X):void 0;return m.filter((t=>(0,j.uy)(t.type,{type:"block",collection:e},!0)))}),[m,X]),ne=(0,Z.useDependency)(Z.deps.searchActions),[ie]=(0,T.r5)((async()=>{const e=C?(0,A.ZP)(C,ee,(e=>e.kind===_.yp.ContextValue?e.name:"")):ee;if("resolved"!==ne.status)return;const t=ne.value,{results:o}=await t.searchPagesInCollection({environment:b,query:C,collectionId:S.collection.id,limit:20,spaceId:S.collection.spaceId,excludeTemplates:!0,source:"simple_formula_value_page_search",includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!1});return{valueResults:e,pageResults:o}}),[b,C,ee,S,ne.status,ne.value],{debounce:B.vp}),re=(0,n.useCallback)((()=>{H(""),U.setState({...U.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[U]),ae=(0,n.useCallback)((e=>{const t=G(e,"last");d({type:"simple",value:(0,u.iC)(t)}),re(),J&&c()}),[G,d,re,J,c]),le=(0,r.VK)((()=>(0,I.NY)()),[]),se=P.oA(Y.map(((e,t)=>(0,w.jsx)(M,{token:e,contextStore:p,disabled:!1,currentSimpleFormulaValueTokens:Y,setCurrentTokens:ae,context:y},t)))),ce=(0,w.jsx)(L.Z,{focus:!v.isMobile||void 0,focusAfterAnimation:!0,format:L.U.FilterValue,tokens:se,placeholder:x.formatMessage(z.s.pageSearchPlaceholder),onRemoveLastToken:()=>{ae(Y.slice(0,Y.length-1))},onClearButtonClick:()=>{ae([])},value:C,onChange:e=>{H(e.target.value)},dontShowBorderBottom:v.isAndroid,showClearButton:h}),de=void 0!==(null==s?void 0:s.header)?s.header:(0,w.jsx)(E.Z,{style:{paddingBottom:0},title:x.formatMessage(z.s.genericMenuHeader)});let ue;ue=v.isMobile?{menuType:F.og.Modal,right:(0,w.jsx)(D.DoneMenuText,{}),onClickRight:c}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,paddingTop:0,footer:le&&(0,w.jsx)(E.Z,{topBorder:!0,children:(0,w.jsx)(Q,{...e})}),disableHeaderBorder:!0};const pe={...ue,...s,header:v.isMobile?null:de},me=J?"single":"multi",ge=[],ye=[...P.oA(((null===(t=ie.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>oe({currentSimpleFormulaValueTokens:Y,value:e,setCurrentTokens:ae,contextStore:p,action:"append",context:y,checkType:me})))),...P.oA(((null===(o=ie.value)||void 0===o?void 0:o.pageResults)||[]).map((e=>{const t=Boolean(Y.find((t=>(0,u.S3)(t)&&(0,g.STW)(t)&&(0,g.TOT)(t)===e))),o=(0,g.$0A)(e,S.collection.spaceId),n=()=>{ae(t?(0,u.Ck)(Y,o):[...Y,o])};return{key:e,render:e=>(0,w.jsx)(te,{token:o,contextStore:p,args:e,checkState:t,checkType:me,context:y,onCheckboxClick:n}),action:n}})))];if(f){const e=Boolean(de);ge.push({key:"search-input",render:t=>(0,w.jsx)(E.Z,{...t,style:{...e&&{paddingTop:0}}}),items:[{action:()=>{},key:"input",render:()=>ce}]})}if(ye.length>0){const e=Boolean(de)||f;ge.push({key:"values",render:t=>(0,w.jsx)(E.Z,{topBorder:e,...t}),items:ye})}return(0,w.jsxs)(R.Z,{...pe,children:[ie.error&&(0,w.jsx)(E.Z,{children:(0,w.jsx)(W.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.somethingWentWrong})})}),0===ge.length&&ie.value&&(0,w.jsx)(E.Z,{children:(0,w.jsx)(W.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.noResults})})}),!ie.value&&!ie.error&&(0,w.jsx)(E.Z,{children:(0,w.jsx)(N.Z,{})}),ge.length>0&&(0,w.jsx)(O.Z,{type:O.i.Vertical,initialFocus:0,sections:ge,store:U})]})}function ie(e){window.__c={n:"ValuePickerMenuCheckbox"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:a,formulaTypecheckContextValues:l,menuProps:s,onChange:c,onClose:d}=e,p=(0,V.useIntl)(),m=(0,i.Fy)(),g=l.filter((e=>"checkbox"===e.type.type)),y=(0,n.useCallback)((e=>{c({type:"simple",value:void 0!==e[0]?(0,u.YD)(e[0]):void 0})}),[c]),h=(0,n.useCallback)((e=>{y(e),d()}),[y,d]),f=(0,r.VK)((()=>(0,I.NY)()),[]),S=P.oA(g.map((e=>oe({currentSimpleFormulaValueTokens:a,value:e,setCurrentTokens:h,contextStore:o,action:"replace",context:t,checkType:"single"})))),v=[],x=a.some((e=>!0===e)),b=[...S,...[{key:0,render:e=>(0,w.jsx)(q.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.unchecked}),checkState:!x,...e}),action:()=>{h([!1])}},{key:1,render:e=>(0,w.jsx)(q.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.checked}),checkState:x,...e}),action:()=>{h([!0])}}]],C=void 0!==(null==s?void 0:s.header)?s.header:(0,w.jsx)(E.Z,{style:{paddingBottom:0},title:p.formatMessage(z.s.genericMenuHeader)}),k=Boolean(C);let M;v.push({key:"checkbox",render:e=>(0,w.jsx)(E.Z,{...e,topBorder:k}),items:b}),M=m.isMobile?{menuType:F.og.Modal,right:(0,w.jsx)(D.DoneMenuText,{}),onClickRight:d}:{header:C,menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:f&&(0,w.jsx)(E.Z,{topBorder:!0,children:(0,w.jsx)(Q,{...e})}),disableHeaderBorder:!0};const j={...M,...s,header:m.isMobile?null:C};return(0,w.jsx)(R.Z,{...j,children:(0,w.jsx)(O.Z,{type:O.i.Vertical,initialFocus:0,sections:v})})}var re=o(53016),ae=o(40506),le=o(12392),se=o(28020),ce=o(73063),de=o(89728);function ue(e){window.__c={n:"ValueDatePicker"};const{currentSimpleFormulaValueTokens:t,disabled:o,setInDatePicker:i,onClose:a,setCurrentTokens:l,context:s}=e,c=t[0],d=c&&(0,u.S3)(c)&&g.fpG(c)?g.zyO(c):void 0,p=(0,V.useIntl)(),m=(0,r.Kw)(se.AK),y=(0,n.useCallback)((()=>{i(!1)}),[i]),h=(0,n.useCallback)((e=>{e&&(0,ae.U3)(e)?l([g.pZr(e)]):l([])}),[l]),f=(0,U.yK)((e=>({header:{display:"flex",alignItems:"center",fontSize:12,paddingInline:14,color:e.mediumTextColor,marginTop:8,fontWeight:500},iconWrap:{width:18,height:18,marginRight:4},icon:{width:12,height:12},title:{flex:"1 1 auto"}})),[]),S=(0,r.VK)((()=>(0,k._)(s)),[s]);return(0,w.jsx)(Z.DependencyConsumer,{dependency:Z.deps.menus,children:e=>{let{DatePropertyMenu:t}=e;return(0,w.jsx)(t,{firstDayOfWeek:m,value:d,canConfigureCollection:!1,onChangeValue:h,dateFormat:S.dateFormat,timeFormat:S.timeFormat,onDismiss:a,disabled:o,shouldShowReminder:!1,header:(0,w.jsxs)("div",{style:f.header,children:[(0,w.jsx)(ce.Z,{ariaLabel:p.formatMessage(z.s.back),icon:le.S,onClick:y,style:f.iconWrap,iconStyle:f.icon}),(0,w.jsx)("span",{style:f.title,children:(0,w.jsx)(V.FormattedMessage,{...z.s.pickADate})}),(0,w.jsx)(de.Z,{onClick:a,isBlue:!0,children:(0,w.jsx)(D.DoneMenuText,{})})]}),isTemplatePage:!1})}})}function pe(e){window.__c={n:"ValuePickerMenuDate"};const{currentSimpleFormulaValueTokens:t,onClose:o,onChange:a,contextStore:l,formulaTypecheckContextValues:s,context:c,menuProps:d}=e,p=(0,V.useIntl)(),m=(0,i.Fy)(),[g,y]=(0,n.useState)(!1),h=s.filter((e=>"date"===e.type.type)),f=(0,n.useCallback)((e=>{a({type:"simple",value:void 0!==e[0]?(0,u.YD)(e[0]):void 0})}),[a]),S=(0,n.useCallback)((e=>{f(e),o()}),[f,o]),v=(0,n.useCallback)((()=>{y(!0)}),[]),x=(0,n.useCallback)((()=>{f([]),o()}),[f,o]),b=(0,r.VK)((()=>(0,I.NY)()),[]);if(g)return(0,w.jsx)(ue,{...e,setInDatePicker:y,setCurrentTokens:f,currentSimpleFormulaValueTokens:t});const C=void 0!==(null==d?void 0:d.header)?d.header:(0,w.jsx)(E.Z,{style:{paddingBottom:0},title:p.formatMessage(z.s.genericMenuHeader)}),k=P.oA(h.map((e=>oe({currentSimpleFormulaValueTokens:t,value:e,setCurrentTokens:S,contextStore:l,action:"replace",context:c,checkType:"single"})))),M=[];if(k.length>0){const e=Boolean(C);M.push({key:"values",render:t=>(0,w.jsx)(E.Z,{topBorder:e,...t}),items:k})}const j=(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(E.Z,{topBorder:!0,children:[(0,w.jsx)(G,{icon:re.V,title:(0,w.jsx)(V.FormattedMessage,{...z.s.pickADate}),onClick:v}),b&&(0,w.jsx)(Q,{...e})]}),t.length>0&&(0,w.jsx)(E.Z,{topBorder:!0,children:(0,w.jsx)(q.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.clear}),focused:!1,onClick:x})})]});let _;_=m.isMobile?{menuType:F.og.Modal,right:(0,w.jsx)(D.DoneMenuText,{}),onClickRight:o,footer:j}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:j,disableHeaderBorder:!0};const A={..._,...d,header:m.isMobile?null:C};return(0,w.jsx)(R.Z,{...A,children:(0,w.jsx)(O.Z,{type:O.i.Vertical,initialFocus:0,sections:M})})}var me=o(68894);function ge(e){window.__c={n:"ValuePickerMenuNumber"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:a,formulaTypecheckContextValues:l,menuProps:s,onChange:c,onClose:d,value:p}=e,m=(0,V.useIntl)(),y=(0,i.Fy)(),h=l.filter((e=>"number"===e.type.type)),f=(0,n.useCallback)((e=>{c({type:"simple",value:e})}),[c]),S=(0,n.useCallback)((e=>{f(e),d()}),[f,d]),v=(0,n.useCallback)((e=>{const t=e.target.value;let o;o=""===t?void 0:[[t]],f(o)}),[f]),x=(0,n.useCallback)((e=>{const t=P.U2(e,"event.target.value");let o;o="string"==typeof t&&""!==t?[[t]]:void 0,S(o)}),[S]),b=(0,n.useCallback)((e=>{const t=void 0!==e[0]?(0,u.YD)(e[0]):void 0;S(t)}),[S]),C=(0,r.VK)((()=>(0,I.NY)()),[]),k=[],M=[...[{action:x,key:"input",render:e=>{const t=a[0],o="string"==typeof t?t:(0,g.QaF)(null==p?void 0:p.value);return(0,w.jsx)(me.ZP,{...e,focus:!0,onChange:v,onClick:void 0,value:o})}}],...P.oA(h.map((e=>oe({currentSimpleFormulaValueTokens:a,value:e,setCurrentTokens:b,contextStore:o,action:"replace",context:t,checkType:"single"}))))],j=void 0!==(null==s?void 0:s.header)?s.header:(0,w.jsx)(E.Z,{style:{paddingBottom:0},title:m.formatMessage(z.s.genericMenuHeader)});let _;k.push({key:"textbox",render:e=>(0,w.jsx)(E.Z,{...e}),items:M}),_=y.isMobile?{menuType:F.og.Modal,right:(0,w.jsx)(D.DoneMenuText,{}),onClickRight:d}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:C&&(0,w.jsx)(E.Z,{topBorder:!0,children:(0,w.jsx)(Q,{...e})}),disableHeaderBorder:!0};const A={..._,...s,header:y.isMobile?null:j};return(0,w.jsx)(R.Z,{...A,children:(0,w.jsx)(O.Z,{initialFocus:0,sections:k,type:O.i.Vertical})})}var ye=o(1302);function he(e){var t,o;window.__c={n:"ValuePickerMenuPersonArray"};const{context:a,contextStore:s,currentSimpleFormulaValueTokens:c,formulaTypecheckContextValues:d,menuProps:p,onChange:m,onClose:y,showClearButton:h,showInputMenuItem:f}=e,S=(0,i.Fy)(),v=(0,V.useIntl)(),x=(0,i.O7)(),{collectionStore:b,property:C}=a,[H,U]=(0,n.useState)(""),$=(0,r.qz)(void 0,K.Z),q=(0,k.M)(b,C),G=q(c,"first"),Y=(0,r.VK)((()=>{const e=b.getSchema()[a.property];return!(!e||!(0,l.en)(e))&&1===e.limit}),[b,a]),X=d.filter((e=>(0,j.uy)(e.type,{type:"person"}))),[J]=(0,T.r5)((async()=>{const e=H?(0,A.ZP)(H,X,(e=>e.kind===_.yp.ContextValue?e.name:"")):X,t=await Z.deps.searchActions.loader();return{valueResults:e,userResults:(await t.searchVisibleSpaceUsers({environment:x,query:H,membersOnly:!1})).map((e=>e.id)).slice(0,20)}}),[x,H,X],{debounce:B.vp}),ee=(0,n.useCallback)((()=>{U(""),$.setState({...$.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[$]),ne=(0,n.useCallback)((e=>{const t=q(e,"last");m({type:"simple",value:(0,u.iC)(t)}),ee()}),[m,ee,q]),ie=(0,r.VK)((()=>(0,I.NY)()),[]),re=P.oA(G.map(((e,t)=>(0,w.jsx)(M,{token:e,contextStore:s,disabled:!1,currentSimpleFormulaValueTokens:G,setCurrentTokens:ne,context:a},t)))),ae=(0,w.jsx)(L.Z,{focus:!S.isMobile||void 0,focusAfterAnimation:!0,format:L.U.FilterValue,tokens:re,placeholder:v.formatMessage(z.s.personSearchPlaceholder),onRemoveLastToken:()=>{ne(G.slice(0,G.length-1))},onClearButtonClick:()=>{ne([])},value:H,onChange:e=>{U(e.target.value)},dontShowBorderBottom:S.isAndroid,showClearButton:h}),le=void 0!==(null==p?void 0:p.header)?p.header:(0,w.jsx)(E.Z,{style:{paddingBottom:0},title:v.formatMessage(z.s.genericMenuHeader)});let se;se=S.isMobile?{menuType:F.og.Modal,right:(0,w.jsx)(D.DoneMenuText,{}),onClickRight:y}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:ie&&(0,w.jsx)(E.Z,{topBorder:!0,children:(0,w.jsx)(Q,{...e})}),disableHeaderBorder:!0};const ce={...se,...p,header:S.isMobile?null:le},de=Y?"single":"multi",ue=[...P.oA(((null===(t=J.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>oe({currentSimpleFormulaValueTokens:G,value:e,setCurrentTokens:ne,contextStore:s,action:"append",context:a,checkType:de,onCheckboxClick:()=>{Y&&ye.default.afterNextFlush((()=>{y()}))}})))),...P.oA(((null===(o=J.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=Boolean(G.find((t=>(0,u.S3)(t)&&(0,g.IWo)(t)&&(0,g.zEN)(t)===e))),o=(0,g.tEo)(e),n=()=>{ne(t?(0,u.Ck)(G,o):[...G,o]),Y&&ye.default.afterNextFlush((()=>{y()}))};return{key:e,render:e=>(0,w.jsx)(te,{token:o,contextStore:s,args:e,checkState:t,checkType:de,context:a,onCheckboxClick:n}),action:n}})))],pe=[];if(f){const e=Boolean(le);pe.push({key:"search-input",render:t=>(0,w.jsx)(E.Z,{...t,style:{...e&&{paddingTop:0}}}),items:[{action:()=>{},key:"input",render:()=>ae}]})}if(ue.length>0){const e=Boolean(le)||f;pe.push({key:"users",render:t=>(0,w.jsx)(E.Z,{topBorder:e,...t}),items:ue})}return(0,w.jsxs)(R.Z,{...ce,children:[J.error&&(0,w.jsx)(E.Z,{children:(0,w.jsx)(W.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.somethingWentWrong})})}),0===pe.length&&J.value&&(0,w.jsx)(E.Z,{children:(0,w.jsx)(W.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.noResults})})}),!J.value&&!J.error&&(0,w.jsx)(E.Z,{children:(0,w.jsx)(N.Z,{})}),pe.length>0&&(0,w.jsx)(O.Z,{type:O.i.Vertical,initialFocus:0,sections:pe,store:$})]})}function fe(e){window.__c={n:"ValuePickerMenuSelect"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:a,formulaTypecheckContextValues:s,isSingle:c,menuProps:d,onChange:p,onClose:m,showClearButton:g,showInputMenuItem:h,type:f}=e,S=(0,i.Fy)(),v=(0,V.useIntl)(),[x,b]=(0,n.useState)(""),C=(0,r.qz)(void 0,K.Z),k=X.NW.createChildStore(o.context.parentRecordStore,f.collection),T=(0,r.VK)((()=>k.getSchema()[f.property]),[k,f]),Z=(0,r.VK)((()=>T&&(0,l.gB)(T)?T.groups??[]:[]),[T]),B=(0,r.VK)((()=>T&&(0,l.t)(T)&&T.options||[]),[T]),N=s.filter((e=>(0,j.uy)(e.type,{type:"select",collection:f.collection,property:f.property}))),H=(0,r.VK)((()=>({valueResults:x?(0,A.ZP)(x,N,(e=>e.kind===_.yp.ContextValue?e.name:"")):N,selectResults:x?(0,A.ZP)(x,B,(e=>e.value)):B})),[x,N,B]),U=(0,n.useCallback)((()=>{b(""),C.setState({...C.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[C]),$=(0,n.useCallback)((e=>{p({type:"simple",value:c?(0,u.YD)(e[0]):(0,u.iC)(e)}),U()}),[p,U,c]),q=(0,r.VK)((()=>(0,I.NY)()),[]),G=P.oA(a.map(((e,n)=>(0,w.jsx)(M,{token:e,contextStore:o,disabled:!1,currentSimpleFormulaValueTokens:a,setCurrentTokens:$,context:t},n)))),Y=void 0!==(null==d?void 0:d.header)?d.header:(0,w.jsx)(E.Z,{style:{paddingBottom:0},title:v.formatMessage(z.s.genericMenuHeader)}),J=(0,w.jsx)(L.Z,{focus:!S.isMobile||void 0,focusAfterAnimation:!0,format:L.U.FilterValue,tokens:G,placeholder:v.formatMessage(z.s.searchPlaceHolder),onRemoveLastToken:()=>{$(a.slice(0,a.length-1))},onClearButtonClick:()=>{$([])},value:x,onChange:e=>{b(e.target.value)},dontShowBorderBottom:S.isAndroid,showClearButton:g}),ee=[];if(h){const e=Boolean(Y);ee.push({key:"search-input",render:t=>(0,w.jsx)(E.Z,{...t,style:{...e&&{paddingTop:0}}}),items:[{action:()=>{},key:"input",render:()=>J}]})}const ne=Boolean(T&&(0,l.gB)(T)),ie={automationContextValues:H.valueResults??[],onClose:m,context:t,contextStore:o,currentSimpleFormulaValueTokens:a,isSingle:c,groupOptions:Z,selectOptions:H.selectResults??[],setCurrentTokens:$},re=ne?function(e){const{automationContextValues:t,onClose:o,context:n,contextStore:i,currentSimpleFormulaValueTokens:r,isSingle:a,groupOptions:l,selectOptions:s,setCurrentTokens:c}=e,d=[],p=a?"single":"multi",m=P.oA(t.map((e=>oe({currentSimpleFormulaValueTokens:r,value:e,setCurrentTokens:c,contextStore:i,action:a?"replace":"append",context:n,checkType:p,onCheckboxClick:()=>{a&&ye.default.afterNextFlush((()=>{o()}))}}))));m.length>0&&d.push({key:"automation-variables",render:e=>(0,w.jsx)(E.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.valuesFromThisAutomation}),topBorder:!0,...e}),items:m});const g=new Map(s.map((e=>[e.id,e]))),h=l.map((e=>{const t=(e.optionIds??[]).map((e=>g.get(e))).filter(y.$K).map((e=>{const t=Boolean(r.find((t=>"string"==typeof t&&t===e.value))),l=()=>{c(a?t?[]:[e.value]:t?(0,u.Ck)(r,e.value):[...r,e.value]),a&&ye.default.afterNextFlush((()=>{o()}))};return{key:e.id,render:o=>(0,w.jsx)(te,{token:e.value,contextStore:i,args:o,checkState:t,checkType:p,context:n,onCheckboxClick:l}),action:l}}));return{key:e.id,items:t,render:t=>(0,w.jsx)(E.Z,{title:e.name,topBorder:!0,...t})}})).filter((e=>e.items.length>0));return d.push(...h),d}(ie):function(e){const{automationContextValues:t,onClose:o,context:n,contextStore:i,currentSimpleFormulaValueTokens:r,isSingle:a,selectOptions:l,setCurrentTokens:s}=e,c=[],d=a?"single":"multi",p=P.oA(t.map((e=>oe({currentSimpleFormulaValueTokens:r,value:e,setCurrentTokens:s,contextStore:i,action:a?"replace":"append",context:n,checkType:d,onCheckboxClick:()=>{a&&ye.default.afterNextFlush((()=>{o()}))}})))),m=P.oA(l.map((e=>{const t=Boolean(r.find((t=>"string"==typeof t&&t===e.value))),l=()=>{s(a?t?[]:[e.value]:t?(0,u.Ck)(r,e.value):[...r,e.value]),a&&ye.default.afterNextFlush((()=>{o()}))};return{key:e.id,render:o=>(0,w.jsx)(te,{token:e.value,contextStore:i,args:o,checkState:t,checkType:d,context:n,onCheckboxClick:l}),action:l}}))),g=[...p,...m];g.length>0&&c.push({key:"options",render:e=>(0,w.jsx)(E.Z,{topBorder:!0,...e}),items:g});return c}(ie);let ae;ee.push(...re),ae=S.isMobile?{menuType:F.og.Modal,right:(0,w.jsx)(D.DoneMenuText,{}),onClickRight:m}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,paddingTop:0,footer:q&&(0,w.jsx)(E.Z,{topBorder:!0,children:(0,w.jsx)(Q,{...e})}),disableHeaderBorder:!0};const le={...ae,...d,header:S.isMobile?null:Y};return(0,w.jsxs)(R.Z,{...le,children:[0===ee.length&&(0,w.jsx)(E.Z,{children:(0,w.jsx)(W.Z,{title:(0,w.jsx)(V.FormattedMessage,{...z.s.noResults})})}),ee.length>0&&(0,w.jsx)(O.Z,{type:O.i.Vertical,initialFocus:0,sections:ee,store:C})]})}var Se=o(65187),ve=o(43250),xe=o(28992);function be(e){window.__c={n:"ValuePickerMenuText"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:a,formulaTypecheckContextValues:l,menuProps:s,onChange:c,onClose:d,value:p,disableEmojiCommands:m,disableFormattingAndMentions:g,disableMobileActionBar:y,disableTemplateVariableMentions:h}=e,f=(0,V.useIntl)(),{isMobile:S}=(0,i.Fy)(),v=(0,U.yK)((e=>({wrap:{background:e.inputBackground,borderRadius:4,boxShadow:e.inputBoxShadow,lineHeight:"24px",padding:1,marginBlock:S?12:0},text:{maxHeight:120,overflow:"auto",padding:"4px 10px"}})),[S]),x=(0,r.VK)((()=>(0,I.NY)()),[]),b=(0,n.useMemo)((()=>l.filter((e=>"text"===e.type.type))),[l]),C=(0,n.useCallback)((e=>{c({type:"simple",value:e})}),[c]),k=(0,n.useCallback)((e=>{C(e),d()}),[C,d]),M=(0,n.useCallback)((e=>{const t=void 0!==e[0]?(0,u.YD)(e[0]):void 0;k(t)}),[k]),{store:j}=(0,I.Cl)({initialValue:null==p?void 0:p.value,onChange:C}),_=[],A=[...P.oA(b.map((e=>oe({currentSimpleFormulaValueTokens:a,value:e,setCurrentTokens:M,contextStore:o,action:"replace",context:t,checkType:"single"})))),...[{action:P.ZT,key:"input",render:e=>(0,w.jsx)(xe.Z,{...e,title:(0,w.jsx)("div",{className:ve.Wh_,style:v.wrap,children:(0,w.jsx)(Se.Z,{disableComment:!0,disabled:!1,disableEmbedMenu:!0,disableEmojiCommands:m,disableMobileActionBar:y,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableSlashCommands:!0,disableTemplateVariableMentions:h,...g?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{},onEnter:d,pasteBehavior:"inline",store:j,style:v.text})})})}]],T=void 0!==(null==s?void 0:s.header)?s.header:(0,w.jsx)(E.Z,{style:{paddingBottom:0},title:f.formatMessage(z.s.genericMenuHeader)});let Z;_.push({key:"textbox",render:e=>(0,w.jsx)(E.Z,{...e}),items:A}),Z=S?{menuType:F.og.Modal,right:(0,w.jsx)(D.DoneMenuText,{}),onClickRight:d}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:x&&(0,w.jsx)(E.Z,{topBorder:!0,children:(0,w.jsx)(Q,{...e})}),disableHeaderBorder:!0};const B={...Z,...s,header:S?null:T};return(0,w.jsx)(R.Z,{...B,children:(0,w.jsx)(O.Z,{initialFocus:0,sections:_,type:O.i.Vertical})})}function Ce(e){const{showClearButton:t,showInputMenuItem:o,type:n}=e;return"text"===n.type?(0,w.jsx)(be,{...e,type:n}):"number"===n.type?(0,w.jsx)(ge,{...e,type:n}):"checkbox"===n.type?(0,w.jsx)(ie,{...e,type:n}):"date"===n.type?(0,w.jsx)(pe,{...e,type:n}):"person_array"===n.type?(0,w.jsx)(he,{...e,showClearButton:t??!0,showInputMenuItem:o??!0,type:n}):"block_array"===n.type?(0,w.jsx)(ne,{...e,showClearButton:t??!0,showInputMenuItem:o??!0,type:n}):"select"===n.type?(0,w.jsx)(fe,{...e,showClearButton:t??!0,showInputMenuItem:o??!0,type:n,isSingle:!0}):"select_array"===n.type?(0,w.jsx)(fe,{...e,showClearButton:t??!0,showInputMenuItem:o??!0,type:n,isSingle:!1}):void(0,y.t1)(n)}},75311:(e,t,o)=>{o.d(t,{M:()=>s,_:()=>c});var n=o(67294),i=o(86628),r=o(99036),a=o(40506),l=o(97880);function s(e,t){const o=(0,i.VK)((()=>{const o=e.getSchema()[t];let n;return o&&(0,r.en)(o)&&(n=o.limit),n}),[e,t]);return(0,n.useCallback)(((e,t)=>(0,l.$K)(o)?"first"===t?e.slice(0,o):"last"===t?e.slice(-o):void(0,l.t1)(t):e),[o])}function c(e){var t;const o=null===(t=e.collectionStore.getSchema())||void 0===t?void 0:t[e.property];return o&&"date"===o.type?{dateFormat:o.date_format||a.sF,timeFormat:o.time_format||a.c_}:{dateFormat:a.sF,timeFormat:a.c_}}},30387:(e,t,o)=>{o.d(t,{s:()=>n});const n=(0,o(9291).defineMessages)({back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},valuesFromThisAutomation:{defaultMessage:"From this automation",id:"formulas.SimpleFormulaValuePicker.valuesFromThisAutomation"},pickADate:{defaultMessage:"Pick a date",id:"formulas.SimpleFormulaValuePicker.pickADate"},clear:{defaultMessage:"Clear",id:"formulas.SimpleFormulaValuePicker.clear"},unchecked:{defaultMessage:"Unchecked",id:"formulas.SimpleFormulaValuePicker.checkbox.unchecked"},checked:{defaultMessage:"Checked",id:"formulas.SimpleFormulaValuePicker.checkbox.checked"},checkboxOptions:{defaultMessage:"Checkbox options",id:"formulas.SimpleFormulaValuePicker.checkbox.sectionHeader"},searchPlaceHolder:{defaultMessage:"Select one or more options…",id:"formulas.SimpleFormulaValuePicker.select.searchPlaceholder"},selectOptionsSectionHeader:{defaultMessage:"Select an option",id:"formulas.SimpleFormulaValuePicker.select.sectionHeader"},noResults:{defaultMessage:"No results",id:"formulas.simpleValuePicker.noResults"},pageSearchPlaceholder:{defaultMessage:"Search for one or more pages…",id:"formulas.SimpleFormulaValuePicker.pages.searchPlaceholder"},pages:{defaultMessage:"Pages",id:"formulas.SimpleFormulaValuePicker.pages.sectionHeader"},somethingWentWrong:{defaultMessage:"Something went wrong.",id:"formulas.simpleValuePicker.errorMessage"},personSelect:{defaultMessage:"Select...",id:"formulas.SimpleFormulaValuePicker.chooseAValue"},personSearchPlaceholder:{defaultMessage:"Search for one or more people…",id:"formulas.SimpleFormulaValuePicker.people.searchPlaceholder"},customFormula:{defaultMessage:"Custom formula",id:"formulas.SimpleFormulaValuePicker.customFormula"},peopleInWorkspace:{defaultMessage:"People",id:"formulas.SimpleFormulaValuePicker.people.sectionHeader"},genericMenuHeader:{defaultMessage:"Set property to",id:"formulas.SimpleFormulaValuePicker.genericMenuHeader"}})},42876:(e,t,o)=>{o.d(t,{ZP:()=>K});o(57658);var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(41892),s=o(77657),c=o(82114),d=o(36591),u=o(90199),p=o(35840),m=o(55159),g=o(72126),y=o(149),h=o(97880),f=o(9291),S=o(54642),v=o(89475),x=o(12457),b=o(33929),C=o(18441),k=o(80444),w=o(30874),M=o(49085),j=o(92595);class _ extends M.default{getStateForBot(e){return this.state[e]??{channels:{},fetching:!1,lastRefreshed:0}}updateStateForBot(e,t){this.setState({...this.state,[e]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const o=this.getStateForBot(e);this.setState({...this.state,[e]:{...o,channels:{...o.channels,...t}}})}}const A=new _;(0,j.exposeDebugValue)("ExternalNotificationChannelsStore",A);const T=A;var P=o(52275),V=o(68894),I=o(68785),F=o(72495),Z=o(85893);const B=(0,f.defineMessages)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function K(e){window.__c={n:"SlackSelectChannelView"};const{currentNotificationChannel:t,onNotificationChannelSelect:o,onClose:c,onNewSlackAccountAdded:u,renderMenu:m,channelFilter:M}=e,j=(0,i.O7)(),{isMobile:_}=(0,i.Fy)(),A=(0,r.VK)((()=>w.Z.completeSlackAuthentications.state),[]),K=e.currentExternalAuthentication??g.Ps(A);n.useEffect((()=>{K&&async function(e){const{environment:t,botId:o,spaceId:n}=e,i=T.getStateForBot(o);if(i.fetching||Date.now()-i.lastRefreshed<15e3)return;let r;T.updateStateForBot(o,{fetching:!0,lastRefreshed:Date.now()});for(;;){const e=await S.getExternalNotificationChannels(t,{botId:o,spaceId:n,cursor:r});if("success"!==e.type){console.error(e.error);break}{const t={};for(const o of e.data.channels)t[o.id]=o;if(T.addChannelsForBot(o,t),r=e.data.cursor,!r)break}}T.updateStateForBot(o,{fetching:!1})}({environment:j,botId:K.id,spaceId:K.space_id})}),[j,K]);const[W,D]=n.useState(""),{loadedChannelsForAccount:E,isLoading:N}=(0,r.VK)((()=>{if(!K)return{loadedChannelsForAccount:[],isLoading:!1};const e=T.getStateForBot(K.id);return{loadedChannelsForAccount:Object.values(e.channels),isLoading:e.fetching}}),[K]),L=(0,r.VK)((()=>w.Z.integrations.state.find((e=>e.id===s.nO))),[]),z=(0,r.VK)((()=>{var e;return null===(e=k.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),H=n.useCallback((e=>{K&&o(e,K),c()}),[o,K,c]),U=(0,a.yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[]),$=n.useCallback((e=>{const{channel:o}=e;return{key:o.id,render:e=>(0,Z.jsx)(P.Z,{...e,icon:O({channel:o,styles:U.icon}),desktopIconStyle:{width:8},title:o.name,right:o.id===(null==t?void 0:t.id)&&(0,d.e)(U.icon)}),action:()=>{H(o)}}}),[H,U.icon,t]),{publicChannels:q,privateChannels:G,personalChannels:Q}=n.useMemo((()=>function(e,t){const o=[],n=[],i=[];for(const r of e)t&&!t(r)||("public"===r.type?o.push(r):"private"===r.type?n.push(r):"me"===r.type?i.push(r):(0,h.t1)(r.type));return{publicChannels:o,privateChannels:n,personalChannels:i}}(E,M)),[M,E]),Y=n.useCallback((()=>q.map((e=>({menuListItem:$({channel:e}),channelName:e.name})))),[q,$]),X=n.useCallback((()=>G.map((e=>({menuListItem:$({channel:e}),channelName:e.name})))),[G,$]),J=n.useCallback((()=>Q.map((e=>({menuListItem:$({channel:e}),channelName:e.name})))),[Q,$]),ee=n.useCallback((()=>Y().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:W}))return t})).filter(h.$K)),[Y,W]),te=n.useCallback((()=>X().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:W}))return t})).filter(h.$K)),[X,W]),oe=n.useCallback((()=>J().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:W}))return t})).filter(h.$K)),[J,W]),ne=n.useCallback((()=>{if(!K)return[];const e=[],t=ee(),o=te(),n=oe();return n.length>0&&e.push({key:"personal-channels",render:e=>(0,Z.jsx)(F.Z,{...e,title:(0,C.jg)(K).organizationName}),items:n}),t.length>0&&e.push({key:"public-channels",render:e=>(0,Z.jsx)(F.Z,{...e,topBorder:n.length>0,title:0===n.length&&(0,C.jg)(K).organizationName}),items:t}),o.length>0&&e.push({key:"private-channels",render:e=>(0,Z.jsx)(F.Z,{...e,topBorder:t.length>0,title:0===n.length&&t.length>0&&(0,C.jg)(K).organizationName}),items:o}),e}),[ee,te,oe,K]);if(!K||!L)return null;const ie=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,Z.jsx)("div",{children:(0,Z.jsx)(V.ZP,{...e,inputLeft:(0,Z.jsx)(V.f_,{icon:p.R}),inputRight:(0,Z.jsx)(x.Z,{show:N,showDelay:500,showHold:300,render:e=>e&&(0,Z.jsx)(I.Z,{style:{marginRight:2}})}),showClearButton:!0,placeholder:b.default.formatMessage(B.channelSearchPlaceholder),focusInitial:!_,value:W,onChange:e=>{D(e.target.value)}})})}],render:e=>(0,Z.jsx)(F.Z,{...e})},...ne()];return t||ie.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!z)return;const e=await v.hM({environment:j,integration:L,spaceId:z,from:"collection_view_settings"});y.x.isFail(e)||u()},render:e=>(0,Z.jsx)(P.Z,{...e,icon:(0,Z.jsx)("img",{src:l.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,Z.jsx)(f.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,Z.jsx)(F.Z,{...e,topBorder:!0})}),(0,Z.jsx)(Z.Fragment,{children:m(ie)})}function R(e){const{channelName:t,query:o}=e;return 0===o.length||t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0}function O(e){const{channel:t,styles:o}=e;return"private"===t.type?(0,u.b)(o):"me"===t.type?(0,c.p)(o):(0,m.J)(o)}},58812:(e,t,o)=>{o.d(t,{$K:()=>b,SC:()=>v,aO:()=>f,hY:()=>S,j3:()=>x});o(57658);var n=o(63362),i=o(4615),r=o(98963),a=o(97880),l=o(9291),s=o(81575),c=o(47307),d=o(9953),u=o(82530),p=o(2553),m=o(77472),g=o(54802),y=o(26136);const h=(0,l.defineMessages)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Are you sure you want to delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"}});function f(e){const{automationStore:t,collectionStore:o,environment:a,intl:l}=e,s=(0,m.mc)(a);u.createAndCommit({environment:a,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",perform:e=>{u.applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const n=y.Mz.createChildStore(o,t.pointer),s=t.getActionStores();for(const t of s){const o=t.getType();o&&p.zY({actionId:t.id,actionType:o,automationStore:n,config:t.getConfig(),environment:a,intl:l,transaction:e})}const c=C(s);d.ae({environment:a,inMemoryRecordCache:o.inMemoryRecordCache,table:r.cv,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:o.id,parent_table:o.table,properties:{name:t.getName()},space_id:o.getSpaceId(),status:"active",trigger:{id:(0,i.ZP)(),event:t.getEventConfiguration()??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:o.getSpaceShardedPointer(),type:"collection"}},type:c}}})}});const c=k({automationStore:t,collectionStore:o});n.T0(s,c)}function S(e){const{automationStore:t,collectionStore:o,environment:i}=e;u.createAndCommit({environment:i,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",perform:e=>{const n=y.Mz.createChildStore(o,t.pointer),i=t.getName(),r=n.getKeyStore("properties");d.sW({store:r,data:{name:i},transaction:e});const a=t.getActionStores(),l=C(a),s=n.getTriggerStore();if(d.sW({store:s,data:{type:l},transaction:e}),(0,g.Xd)(n)&&(0,g.Xd)(t)){const o=n.getTriggerStore().getKeyStore("event");d.sW({store:o,data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e})}const c=[];for(const t of a){const o=t.getModel();if(!o)continue;const i=y.zq.createChildStore(n,t.pointer);d.sO({store:i,value:{alive:!0,config:o.getConfig(),id:o.id,parent_id:n.id,parent_table:n.table,space_id:n.getSpaceId(),type:o.type},transaction:e}),c.push(t.id)}d.sW({store:n,data:{action_ids:c},transaction:e})}});const r=(0,m.mc)(i),a=k({automationStore:t,collectionStore:o});n.r4(r,a)}async function v(e){const{intl:t,environment:o,collectionStore:i,existingAutomationStore:r,triggerType:a,onDelete:l}=e,p=r.getNameWithDefault(t);(await c.confirmUserActionV2({message:t.formatMessage(h.automationDeleteConfirmationMessage,{automationName:p}),acceptLabel:t.formatMessage(h.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,triggerType:o,collectionStore:i,existingAutomationStore:r}=e;u.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",perform:e=>{const t=i.getFormatStore().getKeyStore("automation_ids"),o=y.Mz.createChildStore(i,r.pointer);u.applyOperation({store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:o.id}},transaction:e}),d.sW({store:o,data:{alive:!1},transaction:e})}});const a=(0,m.mc)(t),l=k({automationStore:r,collectionStore:i});n.uO(a,l),"notification_event"===o&&s.xi(t,{type:"granular",source:"collection_view_settings",collection_id:i.id})}({environment:o,triggerType:a,collectionStore:i,existingAutomationStore:r}),null==l||l())}function x(e){const{automationStore:t,collectionStore:o,environment:i}=e;u.createAndCommit({environment:i,userAction:"collectionSettingsAutomationsActions.disableAutomation",perform:e=>{const n=y.Mz.createChildStore(o,t.pointer);d.sW({store:n,data:{status:"disabled"},transaction:e})}});const r=(0,m.mc)(i),a=k({automationStore:t,collectionStore:o});n.ai(r,a)}function b(e){const{automationStore:t,collectionStore:o,environment:i}=e;u.createAndCommit({environment:i,userAction:"collectionSettingsAutomationsActions.enableAutomation",perform:e=>{const n=y.Mz.createChildStore(o,t.pointer);d.sW({store:n,data:{status:"active"},transaction:e})}});const r=(0,m.mc)(i),a=k({automationStore:t,collectionStore:o});n.Rt(r,a)}function C(e){return 1===e.length&&e[0].isType("slack_notification")?"notification_event":"event"}function k(e){const{automationStore:t,collectionStore:o}=e,n=o.getSchema(),i=t.getActionStores().map((e=>{return e.isType("slack_notification")?{type:"slack_notification"}:e.isType("update_pages")?{property_types:((null===(t=e.getConfig())||void 0===t?void 0:t.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(a.$K),type:"update_pages"}:e.isType("create_page")?{property_types:((null===(o=e.getConfig())||void 0===o?void 0:o.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(a.$K),type:"create_page"}:void 0;var t,o})).filter(a.$K),r=t.getTriggerStore().getValue(),l=[];if("event"===(null==r?void 0:r.type)||"notification_event"===(null==r?void 0:r.type)){const{pagesAdded:e,pagePropertiesEdited:t}=r.event;e&&l.push({type:"page"}),"any"===t.type?l.push({condition:"any",type:"property"}):"none"===t.type?l.push({condition:"none",type:"property"}):l.push({condition:"some",property_types:t.some.map((e=>{var t;return null===(t=n[e.property])||void 0===t?void 0:t.type})).filter(a.$K),type:"property"})}let s;if(t.isTriggerType("event")||t.isTriggerType("notification_event")){const e=t.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();e&&"collection_view"===e.type&&(s=e.pointer.id)}return{automation_actions:i,automation_id:t.id,automation_triggers:l,collection_id:o.id,collection_view_id:s}}},20776:(e,t,o)=>{o.d(t,{o:()=>l});o(67294);var n=o(24405),i=o(8848),r=o(82990),a=o(85893);function l(e){window.__c={n:"AutomationStepValueToken"};const{children:t,icon:o,shouldTruncateChildren:l}=e,s=(0,n.yK)((e=>{const t=(0,i.KR)(e,void 0);return{iconWrap:{flex:"0 0 auto"},textWrap:{...l?r.Z.textOverflowStyle:{},flex:"1 1 auto"},wrap:{backgroundColor:t.backgroundColor,borderRadius:12,color:t.textColor,display:"inline-flex",gap:4,minWidth:l?50:void 0,padding:"0 8px"}}}),[l]);return(0,a.jsxs)("span",{style:s.wrap,children:[o&&(0,a.jsx)("span",{"aria-hidden":"true",style:s.iconWrap,children:o}),(0,a.jsx)("span",{style:s.textWrap,children:t})]})}},7944:(e,t,o)=>{o.d(t,{Z:()=>gn,s:()=>pn});o(57658);var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(63362),s=o(3865),c=o(47453),d=o(37612),u=o(4615),p=o(606),m=o(98963),g=o(97880),y=o(82990),h=o(9291),f=o(5149),S=o(47307),v=o(64964),x=o(91738),b=o(55132),C=o(9139),k=o(23867),w=o(8406),M=o(71846),j=o(78140),_=o(87279),A=o(91494),T=o(14648),P=o(85893);function V(e){window.__c={n:"AutomationEventActionCreatePage"};const{automationActionMenuStore:t,automationStore:o,collectionStore:r,onClose:a,updateCurrentState:l}=e,s=(0,u.ZP)(),c=(0,i.O7)(),d=(0,T.F)({automationTriggerActionMenuStore:t,leftStyle:{flexGrow:0},onClose:a,rightStyle:{flexGrow:0},title:(0,P.jsx)(h.FormattedMessage,{defaultMessage:"Add page to…",id:"automationEventActionCreatePage.menu.title"})}),p=(0,n.useCallback)((()=>{w.tW({environment:c,eventName:"abandoned_search",sessionId:s,source:M.S.Automation})}),[c,s]);d.menuType===_.og.Popup&&(d.onClickOutside=p);const m=(0,A.X)({automationStore:o,collectionStore:r}),g=(0,n.useCallback)((e=>{l({action:{id:(0,u.ZP)(),config:{collection:{...e.pointer,spaceId:(0,k.C)(e.pointer.spaceId)},properties:["title"],values:{}},type:"create_page"},type:"update_action"}),a()}),[a,l]);return m?(0,P.jsx)(j.Z,{...d,children:(0,P.jsx)(M.Z,{context:M.S.Automation,onAccept:g,parentStore:m.context.parentRecordStore,requireEditPermissions:!0,searchSessionId:s})}):null}var I=o(43261),F=o.n(I),Z=o(39068),B=o(9999),K=o(65422),R=o(5257),O=o(52275),W=o(68894),D=o(32163),E=o(72495),N=o(49117),L=o(52821),z=o(54802),H=o(33929),U=o(44041),$=o(35057),q=o(95193);const G=(0,h.defineMessages)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search for action…"}});function Q(e){window.__c={n:"AutomationEventActionMenu"};const{availableActions:t,automationActionMenuStore:o,automationStore:l,collectionStore:c,updateCurrentState:d,onClose:u}=e,p=(0,a.Fg)(),m=(0,h.useIntl)(),{isMobile:y}=(0,i.Fy)(),f=(0,i.O7)(),[S,v]=n.useState(""),x=(0,r.VK)((()=>c.getSchema()),[c]),b=(0,z.j_)(),C=(0,r.VK)((()=>function(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),r=o.getFormat(),a=o.getSchema(),l=(0,s.cO)({collectionFormat:r,collectionSchema:a,filter:e=>{let[t]=e;return!i.has(t)}}),c=new Map,d=l.map((e=>{const t=a[e];if(t){const o=`${t.name} ${L.SO[t.type]}`;return c.set(e,o),o}})).filter(g.$K),u=new Set(F().filter(n,d).map((e=>{let{original:t}=e;return t})));return l.filter((e=>{const t=c.get(e);return t&&u.has(t)}))}({automationStore:l,collectionStore:c,searchInput:S})),[l,c,S]),k=(0,r.VK)((()=>function(e){const{availableActions:t,searchInput:o}=e;if(0===t.length)return[];const n=new Map,i=t.map((e=>{const t=H.default.formatMessage(e.display.name);return n.set(e.type,t),t})),r=new Set(F().filter(o,i).map((e=>{let{original:t}=e;return t})));return t.filter((e=>{const t=n.get(e.type);return t&&r.has(t)}))}({availableActions:t,searchInput:S})),[t,S]),w=(0,N.Rr)({environment:f}),M=(0,r.VK)((()=>!(0,$.sX)()),[]),_=0===t.length&&M,A=(0,n.useCallback)((()=>{u(),U.y(f,{for:"plus",from:"database_automation_action_item"})}),[f,u]),T=k.length>0?function(e){const{automationActionMenuStore:t,actions:o,initialSlackActionSelectMenuState:n,showTopBorder:i,theme:r}=e,a=o.map((e=>function(e){const{automationActionMenuStore:t,action:o,initialSlackActionSelectMenuState:n,theme:i}=e;if("slack_notification"===o.type)return{key:"slack_action",action:()=>{t.pushSettingsItem(n)},render:e=>(0,P.jsx)(O.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginLeft:2,marginRight:8,width:12,height:"auto"}),right:(0,R.o)({marginInlineStart:6,width:12,height:"auto"}),title:(0,P.jsx)(h.FormattedMessage,{...o.display.name})})};if("create_page"===o.type)return{key:"create_page",action:()=>{t.pushSettingsItem({actionId:void 0,type:"eventActionCreatePage"})},render:e=>(0,P.jsx)(O.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:(0,R.o)({marginInlineStart:6,width:12}),title:(0,P.jsx)(h.FormattedMessage,{...o.display.name})})};if("update_pages"===o.type)return{key:"update_pages",action:()=>{t.pushSettingsItem({actionId:void 0,automationId:"",type:"eventActionUpdatePages"})},render:e=>(0,P.jsx)(O.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:(0,R.o)({marginInlineStart:6,width:12}),title:(0,P.jsx)(h.FormattedMessage,{...o.display.name})})}}({automationActionMenuStore:t,action:e,initialSlackActionSelectMenuState:n,theme:r}))).filter(g.$K);if(0===a.length)return;return{key:"other_actions_section",items:a,render:e=>(0,P.jsx)(E.Z,{...e,topBorder:i})}}({automationActionMenuStore:o,actions:k,initialSlackActionSelectMenuState:b,theme:p}):void 0,V=C.length>0&&!M?function(e){const{automationActionMenuStore:t,properties:o,collectionSchema:n,theme:i,updateCurrentState:r,onClose:a,showTopBorder:l}=e,s=o.map((e=>function(e){const{automationActionMenuStore:t,propertyId:o,collectionSchema:n,theme:i}=e,r=n[o];if(!r)return;return{key:o,action:()=>{t.pushSettingsItem({propertyId:o,actionId:void 0,type:"eventActionProperty"})},render:e=>(0,P.jsx)(O.Z,{...e,icon:(0,P.jsx)(Z.ZP,{icon:r.icon,size:16,style:{fill:i.regularIconColor,marginRight:6},theme:i,type:r.type}),right:(0,R.o)({marginInlineStart:6,width:12,height:"auto"}),title:r.name})}}({propertyId:e,collectionSchema:n,theme:i,updateCurrentState:r,automationActionMenuStore:t,onClose:a}))).filter(g.$K);if(0===s.length)return;return{key:"page_properties_edited_section",items:s,render:e=>(0,P.jsx)(E.Z,{...e,title:(0,P.jsx)(h.FormattedMessage,{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}),topBorder:l})}}({automationActionMenuStore:o,properties:C,collectionSchema:x,showTopBorder:(0,g.$K)(T),theme:p,updateCurrentState:d,onClose:u}):void 0,I=M&&w?function(e){const{onUpsellClick:t,showTopBorder:o,theme:n}=e;return{key:"upsell_section",items:[{action:()=>t(),key:"upsell_item",render:e=>(0,P.jsx)(O.Z,{...e,icon:(0,P.jsx)("div",{style:{background:n.accentColors.yellow[50],borderRadius:4,height:20,padding:3,width:20},children:(0,K.K)({fill:n.icon.yellow,height:"100%",width:"100%"})}),right:(0,B.J)({height:"auto",marginBlockStart:2,width:12}),rightStyle:{alignSelf:"start"},caption:(0,P.jsx)(h.FormattedMessage,{defaultMessage:"Automatically set properties, create new pages, and more with automations.",id:"automationEventActionMenu.upsellSection.caption"}),title:(0,P.jsx)(h.FormattedMessage,{defaultMessage:"Upgrade for more actions",id:"automationEventActionMenu.upsellSection.title"}),shouldWrapCaption:!0})}],render:e=>(0,P.jsx)(E.Z,{...e,topBorder:o})}}({onUpsellClick:A,showTopBorder:!_,theme:p}):void 0,Q=[T,V].filter(g.$K),Y={key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,P.jsx)(O.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,P.jsx)(h.FormattedMessage,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,P.jsx)(E.Z,{...e})},X=(_?[I]:0===Q.length?[Y,I]:[...Q,I]).filter(g.$K),J=(0,q.F)({width:266,paddingBottom:2});return J.header=_?void 0:(0,P.jsx)(W.ZP,{onChange:e=>{v(e.target.value)},placeholder:m.formatMessage(G.searchInputPlaceholder),style:{marginBlock:"12px 2px"},value:S}),y||(J.maxHeight="50vh"),(0,P.jsx)(j.Z,{...J,children:(0,P.jsx)(D.Z,{type:D.i.Vertical,sections:X,initialFocus:0})})}var Y=o(10450),X=o(30823),J=o(99036),ee=o(76218),te=o(6287),oe=o(70203),ne=o(53498),ie=o(32984);const re=(0,h.defineMessages)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"}});function ae(e){var t;window.__c={n:"AutomationEventActionProperty"};const{actionId:o,automationActionMenuStore:i,automationStore:a,collectionStore:l,onClose:s,propertyId:c,updateCurrentState:d}=e,p=(0,h.useIntl)(),m=(0,A.X)({automationStore:a,collectionStore:l}),g=o??(0,u.ZP)(),f=(0,r.VK)((()=>l.getSchema()[c]),[l,c]),S=(0,n.useMemo)((()=>!!f&&("multi_select"===f.type||(0,J.en)(f)&&1!==f.limit)),[f]),v=Boolean(f&&"button"!==f.type&&"rollup"!==f.type&&"formula"!==f.type&&"text"===(0,X.vc)(f.type)),x=Boolean(f&&"button"!==f.type&&"rollup"!==f.type&&"formula"!==f.type&&"number"===(0,X.vc)(f.type)),b=Boolean(f&&"date"===f.type),C=Boolean(f&&"status"===f.type),k=(0,r.VK)((()=>{if(f)return(0,ee.qW)({table:te.v,id:l.id,spaceId:l.getSpaceId()},c,f)}),[l,f,c]),w=(0,r.VK)((()=>{const e=a.getActionStores();if(g&&e.length>0){const t=e.find((e=>e.id===g));if(t&&t.isType("update_pages"))return t.getConfigStore().getKeyStore("values").getKeyStore(c).getValue()}}),[a,g,c]),[M,j]=(0,n.useState)(w),_=(0,n.useRef)(null==w?void 0:w.value),V=(0,ee.A6)(null==M||null===(t=M.value)||void 0===t?void 0:t.value),I=(0,r.VK)((()=>{if(!m)return[];return m.context.automationStore.getActionIds().some((e=>e===g))?m.getContextValuesForAction(g):m.getAllContextValues()}),[m,g]),F=(0,n.useCallback)((e=>{d({action:{id:g,config:{properties:[c],target:{id:(0,Y.J0)(),type:"variable"},values:{[c]:{action:"replace",value:e}}},type:"update_pages"},type:"update_action"})}),[g,c,d]),Z=(0,n.useCallback)((()=>{F(_.current),s()}),[F,s]),B=(0,n.useCallback)((e=>{if(_.current=e,v||x||S)j({action:"replace",value:e});else if(b){const t=(0,ee.A6)(null==e?void 0:e.value);0===t.length?Z():(0,ee.S3)(t[0])&&(0,oe.fpG)(t[0])&&j({action:"replace",value:e})}}),[b,v,x,S,Z]),K=(0,T.F)({automationTriggerActionMenuStore:i,leftStyle:{flexGrow:0},onClose:Z,onDone:S||v||x?Z:void 0,rightStyle:{flexGrow:0},title:(0,P.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:p.formatMessage(re.menuHeaderTitle,{propertyName:(0,P.jsx)("div",{style:{...y.Z.textOverflowStyle},children:(null==f?void 0:f.name)??""})})}),titleStyle:{minWidth:0}});if(!f||!k||!m)return null;const R={type:"collection",collectionStore:l,property:c},O=(0,ie.li)(f.type);return(0,P.jsx)(ne.a,{context:R,contextStore:m,currentSimpleFormulaValueTokens:V,disabled:!1,formulaTypecheckContextValues:I,menuProps:K,onChange:B,onClose:Z,showClearButton:!C,type:k,value:null==M?void 0:M.value,...O})}var le=o(28751),se=o(8808);function ce(e){window.__c={n:"AutomationEventActionUpdatePagesMenu"};const{actionId:t,automationActionMenuStore:o,automationStore:i,collectionStore:r,onClose:a,updateCurrentState:l}=e,s=(0,le.z)("update_pages"),c=(0,A.X)({automationStore:i,collectionStore:r}),d=(0,T.F)({automationTriggerActionMenuStore:o,leftStyle:{flexGrow:0},onClose:a,rightStyle:{flexGrow:0},title:(0,P.jsx)(h.FormattedMessage,{...s.display.name})}),p=(0,n.useCallback)((e=>{l({action:{id:(0,u.ZP)(),config:{properties:[],target:e,values:{}},type:"update_pages"},type:"update_action"}),a()}),[a,l]);return c?(0,P.jsx)(j.Z,{...d,children:(0,P.jsx)(se.H,{actionId:t,automationContextStore:c,onChange:p,onClose:a,skipPages:!0})}):null}var de=o(42876);function ue(e){var t;window.__c={n:"AutomationSlackSelectChannelView"};const{automationActionMenuStore:o,updateCurrentAutomationState:i,onClose:r}=e,a="selectChannelUpdate"===e.type?null===(t=e.actionStore)||void 0===t?void 0:t.id:void 0,l=n.useCallback(((e,t)=>{i({type:"update_action",action:{id:a??(0,u.ZP)(),type:"slack_notification",config:{target:e,external_bot_id:t.parent_id}}}),r()}),[a,r,i]),s=(0,n.useCallback)((()=>{const e=o.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?o.popSettingsItem():o.replaceSettingsItem({type:"selectWorkspace"}))}),[o]);return(0,P.jsx)(de.ZP,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannel:"selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,g.t1)(e),onClose:r,onNotificationChannelSelect:l,onNewSlackAccountAdded:s,renderMenu:e=>(0,P.jsx)(T.Z,{type:"default",automationTriggerActionMenuStore:o,headerTitle:(0,P.jsx)(h.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:r})})}function pe(e){window.__c={n:"AutomationActionMenuController"};const{automationStore:t,collectionStore:o,initialState:i,updateCurrentAutomationState:a,buttonPopupParent:l}=e,s=(0,r.VK)((()=>{const e=new x.H0;return e.setState({insertionPoint:void 0,stack:[i]}),e}),[i]),c=(0,r.VK)((()=>s.getCurrentTab()),[s]),d=(0,n.useCallback)((()=>l.close()),[l]);if(!c)return null;if("connectToSlackDefault"===c.type)return(0,P.jsx)(b.Z,{type:"connectToSlackDefault",automationActionMenuStore:s,onClose:d});if("connectToSlackReconnect"===c.type)return(0,P.jsx)(b.Z,{type:"connectToSlackReconnect",externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,automationActionMenuStore:s,onClose:d});if("selectWorkspace"===c.type)return(0,P.jsx)(C.Z,{automationActionMenuStore:s,onClose:d});if("selectChannelNew"===c.type)return(0,P.jsx)(ue,{type:"selectChannelNew",updateCurrentAutomationState:a,currentExternalAuthentication:c.currentExternalAuthentication,automationActionMenuStore:s,onClose:d});if("selectChannelUpdate"===c.type)return(0,P.jsx)(ue,{type:"selectChannelUpdate",updateCurrentAutomationState:a,actionStore:c.actionStore,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,automationActionMenuStore:s,onClose:d});if("eventActions"===c.type)return(0,P.jsx)(Q,{availableActions:c.availableActions,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,updateCurrentState:a});if("eventActionProperty"===c.type){const{propertyId:e,actionId:n}=c;return(0,P.jsx)(ae,{actionId:n,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,propertyId:e,updateCurrentState:a})}return"eventActionCreatePage"===c.type?(0,P.jsx)(V,{automationStore:t,automationActionMenuStore:s,collectionStore:o,onClose:d,updateCurrentState:a}):"eventActionUpdatePages"===c.type?(0,P.jsx)(ce,{actionId:c.actionId,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,updateCurrentState:a}):(0,g.t1)(c)}var me=o(31945),ge=o(35294),ye=o(28607);function he(e){window.__c={n:"AutomationActionSelectButton"};const{automationStore:t,initialState:o,updateCurrentAutomationState:n,collectionStore:i}=e,r=(0,ge.d)();return i?(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.Center,placementToOrigin:me.pO.Bottom,popupType:r,render:e=>(0,P.jsx)(pe,{automationStore:t,buttonPopupParent:e,collectionStore:i,initialState:o,updateCurrentAutomationState:n}),renderOrigin:e=>(0,P.jsx)(fe,{...e})}):(0,P.jsx)(fe,{onClick:()=>{}})}function fe(e){return(0,P.jsx)(ye.D,{...e,icon:(0,c.R)({height:24,width:12}),title:(0,P.jsx)(h.FormattedMessage,{...pn.addActionLabel})})}var Se=o(76205),ve=o(36591),xe=o(54497),be=o(72126),Ce=o(73657),ke=o(42917),we=o(1136),Me=o(45669),je=o(40721),_e=o(31278),Ae=o(26388),Te=o(78316),Pe=o(37034),Ve=o(61766),Ie=o(26136);function Fe(e){window.__c={n:"AutomationCollectionSelectMenu"};const{selectedSourcePointer:t,collectionContextStore:o,onSelect:l,disabled:s}=e,{isMobile:c}=(0,i.Fy)(),d=(0,h.useIntl)(),u=(0,i.O7)(),[p,m]=n.useState(""),y=(0,r.VK)((()=>o.collectionStore()),[o]),f=(0,r.VK)((()=>o.collectionViewBlockStore()),[o]),S=(0,r.VK)((()=>f&&y?f.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===y.id})):[]),[f,y]),v=(0,r.VK)((()=>{if(!y)return[];let e;t&&"collection_view"===t.table&&(e=Ie.Xr.createChildStore(y,t));return be.mN([...S,e].filter(g.$K),(e=>{let{id:t}=e;return t})).filter((e=>(0,Te.D)(e,p)))}),[y,S,p,t]),x=(0,r.VK)((()=>{if(y&&(0,L.r_)({collectionStore:y,environment:u,intl:d,queryForFilter:p}))return function(e){const{collectionStore:t,environment:o,selectedSourcePointer:n,onSelect:i,isMobile:r,intl:a}=e,l=t.getIcon(),s=(0,Pe.vU)({environment:o,intl:a,store:t}),c=n&&"collection"===n.table&&n.id===t.id,d=t.getSpaceShardedPointer();return{key:"collection",items:[{key:t.id,action:()=>{d&&i(d)},render:e=>(0,P.jsx)(O.Z,{...e,icon:l&&(0,P.jsx)(_e.Z,{isEmptyPage:!1,size:r?18:16,disabled:!0,icon:l}),title:s,caption:(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Any page in this database",values:{collectionName:s}}),right:c&&(0,ve.e)({width:12,height:"auto"})})}],render:e=>(0,P.jsx)(E.Z,{...e,topBorder:!0})}}({collectionStore:y,environment:u,selectedSourcePointer:t,onSelect:l,isMobile:c,intl:d})}),[y,u,d,c,l,p,t]),b=function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>(0,P.jsx)(E.Z,{...e,topBorder:!0})}}({menuListItems:(0,r.VK)((()=>y&&f&&S?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:n,selectedSourcePointer:i,onSelect:r,intl:a}=e,l=n.getSchema();return[...o.map((e=>{const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const s=i&&"collection_view"===i.table&&i.id===o.id,c=(0,z.rU)({collectionViewStore:e,collectionSchema:l}),d=(0,g.$K)(c),u=e.getType(),p=e.getFormat().collection_view_icon,m=e.getName(),y=(o,n)=>(0,P.jsx)(O.Z,{...o,...n,icon:(0,P.jsx)(we.F,{color:"lightGray",viewType:u,viewIcon:p}),title:(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},children:[(0,P.jsx)(Me.Z,{collectionViewType:u,collectionViewName:m}),d&&s&&(0,xe.t)({width:16,height:"auto"})]}),caption:(0,P.jsx)(Be,{blockStore:t,collectionViewStore:e,intl:a,collectionSchema:l,referencesIncompatibleProperties:d}),right:s&&(0,ve.e)({width:12,height:"auto"}),disabled:d,disabledFeedback:d});let f;if(d&&c){var n;const e=null===(n=l[c])||void 0===n?void 0:n.type,t=e?L.SO[e]:void 0,o=t?(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",values:{propertyTypeName:t}}):(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported"});f=e=>(0,P.jsx)(Ae.ZP,{placement:Ae.ug.Right,renderTooltip:()=>o,render:t=>y(e,t)})}else f=y;return{key:e.id,action:()=>{r(o)},render:f}}}))].filter(g.$K)}({blockStore:f,collectionStore:y,filteredCollectionViewStores:v,selectedSourcePointer:t,onSelect:l,intl:d}):[]),[f,y,S,v,d,l,t])}),C={key:"search",items:[{key:"search_item",action:()=>{},render:()=>(0,P.jsx)(W.ZP,{value:p,focus:!0,style:M.searchBar,textWrapperStyle:M.searchText,onChange:e=>m(e.target.value),placeholder:d.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})})}],render:e=>(0,P.jsx)(E.Z,{...e})};let k;(0,g.$K)(x)||(0,g.$K)(b)||(k={key:"no-results-section",items:[{key:"no-results-item",action:be.ZT,render:()=>(0,P.jsx)(Ce.Z,{caption:(0,P.jsx)(h.FormattedMessage,{defaultMessage:"No results",id:"collectionViewSelect.noResults.title"})})}],render:e=>(0,P.jsx)(E.Z,{...e,topBorder:!0})});const w=[C,x,b,k].filter(g.$K),M=function(e){return(0,a.yK)((t=>({button:{marginTop:8},buttonPopup:{width:e?void 0:230},searchBar:{marginTop:8,marginBottom:8},searchText:{marginLeft:8,marginRight:8},buttonRight:{color:t.selectLightGray[500]},menuItemTextWrapper:{...e?{marginLeft:12}:{},minWidth:"auto"}})),[e])}(c),A=(0,r.qz)(void 0,Ve.Z),T=(0,ge.d)();if(!y)return null;const V=(0,P.jsx)(Ze,{pointer:t,collectionStore:y,intl:d});return(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.End,placementToOrigin:me.pO.Bottom,popupType:T,style:M.buttonPopup,buttonPopupStore:A,render:e=>{let t;return t=c?{menuType:_.og.Modal,title:(0,P.jsx)(h.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),right:(0,P.jsx)(je.DoneMenuText,{}),onClickRight:()=>{e.close()}}:{menuType:_.og.Popup,width:230,maxHeight:"50vh"},(0,P.jsx)(j.Z,{...t,children:(0,P.jsx)(D.Z,{type:D.i.Vertical,sections:w,initialFocus:0,onAccept:()=>{e.close()}})})},renderOrigin:e=>(0,P.jsx)(ke.Z,{title:(0,P.jsx)(h.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),showChevron:!0,right:V,rightStyle:{flexShrink:1},rotateChevron:A.state.open,disabled:s,textWrapperStyle:M.menuItemTextWrapper,...e})})}function Ze(e){window.__c={n:"AutomationSourceCaption"};const{pointer:t,collectionStore:o,intl:n}=e,l=(0,i.O7)(),s=(0,a.yK)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,flex:"1 1 auto",minWidth:0},title:{...y.Z.textOverflowStyle},errorText:{color:e.errorText,fontWeight:y.Z.fontWeight.medium}})),[]),c=(0,r.VK)((()=>t?Ie.t1.createChildStore(o,t):void 0),[o,t]),d=(0,r.VK)((()=>c?(0,Pe.vU)({environment:l,intl:n,store:c}):(0,P.jsx)("span",{style:s.errorText,children:(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.source.missing",defaultMessage:"Select database"})})),[l,n,s.errorText,c]),u=(0,r.VK)((()=>{if(!c||c.table===te.v)return!1;const e=o.getSchema();return(0,g.$K)((0,z.rU)({collectionViewStore:c,collectionSchema:e}))}),[o,c]);return(0,P.jsxs)("div",{style:s.titleContainer,children:[u&&(0,xe.t)(s.warningIcon),(0,P.jsx)("span",{style:s.title,children:d})]})}function Be(e){window.__c={n:"CollectionViewCaption"};const{blockStore:t,collectionViewStore:o,intl:n,collectionSchema:a,referencesIncompatibleProperties:l}=e,s=(0,i.O7)(),c=(0,r.VK)((()=>!o.getAlive()),[o]),d=(0,r.VK)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,Pe.vU)({environment:s,intl:n,store:e}):void 0}),[t.id,o,n,s]),u=(0,r.VK)((()=>{const e=o.getQuery(a);return(0,Se.OH)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:a}).reduce(((e,t)=>{if((0,Se.aN)(t))return e+1;return e+(t.filters??[]).length}),0)}),[a,o]);return l?(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported"}):c?(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",values:{emphasis:e=>(0,P.jsx)("em",{children:e})}}):d?(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",values:{emphasis:e=>(0,P.jsx)("em",{children:e}),externalParentBlockName:d}}):0===u?(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in this view"}):(0,P.jsx)(h.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:u}})}var Ke=o(27681),Re=o(25651),Oe=o(4023),We=o(56812),De=o(84619),Ee=o(64973);function Ne(e){window.__c={n:"DeletedPropertyStep"};const{propertyId:t,disabled:o,collectionStore:n,onClick:i}=e,l=(0,a.Fg)(),s="light"===l.mode?50:200,c="light"===l.mode?700:900,d=(0,a.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]}}}),[]),u=(0,r.VK)((()=>n.getDeletedSchema()[t]),[n,t]);return(0,P.jsx)(Ee.pW,{disabled:o,icon:e=>(0,xe.t)({...e,...d.warning}),title:(0,P.jsx)(De.ZP,{format:De.lo.Medium,value:(0,P.jsx)(h.FormattedMessage,{id:"deletedPropertyStep.deletedProperty.title",defaultMessage:"{propertyName} property deleted",values:{propertyName:null==u?void 0:u.name}}),theme:l,isSingle:!0,backgroundColor:l.accentColors.yellow[s],color:l.accentColors.yellow[c]}),onClick:i})}var Le=o(29804),ze=o(55863);function He(e){window.__c={n:"AutomationDeletedPropertyMenu"};const{stepType:t,onDelete:o,onViewDeletedProperties:n}=e,r=(0,q.F)({width:266}),l=(0,i.Fy)().isMobile,s=(0,a.yK)((e=>({icon:{width:l?"12px":"16px",height:"auto",color:e.accentColors.gray[600]},content:{fontSize:"14px",fontWeight:400}})),[l]);return(0,P.jsx)(j.Z,{...r,children:(0,P.jsx)(D.Z,{type:D.i.Vertical,sections:[{key:"actions-section",items:[{key:"view-deleted-properties",action:()=>{n()},render:e=>(0,P.jsx)(O.Z,{...e,title:(0,P.jsx)("span",{style:s.content,children:(0,P.jsx)(h.FormattedMessage,{id:"automationDeletedPropertyMenu.viewDeletedProperties.title",defaultMessage:"View deleted properties"})}),icon:(0,ze.s)(s.icon)})},{key:"delete-action",action:()=>{o()},render:e=>(0,P.jsx)(O.Z,{...e,title:(0,P.jsx)("span",{style:s.content,children:"action"===t?(0,P.jsx)(h.FormattedMessage,{id:"automationDeletedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,P.jsx)(h.FormattedMessage,{id:"automationDeletedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})}),icon:(0,d.y)(s.icon)})}],render:e=>(0,P.jsx)(E.Z,{...e})}],initialFocus:0})})}var Ue=o(93060);const $e=(0,h.defineMessages)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search for trigger…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property"}});function qe(e){window.__c={n:"AutomationEventTriggerMenu"};const{automationStore:t,automationTriggerMenuStore:o,collectionStore:i,updateCurrentState:l,onClose:d}=e,u=(0,a.Fg)(),p=(0,h.useIntl)(),[m,y]=n.useState(""),f=(0,r.VK)((()=>i.getSchema()),[i]),v=(0,r.VK)((()=>t.getTrigger()),[t]),x=(0,r.VK)((()=>("event"===(null==v?void 0:v.type)||"notification_event"===(null==v?void 0:v.type))&&v.event.pagesAdded),[v]),b=(0,r.VK)((()=>(0,s._X)({collectionFormat:i.getFormat(),collectionSchema:f})),[i,f]),C=(0,z.EF)({collectionSchema:f,propertyIds:b,searchTerm:m}),k=(0,a.yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),w=(0,q.F)({maxHeight:"50vh",width:266}),M=(0,P.jsx)(W.ZP,{focus:!0,style:{marginTop:12,marginBottom:6},value:m,onChange:e=>{y(e.target.value)},placeholder:p.formatMessage($e.searchInputPlaceholder)}),_=x?void 0:function(e){const{intl:t,searchInput:o,updateCurrentState:n,onClose:i,styles:r}=e,a=t.formatMessage($e.pageAddedCopy);if(!F().test(o,a))return;return{key:"page_added_section",items:[{key:"page_added",action:()=>{n({type:"update_trigger",trigger:{type:"page_added"}}),i()},render:e=>(0,P.jsx)(O.Z,{...e,icon:(0,c.R)(r.propertyIcon),title:a})}],render:e=>(0,P.jsx)(E.Z,{...e})}}({intl:p,searchInput:m,updateCurrentState:l,onClose:d,styles:k}),A=(0,r.VK)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:n,properties:i,collectionSchema:r,theme:a,updateCurrentState:l,onClose:c,intl:d,searchInput:u,styles:p}=e,m=d.formatMessage($e.pagePropertiesEditedCopy);let y=!1,f=[];"event"!==(null==t?void 0:t.type)&&"notification_event"!==(null==t?void 0:t.type)||(y="any"===t.event.pagePropertiesEdited.type,f="some"===t.event.pagePropertiesEdited.type?t.event.pagePropertiesEdited.some:[]);const v=[y||!F().test(u,m)?void 0:{key:"any_property_edited",action:async()=>{await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await S.confirmUserAction({message:(0,P.jsx)(h.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,P.jsx)(h.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,P.jsx)(h.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})})}({hasSpecificPropertyChangedFilters:f.length>0})&&(l({type:"update_trigger",trigger:{type:"any_page_property_edited"}}),c())},render:e=>(0,P.jsx)(O.Z,{...e,icon:(0,Re.R)(p.propertyIcon),title:m})},...i.map((e=>{if(!f.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:n,theme:i,updateCurrentState:r,onClose:a}=e,l=n[o];if(!l)return;const c=(0,s.bD)(l);return{key:o,action:()=>{c?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(r({type:"update_trigger",trigger:{type:"property_changed",property:o,filter:{operator:"changes_to_any"}}}),a())},render:e=>(0,P.jsx)(O.Z,{...e,icon:(0,P.jsx)(Z.ZP,{icon:l.icon,type:l.type,size:16,theme:i}),title:l.name,right:c?(0,R.o)({marginLeft:6,width:12,height:"auto"}):void 0})}}({propertyId:e,collectionSchema:r,theme:a,updateCurrentState:l,automationTriggerMenuStore:o,onClose:c})})).filter(g.$K)].filter(g.$K);if(0===v.length)return;return{key:"page_properties_edited_section",items:v,render:e=>(0,P.jsx)(E.Z,{...e,topBorder:n,title:(0,P.jsx)(h.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property edited"})})}}({automationTriggerValue:v,automationTriggerMenuStore:o,showTopBorder:Boolean(_),properties:C,collectionSchema:f,theme:u,updateCurrentState:l,onClose:d,searchInput:m,intl:p,styles:k})),[v,o,_,C,f,u,l,d,m,p,k]),T=n.useMemo((()=>{const e=[_,A].filter(g.$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,P.jsx)(O.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,P.jsx)(h.FormattedMessage,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,P.jsx)(E.Z,{...e})}]:e}),[_,A]);return(0,P.jsx)(j.Z,{...w,header:M,children:(0,P.jsx)(D.Z,{type:D.i.Vertical,sections:T,initialFocus:0})})}function Ge(e){window.__c={n:"AutomationCheckboxPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:i,propertySchema:a,propertyChangedFilter:l,onClose:s}=e,c=(0,r.VK)((()=>"changes_to_any"===l.operator?[{type:"exact",value:!0},{type:"exact",value:!1}]:(0,Se.XA)(l)&&(0,Se.vR)(l)?Array.isArray(l.value)?l.value:[l.value]:[]),[l]),[d,u]=(0,n.useState)(c),p=(0,n.useMemo)((()=>1===d.length?{operator:"checkbox_is",value:d[0]}:{operator:"changes_to_any"}),[d]),m=(0,n.useMemo)((()=>2===d.length||1===d.length&&"partial"),[d]),g=(0,n.useCallback)((e=>{const t=Boolean(d.find((t=>t.value===e)));u(t?d.filter((t=>t.value!==e)):[...d,{type:"exact",value:e}])}),[d]),y=(0,n.useCallback)((()=>{(0,z.WM)({anyOptionCheckState:m,propertyId:t,updateCurrentState:o,currentFilter:p}),s()}),[m,p,s,t,o]),f=Boolean(d.find((e=>!0===e.value))),S=Boolean(d.find((e=>!1===e.value)));return(0,P.jsx)(T.Z,{type:"default",automationTriggerActionMenuStore:i,onDone:y,onClose:s,sections:[{key:"select",render:e=>(0,P.jsx)(E.Z,{...e,topBorder:!0}),items:[{key:"unchecked",render:e=>(0,P.jsx)(O.Z,{...e,checkState:S,isTokenTitle:!0,title:(0,P.jsx)(h.FormattedMessage,{defaultMessage:"Unchecked",id:"automations.propertyTrigger.checkbox.unchecked"})}),action:()=>g(!1)},{key:"checked",render:e=>(0,P.jsx)(O.Z,{...e,checkState:f,isTokenTitle:!0,title:(0,P.jsx)(h.FormattedMessage,{defaultMessage:"Checked",id:"automations.propertyTrigger.checkbox.checked"})}),action:()=>g(!0)}]}],headerTitle:(0,P.jsx)(h.FormattedMessage,{id:"automations.propertyTrigger.checkbox.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}var Qe=o(80951),Ye=o(56416),Xe=o(60458),Je=o(22084),et=o(47082);function tt(e){window.__c={n:"AutomationSelectPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:a,propertySchema:l,propertyChangedFilter:s,onClose:c}=e,{isMobile:d,isAndroid:u}=(0,i.Fy)(),p=(0,h.useIntl)(),m=(0,r.VK)((()=>{if("changes_to_any"===s.operator){return(l.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,Se.dx)(s)&&!(0,Se.NU)(s))return[];if((0,Se.vR)(s)){const e=(l.options??[]).map((e=>e.value));return(Array.isArray(s.value)?s.value:[s.value]).filter((t=>(0,g.$K)(t.value)&&e.includes(t.value)))}return[]}),[l,s]),[y,f]=n.useState(m),S=(0,r.VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let n=!1,i=!0;const r=t.options??[];for(const a of r){const e=o.some((e=>e.value===a.value));n||=e,i&&=e}return!!i||!!n&&"partial"}({propertySchema:l,selectedOptions:y})),[l,y]),v=n.useMemo((()=>(l.options??[]).map((e=>({type:"exact",value:e.value})))),[l]),x=n.useMemo((()=>"multi_select"===l.type?{operator:"enum_contains",value:y}:"select"===l.type?{operator:"enum_is",value:y}:(0,g.t1)(l)),[l,y]),b=!0===S?[]:y.map((e=>{if(!e.value||!l.options)return;const t=(0,Qe.i7)(l.options,e.value);return t?(0,P.jsx)(Je.a,{format:d?De.lo.Large:De.lo.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=be.zu(y,e);f(t)}},t.id):void 0})),[C,k]=n.useState(""),w=(0,Ye.I4)({query:C,propertySchema:l,selectedValues:y,updateValue:e=>{k(""),f(e)},isMobile:d,styles:{}}),M=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,P.jsx)(et.Z,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:et.U.FilterValue,tokens:b,placeholder:S?p.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):p.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=y.slice(0,y.length-1);f(e)},onClearButtonClick:()=>{f([]),c()},value:C,onChange:e=>{k(e.target.value)},dontShowBorderBottom:u,showClearButton:!0})}],render:e=>(0,P.jsx)(E.Z,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===S?f([]):!1===S||"partial"===S?f(v):(0,g.t1)(S),k("")},render:e=>(0,P.jsx)(O.Z,{...e,icon:(0,P.jsx)(Xe.Z,{checked:S,size:14,onClick:e.onClick}),title:(0,P.jsx)(h.FormattedMessage,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,P.jsx)(E.Z,{...e,topBorder:!0})},w.length>0?{key:"items",items:w,render:e=>(0,P.jsx)(E.Z,{...e,topBorder:!0})}:void 0].filter(g.$K);return(0,P.jsx)(T.Z,{type:"default",automationTriggerActionMenuStore:a,onDone:()=>{(0,z.WM)({anyOptionCheckState:S,propertyId:t,updateCurrentState:o,currentFilter:x}),c()},onClose:c,sections:M,headerTitle:(0,P.jsx)(h.FormattedMessage,{id:"automations.propertyChangedFilterHeader.select.title",defaultMessage:"{propertyName} set to",values:{propertyName:l.name}})})}var ot=o(11299),nt=o(97004);function it(e){window.__c={n:"AutomationStatusPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:a,propertySchema:l,propertyChangedFilter:s,onClose:c}=e,{isMobile:d}=(0,i.Fy)(),u=(0,r.VK)((()=>{if("changes_to_any"===s.operator){return(l.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,Se.r2)(s)&&(0,Se.vR)(s)?(0,Se.wB)(s):[]}),[l,s]),[p,m]=n.useState(u),y=(0,r.VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,n=t.groups??[],i=t.options??[],r=n.map((e=>(0,nt.IX)({group:e,options:i,filterValues:o}))),a=r.every((e=>!0===e.groupCheckState)),l=r.some((e=>!1!==e.groupCheckState));return!!a||!!l&&"partial"}({propertySchema:l,selectedStatusOptions:p})),[l,p]),f=n.useMemo((()=>(l.groups??[]).map((e=>({type:"is_group",value:e.name})))),[l]),S=(0,ot.S)({propertySchema:l,statusFilterValues:p,updateValue:e=>{m(e)},isMobile:d,styles:{},visibleOptions:l.options??[]});return(0,P.jsx)(T.Z,{type:"default",automationTriggerActionMenuStore:a,onDone:()=>{(0,z.WM)({anyOptionCheckState:y,propertyId:t,updateCurrentState:o,currentFilter:{operator:"status_is",value:p}}),c()},onClose:()=>{c()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===y?m([]):!1===y||"partial"===y?m(f):(0,g.t1)(y)},render:e=>(0,P.jsx)(O.Z,{...e,icon:(0,P.jsx)(Xe.Z,{checked:y,size:14,onClick:e.onClick}),title:(0,P.jsx)(h.FormattedMessage,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,P.jsx)(E.Z,{...e})},{key:"items",items:S,render:e=>(0,P.jsx)(E.Z,{...e,topBorder:!0})}],headerTitle:(0,P.jsx)(h.FormattedMessage,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:l.name}})})}function rt(e){window.__c={n:"AutomationEventTriggerPropertyChangedFilterMenu"};const{automationStore:t,propertyId:o,automationTriggerMenuStore:n,collectionStore:i,updateCurrentState:a,onClose:l}=e,c=(0,r.VK)((()=>i.getSchema()),[i])[o],d=(0,r.VK)((()=>t.getTrigger()),[t]);let u=[];"event"!==(null==d?void 0:d.type)&&"notification_event"!==(null==d?void 0:d.type)||(u="some"===d.event.pagePropertiesEdited.type?d.event.pagePropertiesEdited.some:[]);const p=u.find((e=>e.property===o))??{property:o,filter:{operator:"changes_to_any"}};if(!c)return null;return(0,s.bD)(c)?"multi_select"===c.type||"select"===c.type?(0,P.jsx)(tt,{propertyId:o,updateCurrentState:a,automationTriggerMenuStore:n,propertySchema:c,propertyChangedFilter:p.filter,onClose:l}):"status"===c.type?(0,P.jsx)(it,{propertyId:o,updateCurrentState:a,automationTriggerMenuStore:n,propertySchema:c,propertyChangedFilter:p.filter,onClose:l}):"checkbox"===c.type?(0,P.jsx)(Ge,{automationTriggerMenuStore:n,onClose:l,propertyChangedFilter:p.filter,propertyId:o,propertySchema:c,updateCurrentState:a}):null:null}function at(e){window.__c={n:"AutomationTriggerMenuController"};const{automationStore:t,collectionStore:o,initialState:i,updateCurrentAutomationState:a,buttonPopupParent:l}=e,s=(0,r.VK)((()=>{const e=new x.Bh;return e.setState({insertionPoint:void 0,stack:[i]}),e}),[i]),c=(0,r.VK)((()=>s.getCurrentTab()),[s]),d=(0,n.useCallback)((()=>l.close()),[l]);return c?"eventTriggers"===c.type?(0,P.jsx)(qe,{automationStore:t,automationTriggerMenuStore:s,collectionStore:o,updateCurrentState:a,onClose:d}):"propertyChangedFilter"===c.type?(0,P.jsx)(rt,{automationStore:t,propertyId:c.property,automationTriggerMenuStore:s,collectionStore:o,updateCurrentState:a,onClose:d}):(0,g.t1)(c):null}var lt=o(50780);function st(e){window.__c={n:"AutomationUnsupportedPropertyMenu"};const{stepType:t,onDelete:o,onViewEditProperty:n,propertyId:r,propertySchema:l}=e,s=(0,q.F)({width:266}),c=(0,i.Fy)().isMobile,u=(0,a.yK)((e=>({icon:{width:c?"12px":"16px",height:"auto",color:e.accentColors.gray[600]},content:{fontSize:"14px",fontWeight:400}})),[c]);return(0,P.jsx)(j.Z,{...s,children:(0,P.jsx)(D.Z,{type:D.i.Vertical,sections:[{key:"actions-section",items:[{key:"view-edit-property",action:()=>n(r),render:e=>(0,P.jsx)(O.Z,{...e,title:(0,P.jsx)("span",{style:u.content,children:(0,P.jsx)(h.FormattedMessage,{defaultMessage:"Edit {propertyName}",id:"automationUnsupportedPropertyMenu.viewDeletedProperties.title",values:{propertyName:l.name}})}),icon:(0,lt.E)(u.icon)})},{key:"delete-action",action:()=>o(),render:e=>(0,P.jsx)(O.Z,{...e,title:(0,P.jsx)("span",{style:u.content,children:"action"===t?(0,P.jsx)(h.FormattedMessage,{id:"automationUnsupportedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,P.jsx)(h.FormattedMessage,{id:"automationUnsupportedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})}),icon:(0,d.y)(u.icon)})}],render:e=>(0,P.jsx)(E.Z,{...e})}],initialFocus:0})})}function ct(e){window.__c={n:"AutomationAnyEditPropertyTrigger"};const{disabled:t,onDelete:o,onClick:i,propertySchema:r,onEdit:l}=e,s=(0,h.useIntl)(),c=(0,a.Fg)(),d=(0,a.yK)((()=>({propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold},wrap:{display:"inline-flex",width:"100%"}})),[]),u=(0,P.jsx)("span",{style:d.propertyName,children:r.name}),p=(0,We.$G)(s,{propertyName:u}),m=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:t,onClick:i,icon:e=>(0,P.jsx)(Z.ZP,{size:16,theme:c,icon:r.icon,style:e,type:r.type}),title:(0,P.jsx)("span",{style:d.wrap,children:p}),onEdit:l,onDelete:o})),[t,i,o,l,r.icon,r.type,d.wrap,c,p]);return(0,P.jsx)(Ue.y,{renderOrigin:m,title:p,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left})}var dt=o(20239);function ut(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;if("changes_to_any"===t.operator)return(0,P.jsx)(ct,{disabled:r,propertySchema:o,onClick:n,onEdit:n,onDelete:i});{const e={filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r};return(0,P.jsx)(pt,{...e})}}function pt(e){window.__c={n:"ParametrizableCheckboxPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:l}=e,s=(0,h.useIntl)(),c=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]);let d,u;(0,Se.vR)(t)&&(d=(0,dt.zR)({filter:t,intl:s,propertySchema:o,styles:c}),u=(0,dt.l4)({filter:t,intl:s,propertySchema:o}));const p=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:l,icon:Z.wG[o.type],onClick:i,onEdit:i,onDelete:r,title:(0,P.jsx)("div",{style:c.content,children:d})})),[l,r,i,o.type,c.content,d]);return d&&u?(0,P.jsx)(Ue.y,{renderOrigin:p,title:u,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left}):null}var mt=o(65380),gt=o(76954);function yt(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;if("changes_to_any"===t.operator)return(0,P.jsx)(ct,{disabled:r,propertySchema:o,onClick:n,onEdit:n,onDelete:i});{const e={filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r};return(0,P.jsx)(ht,{...e})}}function ht(e){window.__c={n:"ParametrizableSelectPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:l}=e,s=(0,h.useIntl)(),c=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]);let d,u;if((0,Se.vR)(t)){const e=t.value,n=o.name,i=(Array.isArray(e)?e:[e]).map((e=>e.value)).filter(g.$K),r=(0,gt.z)({intl:s,limit:5,optionValues:i,propertySchema:o}),a=s.formatList(r,{style:"long",type:"disjunction"}),l=(0,gt.z)({intl:s,isText:!0,limit:5,optionValues:i,propertySchema:o}),p=s.formatList(l,{style:"long",type:"disjunction"});d=(0,We.XJ)(s,{propertyName:(0,P.jsx)("span",{style:c.propertyName,children:n}),propertyValues:(0,mt.H)(a)}),u=(0,We.XJ)(s,{propertyName:(0,P.jsx)("span",{style:c.propertyName,children:n}),propertyValues:(0,mt.H)(p)})}const p=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:l,icon:Z.wG[o.type],onClick:i,onDelete:r,onEdit:i,title:(0,P.jsx)("div",{style:c.content,children:d})})),[l,r,i,o.type,c.content,d]);return d&&u?(0,P.jsx)(Ue.y,{renderOrigin:p,title:u,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left}):null}var ft=o(3729),St=o(87181);const vt=5;function xt(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;return"changes_to_any"===t.operator?(0,P.jsx)(ct,{disabled:r,propertySchema:o,onClick:n,onDelete:i,onEdit:n}):(0,P.jsx)(bt,{...e,filter:t})}function bt(e){window.__c={n:"ParametrizableStatusPropertyTriggerFilter"};const{filter:t,limit:o=vt,propertySchema:i,onEdit:r,onDelete:l,disabled:s}=e,c=(0,h.useIntl)(),d=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]);let u,p;if((0,Se.vR)(t)){const e=i.name,n=(0,Se.wB)(t),r=n.map((e=>"is_group"===e.type?e.value:void 0)).filter(g.$K),a=n.map((e=>"is_option"===e.type?e.value:void 0)).filter(g.$K),l=(0,St.L)({intl:c,groupValues:r,limit:o,optionValues:a,propertySchema:i}),s=c.formatList(l,{style:"long",type:"disjunction"}),m=(0,St.L)({intl:c,isText:!0,groupValues:r,limit:o,optionValues:a,propertySchema:i}),y=c.formatList(m,{style:"long",type:"disjunction"});u=(0,We.VO)(c,{propertyName:(0,P.jsx)("span",{style:d.propertyName,children:e}),propertyValues:(0,mt.H)(s)}),p=(0,We.VO)(c,{propertyName:(0,P.jsx)("span",{style:d.propertyName,children:e}),propertyValues:(0,mt.H)(y)})}const m=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:s,icon:ft.T,title:(0,P.jsx)("div",{style:d.content,children:u}),onEdit:r,onDelete:l,onClick:r})),[s,l,r,d.content,u]);return u&&p?(0,P.jsx)(Ue.y,{renderOrigin:m,title:p,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left}):null}function Ct(e){window.__c={n:"AutomationTriggerList"};const{automationStore:t,collectionStore:o,disabled:i,handleNavigateToEditProperty:a,handleNavigateToDeletedProperties:l,updateCurrentState:c}=e,d=(0,ge.d)(),u=(0,r.VK)((()=>o.getSchema()),[o]),p=(0,r.VK)((()=>t.getTriggerStore().getKeyStore("event").getValue()),[t]),m=(0,n.useCallback)((e=>{c({type:"remove_trigger",trigger:{type:"property_changed",property:e,filter:{operator:"changes_to_any"}}})}),[c]),y=jt(),h=[];return null!=p&&p.pagesAdded&&h.push((0,P.jsx)(wt,{disabled:i,updateCurrentState:c},"page_added_trigger")),"any"===(null==p?void 0:p.pagePropertiesEdited.type)&&h.push((0,P.jsx)(Mt,{disabled:i,updateCurrentState:c},"any_page_property_edited_trigger")),"some"===(null==p?void 0:p.pagePropertiesEdited.type)&&h.push(...p.pagePropertiesEdited.some.map((e=>{const{property:r,filter:p}=e,g=u[r];return g?s.Ym[g.type]?"status"!==g.type||"changes_to_any"!==p.operator&&!(0,Se.r2)(p)?"select"!==g.type||"changes_to_any"!==p.operator&&!(0,Se.dx)(p)?"multi_select"!==g.type||"changes_to_any"!==p.operator&&!(0,Se.NU)(p)?"checkbox"!==g.type||"changes_to_any"!==p.operator&&!(0,Se.XA)(p)?"changes_to_any"===p.operator?(0,P.jsx)(ct,{disabled:i,onClick:e=>{e.setState({open:!0})},propertySchema:g,onDelete:()=>{m(r)}},`changes_to_any_${r}_trigger`):void 0:(0,P.jsx)(kt,{automationStore:t,collectionStore:o,property:r,renderOrigin:e=>{let{onClick:t}=e;return(0,P.jsx)(ut,{disabled:i,filter:p,propertySchema:g,onEdit:t,onDelete:()=>{m(r)}})},updateCurrentState:c},`changes_to_any_${r}_trigger`):(0,P.jsx)(kt,{property:r,automationStore:t,collectionStore:o,updateCurrentState:c,renderOrigin:e=>{let{onClick:t}=e;return(0,P.jsx)(yt,{disabled:i,filter:p,propertySchema:g,onEdit:t,onDelete:()=>{m(r)}})}},`changes_to_any_${r}_trigger`):(0,P.jsx)(kt,{property:r,automationStore:t,collectionStore:o,updateCurrentState:c,renderOrigin:e=>{let{onClick:t}=e;return(0,P.jsx)(yt,{disabled:i,filter:p,propertySchema:g,onEdit:t,onDelete:()=>{m(r)}})}},`changes_to_any_${r}_trigger`):(0,P.jsx)(kt,{automationStore:t,property:r,collectionStore:o,updateCurrentState:c,renderOrigin:e=>{let{onClick:t}=e;return(0,P.jsx)(xt,{disabled:i,filter:p,propertySchema:g,onEdit:t,onDelete:()=>{m(r)}})}},`changes_to_any_${r}_trigger`):(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.Center,placementToOrigin:me.pO.Bottom,popupType:d,render:()=>(0,P.jsx)(st,{onDelete:()=>{c({type:"remove_trigger",trigger:{filter:p,property:r,type:"property_changed"}})},onViewEditProperty:a,propertyId:r,propertySchema:g,stepType:"trigger"}),renderOrigin:e=>(0,n.createElement)(Le.Z,{...e,key:`unsupported_${r}_trigger`,disabled:i,onClick:()=>e.onClick(),propertySchema:g})},`unsupported_property_${r}_trigger`):(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.Center,placementToOrigin:me.pO.Bottom,popupType:d,render:()=>(0,P.jsx)(He,{stepType:"trigger",onDelete:()=>{c({type:"remove_trigger",trigger:{filter:p,property:r,type:"property_changed"}})},onViewDeletedProperties:l}),renderOrigin:e=>(0,P.jsx)(Ne,{...e,disabled:i,propertyId:r,collectionStore:o})},`deleted_property_${r}_trigger`)})).filter(g.$K)),(0,P.jsx)("ul",{style:y.stepList,children:h.map(((e,t)=>(0,P.jsx)("li",{style:0===t?{}:y.stepItemWithBorderTop,children:e},t)))})}function kt(e){window.__c={n:"AdvancedTriggerPopup"};const{automationStore:t,renderOrigin:o,collectionStore:n,property:i,updateCurrentState:r}=e,a=(0,ge.d)();return(0,P.jsx)(me.ZP,{popupType:a,renderOrigin:o,render:e=>(0,P.jsx)(at,{automationStore:t,collectionStore:n,initialState:{type:"propertyChangedFilter",property:i},updateCurrentAutomationState:r,buttonPopupParent:e})})}function wt(e){window.__c={n:"AutomationTriggerPagedAdded"};const{disabled:t,updateCurrentState:o}=e,i=(0,h.useIntl)(),r=jt(),a=We.Mz(i),l=(0,n.useCallback)((e=>{e.setState({open:!0})}),[]),s=(0,n.useCallback)((()=>o({trigger:{type:"page_added"},type:"remove_trigger"})),[o]),d=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:t,icon:c.R,onClick:l,onDelete:s,title:(0,P.jsx)("div",{style:r.semiBoldTitle,children:a})})),[t,l,s,r.semiBoldTitle,a]);return(0,P.jsx)(Ue.y,{renderOrigin:d,title:a,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left})}function Mt(e){window.__c={n:"AutomationTriggerAnyPropertyEdited"};const{disabled:t,updateCurrentState:o}=e,i=(0,h.useIntl)(),r=jt(),a=We.c5(i),l=(0,n.useCallback)((e=>{e.setState({open:!0})}),[]),s=(0,n.useCallback)((()=>{o({type:"remove_trigger",trigger:{type:"any_page_property_edited"}})}),[o]),c=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:t,onClick:l,icon:Re.R,title:(0,P.jsx)("div",{style:r.semiBoldTitle,children:a}),onDelete:s})),[t,l,s,r.semiBoldTitle,a]);return(0,P.jsx)(Ue.y,{renderOrigin:c,title:a,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left})}function jt(){return(0,a.yK)((e=>({stepList:{border:`1px solid ${e.stroke.regular}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},semiBoldTitle:{fontWeight:y.Z.fontWeight.semibold},stepItemWithBorderTop:{borderTop:`1px solid ${e.stroke.regular}`}})),[])}var _t=o(78106),At=o(51592),Tt=o(85740),Pt=o(28267),Vt=o(64737),It=o(73266),Ft=o(73239),Zt=o(29180),Bt=o(37989),Kt=o(43690),Rt=o(149),Ot=o(52105);function Wt(e){window.__c={n:"UpdatePagesActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,i=t.id,a=(0,r.VK)((()=>t.getConfig()),[t]),l=(0,n.useCallback)((e=>{var t;const n="collection"===e.type&&"collection"===(null==a||null===(t=a.target)||void 0===t?void 0:t.type)&&e.collection.id!==(null==a?void 0:a.target.collection.id);o({action:{config:{...a,target:e,properties:n?[]:(null==a?void 0:a.properties)??[],values:n?{}:(null==a?void 0:a.values)??{}},id:i,type:"update_pages"},type:"update_action"})}),[a,i,o]),s=(0,n.useCallback)(((e,t)=>{o({action:{config:{...a,properties:e,values:t},id:i,type:"update_pages"},type:"update_action"})}),[i,a,o]),c=(0,n.useCallback)((()=>{o({action:{config:a,id:i,type:"update_pages"},type:"remove_action"})}),[a,i,o]);return(0,P.jsx)(Dt,{...e,onConfigChange:s,onDelete:c,onTargetChange:l})}function Dt(e){window.__c={n:"UpdatePagesActionV2"};const{actionStore:t,automationStore:o,collectionStore:i,disabled:l,onConfigChange:s,onDelete:c,onTargetChange:d}=e,u=(0,n.useRef)(null),p=(0,Pt.X)(u),m=(0,It.a)(p),[y,h]=(0,n.useState)(!1),f=(0,le.z)("update_pages"),S=(0,A.X)({automationStore:o,collectionStore:i}),v=(0,r.VK)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),[x,b,C]=(0,r.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.target,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),k=(0,n.useMemo)((()=>({values:C??{},properties:b??[]})),[C,b]),w=(0,r.VK)((()=>"collection"===(null==v?void 0:v.type)),[v]),M=(0,r.VK)((()=>{const e=t.getTargetStore().getValue();if(e&&S){if("collection"===e.type)return Ie.NW.createChildStore(S.context.parentRecordStore,e.collection);if("variable"===e.type){const t=S.compilationResultStore.state;if(Rt.x.isFail(t))return;const o=(0,_t.vx)(t.value.valueTypes,e.id);if(o)return(0,z.wB)(o,S.context.parentRecordStore)}else{if("page"===e.type)return;(0,g.t1)(e)}}}),[t,S]),j=(0,r.VK)((()=>{if("collection"!==(null==x?void 0:x.type))return;const e=x.filter;return(0,g.$K)(e)?(0,Kt.Ih)(e,(null==M?void 0:M.getSchema())??{}):void 0}),[x,M]),_=(0,n.useCallback)((e=>{if(!(0,g.$K)(x))return void d(e);const t=x.type!==e.type,o="variable"===x.type&&"variable"===e.type&&x.id!==e.id,n="collection"===x.type&&"collection"===e.type&&x.collection.id!==e.collection.id;(t||o||n)&&d(e)}),[x,d]),T=(0,n.useCallback)((e=>{(0,g.$K)(x)&&"collection"===x.type&&(be.Xy(x.filter,e)||d({...x,filter:e}))}),[x,d]),V=(0,n.useCallback)((e=>{const t=k.properties.concat([e]);s(t,k.values)}),[s,k]),I=(0,n.useCallback)(((e,t)=>{const o=k.properties.indexOf(e);if(-1===o)return;const n=k.properties.slice(0);n[o]=t;const i={...k.values,[t]:void 0};s(n,i)}),[s,k]),F=(0,n.useCallback)((e=>{const t=k.properties.filter((t=>t!==e)),o={...k.values,[e]:void 0};s(t,o)}),[s,k]),Z=(0,n.useCallback)(((e,t)=>{const o={...k.values,[e]:t};s(k.properties,o)}),[s,k]),B=(0,n.useCallback)((()=>{h(!0)}),[]),K=(0,n.useCallback)((()=>{h(!1)}),[]),R=(0,a.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:m?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[m]);return S?(0,P.jsxs)("section",{onMouseEnter:B,onMouseLeave:K,ref:u,style:R.sectionWrap,children:[(0,P.jsxs)(Lt,{disabled:l,icon:f.display.icon({height:21,width:14}),isHovered:y,onDelete:c,children:[(0,P.jsx)("div",{style:R.headerTitle,children:(0,P.jsx)(Et,{actionStore:t,automationContextStore:S,disabled:l,onChange:_,value:v})}),w&&(0,g.$K)(M)&&(0,P.jsx)("div",{style:R.headerTitle,children:(0,P.jsx)(Nt,{collectionStore:M,disabled:l,filter:j,onChange:T})})]}),M&&(0,P.jsx)(ie.vV,{actionId:t.id,collectionStore:M,config:k,contextStore:S,disabled:l,onPropertyAdd:V,onPropertyChange:I,onPropertyRemove:F,onPropertyValueChange:Z,showSetPropertyActions:!0})]}):null}function Et(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,onChange:i,value:r}=e,l=(0,a.yK)((()=>({b:{fontWeight:y.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Tt.H)({})}})),[]);return(0,P.jsx)(h.FormattedMessage,{defaultMessage:"<span>Update <b>pages</b> in </span>{collectionPicker}",id:"automations.UpdatePagesActionV2.header.title",values:{b:e=>(0,P.jsx)("b",{style:l.b,children:e}),collectionPicker:(0,P.jsx)("div",{style:l.picker,children:(0,P.jsx)(Ft.a,{actionStore:t,contextStore:o,currentValue:r,disabled:n,onChange:i})}),span:e=>(0,P.jsx)("span",{style:l.span,children:e})}})}function Nt(e){window.__c={n:"CollectionFilterTitle"};const{collectionStore:t,disabled:o,filter:n,onChange:l}=e,s=(0,i.O7)(),c=(0,h.useIntl)(),d=(0,r.VK)((()=>(0,Pe.vU)({environment:s,intl:c,store:t})),[t,c,s]),u=(0,a.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Tt.H)({})}})),[]);return(0,P.jsx)(h.FormattedMessage,{defaultMessage:"<span>that match </span>{filterPicker}",id:"automations.UpdatePagesActionV2.header.filterTitle",values:{filterPicker:(0,P.jsx)("div",{style:u.picker,children:(0,P.jsx)(Ot.W,{collectionStore:t,disabled:o,filter:n,noFiltersMessage:(0,g.$K)(d)?(0,P.jsx)(h.FormattedMessage,{defaultMessage:"All pages in {collectionName}",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.label",values:{collectionName:d}}):(0,P.jsx)(h.FormattedMessage,{defaultMessage:"All pages in database",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.fallbackLabel"}),onChange:l})}),span:e=>(0,P.jsx)("span",{style:u.span,children:e})}})}function Lt(e){window.__c={n:"ActionHeader"};const{children:t,disabled:o,icon:n,isHovered:r,onDelete:l}=e,{isMobile:s}=(0,i.Fy)(),[c,d]=(0,Bt.Z)(),u=!o&&(s||r||d),p=(0,a.yK)((()=>({wrap:{alignItems:"start",cursor:o?"default":void 0,opacity:o?.4:void 0,display:"flex",gap:6,minHeight:28},iconWrap:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Tt.H)({})},titleWrap:{display:"flex",flex:"1 1 auto",flexWrap:"wrap",fontSize:14,lineHeight:1.4,minWidth:0},moreButtonWrap:{flex:"0 0 26px"}})),[o]);return(0,P.jsxs)("header",{ref:c,style:p.wrap,children:[n&&(0,P.jsx)("div",{style:p.iconWrap,children:n}),(0,P.jsx)("div",{style:p.titleWrap,children:t}),(0,P.jsx)("div",{style:p.moreButtonWrap,children:u&&(0,P.jsx)(Ee.mv,{disabled:o,onDelete:l})})]})}function zt(e){window.__c={n:"CreatePageActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,i=t.id,a=(0,r.VK)((()=>t.getConfig()),[t]),l=(0,n.useCallback)((e=>{o({action:{config:{...a,collection:e,properties:["title"],values:{},template_page_id:void 0},id:i,type:"create_page"},type:"update_action"})}),[i,a,o]),s=(0,n.useCallback)((e=>{if(!a)return;const{properties:t,values:n}=a;let r=!1;if(e&&t&&1===t.length&&t.includes("title")){var l;const e=null==n?void 0:n.title;e&&null!==(l=e.value)&&void 0!==l&&l.value||(r=!0)}o({action:{config:{...a,template_page_id:e,...r&&{properties:[]}},id:i,type:"create_page"},type:"update_action"})}),[i,a,o]),c=(0,n.useCallback)(((e,t)=>{o({action:{config:{...a,properties:e,values:t},id:i,type:"create_page"},type:"update_action"})}),[i,a,o]),d=(0,n.useCallback)((()=>{o({action:{config:a,id:i,type:"create_page"},type:"remove_action"})}),[a,i,o]);return(0,P.jsx)(Ht,{...e,onConfigChange:c,onDelete:d,onTargetCollectionChange:l,onTemplateChange:s})}function Ht(e){window.__c={n:"CreatePageActionV2"};const{actionStore:t,automationStore:o,collectionStore:i,disabled:l,onConfigChange:s,onDelete:c,onTargetCollectionChange:d,onTemplateChange:u}=e,p=(0,n.useRef)(null),m=(0,Pt.X)(p),y=(0,It.a)(m),h=(0,le.z)("create_page"),[f,S]=(0,n.useState)(!1),[v,x,b]=(0,r.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.collection,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),C=(0,r.VK)((()=>{if(v)return Ie.NW.createChildStore(i,v)}),[i,v]),k=(0,r.VK)((()=>{const e=t.getCollectionStore();if(e)return{collection:e.getSpaceShardedPointer(),type:"collection"}}),[t]),w=(0,r.VK)((()=>(0,Vt.q)(C).length>0),[C]),M=(0,r.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),j=(0,A.X)({automationStore:o,collectionStore:i}),_=(0,n.useMemo)((()=>({values:b??{},properties:x??[]})),[b,x]),T=(0,n.useCallback)((e=>{d&&"collection"===e.type&&d(e.collection)}),[d]),V=(0,n.useCallback)((e=>{const t=_.properties.concat([e]);s(t,_.values)}),[s,_]),I=(0,n.useCallback)(((e,t)=>{const o=_.properties.indexOf(e);if(-1===o)return;const n=_.properties.slice(0);n[o]=t;const i={..._.values,[t]:void 0};s(n,i)}),[s,_]),F=(0,n.useCallback)((e=>{const t=_.properties.filter((t=>t!==e)),o={..._.values,[e]:void 0};s(t,o)}),[s,_]),Z=(0,n.useCallback)(((e,t)=>{const o={..._.values,[e]:t};s(_.properties,o)}),[s,_]),B=(0,n.useCallback)((()=>{S(!0)}),[]),K=(0,n.useCallback)((()=>{S(!1)}),[]),R=(0,a.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:y?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[y]);return j?(0,P.jsxs)("section",{onMouseEnter:B,onMouseLeave:K,ref:p,style:R.sectionWrap,children:[(0,P.jsxs)(Lt,{disabled:l,icon:h.display.icon({height:21,width:14}),isHovered:f,onDelete:c,children:[(0,P.jsx)("div",{style:R.headerTitle,children:(0,P.jsx)(Ut,{actionStore:t,automationContextStore:j,disabled:l,onChange:T,value:k})}),(0,g.$K)(C)&&w&&(0,P.jsx)("div",{style:R.headerTitle,children:(0,P.jsx)($t,{collectionStore:C,disabled:l,onChange:u,value:M})})]}),C&&(0,P.jsx)(ie.vV,{actionId:t.id,collectionStore:C,config:_,contextStore:j,disabled:l,onPropertyAdd:V,onPropertyChange:I,onPropertyRemove:F,onPropertyValueChange:Z,showSetPropertyActions:!1})]}):null}function Ut(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,onChange:i,value:l}=e,s=(0,a.yK)((()=>({b:{fontWeight:y.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Tt.H)({})}})),[]),c=(0,r.VK)((()=>{let e;if("collection"===(null==l?void 0:l.type)){const o=t.getRecordModel(l.collection);e=null==o?void 0:o.getDatabaseType()}return(0,At.sN)(e)}),[t,l]);return(0,P.jsx)(h.FormattedMessage,{defaultMessage:"<span>Add <b>{itemType}</b> to </span>{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{b:e=>(0,P.jsx)("b",{style:s.b,children:e}),collectionPicker:(0,P.jsx)("div",{style:s.picker,children:(0,P.jsx)(Ft.a,{actionStore:t,contextStore:o,currentValue:l,disabled:n,onChange:i})}),itemType:c,span:e=>(0,P.jsx)("span",{style:s.span,children:e})}})}function $t(e){window.__c={n:"CollectionTemplateTitle"};const{collectionStore:t,disabled:o,onChange:n,value:i}=e,r=(0,a.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Tt.H)({})}})),[]);return(0,P.jsx)(h.FormattedMessage,{defaultMessage:"<span>as </span>{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,P.jsx)(Zt.f,{collectionStore:t,currentTemplateId:i,disabled:o,onChange:n}),span:e=>(0,P.jsx)("span",{style:r.span,children:e})}})}var qt=o(24600),Gt=o(30874),Qt=o(67174);function Yt(e){window.__c={n:"SlackNotificationAction"};const{actionStore:t,automationStore:o,collectionStore:n,currentUserIsOwner:i,disabled:a,updateCurrentAutomationState:l}=e,s=(0,ge.d)(),c=(0,r.VK)((()=>t.getConfig()),[t]),d=(0,r.VK)((()=>Gt.Z.completeSlackAuthentications.state.find((e=>(null==c?void 0:c.external_bot_id)===e.id))),[c]),u=(0,r.VK)((()=>"disabled_auth"===(null==o?void 0:o.getStatus())),[o]),p=(0,r.VK)((()=>c&&d&&c.target?o&&t&&c.external_bot_id&&u?{actionStore:t,externalBotId:c.external_bot_id,notificationActionConfigStore:t,type:"connectToSlackReconnect"}:{actionStore:t,currentExternalAuthentication:d,currentNotificationChannel:c.target,type:"selectChannelUpdate"}:{actionStore:t,type:"connectToSlackDefault"}),[c,t,o,d,u]),m=Jt();return i?(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.Center,placementToOrigin:me.pO.Bottom,popupType:s,render:e=>(0,P.jsx)(pe,{automationStore:o,initialState:p,updateCurrentAutomationState:l,buttonPopupParent:e,collectionStore:n}),renderOrigin:e=>(0,P.jsx)(Ee.pW,{...e,disabled:a,onClick:()=>{e.onClick()},title:(0,P.jsx)(Xt,{actionStore:t,currentUserIsOwner:i}),icon:qt.P,caption:u&&(0,P.jsxs)("div",{style:m.container,children:[(0,xe.t)(m.warningIcon),(0,P.jsx)("div",{style:m.caption,children:(0,P.jsx)(h.FormattedMessage,{id:"SlackNotificationAction.caption.reconnectNeeded",defaultMessage:"Reconnect Slack to resume"})})]}),onEdit:()=>{e.onClick()},onDelete:()=>{l({type:"remove_action",action:{id:t.id,type:"slack_notification"}})}})}):(0,P.jsx)(Ee.pW,{disabled:!0,icon:qt.P,title:(0,P.jsxs)("div",{style:m.container,children:[(0,P.jsx)("div",{style:{fontWeight:500,marginRight:4},children:(0,P.jsx)(h.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})}),(0,P.jsx)(Qt.p,{channel:null==c?void 0:c.target,isAutomationOwner:i})]})})}function Xt(e){window.__c={n:"SlackActionTitle"};const{actionStore:t,currentUserIsOwner:o}=e,n=Jt(),i=(0,r.VK)((()=>t.getConfig()),[t]);return i&&i.external_bot_id&&i.target?(0,P.jsxs)("div",{style:n.container,children:[(0,P.jsxs)("div",{style:{fontWeight:500},children:[(0,P.jsx)(h.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})," "]}),(0,P.jsx)(Qt.p,{channel:i.target,isAutomationOwner:o})]}):(0,P.jsx)("div",{style:n.container,children:(0,P.jsx)(h.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotificationPlaceholder",defaultMessage:"Send Slack notification to…"})})}function Jt(){return(0,a.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center",padding:0},caption:{fontSize:12,fontWeight:400,color:e.mediumTextColor},warningIcon:{width:12,height:"auto",color:e.accentColors.orange[400]}})),[])}var eo=o(42283),to=o(29723);function oo(e){window.__c={n:"UpdateCheckboxPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:r,propertySchema:l,value:s}=e,c=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]),d=(0,to.LJ)({propertySchema:l,styles:c,value:s}),u=(0,to.G7)({propertySchema:l,value:s}),p=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:t,icon:eo.r,onClick:o,onDelete:i,onEdit:r,title:(0,P.jsx)("div",{style:c.content,children:d})})),[t,o,i,r,c.content,d]);return(0,P.jsx)(Ue.y,{renderOrigin:p,title:u,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left})}var no=o(53016),io=o(23704);function ro(e){window.__c={n:"UpdateDatePropertyAction"};const{automationStore:t,collectionStore:o,disabled:i,onClick:l,onDelete:s,onEdit:c,propertySchema:d,value:u,valueContext:p}=e,m=(0,h.useIntl)(),g=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]),f=(0,A.X)({automationStore:t,collectionStore:o}),S=(0,r.VK)((()=>f?(0,io.Sg)({automationContextStore:f,intl:m,propertySchema:d,styles:g,value:u,valueContext:p}):void 0),[f,m,d,g,u,p]),v=(0,r.VK)((()=>f?(0,io.kD)({automationContextStore:f,intl:m,propertySchema:d,value:u,valueContext:p}):void 0),[f,m,d,u,p]),x=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:i,icon:no.V,onClick:l,onDelete:s,onEdit:c,title:(0,P.jsx)("div",{style:g.content,children:S})})),[i,l,s,c,g.content,S]);return f&&S&&v?(0,P.jsx)(Ue.y,{renderOrigin:x,title:v,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left}):null}var ao=o(72050),lo=o(93377),so=o(99144),co=o(53866);function uo(e){window.__c={n:"UpdateSelectPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:l,propertySchema:s,value:c}=e,d=(0,h.useIntl)(),u=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]),p=null!=c&&c.value?(0,ee.A6)(null==c?void 0:c.value)[0]:void 0,m=We.oJ({propertySchema:s,optionValues:(0,be.HD)(p)?[p]:[]}),g=(0,r.VK)((()=>(0,so.F0)({intl:d,propertySchema:s,styles:u,values:m})),[d,m,s,u]),f=(0,r.VK)((()=>(0,so.I7)({intl:d,propertySchema:s,values:m})),[d,m,s]),S=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:t,icon:co.w,onClick:o,onDelete:i,onEdit:l,title:(0,P.jsx)("div",{style:u.content,children:g})})),[t,o,i,l,u.content,g]);return(0,P.jsx)(Ue.y,{renderOrigin:S,title:f,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left})}function po(e){window.__c={n:"UpdateMultiSelectPropertyAction"};const{disabled:t,limit:o=lo.H,onClick:i,onDelete:l,onEdit:s,propertySchema:c,value:d}=e,u=(0,h.useIntl)(),p=null!=d&&d.value?(0,ee.A6)(null==d?void 0:d.value):[],m=We.oJ({limit:o,optionValues:p.map((e=>"string"==typeof e?e:void 0)).filter(g.$K),propertySchema:c}),f=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:m.length<=1?"nowrap":"wrap",whiteSpace:"pre"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[m.length]),S=(0,r.VK)((()=>(0,so.F0)({intl:u,propertySchema:c,styles:f,values:m})),[u,m,c,f]),v=(0,r.VK)((()=>(0,so.I7)({intl:u,propertySchema:c,values:m})),[u,m,c]),x=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:t,icon:ao.A,onClick:i,onDelete:l,onEdit:s,title:(0,P.jsx)("div",{style:f.content,children:S})})),[t,i,l,s,f.content,S]);return(0,P.jsx)(Ue.y,{renderOrigin:x,title:v,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left})}var mo=o(26774),go=o(82207);function yo(e){window.__c={n:"UpdatePersonPropertyAction"};const{collectionStore:t,disabled:o,onClick:i,onDelete:l,onEdit:s,propertySchema:c,value:d}=e,u=(0,h.useIntl)(),p=(0,r.VK)((()=>(0,go.UD)({getRecordModel:t.getRecordModel,propertySchema:c,value:d})),[t.getRecordModel,c,d]),m=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:p.length>1?"wrap":"nowrap",whiteSpace:"pre"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold},propertyValue:{...y.Z.textOverflowStyle,paddingBlockStart:4},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:4}})),[p.length]),g=(0,r.VK)((()=>(0,go.iT)({actors:p,propertySchema:c,styles:m})),[p,c,m]),f=(0,r.VK)((()=>(0,go.y3)({actors:p,intl:u,propertySchema:c})),[p,u,c]),S=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:o,icon:mo.O,onClick:i,onDelete:l,onEdit:s,title:(0,P.jsx)("div",{style:m.content,children:g})})),[o,i,l,s,m.content,g]);return(0,P.jsx)(Ue.y,{renderOrigin:S,title:f,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left})}var ho=o(92607),fo=o(84799);function So(e){window.__c={n:"UpdateRelationPropertyAction"};const{automationStore:t,collectionStore:o,disabled:l,onClick:s,onDelete:c,onEdit:d,propertySchema:u,value:p}=e,m=(0,i.O7)(),g=(0,h.useIntl)(),f=(0,A.X)({automationStore:t,collectionStore:o}),S=(0,r.VK)((()=>(null==f?void 0:f.getAllContextValues())??[]),[f]),v=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",minWidth:0,whiteSpace:"pre"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold,minWidth:20},propertyValue:{...y.Z.textOverflowStyle,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10},propertyValueListItem:{display:"flex"}})),[]),x=(0,r.VK)((()=>(0,fo.vT)({automationContextValues:S,collectionStore:o,propertySchema:u,styles:v,value:p})),[S,o,u,v,p]),b=(0,r.VK)((()=>(0,fo.wr)({automationContextValues:S,collectionStore:o,environment:m,intl:g,propertySchema:u,value:p})),[S,o,m,g,u,p]),C=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:l,icon:ho.v,onClick:s,onDelete:c,onEdit:d,title:x})),[l,s,c,d,x]);return(0,P.jsx)(Ue.y,{renderOrigin:C,title:b,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left})}var vo=o(4328);function xo(e){window.__c={n:"UpdateStatusPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:l,propertySchema:s,value:c}=e,d=(0,h.useIntl)(),u=(0,ee.A6)(null==c?void 0:c.value)[0],p=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]),m=(0,r.VK)((()=>(0,vo.O3)({intl:d,propertySchema:s,styles:p,value:u})),[d,s,u,p]),g=(0,r.VK)((()=>(0,vo.LQ)({intl:d,propertySchema:s,value:u})),[d,s,u]),f=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:t,icon:ft.T,onClick:o,onDelete:i,onEdit:l,title:(0,P.jsx)("div",{style:p.content,children:m})})),[t,o,i,l,p.content,m]);return m&&g?(0,P.jsx)(Ue.y,{renderOrigin:f,title:g,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left}):null}var bo=o(48524),Co=o(55159),ko=o(34093),wo=o(108),Mo=o(83303),jo=o(8938),_o=o(73427);function Ao(e){window.__c={n:"UpdateBaseTextPropertyAction"};const{automationStore:t,disabled:o,icon:l,onClick:s,onDelete:c,onEdit:d,propertySchema:u,value:p}=e,m=(0,i.O7)(),g=(0,a.Fg)(),h=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]),f=(0,r.VK)((()=>(0,_o.Ut)({automationStore:t,environment:m,propertySchema:u,styles:h,theme:g,value:p})),[t,m,u,h,g,p]),S=(0,r.VK)((()=>(0,_o.lG)({automationStore:t,environment:m,propertySchema:u,theme:g,value:p})),[t,m,u,g,p]),v=(0,n.useCallback)((e=>(0,P.jsx)(Ee.pW,{...e,disabled:o,icon:l,onClick:s,onDelete:c,onEdit:d,title:(0,P.jsx)("div",{style:h.content,children:f})})),[o,l,s,c,d,h.content,f]);return f&&S?(0,P.jsx)(Ue.y,{renderOrigin:v,title:S,tooltipAlignment:Oe.v.Center,tooltipPlacement:Oe.u.Left}):null}function To(e){return(0,P.jsx)(Ao,{...e,icon:Mo.c})}function Po(e){return(0,P.jsx)(Ao,{...e,icon:wo.p})}function Vo(e){return(0,P.jsx)(Ao,{...e,icon:bo.n})}function Io(e){return(0,P.jsx)(Ao,{...e,icon:jo.O})}function Fo(e){return(0,P.jsx)(Ao,{...e,icon:Co.J})}function Zo(e){return(0,P.jsx)(Ao,{...e,icon:ko.u})}function Bo(e){const{automationStore:t,collectionStore:o,disabled:n,formulaValueContext:i,onClick:r,onEdit:a,propertySchema:l,setPropertyValue:s,onDelete:c}=e;return"person"===l.type?(0,P.jsx)(yo,{collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"status"===l.type?(0,P.jsx)(xo,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"select"===l.type?(0,P.jsx)(uo,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"multi_select"===l.type?(0,P.jsx)(po,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"date"===l.type?(0,P.jsx)(ro,{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value,valueContext:i}):"relation"===l.type?(0,P.jsx)(So,{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"checkbox"===l.type?(0,P.jsx)(oo,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"title"===l.type?(0,P.jsx)(To,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"text"===l.type?(0,P.jsx)(Po,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"email"===l.type?(0,P.jsx)(Vo,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"url"===l.type?(0,P.jsx)(Io,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"number"===l.type?(0,P.jsx)(Fo,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"phone_number"===l.type?(0,P.jsx)(Zo,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):null}function Ko(e){window.__c={n:"CollectionSettingsAutomationActionList"};const{automationStore:t,collectionStore:o,updateCurrentAutomationState:n,handleNavigateToDeletedProperties:i,handleNavigateToEditProperty:l,currentUserIsOwner:s,disabled:c}=e,d=(0,r.VK)((()=>t.getActionStores().map((e=>e.isType("update_pages")?(0,P.jsx)(Ro,{actionStore:e,automationStore:t,collectionStore:o,disabled:c,handleNavigateToDeletedProperties:i,handleNavigateToEditProperty:l,updateCurrentAutomationState:n},e.id):e.isType("slack_notification")?(0,P.jsx)(Yt,{actionStore:e,automationStore:t,collectionStore:o,updateCurrentAutomationState:n,currentUserIsOwner:s,disabled:c},e.id):e.isType("create_page")?(0,P.jsx)(zt,{actionStore:e,automationStore:t,collectionStore:o,disabled:c,updateCurrentAutomationState:n},e.id):void 0)).filter(g.$K)),[t,o,s,c,i,l,n]),u=(0,a.yK)((e=>({stepList:{border:`1px solid ${e.regularDividerColor}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},stepItemWithBorderTop:{borderTop:`1px solid ${e.regularDividerColor}`}})),[]);return(0,P.jsx)("ul",{style:u.stepList,children:d.map(((e,t)=>{const o=0===t?void 0:u.stepItemWithBorderTop;return(0,P.jsx)("li",{style:o,children:e},t)}))})}function Ro(e){var t;window.__c={n:"InternalUpdatePageAction"};const{actionStore:o,automationStore:i,collectionStore:a,disabled:l,handleNavigateToDeletedProperties:c,handleNavigateToEditProperty:d,updateCurrentAutomationState:u}=e,p=(0,ge.d)(),m=(0,r.VK)((()=>o.getConfig()),[o]),g=(0,r.VK)((()=>a.getSchema()),[a]),y=(0,n.useCallback)((()=>{u({action:{config:m,id:o.id,type:"update_pages"},type:"remove_action"})}),[m,o.id,u]),h="variable"===(null==m||null===(t=m.target)||void 0===t?void 0:t.type)?(0,_t.MY)(m.target.id):void 0;if(h&&"global"===h.source&&"button_page"===h.global){var f;const e=((null==m?void 0:m.properties)??[])[0],t=g[e],r=null==m||null===(f=m.values)||void 0===f?void 0:f[e];if(t&&r){const c={type:"collection",collectionStore:a,property:e};return(0,s.SF)(t)?(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.End,placementToOrigin:me.pO.Bottom,popupType:p,render:t=>(0,P.jsx)(pe,{automationStore:i,buttonPopupParent:t,collectionStore:a,initialState:{propertyId:e,actionId:o.id,type:"eventActionProperty"},updateCurrentAutomationState:u}),renderOrigin:e=>(0,P.jsx)(Bo,{...e,automationStore:i,collectionStore:a,disabled:l,formulaValueContext:c,onDelete:y,onEdit:e.onClick,propertySchema:t,setPropertyValue:r})}):(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.Center,placementToOrigin:me.pO.Bottom,popupType:p,render:()=>(0,P.jsx)(st,{onDelete:y,onViewEditProperty:d,propertyId:e,propertySchema:t,stepType:"action"}),renderOrigin:o=>(0,n.createElement)(Le.Z,{...o,key:`unsupported_${e}_action`,disabled:l,onClick:()=>o.onClick(),propertySchema:t})},`unsupported_property_${e}_action`)}return t?null:(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.Center,placementToOrigin:me.pO.Bottom,popupType:p,render:e=>(0,P.jsx)(He,{stepType:"action",onDelete:y,onViewDeletedProperties:c}),renderOrigin:t=>(0,P.jsx)(Ne,{...t,disabled:l,propertyId:e,collectionStore:a})})}return(0,P.jsx)(Wt,{actionStore:o,automationStore:i,collectionStore:a,disabled:l,updateCurrentAutomationState:u})}var Oo=o(9015);var Wo=o(96245),Do=o(13005),Eo=o(42922),No=o(73063),Lo=o(3386),zo=o(68641),Ho=o(63474),Uo=o(5971),$o=o(84398),qo=o(80444),Go=o(58812);var Qo=o(78243),Yo=o(77080);var Xo=o(13273);var Jo=o(16184),en=o(42402),tn=o(67669);const on=(0,h.defineMessages)({automationIncompatibleViewFilterAndOwner:{defaultMessage:"This automation may not work because the view has a non-supported filter",id:"AutomationHeaderView.incompatibleCollectionViewFilter.owner"},automationPublicAccess:{defaultMessage:"This automation is part of a public page",id:"AutomationHeaderView.automationPublicAccess"},automationUpgrade:{defaultMessage:"<anchor-upsell>Upgrade</anchor-upsell> to edit this automation or create your own",id:"AutomationHeaderView.automationUpgrade"},automationEditOnSite:{defaultMessage:"This automation can only be edited on notion.com",id:"AutomationHeaderView.automationEditOnSite"},automationSlackNoPermissions:{defaultMessage:"Ask {user} to edit this automation",id:"AutomationHeaderView.automationSlackNoPermissions"},automationSlackWithPermissions:{defaultMessage:"Ask {user} to edit this automation or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationSlackWithPermissions"},automationMissingPermissionsNoPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it",id:"AutomationHeaderView.automationMissingPermissionsNoPermissions"},automationMissingPermissionsWithPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationMissingPermissionsWithPermissions"},automationGenericFullAccess:{defaultMessage:"You must have full access to this database to edit automations",id:"AutomationHeaderView.automationGenericFullAccess"}});function nn(e){window.__c={n:"AutomationHeaderView"};const{automationStore:t,automationPermissionScope:o,collectionStore:a,onDelete:l,referencesIncompatibleCollectionViewFilter:s}=e,c=(0,i.O7)(),d=(0,A.X)({automationStore:t,collectionStore:a}),u=(0,r.VK)((()=>Boolean((0,tn.IJ)(c,t))),[t,c]),p=(0,r.VK)((()=>(0,N.$5)(null==d?void 0:d.context)),[d]),m=(0,r.VK)((()=>(0,z.R4)(t)),[t]),g=(0,n.useCallback)((()=>{U.y(c,{from:"database_automation_settings_header_message",for:"plus"})}),[c]),y=ln();if(u)return(0,P.jsx)(rn,{icon:(0,P.jsx)("div",{style:y.lockedIconWrap,children:(0,Jo.Q)(y.lockedIcon)}),children:(0,P.jsx)("p",{style:y.paragraph,children:(0,P.jsx)(h.FormattedMessage,{...on.automationPublicAccess})})});if("sufficient"!==p.editPermissionStatus&&"free_workspace"===p.reason)return(0,N.Rr)({environment:c})?(0,P.jsx)(an,{icon:(0,P.jsx)("div",{style:y.boltIconWrap,children:(0,K.K)(y.boltIcon)}),children:(0,P.jsx)("p",{style:y.paragraph,children:(0,P.jsx)(h.FormattedMessage,{...on.automationUpgrade,values:{"anchor-upsell":e=>(0,P.jsx)(en.Z,{onClick:g,style:y.link,children:e})}})})}):(0,P.jsx)(rn,{icon:(0,P.jsx)("div",{style:y.lockedIconWrap,children:(0,Jo.Q)(y.lockedIcon)}),children:(0,P.jsx)("p",{style:y.paragraph,children:(0,P.jsx)(h.FormattedMessage,{...on.automationEditOnSite})})});if("sufficient"!==p.editPermissionStatus&&"missing_permissions"===p.reason&&p.actionId){const e=m[p.actionId];return(0,P.jsx)(rn,{icon:(0,P.jsx)("div",{style:y.lockedIconWrap,children:(0,Jo.Q)(y.lockedIcon)}),children:(0,P.jsx)("p",{style:y.paragraph,children:(0,P.jsx)(h.FormattedMessage,{..."readonly"===o?on.automationSlackNoPermissions:on.automationSlackWithPermissions,values:{"anchor-delete":e=>(0,P.jsx)(en.Z,{onClick:l,style:y.link,children:e}),user:e}})})})}return"insufficient"===p.editPermissionStatus||"unknown"===p.editPermissionStatus?(0,P.jsx)(rn,{icon:(0,P.jsx)("div",{style:y.lockedIconWrap,children:(0,Jo.Q)(y.lockedIcon)}),children:(0,P.jsx)("p",{style:y.paragraph,children:(0,P.jsx)(h.FormattedMessage,{...on.automationGenericFullAccess})})}):s?(0,P.jsx)(rn,{icon:(0,P.jsx)("div",{style:y.lockedIconWrap,children:(0,xe.t)(y.warningIcon)}),children:(0,P.jsx)(h.FormattedMessage,{...on.automationIncompatibleViewFilterAndOwner})}):null}function rn(e){window.__c={n:"AutomationMessage"};const{children:t,icon:o}=e,n=ln();return(0,P.jsx)("div",{style:n.wrapWrap,children:(0,P.jsxs)("div",{style:n.wrap,children:[o&&(0,P.jsx)("div",{style:n.iconWrap,children:o}),(0,P.jsx)("div",{style:n.messageWrap,children:t})]})})}function an(e){window.__c={n:"AutomationUpsellMessage"};const{children:t,icon:o}=e,n=ln();return(0,P.jsx)("div",{style:n.wrapWrap,children:(0,P.jsxs)("div",{style:n.upsellWrap,children:[o&&(0,P.jsx)("div",{style:n.iconWrap,children:o}),(0,P.jsx)("div",{style:n.messageWrap,children:t})]})})}function ln(){const{isMobile:e}=(0,i.Fy)();return(0,a.yK)((t=>({boltIcon:{fill:t.icon.yellow,height:"100%",width:"100%"},boltIconWrap:{height:20,padding:2,width:20},icon:{},iconWrap:{flexGrow:0,flexShrink:0},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGray,borderRadius:4,height:20,padding:2,width:20},link:{color:t.text.uiBluePrimary},messageWrap:{flexGrow:1},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},warningIcon:{color:t.accentColors.orange[400],height:"100%",width:"100%"},warningIconWrap:{height:20,padding:2,width:20},wrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10},wrapWrap:{padding:e?12:"0 12px 12px 12px"},upsellWrap:{alignItems:"center",background:t.accentColors.yellow[50],border:`1px solid ${t.accentColors.yellow[100]}`,borderRadius:6,display:"flex",flexDirection:"row",gap:10,padding:8},personBadgeQuestionMark:{fill:t.mediumIconColor,width:16,height:"auto"},personBadgeQuestionMarkWrap:{height:20,padding:2,width:20}})),[e])}var sn=o(24006),cn=o(75024);const dn=(0,h.defineMessages)({automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}});function un(e){window.__c={n:"AutomationSectionStatus"};const{automationId:t,automationOwner:o,disabled:i,isAutomationPaused:r,onPause:l,onResume:s}=e,c=`toggle-${t}`,d=(0,n.useCallback)((()=>{r?null==s||s():null==l||l()}),[r,s,l]),u=(0,a.yK)((e=>({labelWrap:{color:i?e.text.tertiary:r?e.text.secondary:e.text.primary,flex:"1 1 auto",fontSize:14},sectionWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:6,marginBlockEnd:12},toggleWrap:{flex:"0 0 auto",paddingBlockStart:2}})),[i,r]),p=r?dn.automationPausedLabel:dn.automationEnabledLabel,m=r?dn.automationPausedHiddenAriaLabel:dn.automationEnabledHiddenAriaLabel;return(0,P.jsxs)("section",{style:u.sectionWrap,children:[(0,P.jsx)("div",{style:u.toggleWrap,children:(0,P.jsx)(Ae.ZP,{disableTooltip:!i||!r,renderTooltip:()=>(0,P.jsx)(h.FormattedMessage,{...dn.automationDisabledTooltip,values:{user:o}}),render:e=>(0,P.jsx)("div",{...e,children:(0,P.jsx)(sn.Z,{disabled:i,inputId:c,on:!r,onClick:d})})})}),(0,P.jsx)("div",{style:u.labelWrap,children:(0,P.jsxs)("label",{htmlFor:c,children:[(0,P.jsx)("span",{"aria-hidden":!0,children:(0,P.jsx)(h.FormattedMessage,{...p})}),(0,P.jsx)("span",{style:cn.jy,children:(0,P.jsx)(h.FormattedMessage,{...m})})]})})]})}const pn=(0,h.defineMessages)({createAutomationViewMenuTitle:{id:"collectionSettings.createStatusAutomationView.menuTitle",defaultMessage:"New automation"},editAutomationViewMenuTitle:{id:"collectionSettings.editStatusAutomationView.menuTitle",defaultMessage:"Edit automation"},addTriggerLabel:{defaultMessage:"Add trigger",id:"collectionSettings.editAutomationView.triggerSection.placeholder"},addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger"},addActionLabel:{defaultMessage:"Add action",id:"AutomationActionSelectButton.actionSection.addAction"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},deleteButton:{id:"collectionSettings.editAutomationView.deleteButton",defaultMessage:"Delete"},triggerTitle:{defaultMessage:"When any of these occur",id:"collectionSettings.editAutomationView.triggerSection.title"},actionTitle:{defaultMessage:"Do this",id:"collectionSettings.editAutomationView.actionSection.title"},automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}}),mn=()=>{};function gn(e){window.__c={n:"CollectionSettingsEditAutomationView"};const{collectionSettingsStore:t,collectionContextStore:o,...S}=e,x=(0,n.useMemo)((()=>S),[]),{mode:b}=x,C=(0,h.useIntl)(),k=(0,Ho.D)(),w=(0,i.O7)(),{isMobile:M}=(0,i.Fy)(),j=(0,ge.d)(),_=(0,Uo.E)("automation_ui_unify"),[T,V]=(0,n.useState)([]),I="create"===b,F=(0,$o.$)("CollectionSettingsEditAutomationView",{cacheFallback:w.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),Z=(0,r.VK)((()=>qo.default.state.currentUserStore),[]),B=(0,r.VK)((()=>null==Z?void 0:Z.userId),[Z]),K=(0,r.VK)((()=>null==Z?void 0:Z.getDisplayName(C)),[Z,C]),R=(0,r.VK)((()=>(0,$.sX)()),[]),O=(0,r.VK)((()=>o.collectionStore()),[o]),L=(0,r.VK)((()=>null==O?void 0:O.getSpaceId()),[O]),H=(0,r.VK)((()=>null==O?void 0:O.id),[O]),U=(0,r.VK)((()=>null==O?void 0:O.getSchema()),[O]),q=(0,r.VK)((()=>(0,zo.jI)({timelineViewTab:"timeline",collectionContextStore:o})),[o]),G=(0,n.useMemo)((()=>"update"===x.mode?x.automationId:(0,u.ZP)()),[x]),Q=(0,r.VK)((()=>o.aliveAutomationCount.state),[o]),Y=(0,r.VK)((()=>{if(L&&O&&B)return new Ie.Mz(w,{id:G,table:m.cv,spaceId:L})}),[G,O,B,w,L]),X=(0,r.VK)((()=>(null==Y?void 0:Y.getStatus())??"disabled"),[Y]),J="active"===X,ee=(0,r.VK)((()=>(0,s.XO)(C,K)),[K,C]),te=(0,r.VK)((()=>{if(!L||!O||!B)return;const e={id:G,table:m.cv,spaceId:L},t=F.getEntry({pointer:e,userId:B});return t?t.value.value:z.sA({automationId:G,automationName:ee,collectionStore:O,userId:B})}),[ee,G,O,B,L,F]),{maybePersistedAutomationStore:oe,maybePersistedTransactionActions:ne,hasUnpersistedChanges:ie}=(0,Wo.$)({automationId:G,spaceId:L,defaultValue:I?te:void 0,persist:!1}),re=(0,r.VK)((()=>{if(!L||!O)return;const e={id:G,table:m.cv,spaceId:L},t=F.getEntry({pointer:e,userId:B});I&&!(0,g.$K)(t)&&B&&F.setRecord({pointer:e,userId:B},{role:"editor",value:te});const o=new Ie.Mz(w,e,{inMemoryRecordCache:F});return z.Xd(o)?o:void 0}),[te,G,O,B,w,I,L,F]),ae=(0,r.VK)((()=>{const e=_?oe:re;if(e&&z.Xd(e))return e}),[_,re,oe]),le=(0,r.VK)((()=>(null==ae?void 0:ae.getName())??""),[ae]),se=(0,r.VK)((()=>{var e;return(null==ae||null===(e=ae.getOwnerStore())||void 0===e?void 0:e.getDisplayName(C))??""}),[C,ae]),ce=(0,r.VK)((()=>{if(ae&&(0,z.Xd)(ae)){const e=ae.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();if(e&&"filter"!==e.type)return e.pointer}}),[ae]),de=(0,r.VK)((()=>((null==ae?void 0:ae.getActionStores())??[]).filter((e=>e.isDefined()))),[ae]),ue=function(e){const{actionStores:t,automationStore:o,loadingStatus:n,mode:i}=e;return(0,r.VK)((()=>"create"===i?"edit":"resolved"===n&&o&&t?(0,z.i1)({automationStore:o,actionStores:t})?"edit":(0,z.qM)({automationStore:o})?"readonly_with_delete":"readonly":"readonly"),[i,n,o,t])}({automationStore:ae,actionStores:de,loadingStatus:"resolved",mode:x.mode}),fe="readonly_with_delete"===ue||"edit"===ue&&!I,Se="edit"===ue,ve=(0,r.VK)((()=>{if(!ae||!Z)return!1;const e=Z.pointer,t=ae.getCreatedByPointer();return!(!e||!t)&&p.dr.isEqual(e,t)}),[ae,Z]),xe=(0,A.X)({automationStore:ae,collectionStore:O}),be=(0,A.X)({automationStore:Y,collectionStore:O}),Ce=function(e){const{contextStore:t}=e,[o,i]=(0,n.useState)([]),a=(0,r.VK)((()=>t?(0,N.uV)(t.context.automationStore,t.context.type):void 0),[t]);return(0,r.VK)((()=>{a?(0,z.P$)({automationAvailabilityContext:a}).then((e=>i(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(e))),(()=>i([]))):o.length>0&&i([])}),[o.length,a]),o}({contextStore:xe}),we=(0,r.VK)((()=>!!(0,g.$K)(ae)&&function(e){if(!(0,z.Xd)(e))return!1;const t=e.getTriggerStore().getKeyStore("event").getValue();return(null==t?void 0:t.pagesAdded)||"none"!==(null==t?void 0:t.pagePropertiesEdited.type)}(ae)),[ae]),Me=(0,r.VK)((()=>!!(0,g.$K)(ae)&&function(e){return e.getActionIds().length>0}(ae)),[ae]),je=0===Ce.length,_e=(0,r.VK)((()=>!(!ae||!O)&&z.vM({automationStore:ae,collectionStore:O})),[ae,O]),Ae=(0,r.VK)((()=>!!(O&&ae&&xe)&&z.qk({automationContextStore:xe,automationStore:ae,collectionStore:O})),[xe,ae,O]),Te=(0,r.VK)((()=>!!(O&&Y&&be)&&z.qk({automationContextStore:be,automationStore:Y,collectionStore:O})),[O,be,Y]),Pe=_?ie:(0,Qo.B)({automationStorePointer:null==ae?void 0:ae.pointer,defaultRecordCache:w.defaultRecordCache.inMemoryRecordCache,inMemoryRecordCache:F,userId:B}),Ve=(0,n.useMemo)((()=>({type:"eventTriggers"})),[]),Ze=(0,n.useMemo)((()=>({type:"eventActions",availableActions:Ce})),[Ce]);!function(e){const{automationStore:t,collectionStoreId:o,eventTracker:i}=e,[a,s]=(0,n.useState)(!1),c=(0,r.VK)((()=>(null==t?void 0:t.getActionIds().length)??0),[t]),d=(0,r.VK)((()=>{if(!t||!(0,z.Xd)(t))return 0;const e=t.getTriggerStore().getKeyStore("event");let o=0;e.getKeyStore("pagesAdded").getValue()&&o++;const n=e.getKeyStore("pagePropertiesEdited").getValue();return"any"===(null==n?void 0:n.type)?o++:"some"===(null==n?void 0:n.type)&&(o+=n.some.length),o}),[t]);(0,n.useEffect)((()=>{i&&o&&!a&&t&&((0,l.nC)(i,{automation_id:t.id,automation_total_actions:c,automation_total_triggers:d,collection_id:o}),Yo.default.logEvent("automation_configure_view","true"),s(!0))}),[i,o,a,c,d,null==t?void 0:t.id,t])}({automationStore:ae,collectionStoreId:H,eventTracker:k});const Be=(0,r.VK)((()=>!(!Se||!Me)&&(!R||!je)),[Se,Me,je,R]),Re=z.EE({automationStore:ae,currentUserId:B,inMemoryRecordCache:F}),Oe=(0,n.useCallback)((()=>{O&&ae&&Pe&&("create"===b?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,intl:r}=e;Go.aO({automationStore:t,collectionStore:n,environment:i,intl:r}),v.oV({label:(0,P.jsx)(h.FormattedMessage,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:t.getName()}})}),f.z$({collectionSettingsStore:o})}({automationStore:ae,collectionSettingsStore:t,collectionStore:O,environment:w,intl:C}):"update"===b?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i}=e;Go.hY({automationStore:t,collectionStore:n,environment:i}),v.oV({label:(0,P.jsx)(h.FormattedMessage,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:t.getName()}})}),f.z$({collectionSettingsStore:o})}({automationStore:ae,collectionSettingsStore:t,collectionStore:O,environment:w}):(0,g.t1)(b))}),[ae,t,O,w,Pe,C,b]),We=(0,n.useCallback)((()=>{ae&&O&&Go.j3({automationStore:ae,collectionStore:O,environment:w})}),[O,w,ae]),De=(0,n.useCallback)((()=>{ae&&O&&Go.$K({automationStore:ae,collectionStore:O,environment:w})}),[O,w,ae]),Ee=(0,n.useCallback)((async()=>{ae&&O&&!I&&await Go.SC({intl:C,environment:w,existingAutomationStore:ae,collectionStore:O,triggerType:"event",onDelete:()=>{1===Q?f.wl({collectionSettingsStore:t,item:{type:"main"}}):f.z$({collectionSettingsStore:t})}})}),[Q,ae,t,O,w,C,I]),Ne=(0,n.useCallback)((async()=>{await yn({automationName:le,hasPendingChanges:Pe})&&(0===Q?f.wl({collectionSettingsStore:t,item:{type:"main"}}):f.z$({collectionSettingsStore:t}))}),[Q,le,t,Pe]),Le=(0,n.useCallback)((async()=>{await yn({automationName:le,hasPendingChanges:Pe})&&f.E3({collectionSettingsStore:t})}),[le,t,Pe]);!function(e){const{hasPendingChanges:t,onClick:o}=e;(0,n.useEffect)((()=>{async function e(e){const n=e.target;if(t&&e.eventPhase===Event.CAPTURING_PHASE&&n instanceof Element){if((0,Xo.jM)(n)||(0,Xo.yT)(n))return;e.stopPropagation(),e.preventDefault(),await o()}}return window.addEventListener("click",e,{capture:!0}),()=>{window.removeEventListener("click",e,{capture:!0})}}),[t,o])}({hasPendingChanges:Pe,onClick:Le});const ze=(0,n.useCallback)((async()=>{await yn({automationName:le,hasPendingChanges:Pe})&&(f.wl({collectionSettingsStore:t,item:{type:"main"}}),f.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}}),f.H4({collectionSettingsStore:t,item:{type:"deletedProperties",timelineViewTab:"timeline"}}))}),[le,t,Pe]),He=(0,n.useCallback)((async e=>{await yn({automationName:le,hasPendingChanges:Pe})&&(f.wl({collectionSettingsStore:t,item:{type:"main"}}),f.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}}),f.H4({collectionSettingsStore:t,item:{type:"property",formatKey:q,property:e}}))}),[le,t,q,Pe]),Ue=(0,r.VK)((()=>e=>{if(Re(e),H&&U&&ae)if("update_trigger"===e.type||"remove_trigger"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("page_added"===t.trigger.type)r={type:"page"};else if("any_page_property_edited"===t.trigger.type)r={condition:"any",type:"property"};else if("property_changed"===t.trigger.type){const e=i[t.trigger.property];if(!e)return;r={condition:"some",property_types:[e.type],type:"property"}}else(0,g.t1)(t.trigger);return{automation_id:o,automation_trigger:r,collection_id:n}}({action:e,automationId:G,collectionStoreId:H,schema:U});if(!t)return;"remove_trigger"===e.type?(0,l.Ey)(k,t):"update_trigger"===e.type&&function(e,t){if(!(0,z.Xd)(t))return!0;const o=t.getTriggerStore().getKeyStore("event");if("page_added"===e.type&&!0===o.getKeyStore("pagesAdded").getValue())return!1;if("any_page_property_edited"===e.type&&"any"===o.getKeyStore("pagePropertiesEdited").getKeyStore("type").getValue())return!1;if("property_changed"===e.type){const t=o.getKeyStore("pagePropertiesEdited").getValue();if("some"===(null==t?void 0:t.type)&&t.some.some((t=>t.property===e.property)))return!0}return!0}(e.trigger,ae)&&(0,l.nK)(k,t)}else if("update_action"===e.type||"remove_action"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("slack_notification"===t.action.type)r={type:"slack_notification"};else{if("update_pages"!==t.action.type)return;var a;r={property_types:((null===(a=t.action.config)||void 0===a?void 0:a.properties)??[]).map((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.type})).filter(g.$K),type:"update_pages"}}return{automation_action:r,automation_action_id:t.action.id,automation_id:o,collection_id:n}}({action:e,automationId:G,collectionStoreId:H,schema:U});if(!t)return;"remove_action"===e.type?(0,l.OK)(k,t):"update_action"===e.type&&function(e,t){return!t.getActionIds().includes(e.id)}(e.action,ae)&&(0,l.A2)(k,t)}}),[G,ae,U,H,k,Re]),$e=(0,n.useCallback)((e=>{const t=e.target.value;Ue({type:"update_name",name:t})}),[Ue]),qe=(0,n.useCallback)((e=>{Ue({type:"update_source",pointer:e})}),[Ue]),Ge=(0,n.useCallback)((e=>{V((t=>[...t,e.id]))}),[]),Qe=function(e){const t=4,{showDeleteEnableDisableOptions:o}=e,{isMobile:n}=(0,i.Fy)();return(0,a.yK)((e=>({automationSection:{display:"flex",flexDirection:"column",gap:t},automationSectionAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},automationSectionHeader:{alignItems:"center",display:"flex",flexDirection:"row"},automationSectionHeaderAction:{background:`linear-gradient(to right, ${e.stroke.regular} 50%, transparent 50%), linear-gradient(to right, ${e.stroke.regular} 50%, transparent 50%)`,backgroundPosition:"20px 0px, 20px bottom",backgroundRepeat:"no-repeat",backgroundSize:`2px 36px, 2px ${t+2}px`,marginBlockEnd:-t,paddingBlock:`36px ${t}px`,position:"relative"},automationSectionTitle:{color:e.lightTextColor,fontSize:n?14:12,lineHeight:1.3,position:"relative",fontWeight:y.Z.fontWeight.medium},automationCreateMobile:{boxShadow:"none",paddingBlock:"0 12px",paddingInline:12},automationCreateDesktop:{paddingBlock:o?"12px 0":12,paddingInline:12},automationCreateButton:{...n?{minHeight:45}:{},width:"100%"},automationNameInput:{marginBlockEnd:n?void 0:8},automationNameText:{marginInlineStart:12},automationOptionIconDesktop:{marginInlineStart:12},menuScroller:{...n?{}:{marginBlockStart:6}},wrap:{borderTop:`1px solid ${e.regularDividerColor}`,paddingBlockStart:15,paddingBlockEnd:12,paddingInline:12}})),[n,o])}({showDeleteEnableDisableOptions:fe}),Ye=[],Xe=Pe&&Ae;if(Se&&Ye.push((0,P.jsx)(E.Z,{mobileStyle:Qe.automationCreateMobile,style:Qe.automationCreateDesktop,topBorder:!M,children:(0,P.jsx)(Eo.Z,{onClick:Oe,disabled:!Xe,style:Qe.automationCreateButton,children:I?(0,P.jsx)(h.FormattedMessage,{id:"collectionSettings.editAutomationView.createButton.label",defaultMessage:"Create"}):(0,P.jsx)(h.FormattedMessage,{id:"collectionSettings.editAutomationView.saveButton.label",defaultMessage:"Save"})})})),fe&&Ye.push((0,P.jsx)(E.Z,{disableMobilePadding:!0,topBorder:M||0===Ye.length,children:(0,P.jsx)(ke.Z,{desktopIconStyle:Qe.automationOptionIconDesktop,icon:d.y,isRed:!0,onClick:Ee,title:C.formatMessage(pn.deleteButton)})})),!O||!ae)return null;const Je=I?C.formatMessage(pn.createAutomationViewMenuTitle):C.formatMessage(pn.editAutomationViewMenuTitle),et=X&&se&&(0,P.jsx)(nn,{automationStore:ae,collectionStore:O,automationPermissionScope:ue,referencesIncompatibleCollectionViewFilter:_e,onDelete:Ee});return(0,P.jsx)(Lo.Z,{capture:!0,onEsc:Le,children:(0,P.jsx)(Do.ZP,{title:Je,collectionSettingsStore:t,collectionContextStore:o,handleBackArrowClick:Ne,handleClose:Le,footer:Ye,fullHeight:!0,menuScrollerStyle:Qe.menuScroller,children:(0,P.jsxs)(Oo.Z.Provider,{value:{automationContextStore:xe,automationStore:ae,collectionStore:O,disabled:!Se,disableTooltip:!Se,editorPlacement:{type:"inline"},editorWidth:Do.nJ,maybePersistedTransactionActions:ne,onActionAdded:Ge,suppressActionErrors:T},children:[et,(0,P.jsx)(D.Z,{type:D.i.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>(0,P.jsx)(W.ZP,{style:Qe.automationNameInput,...e,value:le??"Loading...",onChange:$e,disabled:!Se,textWrapperStyle:Qe.automationNameText})},{key:"automation_source",action:mn,render:e=>(0,P.jsx)(Fe,{menuListItemProps:e,selectedSourcePointer:ce,collectionContextStore:o,onSelect:qe,disabled:!Se})}],render:e=>(0,P.jsx)(E.Z,{...e,disableMobilePadding:Boolean(et)})}]}),(0,P.jsxs)("div",{style:Qe.wrap,children:[Te&&fe&&(0,P.jsx)(un,{automationId:ae.id,automationOwner:se,isAutomationPaused:!J,onPause:We,onResume:De}),_?(0,P.jsx)(Ke._v,{areActionsEditable:Se,areTriggersEditable:Se}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("section",{style:Qe.automationSection,children:[(0,P.jsxs)("header",{style:Qe.automationSectionHeader,children:[(0,P.jsx)("div",{style:Qe.automationSectionTitle,children:(0,P.jsx)(h.FormattedMessage,{...pn.triggerTitle})}),(0,P.jsx)("div",{style:{...Qe.automationSectionAdd,visibility:we&&Se?void 0:"hidden"},children:(0,P.jsx)(me.ZP,{popupType:j,alignmentToOrigin:me.vR.End,placementToOrigin:me.pO.Bottom,renderOrigin:e=>(0,P.jsx)(No.Z,{...e,ariaLabel:C.formatMessage(pn.addTriggerAriaLabel),icon:c.R}),render:e=>O&&(0,P.jsx)(at,{automationStore:ae,collectionStore:O,initialState:Ve,updateCurrentAutomationState:Ue,buttonPopupParent:e})})})]}),we?(0,P.jsx)(Ct,{automationStore:ae,collectionStore:O,updateCurrentState:Ue,handleNavigateToDeletedProperties:ze,handleNavigateToEditProperty:He,disabled:!Se}):(0,P.jsx)(me.ZP,{popupType:j,renderOrigin:e=>(0,P.jsx)(ye.D,{...e,icon:(0,c.R)({height:24,width:12}),title:(0,P.jsx)(h.FormattedMessage,{...pn.addTriggerLabel})}),render:e=>O&&(0,P.jsx)(at,{automationStore:ae,collectionStore:O,initialState:Ve,updateCurrentAutomationState:Ue,buttonPopupParent:e})})]}),(0,P.jsxs)("section",{style:Qe.automationSection,children:[(0,P.jsxs)("header",{style:{...Qe.automationSectionHeader,...Qe.automationSectionHeaderAction},children:[(0,P.jsx)("div",{style:Qe.automationSectionTitle,children:(0,P.jsx)(h.FormattedMessage,{...pn.actionTitle})}),(0,P.jsx)("div",{style:{...Qe.automationSectionAdd,visibility:Be?void 0:"hidden"},children:(0,P.jsx)(me.ZP,{alignmentToOrigin:me.vR.End,placementToOrigin:me.pO.Bottom,popupType:j,render:e=>(0,P.jsx)(pe,{automationStore:ae,buttonPopupParent:e,collectionStore:O,initialState:Ze,updateCurrentAutomationState:Ue}),renderOrigin:e=>(0,P.jsx)(No.Z,{...e,ariaLabel:C.formatMessage(pn.addActionAriaLabel),icon:c.R})})})]}),Me?(0,P.jsx)(Ko,{automationStore:ae,collectionStore:O,handleNavigateToDeletedProperties:ze,handleNavigateToEditProperty:He,updateCurrentAutomationState:Ue,currentUserIsOwner:ve,disabled:!Se}):(0,P.jsx)(he,{automationStore:ae,collectionStore:O,initialState:Ze,updateCurrentAutomationState:Ue})]})]})]})]})})})}async function yn(e){const{automationName:t,hasPendingChanges:o}=e;return!o||await S.confirmUserAction({message:(0,P.jsx)(h.FormattedMessage,{id:"automations.confirmDiscardChanges.message",defaultMessage:"{hasName, select, true {Are you sure you want to discard {automationName}?} other {Are you sure you want to discard this automation?}}",values:{automationName:t,hasName:Boolean(t)}}),acceptLabel:(0,P.jsx)(h.FormattedMessage,{id:"automations.confirmDiscardChanges.acceptLabel",defaultMessage:"Discard"})})}},40863:(e,t,o)=>{o.d(t,{BO:()=>f,Ft:()=>p,Lh:()=>b,YG:()=>m,du:()=>h,y$:()=>y});o(57658);var n=o(30120),i=o(30823),r=o(40506),a=o(53877),l=o(42875),s=o(72126),c=o(59753),d=o(9291),u=o(28020);function p(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,i=o.getQuery(n);if(!i||!i.calendar_by)return;const r=t.dateRangeStart.state,s=t.dateRangeEnd.state,c=(0,a.hT)(r,(0,l.r)()),d=(0,a.hT)(s,(0,l.r)());return g({calendarBy:i.calendar_by,dateRangeStartDate:c,dateRangeEndDate:d})}function m(e){const{collectionContextStore:t,startOfDay:o}=e,i=t.collectionViewStore();if(!i)return;const r=t.normalizedSchemaStore.state,s=i.getQuery(r);if(!s||!s.calendar_by)return;const c=n.ou.fromMillis(o).endOf("day").valueOf(),d=(0,a.hT)(o,(0,l.r)()),u=(0,a.hT)(c,(0,l.r)());return g({calendarBy:s.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function g(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function y(e){const{collectionContextStore:t,results:o,getRecordValue:n,intl:i}=e,c=t.collectionViewStore(),d=t.normalizedQueryStore.state,p=t.normalizedSchemaStore.state,m=d?d.calendar_by:void 0,g=t.dateRangeStart.state,y=t.dateRangeEnd.state,v=u.AK.state,x=(0,l.r)(),b=t.getCurrentUserId();if(!(c&&d&&m&&p))return;const C=s.oA(o.map((e=>f({blockStore:e,calendarBy:m,schema:p,getRecordValue:n,userId:b,intl:i})))),k={};o.forEach(((e,t)=>{k[e.id]=t}));0===(d.sort||[]).length&&C.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return k[e.id]-k[t.id]}return o-n}));const w=(0,a.em)(g,v,x),M=(0,a.gQ)(y,v,x);let j=w;const _=[];do{const e=(0,a.gQ)(j.valueOf(),v,x),t={},o=C.filter((t=>(0,r.b8)(j.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:i,end:r,includeTime:a,timeZone:l}=o,{startColumn:s,columnCount:c}=h({startUnixTimestampMS:i.valueOf(),endUnixTimestampMS:r?r.valueOf():void 0,startOfWeekUnixTimestampMS:j.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=S(s,c,t);return{id:n,start:i.valueOf(),end:r?r.valueOf():void 0,row:d,includeTime:a,timeZone:l}}));_.push({start:j.valueOf(),end:e.valueOf(),items:o}),j=(0,a.em)(j.plus({week:1}).plus({hour:25}).valueOf(),v,x)}while(j<M);return _}function h(e){const t=n.ou.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?n.ou.fromMillis(e.endUnixTimestampMS):void 0,i=n.ou.fromMillis(e.startOfWeekUnixTimestampMS),r=n.ou.fromMillis(e.endOfWeekUnixTimestampMS),a=t.startOf("day"),l=n.ou.max(i,a),s=Math.ceil(l.diff(i,"days").get("days"));let c=1;if(o){const e=o.endOf("day"),t=n.ou.min(r,e);c=Math.ceil(t.diff(l,"days").get("days"))}return{start:t,end:o,startOfWeek:i,endOfWeek:r,startColumn:s,columnCount:c}}function f(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:r,intl:s,userId:d}=e,u=t.getAssociatedCollectionStore(),p=t.getModel();if(!p)return;const m=(0,i.FT)({property:o,schema:n,block:p,getRecordModel:c.om.fromGetRecordValueFn(r),propertyMapping:null==u?void 0:u.getPropertyMapping(),collectionRequestContext:{userId:d,userTimeZone:(0,l.r)(),depth:0,intl:s,visitedProperties:new Set,resultCache:new Map}}).next().value;if("date"!==m.type)return;const g=m.value,y=g&&(0,a.NK)(g,(0,l.r)());if(!g||!y)return;return{id:p.id,start:y.start,end:y.end,includeTime:"datetime"===g.type||"datetimerange"===g.type,timeZone:"datetime"===g.type||"datetimerange"===g.type?g.time_zone:void 0}}function S(e,t,o){let n=0;for(;;){let i=!1;for(let r=0;r<t;r++)v(o,e+r,n)&&(i=!0);if(!i)break;n++}for(let i=0;i<t;i++)x(o,e+i,n);return n}function v(e,t,o){return Boolean(e[o]&&e[o][t])}function x(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}const b=(0,d.defineMessages)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},54802:(e,t,o)=>{o.d(t,{EE:()=>Z,EF:()=>U,Li:()=>R,P$:()=>Y,R4:()=>Q,WM:()=>D,Xd:()=>I,cB:()=>H,i1:()=>O,j_:()=>X,qM:()=>W,qk:()=>B,rU:()=>z,sA:()=>q,tk:()=>$,vM:()=>L,wB:()=>K});o(21703),o(57658);var n=o(43261),i=o.n(n),r=o(67294),a=o(86628),l=o(3865),s=o(28751),c=o(23290),d=o(76205),u=o(1274),p=o(84116),m=o(78106),g=o(76218),y=o(72126),h=o(86517),f=o(4615),S=o(149),v=o(98963),x=o(18844),b=o(77420),C=o(6287),k=o(13493),w=o(97880),M=o(77080),j=o(30874),_=o(26136),A=o(35057),T=o(49117),P=o(52821),V=o(33929);function I(e){return e.isTriggerType("event")||e.isTriggerType("notification_event")}function F(e){const{action:t,actionValue:o,automationValue:n}=e;var i,r,a,l,s,c,d;if("create_page"===t.action.type){if(!o||"create_page"===o.type)return function(e){const{actionId:t,automationId:o,collectionPointer:n,properties:i,values:r,spaceId:a,templatePageId:l}=e;return{...G({actionId:t,actionType:"create_page",automationId:o,spaceId:a}),config:{collection:n,properties:i,values:r,template_page_id:l}}}({actionId:t.action.id,automationId:n.id,collectionPointer:(null===(i=t.action.config)||void 0===i?void 0:i.collection)??(null==o||null===(r=o.config)||void 0===r?void 0:r.collection),properties:(null===(a=t.action.config)||void 0===a?void 0:a.properties)??(null==o||null===(l=o.config)||void 0===l?void 0:l.properties),spaceId:n.space_id,values:(null===(s=t.action.config)||void 0===s?void 0:s.values)??(null==o||null===(c=o.config)||void 0===c?void 0:c.values),templatePageId:null===(d=t.action.config)||void 0===d?void 0:d.template_page_id})}else if("update_pages"===t.action.type){var u,p,m,g,y,h;if(!o||"update_pages"===o.type)return function(e){const{actionId:t,automationId:o,properties:n,spaceId:i,target:r,values:a}=e;return{...G({actionId:t,actionType:"update_pages",automationId:o,spaceId:i}),config:{target:r,properties:n,values:a}}}({actionId:t.action.id,automationId:n.id,properties:(null===(u=t.action.config)||void 0===u?void 0:u.properties)??(null==o||null===(p=o.config)||void 0===p?void 0:p.properties),spaceId:n.space_id,target:(null===(m=t.action.config)||void 0===m?void 0:m.target)??(null==o||null===(g=o.config)||void 0===g?void 0:g.target),values:(null===(y=t.action.config)||void 0===y?void 0:y.values)??(null==o||null===(h=o.config)||void 0===h?void 0:h.values)})}else if("slack_notification"===t.action.type){var f,S,v,x;if(!o||"slack_notification"===o.type)return function(e){const{actionId:t,automationId:o,externalBotId:n,spaceId:i,target:r}=e;return{...G({actionId:t,actionType:"slack_notification",automationId:o,spaceId:i}),config:{target:r,external_bot_id:n}}}({actionId:t.action.id,automationId:n.id,externalBotId:(null===(f=t.action.config)||void 0===f?void 0:f.external_bot_id)??(null==o||null===(S=o.config)||void 0===S?void 0:S.external_bot_id),spaceId:n.space_id,target:(null===(v=t.action.config)||void 0===v?void 0:v.target)??(null==o||null===(x=o.config)||void 0===x?void 0:x.target)})}else{if("duplicate_blocks"===t.action.type||"modal_confirmation"===t.action.type||"open_page"===t.action.type||"query_collection"===t.action.type||"complete_sprint"===t.action.type||"assistant"===t.action.type)return;(0,w.t1)(t.action)}}function Z(e){const{automationStore:t,currentUserId:o,inMemoryRecordCache:n}=e;return(0,a.VK)((()=>{const e=null==t?void 0:t.getRole(),i=null==t?void 0:t.getValue(),r=(null==t?void 0:t.getActionStores().map((e=>e.getValue())).filter(w.$K))??[],a=null==t?void 0:t.pointer;return c=>{if(o&&e&&i&&a){if(!(0,l.Vd)(i)&&!(0,l.nl)(i))return i;if("update_name"===c.type){const t=function(e){var t;const{action:o,automationValue:n}=e;return(null===(t=n.properties)||void 0===t?void 0:t.name)!==o.name?{...n,properties:{...n.properties,name:o.name}}:n}({action:c,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_source"===c.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.pointer,i=n.table===C.v?{pointer:n,type:C.v}:{pointer:n,type:k.n};return{...o,trigger:{...o.trigger,event:{...o.trigger.event,source:i}}}}({action:c,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_trigger"===c.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?o:{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!0}}};if("any_page_property_edited"===n.type)return"any"!==o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"any"}}}}:o;if("property_changed"===n.type){const e="some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[],t=y.cx(e,(e=>e.property===n.property)),i={filter:n.filter,property:n.property},r=-1===t?[...e,i]:e.map((e=>e.property===n.property?i:e));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{some:r,type:"some"}}}}}(0,w.t1)(n)}({action:c,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_action"===c.type){var d;const t=r.find((e=>e.id===c.action.id)),l=F({action:c,actionValue:t,automationValue:i});if(!l)return;if(n.setRecord({pointer:{id:l.id,spaceId:i.space_id,table:x.Xj},userId:o},{role:"editor",value:l}),null===(d=i.action_ids)||void 0===d||!d.includes(l.id)){const t={...i,action_ids:[...i.action_ids??[],l.id]};n.setRecord({pointer:a,userId:o},{role:e,value:t})}n.emitAll()}else if("remove_action"===c.type){const r=c.action.id;n.deleteRecord({pointer:{id:r,spaceId:i.space_id,table:x.Xj},userId:o});const l={...i,action_ids:(i.action_ids??[]).filter((e=>e!==r))};n.setRecord({pointer:a,userId:o},{role:e,value:l}),function(e){const{automationStore:t,newAutomationValue:o,currentUserId:n,inMemoryRecordCache:i}=e,r=t.getParentStore();if((null==r?void 0:r.table)!==C.v)return;const a={automationStore:t,parentPointer:r.getSpaceShardedPointer(),type:"event",persisted:!0,intl:V.default.getIntl(),parentRecordStore:r},l=(0,T.pt)({context:a,automationValue:o});if(S.x.isFail(l))return;const c=(o.action_ids??[]).map((e=>({pointer:{id:e,spaceId:o.space_id,table:x.Xj},userId:n})));for(const u of c){const e=i.getRecordModel(u),t=i.getRecord(u);if(!e||!t||!t.value||"create_page"!==t.value.type&&"update_pages"!==t.value.type)continue;const o=new Set(l.value.actionInputValueTypes[e.id].map((e=>{if(e.kind===p.yp.ContextValue)return e.id;e.kind!==p.yp.ThisRow&&e.kind!==p.yp.Binding&&(0,w.t1)(e)})).filter(w.$K)),n=(0,s.z)(e.type).acceptFormulaVisitor({action:e,visitor:{visitVariableOutsideOfFormula:e=>o.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormula:e=>e.value&&(0,g.UB)(e).some((e=>!o.has(e)))?{type:"replace",value:void 0}:{type:"keep"}}});let r=t.value;for(const i of n)if("update"===i.command)if(1===i.path.length&&"config"===i.path[0]&&Object.keys(i.args).includes("target")&&"update_pages"===r.type)r={...r,config:{target:void 0,properties:[],values:{}}};else if(2===i.path.length&&"config"===i.path[0]&&"values"===i.path[1]){var d;const e=Object.keys(i.args)[0];r={...r,config:{...r.config,values:{...null===(d=r.config)||void 0===d?void 0:d.values,[e]:void 0}}}}i.setRecord(u,{value:r,role:t.role})}}({automationStore:t,newAutomationValue:l,currentUserId:o,inMemoryRecordCache:n}),n.emitAll()}else if("remove_trigger"===c.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!1}}}:o;if("any_page_property_edited"===n.type)return"any"===o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"none"}}}}:o;if("property_changed"===n.type){const e=("some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[]).filter((e=>e.property!==n.property));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:e.length>0?{some:e,type:"some"}:{type:"none"}}}}}(0,w.t1)(n)}({action:c,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else(0,w.t1)(c)}}}),[t,o,n])}function B(e){const{automationContextStore:t,automationStore:o,collectionStore:n}=e,i=n.getSchema(),r=o.getKeyStore("properties").getKeyStore("name").getValue();if(null==r||!r.trim())return!1;const a=o.getTrigger(),l="event"===(null==a?void 0:a.type),s="notification_event"===(null==a?void 0:a.type);if(!l&&!s)return!1;const{pagesAdded:c,pagePropertiesEdited:d,source:u}=a.event;if(void 0===u)return!1;if("some"===d.type&&d.some.some((e=>E({collectionSchema:i,property:e.property})||N({collectionSchema:i,property:e.property,type:"trigger"}))))return!1;if(!c&&("none"===d.type||"some"===d.type&&0===d.some.length))return!1;const p=o.getActionStores().filter((e=>e.isDefined()));return 0!==p.length&&p.every((e=>function(e){const{actionStore:t,automationContextStore:o,collectionStore:n}=e;if(t.isType("slack_notification"))return(0,w.$K)(t.getConfigStore().getKeyStore("external_bot_id").getValue())&&(0,w.$K)(t.getConfigStore().getKeyStore("target").getValue());if(t.isType("update_pages")){const e=t.getConfigStore().getKeyStore("target").getValue(),i=t.getConfigStore().getKeyStore("properties").getValue()??[];if(!(0,w.$K)(e)||0===i.length)return!1;if("collection"===e.type){const t=_.NW.createChildStore(n,e.collection).getSchema();if(i.some((e=>E({property:e,collectionSchema:t})||N({collectionSchema:t,property:e,type:"action"}))))return!1}else if("variable"===e.type){const t=(0,m.MY)(e.id);if("global"===t.source&&"button_page"===t.global){const e=n.getSchema();if(i.some((t=>E({property:t,collectionSchema:e})||N({collectionSchema:e,property:t,type:"action"}))))return!1}else{const t=null==o?void 0:o.compilationResultStore.state;if(!t||S.x.isFail(t))return!1;const n=(0,m.vx)(t.value.valueTypes,e.id),r=n?K(n,o.context.parentRecordStore):void 0;if(!r)return!1;const a=r.getSchema();if(i.some((e=>E({property:e,collectionSchema:a})||N({collectionSchema:a,property:e,type:"action"}))))return!1}}else{if("page"===e.type)return!1;(0,w.t1)(e)}return!0}if(t.isType("create_page")){const e=t.getConfigStore().getKeyStore("collection").getValue();if(!(0,w.$K)(e))return!1;const o=_.NW.createChildStore(n,e).getSchema();return!(t.getConfigStore().getKeyStore("properties").getValue()??[]).some((e=>E({property:e,collectionSchema:o})||N({collectionSchema:o,property:e,type:"action"})))}throw new Error(`isActionStoreComplete not implemented for ${t.getType()}`)}({actionStore:e,automationContextStore:t,collectionStore:n})))}function K(e,t){let o;return"block"===e.type.type&&e.type.collection?o=_.NW.createChildStore(t,e.type.collection):"array"===e.type.type&&"block"===e.type.of.type&&e.type.of.collection&&(o=_.NW.createChildStore(t,e.type.of.collection)),o}function R(e){const{collectionStore:t}=e;if(!t)return!1;if((t.getFormat().automation_ids??[]).length>=c.ss&&!(0,A.sX)())return!1;const o=t.pointer,n=t.getSpaceId();return(0,u.IC)({targetTriggerType:"event",targetParentPointer:o,targetSpaceId:n}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,h.yY)(i,n)}))}function O(e){const{automationStore:t,actionStores:o}=e,n=t.getMinimumFieldsForPermissions();if(!n)return!1;if(!o.every((e=>e.isDefined())))return!1;const i=o.some((e=>!e.isType("slack_notification")));if(!(0,A.sX)()&&i)return!1;return(0,u.fz)({automationValue:n,actionValues:o.map((e=>({config:e.getConfig(),type:e.getType()})))}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,h.yY)(i,n)}))}function W(e){const{automationStore:t}=e,o=t.getMinimumFieldsForPermissions();if(!o)return!1;return(0,u.bM)(o).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,h.yY)(i,n)}))}function D(e){const{anyOptionCheckState:t,currentFilter:o,propertyId:n,updateCurrentState:i}=e;!0===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):!1===t?i({type:"remove_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):"partial"===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:o}}):(0,w.t1)(t)}function E(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function N(e){const{collectionSchema:t,property:o,type:n}=e,i=null==t?void 0:t[o];return!i||("action"===n?!(0,l.SF)(i):!l.Ym[i.type])}function L(e){const{automationStore:t,collectionStore:o}=e;if(!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return!1;const n=t.getEventConfiguration();if(!n||void 0===n.source||n.source.type===C.v||"filter"===n.source.type)return!1;const i=_.Xr.createChildStore(o,n.source.pointer);return function(e){const t=z(e);return(0,w.$K)(t)}({collectionSchema:o.getSchema(),collectionViewStore:i})}function z(e){var t;const{collectionViewStore:o,collectionSchema:n}=e,i=o.getPropertyFiltersStore().getValue()??[],r=null===(t=o.getQuery(n))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,d.OH)({propertyFilters:i,combinatorFilter:r,schema:n})},s=(0,d.SH)(a,(e=>{if((0,d.aN)(e)){const t=n[e.property];return!!t&&!(0,l.TX)(t)}return!1}));if(s)return(0,d.aN)(s)?s.property:(0,d.Mm)(s)?s.timestamp:void 0}function H(e){if("collectionTypedView"===e.contextType)return!1;const t=e.collectionStore();return!!t&&!(t.isSyncedCollection()&&!M.default.checkGate("support_synced_database_automations"))}function U(e){const{collectionSchema:t,propertyIds:o,searchTerm:n}=e;if(!n)return o.slice(0);const r=new Map,a=o.map((e=>{const o=t[e],n=o?`${o.name} ${P.SO[o.type]}`:"";return r.set(e,n),n})),l=i().filter(n,a).map((e=>{let{original:t}=e;return t}));return o.filter((e=>l.includes(r.get(e)??"")))}function $(e){return S.x.isFail(e.compilationResultStore.state)?[]:e.compilationResultStore.state.value.valueTypes}function q(e){const{automationId:t,automationName:o,collectionStore:n,userId:i}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:n,eventConfiguration:i,lastEditedTime:r,properties:a,userId:l}=e,s=Date.now();return{action_ids:t,alive:!0,created_by_id:l,created_by_table:"notion_user",created_time:s,id:o,last_edited_by_id:l,last_edited_by_table:"notion_user",last_edited_time:r??s,parent_id:n.id,parent_table:C.v,properties:a??{},space_id:n.getSpaceId(),status:"active",trigger:{event:i,id:(0,f.ZP)(),type:"event"},version:1}}({actionIds:[],automationId:t,collectionStore:n,eventConfiguration:{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:n.getSpaceShardedPointer(),type:C.v}},properties:{name:o},userId:i})}function G(e){const{actionId:t,actionType:o,automationId:n,spaceId:i}=e;return{alive:!0,id:t??(0,f.ZP)(),parent_id:n,parent_table:v.cv,space_id:i,type:o,version:1}}function Q(e){const t=e.getActionStores().filter((0,w.AO)((e=>e.isType("slack_notification")?{true:e}:{false:e}))),o={};for(const n of t){const e=n.getConfig(),t=null==e?void 0:e.external_bot_id;if(!t)continue;const i=_.Qx.createChildStore(n,{id:t,spaceId:n.getSpaceId(),table:b.cZ}).getCreatedByStore();i&&(o[n.id]=i.getDisplayName(V.default.getIntl()))}return o}async function Y(e){const{automationAvailabilityContext:t}=e;let o=t.automation.getTriggerType();"notification_event"===o&&(o="event");const n=c.Gl[o],i="default_bound"===n.max?c.xZ:n.max;if(t.automationActions.length>=i)return[];const r=(0,s.P)("display"),a=[];for(const l of r)await l.isAvailableForContext(t)&&a.push(l);return a}function X(){const e=(0,a.VK)((()=>j.Z.completeSlackAuthentications.state),[]);return(0,r.useMemo)((()=>0===e.length?{type:"connectToSlackDefault"}:1===e.length?{type:"selectChannelNew"}:{type:"selectWorkspace"}),[e.length])}},25498:(e,t,o)=>{o.d(t,{m:()=>r,w:()=>a});o(57658);var n=o(81491),i=o(98165);const r=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}],a=e=>{const t=i.qA(e)??[],o=[];for(const n of t){if(!("block"===n.table&&!0===n.isTemplate()&&n.getFormat().automation_id&&n.id!==e.id))continue;const t=n.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,violatesConstraint:(0,n.templateAncestorsViolateRecurrenceNesting)(o)}}},5971:(e,t,o)=>{o.d(t,{E:()=>r});var n=o(86628),i=o(77080);function r(e){return(0,n.VK)((()=>i.default.checkGate(e)),[e])}},68910:(e,t,o)=>{o.d(t,{L:()=>d});var n=o(14577),i=o(78106),r=o(72126),a=o(149),l=o(97880),s=o(49117),c=o(26136);class d{constructor(e){this.context=void 0,this.compilationResultStore=new n.Z((()=>(0,s.pt)({context:this.context})),{useDeepEqual:!0,debugName:"compilationResultsStore"}),this.context=e}getAllContextValues(){const e=this.compilationResultStore.state;return a.x.isFail(e)?[]:r.d9(e.value.valueTypes)}getCollectionStore(){const e=this.context;return"button_block"===e.type?e.pageStore.getAssociatedCollectionStore():"button_property"===e.type?e.collectionContextStore.collectionStore():"event"===e.type?c.NW.createChildStore(e.parentRecordStore,e.parentPointer):void("recurrence"!==e.type&&"structured_automation"!==e.type&&(0,l.t1)(e))}getContextValuesForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionInputValueTypes[e]??[]}getValidationErrorsForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionValidationFailures[e]??[]}getContextValueForActionById(e,t){const o=this.getContextValuesForAction(e);return(0,i.vx)(o,t)}}},91738:(e,t,o)=>{o.d(t,{Bh:()=>a,H0:()=>l});var n=o(49085),i=o(72126);class r extends n.default{getInitialState(){return{insertionPoint:void 0,stack:[]}}getCurrentTab(){return i.Z$(this.getState().stack)}getInsertionPoint(){return this.getState().insertionPoint}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({...e,stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}setInsertionPoint(e){this.update((t=>({...t,insertionPoint:e})))}}class a extends r{}class l extends r{}},36857:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(49085);class i extends n.default{getInitialState(){return{pageId:void 0}}}const r=new i},86488:(e,t,o)=>{o.d(t,{p:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("squarePlus",{viewBox:"0 0 30 30",svg:(0,i.jsx)("path",{d:"M7.059 27.052H22.94c2.75 0 4.11-1.361 4.11-4.059V7.007c0-2.697-1.36-4.059-4.11-4.059H7.059c-2.736 0-4.111 1.349-4.111 4.059v15.986c0 2.71 1.375 4.06 4.11 4.06zm.026-2.108c-1.31 0-2.03-.694-2.03-2.055V7.112c0-1.362.72-2.056 2.03-2.056h15.83c1.296 0 2.029.694 2.029 2.056v15.777c0 1.361-.733 2.055-2.03 2.055H7.085zm7.895-3.758c.707 0 1.113-.484 1.113-1.243V16.08h4.111c.733 0 1.231-.392 1.231-1.086 0-.707-.471-1.113-1.23-1.113h-4.112V9.769c0-.759-.406-1.243-1.113-1.243-.694 0-1.073.51-1.073 1.243v4.112H9.822c-.773 0-1.257.405-1.257 1.112 0 .694.523 1.087 1.257 1.087h4.085v3.863c0 .733.38 1.243 1.073 1.243z"})})}}]);