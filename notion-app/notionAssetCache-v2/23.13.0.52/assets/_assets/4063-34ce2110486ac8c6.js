"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4063],{83692:(e,t,o)=>{o.d(t,{b:()=>h});var r=o(15145),i=o(50906),n=o(49865),s=o(14900),l=o(75754),a=o(24677),c=o(98104),d=o(75079),p=o(78316),u=o(26999);function h(e){var t;const{transaction:o,environment:h,collectionContextStore:m,isFullScreen:g,groupsPointer:S,insertAtIndex:y,from:v,transient:f,useCrdt:C}=e,x=null===(t=m.groupsStore.getGroupState(S))||void 0===t?void 0:t.resultsStore;if(!x)return;m.searchQuery.state&&s.Ug({searchQuery:"",collectionContextStore:m,isFullScreen:g});const b=n.IW({environment:h,collectionContextStore:m,groupsPointer:S,insertAtIndex:y,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:v,useCrdt:C});if(!b)return;const w=b.coercionSucceeded,k=b.newStore;if(h.device.isMobile)l._({environment:h,store:k,pageVisitSource:r.tY.Create});else if(w){const e=k.getBlockTitleStore();a.eP({environment:h,store:k}),c.NX({store:e}),s.Z5({store:k,transient:f})}else u.CH({environment:h,store:k,peekMode:(0,p.kr)(m.collectionViewStore()),resultsStore:x,collectionContextStore:m,pageVisitSource:r.tY.Create});i.W2j(h,{from:v,type:"page",new_page_id:k.id,creating_block_id:k.id,...(0,d.Pn)(m)})}},8695:(e,t,o)=>{o.d(t,{H7:()=>s,Ut:()=>g,iN:()=>m,pT:()=>l,rd:()=>d,so:()=>c,ui:()=>a});o(21703),o(57658);var r=o(55010),i=o(6027),n=o(4926);function s(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.has(t)||r.state.containerMap.set(t,new Set),r.emit()}function l(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.delete(t),r.emit()}function a(e){const{element:t,container:o}=e,r=function(e){for(;;){const t=m(e);if(!t)return e;e=t}}(o),{store:i}=r.stores,{containerMap:n}=i.state,s=n.get(o);s?s.add(t):n.set(o,new Set([t])),i.emit()}function c(e){const{element:t,container:o}=e,{store:r}=o.stores,{containerMap:i}=r.state,n=i.get(o);n&&n.delete(t),r.emit()}function d(e){const{environment:t,container:o}=e,{device:s}=t,{store:l}=o.stores,{containerMap:a}=l.state,c=Array.from(a.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,r.Z)(e.element,t.element);throw new Error("Element not found")})),d=new Map;for(const m of c){const{element:e,scrollableAncestor:t}=m,o=a.get(m);if(!e||!t||!o)continue;const l=h(m).reduce(((e,t)=>e+(d.get(t)||0)),0),c=t.getBoundingClientRect(),S=e.getBoundingClientRect(),y=c.height,v=Math.floor(c.top-S.top),f=Math.floor(c.top+y-S.top),C=Math.floor(S.height)+(m.props.isFullScreen&&!s.isSafari?n.Z.state:0),x=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,r.Z)(e.element,t.element);throw new Error("Element not found")}));let b=l,w=0;for(const r of x){if(!r.element)continue;const e=r.element.getBoundingClientRect(),t=b+e.height;r.props.position===i.Z.Top&&(w+=e.height);const o=p(v,C,t,l),n=u(f,C,t,w);if(r.props.position===i.Z.Top){const e=0!==o,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;e?(r.element.style.transform=`translate3d(0, ${o}px, 0)`,r.element.style.bottom=""):(r.element.style.transform="",r.element.style.bottom=""),t&&g(r.element,t)}else{const e=0!==n,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;if(e?(r.element.style.transform=`translate3d(0, ${n}px, 0)`,r.element.style.top=""):(r.element.style.transform="",r.element.style.top=""),t)for(const o in t)r.element.style[o]=t[o]||""}b=t}d.set(m,b)}}function p(e,t,o,r){return e<-r||e>t?0:e>=t-o-1?t-o+r-1:e+r}function u(e,t,o,r){return e-r<0||e>t?0:e<o?o-t:e-t}function h(e){const t=[];for(;;){const o=m(e);if(!o)break;e=o,t.push(e)}return t}function m(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function g(e,t){for(const o in t)e.style[o]=t[o]||""}},984:(e,t,o)=>{o.d(t,{nA:()=>L,YJ:()=>V,g1:()=>E,ay:()=>D,ZP:()=>z,v2:()=>H});o(67294);var r=o(83355),i=o(72126),n=o(70203),s=o(9291),l=o(50906),a=o(83692),c=o(49865),d=o(52989),p=o(24677),u=o(82530),h=o(43250),m=o(75079),g=o(92918),S=o(52821),y=o(30206),v=o(78316),f=o(12534),C=o(77556),x=o(34583),b=o(480),w=o(24405),k=o(47453),P=o(65273),j=o(68785),F=o(89728),M=o(85893);const _=function(e){let{shouldShowSpinner:t,color:o,collectionContextStore:r,isFullScreen:i,groupsPointer:n}=e;window.__c={n:"BoardGroupAddItemButton"};const l=(0,w.Fg)(),c=(0,b.O7)(),d=l.lightTextColor;return(0,M.jsxs)(F.Z,{icon:e=>(0,k.R)({...e,fill:o||d}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:o||d},onClick:e=>function(e,t,o,r,i){if("collectionTypedView"===e.contextType)return;if(!x.M_(r)||!e.collectionStore())return;u.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:r,perform:n=>{a.b({transaction:n,environment:r,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1,useCrdt:i})}})}(r,i,n,c,(0,P.SL)(e,"collection_non_table_view")),onMouseDown:f.$0,children:[(0,M.jsx)(s.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}),t&&(0,M.jsx)("div",{style:{margin:"0 0 0 auto"},children:(0,M.jsx)(j.Z,{style:{width:12,height:12}})})]})};var T=o(88046),G=o(34232),I=o(34575);function B(){window.__c={n:"BoardShimmer"};return(0,G.Z)(!0,0,100)?(0,M.jsx)(I.F,{}):null}var Z=o(61838),A=o(25348),R=o(43145);const V=34,D=5,L=5,E=5;function H(e){return e?8:12}class O extends r.Z{constructor(){super(...arguments),this.isReady=this.createComputedStore((()=>{const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return Boolean(null==o?void 0:o.reducerResultStore.state)})),this.colorStore=this.createComputedStore((()=>{const{groupsPointer:e,schema:t,format:o,collectionContextStore:r}=this.props,n=i.Z$(e);return(0,g.II)({environment:this.environment,groupFormat:n,schema:t,format:o,collectionContextStore:r,theme:this.theme})}),!0)}renderComponent(){var e;const{store:t,groupsPointer:o,collectionContextStore:r,disabled:n,format:s,schema:l,blockPropertyValueOverlayStore:p,isFullScreen:m,anyGroupHasResults:g}=this.props,b=r.groupsStore.getGroupState(o);if(!b)return;const w=this.isReady.state,k=function(e){return e?e.board_cover:void 0}(this.props.format),P=(0,v.az)(r,m),j=b.reducerResultStore.state,F=r.permissionScopes.state,G=!n&&w&&r.shouldAllowNewItemCreation(),I=!n&&!F.isSyncedCollection,V=(0,v.VM)({reducerResult:j,collectionContextStore:r,isFullScreen:m}),L=Boolean(s.collection_group_by),E=!g&&L&&(0,y.H0)({collectionContextStore:r,groupsPointer:o,hasPartialResults:g}),H=g&&r.shouldShowSpinner.state&&"load_general"===r.loadingDetails.state.type;return(0,M.jsxs)("div",{style:this.getStyle(),onMouseDown:e=>function(e,t){const{device:o}=t;o.isMobile||(0,f.ZP)({event:e,context:f.Af.EditorMouseDown,callback:()=>{e.preventDefault(),d.AI({environment:t,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onClick:$,className:h.GfL,onMouseMove:()=>function(e,t){const o=i.Z$(e);o&&t.state!==o&&t.setState(o)}(this.props.groupsPointer,this.props.hoveredGroupStore),children:[(0,M.jsx)(A.Z,{collectionContextStore:r,groupsPointer:o,format:s,canDrag:I,onSelectableEnter:e=>Q(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.environment),resultProps:{format:s,schema:l,onTextEnter:e=>function(e,t,o,r,i,n){if(!x.M_(n)||!o.collectionStore())return Y(e,o,i,t,n);const s=U(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))+1;u.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:n,perform:e=>{a.b({transaction:e,environment:n,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:l,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}})}(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.props.store,this.environment),onShiftEnter:e=>Q(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.environment),coverFormat:k,coverAspectFormat:N(this.props.format),coverSizeFormat:K(this.props.format),shouldShowTitle:S.K8(this.props.format,"board"),colorStyle:this.colorStore.state,onTextEsc:e=>Y(e,this.props.collectionContextStore,this.props.store,this.props.groupsPointer,this.environment),disabled:n,blockPropertyValueOverlayStore:p,collectionContextStore:r},canDrop:!0,resultComponent:T.Z,disabled:n,direction:A.R.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:L?D:3,analyticsName:"board",loadContentCover:k&&"page_content"===k.type}),E&&(0,M.jsx)(B,{}),V&&(0,M.jsx)(Z.ZP,{groupsPointer:o,store:t,collectionContextStore:r,format:s,isFullScreen:m,incrementLimitsInRelatedGroups:!0}),G&&(0,M.jsxs)(M.Fragment,{children:[V&&(0,M.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,M.jsx)(_,{groupsPointer:o,collectionContextStore:r,isFullScreen:m,color:null===(e=this.colorStore.state)||void 0===e?void 0:e.textColor,shouldShowSpinner:H})]}),!P&&(0,M.jsx)(R.Z,{onChange:e=>function(e,t,o,r,i){const n=t.isLoading.state,s=t.groupsStore.getGroupState(r),l=null==s?void 0:s.reducerResultStore.state;e<C.Z.incrementScrollOffset&&!n&&l&&l.hasMore&&(c.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:o,currentResultCount:l.blockIds.length,groupsPointer:r,incrementLimitsInRelatedGroups:!1}}),t.loadingDetails.setState({type:"load_general"}))}(e,this.props.collectionContextStore,this.props.isFullScreen,this.props.groupsPointer,this.environment)})]})}getStyle(){const{format:e}=this.props,t=this.isReady.state,o=this.colorStore.state,r=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:D,paddingRight:D,paddingBottom:D,marginRight:2*E,boxSizing:"content-box",width:W(this.props.format),height:r?void 0:"max-content",...o&&t&&{backgroundColor:this.props.isInPeekRenderer?o.peekBackgroundColor:o.backgroundColor,...r?{borderRadius:L}:{borderBottomLeftRadius:L,borderBottomRightRadius:L}}}}}O.displayName="BoardGroupResults";const z=(0,s.injectIntl)(O);function N(e){return e?e.board_cover_aspect:void 0}function K(e){return e?e.board_cover_size:void 0}function W(e){const t=e.board_cover_size;return(0,v.rD)(t)}function U(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function $(e){(0,f.ZP)({event:e,context:f.Af.EditorClick,callback:()=>{}})}function Q(e,t,o,r,i){const{blocks:n,transaction:s}=e;if(0===n.length)return;const l=n[0];if(!x.M_(i)||!o.collectionStore()||!o.shouldAllowNewItemCreation())return;const c=U(t,o);if(!c)return;const d=c.state.findIndex((e=>e===l))+1;a.b({transaction:s,environment:i,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:d,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}function Y(e,t,o,r,i){const s=t.collectionStore(),a=e.getTitleStore();if(!a)return;if(n.QaF(a.getValue()))p.Ys({environment:i,store:e});else if(s){const n=U(r,t);if(!n)return;const s=n.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),d=t.collectionViewBlockStore();if(a&&d&&l.sGw(i,{...(0,m.Pn)(t),block_id:o.id}),u.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:i,perform:t=>{c.Od({store:e,transaction:t})}}),s>=0){const e=n.state[s];p.Ys({environment:i,store:e})}}}},88046:(e,t,o)=>{o.d(t,{Z:()=>n});o(67294);var r=o(5023),i=o(85893);const n=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:s,hideContent:l,blockResizerStore:a,isQuickFind:c,style:d,disableCommentMenu:p,disableHoverMenu:u,disableDrag:h,numberedListCounterStore:m,bulletedListFormatStore:g,format:S,schema:y,coverFormat:v,coverAspectFormat:f,coverSizeFormat:C,shouldShowTitle:x,colorStyle:b,onTextEnter:w,onTextEsc:k,onShiftEnter:P,blockPropertyValueOverlayStore:j,isLast:F,handleOpenPeekPage:M,collectionContextStore:_}=e;return(0,i.jsx)(r.Z,{store:t,disabled:o,isFirstItem:n,isLastItem:s,hideContent:l,blockResizerStore:a,isQuickFind:c,style:d,disableCommentMenu:p,disableHoverMenu:u,disableDrag:h,numberedListCounterStore:m,bulletedListFormatStore:g,format:S,schema:y,coverFormat:v,coverAspectFormat:f,coverSizeFormat:C,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:x,colorStyle:b,onTextEnter:w,onTextEsc:k,onShiftEnter:P,blockPropertyValueOverlayStore:j,isLast:F,handleOpenPeekPage:M,collectionContextStore:_})}},34575:(e,t,o)=>{o.d(t,{F:()=>l});o(67294);var r=o(24405),i=o(356),n=o(36596),s=o(85893);function l(e){window.__c={n:"BoardItemShimmer"};const t=e.minHeight||i.Ju,o=(0,r.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,s.jsx)(n.Z,{style:o.card})}},48936:(e,t,o)=>{o.d(t,{$U:()=>C,GA:()=>x,KK:()=>f,ZP:()=>w});o(67294);var r=o(83355),i=o(14714),n=o(99036),s=o(47453),l=o(4615),a=o(97880),c=o(9291),d=o(8406),p=o(92918),u=o(61766),h=o(984),m=o(68500),g=o(31945),S=o(73063),y=o(89728),v=o(85893);const f=28,C=4,x=35;class b extends r.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:u.Z},this.renderPopup=()=>{const{schema:e,currentGroups:t,groupBy:o}=this.props;return(0,v.jsx)(m.Z,{groupFormat:void 0,groupBy:o,currentGroups:t,schema:e,onChange:this.handleEditMenuChange,onClose:this.handleEditMenuClose,parentStore:this.props.parentStore})},this.handleEditMenuChange=e=>{const{collectionContextStore:t,groupBy:o,schema:r,currentGroups:s,onAccept:c,groupsLimitStore:u}=this.props,{newGroupValue:h}=e,m=r[o.property],g=u.state;if(m&&(0,i.LG)(m))if(d.wd({environment:this.environment,collectionContextStore:t,action:"board_add_group"}),this.stores.buttonPopupStore.reset(),n.cu(m)){if(m.type!==h.type)return;if(void 0===h.value)return;const e=m.options||[],t={id:(0,l.ZP)(),value:h.value,color:(0,n.TL)(e)},i=[...e,t],a={...m,options:i},d={...r,[o.property]:a},u={property:o.property,value:h,hidden:!1};c({newGroups:(0,p.nr)(s,u,g),newSchema:d})}else if("person"===m.type||"relation"===m.type||(0,i.HB)(m.type)){const t={property:o.property,value:h,hidden:!1};c({newGroups:(0,p.nr)(s,t,g),newPage:e.newPage})}else(0,i.A1)(m.type)||"status"===m.type||"number"===m.type||"created_by"===m.type||"last_edited_by"===m.type||"formula"===m.type||"checkbox"===m.type||"location"===m.type||(0,a.t1)(m.type)},this.handleEditMenuClose=()=>{this.stores.buttonPopupStore.reset()},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,p.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{groupBy:e,schema:t,type:o}=this.props,{buttonPopupStore:r}=this.stores,n=t[e.property];if(n&&(0,i.LG)(n))return(0,v.jsx)(g.ZP,{render:this.renderPopup,buttonPopupStore:r,popupType:this.environment.device.isMobile?g.Z4.SlideUp:g.Z4.Popup,renderOrigin:e=>{return"default"===o?(0,v.jsx)(y.Z,{isLightGray:!0,icon:s.R,style:{display:"flex",height:f,marginTop:12,marginBottom:C,width:"max-content",position:this.props.stickyLeft?"sticky":void 0,left:this.props.stickyLeft&&this.props.paddingLeft?this.props.paddingLeft:0,...this.props.style},...e,children:(0,v.jsx)(c.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})}):(0,v.jsx)(S.Z,{icon:e=>(0,s.R)({...e,fill:this.theme.mediumTextColor}),style:{width:x,background:null===(t=this.boardColorStore.state)||void 0===t?void 0:t.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:h.ay,paddingBottom:h.ay,marginRight:h.g1,borderRadius:h.nA,height:33,...this.props.style},...e});var t}})}}b.displayName="CollectionAddGroupButton";const w=b},356:(e,t,o)=>{o.d(t,{ZP:()=>ne,Ju:()=>re,AY:()=>oe});var r=o(67294),i=o(83355),n=o(24405),s=o(15145),l=o(14714),a=o(47453),c=o(72126),d=o(9291),p=o(50906),u=o(49865),h=o(99553),m=o(75754),g=o(26999),S=o(8055),y=o(82530),v=o(66213),f=o(65273),C=o(43250),x=o(75079),b=o(30206),w=o(78316),k=o(73744),P=o(84210),j=o(12534),F=o(17504),M=o(80444),_=o(77556),T=o(49085);class G extends T.default{getInitialState(){return{}}}const I=G;var B=o(34583),Z=o(480),A=o(86628),R=o(70203),V=o(14900),D=o(24677),L=o(98104),E=o(52821),H=o(5023),O=o(85893);const z=function(e){let{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:p,numberedListCounterStore:u,bulletedListFormatStore:h,format:m,schema:g,coverFormat:S,coverAspectFormat:y,coverSizeFormat:v,coverHeight:f,coverWidth:C,shouldShowTitle:x,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:P,isLast:j,handleOpenPeekPage:F,collectionContextStore:M}=e;return(0,O.jsx)(H.Z,{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:p,numberedListCounterStore:u,bulletedListFormatStore:h,format:m,schema:g,coverFormat:S,coverAspectFormat:y,coverSizeFormat:v,coverHeight:f,coverWidth:C,shouldShowTitle:x,colorStyle:void 0,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:P,isLast:j,handleOpenPeekPage:F,collectionContextStore:M})};var N=o(25348);const K=r.memo((function(e){let{collectionContextStore:t,groupFormat:o,format:i,schema:n,disabled:s,store:l,blockPropertyValueOverlayStore:a,collectionGalleryViewStore:c,isSingleColumn:d}=e;const p=(0,Z.O7)(),h=(0,r.useMemo)((()=>o?[o]:[]),[o]),m=(0,A.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),g=(0,A.VK)((()=>l.canEdit()&&("collectionTypedView"===t.contextType||m.canEditContent)),[t,m.canEditContent,l]),S=(0,r.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();D.eP({environment:p,store:e}),L.NX({store:o}),V.Z5({store:e})}}),[p]),v=(0,r.useCallback)((e=>{const o=t.collectionStore(),r=e.getTitleStore();if(!r)return;R.QaF(r.getValue())?D.Ys({environment:p,store:e}):o&&y.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:p,perform:t=>{u.Od({store:e,transaction:t})}})}),[t,p]),f=(0,r.useMemo)((()=>d?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[d]),{gallery_cover:C,gallery_cover_aspect:x,gallery_cover_size:b}=i,w=!s&&g&&!m.isSyncedCollection,{coverHeight:k,coverWidth:P}=(0,A.VK)((()=>c.state),[c]),j=(0,r.useMemo)((()=>({format:i,schema:n,onTextEnter:v,onTextEsc:v,onShiftEnter:S,disabled:s,coverFormat:C,coverAspectFormat:x,coverSizeFormat:b,coverHeight:k,coverWidth:P,shouldShowTitle:E.K8(i,"gallery"),blockPropertyValueOverlayStore:a,collectionContextStore:t})),[a,t,k,P,x,C,b,s,i,S,v,n]);return(0,O.jsx)(N.Z,{collectionContextStore:t,groupsPointer:h,format:i,canDrag:w,onSelectableEnter:S,resultProps:j,resultComponent:z,canDrop:!0,disabled:s,shouldShowHoverMenu:!1,direction:d?N.R.Vertical:N.R.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:f,loadContentCover:C&&"page_content"===C.type})}));var W=o(3687),U=o(61838),$=o(64347),Q=o(64921),Y=o(43145),X=o(17311),q=o(34232),J=o(62010);function ee(e){window.__c={n:"GalleryShimmer"};const{hasPartialResults:t}=e;if(!(0,q.Z)(!0,0,100))return null;const o=e.coverHeight??X.Z.card.desktop.medium.height,r=t?void 0:o+40,i=t?1:3,n=c.DZ(i,(e=>(0,O.jsx)(J.I,{minHeight:r},e)));return(0,O.jsx)(O.Fragment,{children:n})}var te=o(79954);const oe=480,re=40;class ie extends i.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:I},this.selectableContainer=null,this.renderGroup=e=>{const{store:t,format:o,disabled:r,collectionContextStore:i,schema:n,blockPropertyValueOverlayStore:s,isFullScreen:l}=this.props,{collectionGalleryViewStore:a}=this.stores,c=this.isSingleColumnStore.state,d=this.isReady.state,p=e?[e]:[],u=i.groupsStore.getGroupState(p);if(!u)return;const h=u.reducerResultStore.state,m=void 0!==e,g=void 0!==h&&(null==h?void 0:h.blockIds.length)>0,S=(0,b.H0)({collectionContextStore:i,groupsPointer:p,hasPartialResults:g}),y=w.VM({collectionContextStore:i,reducerResult:h,isFullScreen:l}),v=i.permissionScopes.state,f=v.isSyncedCollection,C=t.canEdit()&&("collectionTypedView"===i.contextType||v.canEditContent),x=d&&!r&&C&&!f&&(g||!S);return(0,O.jsxs)("div",{style:{paddingBottom:e?16:void 0},children:[(0,O.jsxs)("div",{style:this.getGroupWrapStyle(),children:[(0,O.jsx)(K,{collectionContextStore:i,groupFormat:e,format:o,schema:n,disabled:r,store:t,blockPropertyValueOverlayStore:s,collectionGalleryViewStore:a,isSingleColumn:c}),S&&(0,O.jsx)(ee,{hasGroups:m,hasPartialResults:g,coverHeight:a.state.coverHeight}),x&&this.renderAddItemButton(p)]}),y&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,O.jsx)(U.ZP,{groupsPointer:p,store:t,collectionContextStore:i,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1})]})]})},this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&this.setCardCoverWidth(o)},this.handleResizeDebounced=(0,c.Ds)(this.handleResize,1e3),this.handleResizeThrottled=(0,c.P2)(this.handleResize,100),this.handleAddItemClick=(e,t)=>{if(!B.M_(this.environment))return;const{collectionContextStore:o}=this.props,r=o.groupsStore.getGroupState(e);r&&y.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:this.environment,perform:i=>{const{mainEditorCurrentBlockStore:n}=M.default.state,l=u.IW({environment:this.environment,collectionContextStore:o,groupsPointer:e,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"gallery",useCrdt:t});if(!l)return;const a=w.mb({store:l.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:o})??(0,P.ZP)({store:l.newStore,pageVisitSource:s.tY.Create});this.navigate(a),h.Xd({collectionContextStore:o,resultsStore:r.resultsStore}),p.W2j(this.environment,{from:"list_view_add_item_bottom",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,x.Pn)(o)})}})},this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=oe)),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):S.c4({environment:this.environment,url:e})}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),this.setCardCoverWidth())}didMount(){this.setCardCoverWidth(),this.setCardCoverHeight(),(0,k.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,k.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,k.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,k.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=w.az(s,n),a=t.collection_group_by;return(0,F.Z)((t=>(0,O.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:C.sbt,children:[(0,O.jsx)(te.Z,{store:e,shouldShowHalo:!n,canSelect:!n,analyticsName:"gallery",...t,ref:e=>this.selectableContainer=e,children:a?this.renderGroups(a):this.renderGroup(void 0)}),!l&&(0,O.jsx)(Y.Z,{onChange:e=>function(e,t,o,r){var i;const n=o.isLoading.state,s=null===(i=function(e){var t;return null===(t=e.groupsStore.getGroupState([]))||void 0===t?void 0:t.reducerResultStore}(o))||void 0===i?void 0:i.state;e<_.Z.incrementScrollOffset&&s&&!n&&null!=s&&s.hasMore&&u.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:a,paddingLeft:c,isRootChild:d,isInPeekRenderer:p}=this.props;return(0,O.jsx)($.Z,{store:t,id:"gallery_groups",groupBy:e,groupsFormatKey:l.Uh,groupAggregationKey:l.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:a,renderGroup:this.renderGroup,onGroupHeaderAddItem:e=>function(e,t,o){t.device.isMobile?m._({environment:t,store:e,pageVisitSource:s.tY.Create}):g.CH({environment:t,store:e,peekMode:w.kr(o.collectionViewStore()),resultsStore:void 0,collectionContextStore:o,pageVisitSource:s.tY.Create})}(e,this.environment,this.props.collectionContextStore),renderHeader:e=>(0,O.jsx)(le,{args:e}),getGroupStyle:e=>function(e,t){if(0===e.index)return{};return{borderTop:`1px solid ${t.tableDividerColor}`}}(e,this.theme),paddingLeft:c,isRootChild:d,isInPeekRenderer:p})}renderAddItemButton(e){return(0,O.jsx)(Q.Z,{onClick:t=>this.handleAddItemClick(e,(0,f.SL)(t,"collection_non_table_view")),onMouseDown:j.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:4,boxShadow:"dark"===this.theme.mode?`${this.theme.darkDividerColor} 0px 0px 0px 1px inset`:`${this.theme.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:re},children:(0,O.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:-6},children:[(0,a.R)((t=this.theme,{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor})),(0,O.jsx)("div",{style:{color:this.theme.lightIconColor},children:(0,O.jsx)(d.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"})})]})});var t}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}setCardCoverWidth(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverWidth:e||se(this.props.format)})}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${C.K4T}`);if(t)return t.offsetWidth}}return se(this.props.format)}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}getGroupWrapStyle(){const e=this.props.format.collection_group_by;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${this.isSingleColumnStore.state?"100%":`${se(this.props.format)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:e?1:16,paddingBottom:4}}}ie.displayName="CollectionGalleryView",ie.contextTypes={...v.wK,...i.w};const ne=ie;function se(e){const t=e.gallery_cover_size;return w.rD(t)}function le(e){let{args:t}=e;window.__c={n:"GroupHeaderComponent"};const o=(0,n.Fg)();return(0,O.jsx)(W.Z,{...t,height:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,o)})}},24854:(e,t,o)=>{o.d(t,{Z:()=>G});o(21703),o(57658),o(67294);var r=o(83355),i=o(14714),n=o(99036),s=o(8848),l=o(45453),a=o(9056),c=o(37612),d=o(72126),p=o(21202),u=o(9291),h=o(50906),m=o(49865),g=o(14900),S=o(47307),y=o(82530),v=o(92658),f=o(92918),C=o(87279),x=o(26136),b=o(93405),w=o(78140),k=o(32163),P=o(40721),j=o(72495),F=o(9050),M=o(85893);const _="color";class T extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:v.Z}}renderComponent(){const{device:e}=this.environment,{parent:t}=this.props,o=d.oA([A(this.environment,this.props.groupFormat,this.props.collectionContextStore,this.props.groupsFormatKey,this.props.currentGroups,this.props.groupsLimitStore,this.props.intl),B(this.environment,this.props.schema,this.props.groupFormat,this.props.collectionContextStore)]);let r;return r=e.isMobile?{menuType:C.og.Modal,title:(0,M.jsx)(u.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,M.jsx)(P.DoneMenuText,{}),onClickRight:t.close}:{menuType:C.og.Popup},(0,M.jsx)(w.Z,{...r,children:(0,M.jsx)(k.Z,{type:k.i.Vertical,initialFocus:0,sections:o,onAccept:e=>{"string"==typeof e.key&&e.key.includes(_)||t.close()}})})}}T.displayName="CollectionGroupActionMenu";const G=(0,u.injectIntl)(T);function I(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function B(e,t,o,r){const i=o.value;if(void 0===i.value)return;const l=t[o.property];if(!l)return;if("select"!==l.type&&"multi_select"!==l.type)return;if(i.type!==l.type)return;const a=(l.options||[]).find((e=>e.value===i.value));if(!a)return;return{key:"collection color section",render:e=>(0,M.jsx)(j.Z,{...e,title:(0,M.jsx)(u.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:s.AP.map((i=>({key:`color_${i}`,render:e=>(0,M.jsx)(F.Z,{...e,color:i,checkState:a.color===i}),action:()=>{!function(e,t,o,r,i){const s=r[o.property];if(!s)return;if(!n.cu(s))return;const l=i.collectionStore();if(!l)return;const a=o.value;if(a.type!==s.type)return;const c=(s.options||[]).map((t=>t.value===a.value?{...t,color:e}:t)),d={...s,options:c},p={...r,[o.property]:d};y.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,perform:e=>{g.Rm({environment:t,collectionStore:l,update:{schema:p},transaction:e})}}),h.wds(t,{view_type:I(i),action:"group_change_color"})}(i,e,o,t,r)}})))}}function Z(e,t,o,r,n,s){S.showDialog({message:(0,M.jsx)(u.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>async function(e,t,o,r,n,s){const l=t.collectionStore();if(!l)return;const a=r.value;if("relation"===a.type&&(0,i.RA)(a.value)){const e=x.G.createChildStore(l,{id:a.value.id,table:p.iU});await e.load();const t=e.getParentCollectionStore();await(null==t?void 0:t.load())}y.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,perform:i=>{m.iE({environment:e,collectionStore:l,property:r.property,groupFormat:r,currentGroups:o,groupsFormatKey:n,collectionContextStore:t,transaction:i,intl:s})}}),h.wds(e,{view_type:I(t),action:"delete_group"})}(e,t,o,r,n,s)}]})}function A(e,t,o,r,n,s,d){const p=[],g=t.value,S=o.permissionScopes.state;(0,i.eF)(t)?p.push({key:"show",render:e=>(0,M.jsx)(b.Z,{...e,title:(0,M.jsx)(u.FormattedMessage,{defaultMessage:"Show",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:a.g}),action:()=>function(e,t,o,r,i,n){const s={...t,hidden:!1},l=(0,f.nr)(i,s,n.state);y.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,perform:e=>{m.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:r,transaction:e})}}),h.wds(e,{view_type:I(o),action:"show_group"})}(e,t,o,r,n,s)}):p.push({key:"hide",render:e=>(0,M.jsx)(b.Z,{...e,title:(0,M.jsx)(u.FormattedMessage,{defaultMessage:"Hide",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:l.p}),action:()=>function(e,t,o,r,i){const n={...t,hidden:!0},s=(0,f.ar)(i,n);y.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,perform:e=>{m.A6({collectionContextStore:o,newGroups:s,groupsFormatKey:r,transaction:e})}}),h.wds(e,{view_type:I(o),action:"hide_group"})}(e,t,o,r,n)}),void 0!==g.value&&S.canEditContent&&!S.isSyncedCollection&&"collectionTypedView"!==o.contextType&&p.push({key:"delete",render:e=>(0,M.jsx)(b.Z,{...e,title:(0,M.jsx)(u.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:c.y}),action:()=>Z(e,o,n,t,r,d)});return{key:"collection group",render:e=>(0,M.jsx)(j.Z,{...e}),items:p}}},3687:(e,t,o)=>{o.d(t,{Z:()=>pe});o(21703),o(67294);var r=o(73935),i=o(83355),n=o(1302),s=o(480),l=o(86628),a=o(49085),c=o(56666),d=o(47453),p=o(21202),u=o(51454),h=o(9291),m=o(50906),g=o(49865),S=o(14900),y=o(24677),v=o(82530),f=o(75079),C=o(12534),x=o(77546),b=o(6027),w=o(26136),k=o(34583),P=o(24854),j=(o(57658),o(2032)),F=o(14248),M=o(14714),_=o(42875),T=o(72126),G=o(82990),I=o(47853),B=o(16187),Z=o(33929),A=o(87279),R=o(98742),V=o(75498),D=o(10732),L=o(57042),E=o(52275),H=o(31945),O=o(78140),z=o(32163),N=o(40721),K=o(89728),W=o(53437),U=o(72495),$=o(26388),Q=o(42782),Y=o(85893);class X extends i.Z{constructor(){super(...arguments),this.aggregationStore=this.createComputedStore((()=>{const{format:e,groupAggregationKey:t}=this.props;return e[t]||{aggregator:"count"}}),!0),this.reducerStore=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.aggregationStore.state;return{type:"aggregation",filter:(0,F.zk)({schema:e,group:t,timeZone:(0,_.r)()}),aggregation:o}}))}renderComponent(){const{device:e}=this.environment;return(0,Y.jsx)($.ZP,{renderTooltip:()=>this.renderTooltipText(),render:t=>(0,Y.jsx)(H.ZP,{popupType:e.isMobile?H.Z4.SlideUp:H.Z4.Popup,renderOrigin:e=>(0,Y.jsx)(K.Z,{disabled:this.props.disabled,style:{fontWeight:G.Z.fontWeight.medium,color:this.theme.lightTextColor,height:24},...(0,R.Z)((0,R.Z)(t,e),{onClick:C.Wi}),children:this.renderValue()}),disabled:this.props.disabled,render:e=>(0,Y.jsx)(ie,{parent:e,collectionContextStore:this.props.collectionContextStore,format:this.props.format,groupAggregationKey:this.props.groupAggregationKey,schema:this.props.schema})})})}renderValue(){const{schema:e,collectionContextStore:t,groupFormat:o}=this.props,r=this.aggregationStore.state,i=this.reducerStore.state;if(i)return(0,Y.jsx)(V.Z,{id:`group_aggregation:${(0,M.mD)(o)}`,collectionContextStore:t,reducer:i,groupsPointer:[o],render:o=>{const i=o.state;let n;if((0,j.pK)(r)){const t=e[r.property];!t||"formula"!==t.type&&"number"!==t.type||(n=t.number_format)}return(0,Y.jsx)(D.Z,{aggregation:r,collectionContextStore:t,children:i?(0,B.Ol)({numberFormat:n,dateFormat:void 0,aggregationType:r.aggregator,userTimeZone:(0,_.r)(),value:i.aggregationResult,roundDecimal:5}):"-"})}})}renderTooltipText(){const{schema:e,collectionContextStore:t}=this.props,o=this.aggregationStore.state,r=B.VN[(0,j.OV)(o)],i=(0,D.u)(t,o);if((0,j.pK)(o)){const t=e[o.property];if(t){const e=t.name;return Z.default.formatMessage(L.Z.propertyAggregation,{aggregationType:r,propertyName:e,calculating:i})}}return Z.default.formatMessage(L.Z.aggregationType,{aggregationType:r,calculating:i})}}function q(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function J(e){let{aggregationType:t,label:o,props:r}=e;const i=B.Sn[t];return(0,Y.jsx)($.ZP,{placement:W.GI.Placement.Right,delayThreshold:0,render:e=>(0,Y.jsx)(E.Z,{title:o,...(0,R.Z)(e,r)}),renderTooltip:()=>(0,Y.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,Y.jsx)("img",{src:(0,I.D)(i),style:{borderRadius:4,width:140,marginTop:4}}),B.BG[t]]})},r.key)}function ee(e,t,o,r,i){const n=o.collectionViewStore();n&&(o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),v.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,perform:t=>{S.iG({collectionViewStore:n,update:{format:{...r,[i]:e}},transaction:t})}})),m.wds(t,{view_type:q(o),action:"change_aggregation"})}function te(e,t,o,r,i){const n=B.VN[e];return{key:e,render:t=>(0,Y.jsx)(J,{aggregationType:e,label:n,props:t}),action:()=>{ee({aggregator:e},t,o,r,i)}}}function oe(e,t,o,r,i,n,s){const{device:l}=o,a=B.VN[e],c=T.oA(t.map((t=>function(e,t,o,r,i,n,s){const l=r[e];if(!l)return;const a=l.name;return{key:`${e} ${t}`,render:e=>(0,Y.jsx)(J,{aggregationType:t,label:a,props:e}),action:()=>{ee({aggregator:t,property:e},o,i,n,s)}}}(t,e,o,r,i,n,s))));return{key:e+a,render:(e,t)=>(0,Y.jsx)(Q.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,Y.jsx)(E.Z,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let r;return r=l.isMobile?{menuType:A.og.Modal,title:a,right:l.isPhone?(0,Y.jsx)(N.DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:A.og.Popup,width:200,...e},(0,Y.jsx)(O.Z,{...r,children:(0,Y.jsx)(z.Z,{type:z.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,Y.jsx)(U.Z,{...e}),items:c}],onAccept:t.onAccept})})}}),action:()=>null}}function re(e,t,o,r,i){const n=[];for(const d of j.o5)n.push(te(d,e,t,o,r));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,j.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const d of j.Sy)"show_unique"!==d&&n.push(oe(d,s,e,i,t,o,r));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,j.O4)(o)}))}(i);if(l.length>0)for(const d of j.k$)n.push(oe(d,l,e,i,t,o,r));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,j.dN)(o)}))}(i);if(a.length>0)for(const d of j.f8)n.push(oe(d,a,e,i,t,o,r));const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,j.Mv)(o)}))}(i);if(c.length>0)for(const d of j.gC)n.push(oe(d,c,e,i,t,o,r));return n}function ie(e){let{parent:t,collectionContextStore:o,format:r,groupAggregationKey:i,schema:n}=e;window.__c={n:"MenuComponent"};const l=(0,s.O7)(),{device:a}=l;let c;return c=a.isMobile?{menuType:A.og.Modal,title:(0,Y.jsx)(h.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,Y.jsx)(N.DoneMenuText,{}),onClickRight:t.close}:{menuType:A.og.Popup,width:200},(0,Y.jsx)(O.Z,{...c,children:(0,Y.jsx)(z.Z,{type:z.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,Y.jsx)(U.Z,{...e}),items:re(l,o,r,i,n)}],onAccept:t.close})})}X.displayName="CollectionGroupAggregation";var ne=o(26055),se=o(26964),le=o(73063),ae=o(79954),ce=o(5210);class de extends i.Z{constructor(){super(...arguments),this.storeTypes={hovered:a.default.createClass(!1)},this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;y.ZH(this.environment);const i=!o.toggleStateStore.state;if(g.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:i,collectionContextStore:t}),!i){const e=r.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&n.default.afterNextFlush((()=>{(0,x.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleMouseMove=()=>{this.stores.hovered.setState(!0)},this.handleMouseLeave=()=>{this.stores.hovered.setState(!1)},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:i,groupFormat:n}=this.props,s=r.findDOMNode(this);s&&s instanceof Element&&v.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>g.BO({environment:this.environment,collectionContextStore:i,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e})})}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new w.G(this.environment,{table:p.iU,id:t.id}))}didMount(){var e,t;null===(e=(t=this.props).onMount)||void 0===e||e.call(t)}renderComponent(){var e;const{disabled:t,getComputedStickyStyle:o,groupFormat:r,collectionContextStore:i}=this.props,n=i.groupsStore.getGroupState(r);if(!n)return;const s=n.toggleStateStore.state,l=i.permissionScopes.state,a=i.shouldAllowNewItemCreation(),c=(null===(e=i.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0;return(0,Y.jsx)(se.Z,{position:b.Z.Top,getComputedStyle:o,children:(0,Y.jsxs)("div",{style:ye(this.props.isInPeekRenderer,this.theme,c,this.props.style),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,children:[(0,Y.jsx)("div",{style:me(s,this.props.isFullScreen,this.props.isRootChild,this.props.paddingLeft,this.props.paddingTop,this.props.toggleClosedMarginBottom,this.props.height,this.props.stickyLeft),children:(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center",position:this.props.stickyLeft?"sticky":void 0,left:this.props.paddingLeft},children:(0,Y.jsxs)(ae.Z,{store:this.selectableBlockStore,canDropOnto:!t&&!s,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[r],style:{display:"flex",alignItems:"center",height:"100%"},children:[this.renderToggleButton(n.toggleStateStore),(0,Y.jsx)(ve,{collectionGroupHeaderProps:this.props}),(0,Y.jsx)(ge,{disabled:this.props.disabled,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupFormat:this.props.groupFormat,groupAggregationKey:this.props.groupAggregationKey}),!t&&l.canConfigureBlock&&(0,Y.jsx)(Se,{groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupsFormatKey:this.props.groupsFormatKey}),a&&(0,Y.jsx)(fe,{collectionGroupHeaderProps:this.props})]})})}),this.props.children]})})}renderToggleButton(e){const t=e.state;return(0,Y.jsx)(ce.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:C.$0,style:{flexShrink:0}})}}de.displayName="CollectionGroupHeader";const pe=de;function ue(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function he(e){return e||33}function me(e,t,o,r,i,n,s,l){return{display:"flex",alignItems:"center",height:he(s),paddingTop:i,...l&&{position:"sticky",left:t||o?r:0},...!e&&{marginBottom:n}}}function ge(e){let{disabled:t,format:o,schema:r,collectionContextStore:i,groupFormat:n,groupAggregationKey:s}=e;window.__c={n:"Aggregation"};const a=(0,l.VK)((()=>i.permissionScopes.state.canConfigureBlock),[i]);return(0,Y.jsx)(X,{groupFormat:n,disabled:t||!a,groupAggregationKey:s,format:o,schema:r,collectionContextStore:i})}function Se(e){let{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:a}=e;window.__c={n:"ActionButtonComponent"};const d=(0,s.Fy)(),p=(0,l.VK)((()=>n.groupsLimit),[n]);return(0,Y.jsx)(H.ZP,{popupType:d.isMobile?H.Z4.SlideUp:H.Z4.Popup,renderOrigin:e=>(0,Y.jsx)(le.Z,{icon:c.o,...e}),onClick:C.Wi,render:e=>(0,Y.jsx)(P.Z,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:a,groupsLimitStore:p})})}function ye(e,t,o,r){const i=e?t.cardContentBackground:t.contentBackground;return{position:"relative",zIndex:u.sL+2,width:"100%",background:void 0===o?i:o,fontSize:14,...r}}function ve(e){let{collectionGroupHeaderProps:t}=e;window.__c={n:"ValueComponent"};const o=(0,s.O7)(),{groupFormat:r,schema:i,disabled:n,currentGroups:a,groupBy:c,collectionContextStore:d}=t,p=(0,l.VK)((()=>d.permissionScopes.state),[d]);return(0,Y.jsx)(ne.Z,{groupBy:c,groupFormat:r,currentGroups:a,schema:i,disabled:n||!p.canConfigureCollection||p.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:r}=o,i=r.collectionStore();i&&(g.w$({...e,environment:t,collectionStore:i,...o}),m.wds(t,{view_type:ue(r),action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:d})}function fe(e){let{collectionGroupHeaderProps:t}=e;window.__c={n:"AddButtonComponent"};const o=(0,s.O7)();return(0,Y.jsx)($.ZP,{renderTooltip:()=>(0,Y.jsx)(h.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,Y.jsx)(le.Z,{icon:d.R,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:r,isFullScreen:i,onGroupHeaderAddItem:n}=t;r.groupsStore.getGroupState(o)&&k.M_(e)&&(r.searchQuery.state&&S.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:i}),v.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,perform:i=>{const s=g.IW({environment:e,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"group_header"});s&&(n(s.newStore,s.coercionSucceeded,t),m.W2j(e,{from:"group_add_item_top",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,f.Pn)(r)}))}}))}(o,t),...e})})}},61838:(e,t,o)=>{o.d(t,{K0:()=>C,ZP:()=>x});o(67294);var r=o(480),i=o(86628),n=o(24405),s=o(15145),l=o(40745),a=o(49902),c=o(9291),d=o(50906),p=o(49865),u=o(75754),h=o(24677),m=o(30206),g=o(12534),S=o(64921),y=o(68785),v=o(44043),f=o(85893);const C=33;const x=function(e){let{style:t,store:o,format:C,collectionContextStore:x,groupsPointer:w,incrementLimitsInRelatedGroups:k,isFullScreen:P}=e;window.__c={n:"CollectionGroupLoadMoreButton"};const j=(0,n.Fg)(),F=(0,r.O7)(),M=(0,i.VK)((()=>x.groupsStore.getGroupState(w)),[x,w]),_=(0,i.VK)((()=>(0,m.$t)({collectionContextStore:x,groupsPointer:w})),[x,w]),T=(0,i.VK)((()=>x.isCompactView.state),[x]),G=(0,i.VK)((()=>o.canEdit()),[o]);return M?T?(0,f.jsx)(S.Z,{onClick:e=>function(e,t,o){e.metaKey||e.ctrlKey?u._({environment:t,store:o,pageVisitSource:s.tY.PersonalHomeTileTasks,openInNew:"tab"}):u._({environment:t,store:o,pageVisitSource:s.tY.PersonalHomeTileTasks})}(e,F,o),onMouseDown:g.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,paddingLeft:8,marginBottom:8,...t},children:(0,f.jsx)("div",{style:{color:j.lightTextColor},children:(0,f.jsx)(c.FormattedMessage,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})}):(0,f.jsxs)(S.Z,{onClick:e=>function(e,t,o,r,i,n){const s=o.groupsStore.getGroupState(r);if(!s)return;const l=s.reducerResultStore.state;(0,g.Wi)(e),h.ZH(t),l&&p.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:s.groupsPointer,incrementLimitsInRelatedGroups:i}});a.j({name:"collection_load_more"}),d.uDZ(t)}(e,F,x,w,k,P),onMouseDown:g.$0,disabled:_,hoveredStyle:_?{background:j.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,...t},children:[(0,l.M)(b(j)),(0,f.jsx)("div",{style:{color:j.lightTextColor},children:(0,f.jsx)(c.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),_?(0,f.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,f.jsx)(y.Z,{style:{width:12,height:12}})}):G&&(0,f.jsx)(v.Z,{collectionContextStore:x,format:C})]}):null};function b(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}},25348:(e,t,o)=>{o.d(t,{R:()=>X,Z:()=>J});var r=o(67294),i=o(83355),n=o(86628),s=o(14248),l=o(14714),a=o(42875),c=o(72126),d=o(49865),p=o(82530),u=o(75079),h=o(78316),m=o(18245),g=o(26136),S=o(480),y=o(24405),v=o(76205),f=o(99036),C=o(59054),x=o(40745),b=o(95371),w=o(82990),k=o(9291),P=o(50906),j=o(40663),F=o(97004),M=o(77181),_=o(12534),T=o(40150),G=o(73807),I=o(20144),B=o(1302),Z=o(51365),A=o(99553),R=o(28020),V=o(43250),D=o(48543),L=o(19511),E=o(78030),H=o(79954),O=o(85893);class z extends i.Z{constructor(){super(...arguments),this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;return s?d.$T({environment:this.environment,collectionStore:s,collectionContextStore:i,groupsPointer:n,insertStores:t,store:r,before:!1,transaction:o}):[]},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;return s?d.$T({environment:this.environment,collectionStore:s,collectionContextStore:i,groupsPointer:n,insertStores:t,store:r,before:!0,transaction:o}):[]},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{store:i,collectionContextStore:n,groupsPointer:s,subitemPath:l}=this.props,a=this.associatedCollectionStore.state;if(!a)return[];const c=m.default.mark("collections.drop_item_lag");m.default.measureAfterNextFlush(c,{environment:this.environment,getData:()=>u.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})}),p.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:this.environment,perform:e=>{d.by({environment:this.environment,collectionStore:a,targetStore:i,droppedDirection:t,collectionContextStore:n,groupsPointer:s,droppedStores:o,duplicate:r,transaction:e,subitemPath:l})}})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;if(!s)return[];const l=m.default.mark("collections.drop_item_lag");m.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>u.yr({collectionContextStore:i,is_native_drop:!0,is_empty:!1})}),p.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:this.environment,perform:e=>{d.tQ({environment:this.environment,collectionStore:s,targetStore:r,droppedDirection:o,collectionContextStore:i,groupsPointer:n,files:t,transaction:e})}})},this.handleInsertRow=e=>t=>{let{transaction:o}=t;const{store:r,collectionContextStore:i,groupsPointer:n,subitemPath:s,blockPropertyValueOverlayStore:l,onSelectableInsertRow:a}=this.props,c=this.associatedCollectionStore.state;if(!c)return[];const p=d.yk({environment:this.environment,collectionContextStore:i,groupsPointer:n,store:r,before:"above"===e,collectionStore:c,transaction:o,subitemPath:s,subitemInsertDirection:"below"});P.W2j(this.environment,{...u.Pn(i),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id}),p&&a&&a(r,p),p&&l&&B.default.afterNextFlush((()=>{B.default.afterNextFlush((()=>{Z.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:l,store:p,property:"title",format:E.C.Table,collectionContextStore:i})}))}))},this.handleOpenPeekPage=()=>{const{collectionContextStore:e,handleOpenPeekPage:t}=this.props,o=e.collectionViewStore();m.default.mark("collections.open_item_page_lag"),t&&t(),A.Xd({collectionContextStore:e,resultsStore:this.resultsStore.state});const r=null==o?void 0:o.getType();if(r){const e=null==o?void 0:o.getFormat().collection_peek_mode,t=e||D.Ls[r];P.hym(this.environment,{is_peek:!0,from:r,peek_mode:t})}},this.canEditStore=this.createComputedStore((()=>this.props.store.canEdit())),this.associatedCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore())),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore})),this.shouldShowHighlightHalo=this.createComputedStore((()=>h.Sc(this.props.store))),this.normalizedCollectionViewSelectionStore=this.createComputedStore((()=>{const e=L.Z.state;return e.isActive&&e.store===this.props.store}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){const{store:e,resultProps:t,resultComponent:o,collectionContextStore:i,canDrag:n,canDrop:s,getItemSelectableStyle:l,belowDropZoneMargin:a,analyticsName:c,disabled:p,direction:u,onSelectableEnter:m,disableScrollToRevealHorizontal:g,touchDragOnly:S,isLast:y,groupsPointer:v,toggleButton:f,subitemPath:C,disableSelectable:x,itemSelectableHaloStyle:b,passesFilter:w}=this.props,k=!p&&this.canEditStore.state&&!(0,R.aT)(e.id,i.isInPeekRenderer.state),P=this.props.shouldShowHoverMenu&&k,j=u!==X.Vertical&&s,F=u!==X.Vertical&&s,M=u===X.Vertical&&s,_=r.createElement(o,{handleOpenPeekPage:this.handleOpenPeekPage,collectionContextStore:i,...t,store:e,key:e.id,isLast:y,toggleButton:f,subitemPath:C,passesFilter:w});return x?_:(0,O.jsx)(H.Z,{style:l?l(y):void 0,store:e,analyticsFromOverride:i.getAnalyticsFromOverride(),canSelect:k,shouldShowHalo:!this.normalizedCollectionViewSelectionStore.state&&!i.isCompactView.state,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,haloStyle:{...h.pB(this.shouldShowHighlightHalo.state,this.theme),...b},canDrag:n,canDropBelow:M,canDropLeft:j,canDropRight:F,canNativeDropBelow:M,canNativeDropLeft:j,canNativeDropRight:F,canDropOnto:s,canTriggerContextMenu:k,showBlockMenuInput:!0,shouldShowHoverMenu:P,shouldShowCommentMenu:!1,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,onRemove:e=>function(e,t,o,r,i){const{transaction:n}=e;i.length>0&&d.BN({store:o,transaction:n,groupsPointer:i,collectionContextStore:r,environment:t});d.Od({store:o,transaction:n})}(e,this.environment,this.props.store,this.props.collectionContextStore,this.props.groupsPointer),canInsertAbove:s,canInsertBelow:s,onInsertRowBelow:this.handleInsertRow("below"),onInsertRowAbove:this.handleInsertRow("above"),belowDropZoneMargin:a,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:c,shouldShowDropZone:s,dropzoneGap:this.props.dropzoneGap,onEnter:m,className:V.K4T,disableScrollToRevealHorizontal:g,touchDragOnly:S,groupsPointer:v,children:_})}}z.displayName="CollectionGroupResultsItem";const N=z;var K=o(64921),W=o(5210);const U=function e(t){window.__c={n:"CollectionGroupResultsNestedItem"};const{store:o,collectionContextStore:i,subitemPath:s,titleColumnIndex:l,nestedCreateSubitemButton:a,getItemSelectableStyle:c}=t,{currentSubitemFormatStore:d,subitemExpandedStore:p,subitemTreeStore:m}=i,g=(0,n.VK)((()=>h.Bm({store:o,collectionContextStore:i})),[i,o]),x=(0,n.VK)((()=>s&&s.length>0?s:(0,b.DY)(m.state.children,(e=>e.value.store===o))),[s,m,o],{useDeepEqual:!0}),w=x?(0,M.Af)(x.map((e=>e.value.store))):"",k=(0,n.VK)((()=>p.state.get(w)),[p,w]),j=Boolean(null==k?void 0:k.isExpanded),_=(0,S.O7)(),T=(0,n.VK)((()=>{const e=d.state;if(!e||!g)return;const t=g.getSchema()[e.property];return void 0!==t&&(0,f.p_)(t)?t:void 0}),[d,g]),B=(0,n.VK)((()=>{var e;return T&&"relation"===T.type&&(0,f.F0)(T)===(null===(e=i.collectionStore())||void 0===e?void 0:e.id)&&T.property}),[i,T]),Z=(0,n.VK)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),A=(0,n.VK)((()=>{const e=!B||Z&&(0,M.Av)(Z)?void 0:{property:B,filter:{operator:"is_empty"}};return!(!d.state||!g)&&(0,M.kC)({store:o,collectionStore:g,subitemFormat:d.state,subitemPathKey:w,collectionContextStore:i,propertyFilters:[...e&&B?[{id:B,filter:e}]:[],...i.currentPropertyFiltersStore.state],combinatorFilter:i.currentCombinatorFilterStore.state,currentUserId:_.currentUser.id}).length>0}),[i,Z,d,_.currentUser.id,B,g,w,o]),R=(0,n.VK)((()=>{var e;if(!d.state||!g)return!1;const t=null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType();return A||j||_.device.isMobile||"timeline"===t}),[d,_.device.isMobile,g,A,j,i]),V=(0,n.VK)((()=>I.Z.getState().hoveredStore===o),[o]),D=(0,n.VK)((()=>{const e=(0,F.m1)({collectionContextStore:i,collectionStore:g,environment:_});if(e)return(0,v.q)(e)}),[i,g,_]),L=(0,r.useCallback)((()=>{const e=p.state;if(j)e.delete(w),P.a_g(_,{...(0,u.Pn)(i),depth:(null==x?void 0:x.length)||0}),p.emit();else{e.set(w,{isExpanded:!0,limit:20}),P._kX(_,{...(0,u.Pn)(i),depth:(null==x?void 0:x.length)||0});const t=d.state;D&&e&&T&&t?(0,M.fd)({blockStore:o,subitemExpandedStore:p,subitemFormat:t,propertySchema:T,compiledFilter:D,pathKey:w,forceStoresToLoad:!1,visitedIds:new Set}).then((()=>{p.emit()})):p.emit()}}),[D,p,j,w,i,d,_,x,o,T]),E=(0,n.VK)((()=>{const e=m.state;return e&&x?(0,M.Ns)(e).value.store===o:t.isLast}),[m,t.isLast,o,x]),H=(0,G._)(),z=(0,n.VK)((()=>{var e;const t=o.getModel(),r=o.getRecordModel;if(!D||!t)return!0;const i=null===(e=o.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return D({block:t,getRecordModel:r,propertyMapping:i,formulaTimeoutTimestampMs:Date.now()+H,resultCache:new Map})}),[o,D,H]),K=(0,n.VK)((()=>c&&!z?()=>({...c?c(E):{},...z?{}:{opacity:.5}}):c),[c,z,E]);(0,C.r5)((async()=>{const e=o.getModel();await o.load();const t=o.getRecordModel,r=d.state;if(!R||!e||!D||!T||!t||!r||z)return;(0,M.xb)({store:o,subitemFormat:r,propertySchema:T}).length>0||(await(0,M.fd)({blockStore:o,subitemExpandedStore:p,subitemFormat:r,propertySchema:T,compiledFilter:D,pathKey:w,forceStoresToLoad:!0,visitedIds:new Set}),p.emit())}),[R,D,d,z,w,o,p,T]);const U=(0,y.Fg)(),Q=(0,O.jsx)(N,{...t,passesFilter:z,isLast:E,getItemSelectableStyle:K,subitemPath:x,toggleButton:(R||V)&&(0,O.jsx)(W.Z,{isSidebar:!1,open:j,fill:!0,onClick:L,color:A||j?U.regularIconColor:U.mediumIconColor,disabled:x&&x.length>=M.F0})});if(!j||!x||0===x.length||x.length>=M.F0)return Q;const Y=x[x.length-1].children;return(0,O.jsxs)(O.Fragment,{children:[Q,Y.map((o=>{const i=o.value.store;return(0,r.createElement)(e,{...t,key:i.id,store:i,subitemPath:[...x,o]})})),g&&a&&a({store:o,parentStore:g,subitemPath:x,indentLevel:x.length,titleColumnIndex:l}),k&&Y.length>0&&Y.length===k.limit&&(0,O.jsx)($,{collectionContextStore:t.collectionContextStore,pathKey:w,titleColumnIndex:l,limit:k.limit,indentLevel:x.length})]})},$=r.memo((function(e){window.__c={n:"NestedTableLoadMoreButton"};const{collectionContextStore:t,pathKey:o,titleColumnIndex:i,limit:s,indentLevel:l}=e,a=(0,r.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:s+20}),e.emit()}),[t,s,o]),c=(0,S.O7)(),d=(0,n.VK)((()=>h.fk({environment:c,collectionContextStore:t})),[t,c]),p=(0,n.VK)((()=>{var e;return(0,j.$4)()&&"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),u=(0,y.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:8+(0,T.f2)({columnIndex:0,titleColumnIndex:i,shouldShowBulkActionsToolbar:d,indentLevel:l+1,isSubitemToggleOnTitleColumn:p}),fontSize:14,lineHeight:w.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[l,d,i,p]);return(0,O.jsxs)(K.Z,{onClick:a,onMouseDown:_.$0,style:u.button,children:[(0,x.M)(u.icon),(0,O.jsx)("span",{style:u.label,children:(0,O.jsx)(k.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),Q=r.memo(U);var Y=o(75498);let X=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});class q extends i.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{collectionContextStore:i,groupsPointer:n}=this.props,s=this.emptyDroppableIntoStore.state;if(!s)return;const l=i.collectionViewBlockStore();if(!l)return;const a=m.default.mark("collections.drop_item_lag");m.default.measureAfterNextFlush(a,{environment:this.environment,getData:()=>u.yr({collectionContextStore:i,is_native_drop:!1,is_empty:!0})}),p.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{d.by({environment:this.environment,collectionStore:s,targetStore:l,droppedDirection:t,collectionContextStore:i,groupsPointer:n,droppedStores:o,duplicate:r,transaction:e})}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,groupsPointer:i}=this.props,n=this.emptyDroppableIntoStore.state;if(!n)return;const s=r.collectionViewBlockStore();if(!s)return;const l=m.default.mark("collections.drop_item_lag");m.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>u.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!0})}),p.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{d.tQ({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:o,collectionContextStore:r,groupsPointer:i,files:t,transaction:e})}})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,r=e.groupsStore.getGroupState(t);if(!r)return;const i=r.currentLimit.state,n=e.normalizedSchemaStore.state,l=c.oA(t.map((e=>(0,s.Ko)({schema:n,group:e,timeZone:(0,a.r)()}))));return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:i,loadContentCover:o}})),this.resultStores=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props;var o;return"collectionTypedView"===e.contextType?null===(o=e.groupsStore.getGroupState(t))||void 0===o||null===(o=o.resultsStore.state)||void 0===o?void 0:o[0].getAssociatedCollectionStore():e.collectionStore()}))}getNode(){return super.getNode()}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new g.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t}=this.props,o=this.props.emptyDroppableSize||"none",r=t===X.Vertical;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{style:{...r?{height:o}:{width:o},...e},children:this.renderEmptyDroppable()}),this.resultStores.state.map(((e,t,o)=>(0,O.jsx)(te,{store:e,isLast:t===o.length-1,...this.props},e.id))),this.renderReducerRequest()]})}renderReducerRequest(){const{collectionContextStore:e,groupsPointer:t,disableRequest:o}=this.props;if(o)return;const r=this.resultsReducerStore.state;if(!r)return;const i=e.groupsStore.getGroupState(t);return i?(0,O.jsx)(Y.Z,{id:t.length>0?`results:${(0,l.KW)(t)}`:"collection_group_results",reducer:r,groupsPointer:t,collectionContextStore:e,resultStore:i.reducerResultStore}):void 0}renderEmptyDroppable(){const{disabled:e,analyticsName:t,direction:o,onSelectableEnter:r,canDrop:i,groupsPointer:n}=this.props;if(this.instanceCollectionViewBlockStore){const s=o!==X.Vertical&&(!e&&0===this.resultStores.state.length),l=o===X.Vertical&&!e;return(0,O.jsx)(H.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!0,canDrag:!1,canDropLeft:i&&s,canNativeDropLeft:i&&s,canDropBelow:i&&l,canNativeDropBelow:i&&l,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:t,shouldShowDropZone:i,onEnter:r,groupsPointer:n,style:o===X.Vertical?void 0:{width:"100%",height:"100%"}})}}}q.displayName="CollectionGroupResults";const J=q;function ee(e){window.__c={n:"ResultComponent"};const{isLast:t,collectionContextStore:o,dropzoneGap:i,resultProps:s,resultComponent:l,groupsPointer:a,shouldShowHoverMenu:c,canDrag:d,disabled:p,format:u,getItemSelectableStyle:m,handleOpenPeekPage:g,belowDropZoneMargin:S,analyticsName:y,direction:v,onSelectableEnter:f,canDrop:C,disableScrollToRevealHorizontal:x,touchDragOnly:b,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:P,titleColumnIndex:j,nestedCreateSubitemButton:F,itemSelectableHaloStyle:M}=e,_=(0,n.VK)((()=>h.Bm({store:e.store,collectionContextStore:o})),[o,e.store]),T=(0,r.useMemo)((()=>[]),[]);return _?(0,O.jsx)(Q,{getItemSelectableStyle:m,itemSelectableHaloStyle:M,store:e.store,canDrag:d,resultProps:s,resultComponent:l,collectionContextStore:o,groupsPointer:a,shouldShowHoverMenu:c,canDrop:C&&!p,format:u,handleOpenPeekPage:g,belowDropZoneMargin:S,analyticsName:y,disabled:p,direction:v,dropzoneGap:i,onSelectableEnter:f,disableScrollToRevealHorizontal:x,touchDragOnly:b,isLast:t,subitemPath:T,titleColumnIndex:j,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:P,nestedCreateSubitemButton:F}):null}const te=r.memo(ee)},64347:(e,t,o)=>{o.d(t,{Z:()=>L});o(67294);var r=o(83355),i=o(49085),n=o(14714),s=o(80951),l=o(72126),a=o(49865),c=o(92918),d=o(30206),p=o(48936),u=o(3687),h=o(96851),m=o(85893);class g extends r.Z{UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{groupFormat:t,collectionContextStore:o}=this.props;a.V$({environment:this.environment,collectionContextStore:o,groupFormat:t})}renderComponent(){const{renderGroup:e,groupFormat:t,groupsDisplayState:o,disabled:r,groupsFormatKey:i,groupAggregationKey:n,format:s,schema:l,collectionContextStore:a,onGroupHeaderAddItem:c,renderHeader:d,getGroupStyle:p,stickyLeft:g,ignoreAncestorStickyContainer:S,paddingLeft:y,isFullScreen:v,index:f,isRootChild:C,isInPeekRenderer:x,groupBy:b,isLast:w}=this.props,k=a.groupsStore.getGroupState(t);if(!k)return;const{toggleStateStore:P}=k,j=P.state,F={groupFormat:t,currentGroups:o.currentGroups,disabled:r,groupsFormatKey:i,groupAggregationKey:n,format:s,schema:l,collectionContextStore:a,isFullScreen:v,isInPeekRenderer:x,onGroupHeaderAddItem:c,stickyLeft:g,index:f,paddingLeft:y,isRootChild:C,groupBy:b};return(0,m.jsx)(h.Z,{ignoreAncestorContainer:S,renderEmitter:a.renderEmitter,isFullScreen:v,children:(0,m.jsxs)("div",{style:{width:"100%",position:"relative",...p?p({groupFormat:t,...o,index:f,isLast:w,toggleStateStore:P}):void 0},children:[d?d(F):(0,m.jsx)(u.Z,{...F}),j&&e(t)]})})}}g.displayName="CollectionGroup";const S=g;var y=o(32949),v=o(25458),f=o(75498),C=o(34232),x=o(78316),b=o(480),w=o(86628),k=o(24405),P=o(39192),j=o(356),F=o(36596),M=o(62010);function _(e){window.__c={n:"GalleryGroupShimmer"};const{width:t}=e,o=(0,b.O7)(),r=(0,w.VK)((()=>o.WindowSizeStore.state.width<=j.AY),[o]),i=(0,k.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${r?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,r]);return(0,m.jsxs)("div",{style:i.container,children:[(0,m.jsxs)("div",{style:i.groupContainer,children:[(0,m.jsx)("div",{style:i.iconContainer,children:(0,P.P)(i.icon)}),(0,m.jsx)(F.Z,{style:i.groupShimmer})]}),(0,m.jsxs)("div",{style:i.itemsContainer,children:[(0,m.jsx)(M.I,{}),(0,m.jsx)(M.I,{}),(0,m.jsx)(M.I,{})]})]})}function T(e){const{isFullScreen:t,galleryCoverSize:o}=e,r=t?2:1,i=(0,x.rD)(o),n=l.DZ(r,(e=>(0,m.jsx)(_,{width:i},e)));return(0,m.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:n})}var G=o(95550);function I(){window.__c={n:"ListGroupShimmer"};const e=(0,k.yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=["50%","30%","40%"].map(((e,t)=>(0,m.jsx)(G.G,{widthPercentage:e},t)));return(0,m.jsxs)("div",{style:e.container,children:[(0,m.jsxs)("div",{style:e.groupContainer,children:[(0,m.jsx)("div",{style:e.iconContainer,children:(0,P.P)(e.icon)}),(0,m.jsx)(F.Z,{style:e.groupShimmer})]}),(0,m.jsx)("div",{style:e.rowsContainer,children:t})]})}function B(e){const{isFullScreen:t}=e,o=t?2:1,r=l.DZ(o,(e=>(0,m.jsx)(I,{},e)));return(0,m.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:r})}function Z(){window.__c={n:"TableGroupShimmer"};const e=(0,k.yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,m.jsxs)("div",{style:e.container,children:[(0,m.jsxs)("div",{style:e.groupContainer,children:[(0,m.jsx)("div",{style:e.iconContainer,children:(0,P.P)(e.icon)}),(0,m.jsx)(F.Z,{style:e.groupShimmer})]}),(0,m.jsxs)("div",{style:e.rowsContainer,children:[(0,m.jsxs)("div",{style:e.rowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(F.Z,{style:e.circleShimmer}),(0,m.jsx)(F.Z,{style:e.rowShimmerShort})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmerShort})})]}),(0,m.jsxs)("div",{style:e.rowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(F.Z,{style:e.circleShimmer}),(0,m.jsx)(F.Z,{style:e.rowShimmerLong})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmer})})]}),(0,m.jsxs)("div",{style:e.lastRowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(F.Z,{style:e.circleShimmer}),(0,m.jsx)(F.Z,{style:e.rowShimmerLong})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(F.Z,{style:e.rowShimmer})})]})]})]})}function A(e){const{isFullScreen:t}=e,o=t?2:1,r=l.DZ(o,(e=>(0,m.jsx)(Z,{},e)));return(0,m.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:r})}function R(){window.__c={n:"TimelineTableGroupsShimmer"};const e=(0,k.yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,m.jsxs)("div",{style:e.rowsContainer,children:[(0,m.jsx)("div",{style:e.rowContainer,children:(0,m.jsx)(F.Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.rowContainer,children:(0,m.jsx)(F.Z,{style:e.rowShimmer})})]})}function V(e){window.__c={n:"GroupsShimmer"};const{viewType:t,isFullScreen:o,galleryCoverSize:r}=e;if(!(0,C.Z)(!0,0,100))return null;switch(t){case"table":return(0,m.jsx)(A,{isFullScreen:o});case"list":return(0,m.jsx)(B,{isFullScreen:o});case"gallery":return(0,m.jsx)(T,{isFullScreen:o,galleryCoverSize:r});case"timeline":return(0,m.jsx)(R,{});case"calendar":case"board":default:return null}}class D extends r.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:i.default.createClass(void 0),hiddenGroupsVisible:i.default.createClass(!1)},this.renderResult=e=>{var t;const{disabled:o,collectionContextStore:r,groupBy:i,isFullScreen:l,shouldSurpressShimmer:a,format:p}=this.props,u=r.groupsLimit.state,h=e.hiddenGroups.slice(0,c.ew),g=r.permissionScopes.state,S=!a&&(0,d.vq)({collectionContextStore:r,displayState:e}),y=null===(t=r.collectionViewStore())||void 0===t?void 0:t.getType(),{visibleGroups:v,hiddenGroups:f,total:C}=e,x=0===v.length&&!r.shouldShowSpinner.state||v.length>0,b=u<C-f.length&&x||(0,d.gf)({collectionContextStore:r,isForColumnGroups:!1}),w=!o&&!g.isLocked&&g.canConfigureBlock&&!S&&(0,n.Wz)(i,g.canConfigureCollection)&&"collectionTypedView"!==r.contextType&&!(0,s.wl)(i.property)&&x;return(0,m.jsxs)("div",{style:{position:"relative"},children:[this.renderGroups(e.visibleGroups),S&&(0,m.jsx)(V,{viewType:y,isFullScreen:l,galleryCoverSize:p.gallery_cover_size}),b&&(0,m.jsx)(E,{renderGroupsLoadMoreButton:this.props.renderGroupsLoadMoreButton,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e,style:this.props.stickyLeft?{position:"sticky",left:this.props.paddingLeft}:void 0}),h.length>0&&(0,m.jsxs)(m.Fragment,{children:[this.renderHiddenGroupsButton(h),this.stores.hiddenGroupsVisible.state&&this.renderGroups(h)]}),w&&this.renderAddGroupButton()]})},this.renderGroup=(e,t,o)=>{const{renderGroup:r,disabled:i,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:c,collectionContextStore:d,isFullScreen:p,onGroupHeaderAddItem:u,renderHeader:h,getGroupStyle:g,stickyLeft:y,stickyTopHeaderOffset:v,ignoreAncestorStickyContainer:f,paddingLeft:C,isRootChild:x,groupBy:b,isInPeekRenderer:w}=this.props,k=t===o.length-1;if(d.groupsStore.getGroupState(e))return(0,m.jsx)(S,{groupBy:b,groupFormat:e,groupsDisplayState:this.groupsDisplayStateStore.state,disabled:i,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:c,collectionContextStore:d,isFullScreen:p,isRootChild:x,renderGroup:r,onGroupHeaderAddItem:u,renderHeader:h,getGroupStyle:g,stickyLeft:y,stickyTopHeaderOffset:v,ignoreAncestorStickyContainer:f,paddingLeft:C,index:t,isLast:k,isInPeekRenderer:w},(0,n.mD)(e))},this.handleGroupsChange=()=>{const{format:e,groupsFormatKey:t,collectionContextStore:o}=this.props,r=this.groupsDisplayStateStore.state.currentGroups;a.$D({environment:this.environment,format:e,groupsFormatKey:t,collectionContextStore:o,currentGroups:r})},this.handleGroupsChangeDebounced=l.Ds(this.handleGroupsChange,5e3),this.reducerStore=this.createComputedStore((()=>{const{groupBy:e,disableReducerRequest:t,schema:o,format:r,groupsFormatKey:i,collectionContextStore:n}=this.props,s=n.remoteRequestStore.state;if(!t)return(0,c.ej)({groupBy:e,schema:o,format:r,filter:null==s?void 0:s.loader.filter,groupsFormatKey:i,limit:n.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{schema:e,groupBy:t}=this.props;return(0,n.Qq)({schema:e,groupBy:t})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupBy:t,groupsFormatKey:o,format:r,schema:i,collectionContextStore:s}=this.props,l=s.groupsLimit.state,a=s.collectionViewBlockStore();if(!a)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const d=this.schemaGroupsStore.state,p=this.stores.reducerResultStore.state,u=p?p.results:void 0,h=p?p.total:0,m=(0,c.Cz)({groupBy:t,schema:i,formatGroups:r[o]||[],schemaGroups:d,reducerResults:u,getRecordModel:a.getRecordModel,relativeVariableResult:s.relativeVariableStore.state,viewAppConfigUri:null===(e=s.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),g=m.filter((e=>!(0,n.eF)(e))).slice(0,l),S=m.filter((e=>(0,n.eF)(e)));return{currentGroups:[...g,...S],visibleGroups:g,hiddenGroups:S,total:h}}),!0)}UNSAFE_willMount(e){const{disableReducerRequest:t}=this.props;t||this.groupsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.groupsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}renderComponent(){const e=this.reducerStore.state,t=this.groupsDisplayStateStore.state;return e?(0,m.jsx)(f.Z,{id:this.props.id,reducer:e,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderResult(t)}):this.renderResult(t)}renderGroups(e){return e.map(this.renderGroup)}renderHiddenGroupsButton(e){const{renderHiddenGroupsButton:t}=this.props;return t?t({hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}):(0,m.jsx)("div",{style:{display:"flex"},children:(0,m.jsx)(v.ZP,{style:{marginTop:10,...this.props.stickyLeft?{position:"sticky",left:this.props.paddingLeft}:{}},hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e})})}renderAddGroupButton(){const{schema:e,groupBy:t,renderAddGroupButton:o,collectionContextStore:r,paddingLeft:i}=this.props,n=this.groupsDisplayStateStore.state.currentGroups;return o?o({groupBy:t,schema:e,currentGroups:n,onAccept:e=>H(e,this.environment,this.props.collectionContextStore,this.props.groupsFormatKey,this.props.groupBy,this.props.schema),groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r}):(0,m.jsx)(p.ZP,{groupBy:t,schema:e,currentGroups:n,onAccept:e=>H(e,this.environment,this.props.collectionContextStore,this.props.groupsFormatKey,this.props.groupBy,this.props.schema),groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r,paddingLeft:i,stickyLeft:!0})}}D.displayName="CollectionGroups";const L=D;function E(e){let{displayState:t,renderGroupsLoadMoreButton:o,collectionContextStore:r,schema:i,style:n}=e;const{groupsLimit:s}=r;return o?(0,m.jsx)(m.Fragment,{children:o({visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:s,type:"default",schema:i,collectionContextStore:r})}):(0,m.jsx)("div",{style:{display:"flex"},children:(0,m.jsx)(y.ZP,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:s,type:"default",schema:i,collectionContextStore:r,style:n})})}function H(e,t,o,r,i,n){const s=o.collectionStore();s&&a.tH({update:e,collectionContextStore:o,groupsFormatKey:r,collectionStore:s,environment:t,groupBy:i,schema:n})}},32949:(e,t,o)=>{o.d(t,{VJ:()=>S,ZP:()=>f,bk:()=>g,cG:()=>y});o(67294);var r=o(83355),i=o(56666),n=o(82990),s=o(9291),l=o(8406),a=o(92918),c=o(30206),d=o(12534),p=o(984),u=o(68785),h=o(89728),m=o(85893);const g=30,S=4,y=90;class v extends r.Z{constructor(){super(...arguments),this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,a.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{collectionContextStore:e,visibleGroups:t,total:o,hiddenGroups:r,type:v}=this.props,f=Math.min(a.kW,o-r.length-t.length),C=(0,c.gf)({collectionContextStore:e,isForColumnGroups:"board"===v});return"default"===v?(0,m.jsxs)(h.Z,{onClick:()=>function(e,t,o){o.setState(o.state+a.kW),t.loadingDetails.setState({type:"load_more_groups"}),l.tf(e)}(this.environment,this.props.collectionContextStore,this.props.groupsLimitStore),onMouseDown:d.$0,disabled:C,hoveredStyle:C?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:4,height:g,marginTop:S,marginBottom:S,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...this.props.style},children:[(0,i.o)({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1,marginRight:8}),(0,m.jsx)(s.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:f}}),C&&(0,m.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,m.jsx)(u.Z,{style:{width:12,height:12}})})]}):(0,m.jsxs)(h.Z,{onClick:()=>function(e,t,o){o.setState(o.state+a.kW),t.loadingDetails.setState({type:"load_more_columns"}),l.tf(e)}(this.environment,this.props.collectionContextStore,this.props.groupsLimitStore),onMouseDown:d.$0,disabled:C,hoveredStyle:C?{background:this.theme.whiteButtonBackground}:{},style:{background:null===(x=this.boardColorStore.state)||void 0===x?void 0:x.backgroundColor,color:this.theme.mediumTextColor,fontWeight:n.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:2*p.g1,borderRadius:p.nA,width:y,...this.props.style},children:[(0,m.jsx)("span",{style:{flexGrow:1},children:(0,m.jsx)(s.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:f}})}),C?(0,m.jsx)("div",{style:{marginLeft:4},children:(0,m.jsx)(u.Z,{style:{width:12,height:12}})}):(0,i.o)({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1})]});var x}}v.displayName="CollectionGroupsLoadMoreButton";const f=v},25458:(e,t,o)=>{o.d(t,{BG:()=>d,GQ:()=>c,ZP:()=>p});o(67294);var r=o(86628),i=o(42853),n=o(9291),s=o(12534),l=o(89728),a=o(85893);const c=30,d=4;function p(e){window.__c={n:"CollectionHiddenGroupsButton"};const t=(0,r.VK)((()=>e.hiddenGroupsVisible.state),[e.hiddenGroupsVisible]);return(0,a.jsx)(l.Z,{onClick:function(){e.hiddenGroupsVisible.setState(!e.hiddenGroupsVisible.state)},onMouseDown:s.$0,style:{height:c,marginBottom:d,...e.style},icon:e=>(0,i.i)({...e,...t&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,a.jsx)(n.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}},10912:(e,t,o)=>{o.d(t,{Z:()=>P});o(57658),o(67294);var r=o(83355),i=o(27531),n=o(86628),s=o(24405),l=o(41432),a=o(80951),c=o(95538),d=o(21202),p=o(97880),u=o(12457),h=o(78316),m=o(17311),g=o(35328),S=o(26136),y=o(40971),v=o(12981),f=o(43568),C=o(81865),x=o(35541),b=o(85893);function w(e){return"number"==typeof e}class k extends r.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t,renderAdditionalBlocks:o,rendererBlockStyle:r}=this.props,n=S.G.createChildStore(t,{table:d.iU,id:e}),s=n.getType(),l=o&&void 0!==s?(0,x.u)(n):(0,y.h)(n);if(l)return(0,b.jsx)(i.D,{value:this.restrictedContentStore,children:(0,b.jsx)(l,{store:n,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,g.BX)(n),style:{fontSize:12,opacity:.8,pointerEvents:"none",...r},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))})},e)},this.coverStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,{ThemeStore:o}=this.environment,r=(0,h.NU)({rootStore:e,renderAdditionalBlocks:t,theme:o.state.mode});return r.image?r.image:!(this.props.showLoadingShimmer&&0===r.blockIds.length&&!r.isDefined)&&r.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,o=(0,h.wK)(e,t);return o.image?void 0:o.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,o=[];if(Array.isArray(t)){let r=0;for(;r<t.length;){let i=t[r],n=S.G.createChildStore(e,{table:d.iU,id:i});if(n.getType()===l.Ti.numberedList){const s=[{blockId:i,idx:1}],a=[{id:i,format:void 0,depth:s.length-1,index:s[0].idx}];for(r+=1;r<t.length&&(i=t[r],n=S.G.createChildStore(e,{table:d.iU,id:i}),n.getType()===l.Ti.numberedList);){{const e=n.getParentId();if(n.getParentId()===s[s.length-1].blockId)s.push({blockId:i,idx:1});else{let t=s[s.length-1].idx;for(;s.length>0&&s[s.length-1].blockId!==e;)t=s[s.length-1].idx,s.pop();s.push({blockId:i,idx:t+1})}a.push({id:i,format:void 0,depth:s.length-1,index:s[s.length-1].idx})}r+=1}o.push(a)}else r+=1}}return o}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?(0,b.jsx)(E,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,coverWidth:this.props.coverWidth,onLoadProxiedImage:this.props.onLoadProxiedImage,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle}):"page_content"===e.type?this.renderPageContent():"property"===e.type?(0,b.jsx)(H,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,onLoadProxiedImage:this.props.onLoadProxiedImage,coverWidth:this.props.coverWidth,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle,property:e.property}):void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state,o=this.props.renderAdditionalBlocks&&this.props.store.isCollectionView();if(!1===e)return(0,b.jsx)(B,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,loadingShimmerStyle:this.props.loadingShimmerStyle});if(e){if(!Array.isArray(e))return o?(0,b.jsxs)("div",{style:D(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle),children:[(0,b.jsx)(C.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:_(),render:(e,t)=>{if(t)return(0,b.jsx)(v.Z,{style:{...F(),...O({renderCollectionImage:!0},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...T(),objectPosition:`center ${100*(1-j(this.props.store,this.props.coverPosition))}%`},placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"end"},src:t})}}),(0,b.jsx)(V,{variant:this.props.variant}),(0,b.jsx)("div",{style:A(this.theme,this.props.coverContentFadedOverlayStyle)})]}):(0,b.jsxs)("div",{style:G(this.props.coverHeight,this.props.coverSizeFormat,this.props.imageCoverWrapStyle),children:[(0,b.jsx)(C.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:_(this.props.coverWidth,this.props.coverSizeFormat),render:(e,t)=>{if(t)return(0,b.jsx)(v.Z,{style:{...F(this.props.style),...O({renderCollectionImage:!1},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...T(this.props.coverAspectFormat),objectPosition:`center ${100*(1-j(this.props.store,this.props.coverPosition))}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(V,{variant:this.props.variant})]});if(e.length>0)return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{style:D(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle),children:[t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock),this.props.coverContentFadedOverlay&&(0,b.jsx)("div",{style:A(this.theme,this.props.coverContentFadedOverlayStyle)})]})});if(this.props.showEmptyGalleryCover)return(0,b.jsx)(I,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}else if(this.props.showEmptyGalleryCover)return(0,b.jsx)(I,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const o of t)if(o.find((t=>t.id===e)))return o;return[]}}k.displayName="CollectionItemCover";const P=k;function j(e,t){if(w(t))return t;if(e.getFormatStore().isDefined()){const{page_cover_position:t,card_cover_position:o}=e.getFormat();if(w(o))return o;if(w(t))return t}return.5}function F(e){return e||{}}function M(e,t){if(e)return e;switch(t){case"large":return m.Z.card.desktop.large.height;case"small":return m.Z.card.desktop.small.height;case"medium":default:return m.Z.card.desktop.medium.height}}function _(e,t){return e||(0,h.rD)(t)}function T(e){return{objectFit:void 0===e?"cover":e}}function G(e,t,o){return{height:M(e,t),position:"relative",pointerEvents:"none",overflow:"hidden",...o}}function I(e){let{coverHeight:t,coverSizeFormat:o,emptyGalleryCoverStyle:r}=e;return(0,b.jsx)("div",{style:{height:M(t,o),...r}})}function B(e){let{coverHeight:t,coverSizeFormat:o,loadingShimmerStyle:r}=e;return(0,b.jsx)("div",{style:{height:M(t,o),...r},children:(0,b.jsx)(u.Z,{show:!0,showDelay:100,showHold:0,render:e=>e?(0,b.jsx)(f.Z,{paragraphs:[{lineHeight:12,lineMargin:6,sectionWidths:[100,100,50],repeat:1,sectionMargin:0}]}):void 0})})}function Z(e,t,o,r){const{ThemeStore:i}=t,n="dark"===i.state.mode;switch(e){case"default":return{};case"gallery":return{background:o.collectionGalleryPreviewCardCover,padding:"8px 8px 0",boxShadow:n?"transparent":`inset 0 -1px 0 0 ${o.regularDividerColor}`,...r};default:(0,p.t1)(e)}}function A(e,t){return{width:"100%",height:40,position:"absolute",bottom:0,left:0,background:`linear-gradient(to bottom, transparent, ${e.accentColors.gray[30]} 100%)`,...t}}function R(e,t){switch(e){case"default":return{border:`1px solid ${t.stroke.regular}`,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomRightRadius:4,borderBottomLeftRadius:4};case"gallery":return{borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1};default:(0,p.t1)(e)}}function V(e){let{variant:t}=e;window.__c={n:"ImageBorderComponent"};const o=(0,s.Fg)();switch(t){case"default":return null;case"gallery":return(0,b.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${o.regularDividerColor}`}});default:(0,p.t1)(t)}return null}function D(e,t,o,r,i,n,s){return{height:M(r,i),pointerEvents:"none",overflow:"hidden",position:n?"relative":"static",...Z(e,t,o,s),...s}}function L(e,t,o,r){return{width:"100%",height:M(o,r),...R(e,t),objectPosition:"center"}}function E(e){let{store:t,coverHeight:o,coverSizeFormat:r,imageCoverWrapStyle:i,coverWidth:l,onLoadProxiedImage:a,style:c,variant:d,coverAspectFormat:p,coverPosition:u,showEmptyGalleryCover:h,emptyGalleryCoverStyle:m}=e;window.__c={n:"PageCoverComponent"};const g=(0,s.Fg)(),S=(0,n.VK)((()=>{var e;return null===(e=t.getCover())||void 0===e?void 0:e.cover}),[t]),y=(0,n.VK)((()=>t.pointer),[t]),f=(0,n.VK)((()=>j(t,u)),[u,t]);return S?(0,b.jsxs)("div",{style:G(o,r,i),children:[(0,b.jsx)(C.Z,{url:S,isAuthenticated:!0,permissionRecord:y,width:_(l,r),onFinishedLoadingProxyUrl:e=>a(e),render:(e,t)=>{if(t)return(0,b.jsx)(v.Z,{style:{...F(c),...L(d,g,o,r),...T(p),objectPosition:`center ${100*(1-f)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(V,{variant:d})]}):h?(0,b.jsx)(I,{coverHeight:o,coverSizeFormat:r,emptyGalleryCoverStyle:m}):null}function H(e){let{property:t,store:o,coverHeight:r,coverSizeFormat:i,imageCoverWrapStyle:l,onLoadProxiedImage:d,coverWidth:p,style:u,variant:h,coverAspectFormat:m,coverPosition:g,showEmptyGalleryCover:S,emptyGalleryCoverStyle:y}=e;window.__c={n:"PropertyComponent"};const f=(0,s.Fg)(),x=(0,n.VK)((()=>(0,a.g)(o.getPropertyValue(t)).find((e=>(0,c.SR)({url:e.url})))),[t,o]),w=(0,n.VK)((()=>o.pointer),[o]),k=(0,n.VK)((()=>j(o,g)),[g,o]);return x?(0,b.jsxs)("div",{style:G(r,i,l),children:[(0,b.jsx)(C.Z,{onFinishedLoadingProxyUrl:e=>d(e),url:x.url,isAuthenticated:!0,permissionRecord:w,width:_(p,i),render:(e,t)=>{if(t)return(0,b.jsx)(v.Z,{style:{...F(u),...L(h,f,r,i),...T(m),objectPosition:`center ${100*(1-k)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(V,{variant:h})]}):S?(0,b.jsx)(I,{coverHeight:r,coverSizeFormat:i,emptyGalleryCoverStyle:y}):null}function O(e,t,o,r,i){const{renderCollectionImage:n}=e;return{...L(t,o,r,i),objectPosition:"center center",...n&&{height:void 0,border:`1px solid ${o.lightDividerColor}`,borderBottom:"none",borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},14063:(e,t,o)=>{o.d(t,{vt:()=>je,ZP:()=>Me});var r=o(67294),i=o(83355),n=o(480),s=o(24405),l=o(15145),a=o(14714),c=o(47453),d=o(9291),p=o(49865),u=o(50906),h=o(14900),m=o(75754),g=o(24677),S=o(75079),y=o(78316),v=o(6776),f=o(26999);function C(e){const{environment:t,newStore:o,previousStore:r}=e;g.eP({environment:t,store:o}),h.Z5({store:o}),v.Z.setState({store:o,editMode:"new",previousStore:r})}var x=o(82530),b=o(65273),w=o(43250),k=o(30206),P=o(12534),j=o(17504),F=o(77556),M=o(34583),_=o(3687),T=o(61838),G=o(64347),I=o(86628),B=o(95371),Z=o(77181),A=o(27724),R=o(25348),V=o(99036),D=o(80951),L=o(42875),E=o(72126),H=o(51365),O=o(8055),z=o(98104),N=o(95645),K=o(28651),W=o(28020),U=o(84210),$=o(33929),Q=o(80444),Y=o(19511),X=o(96049),q=o(97039),J=o(78030),ee=o(3386),te=o(84076),oe=o(85893);class re extends N.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:K.Z},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=y.Bm({store:t,collectionContextStore:i});if(n)return(0,oe.jsx)(q.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:J.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:n,collectionViewStore:i.collectionViewStore(),showIfEmpty:this.isEditing.state||i.isCompactView.state,onBgClick:()=>ge(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onEnter:()=>ge(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onEsc:()=>ge(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,onClick:()=>pe(this.props.store)},e)},this.handleMouseMove=()=>{if(!X.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=E.P2(this.handleMouseMove,100),this.handleMouseLeaveDebounced=E.Ds(this.handleMouseLeave,100),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditing=this.createComputedStore((()=>{const e=Y.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditMode=this.createComputedStore((()=>{const e=v.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.newItemPreviousStore=this.createComputedStore((()=>{const e=v.Z.state;return e.store&&e.store.id===this.props.store.id?e.previousStore:void 0})),this.handleTitleTab=()=>{he(ce(this.getNonEmptyProperties(),this.props.schema),this.props.blockPropertyValueOverlayStore,this.props.store,this.props.collectionContextStore,this.environment)},this.handleTitleUntab=()=>{he(ae(this.getNonEmptyProperties(),this.props.schema),this.props.blockPropertyValueOverlayStore,this.props.store,this.props.collectionContextStore,this.environment)},this.handleBlockPropertyTab=()=>{ue(this.findNextOpenableProperty(),this.props.store,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.environment)},this.handleBlockPropertyUntab=()=>{ue(this.findPreviousOpenableProperty(),this.props.store,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.environment)},this.shouldCaptureKeyboard=this.createComputedStore((()=>A.default.state.stores.length>0&&A.default.state.stores[0].id===this.props.store.id))}activate(){const e=se(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),O.c4({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditing.state&&"new"===this.newItemEditMode.state&&z.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),v.Z.reset(),Y.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,r=(0,oe.jsx)(de,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,subitemPath:this.props.subitemPath});return o?(0,oe.jsxs)("div",{style:{display:"flex"},children:[r,(0,oe.jsxs)(te.Z,{href:le(this.props.store),metaHref:se(this.props.store,this.props.collectionContextStore),external:!1,style:(n=this.theme,{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${n.tableDividerColor}`}),innerStyle:{paddingRight:4,marginTop:10,marginBottom:10},children:[(0,oe.jsx)("div",{style:{display:"flex",alignItems:"center"},children:this.renderTitle()}),(0,oe.jsx)("div",{style:{display:"flex",alignItems:"center",paddingLeft:6,marginTop:4},children:t.map(this.renderProperty)})]})]}):(0,oe.jsx)(ee.Z,{capture:this.shouldCaptureKeyboard.state,onShiftEnter:this.props.onShiftEnter,children:(0,oe.jsxs)("div",{style:{display:"flex"},children:[r,(0,oe.jsxs)(te.Z,{href:le(this.props.store),metaHref:se(this.props.store,this.props.collectionContextStore),onClick:()=>me(this.props.store,this.props.handleOpenPeekPage),external:!1,style:(i=this.isEditing.state?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:4,..."single"===i?{height:30}:{minHeight:30}}),innerStyle:{display:"flex",alignItems:"center",paddingRight:4,userSelect:this.isEditing.state?void 0:"none",WebkitUserSelect:this.isEditing.state?void 0:"none"},hoveredStyle:{background:this.isEditing.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditing.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,children:[this.renderTitle(),t.map(this.renderProperty)]})]})});var i,n}renderTitle(){const{store:e,disabled:t,collectionContextStore:o,blockPropertyValueOverlayStore:r}=this.props,i=y.Bm({store:e,collectionContextStore:o});if(!i)return;const{isSyncedCollection:n}=o.permissionScopes.state;return(0,oe.jsx)(q.Z,{store:e,property:n?" title":"title",disabled:t||!e.canEdit(),locked:o.permissionScopes.state.isLocked,format:J.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:i,collectionViewStore:o.collectionViewStore(),forceMouseEntered:this.mouseIsEntered.state&&!(0,W.aT)(this.props.collectionViewBlockStore.id,o.isInPeekRenderer.state),handleOpenPeekPage:()=>me(this.props.store,this.props.handleOpenPeekPage),onTab:this.handleTitleTab,onUntab:this.handleTitleUntab})}findPreviousOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),r=t.isOpen?o.findIndex((e=>e===t.property)):-1,i=E.dF(o,((e,t)=>t<r&&ne(e,this.props.schema)));return i||(this.isEditing.state?"title":ae(o,this.props.schema))}findNextOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),r=t.isOpen?o.findIndex((e=>e===t.property)):-1,i=o.find(((e,t)=>t>r&&ne(e,this.props.schema)));return i||(this.isEditing.state?"title":ce(o,this.props.schema))}getNonEmptyProperties(){const{store:e,schema:t,showProperties:o}=this.props;return e.isDefined()?o.filter((o=>{const r="title"!==o&&this.isEditing.state;return!D.wV({property:o,schema:t,block:e.getModel(),getRecordModel:e.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,L.r)(),intl:$.default.getIntl()})||r})):[]}}re.displayName="CollectionListViewItem";const ie=re;function ne(e,t){const o=t[e];return Boolean(o&&!V.uk.includes(o.type))}function se(e,t){const{mainEditorCurrentBlockStore:o}=Q.default.state;return y.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}function le(e){return(0,U.ZP)({store:e,fullyQualified:!1,pageVisitSource:l.tY.LinkInPage})}function ae(e,t){return E.dF(e,(e=>ne(e,t)))}function ce(e,t){return e.find((e=>ne(e,t)))}function de(e){let{collectionContextStore:t,toggleButton:o,subitemPath:r}=e;window.__c={n:"ToggleButton"};const i=(0,I.VK)((()=>t.currentSubitemFormatStore.state),[t]),n=(null==r?void 0:r.length)??0;if(!i)return null;const s=Math.max((n-1)*Z.Hw,0)+Z.gY;return o?(0,oe.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,oe.jsx)("div",{style:{width:s}}),o]}):(0,oe.jsx)("div",{style:{minWidth:s+Z.Hw}})}function pe(e){h.IH({store:e})}function ue(e,t,o,r,i){if(o.state.isOpen){if("title"===e){H.xv({environment:i,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();g.eP({environment:i,store:t}),z.NX({store:e})}else e?(H.xv({environment:i,blockPropertyValueOverlayStore:o}),H.bA({environment:i,blockPropertyValueOverlayStore:o,store:t,property:e,format:J.C.ListView,collectionContextStore:r})):H.xv({environment:i,blockPropertyValueOverlayStore:o});pe(t)}}function he(e,t,o,r,i){e&&H.bA({environment:i,blockPropertyValueOverlayStore:t,store:o,property:e,format:J.C.ListView,collectionContextStore:r}),pe(o)}function me(e,t){pe(e),t()}function ge(e,t,o){H.xv({environment:e,blockPropertyValueOverlayStore:t}),g.Ys({environment:e,store:o}),pe(o)}var Se=o(60503);function ye(){return{marginTop:1,marginBottom:1,borderRadius:4}}const ve=r.memo((function(e){let{groupFormat:t,store:o,format:i,disabled:s,collectionContextStore:l,schema:a,blockPropertyValueOverlayStore:c}=e;const d=(0,n.O7)(),m=(0,r.useMemo)((()=>t?[t]:[]),[t]),g=(0,r.useMemo)((()=>(i.list_properties?i.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[i]),{permissionScopes:y}=(0,I.VK)((()=>({permissionScopes:l.permissionScopes.state})),[l]),f=(0,I.VK)((()=>l.groupsStore.getGroupState(m)),[m,l]),b=(0,I.VK)((()=>!s&&o.canEdit()&&y.canEditContent&&!y.isSyncedCollection),[s,o,y]),w=(0,r.useCallback)((()=>{if(!f)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation())return;const t=A.default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,r=(0,B.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,Z.Af)(r.map((e=>e.value.store))):"",n=l.subitemExpandedStore.state.get(i),s=Boolean(null==n?void 0:n.isExpanded);x.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:d,perform:o=>{const i=p.yk({environment:d,collectionContextStore:l,groupsPointer:f.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:s?"into":"below"});i&&C({environment:d,newStore:i,previousStore:t})}}),u.sdb(d,"list_item_edit_mode_enter",{...(0,S.Pn)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,d,f]),k=(0,r.useCallback)(((e,t)=>{C({environment:d,newStore:t,previousStore:e})}),[d]),P=(0,r.useMemo)((()=>({schema:a,collectionViewBlockStore:o,showProperties:g,disabled:s,blockPropertyValueOverlayStore:c,collectionContextStore:l,onShiftEnter:w})),[c,l,s,w,a,g,o]),j=(0,r.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:i}=e;if(o)return(0,oe.jsx)(Se.x,{store:t,collectionStore:o,subitemPath:r,indentLevel:i,collectionContextStore:l,disabled:s,groupsPointer:m,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{h.Z5({store:e,transient:!1}),v.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,s,m]);return f?(0,oe.jsx)(R.Z,{collectionContextStore:l,groupsPointer:m,format:i,canDrag:b,resultProps:P,canDrop:!0,resultComponent:ie,disabled:s,shouldShowHoverMenu:!0,direction:R.R.Vertical,analyticsName:"list",getItemSelectableStyle:ye,emptyDroppableSize:0,onSelectableInsertRow:k,nestedCreateSubitemButton:j}):null}));var fe=o(64921),Ce=o(43145),xe=o(66890),be=o(34232),we=o(95550);function ke(e){window.__c={n:"ListShimmer"};const{isFullScreen:t,hasGroups:o,hasPartialResults:r,hasSearchQuery:i,overrideNumShimmerRows:n}=e,s=(0,xe.DK)(),l=(0,I.VK)((()=>null==s?void 0:s.isCompactView.state),[s]);if(!(0,be.Z)(!0,0,100))return null;let a=1;void 0!==n?a=n:o||r||i||(a=t?10:3);const c=a>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],d=E.DZ(a).map((e=>(0,oe.jsx)(we.G,{widthPercentage:e<c.length?c[e]:void 0},e)));return(0,oe.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:l?8:3},children:d})}var Pe=o(79954);const je=8;class Fe extends i.Z{constructor(){super(...arguments),this.renderGroup=e=>{const{store:t,format:o,isFullScreen:r,disabled:i,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l}=this.props,a=e?[e]:[],c=this.isReady.state,d=n.groupsStore.getGroupState(a);if(!d)return;const p=n.permissionScopes.state,u=d.reducerResultStore.state,h=p.isSyncedCollection,m=y.VM({collectionContextStore:n,reducerResult:u,isFullScreen:r}),g=c&&!i&&t.canEdit()&&p.canEditContent&&!h,S=void 0!==u&&(null==u?void 0:u.blockIds.length)>0,v=""!==n.searchQuery.state,f=void 0!==e,C=(0,k.H0)({collectionContextStore:n,groupsPointer:a,hasPartialResults:S});return(0,oe.jsxs)("div",{style:{paddingBottom:e?16:void 0},children:[(0,oe.jsx)(ve,{groupFormat:e,store:t,format:o,disabled:i,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l}),C&&(0,oe.jsx)(ke,{isFullScreen:r,hasGroups:f,hasPartialResults:S,hasSearchQuery:v,overrideNumShimmerRows:n.isCompactView.state&&!S?6:void 0}),m&&(0,oe.jsx)(T.ZP,{groupsPointer:a,store:t,collectionContextStore:n,format:o,isFullScreen:r,incrementLimitsInRelatedGroups:!1}),g&&(0,oe.jsxs)(oe.Fragment,{children:[m&&(0,oe.jsx)("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,oe.jsx)(Be,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,groupState:d})]})]})},this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()}))}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=y.az(s,n),a=t.collection_group_by,c=s.isCompactView.state;return(0,j.Z)((t=>(0,oe.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:w.nM$,children:[(0,oe.jsx)(Pe.Z,{store:e,shouldShowHalo:!n,canSelect:!n&&!c,analyticsName:"list",style:_e(this.props.format),...t,children:a?this.renderGroups(a):this.renderGroup(void 0)}),!l&&(0,oe.jsx)(Ce.Z,{onChange:e=>function(e,t,o,r){const i=o.isLoading.state,n=o.groupsStore.getGroupState([]);if(!n)return;if("collectionVirtualView"===o.contextType)return;const s=n.reducerResultStore.state;e<F.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&p.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:c,isRootChild:d,isInPeekRenderer:p}=this.props;return(0,oe.jsx)(G.Z,{store:t,id:"list_groups",groupBy:e,groupsFormatKey:a.Uh,groupAggregationKey:a.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderGroup,renderHeader:e=>(0,oe.jsx)(Ge,{args:e}),getGroupStyle:e=>function(e,t){if(0===e.index)return{};return{borderTop:`1px solid ${t.tableDividerColor}`}}(e,this.theme),onGroupHeaderAddItem:(e,t,o)=>function(e,t,o,r,i){if(r.device.isMobile)m._({environment:r,store:e,pageVisitSource:l.tY.Create});else if(t)C({environment:r,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],s=i.groupsStore.getGroupState(n);f.CH({environment:r,store:e,peekMode:y.kr(i.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:i,pageVisitSource:l.tY.Create})}}(e,t,o,this.environment,this.props.collectionContextStore),paddingLeft:c,isRootChild:d,isInPeekRenderer:p,onSelectableInsertRow:(e,t)=>function(e,t,o){C({environment:o,newStore:t,previousStore:e})}(e,t,this.environment)})}}Fe.displayName="CollectionListView";const Me=Fe;function _e(e){return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by?void 0:je,paddingBottom:4}}function Te(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}function Ge(e){let{args:t}=e;window.__c={n:"GroupHeaderComponent"};const o=(0,s.Fg)();return(0,oe.jsx)(_.Z,{...t,height:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,o)})}function Ie(e,t,o,r,i){if(!M.M_(t))return;o.collectionStore()&&x.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:t,perform:n=>{o.collectionStore()&&function(e){var t;const{transaction:o,environment:r,results:i,collectionContextStore:n,isFullScreen:s,groupsPointer:a,insertAtIndex:c,from:d,useCrdt:g}=e;n.searchQuery.state&&h.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:s});const v=null===(t=n.groupsStore.getGroupState(a))||void 0===t?void 0:t.resultsStore;if(!v)return;let x;c>0&&(x=i[c]);const b=p.IW({environment:r,collectionContextStore:n,groupsPointer:a,insertAtIndex:c,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:d,useCrdt:g});if(!b)return;const w=b.coercionSucceeded,k=b.newStore;r.device.isMobile?m._({environment:r,store:k,pageVisitSource:l.tY.Create}):w?C({environment:r,newStore:k,previousStore:x}):f.CH({environment:r,store:k,peekMode:(0,y.kr)(n.collectionViewStore()),resultsStore:v,collectionContextStore:n,pageVisitSource:l.tY.Create}),u.W2j(r,{from:d,type:"page",new_page_id:k.id,creating_block_id:k.id,...(0,S.Pn)(n)})}({transaction:n,environment:t,results:e.resultsStore.state,collectionContextStore:o,isFullScreen:r,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:"list_view_add_item_bottom",useCrdt:i})}})}function Be(e){let{groupState:t,collectionContextStore:o,isFullScreen:r}=e;window.__c={n:"AddItemButtonComponent"};const i=(0,s.Fg)(),l=(0,n.O7)();return(0,oe.jsxs)(fe.Z,{onClick:e=>Ie(t,l,o,r,(0,b.SL)(e,"collection_non_table_view")),onMouseDown:P.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,fontSize:14},children:[(0,c.R)(Te(i)),(0,oe.jsx)("div",{style:{color:i.lightTextColor},children:(0,oe.jsx)(d.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})})]})}},60503:(e,t,o)=>{o.d(t,{x:()=>C});var r=o(67294),i=o(480),n=o(86628),s=o(24405),l=o(47453),a=o(82990),c=o(9291),d=o(50906),p=o(49865),u=o(82530),h=o(40663),m=o(75079),g=o(78316),S=o(12534),y=o(40150),v=o(64921),f=o(85893);function C(e){window.__c={n:"CollectionNestedCreateSubitemButton"};const t=(0,i.O7)(),{store:o,collectionContextStore:C,disabled:x,groupsPointer:b,collectionStore:w,subitemPath:k,indentLevel:P,onSubitemCreate:j}=e,F=(0,n.VK)((()=>(0,g.fk)({environment:t,collectionContextStore:C})),[C,t]),M=(0,n.VK)((()=>{var e;return"timeline"===(null===(e=C.collectionViewStore())||void 0===e?void 0:e.getType())}),[C]),_=(0,n.VK)((()=>{var e;return(0,h.$4)()&&"title"===(null===(e=C.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[C]),T=(0,n.VK)((()=>(0,y.f2)({columnIndex:0,titleColumnIndex:0,shouldShowBulkActionsToolbar:F,indentLevel:P+1,isSubitemToggleOnTitleColumn:_})),[P,_,F]),G=(0,s.yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:T+8,fontSize:14,lineHeight:a.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...M&&{borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:T+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[T,M,e.styles]),I=(0,n.VK)((()=>{const e=C.permissionScopes.state,t=w.isSyncedCollection();return!x&&e.canEditContent&&!t}),[C,x,w]),B=(0,r.useCallback)((()=>{u.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:e=>{const r=p.yk({environment:t,collectionContextStore:C,groupsPointer:b,store:o,before:!1,collectionStore:w,transaction:e,subitemPath:k,subitemInsertDirection:"into"});r&&j(r)}}),d.JEO(t,{...(0,m.Pn)(C)})}),[C,t,b,w,o,k,j]);return I?(0,f.jsx)(v.Z,{onClick:B,onMouseDown:S.$0,style:G.newRowButton,children:(0,f.jsxs)("span",{style:G.newRowContainer,children:[(0,l.R)(G.newIcon),(0,f.jsx)("span",{style:G.newText,children:(0,f.jsx)(c.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})}):null}},5023:(e,t,o)=>{o.d(t,{Z:()=>ce});var r=o(67294),i=o(1302),n=o(49085),s=o(15145),l=o(92996),a=o(99036),c=o(6695),d=o(42875),p=o(56666),u=o(25651),h=o(95855),m=o(54497),g=o(72126),S=o(82990),y=o(9291),v=o(50906),f=o(8406),C=o(6404),x=o(51365),b=o(14900),w=o(96802),k=o(9953),P=o(8055),j=o(24677),F=o(98104),M=o(82530),_=o(95645),T=o(28651),G=o(49616),I=o(75079),B=o(52821),Z=o(78316),A=o(84210),R=o(33929),V=o(68056),D=o(65598),L=o(80444),E=o(19511),H=o(96049),O=o(22294),z=o(88923),N=o(27724),K=o(24666),W=o(87636),U=o(984),$=o(10912),Q=o(97039),Y=o(78030),X=o(65089),q=o(64921),J=o(3386),ee=o(84076),te=o(31278),oe=o(26388),re=o(97496),ie=o(65187),ne=o(56282),se=o(85893);const le=(0,y.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name",id:"collectionViewCardItem.itemName.placeholder"}});class ae extends _.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:T.Z,editModeStore:n.default},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:r,handleRepositionClick:i,handleSavePositionClick:n}=e;const{store:s,coverFormat:l,coverAspectFormat:a,collectionContextStore:c}=this.props,{device:d}=this.environment,{isMobile:h}=d,m=this.lastProxiedUrl&&l&&"contain"!==a,g=c.permissionScopes.state,S=s.canEdit()&&("collectionTypedView"===c.contextType||g.canEditContent);if(t&&!this.shouldShowActionButton.state)return;const v=z.default.state.open&&z.default.state.target.id===s.id,f=Z.kr(null==c?void 0:c.collectionViewStore()),x=(0,G.X9)(f,!1);return(0,se.jsxs)(W.Z,{isVisible:t,position:"top",children:[m&&!o&&!h&&(0,se.jsx)(q.Z,{style:re.ar,onClick:e=>i(e,this.lastProxiedUrl),children:(0,se.jsx)(y.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),m&&o&&!h&&(0,se.jsx)(q.Z,{style:re.ar,onClick:n,children:(0,se.jsx)(y.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),m&&o&&!h&&(0,se.jsx)(q.Z,{style:re.ar,onClick:r,children:(0,se.jsx)(y.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),this.shouldShowEditButton.state&&S&&!this.normalizedCardSelectionStore.state&&!g.isSyncedCollection&&(0,se.jsx)(oe.ZP,{renderTooltip:()=>(0,se.jsx)(y.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:e=>(0,se.jsx)(q.Z,{style:re.ar,onClick:()=>{this.handleEditButtonClick("click")},...e,children:(0,u.R)({width:16,height:16})})}),this.normalizedCardSelectionStore.state&&!v&&(0,se.jsx)(oe.ZP,{renderTooltip:()=>x.tooltip,render:e=>(0,se.jsx)(q.Z,{style:re.ar,onClick:()=>{this.peekUrl.state&&(P.c4({environment:this.environment,url:this.peekUrl.state}),this.disallowEmptyDelete())},...e,children:x.icon({width:14,height:14})})}),!o&&(0,se.jsx)(oe.ZP,{renderTooltip:()=>(0,se.jsx)(y.FormattedMessage,{defaultMessage:"Rename, delete, move to and more",id:"collectionViewCardItem.repositionAction.tooltip"}),render:e=>(0,se.jsx)(q.Z,{style:re.ar,onClick:e=>function(e,t,o,r){j.Ys({environment:t,store:r}),C.Qn({environment:t,stores:N.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actionSectionGroupKey:"default",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:o}})}(e,this.environment,this.props.collectionContextStore,this.props.store),...e,children:(0,p.o)({width:14,height:14})})})]})},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=t.getAssociatedCollectionStore();if(!n)return;const s=this.normalizedCardSelectionStore.state,l="gallery"===Se(this.props.collectionContextStore)?Y.C.GalleryView:Y.C.Board,a=Boolean(i.normalizedFormatStore.state.table_wrap);return(0,se.jsx)(Q.Z,{store:t,property:e.property,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:l,tableWrap:a||Boolean(e.wrap),blockPropertyValueOverlayStore:r,collectionStore:n,showIfEmpty:s,onEnter:this.handleBlockPropertyEsc,onEsc:this.handleBlockPropertyEsc,onBgClick:this.handleBlockPropertyEsc,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e.property)},this.renderDiscussionIndicator=()=>{const{store:e}=this.props,t=D.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return(0,se.jsxs)("div",{style:this.getDiscussionIndicatorWrapStyle(),children:[(0,h.z)({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t]})},this.handleBlockSpace=()=>{this.handleEditButtonClick("space")},this.handleEditButtonClick=e=>{const{store:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores,i=(0,B.JI)(t);j.eP({environment:this.environment,store:t}),F.NX({store:i}),b.Z5({store:t}),e&&v.sdb(this.environment,"board_item_edit_mode_enter",{...(0,I.Pn)(o),block_id:t.id,from:e,view_type:Se(this.props.collectionContextStore)}),r.setState("existing")},this.handleClick=e=>{this.normalizedCardSelectionStore.state?e.preventDefault():(this.props.handleOpenPeekPage(),this.disallowEmptyDelete())},this.handleTextEnter=()=>{const{store:e,onTextEnter:t,onTextEsc:o,collectionContextStore:r}=this.props,{editModeStore:i}=this.stores;b.MO(),F.ZH(this.environment);e.canEdit()&&r.permissionScopes.state.canEditContent&&("new_empty"===i.state?o(e):"new"===i.state?t(e):j.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextEsc=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;b.MO();e.canEdit()&&o.permissionScopes.state.canEditContent&&("new_empty"===r.state?t(e):j.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=this.getShowProperties().map((e=>e.property));o.length>0&&x.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:o[0],format:Y.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleTrackTitlePropertyEdit=()=>{const e=Se(this.props.collectionContextStore);if(!e)return;const{store:t,collectionContextStore:o}=this.props;f.rv({environment:this.environment,collectionContextStore:o,block_id:t.id,property:"title",property_type:"text",from:e}),this.disallowEmptyDelete()},this.handleTextUntab=()=>{const e=this.getShowProperties().map((e=>e.property)),t=g.dF(e,((e,t)=>me(e,this.props.schema)));t&&x.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:t,format:Y.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleBlockPropertyEsc=()=>{x.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),j.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyDelete()},this.handleBlockPropertyTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state,r=this.getShowProperties().map((e=>e.property)),n=o.isOpen?r.findIndex((e=>e===o.property)):-1,s=r.find(((e,t)=>t>n&&me(e,this.props.schema)))||r.find(((e,t)=>!this.normalizedCardSelectionStore.state&&me(e,this.props.schema)));s?i.default.afterNextFlush((()=>{x.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:s,format:Y.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&i.default.afterNextFlush((()=>{this.handleEditButtonClick()})),x.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleBlockPropertyUntab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state;if(!o.isOpen)return;const r=this.getShowProperties().map((e=>e.property)),n=r.findIndex((e=>e===o.property)),s=g.dF(r,((e,t)=>t<n&&me(e,this.props.schema)))||g.dF(r,((e,t)=>!this.normalizedCardSelectionStore.state&&me(e,this.props.schema)));s?i.default.afterNextFlush((()=>{x.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:s,format:Y.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&i.default.afterNextFlush((()=>{this.handleEditButtonClick()})),x.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleMouseMove=()=>{if(!H.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=g.P2(this.handleMouseMove,100),this.handleMouseLeaveDebounced=g.Ds(this.handleMouseLeave,100),this.handleRecordIconChange=async e=>{const{store:t}=this.props,o=t.getIconStore();if(o){const{serverCommitResult:t}=M.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:this.environment,perform:t=>{k.sO({store:o,value:e,transaction:t})}});await t}this.disallowEmptyDelete()},this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;"new_empty"!==r.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=E.Z.state;return e.isActive&&e.store===this.props.store})),this.isItemSelectedStore=this.createComputedStore((()=>N.default.state.stores.includes(this.props.store))),this.shouldShowEditButton=this.createComputedStore((()=>{const e=this.isEditingTitle.state,t=ye(this.props.format,this.props.collectionContextStore),o=this.getShowProperties();return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitle=this.createComputedStore((()=>{var e;const{blockPropertyValueOverlayStore:t}=this.props,o=K.default.state;return"editing"===o.mode&&(null===(e=(0,V.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,B.JI)(this.props.store)&&!t.state.isOpen})),this.peekUrl=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=L.default.state;return Z.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrl=this.createComputedStore((()=>{const{store:e}=this.props;return(0,A.ZP)({store:e,fullyQualified:!1,pageVisitSource:s.tY.LinkInPage})})),this.shouldShowActionButton=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=O.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!H.Z.state)),this.disallowEmptyDelete=()=>{const{editModeStore:e}=this.stores;"new_empty"===e.state&&(e.setState("new"),E.Z.state.isActive&&E.Z.setState({...E.Z.state,transient:!1}))}}activate(){const e=this.peekUrl.state;e&&(this.props.handleOpenPeekPage(),P.c4({environment:this.environment,url:e}))}UNSAFE_willMount(){var e;const{editModeStore:t}=this.stores,o=K.default.state,r="editing"===o.mode&&(null===(e=(0,V.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,B.JI)(this.props.store),i=E.Z.state,n=i.isActive&&i.transient;r&&n?t.setState("new_empty"):r?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{store:t,coverFormat:o,coverAspectFormat:i,coverWidth:n,coverHeight:s,coverSizeFormat:l,shouldShowTitle:a,colorStyle:c,onShiftEnter:d}=this.props,p=this.pageUrl.state,u=this.peekUrl.state,h=this.mouseIsEntered.state,m=this.normalizedCardSelectionStore.state,g=Se(this.props.collectionContextStore),S=(0,r.createRef)(),y=(0,se.jsxs)(ee.Z,{ref:S,style:{...ve(this.props.colorStyle,this.props.collectionContextStore,this.theme),position:h?"relative":"static",..."gallery"===g&&{height:"100%"}},innerStyle:{userSelect:m?void 0:"none",WebkitUserSelect:m?void 0:"none",height:"100%",..."board"===g&&{minHeight:40},..."gallery"===g&&{display:"flex",flexDirection:"column"}},hoveredStyle:{background:m?"transparent":(null==c?void 0:c.cardHoveredBackgroundColor)||this.theme.cardHoveredBackground},pressedStyle:{background:m?"transparent":(null==c?void 0:c.cardPressedBackgroundColor)||this.theme.cardPressedBackground},href:p,metaHref:e.isMobile?p:u,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.handleClick,children:[(0,se.jsx)(ne.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:e=>function(e,t,o){const{imagePosition:r,reset:i}=e;M.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:t,perform:e=>{w.bf({store:o,coverPosition:r,transaction:e}),i()}})}(e,this.environment,this.props.store),source:g,small:"small"===l,store:this.props.store,renderControl:this.renderControl,render:e=>{let{imagePosition:r}=e;return o&&(0,se.jsx)($.Z,{variant:"gallery",store:t,coverWidth:n,coverHeight:s,coverFormat:o,coverAspectFormat:i,coverSizeFormat:l,coverPosition:r,showEmptyGalleryCover:"gallery"===g,onLoadProxiedImage:e=>{this.lastProxiedUrl=e}})}}),a&&this.renderTitle(),this.renderProperties(),this.renderDiscussionIndicator()]}),v=this.isItemSelectedStore.state;return(0,se.jsx)(J.Z,{capture:m,onEsc:()=>{b.MO(),this.disallowEmptyDelete()},onEnter:()=>function(e,t){t&&t(e)}(this.props.store,this.props.onTextEnter),onSpace:this.handleBlockSpace,onTab:this.handleBlockPropertyTab,onUntab:this.handleEditButtonClick,children:(0,se.jsxs)(J.Z,{capture:v,onShiftEnter:()=>{M.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{d({blocks:N.default.state.stores,transaction:e})}})},children:[y,ge(this.props.store,this.props.collectionContextStore)&&(0,se.jsx)(X.bZ,{origin:S})]})})}renderTitle(){const{device:e}=this.environment,{store:t,collectionContextStore:o}=this.props,r=(0,B.JI)(t),i=t.hasIcon()||!t.isEmptyPage(),n=t.hasError(),s=t.canEdit()&&o.permissionScopes.state.canEditContent,l=this.normalizedCardSelectionStore.state,a=Se(this.props.collectionContextStore),c=s?(0,se.jsx)(te.Z,{disabled:!1,bucket:"secure",style:{...fe(this.props.collectionContextStore),...e.isMobile?pe:de,..."board"===a&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:t.getIcon(),store:t,onChange:this.handleRecordIconChange,size:e.isMobile?24:20,isEmptyPage:t.isEmptyPage()}):(0,se.jsx)(te.Z,{disabled:!0,bucket:"secure",style:{...fe(this.props.collectionContextStore),...e.isMobile?pe:de},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:t.getIcon(),store:t,size:e.isMobile?24:s?20:18,isEmptyPage:t.isEmptyPage()}),d=(0,se.jsx)(ie.Z,{store:r,disabled:!l,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnter,onEsc:this.handleTextEsc,onTab:this.handleTextTab,onUntab:this.handleTextUntab,onChange:this.handleTrackTitlePropertyEdit,placeholder:l?R.default.formatMessage(le.typeAName):R.default.formatMessage(le.untitledBlock),style:{...e.isMobile?he:ue,..."board"===a&&{flexGrow:1,padding:2},pointerEvents:l?void 0:"none",cursor:l?"text":void 0,..."gallery"===a&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline"});return(0,se.jsxs)("div",{style:this.getTitleWrapStyle(),children:[(i||l)&&!n&&c,n&&(0,m.t)({fill:this.theme.accentColors.orange[500],width:e.isMobile?20:16,marginLeft:e.isMobile?2:4,marginRight:e.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),d]})}renderProperties(){const e=this.getShowProperties();if(0!==e.length)return(0,se.jsx)("div",{style:Ce(this.props.shouldShowTitle,this.props.collectionContextStore),children:e.map(this.renderProperty)})}getShowProperties(){const{store:e,schema:t}=this.props,o=ye(this.props.format,this.props.collectionContextStore);if(!e.isDefined())return[];return o.filter((o=>{const r=this.normalizedCardSelectionStore.state&&"title"!==o.property;return c.XU({block:e.getModel(),property:o.property,schema:t,getRecordModel:this.props.store.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,d.r)(),intl:R.default.getIntl()})||r}))}hasNoProperties(){return 0===this.getShowProperties().length}getTitleWrapStyle(){const e=Se(this.props.collectionContextStore);return{..."gallery"===e&&{width:"100%"},display:"flex",paddingTop:8,paddingLeft:"board"===e?6:10,paddingRight:10,paddingBottom:"gallery"===e&&this.hasNoProperties()?10:6,position:"relative"}}getDiscussionIndicatorWrapStyle(){const e=Se(this.props.collectionContextStore);return{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fill:this.theme.lightTextColor,fontWeight:S.Z.fontWeight.semibold,fontSize:12,paddingLeft:10,paddingRight:10,paddingBottom:8,..."gallery"===e&&{paddingTop:this.hasNoProperties()&&!this.props.shouldShowTitle?8:0}}}}ae.displayName="CollectionViewCardItem";const ce=ae,de={float:"left",marginTop:2,marginRight:4,marginLeft:-2},pe={float:"left",marginTop:0,marginRight:4,marginLeft:-2},ue={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:S.Z.fontWeight.medium,width:"auto"},he={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:S.Z.fontWeight.medium,width:"auto"};function me(e,t){const o=t[e];return Boolean(o&&!a.uk.includes(o.type))}function ge(e,t){var o,r,i;return!(e.getSpaceId()!==(null===(o=L.default.state.currentSpaceStore)||void 0===o?void 0:o.id))&&((null===(r=t.collectionViewStore())||void 0===r?void 0:r.getFormat().app_config_uri)===l.g3&&e.getFormat().app_config_uri===l.z3&&"sprint_board"===(null===(i=L.default.state.mainEditorCurrentBlockStore)||void 0===i?void 0:i.getFormat().special_page_for_pm_launch))}function Se(e){const t=e.collectionViewStore();return null==t?void 0:t.getType()}function ye(e,t){return(("board"===Se(t)?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}function ve(e,t,o){const r=Se(t);return{boxShadow:e?o.selectTypeBoardBoxShadow:o.lightBoxShadow,borderRadius:"board"===r?4:3,background:"board"===r?(null==e?void 0:e.cardBackgroundColor)||o.boardItemDefaultBackground:o.collectionGalleryPreviewCardBackground,overflow:"hidden",transition:"background 100ms ease-out",..."board"===r&&{marginBottom:U.ay}}}function fe(e){return{..."board"===Se(e)&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}function Ce(e,t){return{paddingTop:e?0:8,paddingBottom:10,..."board"===Se(t)&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"}}}},96851:(e,t,o)=>{o.d(t,{Z:()=>g});var r=o(45697),i=o.n(r),n=o(73935),s=o(83355),l=o(72126),a=o(8695),c=o(73744),d=o(77546),p=o(49085);class u extends p.default{getInitialState(){return{containerMap:new Map}}}const h=u;class m extends s.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:h},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,window.requestAnimationFrame((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{a.rd({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=l.P2(this.handleScroll,100)}didMount(){const e=a.iN(this);a.H7({container:this,parentContainer:e}),(0,d.Gf)(this.environment)&&this.attachEvents()}willUnmount(){const e=a.iN(this);a.pT({container:this,parentContainer:e}),(0,d.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return this.props.children}attachEvents(){const e=a.iN(this),t=n.findDOMNode(this);if(t){this.element=t;const o=(0,d.VW)(t);o&&(this.scrollableAncestor=o,e||((0,c.lj)(o,"scroll",this.handleScroll),(0,c.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const r=(0,d.Ez)(this.element);r&&(this.resizingAncestor=r,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,c.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,c.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}m.displayName="ComputedStickyContainer",m.contextTypes={computedStickyContainer:i().any,...s.w},m.childContextTypes={computedStickyContainer:i().any,...s.w};const g=m},26964:(e,t,o)=>{o.d(t,{Z:()=>d});o(21703);var r=o(45697),i=o.n(r),n=o(67294),s=o(73935),l=o(83355),a=o(8695);o(95477);class c extends l.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;e&&a.ui({element:this,container:e});const t=s.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&a.Ut(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;e&&a.so({element:this,container:e}),this.element=void 0}renderComponent(){if(this.props.children)return n.Children.only(this.props.children)}}c.displayName="ComputedStickyElement",c.contextTypes={computedStickyContainer:i().any,...l.w};const d=c},44043:(e,t,o)=>{o.d(t,{Z:()=>b});o(67294);var r=o(480),i=o(6695),n=o(56666),s=o(50906),l=o(96802),a=o(82530),c=o(31945),d=o(73063),p=o(53437),u=o(72126),h=o(9291),m=o(87279),g=o(52275),S=o(78140),y=o(32163),v=o(72495),f=o(85893);const C=(0,h.injectIntl)((function(e){const{limit:t}=e;return(0,f.jsx)(h.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));const x=(0,h.injectIntl)((function(e){window.__c={n:"FirstLoadLimitSelectMenu"};const t=(0,r.O7)(),{device:o}=t,{currentLimit:n,onAccept:s,onClose:l,showTitle:a}=e,c=[{key:0,render:e=>(0,f.jsx)(v.Z,{enableActionSheetTitle:!0,title:a&&(0,f.jsx)(h.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:u.oA(i.jk.map(((e,t)=>({key:t,render:t=>(0,f.jsx)(g.Z,{...t,disabled:!1,title:(0,f.jsx)(C,{limit:e}),checkState:u.Xy(n,e)}),action:()=>s(e)}))))}];let d;return d=o.isMobile?{menuType:m.og.ActionSheet}:{menuType:m.og.Popup,width:200},(0,f.jsx)(S.Z,{...d,children:(0,f.jsx)(y.Z,{type:y.i.Vertical,sections:c,onAccept:l,initialFocus:void 0})})}));const b=function(e){let{format:t,collectionContextStore:o}=e;window.__c={n:"FirstLoadLimitActionButton"};const i=(0,r.O7)(),{device:s}=i;return(0,f.jsx)(c.ZP,{popupType:s.isMobile?p.kQ.SlideUp:p.kQ.Popup,renderOrigin:e=>(0,f.jsx)(d.Z,{icon:n.o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:c.vR.End,placementToOrigin:c.pO.Bottom,originGap:8,render:e=>(0,f.jsx)(k,{parent:e,format:t,collectionContextStore:o})})};function w(e){return(0,i.rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function k(e){let{parent:t,format:o,collectionContextStore:i}=e;window.__c={n:"PopupComponent"};const n=(0,r.O7)();return(0,f.jsx)(x,{currentLimit:w(o),onAccept:e=>function(e,t,o){const r=t.collectionViewStore();if(!r)return;const i=r.getType();i&&(a.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,perform:t=>{l.FH({stores:[r],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),s.wds(o,{view_type:i,action:"set_first_load_limit"}))}(e,i,n),onClose:t.close,showTitle:!0})}},62010:(e,t,o)=>{o.d(t,{I:()=>l});o(67294);var r=o(24405),i=o(356),n=o(36596),s=o(85893);function l(e){window.__c={n:"GalleryItemShimmer"};const t=e.minHeight||i.Ju,o=(0,r.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,s.jsx)(n.Z,{style:o.card})}},95550:(e,t,o)=>{o.d(t,{G:()=>a});o(67294);var r=o(86628),i=o(24405),n=o(66890),s=o(36596),l=o(85893);function a(e){window.__c={n:"ListItemShimmer"};const{widthPercentage:t}=e,o=(0,n.DK)(),a=(0,r.VK)((()=>null==o?void 0:o.isCompactView.state),[o]),c=(0,i.yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:a?12:16,height:a?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,a]);return(0,l.jsx)("div",{style:c.rowContainer,children:(0,l.jsxs)("div",{style:c.column,children:[(0,l.jsx)(s.Z,{style:c.circleShimmer}),(0,l.jsx)(s.Z,{style:c.rowShimmer})]})})}},10732:(e,t,o)=>{o.d(t,{Z:()=>c,u:()=>a});var r=o(67294),i=o(86628),n=o(72126),s=o(68785),l=o(85893);function a(e,t){const{calculating:o,aggregation:r}=e.asyncAggregationStatus.state;return r?o&&(0,n.Xy)(t,r):o}function c(e){let{collectionContextStore:t,aggregation:o,children:n}=e;window.__c={n:"AggregationCalculatingIndicator"};const{isCalculating:c,changingType:d}=(0,i.VK)((()=>({isCalculating:a(t,o),changingType:t.asyncAggregationStatus.state.changingType})),[t,o]),p=function(e,t){const o=(0,r.useRef)(e);return(0,r.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(n,c);return c?d?(0,l.jsx)(s.Z,{}):(0,l.jsx)("span",{style:{opacity:.5},children:p??n}):(0,l.jsx)(l.Fragment,{children:n})}},57042:(e,t,o)=>{o.d(t,{Z:()=>r});const r=(0,o(9291).defineMessages)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating"}})},30206:(e,t,o)=>{o.d(t,{$t:()=>l,H0:()=>i,gf:()=>s,vq:()=>n});var r=o(72126);function i(e){const{collectionContextStore:t,groupsPointer:o,hasPartialResults:i}=e,n=t.shouldShowSpinner.state,s="load_general"===t.loadingDetails.state.type&&!i||"load_more_blocks"===t.loadingDetails.state.type&&r.Xy(t.loadingDetails.state.group,o);return n&&s}function n(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinner.state&&0===o.visibleGroups.length}function s(e){const{collectionContextStore:t,isForColumnGroups:o}=e,r=o?"load_more_columns":"load_more_groups";return t.isLoading.state&&t.loadingDetails.state.type===r}function l(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinner.state&&"load_more_blocks"===t.loadingDetails.state.type&&r.Xy(t.loadingDetails.state.group,o)}},34232:(e,t,o)=>{o.d(t,{Z:()=>i});var r=o(67294);function i(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[n,s]=(0,r.useState)(i),l=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{null!==a.current&&window.clearTimeout(a.current),null!==l.current&&window.clearTimeout(l.current),a.current=null,l.current=null,e?0===t?s(!0):l.current=window.setTimeout((()=>{l.current=null,s(!0)}),t):0===o?s(!1):a.current=window.setTimeout((()=>{a.current=null,s(!1)}),o)}),[e,t,o]),n}},6027:(e,t,o)=>{o.d(t,{Z:()=>i});var r=function(e){return e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e}(r||{});const i=r}}]);