"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9938],{31192:(e,t,s)=>{s.d(t,{Pc:()=>ht,TE:()=>ct,VN:()=>dt,ZP:()=>Ct,ZY:()=>ut,d$:()=>pt,em:()=>rt,jo:()=>St,n5:()=>lt,nZ:()=>Bt,pE:()=>gt,sL:()=>at,tb:()=>mt,ww:()=>vt});s(57658),s(30541);var o=s(67294),i=s(1302),n=s(13991),r=s(49085),a=s(99747),l=s(92996),d=s(70475),h=s(41432),c=s(99036),p=s(80951),u=s(65955),g=s(64788),m=s(68074),S=s(9999),v=s(98519),f=s(72126),C=s(6287),y=s(23867),x=s(90965),b=s(70203),k=s(82990),M=s(51454),P=s(9291),w=s(85344),T=s(35253),D=s(54564),B=s(51365),_=s(96802),E=s(32603),L=s(72711),j=s(24677),I=s(98104),V=s(82530),F=s(89626),A=s(57819),Z=s(34047),R=s(92650),H=s(82994),O=(s(95477),s(66890)),W=s(95645),U=s(28651),K=s(28020),N=s(80365),z=s(4708),G=s(75079),$=s(78316),q=s(19124),X=s(11599),J=s(83055),Q=s(70177),Y=s(87279),ee=s(45162),te=s(50627),se=s(98165),oe=s(94134),ie=s(65598),ne=s(45010),re=s(77907),ae=s(18245),le=s(49427),de=s(24646),he=s(54801),ce=s(80444),pe=s(61766),ue=s(77556),ge=s(16772),me=s(80796),Se=s(77080),ve=s(73329),fe=s(29755),Ce=s(77144),ye=s(22294),xe=s(29798),be=s(19671),ke=s(94896),Me=s(82136),Pe=s(91551),we=s(13023),Te=s(88923),De=s(69784),Be=s(27724),_e=s(17963),Ee=s(94960),Le=s(78030),je=s(15201),Ie=s(68709),Ve=s(23063),Fe=s(91754),Ae=s(31945),Ze=s(78140),Re=s(40721),He=s(89728),Oe=s(26388),We=s(58792),Ue=s(98272),Ke=s(67064),Ne=s(61679),ze=s(99731),Ge=s(11803),$e=s(6779),qe=s(2524),Xe=s(56507),Je=s(22735),Qe=s(89534),Ye=s(21953),et=s(13630),tt=s(56199),st=s(65496),ot=s(13677),it=s(34541),nt=s(85893);const rt=k.Z.getCompositeFontFamily(n.SP).sans,at={serif:k.Z.getCompositeFontFamily(n.SP).serif,mono:k.Z.getCompositeFontFamily(n.SP).mono},lt={serif:1.6,mono:1.6},dt={serif:0,mono:.055},ht={serif:15,mono:14},ct={serif:17,mono:15},pt={width:"100%",display:"flex",flexDirection:"column",position:"relative",alignItems:"center",flexGrow:1},ut=14,gt=17,mt=16,St=16;function vt(e){return!!e.isIOS&&"on"===Se.default.getGroup("multi-select-new-page-view-block-layout")}class ft extends W.Z{constructor(){super(...arguments),this.contentEl=null,this.clickedAddIconState=!1,this.openResolvedDiscussionPopup=()=>{this.stores.resolvedDiscussionButtonPopupStore.setState({open:!0}),this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!0})},this.getContentWrapEl=()=>this.contentEl,this.collectionContextStore=new ue.Z(this.environment),this.discussionInputStore=new H.Z(this.environment,(0,y.C)(this.props.store.pointer.spaceId)),this.documentViewHorizontalOffset=this.createComputedStore((()=>{const{store:e}=this.props;return this.marginCommentsVisible.state&&!this.props.store.isFullWidth()?(0,R.gC)(this.environment,(0,$.en)(e),(0,$.Ks)(e)):0})),this.isCompletionsUiVisible=this.createComputedStore((()=>Boolean((0,A.RR)(ge.default.state)))),this.storeTypes={headerFocusStore:r.default.createClass(!1),headerMouseStore:U.Z,detailsFocusStore:r.default.createClass(!1),detailsMouseStore:U.Z,pageViewBlockStore:Me.Z,resolvedDiscussionButtonPopupStore:pe.Z,backlinksButtonPopupStore:pe.Z,templatePickerMenuListStore:xe.Z,loadingPageCoverStore:r.default.createClass(!1)},this.MODULE_MAP={cover:e=>(0,nt.jsx)(Ge.D,{store:this.props.store,isEditable:this.isEditable(),paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight,pageCoverHeight:this.props.pageCoverHeight,onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced},e),titleWithIcon:e=>(0,nt.jsx)(Ne.bU,{children:this.layoutV2_getPeekPageTitleWithIcon()},e),properties:e=>(0,nt.jsx)(Je.V,{store:this.props.store,context:this.props.context,canEdit:this.canEdit()},e),property:(e,t)=>(0,nt.jsx)(Qe._,{propertyId:t,store:this.props.store,context:this.props.context,canEdit:this.canEdit()},e),inlinePageSections:e=>(0,nt.jsx)(Ke.bM,{store:this.props.store,context:this.props.context,disabled:this.props.disabled,inlinePropertyIDs:this.inlinePropertyIDsStore.state,onMouseEnter:this.handleDetailsMouseEnter,onMouseLeave:this.handleDetailsMouseLeave},e),expandedBacklinks:e=>(0,nt.jsx)(ze.o,{store:this.props.store},e),discussions:e=>(0,nt.jsx)($e.s,{store:this.props.store,shouldShowDiscussion:this.shouldShowDiscussion(),disableDiscussionInput:!1},e),bottomControls:e=>{const{bottomControls:t}=this.headerAndBottomControlsStore.state;return 0===t.length?null:(0,nt.jsx)(Ne.bU,{children:(0,nt.jsx)(Ie.p,{allowSelectionWithin:!0,children:(0,nt.jsx)("div",{style:(s=this.theme,{display:"flex",alignItems:"baseline",justifyContent:"flex-start",flexWrap:"wrap",color:s.lightTextColor,fontFamily:k.Z.getCompositeFontFamily(n.SP).sans}),className:"notion-page-details-controls",onMouseEnter:this.handleDetailsMouseEnterThrottled,onMouseMove:this.handleDetailsMouseEnterThrottled,onMouseLeave:this.handleDetailsMouseLeaveDebounced,children:t})})},e);var s},editor:(e,t)=>{let{pathToBlockId:s}=t;return(0,nt.jsx)(qe.H,{pageBlockStore:this.props.store,pathToBlockId:s,disabled:this.props.disabled,context:this.props.context,loadingContainerStore:this.props.loadingContainerStore,templatePickerMenuListStore:this.stores.templatePickerMenuListStore,handlePlaceholderWrapClick:e=>L.og(e,this.props.store,this.environment),pageViewBlockAccessor:this.getContentWrapEl,legacyStyles:this.getLayoutContentStyles(!0).nonIOSLayoutBody,ref:e=>{e&&(this.contentEl=e)}},e)},transcript:e=>(0,nt.jsx)(tt.K,{store:this.props.store},e),tabs:(e,t)=>{let{tabs:s,style:o}=t;return(0,nt.jsx)(Ne.kg,{style:o,items:s.map(((e,t)=>({key:t,label:e.label,icon:e.icon?et.q0[e.icon]:void 0,children:e.content.map(((e,t)=>"tabs"===e.type?this.MODULE_MAP.tabs(t,e):"editor"===e.type?this.MODULE_MAP.editor(t,e):"property"===e.type?this.MODULE_MAP.property(t,e.propertyId):this.MODULE_MAP[e.type](t)))})))},e)}},this.getHorizontalTransformStyles=()=>{const e=this.documentViewHorizontalOffset.state;return{layout:{translateX:-1*e},layoutFull:{translateX:e}}},this.headerAndBottomControlsStore=this.createComputedStore((()=>{try{let e=[],t=[];const s=this.pageExpandedBacklinksRenderState(),o=this.pageDiscussionsRenderState({disableDiscussionInput:!1});e=this.getTopControls(),t=this.getBottomControls(s,o);const i=this.getCommentControlPlacement({isTopControlsEmpty:0===e.length,isBottomControlsEmpty:0===t.length,discussionsRenderState:o});"top"===i?e.push(this.renderAddDiscussion({isBottomControl:!1})):"bottom"===i&&t.push(this.renderAddDiscussion({isBottomControl:!0}));return{headerControls:(0,nt.jsx)("div",{style:this.getHeaderControlsStyle(),className:"notion-page-controls",children:e}),bottomControls:t}}catch(e){return{bottomControls:[]}}})),this.hasCoverStore=this.createComputedStore((()=>this.props.store.hasCover())),this.hasIconStore=this.createComputedStore((()=>this.props.store.hasIcon())),this.titleStore=this.createComputedStore((()=>this.props.store.getTitleStore())),this.handleAddRandomIconClick=()=>{const{store:e}=this.props;V.createAndCommit({userAction:"PageViewBlock.handleAddRandomIconClick",environment:this.environment,perform:t=>{_.is({store:e,transaction:t})}}),this.clickedAddIconState=!0},this.handleAddRandomCoverClick=async()=>{const{store:e}=this.props,{environment:t}=this,s=e.getCoverStore();if(!s)return;if(s.getValue())return;this.stores.loadingPageCoverStore.setState(!0);const o=(await re.deps.pageCovers.loader()).default;V.createAndCommit({userAction:"PageViewBlock.handleAddRandomCoverClick",environment:t,perform:t=>{L.tk({transaction:t,store:e,coverStore:s,pageCovers:o})}}),this.stores.loadingPageCoverStore.setState(!1)},this.handleAddDiscussion=async()=>{this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!0}),w.ZW(this.environment,{from:"page_comments"}),await i.default.afterNextFlush(),I.NX({store:this.discussionInputStore.state.textStore})},this.handleShowBacklinks=()=>{!function(e,t,s){const o=t.id;"PageDetailsStore"in s&&s.PageDetailsStore.setToggleState({environment:s,type:"backlinks",id:o},e)}(!0,this.props.store,this.environment)},this.handleShowDiscussion=()=>{!function(e,t,s){const o=t.id;"PageDetailsStore"in s&&s.PageDetailsStore.setToggleState({environment:s,type:"discussion",id:o},e)}(!0,this.props.store,this.environment)},this.handleHeaderMouseEnter=()=>{me.Z.state.isDragging||De.default.state.isActive||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{me.Z.state.isDragging||De.default.state.isActive||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleDetailsMouseEnter=()=>{me.Z.state.isDragging||De.default.state.isActive||this.stores.detailsMouseStore.setState({...this.stores.detailsMouseStore.state,mouseEntered:!0})},this.handleDetailsMouseLeave=()=>{me.Z.state.isDragging||De.default.state.isActive||this.stores.detailsMouseStore.setState({...this.stores.detailsMouseStore.state,mouseEntered:!1})},this.handleHeaderMouseEnterThrottled=f.P2(this.handleHeaderMouseEnter,100),this.handleHeaderMouseLeaveDebounced=f.Ds(this.handleHeaderMouseLeave,100),this.handleDetailsMouseEnterThrottled=f.P2(this.handleDetailsMouseEnter,100),this.handleDetailsMouseLeaveDebounced=f.Ds(this.handleDetailsMouseLeave,100),this.handleTitleEditText=e=>{const t=this.titleStore.state;t&&(j.eP({environment:this.environment,store:this.props.store}),e.isAtStartOfLine?I.N_({store:t}):I.NX({store:t}))},this.handleTitleEsc=e=>{const{onTitleEsc:t}=this.props;I.ZH(this.environment),j.ZH(this.environment),t&&t(e)},this.handleTitleTab=e=>{const{store:t}=this.props;if(t.isCollectionView())return!0;if(e.preventDefault(),function(e){return Boolean(bt(e))}(this.props.store)){const e=(0,te.y6)(this.props.store);if(e&&e.collection_page_properties){const s=e.collection_page_properties.find(((e,t)=>function(e,t){if(!bt(t))return!1;const s=kt(t)[e];return Boolean(s&&!c.uk.includes(s.type))}(e.property,this.props.store)));s&&i.default.afterNextFlush((()=>{B.bA({environment:this.environment,blockPropertyValueOverlayStore:Pt(this.props.context),collectionContextStore:this.collectionContextStore,store:t,property:s.property,format:Le.C.Page})}))}}},this.handleTitleUntab=e=>{const{store:t}=this.props;if(t.isCollectionView())return!0;this.handleTitleEsc(e)},this.handleTitleChange=()=>{this.stores.templatePickerMenuListStore.reset()},this.numberOfBacklinks=this.createComputedStore((()=>(0,N.L)(this.props.store,this.environment).backlinks.length)),this.discussionToggleStore=this.createComputedStore((()=>{const e=this.props.store.id;return"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.getToggleState({environment:this.environment,type:"discussion",id:e})})),this.backlinksToggleStore=this.createComputedStore((()=>{const e=this.props.store.id;return"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.getToggleState({environment:this.environment,type:"backlinks",id:e})})),this.inlinePropertyIDsStore=this.createComputedStore((()=>{const e=(0,te.y6)(this.props.store);if(!e)return;const{store:t}=this.props,s=e.collection_page_sections||[],o=kt(this.props.store);return s.filter((e=>{const s=o[e.section];if(!s||"relation"!==s.type)return;const i=t.getPropertyValue(e.section),n=p.j$({relationValue:p.rq(i),propertySchema:s,getRecordModel:t.getRecordModel}).length;return"inline"===e.visibility&&o[e.section]&&0!==n})).map((e=>e.section))})),this.minimalPropertyIDsStore=this.createComputedStore((()=>{const e=(0,te.y6)(this.props.store);if(!e)return;const{store:t}=this.props,s=e.collection_page_sections||[],o=kt(this.props.store);return s.filter((e=>{const s=o[e.section];if(!s||"relation"!==s.type)return;const i=t.getPropertyValue(e.section),n=p.j$({relationValue:p.rq(i),propertySchema:s,getRecordModel:t.getRecordModel}).length;return"minimal"===e.visibility&&o[e.section]||"inline"===e.visibility&&o[e.section]&&0===n})).map((e=>e.section))})),this.showTemplatePickerStore=this.createComputedStore((()=>{const{store:e,loadingContainerStore:t}=this.props,s=this.environment.currentUser.isLoggedIn(),o=this.pageContext&&this.pageContext.publicEditModeStore.state;return Boolean(e&&t&&e.isDefined()&&!e.isLocked()&&e.canEdit()&&!e.hasContent()&&s&&(!(null!=o&&o.hasPublicPermission)||"edit"===(null==o?void 0:o.permission))&&(Boolean(_e.Z.state.pageMap[e.id])||ke.Z.state.pages.has(e.id))&&t.state.ready&&!(0,te.a_)(this.props.store)&&(!(0,q.GD)(o)||"completionPopup"!==ge.default.state.type))})),this.titleStyleStore=this.createComputedStore((()=>{const{device:e}=this.environment,{store:t,paddingLeft:s,paddingRight:o}=this.props,i=t.getFormat(),r=!!i.page_small_text,a=t.isCollectionView(),l=r||e.isMobile||a||Mt(this.props.store)?32:40,d=(0,de.$3)(this.environment)+(0,de.vJ)(this.environment)-s-o;return{color:this.theme.regularTextColor,fontWeight:k.Z.fontWeight.bold,lineHeight:1.2,fontSize:l,fontFamily:k.Z.getHeaderFontFamily({pageFont:i.page_font,locale:n.SP}),cursor:"text",display:"flex",alignItems:"center",textRendering:e.isSafari?"optimizeSpeed":void 0,width:t.isCollectionView()&&!this.props.store.getAppContainerBlockStore()?d:void 0,...this.props.titleStyle}})),this.pageIconProps=this.createComputedStore((()=>({store:this.props.store,isEditable:this.isEditable(),hasCover:this.hasCoverStore.state,isInSidePeek:Mt(this.props.store),openMenuOnMount:this.clickedAddIconState,openMenuOnMountCallback:()=>{this.clickedAddIconState=!1}}))),this.pageTitleProps=this.createComputedStore((()=>({store:this.props.store,disabled:!this.canEdit(),isInSidePeek:Mt(this.props.store),paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight,extraStyles:this.titleStyleStore.state,titlePlaceholder:this.props.titlePlaceholder,collectionContextStore:this.collectionContextStore,shouldShowTemplatePicker:this.showTemplatePickerStore.state,onTitleChange:this.handleTitleChange,onTitleEditText:this.handleTitleEditText,onTitleEsc:this.handleTitleEsc,onTitleUntab:this.handleTitleUntab,onTitleTab:this.handleTitleTab})))}get registries(){return super.registries.concat(le.Z)}getContentInnerWidth(){const e=this.getContentWrapEl();if(e){const t=e.getBoundingClientRect().width,s=this.getContentPadding()??{paddingLeft:0,paddingRight:0};return t-s.paddingLeft-s.paddingRight}}getContentPadding(){const e=this.getContentWrapEl();if(e){if(vt(this.environment.device))return{paddingLeft:0,paddingRight:0};const t=getComputedStyle(e),s=parseFloat(t.getPropertyValue("padding-left")),o=parseFloat(t.getPropertyValue("padding-left"));return{paddingLeft:f.i2(s)?0:s,paddingRight:f.i2(o)?0:o}}}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{store:t,context:s}=e;var o;"page"===this.environment.RouterStore.state.route.name&&(null===(o=this.environment.mobileNative)||void 0===o||o.markTransitionReady({type:"page",id:this.props.store.id}));const i=bt(this.props.store);if(this.collectionContextStore.collectionStore()!==i&&i){const e=i.getParentBlockStore();this.collectionContextStore.setContext({type:"collectionPage",collectionViewBlockStore:e,collectionStore:i})}if(s===Me.S.Frame){const e=this.pageContext&&this.pageContext.publicEditModeStore.state;null!=e&&e.hasPublicPermission&&"edit"===e.permission&&!t.isTemplate()?T.Bw({bannerStore:Tt(this.props.context),id:"EditingPageBanner",contentKey:"editing_page",styleKey:Fe.v.White}):T.qL({bannerStore:Tt(this.props.context),id:"EditingPageBanner"})}if(Dt(this.props.context)){const e=se.oZ(t),s=se.wf(t),o=se.D0(t);if((0,x.nV)(e))T.Bw({bannerStore:Tt(this.props.context),id:"SpaceContentDuplicationPage",contentKey:"space_content_duplication",styleKey:Fe.v.Red,blockStore:t});else if(s)T.Bw({bannerStore:Tt(this.props.context),id:"DeletedPage",contentKey:"deleted_or_moved_page",blockStore:t,styleKey:Fe.v.Red});else if(o)T.Bw({bannerStore:Tt(this.props.context),id:"ArchivedTeamPage",contentKey:"page_in_archived_team",styleKey:Fe.v.Red});else for(const t of["SpaceContentDuplicationPage","DeletedPage","ArchivedTeamPage"])T.qL({bannerStore:Tt(this.props.context),id:t});"sticky"===(0,he.B)({store:t,context:this.pageContext,isDeleted:s})?T.Bw({bannerStore:Tt(this.props.context),id:"Site",contentKey:"site",styleKey:Fe.v.LightBlue,blockStore:t}):T.qL({bannerStore:Tt(this.props.context),id:"Site"})}if(Dt(this.props.context)&&(t.isTemplate()?T.Bw({bannerStore:Tt(this.props.context),id:"CollectionTemplatePage",contentKey:"template_in_page",styleKey:Fe.v.Beige,blockStore:t,context:this.props.context,disabled:this.props.disabled}):t.isInsideFactoryOrDuplicateBlocksAction()?T.Bw({bannerStore:Tt(this.props.context),id:"CollectionTemplatePage",contentKey:"template_in_button",styleKey:Fe.v.Beige,blockStore:t,context:this.props.context,disabled:this.props.disabled}):T.qL({bannerStore:Tt(this.props.context),id:"CollectionTemplatePage"})),s===Me.S.Frame){fe.Z.state.pageMap[t.id]?T.Bw({bannerStore:Tt(this.props.context),id:"ImportingEvernotePage",contentKey:"importing_evernote",styleKey:Fe.v.Blue,blockStore:t}):T.qL({bannerStore:Tt(this.props.context),id:"ImportingEvernotePage"})}t.useCrdt()?T.Bw({bannerStore:Tt(this.props.context),id:"CrdtPage",contentKey:"crdt_page",styleKey:Fe.v.Beige}):T.qL({bannerStore:Tt(this.props.context),id:"CrdtPage"});const n=t.getFormat();Se.default.checkGate("improved_asana_importer_screens")&&null!=n&&n.is_asana_imported_project&&T.Bw({bannerStore:Tt(this.props.context),id:"AsanaImporterBanner",contentKey:"asana_importer_banner",blockStore:t,styleKey:Fe.v.ImportNotification})}didMount(){const{device:e}=this.environment,{store:t,context:s}=this.props,o=this.titleStore.state,i=this.environment.RouterStore.state;let n;var r,a;"page"===i.route.name&&(n=i.route.mobileData,E.updateMetricData({is_push:null===(r=n)||void 0===r?void 0:r.isPush}));if((0,Q.L)(),e.isPhone){const{PageScroller:e}=ne.Z;if(e){if(e.scrollerEl()&&this.canEdit()&&!this.hasCoverStore.state){const t=Lt(this.props.context,this.environment);e.scrollTo(t)}}}o&&this.shouldSelectTitleOnMount()&&(j.eP({environment:this.environment,store:t}),I.NX({store:o}),e.isAndroid&&(null===(a=this.environment.mobileNative)||void 0===a||a.forceShowSoftKeyboard()));if(s===Me.S.Frame&&!this.props.store.isCollectionView()){const e=this.environment.RouterStore.state.initialRoute.name,{initialRenderCompleted:t,initialRenderAfterLoginCompleted:s,initialLoadCachedPageChunkCalledAt:o}=Ce.Z.state;if(t)if(s||"login"!==e){var l;ae.default.measure("navigation_page_render",{environment:this.environment,data:{is_push:(null===(l=n)||void 0===l?void 0:l.isPush)??!1,wasm_sqlite_initialized:Ce.Z.state.metricData.state.wasm_sqlite_initialized}})}else ae.default.measure("initial_page_render_after_login",{environment:this.environment}),Ce.Z.update((e=>({...e,initialRenderAfterLoginCompleted:!0})));else{var d;E.setInitialRenderCompleted();const t=Boolean(null===(d=performance)||void 0===d?void 0:d.mark)?performance.mark("initial_page_render").startTime:performance.now();E.setSubMetric({name:"await_page_chunk_end_to_browser_repaint_start",startTime:e=>{var t;return null===(t=e.await_page_chunk_start_to_await_page_chunk_end)||void 0===t?void 0:t.endTime},endTime:t}),ae.default.measureFromAppStart({metricName:"initial_page_render",endTime:t},{environment:this.environment,data:{...J.IN(),initial_route:e,is_editable:this.isEditable(),profiling_tool:oe.getProfilingToolForSession()},shouldSendIfStatsigNotInitialized:!0}),E.measureSubMetricsInBrowserProfiler(),void 0!==o&&ae.default.measureFromAppStart({metricName:"load_cached_page_chunk_wait_time",endTime:o},{environment:this.environment,data:{initial_route:e},shouldSendIfStatsigNotInitialized:!0})}!function(e,t){const{device:s,RouterStore:o}=t,{route:i}=o.state,n=e;var r;s.isMobileNative&&"page"===i.name&&i.showMoveTo&&n.isEmptyTitle()&&n.isEmptyPage()&&(null===(r=t.mobileNative)||void 0===r||r.markTransitionReady({type:"new_page",id:n.id}))}(this.props.store,this.environment)}if(this.collectionContextStore){const e=(0,G.vS)(this.collectionContextStore);ae.default.measure("collections.open_item_page_lag",{environment:this.environment,data:{...e,peek_mode:Te.default.getPeekMode()}})}!function(e,t){if("space_for_ai"!==(0,F.sy)())return;const s=e.getContentStores()[0],o=F.__.state;if(!s||s.id!==o)return;j.eP({environment:t,store:s}),I.NX({store:s.getBlockTitleStore()})}(this.props.store,this.environment)}willUnmount(){super.willUnmount(),Dt(this.props.context)&&(T.qL({bannerStore:Tt(this.props.context),id:"DeletedPage"}),T.qL({bannerStore:Tt(this.props.context),id:"CollectionTemplatePage"}),(0,z.dk)()&&T.qL({bannerStore:Tt(this.props.context),id:"Site"}),Se.default.checkGate("improved_asana_importer_screens")&&T.qL({bannerStore:Tt(this.props.context),id:"AsanaImporterBanner"}))}renderPageLayoutSchema(e){const t=this.getHorizontalTransformStyles();var s,o;const i=function(e,t,s,o){if(o.device.isPhone)return"phone";if(o.device.isTablet)return(0,te.mO)(t,s,o)?"wide":"tablet";if((0,te.OZ)(s))return Mt(t)?"side-peek":"center-peek";if(function(e){return e===Me.S.InAppTemplatePreview}(s)||function(e){return e===Me.S.InPageSnapShot}(s))return"template-preview";return(0,te.mO)(t,s,o)?e?"wide-right-margin-expanded":"wide":"default"}((s=this.props.store,o=this.environment,{visible:(0,R.fg)(o,s)}).visible,this.props.store,this.props.context,this.environment);return(0,nt.jsx)(Ve.Z,{isVisible:!0,animationStyle:t.layout,render:()=>(0,nt.jsx)(Ne.Ar,{type:i,withBottomPadding:!0,children:e.map(((e,t)=>{if("tabs"===e.type)return this.MODULE_MAP.tabs(t,e);if("property"===e.type)return this.MODULE_MAP.property(t,e.propertyId);if("editor"===e.type)return this.MODULE_MAP.editor(t,e);const s=this.MODULE_MAP[e.type];return s?s(t):null}))})})}layoutV2_getPeekPageTitleWithIcon(){const{headerControls:e}=this.headerAndBottomControlsStore.state;return Mt(this.props.store)?(0,nt.jsxs)(nt.Fragment,{children:[(0,nt.jsx)(Xe.U,{onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,headerControls:e}),(0,nt.jsx)(We.B,{...this.pageIconProps.state,...this.pageTitleProps.state})]}):(0,nt.jsx)("div",{style:(0,te.kC)(this.props.store,this.environment),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:(0,nt.jsx)(Ye.J,{...this.pageIconProps.state,...this.pageTitleProps.state,headerControls:e,headerFocusStore:this.stores.headerFocusStore,paddingLeft:0,paddingRight:0})})}renderPersisted(){var e,t;const{store:s,context:o}=this.props;if(s.getType()===h.Ti.copyIndicator&&(s.getParentTable()!==C.v||s.getParentTable()===C.v&&0===Object.keys(s.getProperties()).length))return(0,nt.jsx)(Ue.X,{});if(s.isCollectionView())return(0,nt.jsx)(O.L1,{value:this.collectionContextStore,children:(0,nt.jsx)(Ee.s,{canEdit:this.canEdit(),context:o,controlHoverStyle:this.getControlHoverStyle({}),handleHeaderMouseEnterThrottled:this.handleHeaderMouseEnterThrottled,handleHeaderMouseLeaveDebounced:this.handleHeaderMouseLeaveDebounced,headerControlsStyle:this.getHeaderControlsStyle(),headerFocusStore:this.stores.headerFocusStore,pageCover:this.renderPageCover(),topControls:this.getTopControls(),...this.pageIconProps.state,...this.pageTitleProps.state,store:s})});let i=Boolean(Se.default.checkGate("enable_transcript_tab")&&(null===(e=this.collectionContextStore.collectionStore())||void 0===e?void 0:e.getDatabaseType())===l.Fi&&(null===(t=this.props.store.getFormatStore().getValue())||void 0===t||null===(t=t.content_tabs)||void 0===t?void 0:t[d.Z]))?this.renderPageLayoutSchema(et.Tf.pageLayoutSchema):this.renderPageLayoutSchema(et.bl.pageLayoutSchema);return this.collectionContextStore&&this.collectionContextStore.contextType&&(i=(0,nt.jsx)(O.L1,{value:this.collectionContextStore,children:i})),(0,ee.Aw)(this.environment)?(0,nt.jsx)(je.O,{displayName:"PageContent",style:{...pt,...this.props.style},disabled:!this.canEdit()||this.props.store.isLocked(),shouldSelectOnEnter:yt,children:i}):i}getTopControls(){const e=[],t=this.renderAddIcon();t&&e.push((0,nt.jsx)(o.Fragment,{children:t},"add-icon"));const s=this.renderAddCover();return s&&e.push((0,nt.jsx)(o.Fragment,{children:s},"add-cover")),e}getBottomControls(e,t){const s=[],i=!e&&this.renderShowBacklinks();i&&s.push((0,nt.jsx)(o.Fragment,{children:i},"backlinks"));const n="hidden"===t.type,r=n&&this.renderShowDiscussion();r&&s.push((0,nt.jsx)(o.Fragment,{children:r},"discussions"));const a=this.renderResolveDiscussionButtonPopupMenu();a&&!n&&s.unshift((0,nt.jsx)(o.Fragment,{children:a},"resoled-discussions"));const l=this.renderMinimalPageSections();return l&&s.push((0,nt.jsx)(o.Fragment,{children:l},"minimal-page-sections")),s}getCommentControlPlacement(e){const{isTopControlsEmpty:t,isBottomControlsEmpty:s,discussionsRenderState:o}=e,{device:i}=this.environment;return this.shouldRenderAddDiscussion()?"hidden"!==o.type||s?i.isMobile&&t?"bottom":"top":"bottom":"hidden"}renderPageCover(){const{WindowSizeStore:e}=this.environment,{store:t,paddingLeft:s,paddingRight:o,pageCoverHeight:i}=this.props,n=t.isCollectionView()?"20vh":i;return(0,nt.jsx)(Ie.p,{allowSelectionWithin:!1,style:(0,Ge.p)(this.props.store,this.environment),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:(0,nt.jsx)(st.Z,{height:n,store:t,disabled:!this.isEditable(),paddingLeft:e.getSafePaddingLeftCSS(s),paddingRight:e.getSafePaddingRightCSS(o),proxyWidth:e.state.width})})}renderAddIcon(){const{device:e}=this.environment;if(this.isEditable()&&!this.hasIconStore.state)return(0,nt.jsx)(He.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,onClick:this.handleAddRandomIconClick,icon:u.o,children:e.isSmallPhone?(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.add.pageIconMobile",defaultMessage:"Icon"}):(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.add.pageIcon",defaultMessage:"Add icon"})},"add-icon")}renderAddCover(){const{device:e}=this.environment;if(this.isEditable()&&!(0,K.qG)(this.props.store.id)&&!this.hasCoverStore.state)return!0===this.stores.loadingPageCoverStore.state?(0,nt.jsx)(He.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,disabled:!0,icon:g.P,children:e.isSmallPhone?(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.add.pageCoverMobileLoading",defaultMessage:"Loading"}):(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.add.pageCoverLoading",defaultMessage:"Loading cover"})},"add-cover-loading"):(0,nt.jsx)(He.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,onClick:this.handleAddRandomCoverClick,icon:g.P,children:e.isSmallPhone?(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.add.pageCoverMobile",defaultMessage:"Cover"}):(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.add.pageCover",defaultMessage:"Add cover"})},"add-cover")}shouldRenderAddDiscussion(){const{store:e}=this.props;return!X.A$("comments","section_hide")&&(!e.isCollectionView()&&(!e.isInsideCollection()&&(!wt(this.props.store)&&(!!e.canComment()&&(!!this.environment.currentUser.isLoggedIn()&&!this.stores.pageViewBlockStore.state.forceDiscussionOpen)))))}renderAddDiscussion(e){const{device:t}=this.environment;return(0,nt.jsx)(He.Z,{style:this.getControlHoverStyle({isBottomControl:e.isBottomControl}),isLightGray:!0,onClick:this.handleAddDiscussion,icon:m.v,children:t.isSmallPhone?(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.add.pageCommentMobile",defaultMessage:"Comment"}):(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.add.pageComment",defaultMessage:"Add comment"})},"add-comment")}renderShowDiscussion(){if(!X.A$("comments","section_hide")&&wt(this.props.store)){const e=xt(this.props.store);return(0,nt.jsx)(He.Z,{isGray:!0,onClick:this.handleShowDiscussion,icon:m.v,style:It(this.theme),children:(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.show.pageComments",defaultMessage:"{numberOfComments, plural, one {{numberOfComments} comment} other {{numberOfComments} comments}}",values:{numberOfComments:e}})},"show-comments")}}renderShowBacklinks(){const e=this.numberOfBacklinks.state;if(0===e)return;if(X.A$("backlinks","section_hide"))return;const t=t=>{let{onClick:s=f.ZT,tooltipEvents:o={},buttonPopupEvents:i={}}=t;return(0,nt.jsx)(He.Z,{isGray:!0,icon:e=>(0,nt.jsx)(jt,{style:e}),style:It(this.theme),onClick:s,...i,...o,children:(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.show.backlinks",defaultMessage:"{numberOfBacklinks, plural, one {{numberOfBacklinks} backlink} other {{numberOfBacklinks} backlinks}}",values:{numberOfBacklinks:e}})})},s=(0,nt.jsx)(Oe.ZP,{renderTooltip:()=>(0,nt.jsx)(P.FormattedMessage,{defaultMessage:"Show pages linked to this page",id:"pageViewBlock.show.backlinks.tooltip"}),placement:Oe.ug.Bottom,delayThreshold:400,render:e=>t({tooltipEvents:e,onClick:this.handleShowBacklinks})},"show-backlinks"),o=(0,nt.jsx)(Ae.ZP,{buttonPopupStore:this.stores.backlinksButtonPopupStore,popupType:Ae.Z4.Popup,renderOrigin:e=>t({buttonPopupEvents:e}),render:()=>{const e={menuType:Y.og.Popup,width:500};return(0,nt.jsx)(Ze.Z,{...e,children:this.numberOfBacklinks.state>0?(0,nt.jsx)(ze.f,{store:this.props.store}):null})}},"backlinks-popup");return X.A$("backlinks","section_collapsed")?o:s}renderMinimalPageSections(){const{store:e,disabled:t}=this.props,s=bt(this.props.store);if(!s)return;const o=kt(this.props.store),i=(0,te.y6)(this.props.store),n=e.isLocked();if(!i)return;const r=this.minimalPropertyIDsStore.state;return r&&r.length?(0,nt.jsx)(ot.Z,{propertyIds:r,store:e,collectionStore:s,disabled:t,locked:n,schema:o,handleMouseMove:this.handleDetailsMouseEnter,handleMouseLeave:this.handleDetailsMouseLeave,handleContextMenu:()=>{},blockPropertyValueOverlayStore:Pt(this.props.context),format:i,type:"minimal",isInPeekRenderer:(0,te.OZ)(this.props.context)}):void 0}pageDiscussionsRenderState(e){if(X.A$("comments","section_hide"))return{type:"hidden"};const t=this.environment.currentUser.isLoggedIn(),s=this.shouldShowDiscussion(),{store:o}=this.props,i=ie.vV(o,{recursivelyLoadAllDiscussions:!1}),n=!e.disableDiscussionInput&&t&&o.canComment()&&0===i.length&&!(0,te.a_)(this.props.store);return!s||!n&&0===i.length?{type:"hidden"}:{type:"visible",showDiscussionInput:n,unresolvedDiscussionStores:i}}renderResolveDiscussionButtonPopupMenu(){const{device:e}=this.environment,t=ie.mY(this.props.store,{recursivelyLoadAllDiscussions:!1});if(0===t.length)return;const s=(0,nt.jsx)(P.FormattedMessage,{id:"pageViewBlock.showResolvedComments.button",defaultMessage:"{numberOfResolvedComments, plural, one {{numberOfResolvedComments} resolved comment} other {{numberOfResolvedComments} resolved comments}}",values:{numberOfResolvedComments:t.length}});return(0,de.Sx)(this.environment)?(0,nt.jsx)(He.Z,{icon:v.k,isGray:!0,style:It(this.theme),onClick:()=>{D.Ib({environment:this.environment,blockStore:this.props.store,analyticsFrom:"page_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1,discussionIds:t.map((e=>e.id))})},children:s}):(0,nt.jsx)(Ae.ZP,{buttonPopupStore:this.stores.resolvedDiscussionButtonPopupStore,popupType:e.isMobile?Ae.Z4.SlideUp:Ae.Z4.Popup,renderOrigin:e=>(0,nt.jsx)(He.Z,{icon:v.k,isGray:!0,style:It(this.theme),...e,children:s}),render:s=>{let o;return o=e.isMobile?{menuType:Y.og.Modal,title:(0,nt.jsx)(P.FormattedMessage,{defaultMessage:"Resolved comments",id:"pageViewBlock.resolvedComments.menuTabTitle"}),right:(0,nt.jsx)(Re.DoneMenuText,{}),onClickRight:s.close,whiteBackground:!0}:{menuType:Y.og.Popup,width:500},(0,nt.jsx)(Ze.Z,{...o,children:t.map(((e,t,o)=>(0,nt.jsx)(it.Z,{store:e,droppable:!0,render:()=>(0,nt.jsx)(re.LazyDiscussion,{store:e,format:Z.O2.Menu,isFirst:0===t,isOnly:1===o.length,discussionLocation:"page_discussion",showResolveButtonByDefaultIfPossible:!0,blockStore:this.props.store,onDismiss:s.close},e.id)},e.id)))})}},"resolve-discussions")}pageExpandedBacklinksRenderState(){return!!this.shouldShowBacklinks()&&0!==this.numberOfBacklinks.state}shouldShowDiscussion(){if(this.stores.pageViewBlockStore.state.forceDiscussionOpen)return!0;const e=X.dy(this.environment,"comments"),t=X.A$("comments","section_collapsed");if(this.props.store.isInsideCollection()&&!wt(this.props.store)&&(e||t))return!0;if(!wt(this.props.store))return!1;const s=this.discussionToggleStore.state;return void 0===s?e:s}shouldShowBacklinks(){const e=X.dy(this.environment,"backlinks"),t=this.backlinksToggleStore.state;return void 0===t?e:t}isEditable(){return this.canEditCollection()&&!this.props.store.isLocked()&&!(0,te.a_)(this.props.store)}shouldSelectTitleOnMount(){const{device:e}=this.environment,{store:t}=this.props,s=this.titleStore.state,{forceSelectTitleOnMount:o}=this.props;return!!s&&(!!o||!t.isCollectionView()&&(!b.QaF(s.getValue())||(0,te.CX)(this.props.store)&&!e.isMobile))}static defaultPageCoverHeight(e){return e.device.isMobile?200:"30vh"}static paddingBottom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{device:s}=e;return s.isTablet?380:s.isIOS?Math.max(350,t):s.isMobile?400:"30vh"}getHeaderControlsStyle(){const{store:e}=this.props,{device:t}=this.environment,{isMobile:s}=t,o=_t(this.props.context,this.environment);let i,r,a;return s?this.hasCoverStore.state?(this.hasIconStore.state,a="block",i=o,r=4):(a="flex",i=o,r=Et(this.environment)):e.isCollectionView()||Mt(this.props.store)?(a="flex",this.hasCoverStore.state?(i=16,r=4):(i=4,r=4)):(a="flex",this.hasIconStore.state?(i=8,r=4):this.hasCoverStore.state?(i=16,r=4):(i=o,r=Et(this.environment))),{display:a,justifyContent:"flex-start",flexWrap:"wrap",marginTop:i,marginBottom:r,marginLeft:-1,color:this.theme.lightTextColor,fontFamily:k.Z.getCompositeFontFamily(n.SP).sans,pointerEvents:"auto"}}getControlHoverIsVisible(e){const{device:t}=this.environment,s=this.stores.headerMouseStore.state.mouseEntered,o=this.stores.detailsMouseStore.state.mouseEntered,i=this.stores.headerFocusStore.state,n=this.stores.detailsFocusStore.state;return!!t.isMobile||(e?o&&!ye.Z.state.isKeyboardMode||n:s&&!ye.Z.state.isKeyboardMode||i)}getControlHoverStyle(e){let{isBottomControl:t}=e;const s=this.getControlHoverIsVisible(t);return{opacity:s?1:0,pointerEvents:s?"auto":"none",transition:"opacity 100ms ease"}}getLayoutContentStyles(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{device:t}=this.environment,{context:s,paddingLeft:o,paddingRight:i}=this.props,{store:n}=this.props,r=n.getFormat(),l=r.page_font||rt,d=at[l],h=(0,te.OZ)(this.props.context),c=Boolean(_e.Z.state.pageMap[n.id])||ke.Z.state.pages.has(n.id),p=(0,te.CX)(this.props.store)&&h&&!this.showTemplatePickerStore.state&&!c,u=s===Me.S.InAppTemplatePreview;let g,m,S;if(t.isMobile)S=t.isAndroid?gt:mt;else{S=r.page_small_text?ht[l]||ut:ct[l]||St}let v={},f={},C={};if(!p){const{WindowSizeStore:t}=this.environment,s=t.getSafePaddingLeftCSS(o),n=t.getSafePaddingRightCSS(i);v={gridTemplateColumns:`${s} calc(100% - ${s} - ${n}) ${n}`},g={},m={},f=this.isCompletionsUiVisible.state?{paddingBottom:"600px"}:(0,te.CX)(this.props.store)?{paddingBottom:"15vh"}:{paddingBottom:0},C={...f,paddingLeft:e?0:s,paddingRight:e?0:n}}const y=dt[l],x=lt[l]||1.5;let b={};h&&(b={minHeight:240,zIndex:1});let k={};u&&(k={margin:"0 auto"});let P={};if(t.isPhone&&!n.isCollectionView()&&this.canEdit()&&!this.hasCoverStore.state){const e=132,t=Lt(this.props.context,this.environment);P={minHeight:`calc(100vh - ${a.g+e-t}px)`}}return{wrapper:{flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...v},leftPadding:g,body:{display:"flex",alignItems:"flex-start",flexDirection:"column",fontFamily:d,fontSize:S,letterSpacing:y?`${y}em`:void 0,lineHeight:x,zIndex:M.ke,...f,...b,...k,...P},rightPadding:m,nonIOSLayoutBody:{flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flex-start",flexDirection:"column",fontFamily:d,fontSize:S,letterSpacing:y?`${y}em`:void 0,lineHeight:x,width:"100%",zIndex:M.ke,...C,...b,...k,...P}}}}const Ct=ft;function yt(){return 0===Be.default.state.stores.length}function xt(e){return ie.Xp(e,{recursivelyLoadAllDiscussions:!1})}function bt(e){return e.getAssociatedCollectionStore()}function kt(e){return e.getSchema()}function Mt(e){return $.en(e)&&(Te.default.isSidePeekOpen()||Te.default.isSidePeekClosing.state)}function Pt(e){return(0,te.OZ)(e)?we.Z:be.Z}function wt(e){return xt(e)>0}function Tt(e){return(0,te.OZ)(e)?Pe.Z:ve.Z}function Dt(e){return function(e){return e===Me.S.Frame}(e)||(0,te.OZ)(e)}function Bt(e,t){if(function(e){return e===ce.default.state.mainEditorCurrentBlockStore}(e)){const{RouterStore:e}=t;return e.state.route.collectionViewId}}function _t(e,t){return t.device.isMobile?16:(0,te.OZ)(e)?32:80}function Et(e){return e.device.isMobile?32:4}function Lt(e,t){return 28+_t(e,t)}function jt(e){let{style:t}=e;return(0,S.J)({...t,transform:"rotate(180deg)"})}function It(e){return{fontWeight:k.Z.fontWeight.medium,color:e.mediumTextColor}}},55095:(e,t,s)=>{s.d(t,{Z:()=>It});s(57658),s(30541);var o=s(67294),i=s(1302),n=s(13991),r=s(480),a=s(6740),l=s(86628),d=s(24405),h=s(49085),c=s(99747),p=s(92996),u=s(70475),g=s(41432),m=s(99036),S=s(80951),v=s(65955),f=s(64788),C=s(68074),y=s(9999),x=s(27961),b=s(98519),k=s(83303),M=s(72126),P=s(6287),w=s(23867),T=s(90965),D=s(70203),B=s(82990),_=s(51454),E=s(9291),L=s(85344),j=s(35253),I=s(54564),V=s(51365),F=s(96802),A=s(32603),Z=s(72711),R=s(61916),H=s(24677),O=s(98104),W=s(29373),U=s(82530),K=s(89626),N=s(57819),z=s(19977),G=s(34047),$=s(92650),q=s(82994),X=(s(95477),s(66890)),J=s(95645),Q=s(28651),Y=s(28020),ee=s(80365),te=s(43250),se=s(4708),oe=s(75079),ie=s(78316),ne=s(19124),re=s(11599),ae=s(12534),le=s(83055),de=s(70177),he=s(87279),ce=s(39500),pe=s(45162),ue=s(50627),ge=s(98165),me=s(94134),Se=s(65598),ve=s(45010),fe=s(89086),Ce=s(77907),ye=s(18245),xe=s(49427),be=s(24646),ke=s(54801),Me=s(80444),Pe=s(61766),we=s(77556),Te=s(16772),De=s(80796),Be=s(77080),_e=s(73329),Ee=s(29755),Le=s(77144),je=s(22294),Ie=s(29798),Ve=s(19671),Fe=s(63971),Ae=s(94896),Ze=s(82136),Re=s(91551),He=s(13023),Oe=s(88923),We=s(69784),Ue=s(27724),Ke=s(17963),Ne=s(4350),ze=s(78030),Ge=s(53223),$e=s(15201),qe=s(68709),Xe=s(23063),Je=s(91754),Qe=s(31945),Ye=s(68785),et=s(78140),tt=s(40721),st=s(89728),ot=s(26388),it=s(58792),nt=s(98272),rt=s(67064),at=s(61679),lt=s(99731),dt=s(11803),ht=s(16720),ct=s(6779),pt=s(2524),ut=s(56507),gt=s(5618),mt=s(22735),St=s(35943),vt=s(21953),ft=s(13630),Ct=s(55217),yt=s(56199),xt=s(65496),bt=s(13677),kt=s(34541),Mt=s(37451),Pt=s(85893);const wt={serif:B.Z.getCompositeFontFamily(n.SP).serif,mono:B.Z.getCompositeFontFamily(n.SP).mono},Tt={serif:1.6,mono:1.6},Dt={serif:0,mono:.055},Bt={serif:15,mono:14},_t={serif:17,mono:15},Et={width:"100%",display:"flex",flexDirection:"column",position:"relative",alignItems:"center",flexGrow:1};function Lt(e){return!!e.isIOS&&"on"===Be.default.getGroup("multi-select-new-page-view-block-layout")}class jt extends J.Z{constructor(){super(...arguments),this.contentEl=null,this.clickedAddIconState=!1,this.openResolvedDiscussionPopup=()=>{this.stores.resolvedDiscussionButtonPopupStore.setState({open:!0}),this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!0})},this.getContentWrapEl=()=>this.contentEl,this.collectionContextStore=new we.Z(this.environment),this.discussionInputStore=new q.Z(this.environment,(0,w.C)(this.props.store.pointer.spaceId)),this.documentViewHorizontalOffset=this.createComputedStore((()=>{const{store:e}=this.props;return this.marginCommentsVisible.state&&!this.props.store.isFullWidth()?(0,$.gC)(this.environment,(0,ie.en)(e),(0,ie.Ks)(e)):0})),this.isCompletionsUiVisible=this.createComputedStore((()=>Boolean((0,N.RR)(Te.default.state)))),this.storeTypes={headerFocusStore:h.default.createClass(!1),headerMouseStore:Q.Z,detailsFocusStore:h.default.createClass(!1),detailsMouseStore:Q.Z,pageViewBlockStore:Ze.Z,resolvedDiscussionButtonPopupStore:Pe.Z,backlinksButtonPopupStore:Pe.Z,templatePickerMenuListStore:Ie.Z,pageDescriptionStore:Fe.Z,loadingPageCoverStore:h.default.createClass(!1)},this.MODULE_MAP={cover:e=>(0,Pt.jsx)(dt.D,{store:this.props.store,isEditable:this.isEditable(),paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight,pageCoverHeight:this.props.pageCoverHeight,onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced},e),titleWithIcon:e=>(0,Pt.jsx)(at.bU,{children:this.layoutV2_getPeekPageTitleWithIcon()},e),properties:e=>(0,Pt.jsx)(mt.V,{store:this.props.store,context:this.props.context,canEdit:this.canEdit()},e),inlinePageSections:e=>(0,Pt.jsx)(rt.bM,{store:this.props.store,context:this.props.context,disabled:this.props.disabled,inlinePropertyIDs:this.inlinePropertyIDsStore.state,onMouseEnter:this.handleDetailsMouseEnter,onMouseLeave:this.handleDetailsMouseLeave},e),expandedBacklinks:e=>(0,Pt.jsx)(lt.o,{store:this.props.store},e),discussions:e=>(0,Pt.jsx)(ct.s,{store:this.props.store,shouldShowDiscussion:this.shouldShowDiscussion(),disableDiscussionInput:!1},e),bottomControls:e=>{const{bottomControls:t}=this.headerAndBottomControlsStore.state;return 0===t.length?null:(0,Pt.jsx)(at.bU,{children:(0,Pt.jsx)(qe.p,{allowSelectionWithin:!0,children:(0,Pt.jsx)("div",{style:is(this.theme),className:"notion-page-details-controls",onMouseEnter:this.handleDetailsMouseEnterThrottled,onMouseMove:this.handleDetailsMouseEnterThrottled,onMouseLeave:this.handleDetailsMouseLeaveDebounced,children:t})})},e)},editor:e=>(0,Pt.jsx)(pt.H,{pageBlockStore:this.props.store,disabled:this.props.disabled,context:this.props.context,loadingContainerStore:this.props.loadingContainerStore,templatePickerMenuListStore:this.stores.templatePickerMenuListStore,handlePlaceholderWrapClick:this.handlePlaceholderWrapClick,pageViewBlockAccessor:this.getContentWrapEl,legacyStyles:this.getLayoutContentStyles(!0).nonIOSLayoutBody,ref:e=>{e&&(this.contentEl=e)}},e),transcript:e=>(0,Pt.jsx)(yt.K,{store:this.props.store},e),tabs:(e,t)=>{let{tabs:s,style:o}=t;return(0,Pt.jsx)(at.kg,{style:o,items:s.map(((e,t)=>({key:t,label:e.label,icon:e.icon?ft.q0[e.icon]:void 0,children:e.content.map(((e,t)=>"tabs"===e.type?this.MODULE_MAP.tabs(t,e):this.MODULE_MAP[e.type](t)))})))},e)}},this.getHorizontalTransformStyles=()=>{const e=this.documentViewHorizontalOffset.state;return{layout:{translateX:-1*e},layoutFull:{translateX:e}}},this.headerAndBottomControlsStore=this.createComputedStore((()=>{try{let e=[],t=[];const s=this.pageExpandedBacklinksRenderState(),o=this.pageDiscussionsRenderState({disableDiscussionInput:!1});e=this.getTopControls(),t=this.getBottomControls(s,o);const i=this.getCommentControlPlacement({isTopControlsEmpty:0===e.length,isBottomControlsEmpty:0===t.length,discussionsRenderState:o});"top"===i?e.push(this.renderAddDiscussion({isBottomControl:!1})):"bottom"===i&&t.push(this.renderAddDiscussion({isBottomControl:!0}));return{headerControls:(0,Pt.jsx)("div",{style:this.getHeaderControlsStyle(),className:"notion-page-controls",children:e}),bottomControls:t}}catch(e){return{bottomControls:[]}}})),this.hasCoverStore=this.createComputedStore((()=>this.props.store.hasCover())),this.hasIconStore=this.createComputedStore((()=>this.props.store.hasIcon())),this.titleStore=this.createComputedStore((()=>this.props.store.getTitleStore())),this.handleAddIconClick=()=>{this.clickedAddIconState=!1},this.handleAddRandomIconClick=()=>{const{store:e}=this.props;U.createAndCommit({userAction:"PageViewBlock.handleAddRandomIconClick",environment:this.environment,perform:t=>{F.is({store:e,transaction:t})}}),this.clickedAddIconState=!0},this.handleAddRandomCoverClick=async()=>{const{store:e}=this.props,{environment:t}=this,s=e.getCoverStore();if(!s)return;if(s.getValue())return;this.stores.loadingPageCoverStore.setState(!0);const o=(await Ce.deps.pageCovers.loader()).default;U.createAndCommit({userAction:"PageViewBlock.handleAddRandomCoverClick",environment:t,perform:t=>{Z.tk({transaction:t,store:e,coverStore:s,pageCovers:o})}}),this.stores.loadingPageCoverStore.setState(!1)},this.handleAddDiscussion=async()=>{this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!0}),L.ZW(this.environment,{from:"page_comments"}),await i.default.afterNextFlush(),O.NX({store:this.discussionInputStore.state.textStore})},this.handleShowBacklinks=()=>{!function(e,t,s){const o=t.id;"PageDetailsStore"in s&&s.PageDetailsStore.setToggleState({environment:s,type:"backlinks",id:o},e)}(!0,this.props.store,this.environment)},this.handleShowDiscussion=()=>{!function(e,t,s){const o=t.id;"PageDetailsStore"in s&&s.PageDetailsStore.setToggleState({environment:s,type:"discussion",id:o},e)}(!0,this.props.store,this.environment)},this.handleAddDescriptionClick=()=>{const{device:e}=this.environment,{pageDescriptionStore:t}=this.stores,{currentUserSettingsStore:s}=Me.default.state,o=Zt(this.props.store);R.YT({environment:this.environment,pageId:this.props.store.id,store:t,userSettingsStore:s,isExpanded:!0,descriptionStore:o}),i.default.afterNextFlush((()=>{const t=Zt(this.props.store);t&&(e.isMobileBrowser||O.NX({store:t}))}))},this.handleHeaderFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,a.E)(t)&&this.stores.headerFocusStore.setState(!0)},this.handleHeaderBlur=()=>{this.stores.headerFocusStore.setState(!1)},this.handleDetailsFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,a.E)(t)&&this.stores.detailsFocusStore.setState(!0)},this.handleDetailsBlur=()=>{this.stores.detailsFocusStore.setState(!1)},this.handleHeaderMouseEnter=()=>{De.Z.state.isDragging||We.default.state.isActive||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{De.Z.state.isDragging||We.default.state.isActive||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleDetailsMouseEnter=()=>{De.Z.state.isDragging||We.default.state.isActive||this.stores.detailsMouseStore.setState({...this.stores.detailsMouseStore.state,mouseEntered:!0})},this.handleDetailsMouseLeave=()=>{De.Z.state.isDragging||We.default.state.isActive||this.stores.detailsMouseStore.setState({...this.stores.detailsMouseStore.state,mouseEntered:!1})},this.handleHideDescription=()=>{const{pageDescriptionStore:e}=this.stores,{currentUserSettingsStore:t}=Me.default.state,s=this.props.store.id,o=Zt(this.props.store);R.YT({environment:this.environment,pageId:s,isExpanded:!1,store:e,userSettingsStore:t,descriptionStore:o})},this.handleShowDescription=()=>{const{pageDescriptionStore:e}=this.stores,{currentUserSettingsStore:t}=Me.default.state,s=this.props.store.id,o=Zt(this.props.store);R.YT({environment:this.environment,pageId:s,isExpanded:!0,store:e,userSettingsStore:t,descriptionStore:o})},this.handleHeaderMouseEnterThrottled=M.P2(this.handleHeaderMouseEnter,100),this.handleHeaderMouseLeaveDebounced=M.Ds(this.handleHeaderMouseLeave,100),this.handleDetailsMouseEnterThrottled=M.P2(this.handleDetailsMouseEnter,100),this.handleDetailsMouseLeaveDebounced=M.Ds(this.handleDetailsMouseLeave,100),this.handleTitleEditText=e=>{const t=this.titleStore.state;t&&(H.eP({environment:this.environment,store:this.props.store}),e.isAtStartOfLine?O.N_({store:t}):O.NX({store:t}))},this.handleTitleEsc=e=>{const{onTitleEsc:t}=this.props;O.ZH(this.environment),H.ZH(this.environment),t&&t(e)},this.handleTitleTab=e=>{const{store:t,preventDefaultTitleTabBehavior:s}=this.props;if(s)return!0;if(e.preventDefault(),function(e){return Boolean(Rt(e))}(this.props.store)){const e=(0,ue.y6)(this.props.store);if(e&&e.collection_page_properties){const s=e.collection_page_properties.find(((e,t)=>function(e,t){if(!Rt(t))return!1;const s=Ht(t)[e];return Boolean(s&&!m.uk.includes(s.type))}(e.property,this.props.store)));s&&i.default.afterNextFlush((()=>{V.bA({environment:this.environment,blockPropertyValueOverlayStore:Kt(this.props.context),collectionContextStore:this.collectionContextStore,store:t,property:s.property,format:ze.C.Page})}))}}},this.handleTitleUntab=e=>{if(this.props.preventDefaultTitleUntabBehavior)return!0;this.handleTitleEsc(e)},this.handlePlaceholderClick=()=>{const{store:e}=this.props;!e.canEdit()||this.props.store.isLocked()||Ot(this.props.store)||(0,ce.X9)()||U.createAndCommit({userAction:"PageViewBlock.handlePlaceholderClick",environment:this.environment,perform:t=>{W.ls({environment:this.environment,store:e,transaction:t})}})},this.handlePlaceholderWrapClick=e=>{(0,ae.ZP)({event:e,context:ae.Af.EditorClick,callback:this.handlePlaceholderClick})},this.handleTitleChange=()=>{this.stores.templatePickerMenuListStore.reset()},this.handleAddTitleClick=()=>{const e=this.titleStore.state;e&&(H.ZH(this.environment),O.NX({store:e}))},this.numberOfBacklinks=this.createComputedStore((()=>(0,ee.L)(this.props.store,this.environment).backlinks.length)),this.discussionToggleStore=this.createComputedStore((()=>{const e=this.props.store.id;return"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.getToggleState({environment:this.environment,type:"discussion",id:e})})),this.backlinksToggleStore=this.createComputedStore((()=>{const e=this.props.store.id;return"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.getToggleState({environment:this.environment,type:"backlinks",id:e})})),this.inlinePropertyIDsStore=this.createComputedStore((()=>{const e=(0,ue.y6)(this.props.store);if(!e)return;const{store:t}=this.props,s=e.collection_page_sections||[],o=Ht(this.props.store);return s.filter((e=>{const s=o[e.section];if(!s||"relation"!==s.type)return;const i=t.getPropertyValue(e.section),n=S.j$({relationValue:S.rq(i),propertySchema:s,getRecordModel:t.getRecordModel}).length;return"inline"===e.visibility&&o[e.section]&&0!==n})).map((e=>e.section))})),this.minimalPropertyIDsStore=this.createComputedStore((()=>{const e=(0,ue.y6)(this.props.store);if(!e)return;const{store:t}=this.props,s=e.collection_page_sections||[],o=Ht(this.props.store);return s.filter((e=>{const s=o[e.section];if(!s||"relation"!==s.type)return;const i=t.getPropertyValue(e.section),n=S.j$({relationValue:S.rq(i),propertySchema:s,getRecordModel:t.getRecordModel}).length;return"minimal"===e.visibility&&o[e.section]||"inline"===e.visibility&&o[e.section]&&0===n})).map((e=>e.section))})),this.showTemplatePickerStore=this.createComputedStore((()=>{const{store:e,loadingContainerStore:t}=this.props,s=this.environment.currentUser.isLoggedIn(),o=this.pageContext&&this.pageContext.publicEditModeStore.state;return Boolean(e&&t&&e.isDefined()&&!e.isLocked()&&e.canEdit()&&!e.hasContent()&&s&&(!(null!=o&&o.hasPublicPermission)||"edit"===(null==o?void 0:o.permission))&&!Ot(this.props.store)&&t.state.ready&&!(0,ue.a_)(this.props.store)&&(!(0,ne.GD)(o)||"completionPopup"!==Te.default.state.type))})),this.shouldShowCollectionViewBlockTitle=this.createComputedStore((()=>{const{store:e}=this.props;if(e.getCollectionViewSourceCollectionStore())return!0;const t=this.titleStore.state;if(!t)return!1;if(D.QaF(t.getValue()))return!0;return!!(0,fe.J5)(t)})),this.titleStyleStore=this.createComputedStore((()=>{const{device:e}=this.environment,{store:t,paddingLeft:s,paddingRight:o}=this.props,i=t.getFormat(),r=!!i.page_small_text,a=t.isCollectionView(),l=r||e.isMobile||a||Ut(this.props.store)?32:40,d=(0,be.$3)(this.environment)+(0,be.vJ)(this.environment)-s-o;return{color:this.theme.regularTextColor,fontWeight:B.Z.fontWeight.bold,lineHeight:1.2,fontSize:l,fontFamily:B.Z.getHeaderFontFamily({pageFont:i.page_font,locale:n.SP}),cursor:"text",display:"flex",alignItems:"center",textRendering:e.isSafari?"optimizeSpeed":void 0,width:t.isCollectionView()&&!this.props.store.getAppContainerBlockStore()?d:void 0,...this.props.titleStyle}})),this.collectionViewProps=this.createComputedStore((()=>{const{store:e,context:t,disabled:s}=this.props;if(e.isCollectionView())return{store:e,context:t,disabled:s,collectionViewId:Jt(this.props.store,this.environment)}})),this.pageIconProps=this.createComputedStore((()=>({store:this.props.store,isEditable:this.isEditable(),hasCover:this.hasCoverStore.state,isInSidePeek:Ut(this.props.store),openMenuOnMount:this.clickedAddIconState,openMenuOnMountCallback:()=>{this.clickedAddIconState=!1}}))),this.pageTitleProps=this.createComputedStore((()=>({store:this.props.store,disabled:!this.canEdit(),isInSidePeek:Ut(this.props.store),paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight,extraStyles:this.titleStyleStore.state,titlePlaceholder:this.props.titlePlaceholder,collectionContextStore:this.collectionContextStore,shouldShowTemplatePicker:this.showTemplatePickerStore.state,onTitleChange:this.handleTitleChange,onTitleEditText:this.handleTitleEditText,onTitleEsc:this.handleTitleEsc,onTitleUntab:this.handleTitleUntab,onTitleTab:this.handleTitleTab}))),this.descriptionProps=this.createComputedStore((()=>{const e=this.pageDescriptionRenderState();if("visible"===e.type)return{type:"description",disabled:!this.isEditable(),canEdit:this.canEdit(),locked:this.props.store.isLocked(),pageId:this.props.store.id,toggleStore:this.stores.pageDescriptionStore,descriptionStore:e.descriptionStore,collectionStore:e.collectionStore,userSettingsStore:e.currentUserSettingsStore}}))}get registries(){return super.registries.concat(xe.Z)}getContentInnerWidth(){const e=this.getContentWrapEl();if(e){const t=e.getBoundingClientRect().width,s=this.getContentPadding()??{paddingLeft:0,paddingRight:0};return t-s.paddingLeft-s.paddingRight}}getContentPadding(){const e=this.getContentWrapEl();if(e){if(Lt(this.environment.device))return{paddingLeft:0,paddingRight:0};const t=getComputedStyle(e),s=parseFloat(t.getPropertyValue("padding-left")),o=parseFloat(t.getPropertyValue("padding-left"));return{paddingLeft:M.i2(s)?0:s,paddingRight:M.i2(o)?0:o}}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{store:t}=this.props,{currentUserSettingsStore:s}=Me.default.state,o=t.id;this.stores.pageDescriptionStore=new Fe.Z,R.nI({pageId:o,store:this.stores.pageDescriptionStore,userSettingsStore:s,descriptionHasText:zt(this.props.store)})}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{store:t,context:s}=e;var o;"page"===this.environment.RouterStore.state.route.name&&(null===(o=this.environment.mobileNative)||void 0===o||o.markTransitionReady({type:"page",id:this.props.store.id}));const i=Rt(this.props.store);if(this.collectionContextStore.collectionStore()!==i&&i){const e=i.getParentBlockStore();this.collectionContextStore.setContext({type:"collectionPage",collectionViewBlockStore:e,collectionStore:i})}if(s===Ze.S.Frame){const e=this.pageContext&&this.pageContext.publicEditModeStore.state;null!=e&&e.hasPublicPermission&&"edit"===e.permission&&!t.isTemplate()?j.Bw({bannerStore:Gt(this.props.context),id:"EditingPageBanner",contentKey:"editing_page",styleKey:Je.v.White}):j.qL({bannerStore:Gt(this.props.context),id:"EditingPageBanner"})}if($t(this.props.context)){const e=ge.oZ(t),s=ge.wf(t),o=ge.D0(t);if((0,T.nV)(e))j.Bw({bannerStore:Gt(this.props.context),id:"SpaceContentDuplicationPage",contentKey:"space_content_duplication",styleKey:Je.v.Red,blockStore:t});else if(s)j.Bw({bannerStore:Gt(this.props.context),id:"DeletedPage",contentKey:"deleted_or_moved_page",blockStore:t,styleKey:Je.v.Red});else if(o)j.Bw({bannerStore:Gt(this.props.context),id:"ArchivedTeamPage",contentKey:"page_in_archived_team",styleKey:Je.v.Red});else for(const t of["SpaceContentDuplicationPage","DeletedPage","ArchivedTeamPage"])j.qL({bannerStore:Gt(this.props.context),id:t});"sticky"===(0,ke.B)({store:t,context:this.pageContext,isDeleted:s})?j.Bw({bannerStore:Gt(this.props.context),id:"Site",contentKey:"site",styleKey:Je.v.LightBlue,blockStore:t}):j.qL({bannerStore:Gt(this.props.context),id:"Site"})}if($t(this.props.context)&&(t.isTemplate()?j.Bw({bannerStore:Gt(this.props.context),id:"CollectionTemplatePage",contentKey:"template_in_page",styleKey:Je.v.Beige,blockStore:t,context:this.props.context,disabled:this.props.disabled}):t.isInsideFactoryOrDuplicateBlocksAction()?j.Bw({bannerStore:Gt(this.props.context),id:"CollectionTemplatePage",contentKey:"template_in_button",styleKey:Je.v.Beige,blockStore:t,context:this.props.context,disabled:this.props.disabled}):j.qL({bannerStore:Gt(this.props.context),id:"CollectionTemplatePage"})),s===Ze.S.Frame){Ee.Z.state.pageMap[t.id]?j.Bw({bannerStore:Gt(this.props.context),id:"ImportingEvernotePage",contentKey:"importing_evernote",styleKey:Je.v.Blue,blockStore:t}):j.qL({bannerStore:Gt(this.props.context),id:"ImportingEvernotePage"})}t.useCrdt()?j.Bw({bannerStore:Gt(this.props.context),id:"CrdtPage",contentKey:"crdt_page",styleKey:Je.v.Beige}):j.qL({bannerStore:Gt(this.props.context),id:"CrdtPage"});const n=t.getFormat();Be.default.checkGate("improved_asana_importer_screens")&&null!=n&&n.is_asana_imported_project&&j.Bw({bannerStore:Gt(this.props.context),id:"AsanaImporterBanner",contentKey:"asana_importer_banner",blockStore:t,styleKey:Je.v.ImportNotification})}didMount(){const{device:e}=this.environment,{store:t,context:s}=this.props,o=this.titleStore.state,i=this.environment.RouterStore.state;let n;var r,a;"page"===i.route.name&&(n=i.route.mobileData,A.updateMetricData({is_push:null===(r=n)||void 0===r?void 0:r.isPush}));if((0,de.L)(),e.isPhone){const{PageScroller:e}=ve.Z;if(e){if(e.scrollerEl()&&this.canEdit()&&!this.hasCoverStore.state){const t=ss(this.props.context,this.environment);e.scrollTo(t)}}}o&&this.shouldSelectTitleOnMount()&&(H.eP({environment:this.environment,store:t}),O.NX({store:o}),e.isAndroid&&(null===(a=this.environment.mobileNative)||void 0===a||a.forceShowSoftKeyboard()));if(s===Ze.S.Frame&&!this.props.store.isCollectionView()){const e=this.environment.RouterStore.state.initialRoute.name,{initialRenderCompleted:t,initialRenderAfterLoginCompleted:s,initialLoadCachedPageChunkCalledAt:o}=Le.Z.state;if(t)if(s||"login"!==e){var l;ye.default.measure("navigation_page_render",{environment:this.environment,data:{is_push:(null===(l=n)||void 0===l?void 0:l.isPush)??!1,wasm_sqlite_initialized:Le.Z.state.metricData.state.wasm_sqlite_initialized}})}else ye.default.measure("initial_page_render_after_login",{environment:this.environment}),Le.Z.update((e=>({...e,initialRenderAfterLoginCompleted:!0})));else{var d;A.setInitialRenderCompleted();const t=Boolean(null===(d=performance)||void 0===d?void 0:d.mark)?performance.mark("initial_page_render").startTime:performance.now();A.setSubMetric({name:"await_page_chunk_end_to_browser_repaint_start",startTime:e=>{var t;return null===(t=e.await_page_chunk_start_to_await_page_chunk_end)||void 0===t?void 0:t.endTime},endTime:t}),ye.default.measureFromAppStart({metricName:"initial_page_render",endTime:t},{environment:this.environment,data:{...le.IN(),initial_route:e,is_editable:this.isEditable(),profiling_tool:me.getProfilingToolForSession()},shouldSendIfStatsigNotInitialized:!0}),A.measureSubMetricsInBrowserProfiler(),void 0!==o&&ye.default.measureFromAppStart({metricName:"load_cached_page_chunk_wait_time",endTime:o},{environment:this.environment,data:{initial_route:e},shouldSendIfStatsigNotInitialized:!0})}!function(e,t){const{device:s,RouterStore:o}=t,{route:i}=o.state,n=e;var r;s.isMobileNative&&"page"===i.name&&i.showMoveTo&&n.isEmptyTitle()&&n.isEmptyPage()&&(null===(r=t.mobileNative)||void 0===r||r.markTransitionReady({type:"new_page",id:n.id}))}(this.props.store,this.environment)}if(this.collectionContextStore){const e=(0,oe.vS)(this.collectionContextStore);ye.default.measure("collections.open_item_page_lag",{environment:this.environment,data:{...e,peek_mode:Oe.default.getPeekMode()}})}!function(e,t){if("space_for_ai"!==(0,K.sy)())return;const s=e.getContentStores()[0],o=K.__.state;if(!s||s.id!==o)return;H.eP({environment:t,store:s}),O.NX({store:s.getBlockTitleStore()})}(this.props.store,this.environment)}willUnmount(){super.willUnmount(),$t(this.props.context)&&(j.qL({bannerStore:Gt(this.props.context),id:"DeletedPage"}),j.qL({bannerStore:Gt(this.props.context),id:"CollectionTemplatePage"}),(0,se.dk)()&&j.qL({bannerStore:Gt(this.props.context),id:"Site"}),Be.default.checkGate("improved_asana_importer_screens")&&j.qL({bannerStore:Gt(this.props.context),id:"AsanaImporterBanner"}))}renderCollectionPageViewBlock(){const{store:e,context:t,style:s,paddingLeft:o,paddingRight:i}=this.props,{WindowSizeStore:n}=this.environment;if(!e.isCollectionView())return;if(t===Ze.S.CollectionPageView){let e=this.renderCollectionPageViewContent();return(0,pe.Aw)(this.environment)&&(e=(0,Pt.jsx)($e.O,{displayName:"PageContent",style:{...Et,...s},disabled:!this.canEdit()||this.props.store.isLocked(),children:e})),e}const r=this.pageDiscussionsRenderState({disableDiscussionInput:!0});return(0,Pt.jsxs)(Pt.Fragment,{children:[this.renderCollectionHeader(),"visible"===r.type&&(0,Pt.jsx)("div",{style:{paddingLeft:n.getSafePaddingLeftCSS(o),paddingRight:n.getSafePaddingRightCSS(i)},children:(0,Pt.jsx)(ct.z,{store:this.props.store,showDiscussionInput:r.showDiscussionInput,unresolvedDiscussionStores:r.unresolvedDiscussionStores})}),(0,Pt.jsx)(es,{store:this.props.store,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight,context:this.props.context,disabled:this.props.disabled})]})}renderCollectionPageViewContent(){const{store:e}=this.props;if(e.isCollectionView())return(0,Pt.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5},children:[(0,Pt.jsx)(Xe.Z,{isVisible:!0,animationStyle:{width:ts(this.props.store,this.props.context,this.environment)},render:()=>(0,Pt.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:this.renderDocumentView()})}),!this.environment.device.isMobile&&(0,Pt.jsx)(z.Z,{pageBlockStore:this.props.store,isVisible:this.marginCommentsVisible.state,context:this.props.context,pageViewBlockAccessor:this.getContentWrapEl})]})}renderPageLayoutSchema(e){const t=this.getHorizontalTransformStyles();var s,o;const i=function(e,t,s,o){if(o.device.isPhone)return"phone";if(o.device.isTablet)return Xt(t,s,o)?"wide":"tablet";if(Wt(s))return Ut(t)?"side-peek":"center-peek";if(function(e){return e===Ze.S.InAppTemplatePreview}(s)||function(e){return e===Ze.S.InPageSnapShot}(s))return"template-preview";return Xt(t,s,o)?e?"wide-right-margin-expanded":"wide":"default"}((s=this.props.store,o=this.environment,{visible:(0,$.fg)(o,s)}).visible,this.props.store,this.props.context,this.environment);return(0,Pt.jsx)(Xe.Z,{isVisible:!0,animationStyle:t.layout,render:()=>(0,Pt.jsx)(at.Ar,{type:i,withBottomPadding:!0,children:e.map(((e,t)=>{if("tabs"===e.type)return this.MODULE_MAP.tabs(t,e);const s=this.MODULE_MAP[e.type];return s?s(t):null}))})})}layoutV2_getPeekPageTitleWithIcon(){const{headerControls:e}=this.headerAndBottomControlsStore.state;return Ut(this.props.store)?(0,Pt.jsxs)(Pt.Fragment,{children:[(0,Pt.jsx)(ut.U,{onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,headerControls:e}),(0,Pt.jsx)(it.B,{...this.pageIconProps.state,...this.pageTitleProps.state})]}):(0,Pt.jsx)("div",{style:(0,ue.kC)(this.props.store,this.environment),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:(0,Pt.jsx)(vt.J,{...this.pageIconProps.state,...this.pageTitleProps.state,headerControls:e,headerFocusStore:this.stores.headerFocusStore,paddingLeft:0,paddingRight:0})})}renderPersisted(){var e,t;if(this.props.store.getType()===g.Ti.copyIndicator&&(this.props.store.getParentTable()!==P.v||this.props.store.getParentTable()===P.v&&0===Object.keys(this.props.store.getProperties()).length))return(0,Pt.jsx)(nt.X,{});if(this.props.store.isCollectionView())return(0,Pt.jsx)(X.L1,{value:this.collectionContextStore,children:this.renderCollectionPageViewBlock()});let s=Boolean(Be.default.checkGate("enable_transcript_tab")&&(null===(e=this.collectionContextStore.collectionStore())||void 0===e?void 0:e.getDatabaseType())===p.Fi&&(null===(t=this.props.store.getFormatStore().getValue())||void 0===t||null===(t=t.content_tabs)||void 0===t?void 0:t[u.Z]))?this.renderPageLayoutSchema(ft.Tf.pageLayoutSchema):function(e){if(function(e){return e===Ze.S.CollectionPageView}(e))return!1;return!0}(this.props.context)?this.renderPageLayoutSchema(ft.bl.pageLayoutSchema):this.getPageContent();return this.collectionContextStore&&this.collectionContextStore.contextType&&(s=(0,Pt.jsx)(X.L1,{value:this.collectionContextStore,children:s})),(0,pe.Aw)(this.environment)?(0,Pt.jsx)($e.O,{displayName:"PageContent",style:{...Et,...this.props.style},disabled:!this.canEdit()||this.props.store.isLocked(),shouldSelectOnEnter:Vt,children:s}):s}getPageContent(){const e=!(0,ue.a_)(this.props.store),t=-1*this.documentViewHorizontalOffset.state;return(0,Pt.jsxs)(Pt.Fragment,{children:[this.renderPageCover(),(0,Pt.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",zIndex:_.db,flexShrink:0},children:(0,Pt.jsx)(Xe.Z,{isVisible:!0,animationStyle:{width:ts(this.props.store,this.props.context,this.environment),translateX:t},render:()=>(0,Pt.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:this.renderPageHeader()})})}),e&&(0,Pt.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5},children:[(0,Pt.jsx)(Xe.Z,{isVisible:!0,animationStyle:{width:ts(this.props.store,this.props.context,this.environment),translateX:t},render:()=>(0,Pt.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:this.renderDocumentView()})}),this.props.context===Ze.S.Frame&&(0,Pt.jsx)(z.Z,{pageBlockStore:this.props.store,isVisible:this.marginCommentsVisible.state,context:this.props.context,pageViewBlockAccessor:this.getContentWrapEl})]})]})}renderPageHeader(){const{WindowSizeStore:e}=this.environment,{store:t,paddingLeft:s,paddingRight:i}=this.props,{headerControls:n,bottomControls:r}=this.headerAndBottomControlsStore.state,a=[],l=this.pagePropertiesRenderState();"visible"===l.type&&(a.push((0,Pt.jsx)(mt.$,{...l},"page-properties")),a.push((0,Pt.jsx)(rs,{},"divider-1")));const d=(0,rt.Eg)({collectionStore:Rt(this.props.store),format:(0,ue.y6)(this.props.store),sectionPropertyIds:this.inlinePropertyIDsStore.state});"visible"===d.type&&(a.push((0,Pt.jsx)(rt._h,{topBorder:!0,state:d,store:t,disabled:this.props.disabled,onMouseEnter:this.handleDetailsMouseEnter,onMouseLeave:this.handleDetailsMouseLeave,blockPropertyValueOverlayStore:Kt(this.props.context),isInPeekRenderer:Wt(this.props.context)},"inline-page-sections")),a.push((0,Pt.jsx)(rs,{},"divider-2")));this.pageExpandedBacklinksRenderState()&&(a.push((0,Pt.jsx)(lt.f,{store:this.props.store},"page-expanded-backlinks")),a.push((0,Pt.jsx)(rs,{},"divider-3")));const h=this.pageDiscussionsRenderState({disableDiscussionInput:!1});return"visible"===h.type&&(a.push((0,Pt.jsx)(ct.z,{store:this.props.store,showDiscussionInput:h.showDiscussionInput,unresolvedDiscussionStores:h.unresolvedDiscussionStores},"page-discussions")),a.push((0,Pt.jsx)(rs,{},"divider-4"))),(0,Pt.jsxs)(o.Fragment,{children:[(0,Pt.jsx)("div",{style:(0,ue.kC)(this.props.store,this.environment),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:(0,Pt.jsx)(vt.J,{store:t,pageViewBlockStore:this.stores.pageViewBlockStore,discussionInputStore:this.discussionInputStore,isEditable:this.isEditable(),headerControls:n,hasCover:this.hasCoverStore.state,isInSidePeek:Ut(this.props.store),headerFocusStore:this.stores.headerFocusStore,paddingLeft:s,paddingRight:i,openMenuOnMount:this.clickedAddIconState,openMenuOnMountCallback:this.handleAddIconClick,disabled:!this.canEdit(),extraStyles:this.titleStyleStore.state,titlePlaceholder:this.props.titlePlaceholder,collectionContextStore:this.collectionContextStore,shouldShowTemplatePicker:this.showTemplatePickerStore.state,onTitleChange:this.handleTitleChange,onTitleEditText:this.handleTitleEditText,onTitleEsc:this.handleTitleEsc,onTitleUntab:this.handleTitleUntab,onTitleTab:this.handleTitleTab})}),(0,Pt.jsx)("div",{style:(0,ue.kC)(this.props.store,this.environment),onMouseEnter:this.handleDetailsMouseEnterThrottled,onMouseMove:this.handleDetailsMouseEnterThrottled,onMouseLeave:this.handleDetailsMouseLeaveDebounced,children:(0,Pt.jsxs)(qe.p,{onFocus:this.handleDetailsFocus,onBlur:this.handleDetailsBlur,allowSelectionWithin:!0,style:{paddingLeft:e.getSafePaddingLeftCSS(s),paddingRight:e.getSafePaddingRightCSS(i),maxWidth:"100%",width:"100%"},children:[a,r.length>0&&(0,Pt.jsx)("div",{style:is(this.theme),className:"notion-page-details-controls",children:r}),(0,Pt.jsx)(Ne.Z,{store:t},t.id)]})})]})}getTopControls(){const e=[],t=this.renderAddIcon();t&&e.push((0,Pt.jsx)(o.Fragment,{children:t},"add-icon"));const s=this.renderAddCover();return s&&e.push((0,Pt.jsx)(o.Fragment,{children:s},"add-cover")),e}getBottomControls(e,t){const s=[],i=!e&&this.renderShowBacklinks();i&&s.push((0,Pt.jsx)(o.Fragment,{children:i},"backlinks"));const n="hidden"===t.type,r=n&&this.renderShowDiscussion();r&&s.push((0,Pt.jsx)(o.Fragment,{children:r},"discussions"));const a=this.renderResolveDiscussionButtonPopupMenu();a&&!n&&s.unshift((0,Pt.jsx)(o.Fragment,{children:a},"resoled-discussions"));const l=this.renderMinimalPageSections();return l&&s.push((0,Pt.jsx)(o.Fragment,{children:l},"minimal-page-sections")),s}getCommentControlPlacement(e){const{isTopControlsEmpty:t,isBottomControlsEmpty:s,discussionsRenderState:o}=e,{device:i}=this.environment;return this.shouldRenderAddDiscussion()?"hidden"!==o.type||s?i.isMobile&&t?"bottom":"top":"bottom":"hidden"}renderCollectionHeaderControls(){return(0,Pt.jsxs)("div",{onFocus:this.handleHeaderFocus,onBlur:this.handleHeaderBlur,style:{...this.getHeaderControlsStyle()},className:"notion-page-controls",children:[this.renderAddIcon(),this.renderAddCover(),this.renderLinkedCollectionViewBlockAddTitle(),this.renderSprintBoardDescriptionToggle(),this.renderDescriptionToggle()]})}renderCollectionHeader(){const{paddingLeft:e,paddingRight:t,store:s}=this.props,{WindowSizeStore:o}=this.environment,i=this.shouldShowCollectionViewBlockTitle.state,n=(0,Y.qG)(s.id)?null:(0,Pt.jsxs)("div",{style:{display:"flex",alignItems:"flex-start"},children:[(0,Pt.jsx)(gt.Z,{store:this.props.store,isEditable:this.isEditable(),hasCover:this.hasCoverStore.state,isInSidePeek:Ut(this.props.store),openMenuOnMount:this.clickedAddIconState,openMenuOnMountCallback:this.handleAddIconClick}),i&&(0,Pt.jsx)(St.Z,{store:this.props.store,disabled:!this.canEdit(),isInSidePeek:Ut(this.props.store),paddingLeft:e,paddingRight:t,extraStyles:this.titleStyleStore.state,titlePlaceholder:this.props.titlePlaceholder,collectionContextStore:this.collectionContextStore,shouldShowTemplatePicker:this.showTemplatePickerStore.state,onTitleChange:this.handleTitleChange,onTitleEditText:this.handleTitleEditText,onTitleEsc:this.handleTitleEsc,onTitleUntab:this.handleTitleUntab,onTitleTab:this.handleTitleTab})]}),r=this.pagePropertiesRenderState(),a=this.pageDescriptionRenderState();return(0,Pt.jsxs)("div",{style:(0,ue.kC)(this.props.store,this.environment),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:[this.renderPageCover(),(0,Pt.jsx)(Xe.Z,{isVisible:!0,animationStyle:{width:ts(this.props.store,this.props.context,this.environment)},render:()=>(0,Pt.jsxs)("div",{style:{maxWidth:"100%",paddingLeft:o.getSafePaddingLeftCSS(e)},children:[this.renderCollectionHeaderControls(),(0,Pt.jsxs)("div",{style:{paddingRight:o.getSafePaddingRightCSS(t),marginBottom:8},children:[n,(0,Pt.jsx)(qt,{store:this.props.store}),"visible"===a.type&&(0,Pt.jsx)(ht.Z,{disabled:!this.isEditable(),canEdit:this.canEdit(),locked:this.props.store.isLocked(),pageId:this.props.store.id,toggleStore:this.stores.pageDescriptionStore,descriptionStore:a.descriptionStore,collectionStore:a.collectionStore,userSettingsStore:a.currentUserSettingsStore}),"visible"===r.type&&(0,Pt.jsx)(mt.$,{...r})]})]})})]})}renderPageCover(){const{WindowSizeStore:e}=this.environment,{store:t,paddingLeft:s,paddingRight:o,pageCoverHeight:i}=this.props,n=t.isCollectionView()?"20vh":i;return(0,Pt.jsx)(qe.p,{allowSelectionWithin:!1,style:(0,dt.p)(this.props.store,this.environment),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:(0,Pt.jsx)(xt.Z,{height:n,store:t,disabled:!this.isEditable(),paddingLeft:e.getSafePaddingLeftCSS(s),paddingRight:e.getSafePaddingRightCSS(o),proxyWidth:e.state.width})})}renderAddIcon(){const{device:e}=this.environment;if(this.isEditable()&&!this.hasIconStore.state)return(0,Pt.jsx)(st.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,onClick:this.handleAddRandomIconClick,icon:v.o,children:e.isSmallPhone?(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageIconMobile",defaultMessage:"Icon"}):(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageIcon",defaultMessage:"Add icon"})},"add-icon")}renderAddCover(){const{device:e}=this.environment;if(this.isEditable()&&!(0,Y.qG)(this.props.store.id)&&!this.hasCoverStore.state)return!0===this.stores.loadingPageCoverStore.state?(0,Pt.jsx)(st.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,disabled:!0,icon:f.P,children:e.isSmallPhone?(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageCoverMobileLoading",defaultMessage:"Loading"}):(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageCoverLoading",defaultMessage:"Loading cover"})},"add-cover-loading"):(0,Pt.jsx)(st.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,onClick:this.handleAddRandomCoverClick,icon:f.P,children:e.isSmallPhone?(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageCoverMobile",defaultMessage:"Cover"}):(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageCover",defaultMessage:"Add cover"})},"add-cover")}renderLinkedCollectionViewBlockAddTitle(){var e;const{store:t}=this.props,{device:s}=this.environment;if(!this.isEditable()||!t.isCollectionView()||t.getCollectionViewSourceCollectionStore())return;return D.QaF(null===(e=this.titleStore.state)||void 0===e?void 0:e.getValue())?void 0:(0,Pt.jsx)(st.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,onClick:this.handleAddTitleClick,icon:k.c,children:s.isSmallPhone?(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageTitleMobile",defaultMessage:"Title"}):(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageTitle",defaultMessage:"Add title"})},"add-title")}renderSprintBoardDescriptionToggle(){const{store:e}=this.props,{device:t}=this.environment;if(!e.isCollectionView()||!Ft(this.props.store)||!this.isEditable())return;return Boolean(e.getFormat().hide_collection_view_page_description)?(0,Pt.jsx)(st.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:()=>R.kQ({environment:this.environment,store:e,value:!1}),icon:x.z,children:t.isSmallPhone?(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Description",id:"pageViewBlock.showDescription.mobileButton"}):(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Show description",id:"pageViewBlock.showDescription.button"})}):(0,Pt.jsx)(st.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:()=>{R.kQ({environment:this.environment,store:e,value:!0})},icon:x.z,children:(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Hide description",id:"pageViewBlock.hideDescription.button"})})}renderDescriptionToggle(){const{store:e}=this.props,{device:t}=this.environment;if(e.isCollectionView()&&e.getCollectionViewSourceCollectionStore())return this.shouldShowDescription()?(0,Pt.jsx)(st.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:this.handleHideDescription,icon:x.z,children:(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Hide description",id:"pageViewBlock.hideDescription.button"})}):this.isEditable()&&!zt(this.props.store)?(0,Pt.jsx)(st.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:this.handleAddDescriptionClick,icon:x.z,children:t.isSmallPhone?(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Description",id:"pageViewBlock.addDescription.mobileButton"}):(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Add description",id:"pageViewBlock.addDescription.button"})}):zt(this.props.store)?(0,Pt.jsx)(st.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:this.handleShowDescription,icon:x.z,children:t.isSmallPhone?(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Description",id:"pageViewBlock.showDescription.mobileButton"}):(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Show description",id:"pageViewBlock.showDescription.button"})}):void 0}shouldRenderAddDiscussion(){const{store:e}=this.props;return!re.A$("comments","section_hide")&&(!e.isCollectionView()&&(!e.isInsideCollection()&&(!Nt(this.props.store)&&(!!e.canComment()&&(!!this.environment.currentUser.isLoggedIn()&&!this.stores.pageViewBlockStore.state.forceDiscussionOpen)))))}renderAddDiscussion(e){const{device:t}=this.environment;return(0,Pt.jsx)(st.Z,{style:this.getControlHoverStyle({isBottomControl:e.isBottomControl}),isLightGray:!0,onClick:this.handleAddDiscussion,icon:C.v,children:t.isSmallPhone?(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageCommentMobile",defaultMessage:"Comment"}):(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.add.pageComment",defaultMessage:"Add comment"})},"add-comment")}renderShowDiscussion(){if(!re.A$("comments","section_hide")&&Nt(this.props.store)){const e=At(this.props.store);return(0,Pt.jsx)(st.Z,{isGray:!0,onClick:this.handleShowDiscussion,icon:C.v,style:ns(this.theme),children:(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.show.pageComments",defaultMessage:"{numberOfComments, plural, one {{numberOfComments} comment} other {{numberOfComments} comments}}",values:{numberOfComments:e}})},"show-comments")}}renderShowBacklinks(){const e=this.numberOfBacklinks.state;if(0===e)return;if(re.A$("backlinks","section_hide"))return;const t=t=>{let{onClick:s=M.ZT,tooltipEvents:o={},buttonPopupEvents:i={}}=t;return(0,Pt.jsx)(st.Z,{isGray:!0,icon:e=>(0,Pt.jsx)(os,{style:e}),style:ns(this.theme),onClick:s,...i,...o,children:(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.show.backlinks",defaultMessage:"{numberOfBacklinks, plural, one {{numberOfBacklinks} backlink} other {{numberOfBacklinks} backlinks}}",values:{numberOfBacklinks:e}})})},s=(0,Pt.jsx)(ot.ZP,{renderTooltip:()=>(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Show pages linked to this page",id:"pageViewBlock.show.backlinks.tooltip"}),placement:ot.ug.Bottom,delayThreshold:400,render:e=>t({tooltipEvents:e,onClick:this.handleShowBacklinks})},"show-backlinks"),o=(0,Pt.jsx)(Qe.ZP,{buttonPopupStore:this.stores.backlinksButtonPopupStore,popupType:Qe.Z4.Popup,renderOrigin:e=>t({buttonPopupEvents:e}),render:()=>{const e={menuType:he.og.Popup,width:500};return(0,Pt.jsx)(et.Z,{...e,children:this.numberOfBacklinks.state>0?(0,Pt.jsx)(lt.f,{store:this.props.store}):null})}},"backlinks-popup");return re.A$("backlinks","section_collapsed")?o:s}pageDescriptionRenderState(){if(!this.shouldShowDescription())return{type:"hidden"};const e=Zt(this.props.store);if(!e)return{type:"hidden"};const{pageDescriptionStore:t}=this.stores;if(!t.isExpanded())return{type:"hidden"};const{store:s}=this.props,{currentUserSettingsStore:o}=Me.default.state;return{type:"visible",descriptionStore:e,currentUserSettingsStore:o,collectionStore:s.getCollectionViewSourceCollectionStore()}}pagePropertiesRenderState(){const{store:e}=this.props;if(e.isCollectionViewPageWithContent())return{type:"hidden"};const t=Rt(this.props.store);if(!t)return{type:"hidden"};const s=(0,ue.y6)(this.props.store);return s?{type:"visible",store:e,format:s,collectionStore:t,disabled:!this.canEdit(),blockPropertyValueOverlayStore:Kt(this.props.context),isInPeekRenderer:Wt(this.props.context)}:{type:"hidden"}}renderMinimalPageSections(){const{store:e,disabled:t}=this.props,s=Rt(this.props.store);if(!s)return;const o=Ht(this.props.store),i=(0,ue.y6)(this.props.store),n=e.isLocked();if(!i)return;const r=this.minimalPropertyIDsStore.state;return r&&r.length?(0,Pt.jsx)(bt.Z,{propertyIds:r,store:e,collectionStore:s,disabled:t,locked:n,schema:o,handleMouseMove:this.handleDetailsMouseEnter,handleMouseLeave:this.handleDetailsMouseLeave,handleContextMenu:()=>{},blockPropertyValueOverlayStore:Kt(this.props.context),format:i,type:"minimal",isInPeekRenderer:Wt(this.props.context)}):void 0}pageDiscussionsRenderState(e){if(re.A$("comments","section_hide"))return{type:"hidden"};const t=this.environment.currentUser.isLoggedIn(),s=this.shouldShowDiscussion(),{store:o}=this.props,i=Se.vV(o,{recursivelyLoadAllDiscussions:!1}),n=!e.disableDiscussionInput&&t&&o.canComment()&&0===i.length&&!(0,ue.a_)(this.props.store);return!s||!n&&0===i.length?{type:"hidden"}:{type:"visible",showDiscussionInput:n,unresolvedDiscussionStores:i}}renderResolveDiscussionButtonPopupMenu(){const{device:e}=this.environment,t=Se.mY(this.props.store,{recursivelyLoadAllDiscussions:!1});if(0===t.length)return;const s=(0,Pt.jsx)(E.FormattedMessage,{id:"pageViewBlock.showResolvedComments.button",defaultMessage:"{numberOfResolvedComments, plural, one {{numberOfResolvedComments} resolved comment} other {{numberOfResolvedComments} resolved comments}}",values:{numberOfResolvedComments:t.length}});return(0,be.Sx)(this.environment)?(0,Pt.jsx)(st.Z,{icon:b.k,isGray:!0,style:ns(this.theme),onClick:()=>{I.Ib({environment:this.environment,blockStore:this.props.store,analyticsFrom:"page_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1,discussionIds:t.map((e=>e.id))})},children:s}):(0,Pt.jsx)(Qe.ZP,{buttonPopupStore:this.stores.resolvedDiscussionButtonPopupStore,popupType:e.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,renderOrigin:e=>(0,Pt.jsx)(st.Z,{icon:b.k,isGray:!0,style:ns(this.theme),...e,children:s}),render:s=>{let o;return o=e.isMobile?{menuType:he.og.Modal,title:(0,Pt.jsx)(E.FormattedMessage,{defaultMessage:"Resolved comments",id:"pageViewBlock.resolvedComments.menuTabTitle"}),right:(0,Pt.jsx)(tt.DoneMenuText,{}),onClickRight:s.close,whiteBackground:!0}:{menuType:he.og.Popup,width:500},(0,Pt.jsx)(et.Z,{...o,children:t.map(((e,t,o)=>(0,Pt.jsx)(kt.Z,{store:e,droppable:!0,render:()=>(0,Pt.jsx)(Ce.LazyDiscussion,{store:e,format:G.O2.Menu,isFirst:0===t,isOnly:1===o.length,discussionLocation:"page_discussion",showResolveButtonByDefaultIfPossible:!0,blockStore:this.props.store,onDismiss:s.close},e.id)},e.id)))})}},"resolve-discussions")}renderDocumentView(){const e=this.getLayoutContentStyles(),t=(0,ue.CX)(this.props.store)?this.handlePlaceholderWrapClick:void 0;return Lt(this.environment.device)?(0,Pt.jsxs)("div",{style:e.wrapper,children:[e.leftPadding&&(0,Pt.jsx)(qe.p,{allowSelectionWithin:!1,style:e.leftPadding,onClick:t}),this.renderDocumentViewContent(e.body,t),e.rightPadding&&(0,Pt.jsx)(qe.p,{allowSelectionWithin:!1,style:e.rightPadding,onClick:t})]}):this.renderDocumentViewContent(e.nonIOSLayoutBody,t)}renderDocumentViewContent(e,t){const{store:s}=this.props,o=Ot(this.props.store),i=this.showTemplatePickerStore.state;return(0,Pt.jsxs)("div",{style:e,ref:e=>{e&&(this.contentEl=e)},className:te.QS0,onClick:t,children:[!(0,ue.a_)(this.props.store)&&(0,Pt.jsx)(Ct.Z,{store:s.getContentStore(),emptyDroppableStyle:{width:"100%"},disabled:this.props.store.isLocked()||this.props.disabled}),o&&(0,Pt.jsx)(Ye.Z,{}),$t(this.props.context)&&i&&(0,Pt.jsx)(Mt.Z,{store:s,menuListStore:this.stores.templatePickerMenuListStore})]})}pageExpandedBacklinksRenderState(){return!!this.shouldShowBacklinks()&&0!==this.numberOfBacklinks.state}shouldShowDiscussion(){if(this.stores.pageViewBlockStore.state.forceDiscussionOpen)return!0;const e=re.dy(this.environment,"comments"),t=re.A$("comments","section_collapsed");if(this.props.store.isInsideCollection()&&!Nt(this.props.store)&&(e||t))return!0;if(!Nt(this.props.store))return!1;const s=this.discussionToggleStore.state;return void 0===s?e:s}shouldShowBacklinks(){const e=re.dy(this.environment,"backlinks"),t=this.backlinksToggleStore.state;return void 0===t?e:t}shouldShowDescription(){if("sprint_board"===this.props.store.getFormat().special_page_for_pm_launch)return!0;const e=this.stores.pageDescriptionStore.isExpanded();return(zt(this.props.store)||this.isEditable())&&e}isEditable(){return this.canEditCollection()&&!this.props.store.isLocked()&&!(0,ue.a_)(this.props.store)}shouldSelectTitleOnMount(){const{device:e}=this.environment,{store:t}=this.props,s=this.titleStore.state,{forceSelectTitleOnMount:o}=this.props;return!!s&&(!!o||!t.isCollectionView()&&(!D.QaF(s.getValue())||(0,ue.CX)(this.props.store)&&!e.isMobile))}static defaultPageCoverHeight(e){return e.device.isMobile?200:"30vh"}static paddingBottom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{device:s}=e;return s.isTablet?380:s.isIOS?Math.max(350,t):s.isMobile?400:"30vh"}getHeaderControlsStyle(){const{store:e}=this.props,{device:t}=this.environment,{isMobile:s}=t,o=Qt(this.props.context,this.environment);let i,r,a;return s?this.hasCoverStore.state?(this.hasIconStore.state,a="block",i=o,r=4):(a="flex",i=o,r=Yt(this.environment)):e.isCollectionView()||Ut(this.props.store)?(a="flex",this.hasCoverStore.state?(i=16,r=4):(i=4,r=4)):(a="flex",this.hasIconStore.state?(i=8,r=4):this.hasCoverStore.state?(i=16,r=4):(i=o,r=Yt(this.environment))),{display:a,justifyContent:"flex-start",flexWrap:"wrap",marginTop:i,marginBottom:r,marginLeft:-1,color:this.theme.lightTextColor,fontFamily:B.Z.getCompositeFontFamily(n.SP).sans,pointerEvents:"auto"}}getControlHoverIsVisible(e){const{device:t}=this.environment,s=this.stores.headerMouseStore.state.mouseEntered,o=this.stores.detailsMouseStore.state.mouseEntered,i=this.stores.headerFocusStore.state,n=this.stores.detailsFocusStore.state;return!!t.isMobile||(e?o&&!je.Z.state.isKeyboardMode||n:s&&!je.Z.state.isKeyboardMode||i)}getControlHoverStyle(e){let{isBottomControl:t}=e;const s=this.getControlHoverIsVisible(t);return{opacity:s?1:0,pointerEvents:s?"auto":"none",transition:"opacity 100ms ease"}}getLayoutContentStyles(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{device:t}=this.environment,{context:s,paddingLeft:o,paddingRight:i}=this.props,{store:n}=this.props,r=n.getFormat(),a=r.page_font||jt.defaultFontFamily,l=wt[a],d=Wt(this.props.context),h=(0,ue.CX)(this.props.store)&&d&&!this.showTemplatePickerStore.state&&!Ot(this.props.store),p=s===Ze.S.InAppTemplatePreview;let u,g,m;if(t.isMobile)m=t.isAndroid?17:16;else{m=r.page_small_text?Bt[a]||14:_t[a]||16}let S={},v={},f={};if(!h){const{WindowSizeStore:t}=this.environment,s=t.getSafePaddingLeftCSS(o),n=t.getSafePaddingRightCSS(i);S={gridTemplateColumns:`${s} calc(100% - ${s} - ${n}) ${n}`},u={},g={},v=this.isCompletionsUiVisible.state?{paddingBottom:"600px"}:(0,ue.CX)(this.props.store)?{paddingBottom:"15vh"}:{paddingBottom:0},f={...v,paddingLeft:e?0:s,paddingRight:e?0:n}}const C=Dt[a],y=Tt[a]||1.5;let x={};d&&(x={minHeight:240,zIndex:1});let b={};p&&(b={margin:"0 auto"});let k={};if(t.isPhone&&!n.isCollectionView()&&this.canEdit()&&!this.hasCoverStore.state){const e=132,t=ss(this.props.context,this.environment);k={minHeight:`calc(100vh - ${c.g+e-t}px)`}}return{wrapper:{flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...S},leftPadding:u,body:{display:"flex",alignItems:"flex-start",flexDirection:"column",fontFamily:l,fontSize:m,letterSpacing:C?`${C}em`:void 0,lineHeight:y,zIndex:_.ke,...v,...x,...b,...k},rightPadding:g,nonIOSLayoutBody:{flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flex-start",flexDirection:"column",fontFamily:l,fontSize:m,letterSpacing:C?`${C}em`:void 0,lineHeight:y,width:"100%",zIndex:_.ke,...f,...x,...b,...k}}}}jt.defaultFontFamily=B.Z.getCompositeFontFamily(n.SP).sans;const It=jt;function Vt(){return 0===Ue.default.state.stores.length}function Ft(e){return"sprint_board"===e.getFormat().special_page_for_pm_launch}function At(e){return Se.Xp(e,{recursivelyLoadAllDiscussions:!1})}function Zt(e){return e.getCollectionViewSourceDescriptionStore()}function Rt(e){return e.getAssociatedCollectionStore()}function Ht(e){return e.getSchema()}function Ot(e){return Boolean(Ke.Z.state.pageMap[e.id])||Ae.Z.state.pages.has(e.id)}function Wt(e){return e===Ze.S.PeekView}function Ut(e){return ie.en(e)&&(Oe.default.isSidePeekOpen()||Oe.default.isSidePeekClosing.state)}function Kt(e){return Wt(e)?He.Z:Ve.Z}function Nt(e){return At(e)>0}function zt(e){const t=Zt(e);return R.vn(t)}function Gt(e){return Wt(e)?Re.Z:_e.Z}function $t(e){return function(e){return e===Ze.S.Frame}(e)||Wt(e)}function qt(e){let{store:t}=e;window.__c={n:"SprintBoardDescription"};const s=(0,l.VK)((()=>Ft(t)),[t]),o=(0,l.VK)((()=>Boolean(t.getFormat().hide_collection_view_page_description)),[t]);return s&&!o?(0,Pt.jsx)(ht.k,{}):null}function Xt(e,t,s){if(t===Ze.S.CollectionPageView)return!0;const{device:o}=s,{isPhone:i}=o,n=e.isFullWidth(),r=e.isCollectionView(),a=Wt(t);return n&&!i||r||a||i}function Jt(e,t){if(function(e){return e===Me.default.state.mainEditorCurrentBlockStore}(e)){const{RouterStore:e}=t;return e.state.route.collectionViewId}}function Qt(e,t){return t.device.isMobile?16:Wt(e)?32:80}function Yt(e){return e.device.isMobile?32:4}function es(e){let{store:t,paddingLeft:s,paddingRight:o,context:i,disabled:n}=e;window.__c={n:"CollectionView"};const a=(0,r.O7)(),d=(0,l.VK)((()=>t.isCollectionView()),[t]),h=(0,l.VK)((()=>Jt(t,a)),[t,a]);return d?(0,Pt.jsx)(Ge.DZ,{overridePaddingLeft:s,overridePaddingRight:o,store:t,isFullScreen:!0,viewId:h,disabled:n,hideHeaderActions:i===Ze.S.InAppTemplatePreview}):null}function ts(e,t,s){return Xt(e,t,s)?"100%":ue.zL}function ss(e,t){return 28+Qt(e,t)}function os(e){let{style:t}=e;return(0,y.J)({...t,transform:"rotate(180deg)"})}function is(e){return{display:"flex",alignItems:"baseline",justifyContent:"flex-start",flexWrap:"wrap",color:e.lightTextColor,fontFamily:B.Z.getCompositeFontFamily(n.SP).sans}}function ns(e){return{fontWeight:B.Z.fontWeight.medium,color:e.mediumTextColor}}function rs(){window.__c={n:"DetailsDividerComponent"};const e=(0,d.Fg)();return(0,Pt.jsx)("div",{style:{width:"100%",height:1,background:e.regularDividerColor,marginBottom:8}})}}}]);