"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9729],{80671:(e,t,n)=>{n.d(t,{Cl:()=>m,Kj:()=>g,jw:()=>S,k2:()=>f,v5:()=>l});n(21703);var o=n(72126),a=n(4615),r=n(19889),s=n(896),i=n(12139),d=n(50906),u=n(80444),c=n(26136),p=n(63423);function f(){p.Z.setState({open:!0,stage:"limit_reached",addOnUpgradeId:(0,a.ZP)(),tax:0})}function l(){p.Z.setState({open:!1})}function m(e){const t=p.Z.state;t.open&&p.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,s.$v)(e)?e:void 0})}function g(){p.Z.setState({open:!0,stage:"cancel_plan",addOnUpgradeId:(0,a.ZP)(),tax:0})}async function S(e){const{environment:t,spaceStore:n,from:a}=e,s=function(){var e;const t=null===(e=u.default.state.currentSpaceStore)||void 0===e?void 0:e.getAdminIds();if(!t||0===t.length)throw new Error("No admins found in the current space");return(0,o.UP)(t)}(),p=n.getName(),f=c.U6.createChildStore(n,{table:r.KJ,id:s});await f.load();const l=f.getEmail();l?d.bfr(t,{admin_id:s,admin_email:l,space_name:p,from:a}):i.IE(new Error("Could not get email for admin in sendMemberRequestForAddOn"))}},71487:(e,t,n)=>{n.d(t,{AG:()=>c,an:()=>p,yY:()=>u});var o=n(9291),a=n(54642),r=n(47307),s=n(33929),i=n(80444);const d=(0,o.defineMessages)({invalidCoupon:{id:"applyCoupon.error.invalidCoupon",defaultMessage:"Unable to apply the coupon to your account."}});async function u(e,t){const{customerId:n,offerType:o}=t,s=await a.getCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===o?t.newPlan:void 0,offerType:o});if("failed"===s.type)r.showError(s);else{const e=s.data;if(e.offerType===o)return e.coupon}}async function c(e,t){const{customerId:n,coupon:o,offerType:i}=t;if(!o)return void r.showErrorMessage(s.default.formatMessage(d.invalidCoupon));const u=await a.applyCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===i?t.newPlan:void 0,offerType:i,coupon:o});"failed"===u.type&&r.showError(u)}async function p(e){const{environment:t}=e,n=i.default.state.currentSpaceStore;if(!n)return!1;const o=await a.getCustomerOfferEligibility(t,{spaceId:n.id});return"failed"!==o.type&&o.data.isEligible}},74011:(e,t,n)=>{n.r(t),n.d(t,{AddOnDiscountPopup:()=>O});var o=n(67294),a=n(480),r=n(86628),s=n(24405),i=n(92595),d=n(11751),u=n(3791),c=n(896),p=n(9291),f=n(50906),l=n(82530),m=n(37181),g=n(38755),S=n(77907),y=n(80444),_=n(80671),v=n(71487),w=n(70060),h=n(43163),P=n(88893),b=n(35057),C=n(88280),A=n(85893);function O(){window.__c={n:"AddOnDiscountPopup"};const e=(0,a.O7)(),[t,n]=o.useState(void 0);(0,o.useEffect)((()=>{(0,i.exposeDebugValue)("resetAddOnDiscountPopup",(()=>{const{currentUserSettingsStore:t}=y.default.state;t&&l.createAndCommit({userAction:"AddOnDiscountPopup.resetAddOnPromoPopup",environment:e,perform:e=>{m.d2({userSettingsStore:t,transaction:e,data:{seen_ai_discount_popup:!1}})}})}))}),[e]);const{currentUserSettingsStore:O,currentSpaceStore:I}=(0,r.VK)((()=>y.default.state),[]),M=(0,r.VK)((()=>C.subscriptionDataStoreInstance.state),[]);(0,o.useEffect)((()=>{!async function(){var t;if(!I)return;if(!M)return;if(!(0,P.GJ)(M))return;if("unsubscribed_admin"!==M.type&&"subscribed_admin"!==M.type)return;if("stripe"!==(null===(t=M.customerData)||void 0===t?void 0:t.activeSubscriptionPlatform)||!M.customerData.stripe.isSubscribed)return;const o=P.XX(M);if((0,u.de)(null==o?void 0:o.addOns))return;const a=null!=o&&o.customerId?await v.yY(e,{offerType:"add_on_upgrade_flow",customerId:o.customerId}):void 0;(0,c.pp)(a)&&n(a)}()}),[e,I,M]);const D=(0,o.useCallback)((()=>{O&&(l.createAndCommit({userAction:"AddOnDiscountPopup.markSeen",environment:e,perform:e=>{m.d2({userSettingsStore:O,transaction:e,data:{seen_ai_discount_popup:!0}})}}),f.Sh9(e))}),[O,e]),E=(0,o.useCallback)((()=>{t&&(_.k2(),_.Cl(t))}),[t]),x=(0,r.VK)((()=>!(!(0,c.pp)(t)||!(0,w.px)(e,(0,b.zt)())||(0,g.CV)(I))),[t,e,I]),k=(0,s.yK)((e=>({icon:{width:20,height:20,fill:e.accentColors.purple[400]}})),[]);return x?(0,A.jsx)(S.LazyFeatureIntroPopup,{calloutId:"add_on_discount_popup",initialPromo:{icon:d.t,iconStyle:k.icon,header:(0,A.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.header",defaultMessage:"Add unlimited AI for {percentage} off?",values:{percentage:(0,c.pp)(t)?(0,h.o)(t):void 0}}),description:(0,A.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.description",defaultMessage:"Project management is better with Notion AI. Add it on top of your paid plan with half off."})},steps:[],seenFeatureUserSetting:"seen_ai_discount_popup",userSettingsStore:O,allowExternalMouseEvents:!0,onDismiss:D,onTryFeatureClick:E,isUserEligible:x,onPopupSeen:()=>f.Cdl(e),onLearnMore:()=>{t&&E(),D()},ctaMessage:(0,A.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.purchase.button",defaultMessage:"Claim your deal"})}):null}},43163:(e,t,n)=>{n.d(t,{o:()=>s});n(67294);var o=n(97880),a=n(9291),r=n(85893);function s(e){switch(e){case"ai_fifty_percent":return(0,r.jsx)(a.FormattedMessage,{id:"addOnUpgrade.confirmation.costSection.specialDiscounts.fiftyPercent",defaultMessage:"50%"});default:(0,o.t1)(e)}}}}]);