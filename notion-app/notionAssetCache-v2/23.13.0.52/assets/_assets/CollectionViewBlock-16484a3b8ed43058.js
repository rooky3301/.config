"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3190,5061],{81870:(e,t,o)=>{o.d(t,{Z:()=>d});o(67294);var i=o(480),r=o(24405),n=o(84169),s=o(25888),l=o(73063),a=o(16354),c=o(85893);const d=function(e){window.__c={n:"CollectionMenuHelpButton"};const t=(0,i.O7)(),o=(0,r.Fg)();return(0,c.jsx)(a.Z,{href:e.href,external:!0,onClick:()=>s.Fs(t,{from:e.helpButtonContext}),children:(0,c.jsx)(l.Z,{icon:n.m,style:{height:24,width:24,marginRight:-6,fill:o.mediumIconColor}})})}},91496:(e,t,o)=>{o.d(t,{Z:()=>U});var i=o(67294),r=o(83355),n=o(480),s=o(86628),l=o(24405),a=o(15145),c=o(58573),d=o(47453),u=o(35840),p=o(72126),h=o(9291),m=o(81193),g=o(98834),S=o(8055),f=o(82530),v=o(66890),y=o(66213),C=o(65273),x=o(92658),b=o(14976),w=o(75079),k=o(84210),P=o(33929),R=o(87279),T=o(18514),V=o(80444),M=o(29798),j=o(26136),F=o(34583),I=o(13401),B=o(81870),_=o(40071),D=o(44514),A=o(79131),Z=o(68894),L=o(78140),E=o(28992),O=o(32163),N=o(40721),z=o(72495),H=o(34574),G=o(85893);const W=(0,h.defineMessages)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…"}});class K extends r.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:M.Z,templateInputStore:x.Z},this.handleTemplateFilterChange=e=>{const{templateInputStore:t}=this.stores;t.setState({...t.state,inputValue:e.currentTarget.value})},this.renderMenuList=(e,t,o)=>{var r;const{device:n}=this.environment,{canConfigureCollection:s,isOverlay:l}=this.props,{templateInputStore:a}=this.stores,c={key:"create-template",render:(e,t)=>(0,G.jsx)($,{isOverlay:this.props.isOverlay,locked:this.props.locked,props:e}),action:this.handleNewCollectionTemplateClick},d=null===(r=this.context.collectionContextStore)||void 0===r?void 0:r.defaultPageTemplateStore.state,u={key:"empty",render:(t,o)=>{if(0!==e.length&&""===a.state.inputValue)return(0,G.jsx)(_.Z,{...this.props,templateStore:void 0,isMobile:this.environment.device.isMobile,locked:this.props.locked||!s,draggable:!0,isDefault:void 0===(null==d?void 0:d.id),onCancelClick:this.props.onCancelClick,...t})},action:this.handleEmptyPageContinueClick};return(0,G.jsx)(O.Z,{type:O.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:this.handleEmptyEnter,sections:p.oA([0!==e.length&&{key:"templates",render:t=>{const r=t.children.slice(0,t.children.length-1),s=t.children[t.children.length-1];return(0,G.jsx)(z.Z,{...t,disableDesktopPadding:!this.props.isOverlay,disableMobileBorders:!0,children:(0,G.jsxs)(i.Fragment,{children:[n.isMobile||this.props.locked||!this.props.canConfigureCollection?r.map(((e,t)=>r[t])):(0,G.jsx)(A.ZP,{direction:"vertical",keys:e,disabled:!o,renderKey:(t,o)=>r[e.indexOf(t)],onDrop:this.handleCollectionTemplatesReorder}),s]})})},items:[...t.map((e=>this.renderCollectionTemplatePageMenuItem(e,o))),u]},s?{key:"create-template",render:e=>(0,G.jsx)(z.Z,{topBorder:l,disableDesktopPadding:!l,disableMobileBorders:!0,...e}),items:[c]}:void 0])})},this.renderCollectionTemplatePageMenuItem=(e,t)=>{var o;const{device:r}=this.environment,{collectionStore:n,canConfigureCollection:s,locked:l}=this.props,a=null===(o=this.context.collectionContextStore)||void 0===o?void 0:o.defaultPageTemplateStore.state,c=j.Mz.fromBlockStore(e),d=null!=c&&c.isActive()?c.getRecurrence():void 0;return{key:e.id,render:o=>(0,i.createElement)(_.Z,{...o,key:e.id,isOverlay:this.props.isOverlay,collectionStore:n,canConfigureCollection:s,templateStore:e,isMobile:r.isMobile,locked:l,onCancelClick:this.props.onCancelClick,draggable:t,isDefault:(null==a?void 0:a.id)===e.id,recurrence:d}),action:t=>{F.M_(this.environment)&&this.props.onTemplateClick({templateStore:e,isKeyboard:"keydown"===t.event.type,useCrdt:(0,C.SL)(t.event,"collection_instantiate_template")})}}},this.handleEmptyPageContinueClick=e=>{const{collectionContextStore:t}=this.context;F.M_(this.environment)&&(this.props.onEmptyPageClick(),m.rN(this.environment,{template_name:"empty",is_keyboard:"keydown"===e.event.type,...t&&(0,w.Pn)(t)}))},this.handleEmptyEnter=()=>{const{collectionStore:e}=this.props;var t;F.M_(this.environment)&&(this.props.onEmptyEnter(),m.rN(this.environment,{template_name:"empty",is_keyboard:!0,collection_id:e.id,collection_view_id:null===(t=this.context.collectionContextStore)||void 0===t||null===(t=t.collectionViewStore())||void 0===t?void 0:t.id}))},this.handleNewCollectionTemplateClick=()=>{var e,t;const{collectionStore:o}=this.props,{templateInputStore:i}=this.stores;if(F.M_(this.environment)){var r;const{performResult:e}=f.createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:this.environment,perform:e=>g.nx({environment:this.environment,collectionStore:o,transaction:e,title:i?i.state.inputValue:void 0})});e&&this.navigateToBlock(e),m.dZ(this.environment,{collection_id:o.id,collection_view_id:null===(r=this.context.collectionContextStore)||void 0===r||null===(r=r.collectionViewStore())||void 0===r?void 0:r.id})}null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t)},this.handleCollectionTemplatesReorder=e=>{const{collectionStore:t}=this.props,{menuListStore:o}=this.stores;o.unsetFocus(),f.createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:this.environment,perform:o=>g.$p({collectionStore:t,newTemplateIds:e,transaction:o})})}}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):S.c4({environment:this.environment,url:e})}renderComponent(){const{device:e}=this.environment,{collectionStore:t,isOverlay:o}=this.props;let i=t.getTemplatePageStores();const{templateInputStore:r}=this.stores;if(!i.every((e=>e.isReady())))return;i=i.filter((e=>e.getAlive()));const n=i.map((e=>e.id));let s=this.renderMenuList(n,i,!0);const l=this.renderInputHeader();if(o){let t;t=e.isMobile?{menuType:R.og.Modal,title:(0,G.jsx)(h.FormattedMessage,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:(0,G.jsx)(N.CancelMenuText,{}),onClickLeft:this.props.onCancelClick}:{menuType:R.og.Popup,width:360};let o=i,a=n;return n.length>6&&r.state.inputValue&&(o=(0,c.ZP)(r.state.inputValue,i,(e=>String(e.getProperties().title)??"")),a=o.map((e=>e.id)),s=this.renderMenuList(a,o,!1)),(0,G.jsxs)(L.Z,{...t,header:(0,G.jsx)(q,{collectionStore:this.props.collectionStore}),children:[0===n.length&&(0,G.jsx)(z.Z,{children:(0,G.jsx)("div",{style:{fontSize:14,padding:e.isMobile?"12px 16px":"0 14px 3px 14px",color:this.theme.lightTextColor,wordBreak:"keep-all",...e.isMobile&&{background:this.theme.contentBackground,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}},children:(0,G.jsx)(h.FormattedMessage,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"})})}),n.length>6?l:void 0,s]})}return s}renderInputHeader(){const{device:e}=this.environment,t=!e.isMobile||void 0;return(0,G.jsx)("div",{style:{margin:e.isMobile?0:"10px 0"},children:(0,G.jsx)(Z.ZP,{value:this.stores.templateInputStore.state.inputValue,focusInitial:t,placeholder:P.default.formatMessage(W.filterPlaceholder),showClearButton:!0,inputLeft:(0,G.jsx)(Z.f_,{icon:u.R}),onChange:this.handleTemplateFilterChange,style:{...e.isAndroid&&{borderBottom:"none"}}})})}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=V.default.state,o=t?(0,k.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:a.tY.Create}):(0,k.ZP)({store:e,fullyQualified:!1,pageVisitSource:a.tY.Create});this.navigate(o)}}K.displayName="CollectionTemplatePicker",K.contextTypes={...y.wK,...r.w,...v.xm};const U=K;function q(e){let{collectionStore:t}=e;window.__c={n:"Title"};const o=(0,n.O7)(),i=(0,s.VK)((()=>t.getNameStore().getValue()),[t]);if(o.device.isMobile)return null;const r=i?(0,G.jsx)(G.Fragment,{children:(0,b.Xh)(i,t)}):(0,G.jsx)(h.FormattedMessage,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return(0,G.jsx)(E.Z,{style:{marginTop:6},title:(0,G.jsx)(D.Q,{prefix:(0,G.jsx)(h.FormattedMessage,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:r}),right:(0,G.jsx)(B.Z,{helpButtonContext:"collection_templates_menu",href:(0,T.UY)("guides.databaseTemplates")})})}function $(e){let{props:t,isOverlay:o,locked:i}=e;window.__c={n:"NewButtonMenuItemComponent"};const r=(0,l.Fg)(),s=(0,n.O7)(),a=(0,G.jsx)(h.FormattedMessage,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return o?(0,G.jsx)(I.Z,{isBlue:s.device.isDesktop,title:a,...t}):(0,G.jsx)(H.Z,{title:a,icon:(0,d.R)({width:18,fill:r.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:o?"collection-overlay":"page-menu-item",locked:i,...t})}},970:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>op,FULL_SCREEN_PADDING_BOTTOM:()=>Xu,default:()=>ip});o(21703);var i=o(30120),r=o(67294),n=o(73935),s=o(83355),l=o(1302),a=o(6740),c=o(86628),d=o(49085),u=o(15145),p=o(92996),h=o(3865),m=o(42509),g=o(65422),S=o(49019),f=o(45363),v=o(58810),y=o(47453),C=o(15157),x=o(72126),b=o(44615),w=o(21202),k=o(13493),P=o(12139),R=o(82990),T=o(51454),V=o(9291),M=o(50906),j=o(8406),F=o(32441),I=o(54642),B=o(26797),_=o(49865),D=o(5149),A=o(98834),Z=o(14900),L=o(32603),E=o(99553),O=o(52989),N=o(8055),z=o(61045),H=o(87531),G=o(24677),W=o(36821),K=o(98104),U=o(82530),q=o(91851),$=o(40663),Y=o(92650),Q=o(66890),X=o(66213),J=o(65273),ee=o(95645),te=o(12457),oe=o(28651),ie=o(28020),re=o(43250),ne=o(97004),se=o(70764),le=o(75079),ae=o(68641),ce=o(54802),de=o(65742),ue=o(78316),pe=o(73744),he=o(84210),me=o(12534),ge=o(33929),Se=o(39500),fe=o(50627),ve=o(77546),ye=o(77907),Ce=o(2688),xe=o(18245),be=o(94841),we=o(24646),ke=o(34859),Pe=o(80444),Re=o(61766),Te=o(4926),Ve=o(77556),Me=o(58421),je=o(88632),Fe=o(77080),Ie=o(30874),Be=o(96049),_e=o(77144),De=o(19671),Ae=o(85844),Ze=o(13023),Le=o(88923),Ee=o(26136),Oe=o(29026),Ne=o(77794),ze=o(34583),He=o(14714),Ge=o(97058),We=o(71644),Ke=o(96802),Ue=o(9953),qe=o(75754),$e=o(26999),Ye=o(92918),Qe=o(30206),Xe=o(17504),Je=o(6027),et=o(480),tt=o(56666),ot=o(51592),it=(o(57658),o(2032)),rt=o(14248),nt=o(42875),st=o(49902),lt=o(47853),at=o(16187),ct=o(87279),dt=o(98742),ut=o(75498),pt=o(10732),ht=o(57042),mt=o(52275),gt=o(31945),St=o(78140),ft=o(32163),vt=o(40721),yt=o(89728),Ct=o(53437),xt=o(72495),bt=o(26388),wt=o(42782),kt=o(85893);class Pt extends s.Z{constructor(){super(...arguments),this.reducerStore=this.createComputedStore((()=>{const{aggregation:e,schema:t,groupFormat:o}=this.props;if(e){return{type:"aggregation",filter:(0,rt.zk)({schema:t,group:o,timeZone:(0,nt.r)()}),aggregation:e}}}))}renderComponent(){const{device:e}=this.environment;return(0,kt.jsx)(bt.ZP,{renderTooltip:()=>(0,kt.jsx)(Tt,{aggregation:this.props.aggregation,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore}),render:t=>(0,kt.jsx)(gt.ZP,{popupType:e.isMobile?gt.Z4.SlideUp:gt.Z4.Popup,renderOrigin:e=>(0,kt.jsx)(yt.Z,{disabled:this.props.disabled,style:{fontWeight:R.Z.fontWeight.regular,color:this.props.color||this.theme.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0},...(0,dt.Z)(t,e),children:this.renderValue()}),disabled:this.props.disabled,render:e=>(0,kt.jsx)(Bt,{parent:e,onChange:this.props.onChange,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema})})})}renderValue(){const{schema:e,aggregation:t,collectionContextStore:o,groupFormat:i}=this.props,r=this.reducerStore.state;if(t&&r)return(0,kt.jsx)(ut.Z,{id:`board:${(0,He.mD)(i)}`,collectionContextStore:o,reducer:r,groupsPointer:[i],render:o=>{const i=o.state;let r;if((0,it.pK)(t)){const o=e[t.property];!o||"formula"!==o.type&&"number"!==o.type||(r=o.number_format)}return(0,kt.jsx)(pt.Z,{aggregation:t,collectionContextStore:this.props.collectionContextStore,children:i?(0,at.Ol)({numberFormat:r,dateFormat:void 0,aggregationType:t.aggregator,userTimeZone:(0,nt.r)(),value:i.aggregationResult,roundDecimal:5}):"-"})}})}}Pt.displayName="BoardAggregation";const Rt=Pt;function Tt(e){let{aggregation:t,schema:o,collectionContextStore:i}=e;window.__c={n:"TooltipText"};const r=(0,c.VK)((()=>!!t&&(0,pt.u)(i,t)),[i,t]);if(t){const e=at.VN[(0,it.OV)(t)];if((0,it.pK)(t)){const i=o[t.property];if(i){const t=i.name;return(0,kt.jsx)(kt.Fragment,{children:ge.default.formatMessage(ht.Z.propertyAggregation,{aggregationType:e,propertyName:t,calculating:r})})}}return(0,kt.jsx)(kt.Fragment,{children:ge.default.formatMessage(ht.Z.aggregationType,{aggregationType:e,calculating:r})})}return(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function Vt(e){let{aggregationType:t,label:o,props:i}=e;const r=at.Sn[t];return(0,kt.jsx)(bt.ZP,{placement:Ct.GI.Placement.Right,delayThreshold:0,render:e=>(0,kt.jsx)(mt.Z,{title:o,...(0,dt.Z)(e,i)}),renderTooltip:()=>(0,kt.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[r&&(0,kt.jsx)("img",{src:(0,lt.D)(r),style:{borderRadius:4,width:140,marginTop:4}}),at.BG[t]]})})}function Mt(e,t,o,i){o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),j.wd({environment:i,collectionContextStore:o,action:"board_change_aggregation"}),st.j({name:"collection_change_aggregation"})}function jt(e,t,o,i){const r=at.VN[e];return{key:e,render:t=>(0,kt.jsx)(Vt,{aggregationType:e,label:r,props:t}),action:()=>{Mt({aggregator:e},t,o,i)}}}function Ft(e,t,o,i,r,n){const{device:s}=o,l=at.VN[e],a=x.oA(t.map((t=>function(e,t,o,i,r,n){const s=o[e];if(!s)return;const l=s.name;return{key:`${e} ${t}`,render:e=>(0,kt.jsx)(Vt,{aggregationType:t,label:l,props:e}),action:()=>{Mt({aggregator:t,property:e},i,r,n)}}}(t,e,i,r,n,o))));return{key:e+l,render:(e,t)=>(0,kt.jsx)(wt.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,kt.jsx)(mt.Z,{...e,ref:t,title:l}),renderExtension:(e,o)=>{let i;return i=s.isMobile?{menuType:ct.og.Modal,title:l,right:(0,kt.jsx)(vt.DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:ct.og.Popup,width:200,...e},(0,kt.jsx)(St.Z,{...i,children:(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,kt.jsx)(xt.Z,{...e}),items:a}],onAccept:t.onAccept})})}}),action:()=>null}}function It(e,t,o,i){const r=[];for(const c of it.o5)r.push(jt(c,t,o,e));const n=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,it.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(n.length>0)for(const c of it.Sy)"show_unique"!==c&&r.push(Ft(c,n,e,i,t,o));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,it.O4)(o)}))}(i);if(s.length>0)for(const c of it.k$)r.push(Ft(c,s,e,i,t,o));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,it.dN)(o)}))}(i);if(l.length>0)for(const c of it.f8)r.push(Ft(c,l,e,i,t,o));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,it.Mv)(o)}))}(i);if(a.length>0)for(const c of it.gC)r.push(Ft(c,a,e,i,t,o));return r}function Bt(e){let{parent:t,onChange:o,collectionContextStore:i,schema:r}=e;window.__c={n:"MenuComponent"};const n=(0,et.O7)(),{device:s}=n;let l;return l=s.isMobile?{menuType:ct.og.Modal,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,kt.jsx)(vt.DoneMenuText,{}),onClickRight:t.close}:{menuType:ct.og.Popup,width:200},(0,kt.jsx)(St.Z,{...l,children:(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,kt.jsx)(xt.Z,{...e}),items:It(n,o,i,r)}],onAccept:t.close})})}var _t=o(984),Dt=o(24854),At=o(26055),Zt=o(73063);class Lt extends s.Z{constructor(){super(...arguments),this.handleAddItemClick=()=>{const{device:e}=this.environment;if(!ze.M_(this.environment))return;const{format:t,groupFormat:o,onAddItem:i,collectionContextStore:r,isFullScreen:n}=this.props;if("collectionTypedView"===r.contextType)return;const s=Boolean(t.collection_group_by);r.searchQuery.state&&Z.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:n});const l=r.collectionStore(),a=r.groupsStore.getGroupState(o);if(!l||!a)return;const c=a.resultsStore;U.createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:this.environment,perform:t=>{const n=_.IW({environment:this.environment,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"board_group_header"});if(!n)return;const l=n.coercionSucceeded,a=n.newStore;if(e.isMobile){const e=(0,he.ZP)({store:a,pageVisitSource:u.tY.Create});this.navigate(e)}else if(l&&!s){const e=a.getBlockTitleStore();G.eP({environment:this.environment,store:a}),K.NX({store:e}),Z.Z5({store:a})}else $e.CH({environment:this.environment,store:a,peekMode:(0,ue.kr)(r.collectionViewStore()),resultsStore:c,collectionContextStore:r,pageVisitSource:u.tY.Create});i&&i(a),M.W2j(this.environment,{from:"board_group_add_item_top",type:"page",new_page_id:a.id,creating_block_id:a.id,...(0,le.Pn)(r)})}})},this.colorStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o,collectionContextStore:i}=this.props;return(0,Ye.II)({environment:this.environment,groupFormat:e,schema:t,format:o,collectionContextStore:i,theme:this.theme})}),!0),this.isHoveredStore=this.createComputedStore((()=>(0,He.ZH)(this.props.hoveredGroupStore.state,this.props.groupFormat)))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}renderComponent(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state,i=t.shouldAllowNewItemCreation();return(0,kt.jsxs)("div",{style:this.getStyle(),onMouseMove:()=>{return e=this.props.hoveredGroupStore,t=this.props.groupFormat,void(e.state!==t&&e.setState(t));var e,t},children:[(0,kt.jsx)(zt,{boardGroupHeaderProps:this.props}),this.renderAggregation(),(0,kt.jsx)("div",{style:{flexGrow:1}}),!e&&o.canConfigureBlock&&this.renderActionButton(),i&&this.renderAddButton()]})}renderAggregation(){const{disabled:e,query:t,schema:o,collectionContextStore:i,groupFormat:r}=this.props,n=t.aggregations?t.aggregations[0]:void 0,s=i.permissionScopes.state;return(0,kt.jsx)(Rt,{groupFormat:r,disabled:e||!s.canConfigureBlock,aggregation:n,schema:o,collectionContextStore:i,color:this.getTextColor(),onChange:e=>function(e,t,o,i){const r=t.collectionViewStore(),n={...o,aggregations:e?[e]:[]};r&&U.createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:i,perform:e=>{Z.iG({collectionViewStore:r,update:{query2:n},transaction:e})}})}(e,this.props.collectionContextStore,this.props.query,this.environment)})}renderActionButton(){const{device:e}=this.environment;return(0,kt.jsx)(gt.ZP,{popupType:e.isMobile?gt.Z4.SlideUp:gt.Z4.Popup,renderOrigin:e=>(0,kt.jsx)(Zt.Z,{icon:tt.o,iconStyle:{fill:this.getTextColor()},style:this.getIconButtonStyle(),...e}),render:e=>(0,kt.jsx)(Nt,{parent:e,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore})})}renderAddButton(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri,i=(0,ot.sN)(o);return(0,kt.jsx)(bt.ZP,{renderTooltip:()=>(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Create new {newItemName}",values:{newItemName:i},id:"database.boardView.actions.addNewItem.tooltip"}),render:e=>(0,kt.jsx)(Zt.Z,{icon:y.R,onClick:this.handleAddItemClick,style:this.getIconButtonStyle(),iconStyle:{fill:this.getTextColor()},...e})})}getStyle(){const{hidden:e,format:t}=this.props,{device:o}=this.environment,i=Et(t),r=this.colorStore.state,n=Boolean(t.collection_group_by);return{display:"flex",alignItems:"center",fontSize:14,width:i,paddingLeft:_t.ay,paddingRight:_t.ay,marginRight:2*_t.g1,marginBottom:e?4:0,boxSizing:"content-box",flexShrink:0,cursor:"pointer",...this.props.isPopup&&{padding:o.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:i},...r&&!e&&{backgroundColor:this.props.isInPeekRenderer?r.peekBackgroundColor:r.backgroundColor,...n?{borderRadius:_t.nA}:{borderTopLeftRadius:_t.nA,borderTopRightRadius:_t.nA}}}}getTextColor(){const e=this.colorStore.state;return!this.props.hidden&&e?e.textColor:this.theme.lightTextColor}getIconButtonStyle(){const{hidden:e}=this.props;if(!e)return{transition:"opacity 100ms ease-in-out",opacity:this.isHoveredStore.state?1:0}}}function Et(e){return(0,ue.rD)(e.board_cover_size)}Lt.displayName="BoardGroupHeader",Lt.contextTypes={...X.wK,...s.w};const Ot=Lt;function Nt(e){let{parent:t,groupFormat:o,currentGroups:i,format:r,schema:n,collectionContextStore:s}=e;const l=s.boardColumnsLimitStore;return(0,kt.jsx)(Dt.Z,{parent:t,groupFormat:o,currentGroups:i,format:r,schema:n,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:l})}function zt(e){let{boardGroupHeaderProps:t}=e;window.__c={n:"ValueComponent"};const{groupFormat:o,schema:i,disabled:r,currentGroups:n,format:s,groupBy:l,collectionContextStore:a}=t,d=(0,et.O7)(),u=Et(s),p=(0,c.VK)((()=>a.permissionScopes.state),[a]);return(0,c.VK)((()=>a.groupsStore.getGroupState(o)),[a,o])?(0,kt.jsx)(At.Z,{groupBy:l,groupFormat:o,currentGroups:n,schema:i,disabled:r||!p.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:i}=o,r=i.collectionStore();r&&(_.w$({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:r,...o}),j.wd({environment:t,collectionContextStore:i,action:"rename_group"}))}(e,d,t),style:{maxWidth:u-70},collectionContextStore:a}):null}var Ht=o(24405),Gt=o(34575),Wt=o(36596);function Kt(e){window.__c={n:"BoardGroupsShimmer"};const{isFullScreen:t,boardCoverSize:o,showGroupHeader:i,areColumnsColored:r}=e,n=e.numBoardColumns||3,s=t?480:360,l=function(e){const t=_t.ay+_t.ay;return(0,ue.rD)(e)+t}(o),a=(0,Ht.yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:10},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%"},group:{marginTop:r?20:8,marginRight:10,width:"100%",minWidth:l}})),[l,r]),c=x.DZ(n,(e=>(0,kt.jsxs)("div",{style:a.group,children:[i&&(0,kt.jsx)(Wt.Z,{style:a.groupHeader}),(0,kt.jsx)(Gt.F,{minHeight:s})]},e)));return(0,kt.jsx)("div",{style:a.container,children:c})}var Ut=o(70203),qt=o(83692),$t=o(24098),Yt=o(52821);class Qt extends d.default{getInitialState(){return{searchQuery:"",limit:Qt.defaultLimit}}}Qt.defaultLimit=20,Qt.loadMoreScrollOffset=200,Qt.loadMoreIncrement=20;const Xt=Qt;var Jt=o(72087),eo=o(27724),to=o(88046),oo=o(25348),io=o(64921),ro=o(68894),no=o(68785),so=o(43765),lo=o(43145),ao=o(79954),co=o(34541);const uo={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:4},po=(0,V.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}});class ho extends s.Z{constructor(){super(...arguments),this.createdStores=new Set,this.storeTypes={buttonPopupStore:Re.Z,boardHiddenGroupStore:Xt,requestStore:Jt.Z},this.renderPopup=()=>{const{device:e}=this.environment,{groupFormat:t,schema:o,currentGroups:i,collectionContextStore:r,groupBy:n}=this.props;let s;s=e.isMobile?{menuType:ct.og.Modal,title:(0,kt.jsx)(At.Z,{groupBy:n,groupFormat:t,currentGroups:i,schema:o,disabled:!0,isHiddenGroup:!0,collectionContextStore:r}),left:(0,kt.jsx)(gt.ZP,{popupType:Ct.kQ.SlideUp,renderOrigin:e=>(0,kt.jsx)("div",{...e,children:(0,tt.o)({width:18,height:18,color:this.theme.lightTextColor})}),render:e=>(0,kt.jsx)(xo,{parent:e,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore})}),right:(0,kt.jsx)(vt.DoneMenuText,{}),onClickRight:this.handlePopupClose,header:this.renderHeader()}:{menuType:ct.og.Popup,header:this.renderHeader(),width:(0,ue.rD)(fo(this.props.format))+20};const l=this.reducerStore.state;if(l)return(0,kt.jsx)(co.Z,{store:this.selectableBlockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:o}=e;return(0,kt.jsxs)(St.Z,{...s,...o,children:[(0,kt.jsx)(ut.Z,{id:`board_hidden_group:${(0,He.mD)(t)}`,reducer:l,groupsPointer:[t],collectionContextStore:r,resultStore:vo(this.props.collectionContextStore,this.props.groupFormat),render:this.renderResults}),(0,kt.jsx)(lo.Z,{onChange:this.handleScrollOffsetChange})]})}})},this.renderResults=()=>{var e,t;const{device:o}=this.environment,{groupFormat:i,disabled:r,format:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a}=this.props,c=null===(e=vo(this.props.collectionContextStore,this.props.groupFormat))||void 0===e?void 0:e.state,d=null===(t=yo(this.props.collectionContextStore,this.props.groupFormat))||void 0===t?void 0:t.state;return c&&d?0===d.length?(0,kt.jsx)(xt.Z,{children:(0,kt.jsx)(so.Z,{title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,kt.jsx)("div",{style:{padding:o.isMobile?"8px 16px":"6px 14px 8px"},children:(0,kt.jsx)(oo.Z,{collectionContextStore:s,groupsPointer:[i],format:n,canDrag:!r,onSelectableEnter:e=>bo(e,this.props.groupFormat,this.props.collectionContextStore,this.props.isFullScreen,this.environment),disableRequest:!0,resultProps:{format:n,schema:l,disabled:r,coverFormat:go(this.props.format),coverAspectFormat:So(this.props.format),coverSizeFormat:fo(this.props.format),shouldShowTitle:Yt.K8(this.props.format,"board"),colorStyle:void 0,blockPropertyValueOverlayStore:a,onTextEnter:e=>function(e,t,o,i,r){const n=yo(t,i);if(!n)return;if(!ze.M_(r)||!t.collectionStore())return wo(e,t,i,r);const s=n.state.findIndex((t=>t===e))+1;U.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:r,perform:e=>{qt.b({transaction:e,environment:r,collectionContextStore:t,isFullScreen:o,groupsPointer:[i],insertAtIndex:s,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}})}(e,this.props.collectionContextStore,this.props.isFullScreen,this.props.groupFormat,this.environment),onTextEsc:e=>wo(e,this.props.collectionContextStore,this.props.groupFormat,this.environment),onShiftEnter:e=>bo(e,this.props.groupFormat,this.props.collectionContextStore,this.props.isFullScreen,this.environment),collectionContextStore:s},resultComponent:to.Z,handleOpenPeekPage:Le.default.isSidePeekOpen()?void 0:this.handlePopupClose,canDrop:!0,disabled:r,shouldShowHoverMenu:!1,direction:oo.R.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,kt.jsx)(xt.Z,{children:(0,kt.jsx)(so.Z,{title:(0,kt.jsx)(no.Z,{})})})},this.handlePopupClose=()=>{this.stores.buttonPopupStore.setState({open:!1})},this.handleSearchInputChange=e=>{this.stores.boardHiddenGroupStore.setState({searchQuery:e.target.value,limit:Xt.defaultLimit}),Co(this.environment)},this.handleSearchClearButtonClick=()=>{this.stores.boardHiddenGroupStore.reset(),Co(this.environment)},this.handleButtonPopupClick=()=>{this.stores.boardHiddenGroupStore.reset(),Co(this.environment)},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:i,groupFormat:r}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&U.createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:this.environment,perform:e=>_.BO({environment:this.environment,collectionContextStore:i,groupsPointer:[r],droppedStores:t,duplicate:o,transaction:e})})},this.handleBoardGroupHeaderAddItem=e=>{this.createdStores.add(e)},this.handleScrollOffsetChange=e=>{var t;const{collectionContextStore:o}=this.props,{boardHiddenGroupStore:i}=this.stores,r=i.state,n=null===(t=vo(this.props.collectionContextStore,this.props.groupFormat))||void 0===t||null===(t=t.state)||void 0===t?void 0:t.blockIds,s=o.isLoading.state;e<Xt.loadMoreScrollOffset&&!s&&n&&r.limit<=n.length&&i.setState({...r,limit:r.limit+Xt.loadMoreIncrement})},this.reducerStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o}=this.props,{boardHiddenGroupStore:i}=this.stores,{searchQuery:r,limit:n}=i.state,s=(0,rt.zk)({schema:t,group:e,timeZone:(0,nt.r)()});if(!s)return;return{type:"results",filter:s,limit:n,searchQuery:r,loadContentCover:Boolean(o&&o.board_cover&&"page_content"===o.board_cover.type)}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new Ee.G(this.environment,{table:w.iU,id:t.id}))}renderComponent(){const{device:e}=this.environment,{groupBy:t,groupFormat:o,disabled:i,query:r,schema:n,currentGroups:s,collectionContextStore:l}=this.props,a=r.aggregations?r.aggregations[0]:void 0;return(0,kt.jsx)(ao.Z,{store:this.selectableBlockStore,canDropOnto:!i,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,kt.jsx)(gt.ZP,{popupType:e.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,renderOrigin:e=>(0,kt.jsxs)(io.Z,{style:uo,...e,children:[(0,kt.jsx)(At.Z,{groupBy:t,groupFormat:o,currentGroups:s,schema:n,disabled:!0,isHiddenGroup:!0,collectionContextStore:l}),(0,kt.jsx)(Rt,{groupFormat:o,aggregation:a,schema:n,collectionContextStore:l,disabled:!0,onChange:e=>function(e,t,o,i){const r=t.collectionViewStore(),n={...o,aggregations:e?[e]:[]};r&&U.createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:i,perform:e=>{Z.iG({collectionViewStore:r,update:{query2:n},transaction:e})}})}(e,this.props.collectionContextStore,this.props.query,this.environment)})]},(0,He.mD)(o)),render:this.renderPopup,buttonPopupStore:this.stores.buttonPopupStore,onClick:this.handleButtonPopupClick})})}renderHeader(){const{device:e}=this.environment,{groupFormat:t,disabled:o,format:i,schema:n,query:s,currentGroups:l,collectionContextStore:a,isFullScreen:c,hoveredGroupStore:d,groupBy:u,isInPeekRenderer:p}=this.props,{searchQuery:h}=this.stores.boardHiddenGroupStore.state;return(0,kt.jsxs)(r.Fragment,{children:[!e.isMobile&&(0,kt.jsx)(Ot,{groupBy:u,currentGroups:l,groupFormat:t,query:s,schema:n,format:i,collectionContextStore:a,disabled:o||Boolean(h),hidden:!0,isPopup:!0,onAddItem:this.handleBoardGroupHeaderAddItem,isFullScreen:c,hoveredGroupStore:d,isInPeekRenderer:p},(0,He.mD)(t)),(0,kt.jsx)("div",{style:{margin:e.isMobile?0:"6px 0"},children:(0,kt.jsx)($t.Z,{capture:!0,render:t=>(0,kt.jsx)(ro.ZP,{value:h,placeholder:ge.default.formatMessage(po.searchPlaceholder),autoFocus:!e.isMobile,showClearButton:!0,onChange:this.handleSearchInputChange,onClearButtonClick:this.handleSearchClearButtonClick,...t})})})]})}}ho.displayName="BoardHiddenGroup";const mo=ho;function go(e){return e?e.board_cover:void 0}function So(e){return e?e.board_cover_aspect:void 0}function fo(e){return e?e.board_cover_size:void 0}function vo(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function yo(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function Co(e){eo.default.state.stores.length>0&&G.ZH(e)}function xo(e){let{parent:t,groupFormat:o,currentGroups:i,format:r,schema:n,collectionContextStore:s}=e;window.__c={n:"ActionButtonPopupComponent"};const l=(0,c.VK)((()=>s.collectionStore()),[s]),a=s.boardColumnsLimitStore;return l?(0,kt.jsx)(Dt.Z,{parent:t,groupFormat:o,currentGroups:i,format:r,schema:n,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:a}):null}function bo(e,t,o,i,r){const{blocks:n,transaction:s}=e,l=o.groupsStore.getGroupState(t);if(!l)return;const a=l.resultsStore;if(n.length>0&&a.state.length>0){const e=n[0];if(!ze.M_(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation())return;const l=a.state.findIndex((t=>t===e))+1;qt.b({transaction:s,environment:r,collectionContextStore:o,isFullScreen:i,groupsPointer:[t],insertAtIndex:l,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}}function wo(e,t,o,i){const r=t.collectionStore(),n=e.getTitleStore();if(Ut.QaF(n.getValue()))return void G.Ys({environment:i,store:e});if(!r)return;const s=yo(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&M.sGw(i,{...(0,le.Pn)(t),block_id:e.id}),U.createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:i,perform:t=>{_.Od({store:e,transaction:t})}}),l>=0){const e=s.state[l];G.Ys({environment:i,store:e})}}var ko=o(48936),Po=o(3687),Ro=o(64347),To=o(32949),Vo=o(25458),Mo=o(13005);function jo(e){window.__c={n:"CollectionViewErrorInlineButton"};const t=(0,Ht.yK)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,kt.jsx)(io.Z,{style:t.button,onClick:e.onClick,children:e.children})}const Fo=function(e){window.__c={n:"CollectionViewError"};const{collectionContextStore:t,title:o,description:i,icon:r,style:n}=e,s=(0,c.VK)((()=>t.settingsStore.state.open),[t.settingsStore]),l=(0,Ht.yK)((e=>({wrapper:{paddingTop:8,minHeight:250,display:"flex",alignItems:"center",justifyContent:"center",...n},innerWrapper:{paddingLeft:16,paddingRight:s?Mo.nJ+16:16},title:{fontSize:17,fontWeight:R.Z.fontWeight.medium,color:e.lightTextColor,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.lightTextColor},button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[s,n]);return(0,kt.jsx)("div",{style:l.wrapper,children:(0,kt.jsxs)("div",{style:l.innerWrapper,children:[r,(0,kt.jsx)("div",{style:l.title,children:o}),i?(0,kt.jsx)("div",{style:l.description,children:i}):void 0]})})};var Io=o(96851),Bo=o(26964),_o=o(79131);class Do extends ee.Z{constructor(e,t){super(e,t),this.storeTypes={groupsResultStore:d.default.createClass(void 0),hoveredGroupStore:d.default.createClass(void 0),subgroupsMountedStore:d.default.createClass(!1),lastColumnsBy:d.default.createClass(void 0),lastGroupBy:d.default.createClass(void 0)},this.hiddenGroupsContainerRef=void 0,this.hiddenGroupsHeaderRef=void 0,this.hiddenGroupsHeaderLastOffset=void 0,this.renderGroupHeader=(e,t)=>{const{schema:o,collectionContextStore:i,format:r,query:n,disabled:s,isFullScreen:l}=this.props;if(Zo(e,this.props.collectionContextStore)&&r.board_columns_by)return(0,kt.jsx)(Ot,{currentGroups:t,groupFormat:e,query:n,schema:o,format:r,groupBy:r.board_columns_by,collectionContextStore:i,hoveredGroupStore:this.stores.hoveredGroupStore,disabled:s,hidden:!1,isPopup:!1,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:l},(0,He.mD)(e))},this.subGroupMinWidth=()=>{const{format:e}=this.props;return this.columnsDisplayStateStore.state.visibleGroups.length*(Et(e)+2*_t.ay+2*_t.g1)},this.renderBoardHiddenGroupsButton=e=>(0,kt.jsx)("div",{style:{display:"flex",minWidth:this.subGroupMinWidth()},children:(0,kt.jsx)(Vo.ZP,{...e})}),this.renderSubGroupHeader=e=>(0,kt.jsx)(Po.Z,{...e,height:36,getComputedStickyStyle:e=>function(e,t,o){return{background:t?o.cardContentBackground:o.contentBackground,boxShadow:e?`0 1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,this.props.isInPeekRenderer,this.theme),style:{...e.style,minWidth:this.subGroupMinWidth()},onMount:()=>this.stores.subgroupsMountedStore.setState(!0)}),this.renderHiddenGroup=e=>{const{collectionContextStore:t,query:o,schema:i,format:r,disabled:n,blockPropertyValueOverlayStore:s,isFullScreen:l,isInPeekRenderer:a}=this.props,c=this.columnsDisplayStateStore.state.currentGroups;if(!Zo(e,this.props.collectionContextStore)||!r.board_columns_by)return;const d=t.permissionScopes.state;return(0,kt.jsx)(mo,{query:o,schema:i,format:r,groupFormat:e,groupBy:r.board_columns_by,currentGroups:c,collectionContextStore:t,disabled:n||!this.canEdit()||!d.canEditContent,blockPropertyValueOverlayStore:s,isFullScreen:l,hoveredGroupStore:this.stores.hoveredGroupStore,isInPeekRenderer:a},(0,He.mD)(e))},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o}=this.props,i=this.columnsDisplayStateStore.state.currentGroups,r=i.filter((t=>e.indexOf((0,He.mD)(t))<0)),n=i.filter((t=>e.indexOf((0,He.mD)(t))>=0)),s=x.MR(n,(t=>{const o=e.indexOf((0,He.mD)(t));return o>=0?o:1/0})),l=t?[...r,...s]:[...s,...r];U.createAndCommit({userAction:"Board.handleGroupReorder",environment:this.environment,perform:e=>{_.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:"board_columns",transaction:e})}}),j.wd({environment:this.environment,collectionContextStore:o,action:t?"board_reorder_hidden_groups":"board_reorder_groups"})},this.handleGroupsChange=()=>{const{format:e,collectionContextStore:t}=this.props,o=this.columnsDisplayStateStore.state.currentGroups;_.$D({environment:this.environment,format:e,groupsFormatKey:"board_columns",collectionContextStore:t,currentGroups:o})},this.handleGroupsChangeDebounced=x.Ds(this.handleGroupsChange,5e3),this.handleMouseLeave=()=>{this.stores.hoveredGroupStore.setState(void 0)},this.subgroupsOnChangeStore=this.createComputedStore((()=>{var e,t;const{collectionContextStore:o}=this.props,i=o.collectionViewStore();if(!i)return;const r=null==i||null===(e=i.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),n=null==i||null===(t=i.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue();x.Xy(r,this.stores.lastGroupBy.state)&&x.Xy(n,this.stores.lastColumnsBy.state)||this.stores.subgroupsMountedStore.setState(!1),this.stores.lastGroupBy.setState(r),this.stores.lastColumnsBy.setState(n)})),this.anyVisibleGroupHasResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,format:o,schema:i}=this.props,r=this.columnsDisplayStateStore.state,{visibleGroups:n}=r,s=o.collection_group_by,l=t.collectionViewBlockStore(),a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=void 0!==l?(0,Ye.Cz)({groupBy:s,schema:i,formatGroups:o.collection_groups||[],schemaGroups:this.schemaGroupsStore.state,reducerResults:c,getRecordModel:l.getRecordModel,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}):[];if(0===d.length){if(void 0!==s)return!1;for(const e of n){const o=t.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}}else for(const u of d)for(const e of n){const o=[u,e],i=t.groupsStore.getGroupState(o);if(null!=i&&i.reducerResultStore.state)return!0}return!1})),this.schemaGroupsStore=this.createComputedStore((()=>{const{format:e,schema:t}=this.props,o=e.board_columns_by;if(o)return(0,He.Qq)({schema:t,groupBy:o})}),!0),this.groupsReducerStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,i=o.remoteRequestStore.state,r=e.board_columns_by;if(r)return(0,Ye.ej)({groupBy:r,schema:t,format:e,filter:null==i?void 0:i.loader.filter,groupsFormatKey:"board_columns",limit:o.boardColumnsLimitStore.state})})),this.columnsDisplayStateStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,i=e.board_columns_by;if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const r=o.collectionViewBlockStore();if(!r)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const n=o.collectionViewStore(),s=o.boardColumnsLimitStore.state,l=this.schemaGroupsStore.state,a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=a?a.total:0,u=(0,Ye.Cz)({groupBy:i,schema:t,formatGroups:e.board_columns||[],schemaGroups:l,reducerResults:c,getRecordModel:r.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null==n?void 0:n.getFormat().app_config_uri}),p=u.filter((e=>!(0,He.eF)(e))).slice(0,s),h=u.filter((e=>(0,He.eF)(e)));return{currentGroups:[...p,...h],visibleGroups:p,hiddenGroups:h,total:d}}),!0),this.disableBoardColorColumnsStore=this.createComputedStore((()=>{const{schema:e,format:t,collectionContextStore:o}=this.props;return!Boolean((0,Ye.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t,collectionContextStore:o,theme:this.theme}))}),!0),this.hiddenGroupsContainerRef=r.createRef(),this.hiddenGroupsHeaderRef=r.createRef(),this.hiddenGroupsHeaderLastOffset=0}UNSAFE_willMount(){this.columnsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}UNSAFE_willUnmount(){this.columnsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}UNSAFE_willMountOrUpdate(e){const{format:t,store:o,collectionContextStore:i}=e,r=i.collectionStore();r&&(!t.board_columns_by&&o.isDefined()&&r.isDefined()&&function(e,t,o){const{collectionContextStore:i,schema:r}=e,n=i.collectionStore(),s=i.permissionScopes.state;if(!n)return;const l=i.collectionViewStore();if(!l||!s.canConfigureBlock)return;U.createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:o,perform:e=>{let a,c=ue.Se(r);if(!c&&s.canConfigureCollection){c=(0,We.ZP)();a={[c]:{name:t.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!c)return;const d=(a||r)[c];d&&(0,He.LG)(d)&&(Ke.FH({stores:[l],update:{board_columns_by:(0,He.fw)(c,d,"collectionTypedView"===i.contextType)},transaction:e}),Ue.sW({store:l,data:{type:"board"},transaction:e}),a&&Z.xO({environment:o,collectionStore:n,update:a,transaction:e}))}})}(e,this.props.intl,this.environment),l.default.afterNextFlush((()=>this.updateHiddenGroupsHeaderOffset())))}renderPersisted(){const{format:e,collectionContextStore:t,isFullScreen:o,paddingLeft:i,paddingRight:r,paddingBottom:n}=this.props,s=t.permissionScopes.state,l=t.settingsStore;return e.board_columns_by?this.renderBoard():(0,kt.jsx)(Fo,{collectionContextStore:t,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,kt.jsx)(jo,{onClick:()=>{D.r$({collectionContextStore:t,collectionSettingsStore:l}),D.H4({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:i,paddingRight:r,paddingBottom:o?void 0:n}})}renderBoard(){const{store:e,format:t,isFullScreen:o,collectionContextStore:i}=this.props,r=this.columnsDisplayStateStore.state,{visibleGroups:n,hiddenGroups:s}=r,l=t.collection_group_by,a=this.anyVisibleGroupHasResultsStore.state,c=this.stores.subgroupsMountedStore.state;this.subgroupsOnChangeStore.state;const d=i.shouldShowSpinner.state&&!c&&!a;return this.renderBoardColumnsReducerRequest((()=>(0,Xe.Z)((c=>{return(0,kt.jsx)(Io.Z,{isFullScreen:o,renderEmitter:i.renderEmitter,children:(0,kt.jsx)("div",{style:(p=this.props.paddingLeft,h=this.props.paddingRight,{marginLeft:p,marginRight:h,float:"left",minWidth:"100%"}),className:re.EGJ,...c,children:(0,kt.jsxs)(ao.Z,{style:(u=this.props.paddingBottom,{display:"flex",position:"relative",flexGrow:1,paddingBottom:u}),store:e,shouldShowHalo:!o,canSelect:!o,onMouseDown:e=>function(e,t){const{device:o}=t;o.isMobile||(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),O.AI({environment:t,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),analyticsName:"board",onMouseLeave:this.handleMouseLeave,children:[this.renderHeader(r),d&&(0,kt.jsx)(Kt,{isFullScreen:o,numBoardColumns:n.length,boardCoverSize:t.board_cover_size,areColumnsColored:!this.disableBoardColorColumnsStore.state,showGroupHeader:!0}),n.length>0&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{style:{height:_t.YJ+(0,_t.v2)(this.disableBoardColorColumnsStore.state)}}),l?this.renderBoardColumnsForGroups(l,n,a):this.renderBoardColumnsForGroup(void 0,n,a)]}),Lo(r,this.props.collectionContextStore)&&(0,kt.jsx)("div",{style:{width:To.cG,marginLeft:_t.g1,marginRight:_t.g1}}),Eo(r,this.props.format,this.props.collectionContextStore)&&(0,kt.jsx)("div",{style:{width:ko.GA,marginLeft:_t.g1,marginRight:_t.g1}}),s.length>0&&this.renderHiddenGroups(s)]})})});var u,p,h}))))}renderBoardColumnsReducerRequest(e){const{collectionContextStore:t}=this.props,o=this.groupsReducerStore.state;return o?(0,kt.jsx)(ut.Z,{id:"board_columns",reducer:o,collectionContextStore:t,resultStore:this.stores.groupsResultStore,render:e}):e()}renderHeader(e){const{format:t,isFullScreen:o,isRootChild:i,collectionContextStore:r}=this.props,{hiddenGroups:n,visibleGroups:s,currentGroups:l}=e;if(0===s.length&&0===n.length)return;const a=s.map((e=>(0,He.mD)(e))),c=t.board_columns_by;if(!c)return;const d=(0,He.mu)(c),u=r.permissionScopes.state,p="manual"===d.type&&u.canConfigureBlock,h=(0,Ye.qW)({device:this.environment.device,isFullScreen:o,isRootChild:i});return(0,kt.jsx)(Bo.Z,{position:Je.Z.Top,children:(0,kt.jsxs)("div",{style:this.getHeaderStyle(),children:[h&&(0,kt.jsx)("div",{style:(m=this.props.isInPeekRenderer,g=this.theme,{height:"calc(100% + 17px)",background:m?g.cardContentBackground:g.contentBackground,width:20,marginLeft:-20,marginTop:-17})}),p?(0,kt.jsx)(_o.ZP,{direction:"horizontal",keys:a,renderKey:(e,t)=>this.renderGroupHeader(s[t],l),onDrop:e=>this.handleGroupReorder(e,!1)}):a.map(((e,t)=>this.renderGroupHeader(s[t],l))),Lo(e,this.props.collectionContextStore)&&(0,kt.jsx)(Oo,{collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e}),Eo(e,this.props.format,this.props.collectionContextStore)&&this.renderAddGroupButton(),n.length>0&&(0,kt.jsx)("div",{style:zo(this.props.isInPeekRenderer,this.theme),ref:this.hiddenGroupsHeaderRef,children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})})]})});var m,g}renderHiddenGroups(e){const{device:t}=this.environment,{collectionContextStore:o}=this.props,i=this.canEdit()&&!t.isMobile&&!o.permissionScopes.state.isLocked,r=e.slice(0,Ye.ew),n=r.map((e=>(0,He.mD)(e)));return(0,kt.jsx)("div",{style:this.getHiddenGroupsWrapStyle(),ref:this.hiddenGroupsContainerRef,children:r.length>0&&(i?(0,kt.jsx)(_o.ZP,{direction:"vertical",keys:n,renderKey:(e,t)=>this.renderHiddenGroup(r[t]),onDrop:e=>this.handleGroupReorder(e,!0)}):(0,kt.jsx)("div",{children:r.map(this.renderHiddenGroup)}))})}renderAddGroupButton(){const{format:e,schema:t,collectionContextStore:o}=this.props;if(!e.board_columns_by)return;if("collectionTypedView"===o.contextType)return;const i=this.columnsDisplayStateStore.state.currentGroups;return(0,kt.jsx)(ko.ZP,{groupBy:e.board_columns_by,schema:t,currentGroups:i,onAccept:e=>function(e,t,o,i,r){const n=t.collectionStore();if(!n)return;const s=i.board_columns_by;if(!s)return;_.tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:n,schema:o,groupBy:s,environment:r})}(e,this.props.collectionContextStore,this.props.schema,this.props.format,this.environment),groupsLimitStore:o.boardColumnsLimitStore,parentStore:this.props.store,type:"board",collectionContextStore:o})}renderBoardColumnsForGroups(e,t,o){const{store:i,format:r,collectionContextStore:n,schema:s,disabled:l,isFullScreen:a,paddingLeft:c,isRootChild:d,isInPeekRenderer:p}=this.props;return(0,kt.jsx)(Ro.Z,{store:i,id:Ge.M9,groupBy:e,groupsFormatKey:He.Uh,groupAggregationKey:He.dQ,format:r,schema:s,collectionContextStore:n,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,renderGroup:e=>this.renderBoardColumnsForGroup(e,t,o),renderHeader:this.renderSubGroupHeader,renderHiddenGroupsButton:this.renderBoardHiddenGroupsButton,onGroupHeaderAddItem:e=>function(e,t,o){const{device:i}=o;i.isMobile?qe._({environment:o,store:e,pageVisitSource:u.tY.Create}):$e.CH({environment:o,store:e,peekMode:ue.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t,pageVisitSource:u.tY.Create})}(e,this.props.collectionContextStore,this.environment),stickyLeft:!this.environment.device.isMobile,getGroupStyle:No,isInPeekRenderer:p})}renderBoardColumnsForGroup(e,t,o){return(0,kt.jsx)("div",{style:_o.l8,children:t.map(((i,r)=>{const n=r===t.length-1;return this.renderGroupResults(e?[e,i]:[i],n,o)}))})}renderGroupResults(e,t,o){const{store:i,collectionContextStore:r,isFullScreen:n,query:s,schema:l,format:a,disabled:c,blockPropertyValueOverlayStore:d}=this.props,{hiddenGroups:u}=this.columnsDisplayStateStore.state,p=0!==u.length;if(!r.groupsStore.getGroupState(e))return;const h=r.permissionScopes.state,m=this.canEdit()&&("collectionTypedView"===r.contextType||h.canEditContent);return(0,kt.jsx)(_t.ZP,{store:i,hoveredGroupStore:this.stores.hoveredGroupStore,query:s,schema:l,format:a,groupsPointer:e,collectionContextStore:r,isFullScreen:n,isInPeekRenderer:this.props.isInPeekRenderer,disabled:c||!m,isLast:t&&!p,blockPropertyValueOverlayStore:d,anyGroupHasResults:o},(0,He.KW)(e))}getHeaderStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,i=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),r=(0,_t.v2)(this.disableBoardColorColumnsStore.state);return{position:"absolute",background:i,height:_t.YJ+r,paddingTop:r,zIndex:T.LN,display:"flex",boxShadow:`-3px 0 0 ${i}`,minWidth:"100%"}}getHeaderHeight(){const e=(0,_t.v2)(this.disableBoardColorColumnsStore.state);return _t.YJ+e}getHiddenGroupsWrapStyle(){return{width:220,flexShrink:0,marginTop:_t.YJ+(0,_t.v2)(this.disableBoardColorColumnsStore.state),marginLeft:12}}updateHiddenGroupsHeaderOffset(){var e;if("function"==typeof this.hiddenGroupsHeaderRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current)return;const t=(this.getHiddenGroupsHeaderOffset()||0)+this.hiddenGroupsHeaderLastOffset;this.hiddenGroupsHeaderLastOffset=t,this.hiddenGroupsHeaderRef.current.style.left=`${t}px`}getHiddenGroupsHeaderOffset(){var e,t;if("function"==typeof this.hiddenGroupsHeaderRef||"function"==typeof this.hiddenGroupsContainerRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current||null===(t=this.hiddenGroupsContainerRef)||void 0===t||!t.current)return;const o=this.hiddenGroupsHeaderRef.current.getBoundingClientRect().left;return this.hiddenGroupsContainerRef.current.getBoundingClientRect().left-o+8}}Do.displayName="Board";const Ao=(0,V.injectIntl)(Do);function Zo(e,t){return t.groupsStore.getGroupState([e])}function Lo(e,t){const{visibleGroups:o,hiddenGroups:i,total:r}=e,n=0===o.length&&!t.shouldShowSpinner.state||o.length>0,s=(0,Qe.gf)({collectionContextStore:t,isForColumnGroups:!0}),l=t.boardColumnsLimitStore.state<r-i.length;return n&&l||s}function Eo(e,t,o){const{visibleGroups:i}=e,r=t.board_columns_by,n=o.permissionScopes.state,s=0===i.length&&!o.shouldShowSpinner.state||i.length>0;return n.canConfigureBlock&&r&&(0,He.Wz)(r,n.canConfigureCollection)&&!n.isSyncedCollection&&s}function Oo(e){let{displayState:t,collectionContextStore:o,schema:i}=e;const r=o.boardColumnsLimitStore;return(0,kt.jsx)(To.ZP,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:r,type:"board",schema:i,collectionContextStore:o})}function No(e){return{marginTop:4,...e.isLast&&{paddingBottom:12}}}function zo(e,t){return{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:t.lightTextColor,background:e?t.cardContentBackground:t.contentBackground,marginLeft:20}}var Ho=o(13991),Go=o(99036),Wo=o(8848),Ko=o(40506),Uo=o(7057),qo=o(53877),$o=o(2585),Yo=o(5257),Qo=o(40863),Xo=o(48543),Jo=o(71574),ei=o(92607),ti=o(63296),oi=o(84437),ii=o(35599);function ri(e){let{collectionContextStore:t}=e;window.__c={n:"OpenInNotionCalendarButton"};const o=(0,et.O7)(),i=(0,c.VK)((()=>Pe.default.state.currentSpaceStore),[]),n=(0,r.useCallback)((e=>{const r=t.collectionViewStore();r&&i&&oi.sh({environment:o,collectionViewStore:r,spaceStore:i})}),[o,t,i]),s=(0,Ht.yK)((e=>({button:{marginRight:8,paddingRight:4},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:"#FF5F09"},externalLinkIcon:{width:16,height:16,margin:"0 4px 0 4px",fill:e.mediumIconColor}})),[]);return(0,kt.jsxs)(ti.Z,{style:s.button,iconStyle:s.calendarIconSvg,icon:e=>(0,kt.jsx)(ii.Z,{style:{...e,...s.calendarIcon}}),onClick:n,children:[(0,kt.jsx)(V.FormattedMessage,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"}),(0,ei.v)(s.externalLinkIcon)]})}function ni(e){window.__c={n:"MaybeOpenInNotionCalendarButton"};const t=(0,et.O7)(),[o,i]=(0,r.useState)(!1),n=(0,c.VK)((()=>Fe.default.checkGate("notion_calendar")),[]),s=(0,c.VK)((()=>Ie.Z.state.loaded),[]);return(0,r.useEffect)((()=>{(async()=>{const e=await(0,Jo.ZH)({environment:t});i(e)})()}),[t,n,s]),o?(0,kt.jsx)(ri,{...e}):null}var si=o(95802),li=o(15723),ai=o(17746),ci=o(50628),di=o(6695),ui=o(95855),pi=o(54497),hi=o(65598),mi=o(20144),gi=o(97039),Si=o(78030),fi=o(53876),vi=o(6685),yi=o(84076),Ci=o(31278),xi=o(76798);class bi extends ee.Z{activate(){const e=function(e,t){const{mainEditorCurrentBlockStore:o}=Pe.default.state;return ue.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),N.c4({environment:this.environment,url:e}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){return(0,kt.jsx)(ki,{...this.props})}}bi.displayName="CalendarItem";const wi=bi;function ki(e){window.__c={n:"CalendarItemFn"};const{store:t,row:o,schema:i,format:r,disabled:n,calendarBy:s,collectionContextStore:l,includeTime:a,resultsStore:d,handleOpenPeekPage:u,blockPropertyValueOverlayStore:p,calendarStore:h}=e,m=(0,et.O7)(),g=i[s],S=(0,c.VK)((()=>!n&&"date"===(null==g?void 0:g.type)&&!l.permissionScopes.state.isSyncedCollection),[l.permissionScopes,n,null==g?void 0:g.type]),{start:f,end:v,startOfWeek:y,endOfWeek:C,startColumn:b,columnCount:w}=(0,Qo.du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),k=(0,c.VK)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[],o=e.filter((e=>di.XU({block:t.getModel(),property:e,schema:i,getRecordModel:t.getRecordModel,userId:m.currentUser.id,userTimeZone:(0,nt.r)(),intl:ge.default.getIntl()})));return o.concat(x.e5(e,o))}),[m.currentUser.id,r.calendar_properties,i,t]);if(!g||!Go.Lt(g))return null;const P=k.length+1,R=f<y,T=void 0!==v&&v>C;return(0,kt.jsxs)(Pi,{store:t,row:o,numRows:P,columnCount:w,startIsBeforeStartOfWeek:R,endIsAfterEndOfWeek:T,startColumn:b,disabled:n,isEditableDate:S,calendarBy:s,resultsStore:d,handleOpenPeekPage:u,children:[(0,kt.jsx)(Ri,{store:t,disabled:n,start:f,startOfWeek:y,end:v,endOfWeek:C,includeTime:a,columnCount:w,propertySchema:g}),(0,kt.jsx)(Vi,{store:t,sortedProperties:k,startIsBeforeStartOfWeek:R,disabled:n,blockPropertyValueOverlayStore:p}),S&&(0,kt.jsx)(Mi,{store:t,start:f,startOfWeek:y,end:v,endOfWeek:C,calendarBy:s,calendarStore:h})]})}function Pi(e){window.__c={n:"CalendarItemWrapper"};const{store:t,children:o,columnCount:i,row:n,numRows:s,startColumn:l,disabled:a,isEditableDate:d,calendarBy:p,resultsStore:h,handleOpenPeekPage:m,startIsBeforeStartOfWeek:g,endIsAfterEndOfWeek:S}=e,f=(0,et.O7)(),v=(0,Q.Y$)(),y=(0,c.VK)((()=>ue.Sc(t)),[t]),C=s*fi.ch+2*Oi+2*Ni,x=Ei+C*n,b=(0,c.VK)((()=>mi.Z.state.hoveredStore===e.store),[e.store]),w=(0,Ht.yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:g?0:6,paddingRight:S?0:6,width:S?`calc(100% / 7 * ${i} - 1px)`:`calc(100% / 7 * ${i})`,left:`calc(100% / 7 * ${l})`,height:C,top:x},haloStyle:{...ue.pB(y,e),borderRadius:5,marginTop:2,marginBottom:2,marginLeft:g?0:5,marginRight:S?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomLeftRadius:4,borderBottomRightRadius:4,boxShadow:e.lightBoxShadow,...g&&{borderTopRightRadius:0,borderBottomRightRadius:0},...S&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[i,S,C,y,l,g,x]),k=(0,r.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?B.QG({environment:f,collectionStore:o,collectionContextStore:v,store:t,insertStores:e.insertStores,calendarBy:p,transaction:e.transaction,results:h.state}):[]}),[p,v,f,h,t]),P=(0,r.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&_.Od({store:t,transaction:o})}),[t]),[R,T]=(0,c.VK)((()=>{const{mainEditorCurrentBlockStore:e}=Pe.default.state,o=ue.mb({store:t,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1});return[(0,he.ZP)({store:t,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage}),o]}),[v,t]);return(0,kt.jsx)(ao.Z,{store:t,style:w.selectable,canSelect:!a,shouldShowHalo:!0,shouldForceRenderSelectionHalo:y,haloStyle:w.haloStyle,canTriggerContextMenu:!a,showBlockMenuInput:!0,canDrag:d,onInsertAbove:k,onInsertBelow:k,onRemove:P,canInsertAbove:d,canInsertBelow:d,analyticsName:"calendar",shouldShowDropZone:!0,className:re.K4T,children:(0,kt.jsx)(yi.Z,{style:w.linkBoxStyle,hoveredStyle:w.linkBoxHoveredStyle,pressedStyle:w.linkBoxHoveredStyle,innerStyle:w.linkBoxInnerStyle,onClick:m,href:R,metaHref:T,hovered:b,children:o})},t.id)}function Ri(e){window.__c={n:"CalendarItemTitleRow"};const{store:t,disabled:o,start:n,startOfWeek:s,end:l,endOfWeek:a,includeTime:d,columnCount:u,propertySchema:p}=e,h=(0,et.O7)(),m=n<s,g=l&&l>a,S="time_format"in p?p.time_format:Ko.c_,[f,v,y]=(0,c.VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),C=(0,r.useCallback)((e=>{const o=t.getIconStore();o&&U.createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:h,perform:t=>{Ue.sO({store:o,value:e,transaction:t})}})}),[h,t]),x=(0,Ht.yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...m&&{paddingLeft:12},...g&&{paddingRight:11},width:d?100/u+"%":"100%"},titleInner:{display:"flex",alignItems:"center",height:24},titleTextStyle:{flexGrow:1,fontSize:14,fontWeight:R.Z.fontWeight.semibold},recordIconStyle:{flexShrink:0,marginRight:4,marginTop:2},iconWarningStyle:{marginLeft:1,marginRight:5,width:10,fill:e.accentColors.orange[500]},timeStyle:{color:e.mediumTextColor,flexShrink:0,fontSize:10,marginLeft:4,height:14},endTimeStyle:{marginLeft:"auto",paddingLeft:4,marginRight:4,color:e.mediumTextColor,fontSize:10,whiteSpace:"nowrap",marginTop:-1},endTimeAbsoluteStyle:{position:"absolute",right:4,top:6}})),[u,g,d,m]),b=d&&l&&i.Xp.fromDateTimes(s,a).contains(l)&&n.day!==l.day,w=!(void 0===f&&v||y);return(0,kt.jsx)("div",{style:x.titleContainer,children:(0,kt.jsxs)("div",{style:x.titleInner,children:[w&&(o?(0,kt.jsx)(Ci.Z,{disabled:!0,icon:f,isEmptyPage:v,size:14,style:x.recordIconStyle}):(0,kt.jsx)(Ci.Z,{disabled:!1,store:t,bucket:"secure",icon:f,isEmptyPage:v,size:14,style:x.recordIconStyle,onChange:C})),y&&(0,pi.t)(x.iconWarningStyle),(0,kt.jsx)(xi.Z,{style:x.titleTextStyle,store:t,enableHover:!0}),(0,kt.jsx)(Ti,{store:t}),d&&i.Xp.fromDateTimes(s,a).contains(n)&&(0,kt.jsx)("div",{style:x.timeStyle,children:(0,Uo.xE)({dateTime:n,humanReadable:!1,timeFormat:S})}),b&&(0,kt.jsx)("div",{style:{...x.endTimeStyle,...u>1?x.endTimeAbsoluteStyle:void 0},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"ends {endTime}",id:"calendarItem.endsTime.message",values:{endTime:(0,Uo.xE)({dateTime:l,humanReadable:!1,timeFormat:S})}})})]})})}function Ti(e){window.__c={n:"DiscussionIndicator"};const{store:t}=e,o=(0,Ht.Fg)(),i=(0,c.VK)((()=>hi.Xp(t,{recursivelyLoadAllDiscussions:!1})),[t]);return 0===i?null:(0,kt.jsxs)("div",{style:{display:"flex",alignItems:"center",color:o.mediumTextColor,fontSize:12,marginLeft:4,flexShrink:0},children:[(0,ui.z)({width:12,height:12,marginRight:4,fill:o.mediumIconColor}),i]})}function Vi(e){window.__c={n:"CalendarItemPropertiesRows"};const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:i,disabled:r,blockPropertyValueOverlayStore:n}=e,s=(0,Q.Y$)(),l=(0,c.VK)((()=>s.permissionScopes.state.isLocked),[s.permissionScopes]),[a,d]=(0,c.VK)((()=>[ue.Bm({store:t,collectionContextStore:s}),s.collectionViewStore()]),[t,s]);return a?(0,kt.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...i&&{paddingLeft:12}},children:o.map((e=>(0,kt.jsx)(gi.Z,{store:t,property:e,disabled:r,locked:l,format:Si.C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:a,collectionViewStore:d},e)))}):null}function Mi(e){window.__c={n:"CalendarItemDraggables"};const{store:t,calendarStore:o,start:i,startOfWeek:n,end:s,endOfWeek:l,calendarBy:a}=e,c=(0,et.O7)(),d=(0,Ht.yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),u=(0,r.useCallback)((e=>{B.td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:a})}),[o,a]),p=(0,r.useCallback)((()=>{U.createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:c,perform:e=>{B.fX({environment:c,transaction:e,calendarStore:o,calendarBy:a})}})}),[a,o,c]),h=(0,r.useCallback)((()=>{B.cQ({calendarStore:o})}),[o]),m=i>n&&(0,kt.jsx)(vi.Z,{render:e=>(0,kt.jsx)("div",{style:d.leftDragHandle,...e}),onDraggableDragStart:()=>{B.f$({calendarStore:o,target:t,direction:ai.t.Left})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:h}),g=(!s||s&&s<l)&&(0,kt.jsx)(vi.Z,{render:e=>(0,kt.jsx)("div",{style:d.rightDragHandle,...e}),onDraggableDragStart:e=>{B.f$({calendarStore:o,target:t,direction:ai.t.Right})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:h});return(0,kt.jsxs)(kt.Fragment,{children:[m,g]})}const ji={height:28,width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",color:Wo.ZP.white,background:Wo.ZP.red,marginLeft:"auto",marginRight:"auto"},Fi={height:28,display:"flex",alignItems:"center",justifyContent:"center"},Ii={width:"100%",height:44,borderRadius:4},Bi={position:"absolute",fontSize:14,top:4,right:10,height:24,lineHeight:"24px",textAlign:"right",transition:"color 100ms ease-out"},_i={position:"relative",display:"flex"},Di={},Ai={height:74},Zi={height:66},Li={position:"relative",paddingLeft:1},Ei=30,Oi=2,Ni=3;class zi extends ee.Z{constructor(){super(...arguments),this.headerEl=void 0,this.root=void 0,this.verticalScrollableAncestor=void 0,this.storeTypes={calendarStore:ai.Z,resultStore:d.default.createClass(void 0)},this.handleHeaderMount=e=>{this.headerEl=e},this.handleScroll=()=>{if(!this.headerEl)return;if(!Ki(this.props.collectionContextStore,this.props.isFullScreen,this.environment))return;const{calendarStore:e}=this.stores,t=e.state,o=this.headerEl.getBoundingClientRect();let i=[];t.dayStoreMap.forEach(((e,t)=>{i.push({store:e,timestamp:t})})),i=x.MR(i,(e=>{let{timestamp:t}=e;return t}));const r=i.find((e=>{let{store:t}=e;const i=si.C.getRectFromStore(t);return Boolean(i&&i.top<=o.top+o.height&&i.top+i.height>=o.top+o.height)}));if(r){const o=(0,qo.kl)((0,qo.Xz)({date:(0,qo.V7)(r.timestamp,ie.AK.state),daysToAdd:1}));o!==t.startingMonth&&e.setState({...e.state,startingMonth:o})}},this.handleScrollThrottled=x.P2(this.handleScroll,100),this.handleMouseMove=e=>{const{calendarStore:t}=this.stores,o=t.state;if(!o.isDragging&&!Be.Z.state){const i=this.findHoveredDay(e.clientX,e.clientY);o.hoveredDay!==i&&t.setState({...o,hoveredDay:i})}},this.handleMouseMoveThrottled=x.P2(this.handleMouseMove,50),this.handleTodayClick=()=>{const e=Gi(this.props.collectionContextStore),t="month"===e?(0,qo.IS)((0,qo.kl)(Date.now()),ie.AK.state):(0,qo.IS)(Date.now(),ie.AK.state);this.setNewCalendarStart(t,e)},this.handleOpenPeekPage=()=>{const{collectionContextStore:e}=this.props;xe.default.mark("collections.open_item_page_lag");const t=e.collectionViewStore();E.Xd({collectionContextStore:e,resultsStore:this.sortedResultsStore});const o=null==t?void 0:t.getFormat().collection_peek_mode,i=o||Xo.Ls.calendar;M.hym(this.environment,{is_peek:!0,from:"calendar",peek_mode:i})},this.startOfWeekSettingStore=this.createComputedStore((()=>{const{currentUserSettingsStore:e}=Pe.default.state;if(!e)return 0;const t=e.getSettings();return null!=t&&t.start_day_of_week?t.start_day_of_week:0}),!0),this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Qo.Ft)({collectionContextStore:e})}),!0),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return[];const o=this.stores.resultStore.state;return o?o.blockIds.map((e=>Ee.G.createChildStore(t,{id:e,table:w.iU}))):[]}),!0),this.weeksStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=ge.default.getIntl();return(0,Qo.y$)({collectionContextStore:e,results:this.resultsStore.state,getRecordValue:this.getRecordValue,intl:t})}),!0),this.sortedResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return o&&(null===(e=this.weeksStore.state)||void 0===e?void 0:e.flatMap((e=>e.items.map((e=>Ee.G.createChildStore(o,{table:w.iU,id:e.id}))))))||[]}),!0),this.isMyTasks=this.createComputedStore((()=>(0,ie.qG)(this.props.store.id))),this.getRecordValue=this.props.store.getRecordValue}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{collectionContextStore:t}=e;this.handleMount(t),ie.AK.addListener((()=>{this.handleMount(this.props.collectionContextStore)}))}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e),Be.Z.state&&(this.stores.calendarStore.state.isDragging||this.stores.calendarStore.setState({...this.stores.calendarStore.state,hoveredDay:void 0}));const{query:t}=e;t.calendar_by||function(e,t,o){const{schema:i}=e,r=t.permissionScopes.state,n=ge.default.getIntl(),s=t.collectionStore();if(!s)return;const l=t.collectionViewStore();if(!l||!r.canConfigureBlock)return;U.createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:o,perform:e=>{let t,a=ue.PD(i);if(!a&&r.canConfigureCollection){a=(0,We.ZP)();t={[a]:{name:n.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}Z.Es({collectionViewStore:l,update:{calendar_by:a},transaction:e}),Ue.sW({store:l,data:{type:"calendar"},transaction:e}),t&&Z.xO({environment:o,collectionStore:s,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){this.handleScrollThrottled(),this.root||(this.root=n.findDOMNode(this),this.root&&(this.verticalScrollableAncestor=(0,ve.VW)(this.root),this.verticalScrollableAncestor&&pe.lj(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),pe.lj(this.root,"mousemove",this.handleMouseMoveThrottled)))}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&pe.ZV(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),this.root&&pe.ZV(this.root,"mousemove",this.handleMouseMoveThrottled)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}renderPersisted(){var e,t;const{device:o}=this.environment,{store:i,paddingBottom:r,paddingLeft:n,paddingRight:s,query:l,schema:a,collectionContextStore:c,isFullScreen:d}=this.props,{calendar_by:u}=l;if(!u)return(0,kt.jsx)(Wi,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const p=a[u];if(!p||!Go.Lt(p))return(0,kt.jsx)(Wi,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const h=this.reducerStore.state;if(!h)return;const m=void 0===(null===(e=this.stores.resultStore.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=this.stores.resultStore.getState())||void 0===t?void 0:t.blockIds.length),g=m&&(0,Qe.H0)({collectionContextStore:c,groupsPointer:[],hasPartialResults:!m}),S=Gi(c),f=this.weeksStore.state;return(0,Xe.Z)((e=>(0,kt.jsx)(ut.Z,{id:"calendar_results",resultStore:this.stores.resultStore,collectionContextStore:c,reducer:h,render:()=>{return(0,kt.jsx)(Io.Z,{isFullScreen:d,children:(0,kt.jsx)(lo.Z,{onChange:e=>function(e,t,o,i){const r=t.isLoading.state,n=Ki(t,o,i);if(e<Ve.Z.incrementScrollOffset&&!r&&n){const e=t.dateRangeStart.state,o=t.dateRangeEnd.state,i=(0,qo.V7)((0,qo._)({date:o,monthsToAdd:2}),ie.AK.state);Z.t5({dateRangeStart:e,dateRangeEnd:i,collectionContextStore:t})}}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment),children:(0,kt.jsx)("div",{style:{paddingBottom:r,paddingLeft:n,paddingRight:s,minWidth:this.props.minWidth},className:re.c7X,children:(0,kt.jsxs)(ao.Z,{style:Li,store:i,shouldShowHalo:!d,canSelect:!d,onMouseDown:e=>function(e,t,o){const{device:i}=o;i.isPhone||(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),O.AI({environment:o,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[t],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}(e,this.props.store,this.environment),analyticsName:"calendar",...e,children:[this.renderHeader(this.getCurrentlyViewedMonth(),S),(0,kt.jsx)("div",{style:o.isPhone?Ai:Zi}),(0,kt.jsx)("div",{style:o.isPhone?Di:(t=this.theme,{boxShadow:`-1px 0 0 ${t.tableDividerColor}`,marginTop:1,overflow:"hidden"}),children:f&&f.map((e=>o.isPhone?this.renderMobileWeek(e.start,e.items,u,S,g):this.renderWeek(e.start,e.end,e.items,u,p,S,g)))})]})})})});var t}})))}renderHeader(e,t){const{device:o}=this.environment,{collectionContextStore:i}=this.props,r=ge.default.getIntl();return(0,kt.jsx)(Bo.Z,{position:Je.Z.Top,children:(0,kt.jsxs)("div",{style:o.isPhone?(n=this.theme,{position:"absolute",left:0,right:0,background:n.contentBackground,zIndex:T.VT}):Ui(this.props.collectionContextStore,this.props.isInPeekRenderer,this.theme),ref:this.handleHeaderMount,children:[(0,kt.jsxs)("div",{style:{display:"flex",height:42,alignItems:"center",marginBottom:2},children:[(0,kt.jsx)("div",{style:{fontWeight:R.Z.fontWeight.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:o.isPhone?16:14},children:this.getHeaderText(t,e,Ho.SP)}),(0,kt.jsx)("div",{style:{flexGrow:1}}),(0,kt.jsx)(ni,{collectionContextStore:i}),(0,kt.jsx)(Zt.Z,{ariaLabel:r.formatMessage({id:"database.calendarView.previousMonthButton.label",defaultMessage:"Previous Month"}),mobileFeedback:o.isMobile,icon:$o.f,onClick:()=>this.handleCalendarClick("left",i)}),(0,kt.jsx)(yt.Z,{isSmall:!0,onClick:this.handleTodayClick,children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Today",id:"database.calendarView.todayButton.label"})}),(0,kt.jsx)(Zt.Z,{ariaLabel:r.formatMessage({id:"database.calendarView.nextMonthButton.label",defaultMessage:"Next Month"}),mobileFeedback:o.isMobile,icon:Yo.o,onClick:()=>this.handleCalendarClick("right",i)})]}),(0,kt.jsx)("div",{style:{display:"flex",marginTop:o.isPhone?8:0,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`},className:re.GNl,children:(0,Uo.kv)(ie.AK.state,Ho.SP).map((e=>{let[t,o]=e;return(0,kt.jsx)("div",{style:qi(this.theme),children:o},t)}))})]})});var n}renderWeek(e,t,o,i,r,n,s){const{collectionContextStore:l,format:a,schema:c,blockPropertyValueOverlayStore:d}=this.props,u=l.collectionViewStore();if(!u)return;const p=this.canEditCalendar(),{calendarStore:h}=this.stores,m=h.state,g=[...Array(7).keys()].map((t=>this.renderDay(t,(0,qo.Xz)({date:e,daysToAdd:t}),i,r,n,s))),S=[];let f=0;for(const k of o){const o=Ee.G.createChildStore(u,{table:w.iU,id:k.id});m.isDragging&&m.target===o&&m.temporaryValue||S.push((0,kt.jsx)(wi,{collectionContextStore:l,store:o,startOfWeek:e,endOfWeek:t,start:k.start,end:k.end,row:k.row,includeTime:k.includeTime,format:a,schema:c,calendarBy:i,disabled:!p,calendarStore:h,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},o.id)),k.row>f&&(f=k.row)}const v=m.isDragging&&m.temporaryValue&&(0,qo.Y_)(m.temporaryValue,(0,nt.r)());if(m.isDragging&&m.temporaryValue&&v&&(0,Ko.b8)(e,t,v.start,v.end)){const{target:r,temporaryValue:n}=m,s=o.find((e=>e.id===r.id));S.push((0,kt.jsx)(wi,{collectionContextStore:l,store:r,startOfWeek:e,endOfWeek:t,start:v.start,end:v.end,row:s?s.row:0,includeTime:"datetime"===n.type||"datetimerange"===n.type,format:a,schema:c,calendarBy:i,disabled:!p,calendarStore:h,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},r.id))}const y=(a.calendar_properties?a.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).length+1,C="week"===n?372:124,x=fi.ch*y+2*Oi+2*Ni,b=Math.max((f+1)*x+Ei+4,C);return(0,kt.jsxs)("div",{style:{..._i,height:b},children:[g,S]},e.toString())}renderDay(e,t,o,i,r,n){const{store:s,collectionContextStore:l}=this.props,{calendarStore:a}=this.stores,{dayStoreMap:c}=a.state,d=ge.default.getIntl(),u=a.state,p="date"===i.type,h=l.shouldAllowNewItemCreation();let m=c.get(t);m||(m=new Ee.G(this.environment,s.pointer,{userId:s.userId,inMemoryRecordCache:s.inMemoryRecordCache}),c.set(t,m));const g=!u.isDragging&&u.hoveredDay===t,S=(0,qo.Bn)({firstDate:t,secondDate:this.getCurrentlyViewedMonth()}),f=(0,qo.Y3)(t),v=(0,qo.LY)(t),C=!S&&!f&&"week"!==r,x=d.formatMessage({defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"});return(0,kt.jsxs)(ao.Z,{style:v?(b=this.props.isInPeekRenderer,w=this.theme,{...$i(w),background:b?w.cardSidebarBackground:w.sidebarBackground}):$i(this.theme),store:m,canDropOnto:this.canEditCalendar()&&p,onSelectableDrop:e=>{U.createAndCommit({userAction:"Calendar.renderDay",environment:this.environment,perform:i=>{const r=l.collectionStore();if(!r&&"collectionTypedView"!==l.contextType)return;const n=xe.default.mark("collections.drop_item_lag");xe.default.measureAfterNextFlush(n,{environment:this.environment,getData:()=>le.yr({collectionContextStore:l,is_native_drop:!1,is_empty:!1})}),B.JN({...e,environment:this.environment,startOfDay:t,calendarBy:o,collectionStore:r,collectionContextStore:l,results:this.resultsStore.state,transaction:i})}})},onDoubleClick:()=>{if(this.canEditCalendar()&&ze.M_(this.environment)&&h){const e=this.createBlockInDay(t,o);M.W2j(this.environment,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,le.Pn)(l)})}},analyticsName:"calendar_day",shouldShowDropZone:!0,children:[g&&(p||f)&&h&&this.canEditCalendar()&&(0,kt.jsx)(bt.ZP,{renderTooltip:()=>x,render:e=>(0,kt.jsx)(Zt.Z,{ariaLabel:x,icon:y.R,showShadow:!0,hasBackground:!0,style:{position:"absolute",top:6,left:6,width:20,height:20},onClick:()=>{if(ze.M_(this.environment)){const e=this.createBlockInDay(t,o);M.W2j(this.environment,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,le.Pn)(l)})}},...(0,dt.Z)(e,{onMouseDown:me.$0})})}),(0,kt.jsx)("div",{style:{...f?Yi(this.theme):Bi,...C&&{color:this.theme.lightTextColor}},className:n?`${re.irE} notion-shimmer-text animation-delay-${e} notion-shimmer-calendar-transition`:`${re.irE} notion-shimmer-calendar-transition`,children:1!==(0,qo.TE)(t)||f?(0,qo.TE)(t):`${new Intl.DateTimeFormat(d.locale,{month:"short",day:"numeric"}).format(new Date(t))} `})]},t.toString());var b,w}renderMobileWeek(e,t,o,i,r){const n=[...Array(7).keys()].map((n=>{const s=(0,qo.Xz)({date:e,daysToAdd:n});return this.renderMobileDay(n,s,(0,qo.us)(s),t,o,i,r)}));return(0,kt.jsx)("div",{style:(s=this.theme,{display:"flex",boxShadow:`0 -1px 0 ${s.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}),children:n},e.toString());var s}renderMobileDay(e,t,o,i,r,n,s){const{collectionContextStore:l,query:a,format:c,schema:d,blockPropertyValueOverlayStore:u}=this.props,p=this.canEditCalendar(),h=i.find((e=>(0,Ko.b8)(t,o,e.start,e.end?e.end:void 0))),m=(0,qo.TE)(t),g=(0,qo.Bn)({firstDate:t,secondDate:this.getCurrentlyViewedMonth()}),S=(0,qo.Y3)(t),f=!g&&!S&&"week"!==n;return(0,kt.jsx)(gt.ZP,{popupType:gt.Z4.SlideUp,renderOrigin:t=>{return(0,kt.jsxs)(io.Z,{style:Ii,...t,children:[(0,kt.jsx)("div",{style:{...S?ji:Fi,...f&&{color:this.theme.lightTextColor}},className:s?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${e}`:"notion-shimmer-calendar-transition",children:m}),h&&(0,kt.jsx)("div",{style:(o=this.theme,{width:8,height:8,background:o.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"})})]});var o},render:e=>(0,kt.jsx)(ye.LazyMobileCalendarDayMenu,{collectionContextStore:l,initialStartOfDay:t,format:c,schema:d,query:a,calendarBy:r,disabled:!p,onDismiss:e.close,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore})},m.toString())}handleCalendarClick(e,t){const o=(0,qo.V7)(t.dateRangeStart.state,ie.AK.state),i=Gi(this.props.collectionContextStore);if("month"===i){const t="left"===e?-1:1,r=(0,qo.IS)((0,qo.kl)((0,qo._)({date:o,monthsToAdd:t})),ie.AK.state);this.setNewCalendarStart(r,i)}else{const o="left"===e?-7:7,r=(0,qo.IS)((0,qo.Xz)({date:t.dateRangeStart.state,daysToAdd:o}),ie.AK.state);this.setNewCalendarStart(r,i)}}handleMount(e){const t=e.collectionViewStore();if(!t)return;const o=this.startOfWeekSettingStore.state;if(void 0===o)return;const i=Gi(e),r=ai.Z.getLocalDateRangeStart({collectionViewId:t.id,currentUserId:this.environment.currentUser.id}),n=(0,qo.IS)(r,o),s=(0,qo.IS)((0,qo.kl)(r),o),l="month"===i?s:n;this.stores.calendarStore.setState({...this.stores.calendarStore.state,startingMonth:s.valueOf()}),this.setNewCalendarStart(l,i)}getHeaderText(e,t,o){var i;const r=(0,Uo.Yx)(t,"month_year_long",o);if("month"===e)return r;const n=null===(i=this.weeksStore)||void 0===i||null===(i=i.state)||void 0===i?void 0:i[0];if(void 0===n)return"";if((0,qo.Bn)({firstDate:n.start,secondDate:n.end}))return r;return`${(0,Uo.Yx)(n.start,(0,qo.Xh)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",o)} - ${(0,Uo.Yx)(n.end,"month_year_short",o)}`}setDateRange(e,t){const{collectionContextStore:o}=this.props,{calendarStore:i}=this.stores;Z.t5({dateRangeStart:e,dateRangeEnd:t,collectionContextStore:o}),i.setState({...i.state,startingMonth:(0,qo.kl)((0,qo.V7)(e,ie.AK.state))})}findHoveredDay(e,t){G.Ch();const{dayStoreMap:o}=this.stores.calendarStore.state,{selectableRectMap:i}=ci.Z.state,r=Array.from(o.keys()),n=Array.from(o.values());for(const[s,l]of i.entries())if(l&&li.uh(l,e,t)&&n.indexOf(s.props.store)>=0)return r.find((e=>o.get(e)===s.props.store))}createBlockInDay(e,t){const{collectionContextStore:o}=this.props,{mainEditorCurrentBlockStore:i}=Pe.default.state,{performResult:r}=U.createAndCommit({userAction:"Calendar.createBlockInDay",environment:this.environment,perform:r=>{const n=this.isMyTasks.state,s=_.IW({environment:this.environment,collectionContextStore:o,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:r,from:n?"home_tasks":"calendar"});if(!s)return;B.xD({type:"timestamp",environment:this.environment,store:s.newStore,propertyId:t,timestampMs:e,transaction:r});const l=ue.mb({store:s.newStore,mainEditorCurrentBlockStore:i,collectionContextStore:o,overridePeekMode:n?"center_peek":void 0,showMoveTo:n})??(0,he.ZP)({store:s.newStore,pageVisitSource:u.tY.Create});return this.navigate(l),E.Xd({collectionContextStore:o,resultsStore:void 0}),s.newStore}});return r}setNewCalendarStart(e,t){const{collectionContextStore:o}=this.props,i=o.collectionViewStore();if(!i)return;const r=Ki(this.props.collectionContextStore,this.props.isFullScreen,this.environment),n=ie.AK.state,s=(0,qo.V7)(e,n),l=(0,qo.IS)(e,n);if(ai.Z.setLocalDateRangeStart({collectionViewId:i.id,dateRangeStart:"month"===t?s:l,currentUserId:this.environment.currentUser.id}),"month"===t){const t=r?(0,qo.V7)((0,qo._)({date:s,monthsToAdd:1}),n):(0,qo.V7)((0,qo.RN)(s),n);this.setDateRange(e,t),this.verticalScrollableAncestor&&r&&(this.verticalScrollableAncestor.scrollTop=0)}else"week"===t&&this.setDateRange(e,s)}canEditCalendar(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&(e.canEditContent||"collectionTypedView"===this.props.collectionContextStore.contextType)}getCurrentlyViewedMonth(){const e=this.props.collectionContextStore.dateRangeStart.state;return Ki(this.props.collectionContextStore,this.props.isFullScreen,this.environment)||!e?this.stores.calendarStore.state.startingMonth:(0,qo.kl)((0,qo.V7)(e,ie.AK.state))}}zi.displayName="Calendar",zi.contextTypes={...X.wK,...s.w};const Hi=zi;function Gi(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_view_range").getValue())??"month"}function Wi(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:i,paddingLeft:r,paddingRight:n}=e;window.__c={n:"MissingDateProperty"};const s=t.settingsStore,l=(0,c.VK)((()=>t.permissionScopes.state.canConfigureBlock),[t]);return(0,kt.jsx)(Fo,{collectionContextStore:t,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:l?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,kt.jsx)(jo,{onClick:()=>{D.r$({collectionContextStore:t,collectionSettingsStore:s}),D.H4({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:n,paddingBottom:o?void 0:i}})}function Ki(e,t,o){const{device:i}=o,r="month"===Gi(e);return t&&!i.isMobile&&r}function Ui(e,t,o){var i;return{position:"absolute",left:0,right:0,background:(null===(i=e.inheritedBlockColorStore.state)||void 0===i?void 0:i.background)||(t?o.cardContentBackground:o.contentBackground),zIndex:T.VT}}function qi(e){return{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,height:24,color:e.lightTextColor}}function $i(e){return{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default"}}function Yi(e){return{position:"absolute",fontSize:14,top:4,right:4,height:24,width:24,lineHeight:"24px",borderRadius:"100%",textAlign:"center",color:Wo.ZP.white,background:e.calendarTodayBackground}}var Qi=o(356),Xi=o(14063),Ji=o(80951),er=o(18514);class tr extends d.default{getInitialState(){return{query:"",limit:20}}}const or=tr;var ir=o(81870),rr=o(26909),nr=o(44514),sr=o(45669),lr=o(11470);const ar=(0,V.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}});class cr extends s.Z{constructor(){super(...arguments),this.storeTypes={store:or,resultStore:d.default.createClass(void 0)},this.renderResults=()=>{const{collectionViewType:e}=this.props,{store:t}=this.stores,{query:o}=t.state,i=this.getCurrentResult(),r="calendar"===e?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Click to add to the calendar",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"});return i?i&&0===i.blockIds.length?(0,kt.jsx)(xt.Z,{title:r,children:(0,kt.jsx)(so.Z,{title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,sections:[{key:"results",render:e=>(0,kt.jsx)(xt.Z,{...e,title:r}),items:gr(i.blockIds,this.props.collectionStore,this.props.property,this.props.onAddPage,this.environment)}],initialFocus:o?0:void 0}):(0,kt.jsx)(xt.Z,{title:r,loading:!0,children:(0,kt.jsx)(so.Z,{title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Loading…",id:"collectionNoDateMenu.loading.message"})})})},this.handleQueryChange=e=>{this.stores.store.setState({query:e.target.value,limit:pr})},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t}=this.props,{store:o}=this.stores,i=this.getCurrentResult(),r=o.state.limit,n=t.isLoading.state;e<ur&&i&&i.hasMore&&!n&&o.setState({...o.state,limit:r+pr})},this.reducerStore=this.createComputedStore((()=>{const{property:e}=this.props,{store:t}=this.stores,{query:o,limit:i}=t.state;return{type:"results",filter:{operator:"and",filters:[{property:e,filter:{operator:"is_empty"}}]},limit:i,searchQuery:o}}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,{store:o,resultStore:i}=this.stores,{query:r}=o.state;return(0,kt.jsxs)(rr.Tp,{title:(0,kt.jsx)(hr,{noDateTotal:this.props.noDateTotal,collectionViewType:this.props.collectionViewType,collectionViewName:this.props.collectionViewName}),onCancel:this.props.onClose,helpButton:(0,kt.jsx)(ir.Z,{helpButtonContext:"collection_no_date_menu",href:(0,er.UY)("guides.databaseCalendar")}),desktopWidth:450,children:[(0,kt.jsx)(xt.Z,{isInput:!0,children:(0,kt.jsx)(ro.ZP,{placeholder:ge.default.formatMessage(ar.searchPlaceholder),focus:!t.isMobile||void 0,focusAfterAnimation:!0,value:r,onChange:this.handleQueryChange})}),(0,kt.jsx)(ut.Z,{id:"no_date_results",reducer:this.reducerStore.state,collectionContextStore:e,render:this.renderResults,resultStore:i}),(0,kt.jsx)(lo.Z,{onChange:this.handleScrollOffsetChange})]})}getCurrentResult(){return this.stores.resultStore.state}}cr.displayName="CollectionNoDateMenu";const dr=cr,ur=200,pr=20;function hr(e){let{noDateTotal:t,collectionViewType:o,collectionViewName:i}=e;window.__c={n:"Title"};return(0,et.O7)().device.isMobile?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Pages with no date",id:"collectionNoDateMenu.mobileMenuTitle"}):(0,kt.jsx)(nr.Q,{prefix:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"{noDateTotal, plural, one {{noDateTotal} page with no date in} other {{noDateTotal} pages with no date in}}",id:"collectionNoDateMenu.pagesWithNoDateInPrefix",values:{noDateTotal:t}}),viewType:o,viewName:(0,kt.jsx)(sr.Z,{collectionViewName:i,collectionViewType:o})})}function mr(e){let{props:t,store:o,url:i}=e;window.__c={n:"MenuListItemComponent"};const r=(0,et.O7)(),{device:n}=r;return(0,kt.jsx)(lr.Z,{...t,store:o,hidePath:!0,right:(0,kt.jsx)(yi.Z,{href:i,innerStyle:{display:"flex",alignItems:"center",borderRadius:4,paddingLeft:n.isMobile?8:6,paddingRight:n.isMobile?8:6,height:n.isMobile?44:22},onClick:()=>{M.tMA(r)},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"View",id:"collectionNoDateMenu.view.button.label"})},o.id),dontShrinkRight:!0})}function gr(e,t,o,i,r){const n=e.map((e=>Ee.G.createChildStore(t,{table:w.iU,id:e}))).filter((e=>!Ji.Gl(e.getPropertyStore(o).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:t}=Pe.default.state;if(!t)return;const o=(0,he.ZP)({store:t,peekViewBlockId:e.id,pageVisitSource:u.tY.LinkInPage});return{key:e.id,render:t=>(0,kt.jsx)(mr,{props:t,store:e,url:o}),action:()=>{i(e),M.zes(r)}}}));return x.oA(n)}var Sr=o(65669),fr=o(63087),vr=o(29477),yr=o(97880),Cr=o(36054);class xr{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{if(!Fe.default.checkGate("client_handle_query_collection_locally"))return!0;const o=this.collectionContextStore.isClientModeEnabled.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const i=Boolean(e&&(0,Cr.P9)(fr.y,e)&&e.hasMore);if(o&&!i)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,yr.qP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,Cr.P9)(fr.y,e)&&!e.hasMore)},this.throttledRefetch=(0,Sr.Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;this.reset(),o?this.throttledRefetch({src:e}):j.bW(this.environment),t&&await Z.fI({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=Fe.default.getEligibleGroup({experimentId:"collection_client_refetch_throttle_time_ms",defaultGroup:"control"}),o="control"===t?1e3:parseInt(t);await Promise.all([Z.dj(this.environment,this.collectionContextStore,e),(0,vr.Vs)(o)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:i,isCollectionTypeChange:r}=e;if((0,Cr.P9)(fr.y,o)&&null!=o&&o.blockIdToVersion&&(0,yr.qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,r),!i)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var br=o(91007),wr=o(70475),kr=o(37612),Pr=o(62967),Rr=o(43664),Tr=o(42858),Vr=o(58202);class Mr extends d.default{getInitialState(){return{textStoresBeingEdited:[],lastBlockPropertyValueOverlayCloseTime:void 0}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===Ut.QaF(o)}))}}const jr=Mr;var Fr=o(13966),Ir=o(68709),Br=o(23063),_r=o(97820);function Dr(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const Ar=(0,V.defineMessages)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Zr(e){window.__c={n:"CollectionsBulkActionsToolbar"};const t=(0,Q.Y$)(),{marginLeft:o}=e,i=(0,et.O7)(),n=(0,c.qz)(void 0,jr),s=(0,r.useRef)(null),[l,a]=(0,r.useState)(!1),d=(0,c.VK)((()=>n.state.lastBlockPropertyValueOverlayCloseTime),[n]),u=(0,c.VK)((()=>eo.default.state.stores.filter((e=>Vr.R.findBlockFromStore(e)))),[d]),p=u.length,h=(0,c.VK)((()=>n.getNumberOfTextStoresBeingEdited()),[n]),m=(0,c.VK)((()=>{var e;return!!(0,ue.fk)({environment:i,collectionContextStore:t})&&(h>0||u.length>=1&&(0,ue.v_)(u,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id))}),[t,i,h,u]),g=(0,Ht.yK)((e=>({inner:{position:"absolute",top:1,left:0+(o??0),display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:32},outer:{position:"sticky",top:0,left:0,zIndex:T.mJ,visibility:l?"visible":"hidden"},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...Dr(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[l,o]);return(0,kt.jsx)(Br.Z,{isVisible:m,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:{stiffness:100,damping:10,precision:1e-4}},onAnimationEnd:e=>{e||a(!1)},render:()=>(0,kt.jsx)($t.Z,{capture:!0,render:e=>(0,kt.jsx)("div",{ref:s,...e,style:g.outer,children:(0,kt.jsx)(Ir.p,{allowSelectionWithin:!1,children:(0,kt.jsxs)("div",{style:g.inner,children:[(0,kt.jsx)(Lr,{selectedItemCount:p,collectionsBulkActionsToolbarStore:n}),(0,kt.jsx)(Or,{collectionsBulkActionsToolbarStore:n,selectedItems:u,marginLeft:o,setIsReadyToRender:a,outerContainerRef:s}),(0,kt.jsx)(bt.ZP,{renderTooltip:()=>(0,kt.jsx)("div",{children:ge.default.formatMessage(Ar.delete)}),render:e=>(0,kt.jsx)(Zt.Z,{...e,ariaLabel:ge.default.formatMessage(Ar.delete),icon:()=>(0,kr.y)(g.trashButtonIcon),style:g.trashButton,hoveredStyle:g.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{M.dhV(i,{analyticsName:Pr.RE.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page"}),await Tr.Qw({environment:i,blocks:u})}}),placement:bt.ug.Top}),(0,kt.jsx)(Fr.Z,{store:u[0],fadeIn:!1,style:g.blockActionMenuButton,hoveredStyle:g.blockActionMenuButton,iconStyle:g.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0}})]})})})})})}function Lr(e){window.__c={n:"SelectedItemCountWidget"};const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,i=(0,et.O7)(),r=(0,c.VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),n=(0,c.VK)((()=>r>0?r:o),[r,o]),s=(0,Ht.yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Dr(e)}})),[]);return(0,kt.jsx)(io.Z,{style:s.button,onClick:()=>G.ZH(i),children:(0,kt.jsx)(V.FormattedMessage,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:n}})})}const Er=["title","rollup","formula","button"];function Or(e){window.__c={n:"EditPropertyButtons"};const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:i,marginLeft:n,setIsReadyToRender:s}=e,l=(0,Q.Y$)(),a=(0,c.VK)((()=>l.normalizedSchemaStore.state),[l]),d=(0,r.useRef)(null),u=(0,c.VK)((()=>l.databaseType===p.Fi&&i.some((e=>e.getPropertyValue(wr.C.MeetingNoteToCalendarEventRelation)))),[l,i]),h=(0,c.VK)((()=>{var e;const t=l.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=l.collectionStore();if((0,Ji.LC)(null==t?void 0:t.getModel(),e.property))return!u;const o=a[e.property];return e.visible&&o&&!Er.includes(o.type)&&(0,Yt.Sb)({propertySchema:o,property:e.property,blockStores:i,collectionSchema:a})})))??[]}),[l,a,i,u]).slice(0,6),m=(0,r.useRef)([]),[g,S]=(0,r.useState)(6),[f,v]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{m.current.length>0&&m.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[m]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:i,marginLeft:n,setIsReadyToRender:s,setShowIconsOnly:l,setHiddenButtonsIndex:a}=e;(0,r.useEffect)((()=>{const e=x.Ds((()=>{var e,r,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(r=t.current)||void 0===r?void 0:r.getBoundingClientRect().width)??window.innerWidth)-(n??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,h=d-150;let m=i.current.findIndex((e=>e.rightEdge>h));m=-1!==m?m:6;let g=i.current.findIndex(((e,t)=>p+32*t>h));g=-1!==g?g:6;const S=m<2||u<=450;l(S),a(S?g:m),s(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[n,t,i,o,a,s,l])}({propertyButtonsContainerRef:d,propertyButtonRefs:m,outerContainerRef:t,marginLeft:n,setIsReadyToRender:s,setHiddenButtonsIndex:S,setShowIconsOnly:v}),(0,kt.jsx)("div",{ref:d,style:{display:"flex"},children:h.map(((e,t)=>{var i;let n=null===(i=m.current[t])||void 0===i?void 0:i.element;if(!n){const e=r.createRef();m.current[t]={element:e,rightEdge:0},n=e}const s=t>=g;return(0,kt.jsx)("div",{ref:n,children:(0,kt.jsx)(Nr,{collectionsBulkActionsToolbarStore:o,schema:a,property:e.property,isHidden:s,showIconsOnly:f},e.property)},e.property)}))})}function Nr(e){window.__c={n:"EditPropertyButton"};const{property:t,schema:o,collectionsBulkActionsToolbarStore:i,isHidden:n,showIconsOnly:s}=e,l=(0,Q.Y$)(),a=o[t],d=(0,et.O7)(),u=(0,c.VK)((()=>!(l.permissionScopes.state.canEditContent||"collectionTypedView"===l.contextType)),[l]),p=(0,Ht.yK)((e=>({button:{display:n?"none":"flex",padding:8,...Dr(e)}})),[n]),h=(0,r.useRef)(null),m=(0,c.qz)(void 0,oe.Z),g=(0,r.useCallback)((async e=>{var o,r;if(!h.current)return;const n=eo.default.state.stores;e.stopPropagation(),e.preventDefault();const s=null===(o=h.current)||void 0===o?void 0:o.getBoundingClientRect(),a=n[0].getAssociatedCollectionStore();l&&s&&a&&await Rr.z({environment:d,store:n[0],additionalStores:n.slice(1),property:t,rect:s,format:Si.C.Table,collectionStore:a,blockPropertyValueOverlayStore:ie._H(),collectionContextStore:l,statusSetCheckbox:"checkbox"===(null===(r=l.getPropertyFormat(t))||void 0===r?void 0:r.statusShowAs),mouseStore:m,preventClearSelection:!0,collectionsBulkActionsToolbarStore:i})}),[h,l,d,t,m,i]),S=(0,Ht.Fg)();return a?(0,kt.jsx)(bt.ZP,{renderTooltip:()=>a.name,render:e=>(0,kt.jsx)(io.Z,{...e,ariaLabel:a.name,ref:h,style:p.button,disabled:u,onClick:g,children:(0,kt.jsx)(_r.Z,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:a,hideName:s,showIcon:!0,property:t,iconStyle:{fill:S.regularTextColor}})}),disableTooltip:!s,placement:bt.ug.Top}):null}var zr=o(51774),Hr=o(49670),Gr=o(30806),Wr=o(5933),Kr=o(41358),Ur=o(85740),qr=o(32662),$r=o(5233);function Yr(e){window.__c={n:"CollectionTasksEmptyState"};const t=(0,et.O7)(),o=(0,et.MO)(),i=(0,c.VK)((()=>e.collectionContextStore.collectionStoresStore.state.length>0),[e.collectionContextStore.collectionStoresStore]),n=(0,c.VK)((()=>(0,ue.PI)(e.collectionContextStore)),[e]),s=(0,c.VK)((()=>e.collectionContextStore.isCompactView.state),[e.collectionContextStore]),l=(0,Ht.yK)((e=>({container:{width:"100%",height:s?be.WB-4:void 0,paddingTop:s?void 0:120,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:14,color:e.lightTextColor},desktopInner:{width:800,minWidth:800,padding:32}})),[s]),a=(0,r.useCallback)((()=>i?(0,kt.jsx)(Ur.Z,{isBlue:!0,onClick:o=>{(0,Gr.Aq)({environment:t,from:e.from}),e.onAddTaskClick(o)},icon:e=>(0,y.R)(e),children:n}):o?null:(0,kt.jsx)(Ur.Z,{isBlue:!0,onClick:()=>{(0,Gr.Aq)({environment:t,from:e.from}),Wr.Z.setState(!0)},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[i,o,n,t,e]);return(0,kt.jsxs)("div",{style:l.container,children:[(0,kt.jsx)($r.Z,{from:e.from}),(0,kt.jsx)(Kr.Z,{size:36,emoji:"📋"}),(0,kt.jsx)(qr.Z,{size:16}),(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"All tasks assigned to you will appear here.",id:"tasksEmptyState.noTasks.title"}),(0,kt.jsx)(qr.Z,{size:16}),a()]})}var Qr=o(91496),Xr=o(54281),Jr=o(64815);class en extends d.default{getInitialState(){return{}}}const tn=en;var on=o(61838),rn=o(96310),nn=o(35431),sn=o(92595);class ln extends nn.Z{findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}}const an=new ln;(0,sn.exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",an);var cn=o(20294),dn=o(53465),un=o(55367),pn=o(43350);const hn={position:"absolute",left:0,top:0,zIndex:T.Gt,width:"100%",height:"100%",pointerEvents:"none"};function mn(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+12,o.top=o.top-15)),o):o}function gn(e){window.__c={n:"CollectionTimelineRelationArrow"};const{startItem:t,endItem:o,endRelationPointer:i,timelineState:n,disabled:s,isFullScreen:a,isRootChild:d,relationType:u,isUserDrawnTemp:p,isNewSubitemPlaceholder:h,renderEmitter:m}=e,g=(0,Q.Y$)(),S=(0,et.O7)(),f=(0,cn.k)(),[v,y]=(0,r.useState)(!1),C=(0,Ht.Fg)(),[x,b]=(0,r.useState)(null),[w,k]=(0,r.useState)(null),P=(0,r.useCallback)((e=>{b(e.state)}),[]),R=(0,r.useCallback)((e=>{k(e.state)}),[]),V=(0,r.useCallback)((()=>{l.default.afterNextFlush((()=>{f()}))}),[f]);(0,r.useEffect)((()=>(b(t.stores.node.state),k(o?o.stores.node.state:null),t.stores.node.addListener(P),null==o||o.stores.node.addListener(R),null==m||m.addListener(V),g.filtersBarOpenStore.addListener(V),()=>{t.stores.node.removeListener(P),null==o||o.stores.node.removeListener(R),null==m||m.removeListener(V),g.filtersBarOpenStore.removeListener(V)})),[t,o,m,P,R,V,g.filtersBarOpenStore]);const M=(0,c.VK)((()=>un.ZP.state.isDragging&&un.ZP.state.draggedStores.includes(t.props.store)),[t]),j=(0,c.VK)((()=>o&&un.ZP.state.isDragging&&un.ZP.state.draggedStores.includes(o.props.store)),[o]),F=(0,c.VK)((()=>{const e=un.ZP.state;return e.isDragging?e.currentY-e.startY:0}),[]),I=x&&x.getBoundingClientRect().y+(M?F:0),B=(0,c.VK)((()=>{const e=t.itemPositionStore.state;return I&&e?{left:e.left,right:"subitem"===u?e.left+12:e.right,top:"subitem"===u?I+15:I}:void 0}),[u,t.itemPositionStore,I]),_=w&&w.getBoundingClientRect().y+(j?F:0),D=(0,c.VK)((()=>{const e=_&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:_}:void 0;return"subitem"===u?mn({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,_,u,t.itemPositionStore]),A=(0,c.VK)((()=>t.dateValueStore.state),[t]),Z=(0,c.VK)((()=>null==o?void 0:o.dateValueStore.state),[o]),L=(0,c.VK)((()=>void 0!==n.dragState.state),[n]),E=(0,c.VK)((()=>void 0!==n.drawState.state),[n]),O=(0,c.VK)((()=>n.hoveredItem.state),[n.hoveredItem]),N=v&&!L&&!E,z=(0,r.useCallback)((()=>{i&&!s&&Xr.IL({dependency:{store:t.props.store,relationPointer:i},collectionContextStore:g,environment:S,timelineState:n,isFullScreen:a,isRootChild:d})}),[t,s,i,g,S,n,a,d]),H=(0,r.useCallback)((()=>{y(!0)}),[y]),G=(0,r.useCallback)((()=>{y(!1)}),[y]),W=(0,r.useCallback)((e=>{if(D)return(0,kt.jsx)(Sn,{topOffset:e,endPosition:D,handleCloseButtonClick:z})}),[D,z]),K=O===t.props.store,U=o&&O===o.props.store,q=K||U||N||"subitem"===u?1:.7;let $,Y=!0;"subitem"===u?($=C.collectionUnsetDependencyArrow,Y=!1):A&&Z&&($=A<=Z?C.collectionValidDependencyArrow:C.collectionInvalidDependencyArrow);const X=(0,Ht.yK)((()=>({svgStyle:{zIndex:N||U?T.Gt:T.wx}})),[N,U]);return B?p?(0,kt.jsx)(fn,{startPosition:B,timelineState:n}):h?(0,kt.jsx)(vn,{startPosition:B,timelineState:n}):t!==o&&D?(0,kt.jsx)(yn,{startPosition:B,endPosition:D,strokeOpacity:q,strokeColorOverride:$,svgStyle:X.svgStyle,cornerRadiusOverride:"subitem"===u?8:void 0,relationType:u,handleMouseMove:H,handleMouseLeave:G,renderChildren:Y&&N?W:void 0}):null:null}function Sn(e){window.__c={n:"RemoveDependencyButton"};const{topOffset:t,endPosition:o,handleCloseButtonClick:i}=e,r=(0,Ht.yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:i,children:(0,dn.X)(r.icon)})})}function fn(e){window.__c={n:"UserDrawnTempDependencyArrow"};const{startPosition:t,timelineState:o}=e,i=(0,c.VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return i?(0,kt.jsx)(yn,{startPosition:t,endPosition:i,strokeOpacity:1,relationType:"dependency"}):null}function vn(e){var t;window.__c={n:"NewSubitemPlaceholderArrow"};const{startPosition:o,timelineState:i}=e,r=(0,Ht.Fg)(),n=(0,c.VK)((()=>i.dateRangePlaceholder.state),[i.dateRangePlaceholder]),s=(0,c.VK)((()=>null!=n&&n.active?n.date:void 0),[n]),l=null!=n&&n.active?null===(t=n.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=l?l[l.length-1].children.length:0,d=o.top+33*a+15+5,u=(0,c.VK)((()=>{const e=(0,de.HZ)({timelineState:i,dateValue:s,placeholderDate:s,subitemPlaceholderDate:void 0}),t=d&&e?{...e,top:d}:void 0;return mn({startItemPosition:o,value:t})}),[s,d,o,i]);return u?(0,kt.jsx)(yn,{startPosition:o,endPosition:u,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function yn(e){window.__c={n:"RelationArrowBase"};const{startPosition:t,endPosition:o,strokeColorOverride:i,cornerRadiusOverride:n,strokeOpacity:s,relationType:l,svgStyle:a,handleMouseMove:d,handleMouseLeave:u}=e,p=(0,Q.Y$)(),h=(0,Ht.Fg)(),[m,g]=(0,r.useState)(0),S=t.right,f=t.top+15-m,v=o.left-3,y=o.top+15-m,C=(0,c.VK)((()=>{if(i)return i;return(0,de.H5)(p)&&t.right&&o.left?t.right<o.left?h.collectionValidDependencyArrow:h.collectionInvalidDependencyArrow:h.collectionUnsetDependencyArrow}),[p,o.left,t.right,i,h]);return(0,kt.jsx)("svg",{style:{...hn,...a},ref:e=>{e&&g(e.getBoundingClientRect().top)},children:(0,kt.jsx)(pn.Z,{startPoint:{x:S,y:f},endPoint:{x:v,y},style:{stroke:C,strokeWidth:de.lf,strokeOpacity:s},useRightAngles:"subitem"===l,showArrowHead:"dependency"===l&&!e.renderChildren,cornerRadiusOverride:n,handleMouseMove:d,handleMouseLeave:u,children:e.renderChildren&&e.renderChildren(m)})})}function Cn(e){window.__c={n:"CollectionTimelineDependenciesOverlay"};const{timelineState:t,disabled:o,isReady:i,isFullScreen:n,isRootChild:s,renderEmitter:l}=e,a=(0,Q.Y$)(),d=(0,r.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),u=(0,c.VK)((()=>a.collectionViewBlockStore()),[a]),p=(0,c.VK)((()=>a.settingsStore.state.open),[a]);if((0,r.useEffect)((()=>{var e;!p&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&d()}),[p,t.drawState,d]),!i||!u)return null;const h=an.findCollectionTimelineViewItems(u);return(0,kt.jsx)(kt.Fragment,{children:h.map((e=>{const{store:i,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,He.Hd)(c):"noGroup";return(0,kt.jsxs)(r.Fragment,{children:[(0,kt.jsx)(xn,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"dependency"},`${i.id}-${d}-${i.key}-dependency`),(0,kt.jsx)(xn,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"subitem"},`${i.id}-${d}-${i.key}-subitem`)]},`${i.id}-${d}-${i.key}`)}))})}function xn(e){window.__c={n:"CollectionTimelineRelationAnnotationItem"};const{startItem:t,timelineState:o,disabled:i,isFullScreen:n,isRootChild:s,relationType:l,renderEmitter:a}=e,{store:d,schema:u}=t.props,p=(0,Q.Y$)(),h=(0,c.VK)((()=>"dependency"===l?o.drawState.state:void 0),[o.drawState,l]),m=(0,c.VK)((()=>(null==h?void 0:h.startStore)===d),[d,h]),g=(0,c.VK)((()=>m&&!(null!=h&&h.tryToCompleteDrawnArrow)),[h,m]),S=(0,c.VK)((()=>{if("dependency"===l)return m&&h?h.temporaryDependencyRelationPointers:(0,de.YE)(p,d,u);if("subitem"===l){return Fe.default.checkGate("collection_level_subitems_setting")?(0,de.ph)(p,d,u):(0,de.WD)(p,d,u)}return[]}),[l,m,h,p,d,u]),f=(0,c.VK)((()=>p.collectionViewBlockStore()),[p]),v=(0,c.VK)((()=>{var e;const i=o.dateRangePlaceholder.state;if("subitem"!==l||null==i||!i.active||!i.newTimelineItemProps)return;const r=i.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?i:void 0}),[l,t.props.store,o.dateRangePlaceholder]);if(!f)return null;const y=an.findCollectionTimelineViewItems(f);return(0,kt.jsxs)(kt.Fragment,{children:[S.map((e=>{if(d.id===e.id)return null;const c=y.filter((t=>t.props.store.id===e.id));return(0,kt.jsx)(r.Fragment,{children:c.map((r=>{const c=r.props.store,d=r.props.groupFormat;return(0,kt.jsx)(gn,{startItem:t,endItem:r,endRelationPointer:e,timelineState:o,disabled:i,isFullScreen:n,isRootChild:s,renderEmitter:a,relationType:l},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===l&&g&&(0,kt.jsx)(gn,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"dependency"}),"subitem"===l&&v&&(0,kt.jsx)(gn,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"subitem"})]})}var bn=o(7525),wn=o(42853),kn=o(36488);const Pn=function(e){let{zoomLevel:t,onChange:o}=e;window.__c={n:"CollectionTimelineViewZoomLevelButtonPopup"};const i=(0,Ht.Fg)(),r=(0,et.O7)(),{device:n}=r;return(0,kt.jsx)(gt.ZP,{popupType:n.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,renderOrigin:e=>(0,kt.jsxs)(yt.Z,{isSmall:!0,isGray:!0,...e,children:[(0,kt.jsx)(Rn,{zoomLevel:t}),(0,wn.i)({width:10,marginLeft:4,fill:i.mediumIconColor})]}),originGap:8,render:e=>(0,kt.jsx)(Tn,{parent:e,zoomLevel:t,onChange:o})})};function Rn(e){let{zoomLevel:t}=e;return"hours"===t?(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,yr.t1)(t)}function Tn(e){let{parent:t,zoomLevel:o,onChange:i}=e;window.__c={n:"ZoomLevelMenuComponent"};const r=(0,et.O7)(),{device:n}=r,s=[{key:"calendar by section",render:e=>(0,kt.jsx)(xt.Z,{...e}),items:di.H.map((e=>({key:e,render:t=>(0,kt.jsx)(mt.Z,{...t,title:(0,kt.jsx)(Rn,{zoomLevel:e})}),action:()=>{i(e),t.close()}})))}];return(0,kt.jsx)(kn.Z,{capture:!0,allowEsc:!0,render:e=>{let i;return i=n.isMobile?{menuType:ct.og.Modal,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,kt.jsx)(vt.DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:ct.og.Popup,width:180,...e},(0,kt.jsx)(St.Z,{...i,children:(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,sections:s,initialFocus:di.H.indexOf(o)})})}})}class Vn extends s.Z{constructor(){super(...arguments),this.currentScrolledSecondaryDisplayUnitStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,paddingLeft:o,showTable:r,isFullScreen:n}=this.props,s=e.zoomLevel.state,{primaryDisplayUnit:l,secondaryDisplayUnit:a}=de.BJ[s],c=e.scrollLeft.state,{startTimestamp:d}=e.currentRange.state;if(void 0!==c){const e=d+(0,de.x2)(s,c+t+(!r&&n?o:0));return(0,de.DS)(i.ou.fromMillis(e),l).startOf(a).valueOf()}}))}renderComponent(){var e;const{timelineState:t,showTable:o,isFullScreen:i,isRootChild:r,isReady:n,collectionContextStore:s,isInPeekRenderer:l}=this.props,{device:a}=this.environment,c=t.zoomLevel.state,{secondaryDisplayUnit:d}=de.BJ[c],u=this.currentScrolledSecondaryDisplayUnitStore.state,p=(0,de.d$)({environment:this.environment,isFullScreen:i,isRootChild:r}),h=s.permissionScopes.state,m=!o&&p&&h.canConfigureBlock,g=(null===(e=s.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(l?this.theme.cardContentBackground:this.theme.contentBackground),S=l?this.theme.cardContentBackgroundTransparent:this.theme.contentBackgroundTransparent;return(0,kt.jsx)(Bo.Z,{position:Je.Z.Top,children:(0,kt.jsxs)("div",{style:Fn(this.props.timelineState),children:[u&&(0,kt.jsxs)("div",{style:In(this.props.scrollerLeftOffset,this.props.paddingLeft,this.props.isFullScreen,this.props.showTable,g,this.environment),children:[m&&(0,kt.jsx)(bt.ZP,{render:e=>(0,kt.jsx)(yt.Z,{isSmall:!0,onClick:()=>function(e,t,o,i,r,n){const s=i.collectionViewStore();if(!s)return;U.createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,perform:e=>{const o=(0,de.YP)(t,!0);Ke.FH({stores:[s],update:o,transaction:e})}}),M.CBn(e,{...(0,de.Ii)({environment:e,collectionContextStore:i,timelineState:o,isFullScreen:r,isRootChild:n}),show:!0})}(this.environment,this.props.format,this.props.timelineState,this.props.collectionContextStore,this.props.isFullScreen,this.props.isRootChild),style:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:a.isIOS?0:1,height:22,fill:this.theme.lightIconColor},...e,children:(0,bn.t)({width:14})}),renderTooltip:()=>(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,kt.jsx)("span",{style:{paddingLeft:m||this.environment.device.isPhone?0:i||o?16:2},children:(0,de.qG)(u,d)}),!n&&!o&&(0,kt.jsx)(jn,{}),(0,kt.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${g} 20%, ${S} 100%)`}})]}),(0,kt.jsxs)("div",{style:Bn(this.props.paddingRight,g),children:[(0,kt.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${g} 20%, ${S} 100%)`}}),(0,kt.jsx)(ni,{collectionContextStore:s}),(0,kt.jsx)(Pn,{zoomLevel:c,onChange:e=>function(e,t,o,i,r,n){Xr.Nf({timelineState:o,environment:t,zoomLevel:e,centerTimestamp:(0,de.al)(o)}),M.zIF(t,(0,de.Ii)({environment:t,collectionContextStore:i,timelineState:o,isFullScreen:r,isRootChild:n}))}(e,this.environment,this.props.timelineState,this.props.collectionContextStore,this.props.isFullScreen,this.props.isRootChild)}),(0,kt.jsx)(yt.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,i,r,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,de.xI)({environment:e,paddingLeft:o,format:i,isFullScreen:r,isRootChild:n}),d=(a-c)/2,u=(0,de.al)(t)-(0,de.x2)(l,d);Xr.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:u}),M.Al4(e,{...(0,de.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:r,isRootChild:n}),type:"left"})}(this.environment,this.props.timelineState,this.props.paddingLeft,this.props.format,this.props.isFullScreen,this.props.isRootChild,this.props.collectionContextStore),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,$o.f)({width:12,fill:this.theme.mediumIconColor})}),(0,kt.jsx)(yt.Z,{isSmall:!0,onClick:()=>function(e,t,o,i,r,n,s){const l=t.zoomLevel.state,a=(0,de.bK)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:i});Xr.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:a}),M.H6t(e,(0,de.Ii)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:n,isRootChild:s}))}(this.environment,this.props.timelineState,this.props.paddingLeft,this.props.format,this.props.collectionContextStore,this.props.isFullScreen,this.props.isRootChild),children:(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,kt.jsx)(yt.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,i,r,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,de.xI)({environment:e,paddingLeft:o,format:i,isFullScreen:r,isRootChild:n}),d=(a-c)/2,u=(0,de.al)(t)+(0,de.x2)(l,d);Xr.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:u}),M.Al4(e,{...(0,de.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:r,isRootChild:n}),type:"right"})}(this.environment,this.props.timelineState,this.props.paddingLeft,this.props.format,this.props.isFullScreen,this.props.isRootChild,this.props.collectionContextStore),style:{paddingLeft:4,paddingRight:4},children:(0,Yo.o)({width:12,fill:this.theme.mediumIconColor})})]})]})})}}Vn.displayName="CollectionTimelineViewControlBar";const Mn=Vn;function jn(){return(0,kt.jsx)(te.Z,{show:!0,showDelay:400,showHold:0,render:e=>e?(0,kt.jsx)(no.Z,{style:{marginLeft:8,marginTop:1}}):void 0})}function Fn(e){const{outerSizeObserver:t}=e;return{position:"sticky",left:0,width:t.rect.state.width,zIndex:T.Qm,height:0}}function In(e,t,o,i,r,n){return{position:"absolute",top:1,left:0,paddingLeft:o&&!i?e+t:e,display:"flex",alignItems:"center",height:32,paddingTop:6+(n.device.isMobile?2:0),background:r,fontSize:14,fontWeight:R.Z.fontWeight.medium}}function Bn(e,t){return{position:"absolute",top:1,right:0,paddingRight:e,display:"flex",alignItems:"center",height:32,paddingTop:7,background:t}}var _n=o(97439);const Dn=function(e){let{isGrouped:t,format:o,collectionContextStore:i,isFullScreen:r,isRootChild:n,timelineState:s}=e;window.__c={n:"CollectionTimelineViewHideTableButton"};const l=(0,Ht.Fg)(),a=(0,et.O7)(),{device:c}=a;return(0,kt.jsx)(bt.ZP,{render:e=>(0,kt.jsx)(yt.Z,{isSmall:!0,onClick:()=>function(e,t,o,i,r,n){const s=o.collectionViewStore();if(!s)return;U.createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,perform:e=>{const o=(0,de.YP)(t,!1);Ke.FH({stores:[s],update:o,transaction:e})}}),M.CBn(e,{...(0,de.Ii)({environment:e,collectionContextStore:o,timelineState:n,isFullScreen:i,isRootChild:r}),show:!1})}(a,o,i,r,n,s),style:{position:"absolute",top:t?c.isIOS?3:4:c.isIOS?7:8,right:t?6:8,zIndex:T.MC,fill:l.lightIconColor},...e,children:(0,_n.D)({width:14})}),renderTooltip:()=>(0,kt.jsx)(V.FormattedMessage,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};var An=o(24211),Zn=o(34232);function Ln(e){window.__c={n:"TimelineShimmerWrapper"};const{shouldShowShimmer:t,children:o}=e,i=(0,Zn.Z)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,kt.jsx)("div",{className:i,style:{height:"100%"},children:o})}const En=22,On=32;class Nn extends s.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()},this.activeRangeStore=this.createComputedStore((()=>{const{collectionContextStore:e,timelineState:t,query:o,schema:i,intl:r}=this.props,n=e.collectionStore();if(!n)return;const s=t.dragState.state,l=t.zoomLevel.state,a=t.hoveredItem.state,c=t.dateRangePlaceholder.state,{activeRangeType:d}=de.BJ[l];if(!d)return;let u;if(s)u=s.temporaryValues.map((e=>(0,de.XO)(e,"day")));else if(c.active)u=[(0,de.XO)(c.date,"day")];else{const{stores:t}=eo.default.state,s=t.filter((e=>e.getParentCollectionId()===n.id)),l=x.jj(x.oA([...s,a]));u=x.oA(l.map((t=>{const n=(0,de.bk)({store:t,query:o,schema:i,userId:e.getCurrentUserId(),intl:r});if(n)return(0,de.XO)(n,"day")})))}const p=x.F(u,(e=>{let{start:t}=e;return t.valueOf()})),h=x.UT(u,(e=>{let{end:t}=e;return t.valueOf()}));return p&&h?{start:p.start.valueOf(),end:h.end.valueOf()}:void 0}),!0)}UNSAFE_willMount(e){super.UNSAFE_willMount(e)}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){const{collectionContextStore:e,timelineState:t}=this.props,o=t.zoomLevel.state,r=de.BJ[o],{primaryDisplayUnit:n,activeRangeType:s}=r,l=(0,de.ST)(n),a=i.ou.now(),c=l?a.startOf("minute"):a.startOf("day"),d=a.startOf("minute"),{device:u}=this.environment,p=!e.groupsStore.anyGroupHasNonEmptyResults()&&(0,Qe.H0)({collectionContextStore:e,groupsPointer:[],hasPartialResults:!1});return(0,kt.jsx)(Bo.Z,{position:Je.Z.Top,children:(0,kt.jsxs)("div",{style:Wn(this.props.collectionContextStore,this.props.isInPeekRenderer,this.theme),children:[(0,kt.jsx)("div",{style:{height:32,position:"relative",overflow:"hidden"},children:!u.isPhone&&(0,kt.jsx)(es,{timelineState:this.props.timelineState})}),(0,kt.jsxs)("div",{style:{height:On,position:"relative",overflow:"hidden"},children:[(0,kt.jsx)(Ln,{shouldShowShimmer:p,children:(0,kt.jsx)(Jn,{timelineState:this.props.timelineState,nowTimeStartOfPrimaryDisplayUnit:c})}),"highlight_days"===s&&this.renderActiveRange(),(0,kt.jsx)(ts,{timelineState:this.props.timelineState,time:c}),"display_range"===s&&this.renderActiveRange()]}),(0,kt.jsx)($n,{timelineState:this.props.timelineState,time:d})]})})}renderActiveRange(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state,n=de.BJ[t],{activeRangeType:s}=n,l=this.activeRangeStore.state;if(l){const e=(0,de.DS)(i.ou.fromMillis(l.start),"day"),n=(0,de.e$)(t,e.valueOf()-o);if("highlight_days"===s){const s=[];let a=i.ou.fromMillis(Math.max(e.valueOf(),(0,de.DS)(i.ou.fromMillis(o),"day").valueOf()));for(;a.valueOf()<l.end&&a.valueOf()<r;){s.push(a);a=(0,de.Ip)(a,"day")}const c=(0,de.e$)(t,a.valueOf()-o)-n+8,d=s.map(((e,t)=>(0,kt.jsx)(qn,{timelineState:this.props.timelineState,time:e,accent:0===t||t===s.length-1},`${e.toString()}-${t}`)));return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{style:{position:"absolute",top:0,left:n-4,width:c,marginTop:3,height:En,background:this.theme.timelineDarkerBackground,borderRadius:11}}),d]})}{const r=(0,de.DS)(i.ou.fromMillis(l.end),"day"),s=(0,de.cK)(i.ou.fromMillis(l.end),"day"),a=(0,de.e$)(t,r.valueOf()-o)-n+8;return(0,kt.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:n-4,minWidth:a,marginTop:3,height:En,background:this.theme.timelineDarkerBackground,borderRadius:11,paddingLeft:6,paddingRight:6},children:(0,kt.jsx)(Qn,{start:e,end:e.valueOf()!==s.valueOf()?s:void 0,rangeWidth:a})})}}}}Nn.displayName="CollectionTimelineViewTimeBar";const zn=(0,V.injectIntl)(Nn);function Hn(e,t,o){const i=o.zoomLevel.state,{startTimestamp:r}=o.currentRange.state,{primaryDisplayUnit:n,primaryDisplayUnitAlignment:s}=de.BJ[i],l=(0,de.DS)(e,n),a=(0,de.Ip)(e,n),c=(0,de.e$)(i,l.valueOf()-r),d=(0,de.e$)(i,e.valueOf()-r),u=(0,de.e$)(i,a.valueOf()-r)-c,p=t?4:0;return{left:("range_start"===s?d-u/2:d)-p,width:u+2*p}}function Gn(e,t,o,i,r){const n=e.setLocale(Ho.SP),s=(0,de.xJ)(),l=i?r.regularTextColor:r.lightTextColor,a=i?r.regularTextColor:r.mediumTextColor,c=i?r.mediumTextColor:r.lightTextColor,d=n.toFormat("t").startsWith(n.toFormat("a"));if("fifteen_minutes"===o){if(s)return(0,kt.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,kt.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h:mm")}),t=(0,kt.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,kt.jsxs)(kt.Fragment,{children:[t,e]}):(0,kt.jsxs)(kt.Fragment,{children:[e,t]})}}if("hour"===o){if(s)return(0,kt.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,kt.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h")}),t=(0,kt.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,kt.jsxs)(kt.Fragment,{children:[t,e]}):(0,kt.jsxs)(kt.Fragment,{children:[e,t]})}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{style:{color:c,paddingRight:3},children:n.toFormat("ccccc")}),(0,kt.jsx)("span",{style:{color:a,padding:"2px 7px"},children:n.toFormat("d")})]}):(0,kt.jsx)("span",{style:{color:l},children:n.toFormat("d")});(0,yr.t1)(o)}function Wn(e,t,o){var i;return{position:"absolute",left:0,top:0,width:"100%",background:(null===(i=e.inheritedBlockColorStore.state)||void 0===i?void 0:i.background)||(t?o.cardContentBackground:o.contentBackground),borderTop:e.viewIsFlushToTopbar()?`1px solid ${o.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${o.tableDividerColor}`}}function Kn(e){return{color:e.regularTextColor,fontSize:12}}function Un(e){return{background:e.timelineRed,width:22,height:22,borderRadius:11,position:"absolute",left:"calc(50% - 11px)",top:"calc(50% - 11px)"}}function qn(e){let{time:t,accent:o,timelineState:i}=e;window.__c={n:"PrimaryIndicatorComponent"};const r=(0,Ht.Fg)(),n=(0,c.VK)((()=>i.zoomLevel.state),[i]),{primaryDisplayUnit:s}=de.BJ[n],{left:l,width:a}=(0,c.VK)((()=>Hn(t,!1,i)),[t,i]);return(0,kt.jsx)("div",{style:{position:"absolute",top:0,left:l,width:a,height:28,display:"flex",alignItems:"start",lineHeight:"28px"},children:(0,kt.jsx)("div",{style:{fontSize:12,margin:"0 auto"},children:Gn(t,n,s,o,r)})})}function $n(e){let{time:t,timelineState:o}=e;window.__c={n:"NowCircleComponent"};const i=(0,Ht.Fg)(),r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,c.VK)((()=>o.currentRange.state),[o]),s=Math.floor((0,de.e$)(r,t.valueOf()-n));return(0,kt.jsx)("div",{style:{position:"absolute",left:s-3.5+.5,top:Math.floor(61),width:7,height:7,background:i.timelineRed,borderRadius:"100%"}})}function Yn(e){let{time:t,timelineState:o,intl:i}=e;window.__c={n:"SecondaryIndicatorComponent"};const r=(0,Ht.Fg)(),n=(0,et.O7)(),s=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:l}=(0,c.VK)((()=>o.currentRange.state),[o]),{secondaryDisplayUnit:a}=de.BJ[s],d=(0,de.e$)(s,t.valueOf()-l);return(0,kt.jsx)("div",{style:{position:"absolute",top:0,left:d,height:On,color:r.regularTextColor,fontSize:14,fontWeight:R.Z.fontWeight.medium,verticalAlign:"middle",paddingTop:6+(n.device.isMobile?2:0),display:"flex",alignItems:"center"},children:(0,de.EW)((0,An.E2)(i),t.valueOf(),a)},d)}function Qn(e){let{start:t,end:o,rangeWidth:i}=e;window.__c={n:"ActiveDisplayRangeIndicatorComponent"};const r=(0,Ht.Fg)();return t&&o?i>=110?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{style:Kn(r),children:(0,Uo.Yx)(t.valueOf(),"month_day",Ho.SP)}),(0,kt.jsx)("div",{style:{flexGrow:1}}),(0,kt.jsx)("div",{style:Kn(r),children:(0,Uo.Yx)(o.valueOf(),"month_day",Ho.SP)})]}):(0,kt.jsxs)("div",{style:Kn(r),children:[(0,Uo.Yx)(t.valueOf(),"month_day",Ho.SP)," – ",t.month===o.month?(0,Uo.Yx)(o.valueOf(),"day",Ho.SP):(0,Uo.Yx)(o.valueOf(),"month_day",Ho.SP)]}):(0,kt.jsx)("div",{style:Kn(r),children:(0,Uo.Yx)(t.valueOf(),"month_day",Ho.SP)})}function Xn(e,t,o,i){const r=e.setLocale(Ho.SP),n=(0,de.ST)(o),s=(0,de.xJ)();return n?s?(0,kt.jsx)("span",{style:{color:i.timelineRed},children:r.toFormat("H:mm")}):(0,kt.jsx)("span",{style:{color:i.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{style:{color:i.lightTextColor,paddingRight:3},children:r.toFormat("ccccc")}),(0,kt.jsxs)("div",{style:{position:"relative"},children:[(0,kt.jsx)("div",{style:Un(i)}),(0,kt.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,kt.jsxs)("div",{style:{position:"relative"},children:[(0,kt.jsx)("div",{style:Un(i)}),(0,kt.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function Jn(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;window.__c={n:"PrimaryIndicatorsComponent"};const r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n,endTimestamp:s}=(0,c.VK)((()=>o.currentRange.state),[o]),l=de.BJ[r],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:d}=l,u=d||0,p=(0,c.VK)((()=>Hn(t,!1,o)),[t,o]),h=p.left+u,m=p.left+p.width-u,g=[];let S=(0,de.DS)(i.ou.fromMillis(n),a);const f=(0,c.VK)((()=>Hn(S,!1,o)),[S,o]);for(;S.valueOf()<s;){const e=f.left+u,t=f.left+f.width-u;void 0!==d&&(h>=e&&h<=t||m>=e&&m<=t)||g.push((0,kt.jsx)(qn,{timelineState:o,time:S,accent:!1}));const i=(0,de.Ip)(S,a);S=i}return(0,kt.jsx)(kt.Fragment,{children:g})}function es(e){let{timelineState:t}=e;window.__c={n:"SecondaryIndicatorsComponent"};const o=(0,V.useIntl)(),r=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:n,endTimestamp:s}=(0,c.VK)((()=>t.currentRange.state),[t]),l=de.BJ[r],{primaryDisplayUnit:a,secondaryDisplayUnit:d}=l,u=[];let p=(0,de.DS)(i.ou.fromMillis(n),d);for(;p.valueOf()<s;){u.push((0,kt.jsx)(Yn,{timelineState:t,intl:o,time:p}));const e=(0,de.Ip)(p,d);p=(0,de.xP)(e,a)}return(0,kt.jsx)(kt.Fragment,{children:u})}function ts(e){let{time:t,timelineState:o}=e;window.__c={n:"NowIndicatorComponent"};const i=(0,Ht.Fg)(),r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{primaryDisplayUnit:n}=de.BJ[r],{left:s,width:l}=(0,c.VK)((()=>Hn(t,!0,o)),[t,o]);return(0,kt.jsx)("div",{style:{position:"absolute",top:0,left:s,width:l,height:28,display:"flex",alignItems:"center",fontWeight:500},children:(0,kt.jsx)("div",{style:{fontSize:12,margin:"0 auto",display:"flex"},children:Xn(t,r,n,i)})},s)}var os=o(40745),is=o(95371),rs=o(51365),ns=o(1742),ss=o(77181),ls=o(73959),as=o(40150),cs=o(60503),ds=o(44043),us=o(29376),ps=o(4023),hs=o(97180),ms=o(3072);function gs(e){window.__c={n:"TableAggregation"};const{disabled:t,property:o,schema:i,collectionContextStore:n,groupFormat:s,isHovered:l,aggregation:a,onChange:d}=e,u=(0,et.O7)(),p=(0,V.useIntl)(),{isMobile:h}=(0,et.Fy)(),[m,g]=(0,r.useState)(void 0),S=(0,c.VK)((()=>{if(!a)return;return{type:"aggregation",filter:s?(0,rt.zk)({schema:i,group:s,timeZone:(0,nt.r)()}):void 0,aggregation:a}}),[i,s,a]),f=(0,r.useCallback)((e=>{if(e){const t={aggregator:e,property:o};d(o,t),g(t),M.wds(u,{view_type:"table",action:"table_change_aggregation"}),st.j({name:"collection_change_aggregation"})}else d(o,void 0),M.wds(u,{view_type:"table",action:"table_remove_aggregation"})}),[u,d,o]),v=(0,Ht.yK)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto"}})),[]),y=(0,c.VK)((()=>(0,pt.u)(n,a)),[n,a]);return(0,r.useEffect)((()=>{m&&!(0,pt.u)(n,m)&&(0,x.Xy)(a,m)&&g(void 0)}),[y,m,n,a]),(0,kt.jsx)(gt.ZP,{popupType:h?gt.Z4.SlideUp:gt.Z4.Popup,disabled:t,renderOrigin:e=>S?(0,kt.jsx)(ut.Z,{id:`table:${(0,He.mD)(s)}:${o}:${S.aggregation.aggregator}`,collectionContextStore:n,reducer:S,groupsPointer:s?[s]:void 0,render:r=>(0,kt.jsx)(bt.ZP,{alignment:ps.v.End,disableTooltip:!y,renderTooltip:()=>p.formatMessage(ht.Z.aggregationCalculating),render:n=>(0,kt.jsx)(io.Z,{disabled:t,style:v.buttonStyle,...(0,dt.Z)(n,e),children:(0,kt.jsx)(Ss,{resultStore:r,aggregation:a,schema:i,property:o})})})}):(0,kt.jsx)(io.Z,{disabled:t,style:v.buttonStyle,...e,children:(0,kt.jsx)(fs,{disabled:t,isHovered:l})}),render:e=>{let{close:t}=e;return(0,kt.jsx)(ms.Z,{property:o,schema:i,onChange:f,onClose:t,source:"tableAggregation"})}})}function Ss(e){window.__c={n:"TableAggregationButtonContent"};const{aggregation:t,resultStore:o,schema:i,property:n}=e,s=(0,Q.Y$)(),l=(0,Ht.yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%",fontSize:14},aggregationTypeNameStyle:{fontSize:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}})),[]),a=(0,c.VK)((()=>o.state),[o]),d=(0,r.useMemo)((()=>{if(!t)return;let e=at.v6[(0,it.OV)(t)];return(0,it.en)(t.aggregator)&&(e=t.aggregator.groupName in hs.ZA?hs.ZA[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),u=i[n],p=(0,c.VK)((()=>{if(u&&("formula"===u.type||"number"===u.type))return u.number_format;if("rollup"===(null==u?void 0:u.type)&&u.relation_property&&u.target_property&&"number"===u.target_property_type){if(i[u.relation_property]){var e;const t=(0,us.ny)(s,i[u.relation_property]),o=null==t||null===(e=t.getModel())||void 0===e?void 0:e.getNormalizedSchema(),r=null==o?void 0:o[u.target_property];if("number"===(null==r?void 0:r.type))return r.number_format}}}),[u,i,s]);return d?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{style:l.aggregationTypeNameStyle,children:d},"type"),(0,kt.jsx)("span",{style:l.valueStyle,children:t&&(0,kt.jsx)(pt.Z,{aggregation:t,collectionContextStore:s,children:a?(0,at.Ol)({numberFormat:p,dateFormat:void 0,aggregationType:t.aggregator,value:null==a?void 0:a.aggregationResult,userTimeZone:(0,nt.r)(),roundDecimal:5}):void 0})},"value")]}):null}function fs(e){let{disabled:t,isHovered:o}=e;window.__c={n:"TableAggregationCalculatePlaceholder"};const i=(0,Ht.yK)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{marginBottom:2,color:e.lightTextColor},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),{isMobile:r}=(0,et.Fy)();return t||!o&&!r?null:(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>(0,kt.jsxs)("div",{style:i.placeholderWrapper,children:[(0,kt.jsx)("span",{style:i.placeholderText,children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,wn.i)(i.chevronIcon)]})})}class vs extends s.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:oe.Z},this.renderAggregation=(e,t)=>{var o;const{schema:i,disabled:r,collectionContextStore:n,showHoverActionsStore:s,groupFormat:l,query:a}=this.props,{mouseEntered:c}=this.stores.mouseStore.state,d=(0,ue.fk)({environment:this.environment,collectionContextStore:n});return(0,kt.jsx)("div",{style:{display:"flex",width:void 0!==e.width?e.width+(0===t&&d?as.Xx:0):void 0},children:(0,kt.jsx)(gs,{groupFormat:l,disabled:r,isHovered:(c||0===t&&!l&&s.state)&&!r,aggregation:null===(o=a.aggregations)||void 0===o?void 0:o.find((t=>t.property===e.property)),property:e.property,collectionContextStore:n,schema:i,onChange:(e,t)=>function(e,t,o,i,r){const n=o.collectionViewStore();if(!n)return;let s=i.aggregations?[...i.aggregations]:[];const l=(i.aggregations||[]).findIndex((t=>t.property===e));s=l<0?x.oA([...s,t]):x.oA(s.map(((e,o)=>l===o?t:e)));const a={...i,aggregations:s};o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:t,changingType:!0});U.createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:r,perform:e=>{Z.iG({collectionViewStore:n,update:{query2:a},transaction:e})}})}(e,t,this.props.collectionContextStore,this.props.query,this.environment)})},e.property)},this.handleAggregationRowEnter=()=>{this.stores.mouseStore.enter()},this.handleAggregationRowLeave=()=>{this.stores.mouseStore.exit()},this.frozenIndex=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.frozoneStore.state.frozenIndex})),this.aggregationsRowStyle=this.createComputedStore((()=>{var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{display:"flex",position:"absolute",background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),zIndex:T.RJ,fontSize:14,height:Ma+(this.props.isFullScreen?Te.Z.state:0)+1,minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,...this.props.style}}))}renderComponent(){const{showPropertyFormatsStore:e,collectionContextStore:t}=this.props,o=e.state,i=(0,ue.bW)(this.frozenIndex.state),[r,n]=void 0!==this.frozenIndex.state?[o.slice(0,i),o.slice(i)]:[[],o];return(0,kt.jsx)(Bo.Z,{position:Je.Z.Bottom,children:(0,kt.jsx)(Ir.p,{allowSelectionWithin:!1,style:this.aggregationsRowStyle.state,onMouseMove:this.handleAggregationRowEnter,onMouseLeave:this.handleAggregationRowLeave,onMouseDown:Cs,children:(0,kt.jsx)("div",{style:{display:"flex",paddingRight:!this.props.disabled&&this.props.showRightActionsSpacer?32:0},children:(0,kt.jsxs)("div",{style:{display:"flex"},children:[void 0!==this.frozenIndex.state&&(0,kt.jsx)("div",{style:{...(0,as.oc)({environment:this.environment,collectionContextStore:t,isPhone:this.environment.device.isPhone,theme:this.theme}),display:"flex"},children:r.map(this.renderAggregation)}),n.map(((e,t)=>this.renderAggregation(e,t+i)))]})})})})}}vs.displayName="TableAggregationRow";const ys=vs;function Cs(e){(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{}})}function xs(e){window.__c={n:"TableEmptyPlaceholder"};const{collectionContextStore:t,shouldShowAddRowButton:o,paddingLeft:i,handleAddRowClick:r}=e,n=(0,c.VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),s=(0,Ht.yK)((e=>({button:{display:"flex",alignItems:"center",height:Va+1,width:"100%",paddingLeft:ja,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:e.contentBackground,left:0,right:0,textAlign:"center",borderBottom:`1px solid ${e.tableDividerColor}`},buttonInner:{color:e.lightTextColor,position:"sticky",left:i+ja}})),[i]);return(0,kt.jsx)(io.Z,{className:re.Gcz,onClick:r,onMouseDown:me.$0,disabled:!o,style:s.button,children:o?(0,kt.jsx)("span",{style:s.buttonInner,children:n?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,kt.jsx)("span",{style:s.buttonInner,children:n?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})}var bs=o(46283),ws=o(87085),ks=o(73060);class Ps extends d.default{getInitialState(){return{}}}const Rs=Ps;var Ts=o(25962),Vs=o(84939);function Ms(e){window.__c={n:"FrozenColumnDivider"};const{passesFilter:t,isScrolled:o,isCheckbox:i,isShimmerRow:n}=e,s=(0,r.useCallback)((e=>"dark"===e.mode?"transparent":t?`linear-gradient(to right, ${(0,Vs.Fq)(Wo.se[e.mode].gray,.15)},\n\t\t\t\t${(0,Vs.Fq)(Wo.se[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,Vs.Fq)(Wo.se[e.mode].gray,.35)},\n\t\t\t\t${(0,Vs.Fq)(Wo.se[e.mode].gray,.2)},  transparent)`),[t]),l=(0,Ht.yK)((e=>({border:{position:"absolute",top:-1,right:0,width:2,height:n?35:"calc(100% + 2px)",background:t?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-3,width:3,height:n?34:"100%",background:s(e)}})),[n,t,s]);return(0,kt.jsxs)(kt.Fragment,{children:[i&&!o?null:(0,kt.jsx)("div",{style:l.border}),(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,kt.jsx)("div",{style:l.shadow})})]})}function js(e){window.__c={n:"MultiSelectCheckbox"};const{checkedState:t,onClick:o,checkboxType:i,collectionContextStore:n,passesFilter:s,disabled:l,frozoneProps:a}=e,d=(0,et.O7)(),u=(0,c.qz)(void 0,oe.Z),p=(0,c.VK)((()=>u.state.mouseEntered),[u]),h=(0,r.useRef)(null);(0,r.useEffect)((()=>{h.current&&(h.current.indeterminate="indeterminate"===t)}),[t]);const m=(0,c.VK)((()=>un.ZP.state.isDragging),[]),g=(0,r.useCallback)((e=>{l||(o(e),j.Ac({environment:d,collectionContextStore:n,checkbox_type:i}))}),[l,i,n,d,o]),S=(0,c.VK)((()=>!1===t&&!p||m?null!=a&&a.shouldShowStickyMultiSelectColumn?.4:0:1),[t,m,p,null==a?void 0:a.shouldShowStickyMultiSelectColumn]),f=(0,Ht.yK)((e=>({multiSelectCheckbox:{background:null==a?void 0:a.frozenStyles.background,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=a&&a.isCollectionViewBlockSelected?Wo.ZP.blueWithAlpha(.14):void 0,height:"100%"}})),[null==a?void 0:a.frozenStyles.background,null==a?void 0:a.isCollectionViewBlockSelected]);return(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{opacity:S>0?1:0},render:()=>(0,kt.jsxs)("div",{style:f.multiSelectCheckbox,onMouseEnter:()=>{u.enter()},onMouseLeave:()=>{u.exit()},children:[(0,kt.jsx)("div",{style:f.multiSelectCheckboxInner,children:(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{opacity:S},render:()=>(0,kt.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:l?void 0:"pointer",zIndex:1},onClick:me.Wi,onMouseDown:me.$0,children:(0,kt.jsx)("div",{style:{width:`${as.bu}px`,height:as.bu-1+"px",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,kt.jsx)("input",{type:"checkbox",style:{width:as.tA,height:as.tA,cursor:l?void 0:"pointer",position:"relative",right:"2px"},ref:h,checked:!0===t,onChange:g,disabled:l})})})})}),(null==a?void 0:a.shouldFreezeMultiSelectColumn)&&(0,kt.jsx)(Ms,{passesFilter:s,isCheckbox:!0,isScrolled:!0})]})})}var Fs=o(39068),Is=o(79362),Bs=o(8597),_s=o(88437),Ds=o(44643),As=o(21197),Zs=o(44495),Ls=o(16184),Es=o(20669),Os=o(4635),Ns=o(23903),zs=o(79310),Hs=o(59753),Gs=o(4615),Ws=o(40778),Ks=o(16956),Us=o(80402),qs=o(44866),$s=o(34517),Ys=o(43224),Qs=o(19124),Xs=o(67695),Js=o(83212),el=o(30905),tl=o(28530),ol=o(26122),il=o(89211),rl=o(28992),nl=o(74420),sl=o(86825),ll=o(42402);const al={fontSize:14};class cl extends s.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Re.Z,resultStore:d.default.createClass(void 0),isHoveringDescriptionIconStore:d.default.createClass(!1)},this.handleContextMenu=e=>{this.environment.device.isMobile||(e.preventDefault(),(0,me.ZP)({event:e,context:me.Af.EditorContextMenu,callback:()=>{gl(this.environment),this.stores.buttonPopupStore.setState({open:!0})}}))},this.isRightMostFrozenColumn=this.createComputedStore((()=>{const{collectionContextStore:e,columnIndex:t}=this.props;return e.frozoneStore.state.frozenIndex===t})),this.isScrolled=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.frozoneStore.state.isScrolled}))}get registries(){return[Xs.Z]}renderComponent(){const{property:e,schema:t,disabled:o,collectionContextStore:i,renderSpacer:r,paddingTop:n,isLast:s}=this.props,l=t[e],{device:a}=this.environment;if(!l)return;const c=this.stores.isHoveringDescriptionIconStore.state,d=i.permissionScopes.state;return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{style:ml(this.props.width,this.props.disableCellRightBorder,this.theme),className:re.VMO,onContextMenu:this.handleContextMenu,children:(0,kt.jsx)(gt.ZP,{popupType:a.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,disabled:!d.canConfigureBlock,originGap:1,alignmentToOrigin:gt.vR.Start,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:t=>(0,kt.jsx)(bt.ZP,{renderTooltip:e=>{const t=(0,Go.qQ)(l)&&("text"===l.type||(0,Qs.KZ)())&&(0,Go.q3)(l);return(0,kt.jsxs)("div",{...e,style:Ys.F6,children:[(0,kt.jsx)("div",{children:l.name}),void 0!==(null==l?void 0:l.description)&&l.description.length>0?(0,kt.jsx)("div",{style:{color:this.theme.mediumInvertedTextColor},children:l.description}):null,t&&t.auto_update_on_edit&&(0,kt.jsx)("div",{style:{color:this.theme.mediumInvertedTextColor},children:(0,kt.jsx)(V.FormattedMessage,{...il.sY.keptUpToDateWithNotionAITooltip})})]})},delayThreshold:c?0:500,placement:bt.ug.Right,render:i=>{var c;return(0,kt.jsxs)(io.Z,{style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:n},disabled:o,...(0,dt.Z)(i,t),children:[r&&r(s),(0,kt.jsx)(_r.Z,{propertySchema:l,showIcon:!0,badge:(0,kt.jsxs)(kt.Fragment,{children:[!(null===(c=l.description)||void 0===c||!c.length)&&!a.isMobile&&(0,kt.jsx)(tl.Z,{setIsHovered:e=>this.stores.isHoveringDescriptionIconStore.setState(e)}),(0,kt.jsx)(_r.o,{propertySchema:l})]}),style:al,property:e}),this.isRightMostFrozenColumn.state&&(0,kt.jsx)(Ms,{passesFilter:!0,isScrolled:Boolean(this.isScrolled.state)})]})}}),render:e=>(0,kt.jsx)(dl,{...this.props,parent:e}),onClick:()=>gl(this.environment)})})})}}cl.displayName="TableHeaderCell";class dl extends s.Z{constructor(){super(...arguments),this.storeTypes={propertyTypeButtonPopupStore:Re.Z,inputStore:d.default.createClass("")},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,i=o.collectionStore();if(!i)return;const r=i.getSchema()[t];(null==r?void 0:r.name)!==e&&(U.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:this.environment,perform:o=>{Ks.Bv({collectionStore:i,property:t,name:e,transaction:o})}}),j.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.isRightmostFrozen=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.frozoneStore.state.frozenIndex;return Boolean(this.props.columnIndex===t)})),this.canFreezeThisColumn=this.createComputedStore((()=>{const{collectionContextStore:e,columnIndex:t}=this.props,{frozenIndex:o,scrollerWidth:i}=e.frozoneStore.state,r=this.props.collectionContextStore.collectionViewStore();if(void 0===o)return!1;return t>((null==r?void 0:r.getTableMaxFrozenColumnIndex(i,e.normalizedFormatStore.state))??-1)}))}UNSAFE_willMountOrUpdate(e){const{property:t,schema:o,collectionContextStore:i}=e,r=o[t];if(r&&"relation"===r.type){const e=us.ny(i,r);null==e||e.load()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:ct.og.ActionSheet}:{menuType:ct.og.Popup,minWidth:220};const o=this.getMenuSections(this.props.parent);return(0,kt.jsx)(St.Z,{...t,children:(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,initialFocus:void 0,sections:x.oA(o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,kt.jsx)(xt.Z,{...e,topBorder:0!==t}),items:e}})))})})}shouldShowDuplicateError(){const{property:e,schema:t}=this.props,{inputStore:o}=this.stores,i=o.state,r=Object.keys(t).find((o=>{var r;return o!==e&&(null===(r=t[o])||void 0===r?void 0:r.name)===i}));return Boolean(r)}getMenuSections(e){var t;const{property:o,schema:i,collectionContextStore:r,formatKey:n,allowHidingTitle:s,format:l}=this.props,{environment:a,theme:c}=this,{device:d}=a,u=i[o],p=r.permissionScopes.state,h=r.settingsStore,m=r.collectionViewStore(),g=r.collectionStore();if(!m||!u)return[];const S=(0,Ji.wl)(o),f=Boolean((null===(t=hl(this.props.format,this.props.formatKey,this.props.property))||void 0===t?void 0:t.wrap)||m.getFormat().table_wrap)&&"timeline"!==m.getType(),v=r.databaseType,y=Boolean(g&&v&&$.cR((0,$s.appConfigs)(),v,o,g)),C="title"===u.type,x=[];if(S&&"person"===u.type){const e=[];x.push(e),e.push({key:"synced_person",render:e=>(0,kt.jsx)(rl.Z,{...e,title:u.name||"",icon:(0,Zs.D)({width:14}),caption:(0,kt.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,kt.jsx)(ll.Z,{href:(0,er.UY)("guides.syncedContent"),children:t})}}})})}),action:()=>{}})}if(p.canConfigureCollection&&!S){const t=[];if(x.push(t),t.push({key:"rename",render:t=>(0,kt.jsxs)(xt.Z,{children:[(0,kt.jsx)(ol.Z,{...t,initialValue:u.name||"",placeholder:ge.default.formatMessage(il.sY.inputPlaceholder),focusInitial:!0,inputStore:this.stores.inputStore,onBlur:this.handlePropertyNameSubmit,onSubmit:t=>{this.handlePropertyNameSubmit(t),e.close()},iconButton:{icon:e=>(0,kt.jsx)(Fs.ZP,{type:u.type,icon:u.icon,size:16,theme:c,style:e}),iconStyle:{fill:Is.Lr[c.mode].gray},enforceIconColor:"gray",onSubmit:(e,t)=>function(e,t,o,i,r){const n=t.collectionStore();if(!n)return;U.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:o,perform:t=>{Ks.OK({collectionStore:n,property:e,icon:i,transaction:t})}}),j.$q({environment:o,collectionContextStore:t,property:e,icon:i,from:"table",action:"change_icon"})}(this.props.property,this.props.collectionContextStore,this.environment,e)}}),this.shouldShowDuplicateError()&&(0,kt.jsx)(il.mJ,{propertyName:this.stores.inputStore.state,styles:d.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${c.regularDividerColor}`}:{}})]}),action:()=>{j.wd({environment:this.environment,collectionContextStore:r,action:"table_header_rename"}),Z.n1({collectionContextStore:r}),e.close()}}),t.push({key:"edit_property",render:e=>(0,kt.jsx)(bt.ZP,{placement:bt.ug.Left,render:t=>(0,kt.jsx)(mt.Z,{disabled:void 0===g,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,Os.W)({width:14}),...(0,dt.Z)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{g&&(j.wd({environment:this.environment,collectionContextStore:r,action:"table_header_edit"}),Z.n1({collectionContextStore:r}),e.close(),D.r$({collectionContextStore:r,collectionSettingsStore:h}),D.H4({collectionSettingsStore:h,item:{type:"properties",timelineViewTab:"table"}}),D.H4({collectionSettingsStore:h,item:{type:"property",formatKey:n,property:o}}))}}),g&&(0,Qs.Zt)(this.environment)&&(0,Go.qQ)(u)&&("text"===u.type||(0,Qs.KZ)())){const i=(0,Go.q3)(u),s=di.De(g.getFormat(),o),l=s.isRunning||!g||!(0,Qs.mX)(a,Js.Z.getMode(a,g),g);i?t.push({key:"fill_all_pages",render:e=>(0,kt.jsx)(bt.ZP,{placement:bt.ug.Left,renderTooltip:()=>(0,kt.jsx)(el.qQ,{collectionStore:g,propertySchema:u}),render:t=>(0,kt.jsx)(mt.Z,{titleStyle:{color:l?c.lightTextColor:void 0},disabled:l,icon:(0,kt.jsx)(el.Xh,{updateAiInferencesTaskStatus:s,iconStyle:{marginLeft:-1,marginRight:-1},progressIconStyle:{marginTop:4,marginLeft:0,marginRight:-3}}),title:(0,kt.jsx)(el.ZP,{updateAiInferencesTaskStatus:s}),caption:void 0!==s.numPagesFilled&&void 0!==s.numPagesRequested&&(0,kt.jsx)(el.Y7,{updateAiInferencesTaskStatus:s}),...(0,dt.Z)(e,t)})}),action:async()=>{await qs.autofillPropertyForCollection({environment:a,collectionStore:g,propertySchema:u,property:o})}}):t.push({key:"autofill_with_ai",render:e=>(0,kt.jsx)(mt.Z,{disabled:void 0===g,title:(0,kt.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Set up AI autofill",id:"database.tableHeaderCell.autofillWithAI"}),(0,kt.jsx)(nl.Z,{style:{display:"inline-block"}})]}),icon:(0,Es.y)({width:14,fill:c.aiPurpleColor}),...e}),action:()=>{g&&(e.close(),D.r$({collectionContextStore:r,collectionSettingsStore:h}),D.H4({collectionSettingsStore:h,item:{type:"properties",timelineViewTab:"table"}}),D.H4({collectionSettingsStore:h,item:{type:"property",formatKey:n,property:o}}),"text"===u.type&&D.H4({collectionSettingsStore:h,item:{type:"propertyAiAutofill",propertySchema:u,property:o}}))}})}}if(p.canConfigureBlock){const t=[];x.push(t),t.push({key:"sort_asc",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:(0,Bs.Z)({width:14})}),action:()=>{j.wd({environment:this.environment,collectionContextStore:r,action:"table_header_sort_asc"}),e.close(),function(e,t,o,i){pl(!0,e,t,o,i)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}}),t.push({key:"sort_desc",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:(0,os.M)({width:14})}),action:()=>{j.wd({environment:this.environment,collectionContextStore:r,action:"table_header_sort_desc"}),e.close(),function(e,t,o,i){pl(!1,e,t,o,i)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}}),t.push({key:"filter",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:(0,As.Q)({width:14})}),action:()=>{"collectionVirtualView"!==r.contextType&&(j.wd({environment:this.environment,collectionContextStore:r,action:"table_header_filter"}),e.close(),function(e,t,o,i){const r=t.currentPropertyFiltersStore.state,n=t.collectionViewBlockStore(),s=(null==n?void 0:n.getRecordModel)??Hs.om.constant(void 0);let l=r.find((t=>{let{filter:o}=t;return o.property===e}));if(!l){const n=(0,ne.H_)({property:e,schema:o,getRecordModel:s});if(!n)return;const a={id:(0,Gs.ZP)(),filter:n};t.filtersBarOpen.setState(!0),Ws.iU({environment:i,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...r,a]}}}),l=a}if(!l)return;const a=t.getFilterBarItemSettingsStore(l);D.wl({collectionSettingsStore:a,item:{type:"filter"}}),Z.n1({collectionContextStore:t})}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment))}})}const b=[];if(x.push(b),(s||"title"!==u.type)&&p.canConfigureBlock&&b.push({key:"hide",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:(0,Ds.L)({width:22,marginLeft:-4,marginRight:-4})}),action:()=>{j.wd({environment:this.environment,collectionContextStore:r,action:"table_header_hide"}),e.close(),function(e,t,o,i,r,n){const s=e.collectionViewStore();if(!s)return;const l=(o[i]||[]).map((e=>e.property===t?{...e,visible:!1}:e)),a={...o,[i]:l};U.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:n,perform:t=>{Z.iG({collectionViewStore:s,update:{format:a},transaction:t}),Us.oz({environment:n,collectionContextStore:e,currentIndex:r,entrypoint:"TableHeaderCell",transaction:t,propertyAction:"hide"})}})}(this.props.collectionContextStore,this.props.property,this.props.format,this.props.formatKey,this.props.columnIndex,this.environment)}}),p.canConfigureBlock){const e=this.canFreezeThisColumn.state;b.push({key:"freeze_column",render:t=>(0,kt.jsx)(bt.ZP,{placement:bt.ug.Left,disableTooltip:!e,renderTooltip:e=>(0,kt.jsx)(V.FormattedMessage,{...e,defaultMessage:"Insufficient space to freeze columns",id:"database.tableHeaderCell.freezePropertyTooltip",description:"If the width of the frozen columns is wider than the screen, show the user this tooltip warning."}),render:o=>(0,kt.jsx)(mt.Z,{...t,...o,disabled:e,buttonStyle:{color:e?this.theme.text.quaternary:void 0},title:this.isRightmostFrozen.state?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"{numberFrozenColumns, plural, one {Unfreeze column} other {Unfreeze columns}}",values:{numberFrozenColumns:this.props.columnIndex+1},id:"database.tableHeaderCell.unfreezeColumns"}):(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Freeze up to column",id:"database.tableHeaderCell.freezeUpToColumn"}),icon:this.isRightmostFrozen.state?(0,zs.A)({width:14}):(0,Ns.P)({width:12,margin:"0px 1px"})})}),action:()=>{!function(e,t,o){U.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:o,perform:i=>{Us.oz({environment:o,collectionContextStore:e,currentIndex:t,transaction:i,entrypoint:"TableHeaderCell",propertyAction:"toggle"})}})}(this.props.collectionContextStore,this.props.columnIndex,this.environment)}})}if(!Yt.Tr.includes(u.type)||(0,Go.dx)(u)||!p.canConfigureCollection||S||C||b.push({key:"duplicate",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:(0,_s.a)({width:14})}),action:async()=>{j.wd({environment:this.environment,collectionContextStore:r,action:"table_header_duplicate"}),e.close(),await async function(e,t,o,i,r,n){const s=hl(r,o,e),l=t.collectionStore(),a=t.collectionViewStore(),c=t.normalizedFormatStore.state[o]||[],d=null==l?void 0:l.getSpaceId();if(!(l&&a&&d&&s))return;const u=l.getSchema(),p=u[e];if(!p)return;const h=await(0,ue.xy)({environment:n,schema:u,property:e,properties:c,parentStore:l,spaceId:d});if(!h)return;U.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:n,perform:e=>{Z.xO({environment:n,collectionStore:l,update:{[h.newProperty]:h.newPropertySchema},transaction:e}),Us.oz({environment:n,collectionContextStore:t,currentIndex:i,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"duplicate"}),h.automationUpdate&&Z.Ki({environment:n,collectionStore:l,update:h.automationUpdate,transaction:e}),o&&Ke.FH({stores:[a],update:{[o]:h.newProperties},transaction:e})}}),j.wd({environment:n,collectionContextStore:t,action:"duplicate_property",original_view_type:null==a?void 0:a.getType(),property_type:p.type})}(this.props.property,this.props.collectionContextStore,this.props.formatKey,this.props.columnIndex,this.props.format,this.environment)}}),Yt.Tr.includes(u.type)&&p.canConfigureCollection&&!S&&!C&&b.push({key:"delete",render:e=>(0,kt.jsx)(bt.ZP,{placement:bt.ug.Left,disableTooltip:!y,renderTooltip:e=>(0,ot.A7)(v,e),render:t=>(0,kt.jsx)(mt.Z,{...e,...t,disabled:y,disabledFeedback:y,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:this.environment.device.isMobile&&y?(0,ot.A7)(v):null,icon:y?(0,kt.jsx)("div",{...t,children:(0,Ls.Q)({width:14})}):(0,kr.y)({width:14})})}),action:async()=>{e.close(),await async function(e,t,o,i,r,n){await Ks.TI({environment:r,collectionContextStore:e,property:t,handleDeleteAccept:()=>function(e,t,o,i,r){const n=o.collectionStore();if(!n)return;const s=n.getSchema()[e];U.createAndCommitAsync({environment:r,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:async s=>{await Ks.yV({environment:r,collectionStore:n,schema:t,property:e,transaction:s}),Us.oz({environment:r,collectionContextStore:o,currentIndex:i,entrypoint:"TableHeaderCell",transaction:s,propertyAction:"delete"})}}),s&&j.y9({environment:r,collectionContextStore:o,property_type:s.type,from:"table_column",property:e})}(t,o,e,i,r),theme:n,from:"table_column"})}(this.props.collectionContextStore,this.props.property,this.props.schema,this.props.columnIndex,this.environment,this.theme)}}),p.canConfigureBlock&&"timeline"!==m.getType()){const e=[];x.push(e),e.push({key:"wrap_cell",render:e=>(0,kt.jsx)(sl.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn"}),on:f}),action:()=>{Us.K4({currentValue:f,environment:this.environment,property:o,collectionViewStore:m,format:l,formatKey:n}),j.wd({environment:this.environment,collectionContextStore:r,action:"table_header_wrap_column"})}})}return x}}dl.displayName="TableHeaderCellMenu";const ul=(0,V.injectIntl)(cl);function pl(e,t,o,i,r){if(!i[t])return;const n=[{property:t,direction:e?"ascending":"descending"}];o.filtersBarOpen.setState(!0),Ws.iU({environment:r,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:n}}}),Z.n1({collectionContextStore:o})}function hl(e,t,o){var i;return null===(i=e[t])||void 0===i?void 0:i.find((e=>e.property===o))}function ml(e,t,o){return{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:e,borderRight:t?void 0:`1px solid ${o.tableDividerColor}`}}function gl(e){K.ZH(e),G.ZH(e),Z.wG()}var Sl=o(35011),fl=o(58299);const vl={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1};class yl extends s.Z{constructor(){super(...arguments),this.resizeStartLeftFormat=void 0,this.storeTypes={mouseStore:oe.Z,resultStore:d.default.createClass(void 0)},this.handleDragStart=e=>{e.preventDefault(),this.resizeStartLeftFormat=this.props.leftFormat,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!0})},this.handleDragMove=e=>{const t=this.getNewFormat(e);t&&this.props.onTemporaryResize(t)},this.handleDragEnd=e=>{const t=this.getNewFormat(e);t&&this.props.onAccept(t),this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDragCancel=()=>{this.props.onCancel(),this.resizeStartLeftFormat=void 0,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDoubleClick=()=>{const e=this.stores.resultStore.state?this.stores.resultStore.state.blockIds:[],t=x.oA(e.map((e=>{const t=fl.Z.findBlockPropertyValueByBlockId(e,this.props.leftFormat.property),o=null==t?void 0:t.getNode();if(o)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const i=getComputedStyle(e);for(let s=0;s<i.length;s++){const e=i[s],o=i.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const s of r)s.style&&(s.style.pointerEvents="none",s.style.width="auto");document.body.appendChild(t);const n=t.getBoundingClientRect();return t.remove(),null!=n&&n.width?Math.ceil(n.width):void 0}(o)})));if(this.props.leftFormat.width){const e={...this.props.leftFormat,width:Math.min(800,Math.max(Math.max(...t),xl(this.props.propertySchema,this.props.leftFormat)))};this.props.onAccept(e)}}}renderComponent(){const{device:e}=this.environment,{mouseEntered:t,mousePressed:o}=this.stores.mouseStore.state,i=(o||t)&&!e.isPhone;return(0,kt.jsx)("div",{style:vl,onMouseMove:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1}),children:(0,kt.jsx)(vi.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>{return(0,kt.jsx)("div",{style:i?(t=this.props.height,{...bl(t),background:Wo.ZP.blueWithAlpha(.8)}):bl(this.props.height),onDoubleClick:this.handleDoubleClick,...e});var t}})})}getNewFormat(e){if(this.resizeStartLeftFormat&&this.resizeStartLeftFormat.width){const t=Math.max(this.resizeStartLeftFormat.width+e.diffX,xl(this.props.propertySchema,this.props.leftFormat));return{...this.resizeStartLeftFormat,width:t}}}}yl.displayName="TableHeaderResizer";const Cl=yl;function xl(e,t){if("checkbox"===(null==e?void 0:e.type)||"status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return 32;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Sl.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return 32;return"auto_increment_id"===(null==e?void 0:e.type)?64:100}function bl(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:Wo.ZP.blueWithAlpha(0),cursor:"col-resize"}}var wl=o(81415),kl=o(84169);function Pl(e){window.__c={n:"LearnMoreLink"};const{href:t,style:o}=e,i=(0,Ht.yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,kt.jsxs)("a",{href:t,target:"_blank",style:{...i.default,...o},children:[(0,kl.m)({width:14,marginRight:4}),(0,kt.jsx)(V.FormattedMessage,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}var Rl=o(71424);function Tl(e){window.__c={n:"WikiPropertiesOnboardingTooltip"};const{origin:t,propertyType:o}=e,i=(0,et.O7)();return(0,kt.jsx)(wl.U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,kt.jsx)(V.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,kt.jsx)(V.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,kt.jsx)(V.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,yr.t1)(o)}}(),content:function(){switch(o){case"owner":return(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,kt.jsx)("span",{style:{fontWeight:R.Z.fontWeight.semibold},children:e})}});case"verification":return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,kt.jsx)(Pl,{href:(0,er.UY)("guides.wikis"),style:{color:Wo.ZP.uiLightGray}})]});case"tags":return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,kt.jsx)(Pl,{href:(0,er.UY)("guides.databaseProperties"),style:{color:Wo.ZP.uiLightGray}})]});default:(0,yr.t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,yr.t1)(o)}}(),onCloseClick:()=>{ks.nX(i)},onPrimaryButtonClick:()=>ks.Rg(i),onBackButtonClick:()=>ks.FO(i),shouldDismissUponOutsideClick:!0,pointerLength:Rl.EZ,pointerOffset:Rl.FD,style:{width:Rl.G5}})}const Vl={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};class Ml extends s.Z{constructor(){super(...arguments),this.storeTypes={tableHeaderRowStore:Rs,resultStore:d.default.createClass(void 0)},this.propertyRef=r.createRef(),this.renderHeaderRowCells=(e,t,o)=>{var i,r,n,s;const{device:l}=this.environment,{store:a,collectionContextStore:c,schema:d,query:u,resultStore:h,disabled:m,formatKey:g,disableCellRightBorder:S,renderSpacer:f,allowHidingTitle:v,paddingTop:y,showRightActions:C}=this.props,x=Bl(this.props.format,this.props.tableStore),b=this.props.showPropertyFormatsStore.state[t],w=t===o.length-1,k=ks.B1(),P=(null===(i=c.collectionStore())||void 0===i?void 0:i.getFormat().app_config_uri)===p.GZ&&a.isCollectionViewPageWithContent()&&a.id===(null===(r=c.collectionViewBlockStore())||void 0===r?void 0:r.id),R=P&&e===bs.k.Owner&&"owner"===k,T=P&&"verification"===(null===(n=d[e])||void 0===n?void 0:n.type)&&"verification"===k,V=P&&"multi_select"===(null===(s=d[e])||void 0===s?void 0:s.type)&&"tags"===k,M=!l.isMobile&&(R||T||V),F=S||w&&!Il(m,C),I=(0,kt.jsxs)(kt.Fragment,{children:[M&&(0,kt.jsx)(Tl,{origin:this.propertyRef,propertyType:k}),b&&b.width&&(0,kt.jsx)(ul,{format:x,schema:d,query:u,property:e,width:b.width,collectionViewBlockStore:a,collectionContextStore:c,disabled:m,formatKey:g,isLast:w,disableCellRightBorder:F,allowHidingTitle:v,renderSpacer:f,paddingTop:y,columnIndex:t,resultStore:h,groupsPointer:this.groupsPointerStore.state}),!m&&!l.isPhone&&(0,kt.jsx)(Cl,{leftFormat:b,onTemporaryResize:e=>function(e,t,o,i){t.setState({...t.state,temporaryFormat:Dl(e,o,i,t)})}(e,this.props.tableStore,this.props.formatKey,this.props.format),onAccept:e=>function(e,t,o,i,r,n){const s=t.collectionViewStore();if(!s)return;const l=Bl(i,r),a=_l(o,i,r).map((t=>t.property===e.property?e:t)),c={...l,[o]:a};U.createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:n,perform:e=>{Z.iG({collectionViewStore:s,update:{format:c},transaction:e})}}),r.setState({...r.state,temporaryFormat:void 0}),j.wd({environment:n,collectionContextStore:t,action:"table_resize_columns"})}(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),onCancel:()=>{var e;(e=this.props.tableStore).setState({...e.state,temporaryFormat:void 0})},height:this.props.height,propertySchema:d[e],resultStore:h})]});return(0,kt.jsx)("div",{style:{display:"flex",position:"relative"},ref:M?this.propertyRef:void 0,children:I},e)},this.shouldShowMultiSelectCheckboxStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,ue.fk)({environment:this.environment,collectionContextStore:e})})),this.groupsPointerStore=this.createComputedStore((()=>{const{groupFormat:e}=this.props;return e?[e]:[]}),!0),this.showPropertiesStore=this.createComputedStore((()=>this.props.showPropertyFormatsStore.state.map((e=>e.property))),!0)}renderComponent(){const{disabled:e,showRightActions:t,disableHorizontalEdgeScroll:o,collectionContextStore:i,frozoneProps:r}=this.props,n=i.permissionScopes.state,s=null==r?void 0:r.frozenIndex,l=(0,ue.bW)(s),a=null==r?void 0:r.frozenStyles.left,c={...this.shouldShowMultiSelectCheckboxStore.state?{...null==r?void 0:r.frozenStyles,left:as.Xx+(a??0)}:null==r?void 0:r.frozenStyles},d=this.showPropertiesStore.state.slice(0,l),u=this.showPropertiesStore.state.slice(l),p=Il(e,t)?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(El,{collectionContextStore:this.props.collectionContextStore}),(0,kt.jsx)(Ol,{collectionContextStore:this.props.collectionContextStore})]}):null,h=this.shouldShowMultiSelectCheckboxStore.state&&(0,kt.jsx)(jl,{groupsPointer:this.groupsPointerStore.state,collectionContextStore:i,frozoneProps:r});return e||!n.canConfigureBlock?(0,kt.jsx)(Bo.Z,{position:Je.Z.Top,children:(0,kt.jsxs)("div",{className:re.kUP,style:Zl(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder),children:[h,(0,kt.jsxs)("div",{style:_o.l8,children:[(0,kt.jsx)("div",{style:{display:"flex",...c},children:d.map(((e,t)=>this.renderHeaderRowCells(e,t,this.showPropertiesStore.state)))}),u.map(((e,t)=>this.renderHeaderRowCells(e,t+l,this.showPropertiesStore.state)))]}),p,this.props.children]})}):(0,ue.Ql)(s)?(0,kt.jsx)(Bo.Z,{position:Je.Z.Top,children:(0,kt.jsxs)("div",{className:re.kUP,style:Zl(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder),children:[h,(0,kt.jsx)(Ts.Z,{style:{display:"flex"},direction:"horizontal",keys:this.showPropertiesStore.state,sectionedKeys:{frozen:d,unfrozen:u},sectionStyles:{frozen:{display:"flex",...c},unfrozen:{display:"flex"}},renderKey:this.renderHeaderRowCells,onDrop:e=>Ll(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),disableHorizontalEdgeScroll:o}),p,this.props.children]})}):(0,kt.jsx)(Bo.Z,{position:Je.Z.Top,children:(0,kt.jsxs)("div",{className:re.kUP,style:{...Zl(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder)},children:[h,(0,kt.jsx)(_o.ZP,{direction:"horizontal",keys:this.showPropertiesStore.state,renderKey:this.renderHeaderRowCells,onDrop:e=>Ll(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),disableHorizontalEdgeScroll:o}),p,this.props.children]})})}}function jl(e){window.__c={n:"GroupSelectCheckbox"};const{groupsPointer:t,collectionContextStore:o,frozoneProps:i}=e,n=(0,et.O7)(),s=(0,r.useCallback)((()=>(0,ss.A7)(t[0],o).filter((e=>e.canEdit()))),[o,t]),l=(0,c.VK)((()=>0===s().length),[s]),a=(0,c.VK)((()=>{const e=s(),t=e.length;if(0===t)return!1;const o=eo.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")}),[s]),d=(0,r.useCallback)((e=>{var t;const i=s(),r=eo.default.state.stores,l=(0,as.vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===a||"indeterminate"===a?G.Z5({environment:n,stores:x.G0(l,i)}):!0===a&&G.Z5({environment:n,stores:x.zu(l,...i)}),e.stopPropagation()}),[a,o,n,s]),u=(0,c.VK)((()=>({...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)?{background:void 0}:{}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles]);return(0,kt.jsx)("div",{style:u,children:(0,kt.jsx)(js,{passesFilter:!0,checkedState:a,onClick:d,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:l})})}Ml.displayName="TableHeaderRow";const Fl=(0,V.injectIntl)(Ml);function Il(e,t){return!e&&t}function Bl(e,t){const{temporaryFormat:o}=t.state;return o||e}function _l(e,t,o){return Bl(t,o)[e]||[]}function Dl(e,t,o,i){const r=Bl(o,i),n=_l(t,r,i).map((t=>t.property===e.property?e:t));return{...r,[t]:n}}function Al(e){(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{}})}function Zl(e,t,o,i,r,n){var s;const l=e.collectionViewStore();if(!l)return{};const a=(null===(s=e.inheritedBlockColorStore.state)||void 0===s?void 0:s.background)||(t?r.cardContentBackground:r.contentBackground);return{display:"flex",position:"absolute",background:a,zIndex:T.VT+1,height:o-1,color:r.mediumTextColor,borderTop:n?void 0:`1px solid ${r.tableDividerColor}`,boxShadow:`\n            -3px 0 0 ${a},\n            0 1px 0 ${r.tableDividerColor}\n        `,minWidth:i,left:"timeline"===l.getType()?void 0:0,right:"timeline"===l.getType()?void 0:0}}function Ll(e,t,o,i,r,n){const s=t.collectionViewStore();if(!s)return;const l={...Bl(i,r),[o]:x.MR(_l(o,i,r),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};U.createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:n,perform:e=>{Z.iG({collectionViewStore:s,update:{format:l},transaction:e})}}),j.wd({environment:n,collectionContextStore:t,action:"table_reorder_columns"})}function El(e){let{collectionContextStore:t}=e;window.__c={n:"AddColumnButtonComponent"};const o=(0,Ht.Fg)(),i=(0,et.O7)();return(0,kt.jsx)(io.Z,{style:{display:"flex",justifyContent:"flex-start",width:32},onMouseDown:Al,onClick:()=>function(e,t){const o=e.collectionStore();o&&(K.ZH(t),G.ZH(t),Z.wG(),j.wd({environment:t,collectionContextStore:e,action:"click_new_property"}),D.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",propertyTypes:(0,Yt.TP)({isSyncedCollection:o.isSyncedCollection(),collectionContextStore:e,environment:t}),onAccept:(o,i)=>{ws.PW({environment:t,collectionContextStore:e,propertyType:o,propertyName:i,from:"table"})}}}))}(t,i),className:re.V6y,children:(0,kt.jsx)("div",{style:Vl,children:(0,y.R)({width:12,fill:o.mediumIconColor})})})}function Ol(e){let{collectionContextStore:t}=e;window.__c={n:"ConfigureColumnsButtonComponent"};const o=(0,Ht.Fg)(),i=(0,et.O7)();return(0,kt.jsx)(io.Z,{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32},onMouseDown:Al,onClick:()=>function(e,t){D.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),j.wd({environment:t,collectionContextStore:e,action:"click_table_header_dot_menu"}),D.H4({collectionSettingsStore:e.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}(t,i),className:re.V6y,children:(0,kt.jsx)("div",{style:Vl,children:(0,tt.o)({width:12,fill:o.mediumIconColor})})})}var Nl=o(62965),zl=o(73819),Hl=o(86486),Gl=o(29370),Wl=o(3386);function Kl(e){const{children:t,isCollectionViewBlockSelected:o,shouldFreeze:i}=e;return i?(0,kt.jsx)(Br.Z,{enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:ao.z},isVisible:!0,render:()=>(0,kt.jsx)("div",{style:{display:"flex",background:o?Wo.ZP.blueWithAlpha(.14):void 0},children:t})},"halo"):(0,kt.jsx)(kt.Fragment,{children:t})}function Ul(e,t){window.__c={n:"TableRow"};const{disabled:o,store:i,groupFormat:n,collectionContextStore:s,propertyFormats:l,showRightActionsSpacer:a,disableTableWrap:d,frozoneProps:u,passesFilter:p,shouldShowMultiSelectCheckbox:h,...m}=e,{handleOpenPeekPage:g}=e,S=(0,r.useRef)(null),f=(0,et.O7)(),v=(0,c.VK)((()=>!o&&i.canEdit()),[o,i]),y=(0,c.VK)((()=>(0,ss.A7)(n,s).findIndex((e=>e===i))),[s,n,i]),C=(0,c.VK)((()=>{const e=s.collectionViewBlockStore();return!(!e||s.isFullScreen.state)&&(0,ls.sY)(e)}),[s]),x=null==u?void 0:u.frozenIndex,b=void 0!==x,w=(0,c.VK)((()=>{const{collectionContextStore:t,groupFormat:o}=e,i=Gl.Z.state,r=t.collectionViewBlockStore();if(!r)return!1;if(!i.isActive||!(0,Gl.N)(i.selectionKey,{collectionViewBlockStore:r,groupFormat:o}))return!1;const{selection:n}=i,{start:s}=n;return void 0!==x&&y===s.row&&s.col<=x}),[e,x,y]),k=(0,c.VK)((()=>ue.bW(x)),[x]),P=(0,r.useMemo)((()=>b?{...null==u?void 0:u.frozenStyles,...w?{zIndex:T.mK}:{zIndex:T.IK},...-1===x?{background:void 0}:{}}:{}),[x,null==u?void 0:u.frozenStyles,b,w]),[R,V]=(0,r.useMemo)((()=>b?[l.slice(0,x+1),l.slice(x+1)]:[[],l]),[x,l,b]),M=(0,c.VK)((()=>{var e;return Boolean(!d&&(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[s,d]),j=(0,c.VK)((()=>{var e;return Boolean("timeline"===(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType())||!M&&!l.some((e=>e.wrap)))}),[s,l,M]),F=(0,c.VK)((()=>{const e=s.permissionScopes.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[s.permissionScopes]),I=(0,kt.jsxs)(r.Fragment,{children:[(0,kt.jsx)("div",{className:re.zwY,style:{display:"flex"},ref:S,children:(0,kt.jsxs)("div",{style:{display:"flex"},children:[(0,kt.jsx)("div",{style:b?P:{},children:(0,kt.jsx)(Kl,{isCollectionViewBlockSelected:C,shouldFreeze:-1!==x,children:(0,kt.jsxs)(kt.Fragment,{children:[h&&(0,kt.jsx)(Ql,{store:i,passesFilter:Boolean(p),frozoneProps:u,canEdit:v}),(0,kt.jsx)(ql,{store:i,canEdit:v,propertyFormats:R,shouldSetCellHeight:j,indexAddendum:0,rowIndex:y,disabled:o,groupFormat:n,disableTableWrap:d,isLocked:F,isCollectionViewBlockSelected:C,passesFilter:Boolean(p),shouldShowMultiSelectCheckbox:h,frozoneProps:u,...m})]})})}),(0,kt.jsx)(ql,{store:i,canEdit:v,propertyFormats:V,shouldSetCellHeight:j,indexAddendum:k,rowIndex:y,disabled:o,groupFormat:n,disableTableWrap:d,isLocked:F,isCollectionViewBlockSelected:C,passesFilter:!0,shouldShowMultiSelectCheckbox:h,frozoneProps:u,...m})]})}),a&&!F&&(0,kt.jsx)(Xl,{})]});return(0,zl.ez)(i,t,(0,r.useMemo)((()=>({renderedType:"table_row",getNode:()=>S.current,getBlockStore:()=>i,activate(){const{mainEditorCurrentBlockStore:e}=Pe.default.state,t=ue.mb({store:i,mainEditorCurrentBlockStore:e,collectionContextStore:s,fullyQualified:!1});t&&(g(),N.c4({environment:f,url:t}))}})),[s,f,g,i]),I)}function ql(e){window.__c={n:"TableRowValues"};const{blockPropertyValueOverlayStore:t,propertyFormats:o,store:i,disableTableWrap:r,shouldSetCellHeight:n,indexAddendum:s,frozoneProps:l,...a}=e,d=(0,Q.Y$)(),u=(0,c.VK)((()=>d.collectionViewStore()),[d]),p=(0,c.VK)((()=>i.getAssociatedCollectionStore()),[i]),h=(0,c.VK)((()=>!!u&&Boolean(!r&&u.getFormatStore().getKeyStore("table_wrap").getValue())),[u,r]),m=(0,c.VK)((()=>{const e=Hl.default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[i]),g=(0,c.VK)((()=>!t.state.isOpen&&eo.default.state.stores.length>0&&eo.default.state.stores[0].id===i.id),[i.id,t]),S=(0,c.VK)((()=>d.currentSubitemFormatStore.state),[d.currentSubitemFormatStore]),f=(0,c.VK)((()=>(0,$.$4)()&&"title"===(null==u?void 0:u.getFormat().table_subitem_toggle_column)),[u]),v=(0,c.VK)((()=>d.frozoneStore.state.frozenIndex),[d]);return(0,kt.jsx)(kt.Fragment,{children:o.map(((e,r)=>(0,kt.jsx)($l,{index:r+(s??0),store:i,propertyFormat:e,isLastColumn:r===o.length-1,isRightMostFrozenColumn:v===r+(s??0),collectionViewStore:u,collectionStore:p,tableWrap:h,shouldSetCellHeight:n,isShowingHoverMenu:m,shouldCaptureKeyboard:g,subitemFormat:S,isSubitemToggleOnTitleColumn:f,blockPropertyValueOverlayStore:t,isScrolled:(null==l?void 0:l.isScrolled)??!1,...a},e.property)))})}const $l=e=>{window.__c={n:"TableRowValue"};const{propertyFormat:t,index:o,canEdit:i,isLastColumn:n,isRightMostFrozenColumn:s,store:l,schema:a,disabled:d,disableCellBorderRight:u,disableLastCellBorderRight:p,subitemPath:h,onShiftEnter:m,tableWrap:g,subitemFormat:S,isShowingHoverMenu:f,shouldCaptureKeyboard:v,isLocked:y,toggleButton:C,onPropertyClick:b,titleColumnIndex:w,isSubitemToggleOnTitleColumn:k,onPropertyTab:P,onPropertyUntab:R,onPropertyEnter:T,onPropertyEsc:V,onPropertyBgClick:M,onPropertyContextMenu:j,collectionViewStore:F,collectionStore:I,blockPropertyValueOverlayStore:B,shouldSetCellHeight:_,onOpenProperty:D,disableHorizontalEdgeScroll:A,handleOpenPeekPage:Z,groupFormat:L,rowIndex:E,isCollectionViewBlockSelected:O,passesFilter:N,isScrolled:z,shouldShowMultiSelectCheckbox:H}=e,{width:G,property:W,wrap:K}=t,U=(0,Q.Y$)(),q=(null==h?void 0:h.length)??0,$=S&&(0,as.lO)({columnIndex:o,titleColumnIndex:w,isSubitemToggleOnTitleColumn:k}),Y=(0,r.useMemo)((()=>{if(void 0!==G)return $?G-(0,as.lZ)({columnIndex:o,indentLevel:q,titleColumnIndex:w,isSubitemToggleOnTitleColumn:k}):G}),[q,o,k,$,w,G]),X=(0,r.useMemo)((()=>$&&(0,kt.jsx)(Yl,{subitemFormat:S,toggleButton:C,subitemPath:h,shouldShowMultiSelectCheckbox:H,propertyIndex:o})),[$,S,h,C,H,o]),J=(0,r.useCallback)((()=>b(l,W,a)),[b,W,a,l]),ee=d||!i,te=(0,c.VK)((()=>{const e=Gl.Z.state,t=U.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Gl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:L}))return!1;const{selection:i}=e,{start:r,end:n}=i,s=E===r.row||E===n.row||x.Z2(E,r.row,n.row),l=o===r.col||o===n.col||x.Z2(o,r.col,n.col);return s&&l}),[U,L,o,E]),oe=(0,c.VK)((()=>{const e=Gl.Z.state,t=U.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Gl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:L}))return!1;const{selection:i}=e,{start:r}=i;return E===r.row&&o===r.col}),[U,L,o,E]),ie=(0,c.VK)((()=>{const e=U.frozoneStore.state.frozenIndex;return void 0!==e&&o<=e}),[U,o]),ne=(0,Ht.yK)((e=>{const t=O?e.tableFrozenSelectedDividerColor:e.tableDividerColor;return{tableCell:{display:"flex",width:G||void 0,position:"relative",borderRight:u||s||n&&p?"none":`1px solid ${t}`,boxShadow:ie?`0 -1px 0 ${t}`:void 0},tableSelectionOverlay:{background:te?Wo.ZP.blueWithAlpha(.07):void 0,borderRadius:oe?3:void 0,boxShadow:oe?e.outlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,...0===o&&H?{width:"calc(100% + 8px)",left:-8}:{width:"100%",left:0}},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:G||void 0}}}),[O,u,p,s,n,ie,te,oe,G,o,H]),se=(0,kt.jsxs)(Wl.Z,{capture:v,onShiftEnter:m,children:[(0,kt.jsx)(gi.Z,{collectionStore:I,store:l,property:W,disabled:ee,locked:y,width:Y,format:Si.C.Table,forceMouseEntered:"title"===W&&i?f:void 0,tableWrap:Boolean(g||K),isLast:n,indentLevel:0===o&&h?h.length:void 0,onTab:P,onUntab:R,onEnter:T,onClick:J,onEsc:V,onBgClick:M,onContextMenu:j,collectionViewStore:F,shouldSetCellHeight:_,onOpenProperty:D,blockPropertyValueOverlayStore:B,disableHorizontalEdgeScroll:A,handleOpenPeekPage:Z,propertyIndex:o,shouldShowMultiSelectCheckbox:H},W),s&&(0,kt.jsx)(Ms,{passesFilter:N,isScrolled:z})]});return(0,kt.jsxs)("div",{className:re.mWS,"data-row-index":E,"data-col-index":o,style:ne.tableCell,children:[$&&X,(0,kt.jsx)("div",{style:ne.propertyValueContainer,children:se}),te&&(0,kt.jsx)("div",{style:ne.tableSelectionOverlay})]})};function Yl(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:i,propertyIndex:r}=e,n=(null==o?void 0:o.length)??0,s=Math.max((n-1)*ss.Hw,0)+ss.gY;return t?(0,kt.jsxs)("div",{style:{paddingTop:4,display:"flex",...0===r&&i?{marginLeft:-8,marginRight:4}:{}},children:[(0,kt.jsx)("div",{style:{width:s}}),t]}):(0,kt.jsx)("div",{style:{minWidth:s+ss.Hw,...0===r&&i?{marginLeft:-8,marginRight:4}:{}}})}const Ql=r.memo((e=>{window.__c={n:"RowSelectCheckbox"};const{store:t,passesFilter:o,canEdit:i,frozoneProps:n}=e,s=(0,Q.Y$)(),l=(0,et.O7)(),a=(0,c.VK)((()=>eo.default.state.stores.includes(t)),[t]),d=(0,r.useCallback)((e=>{var o;(0,as.vg)({collectionViewBlockId:null===(o=s.collectionViewBlockStore())||void 0===o?void 0:o.id})?G.Z5({environment:l,stores:[t]}):G.Ys({environment:l,store:t,toggle:!0}),e.stopPropagation()}),[s,l,t]);return(0,kt.jsx)(js,{checkedState:a,onClick:d,checkboxType:"single_row",collectionContextStore:s,frozoneProps:n,passesFilter:o,disabled:!i})}));function Xl(){return(0,kt.jsx)("div",{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}})}const Jl=r.memo(r.forwardRef(Ul),Nl.Z);var ea=o(12137),ta=o(55061),oa=o(6404),ia=o(11302),ra=o(12714),na=o(39865),sa=o(4708),la=o(80796),aa=o(22294),ca=o(11368);const da=function(e){window.__c={n:"FrozenColumnRepositioner"};const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:i,xForFirstCellInRow:n,showPropertyFormats:s,frozenSectionWidth:l}=e,a=(0,et.O7)(),d=(0,Q.DK)(),u=(0,r.useRef)(null),p=(0,r.useRef)(null),[h,m]=r.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[g,S]=r.useState(0),[f,v]=r.useState(0),y=(0,c.VK)((()=>t.state.isRepositioning||h.isMouseDown),[t,h.isMouseDown]),C=(0,c.VK)((()=>t.state.newFrozenIndex),[t]),b=(0,c.VK)((()=>!!d&&(0,ue.fk)({environment:a,collectionContextStore:d})),[a,d]),w=(0,c.VK)((()=>null==d?void 0:d.frozoneStore.state.isScrolled),[d]),k=(0,c.VK)((()=>!w&&-1===o&&b?-4:0),[o,w,b]),P=(0,c.VK)((()=>h.isEntered||y),[h.isEntered,y]),M=(0,c.VK)((()=>t.state.newFrozenColumnXPosition),[t]),j=(0,r.useContext)(ca.Ue),F=(0,c.VK)((()=>null==j?void 0:j.horizontalScroller),[j]),I=(0,r.useCallback)((()=>{var e,t,o;if(!F||!u.current)return 0;const i=(null===(e=u.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=F.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(re.kUP);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-i}),[F]),B=(0,r.useCallback)((()=>{var e,t,o,i,r;if(!F||!u.current)return 0;const n=(null===(e=u.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,s=null===(t=F.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(re.zwY),l=s&&s.length>0?null===(o=s[s.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(i=F.scrollerEl())||void 0===i?void 0:i.getElementsByClassName(re.Gcz),c=a&&a.length>0?null===(r=a[a.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(l,c)-n}),[F]),_=(0,c.VK)((()=>{var e;const t=null===(e=u.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==l?new DOMRect(t.x+l+h.x+10,t.y+h.y+10,3,3):void 0}),[l,h]),D=(0,c.VK)((()=>{const e=(null==d?void 0:d.frozoneStore.state.scrollerLeftOffset)??0,t=(0,we.Wk)(a),o=Math.max(t-e,0);return d&&(0,as.iZ)(a,d)?o:0}),[d,a]),A=(0,r.useCallback)((e=>{if(void 0===o||void 0===i||void 0===l||null===u.current||null===p.current)return;const r=u.current.getBoundingClientRect(),a=e.clientX-r.x;if(null==d||d.frozoneStore.setState({...null==d?void 0:d.frozoneStore.state,tryShowHiddenFrozenColumn:a<42}),!P)return;const c=I();S(c);const h=B();v(h);const g=2+l,f=Math.max(a-g,-g),C=e.clientY-r.y-14,x=r.bottom-r.top-14+h,b=y?c:-14,k=Math.max(Math.min(C,x),b);if(m((e=>({...e,x:y?f:0,y:k}))),y){const e=s,r=p.current.getBoundingClientRect();let c=a,d=n,u=-1,h=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>i);t++){const i=e[t];d+=(null==i?void 0:i.width)??0,w&&t===o+1&&(c-=r.x);const n=Math.abs(d-c);n<m&&(m=n,h=d,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:h-l-1})}}),[o,i,l,null==d?void 0:d.frozoneStore,P,I,B,y,s,n,t,w]);(0,r.useEffect)((()=>{const e=x.P2((e=>{A(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[A]);const Z=(0,r.useCallback)((e=>{y||(A(e.nativeEvent),m((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[y,A]),L=(0,r.useCallback)((e=>{y||m((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[y]),E=(0,r.useCallback)((e=>{m((e=>({...e,isMouseDown:!0})))}),[]),O=(0,r.useCallback)((e=>{y&&m((e=>({...e,isEntered:!0})))}),[y]),N=(0,r.useCallback)((e=>{m((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),z=(0,r.useCallback)((e=>{y&&m((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[y]),H=void 0!==C&&void 0!==o&&C<=o,G=(0,Ht.yK)((e=>({repositionerContainer:{zIndex:T.hc,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:y?"grabbing":"grab",pointerEvents:y?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:D,height:"100%"},tooltipContainer:{position:"absolute",left:l??0,zIndex:T.xP,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:y?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:y?h.x-1:-1,top:y?g:0,width:2,height:y?`calc(100% + ${f-g}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:y?g:0,width:1,height:y?`calc(100% + ${f-g}px`:"100%",background:e.accentColors.blue[300]},frozenGhostColumn:{left:M,opacity:y&&H?1:0},unfrozenGhostColumn:{left:(l??0)+(M??0),opacity:P&&y&&!H?1:0},tooltipDraggable:{position:"absolute",left:y?h.x-2:-2,top:h.y,width:4,height:28,background:e.accentColors.blue[400],borderRadius:4},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...R.Z.textOverflowStyle}})),[y,D,l,h,g,f,P,M,H]);return(0,kt.jsx)("div",{className:re.wXs,style:G.repositionerContainer,onMouseEnter:O,onMouseLeave:N,onMouseUp:z,children:(0,kt.jsxs)("div",{style:G.repositionerOutsideStickyWrapper,ref:p,children:[(0,kt.jsx)("div",{style:G.repositionerInsideStickyWrapper,ref:u,children:(0,kt.jsx)(bt.ZP,{renderTooltip:()=>y&&void 0!==C&&C!==o?(0,kt.jsx)(V.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:C+1}}):(0,kt.jsx)(V.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:y||void 0,placement:ps.u.Right,originRect:_,render:e=>(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{translateX:k,opacity:P?1:0},render:()=>(0,kt.jsxs)("div",{...e,style:G.tooltipContainer,children:[(0,kt.jsx)("div",{style:G.tooltipOrigin,onMouseEnter:Z,onMouseLeave:L,onMouseDown:E}),(0,kt.jsx)("div",{style:{...G.ghostColumnBase,...G.frozenGhostColumn}}),(0,kt.jsx)("div",{style:G.tooltipColumn}),(0,kt.jsx)("div",{style:G.tooltipDraggable})]})})})}),(0,kt.jsx)("div",{style:{...G.ghostColumnBase,...G.unfrozenGhostColumn}})]})})};var ua=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}(ua||{});class pa extends s.Z{constructor(){super(...arguments),this.rowsWrapEl=null,this.observer=void 0,this.storeTypes={dragAndFillStore:d.default.createClass(void 0),frozenColumnRepositionStore:d.default.createClass({isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0})},this.handleDragStart=e=>{if(e.preventDefault(),function(e){let t=e;for(;null!==t;){if(t.classList.contains(re.wXs))return!0;t=t.parentElement}return!1}(e.target))this.stores.frozenColumnRepositionStore.setState({isRepositioning:!0,newFrozenIndex:this.frozenIndex.state,newFrozenColumnXPosition:void 0}),this.scrollToStart(),la.Z.setState({...la.Z.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const t=this.normalizedTableSelectionStore.state;if(t&&Sa(this.props.disabled,this.props.collectionContextStore)&&function(e){let t=e;for(;null!==t;){if(t.classList.contains(re.JR_))return!0;t=t.parentElement}return!1}(e.target))return void this.stores.dragAndFillStore.setState({...t})}Z.wG()},this.handleDragMove=e=>{if(this.stores.frozenColumnRepositionStore.state.isRepositioning);else if(Se.X9()){var t;const o=ga(e.target);if(!o)return;const i=this.stores.dragAndFillStore.state,r=(null==i?void 0:i.start)??(null===(t=this.normalizedTableSelectionStore.state)||void 0===t?void 0:t.start)??o;if(!r)return;const n=o;if(this.stores.dragAndFillStore.state&&r.col!==n.col)return;this.setSelection({selection:{start:r,end:n},shouldNormalize:!0})}},this.handleDragEnd=()=>{this.repositionFrozenColumns(),this.dragAndFillCells()},this.handleDragCancel=()=>{this.stores.dragAndFillStore.reset(),this.stores.frozenColumnRepositionStore.reset(),Z.wG()},this.handleLeft=e=>{e.preventDefault&&e.preventDefault(),aa.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Us.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1,columnCount:fa(this.props.showPropertyFormatsStore)}),this.updateSelectionScroll(ua.Left))},this.handleRight=e=>{e.preventDefault&&e.preventDefault(),aa.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Us.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:fa(this.props.showPropertyFormatsStore),rowCount:this.allRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(ua.Right))},this.handleUp=e=>{e.preventDefault&&e.preventDefault(),aa.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Us.zJ({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(ua.Up))},this.handleDown=e=>{e.preventDefault&&e.preventDefault(),aa.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Us.DI({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,rowCount:this.allRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(ua.Down))},this.handleEnter=e=>{e.preventDefault&&e.preventDefault(),aa.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const i=this.allRowsStore.state,r=i[o.start.row],n=this.props.showPropertyFormatsStore.state[o.start.col].property,s=t[n];if(s&&!this.props.disabled)if(Go.uk.includes(s.type)){if("checkbox"===s.type){const e=r.getPropertyStore(n),t=Ji.Ml(e.getValue()),s=i.slice(o.start.row,o.end.row+1);U.createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:this.environment,perform:e=>{for(const o of s)Ue.sO({store:o.getPropertyStore(n),value:Ji._I(!t),transaction:e})}})}}else rs.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r,property:n,format:Si.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,collectionContextStore:this.props.collectionContextStore}),Z.wG()},this.handleTab=e=>{e.preventDefault(),aa.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Us.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:fa(this.props.showPropertyFormatsStore),rowCount:this.allRowsStore.state.length,shiftKey:!1}),this.updateSelectionScroll(ua.Right))},this.handleUntab=e=>{e.preventDefault(),aa.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Us.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:!1,columnCount:fa(this.props.showPropertyFormatsStore)}),this.updateSelectionScroll(ua.Left))},this.handleEsc=e=>{const{device:t}=this.environment;if(t.isMobile)return;e.preventDefault(),aa.Z.setKeyboardMode(!0);const o=this.normalizedTableSelectionStore.state;if(Z.wG(),o){const e=(0,as.AV)(o),t=this.allRowsStore.state.slice(e.minRow,e.maxRow+1);G.Z5({environment:this.environment,stores:t})}},this.handleMoveTo=e=>{e.preventDefault&&e.preventDefault(),aa.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(Z.wG(),t){const e=(0,as.AV)(t),o=this.allRowsStore.state.slice(e.minRow,e.maxRow+1);if(0===o.length)return;G.Z5({environment:this.environment,stores:o});const i=si.C.getRectFromStore(o[0]);ia.bA({environment:this.environment,blocks:o,originRect:i,moveToContext:"action_menu"})}},this.handleDelete=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state;t&&!this.props.disabled&&U.createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:this.environment,perform:e=>{Us.NE({selection:t,schema:o,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,transaction:e})}})},this.handleCut=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,i=this.props.collectionContextStore.collectionViewBlockStore();i&&t&&!this.props.disabled&&U.createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:this.environment,perform:r=>{Us.nA({selectionKey:{collectionViewBlockStore:i,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,event:e,transaction:r})}})},this.handleCopy=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,i=this.props.collectionContextStore.collectionViewBlockStore();i&&t&&Us.qn({selectionKey:{collectionViewBlockStore:i,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,event:e})},this.handlePaste=e=>{const{collectionContextStore:t,groupFormat:o,schema:i,showPropertyFormatsStore:r,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:s}=this.props,l=this.normalizedTableSelectionStore.state,a=this.props.collectionContextStore.collectionViewBlockStore();a&&l&&!this.props.disabled&&U.createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:this.environment,perform:c=>{Us.j0({environment:this.environment,collectionContextStore:t,selectionKey:{collectionViewBlockStore:a,groupFormat:o},selection:l,currentPropertyFormats:r.state,currentRows:this.allRowsStore.state,event:e,transaction:c,schema:i,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:s})}})},this.handleCommandEnter=e=>{const{device:t}=this.environment,o=this.normalizedTableSelectionStore.state;if(t.isMobile||!o)return;const{collectionContextStore:i}=this.props,r=this.allRowsStore.state[o.start.row],{mainEditorCurrentBlockStore:n}=Pe.default.state,s=ue.mb({store:r,mainEditorCurrentBlockStore:n,collectionContextStore:i,fullyQualified:!1});s&&this.navigate(s)},this.handleShiftEnter=()=>{const{device:e}=this.environment;if(e.isMobile)return;const t=this.normalizedTableSelectionStore.state;if(!t)return;if(!ze.M_(this.environment))return;const{collectionContextStore:o,groupFormat:i}=this.props;if(!o.shouldAllowNewItemCreation())return;const r=this.allRowsStore.state,n=r[t.start.row],s=o.subitemTreeStore.state,a=(0,is.DY)(s.children,(e=>e.value.store===n)),c="table_selection_overlay_shift_enter";if(a){const e=a?(0,ss.Af)(a.map((e=>e.value.store))):"",s=o.subitemExpandedStore.state.get(e),d=Boolean(null==s?void 0:s.isExpanded),p=[...a].splice(0,a.length-1),h=p?(0,ss.Af)(p.map((e=>e.value.store))):"",m=o.subitemExpandedStore.state.get(h),g=Boolean(null==m?void 0:m.isExpanded);if(d||g)U.createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:this.environment,perform:e=>{const t=o.collectionStore();if(!t)return;const r=_.yk({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],store:n,before:!1,collectionStore:t,transaction:e,subitemPath:a,subitemInsertDirection:g&&!d?"below":"into"});r&&this.props.blockPropertyValueOverlayStore&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{rs.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r,property:"title",format:Si.C.Table,collectionContextStore:o})}))}))}});else{const e={col:t.end.col,row:o.currentViewHasSort()?r.length:t.end.row+1};U.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const r=_.IW({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],insertAtIndex:e.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:c});if(r&&!r.coercionSucceeded){const e=i?[i]:[],t=o.groupsStore.getGroupState(e);$e.CH({environment:this.environment,store:r.newStore,peekMode:ue.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o,pageVisitSource:u.tY.Create})}}}),l.default.afterNextFlush((()=>{this.setSelection({selection:{start:e,end:e},shouldNormalize:!1})}))}}else{const e={col:t.end.col,row:o.currentViewHasSort()?r.length:t.end.row+1};U.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const r=_.IW({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],insertAtIndex:e.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:c});if(r&&!r.coercionSucceeded){const e=i?[i]:[],t=o.groupsStore.getGroupState(e);$e.CH({environment:this.environment,store:r.newStore,peekMode:ue.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o,pageVisitSource:u.tY.Create})}}}),l.default.afterNextFlush((()=>{this.setSelection({selection:{start:e,end:e},shouldNormalize:!1})}))}this.updateSelectionScroll(ua.Down),rs.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handleDuplicate=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;o&&o.start.col===o.end.col&&!this.props.disabled&&ze.M_(this.environment)&&(e.preventDefault(),U.createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:o,start:o.start})}}))},this.handleCommandShiftEnter=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;if(o){const e=this.allRowsStore.state[o.start.row],t=(0,he.ZP)({store:e,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage});ra.D({environment:this.environment,url:t})}},this.handleKeypress=e=>{if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),aa.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const i=this.allRowsStore.state[o.start.row],r=this.props.showPropertyFormatsStore.state[o.start.col].property,n=t[r];n&&!this.props.disabled&&Go.ub.includes(n.type)&&e.key&&1===e.key.length&&(rs.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:i,property:r,format:Si.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,insertChar:e.key,collectionContextStore:this.props.collectionContextStore}),Z.wG())},this.handlePropertyTab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),r=this.props.showPropertyFormatsStore.state,n={col:Math.min(i.col+1,r.length-1),row:i.row};this.setSelection({selection:{start:n,end:n},shouldNormalize:!0}),this.updateSelectionScroll(ua.Right),rs.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyUntab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),r={col:Math.max(i.col-1,0),row:i.row};this.setSelection({selection:{start:r,end:r},shouldNormalize:!0}),this.updateSelectionScroll(ua.Left),rs.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyEnter=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(!e.isOpen)return;const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),r={col:i.col,row:i.row+1};l.default.afterNextFlush((()=>{va(this.props.blockPropertyValueOverlayStore,this.environment)&&this.setSelection({selection:{start:r,end:r},shouldNormalize:!0})})),this.updateSelectionScroll(ua.Down),rs.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handlePropertyClick=(e,t,o)=>{var i;const{device:r}=this.environment;if("checkbox"!==(null===(i=o[t])||void 0===i?void 0:i.type)||r.isMobile)Z.wG();else{const o=this.getCellPositionOfStore(e,t);this.setSelection({selection:{start:o,end:o},shouldNormalize:!0})}},this.dismissPropertyOverlay=e=>{const{device:t}=this.environment,o=this.props.blockPropertyValueOverlayStore.state;if(o.isOpen){const{store:i,property:r}=o,n=this.getCellPositionOfStore(i,r);t.isMobile?Z.wG():va(this.props.blockPropertyValueOverlayStore,this.environment)&&this.setSelection({selection:{start:n,end:n},shouldNormalize:!0}),this.updateSelectionScroll(ua.Down),rs.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),null==e||e(o)}},this.handlePropertyBgClick=()=>{this.dismissPropertyOverlay()},this.handlePropertyEsc=()=>{this.dismissPropertyOverlay((e=>{const{isNewBlock:t,store:o}=e;t&&o.isEmptyTitle()&&o.isEmptyPage()&&U.createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:this.environment,perform:e=>{na.y8({environment:this.environment,blocks:[o],transaction:e}),e.postSubmitCallbacks.push((e=>{if(!e){const e=this.props.collectionContextStore.collectionStore(),t=this.props.collectionContextStore.collectionViewBlockStore();M.dhV(this.environment,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:o.id,block_type:"page",collection_id:null==e?void 0:e.id,collection_view_id:null==t?void 0:t.id})}}))}})}))},this.handlePropertyContextMenu=e=>{const{collectionContextStore:t}=this.props;e.preventDefault();const o=this.allRowsStore.state,i=this.normalizedTableSelectionStore.state,r=ga(e.target);let n=!1;if(i&&r){const s=Math.min(i.start.row,i.end.row),l=Math.max(i.start.row,i.end.row);if(r.row>=s&&r.row<=l){const i=o.slice(s,l+1);i.length>0&&(G.Z5({environment:this.environment,stores:i}),G.Ys({environment:this.environment,store:i[0]}),oa.Qn({environment:this.environment,stores:eo.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:t.getAnalyticsFromOverride()??"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:t}}),n=!0)}}if(!n&&r){const i=o[r.row];i&&(G.Ys({environment:this.environment,store:i}),oa.Qn({environment:this.environment,stores:eo.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:t.getAnalyticsFromOverride()??"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:t}}))}},this.handleRowSelectableEnter=e=>{const t=this.allRowsStore.state,o=e.blocks.map((e=>t.indexOf(e))),i=x.VV(o)||0,r=x.Fp(o)||0;i>=0&&r>=0&&this.setSelection({selection:{start:{col:0,row:i},end:{col:0,row:r}},shouldNormalize:!0})},this.handleRowsWrapMount=e=>{this.rowsWrapEl=e},this.handleRowsObserverChange=()=>{this.selectionStartRectStore.recompute()},this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,ss.A7)(e,t)})),this.normalizedTableSelectionStore=this.createComputedStore((()=>{const e=Gl.Z.state,t=this.props.collectionContextStore.collectionViewBlockStore();if(!t)return;const{groupFormat:o}=this.props;if(!e.isActive||!(0,Gl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:o}))return;const{selection:i}=e;return this.normalizeTableSelection(i)}),!0),this.selectionStartRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.start)}),!0),this.frozenIndex=this.createComputedStore((()=>this.props.collectionContextStore.frozoneStore.state.frozenIndex)),this.maxFrozenIndex=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.frozoneStore.state.scrollerWidth;return null==t?void 0:t.getTableMaxFrozenColumnIndex(o,e.normalizedFormatStore.state)})),this.frozenSectionWidthStore=this.createComputedStore((()=>{const e=this.frozenIndex.state;if(void 0!==e){let t=ya(this.props.collectionContextStore,this.environment);const{showPropertyFormatsStore:o}=this.props,i=o.state;for(let r=0;r<=e&&!(r>=i.length);r++){const e=i[r];e.width&&(t+=e.width)}return t-1}}),!0),this.multiSelectCheckedStore=this.createComputedStore((()=>{const e=function(e,t){const o=t?[t]:[];return(0,ss.A7)(o[0],e)}(this.props.collectionContextStore,this.props.groupFormat),t=e.length;if(0===t)return!1;const o=eo.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")})),this.shouldRenderFrozenColumnRepositioner=this.createComputedStore((()=>void 0!==this.frozenIndex.state&&!this.stores.dragAndFillStore.state&&!this.multiSelectCheckedStore.state&&!Gl.Z.state.isActive&&void 0===this.props.tableStore.state.temporaryFormat&&this.props.collectionContextStore.permissionScopes.state.canConfigureBlock))}willUnmount(){super.willUnmount(),this.observer&&this.observer.disconnect()}didMount(){super.didMount(),this.rowsWrapEl&&(this.observer=new MutationObserver(this.handleRowsObserverChange),this.observer.observe(this.rowsWrapEl,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}renderComponent(){const{store:e,schema:t,showPropertyFormatsStore:o}=this.props,i=this.normalizedTableSelectionStore.state,r=Sa(this.props.disabled,this.props.collectionContextStore)&&i&&(i.start.col===i.end.col&&i.start.row===i.end.row||this.stores.dragAndFillStore.state)?(0,kt.jsx)(ha,{store:e,schema:t,selection:i,dragAndFillStore:this.stores.dragAndFillStore,showPropertyFormatsStore:o,selectionStartRectStore:this.selectionStartRectStore,rowsWrapRect:this.getRowsWrapRect(),frozenIndexStore:this.frozenIndex,currentRowsStore:this.allRowsStore}):null,n=this.shouldRenderFrozenColumnRepositioner.state?(0,kt.jsx)(da,{frozenColumnRepositionStore:this.stores.frozenColumnRepositionStore,frozenIndex:this.frozenIndex.state,maxFrozenIndex:this.maxFrozenIndex.state,xForFirstCellInRow:ya(this.props.collectionContextStore,this.environment),showPropertyFormats:o.state,frozenSectionWidth:this.frozenSectionWidthStore.state}):null,s=this.props.render({onPropertyTab:this.handlePropertyTab,onPropertyUntab:this.handlePropertyUntab,onPropertyEnter:this.handlePropertyEnter,onPropertyClick:this.handlePropertyClick,onPropertyEsc:this.handlePropertyEsc,onPropertyBgClick:this.handlePropertyBgClick,onPropertyContextMenu:this.handlePropertyContextMenu,onOpenProperty:e=>function(e,t,o,i,r){const n=t.state;if(n.isOpen){const{store:s}=n;rs.bA({environment:r,blockPropertyValueOverlayStore:t,store:s,property:e,format:Si.C.Table,disableHorizontalEdgeScroll:o,collectionContextStore:i})}}(e,this.props.blockPropertyValueOverlayStore,this.props.disableHorizontalEdgeScroll,this.props.collectionContextStore,this.environment),onSelectableEnter:this.handleRowSelectableEnter});return(0,kt.jsx)(Wl.Z,{capture:void 0!==this.normalizedTableSelectionStore.state,onLeft:this.handleLeft,onRight:this.handleRight,onUp:this.handleUp,onDown:this.handleDown,onEnter:this.handleEnter,onTab:this.handleTab,onUntab:this.handleUntab,onEsc:this.handleEsc,onDelete:this.handleDelete,onBackspace:this.handleDelete,onCut:this.handleCut,onCopy:this.handleCopy,onPaste:this.handlePaste,onCommandEnter:this.handleCommandEnter,onShiftEnter:this.handleShiftEnter,onCommandShiftEnter:this.handleCommandShiftEnter,onDuplicate:this.handleDuplicate,onKeypress:this.handleKeypress,onMoveTo:this.handleMoveTo,children:(0,kt.jsx)(vi.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,render:e=>(0,kt.jsxs)("div",{style:{position:"relative",minWidth:this.props.minWidth},...e,ref:this.handleRowsWrapMount,children:[n,r,s]})})})}repositionFrozenColumns(){const{collectionContextStore:e}=this.props;this.stores.frozenColumnRepositionStore.state.isRepositioning&&U.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:this.environment,perform:t=>{Us.oz({environment:this.environment,collectionContextStore:e,currentIndex:this.stores.frozenColumnRepositionStore.state.newFrozenIndex,transaction:t,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),this.stores.frozenColumnRepositionStore.reset()}})}dragAndFillCells(){var e;const t=this.stores.dragAndFillStore.state;if(!t)return;const{start:o,end:i}=t;if(o.col!==i.col||o.row!==i.row)return;const{showPropertyFormatsStore:r,schema:n,collectionContextStore:s}=this.props,l=null===(e=n[r.state[o.col].property])||void 0===e?void 0:e.type;if("verification"===l)return;const a=this.normalizedTableSelectionStore.state;if(!a)return;U.createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:a,start:o})}});const c=Math.min(a.start.row,a.end.row),d=Math.max(a.start.row,a.end.row);l&&d!==c&&j.qm({environment:this.environment,collectionContextStore:s,property_type:l,num_rows:d-c}),this.stores.dragAndFillStore.reset()}setSelection(e){const{selection:t,shouldNormalize:o}=e,i=this.props.collectionContextStore.collectionViewBlockStore();i&&(Us.Z5({environment:this.environment,selectionKey:{collectionViewBlockStore:i,groupFormat:this.props.groupFormat},selection:o?this.normalizeTableSelection(t):t}),this.selectionStartRectStore.recompute())}getCellPositionOfStore(e,t){const o=this.allRowsStore.state;return{col:this.props.showPropertyFormatsStore.state.findIndex((e=>e.property===t)),row:o.findIndex((t=>e===t))}}getRowsWrapRect(){return this.rowsWrapEl?this.rowsWrapEl.getBoundingClientRect():void 0}updateSelectionScroll(e){const t=this.normalizedTableSelectionStore.state;if(t){let o;o=e===ua.Down?t.start.row>t.end.row?t.start:t.end:e===ua.Up?t.start.row<t.end.row?t.start:t.end:e===ua.Right?t.start.col>t.end.row?t.start:t.end:t.start.col<t.end.row?t.start:t.end;const i=this.allRowsStore.state[o.row],r=this.props.showPropertyFormatsStore.state[o.col].property,n=fl.Z.findBlockPropertyValue(i,r),s=(null==n?void 0:n.getNode())??null;if(s){const e=this.frozenSectionWidthStore.state??0,o=this.frozenIndex.state,i=this.props.disableHorizontalEdgeScroll||o&&t.start.col<=o&&t.end.col<=o;z.bx({element:s,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:i?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollers:{verticalScroller:null==n?void 0:n.getContextVerticalScroller(),horizontalScroller:null==n?void 0:n.getContextHorizontalScroller()}})}}}scrollToStart(){var e;const{collectionContextStore:t}=this.props;if(!t.frozoneStore.state.isScrolled)return;const o=this.allRowsStore.state[0],i=this.props.showPropertyFormatsStore.state[0].property,r=fl.Z.findBlockPropertyValue(o,i),n=t.frozoneStore.state.scrollerLeftOffset??0,s=(0,we.Wk)(this.environment),l=Math.max(s-n,0),a=(0,as.iZ)(this.environment,t)?l:0;null==r||null===(e=r.getContextHorizontalScroller())||void 0===e||e.scrollTo(void 0,this.props.paddingLeft-a)}copyValuesToSelectionFromStart(e){const{transaction:t,selection:o,start:i}=e,{showPropertyFormatsStore:r}=this.props,n=this.allRowsStore.state,s=r.state[i.col],l=n[i.row].getPropertyValue(s.property)||[],a=Math.min(o.start.row,o.end.row),c=Math.max(o.start.row,o.end.row);n.slice(a,c+1).forEach((e=>{e.pointer!==n[i.row].pointer&&Ue.sO({store:e.getPropertyStore(s.property),value:l,transaction:t})}))}normalizeTableSelection(e){const t=fa(this.props.showPropertyFormatsStore),o=this.allRowsStore.state.length;return{start:{col:(0,ea.Z)(e.start.col,0,t-1),row:(0,ea.Z)(e.start.row,0,o-1)},end:{col:(0,ea.Z)(e.end.col,0,t-1),row:(0,ea.Z)(e.end.row,0,o-1)}}}getCellRect(e){const{rowsWrapEl:t}=this;if(!t)return;const{showPropertyFormatsStore:o}=this.props,i=o.state,r=function(e,t){if(!t)return;const o=si.C.findSelectablesFromStore(e),i=o.map((e=>e.getNode())).find((e=>t.contains(e)));if(!i)return;return i.getBoundingClientRect()}(this.allRowsStore.state[e.row],t);if(!r)return;const n=t.getBoundingClientRect(),s=r.height,l=r.top-n.top-1,a=i[e.col].width||0,c=s+1;let d=ya(this.props.collectionContextStore,this.environment);for(let u=0;u<e.col;u++){const e=i[u];e.width&&(d+=e.width)}return new DOMRect(d-1,l,a+1,c)}}pa.displayName="TableSelectionOverlay",pa.contextTypes={...X.wK,...s.w};function ha(e){var t;window.__c={n:"DragAndFillHandle"};const{store:o,schema:i,selection:r,dragAndFillStore:n,currentRowsStore:s,showPropertyFormatsStore:l,selectionStartRectStore:a,rowsWrapRect:d,frozenIndexStore:u}=e,p=(0,c.VK)((()=>n.state),[n]),h=(0,c.VK)((()=>{const e=(null==p?void 0:p.start)||r.start;return l.state[e.col]}),[p,r,l]),m=(0,V.useIntl)(),g=(0,c.VK)((()=>{if(!p||!h)return[];const{start:e}=p,t=s.state[e.row].getModel();return t?(0,ta.v4)({property:h.property,schema:i,block:t,getRecordValue:o.getRecordValue,userTimeZone:(0,nt.r)(),baseURL:void 0,intl:m}):""}),[s,p,m,h,i,o]),S=h?null===(t=i[h.property])||void 0===t?void 0:t.type:void 0,f=(0,c.VK)((()=>a.state),[a]),v=(0,c.VK)((()=>u.state),[u]),y=(0,c.VK)((()=>void 0!==v&&r.start.col<=v),[v,r]),C=(0,Ht.yK)((e=>({dragAndFillContainer:{zIndex:y?T.hc+4:void 0,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:y?"sticky":void 0,left:"0"},tooltipContainer:{position:"absolute",left:f?f.left+f.width-5:void 0,zIndex:T.IK},tooltipOrigin:{position:"absolute",left:0,top:f?f.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:f?f.bottom-5:void 0,width:9,height:9,border:`2px solid ${Wo.ZP.blueWithAlpha(.57)}`,transform:p?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...R.Z.textOverflowStyle}})),[y,f,p]);if(!f)return null;if(!S||Go.ZY(S)||"rollup"===S||"formula"===S||"verification"===S)return null;let x;return d&&(x=new DOMRect(f.x+d.x+f.width-4,f.y+d.y+f.height-4,7,7)),(0,kt.jsx)(bt.ZP,{renderTooltip:()=>{const e=(0,kt.jsx)(V.FormattedMessage,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"});return p?(0,kt.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e,(0,kt.jsx)("div",{style:C.tooltipText,children:g})]}):e},delayThreshold:300,forceVisibleState:!!p||void 0,originRect:x,placement:ps.u.Right,render:e=>(0,kt.jsx)("div",{...e,className:re.JR_,style:C.dragAndFillContainer,children:(0,kt.jsx)("div",{style:C.dragAndFillOutsideStickyWrapper,children:(0,kt.jsx)("div",{style:C.dragAndFillInsideStickyWrapper,children:(0,kt.jsxs)("div",{style:C.tooltipContainer,children:[(0,kt.jsx)("div",{style:C.tooltipOrigin}),(0,kt.jsx)("div",{style:C.tooltipCircle})]})})})})})}function ma(e){window.__c={n:"TableSelectionOverlayWithDeps"};const{value:t}=(0,ye.useDependency)(ye.deps.markdownLinkifyIt),{value:o}=(0,ye.useDependency)(ye.deps.tinyMceMicrosoftWordPasteFilter);return(0,kt.jsx)(pa,{...e,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:o})}function ga(e){let t=e;for(;null!==t&&!t.classList.contains(re.mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function Sa(e,t){const o=t.permissionScopes.state;return!(e||!o.canEditContent)&&"on"===Fe.default.getEligibleGroup({experimentId:"collection_table_drag_and_fill",defaultGroup:"control"})}function fa(e){return e.state.length}function va(e,t){if(!(0,sa.zq)(t))return!0;const o=e.state;return!o.isOpen||0===o.additionalStores.length}function ya(e,t){return(0,ue.fk)({environment:t,collectionContextStore:e})?as.Xx:0}function Ca(e){window.__c={n:"TableShimmer"};const{isFullScreen:t,hasGroups:o,propertyWidths:i,hasPartialResults:r,hasSearchQuery:n,frozoneProps:s}=e,l=(0,et.O7)(),a=(0,Ht.Fg)(),d=(0,et.Fy)().isPhone,u=(0,Q.DK)(),p=(0,Zn.Z)(!0,0,100),h=(0,c.VK)((()=>Boolean(null==u?void 0:u.normalizedFormatStore.state.hide_table_vertical_lines)),[u]),m=(0,c.VK)((()=>!!u&&(0,ue.fk)({environment:l,collectionContextStore:u})),[u,l]),g=s.isScrolled,S=s.frozenIndex,f=void 0!==S,v=(0,c.VK)((()=>{if(!u)return!1;const e=u.collectionViewBlockStore();return!!e&&(0,ls.sY)(e)}),[u]),y=(0,c.VK)((()=>u?(0,as.oc)({environment:l,collectionContextStore:u,isPhone:d,theme:a}):{}),[u,l,d,a]),C=(0,Ht.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...y,...-1===S?{background:void 0}:{}},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...y},rowContainer:{display:"flex",alignItems:"flex-start",padding:f?void 0:"0px 16px",borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:f?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:h?void 0:`1px solid ${e.tableDividerColor}`}})),[y,S,f,h]);if(!p||!u)return null;const x=i.map(((e,t)=>(0,kt.jsx)("div",{style:{...C.column,width:e},children:(0,kt.jsx)(Wt.Z,{style:{...C.rowShimmer,width:.6*(e-16)}})},t)));let b=null,w=[];if(f&&void 0!==S){const e=x.slice(0,S+1);b=(0,kt.jsxs)("div",{style:C.frozenColumnsContainer,children:[(0,kt.jsxs)(Kl,{isCollectionViewBlockSelected:v,shouldFreeze:-1!==S,children:[m&&(0,kt.jsx)("div",{style:{width:32,height:31}}),e]}),e.length>0?(0,kt.jsx)(Ms,{passesFilter:!0,isShimmerRow:!0,isScrolled:g}):null]}),w=x.slice(S+1,x.length)}else w=x;let k=1;o||r||n||(k=t?10:3);const P=[...Array(k)].map(((e,t)=>(0,kt.jsxs)("div",{style:C.rowContainer,children:[b,w]},t)));return(0,kt.jsx)("div",{style:C.container,children:(0,kt.jsx)("div",{style:C.rowsContainer,children:P})})}class xa extends ee.Z{constructor(){super(...arguments),this.onItemShiftEnter=()=>{const e=this.groupStateStore.state;if(!e)return;const{collectionContextStore:t,blockPropertyValueOverlayStore:o}=this.props,i=t.collectionStore();if(!i||!t.shouldAllowNewItemCreation())return;const r=eo.default.state.stores[0];if(!r)return;const n=t.subitemTreeStore.state,s=(0,is.DY)(n.children,(e=>e.value.store===r));if(!s)return;const a=s?(0,ss.Af)(s.map((e=>e.value.store))):"",c=t.subitemExpandedStore.state.get(a);Boolean(null==c?void 0:c.isExpanded)&&U.createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:this.environment,perform:n=>{const a=_.yk({environment:this.environment,collectionContextStore:t,groupsPointer:e.groupsPointer,store:r,before:!1,collectionStore:i,transaction:n,subitemPath:s,subitemInsertDirection:"into"});a&&o&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{rs.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:o,store:a,property:"title",format:Si.C.Table,collectionContextStore:t})}))}))}})},this.handleAddRowClick=e=>{const t=new ns.sA(this.environment,"handleAddRowClick"),{collectionContextStore:o,isFullScreen:i,groupFormat:r}=this.props,{device:n}=this.environment,s=r?[r]:[],a=o.groupsStore.getGroupState(s);ze.M_(this.environment)&&a?(o.searchQuery.state&&Z.Ug({searchQuery:"",collectionContextStore:o,isFullScreen:i}),U.createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:this.environment,perform:i=>{const s=_.IW({environment:this.environment,collectionContextStore:o,groupsPointer:r?[r]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"table_group_results",tracker:t,useCrdt:(0,J.SL)(e,"collection_table_view")});if(!s)return;const c=s.newStore;if(n.isMobile){const e=(0,he.ZP)({store:c,fullyQualified:!1,pageVisitSource:u.tY.Create});this.navigate(e)}else{l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{s.coercionSucceeded?rs.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:c,property:"title",format:Si.C.Table,collectionContextStore:o}):$e.CH({environment:this.environment,store:c,peekMode:ue.kr(o.collectionViewStore()),resultsStore:a.resultsStore,collectionContextStore:o,pageVisitSource:u.tY.Create})}))}))}));const e=o.subitemTreeStore.state;M.W2j(this.environment,{from:e.children?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:c.id,creating_block_id:c.id,...(0,le.Pn)(o)})}}})):t.fail("invalid_state")},this.groupStateStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=t?[t]:[];return e.groupsStore.getGroupState(o)})),this.showPropertyFormatsStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=function(e,t){const o=ka(e,t);return o&&o.table_properties?o.table_properties:[]}(this.props.format,this.props.tableStore).filter((e=>e.visible));return e.isMobile?t.slice(0,20):t}),!0),this.tableWidthStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return this.showPropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0)+(e.permissionScopes.getState().canEditContent?32:0)})),this.propertiesWidthStore=this.createComputedStore((()=>this.showPropertyFormatsStore.state.map((e=>e.width||di.Nx)))),this.titleColumnIndexStore=this.createComputedStore((()=>this.showPropertyFormatsStore.state.findIndex((e=>"title"===e.property)))),this.anyItemsInGroupsSelected=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,{groupFormat:t}=this.props,o=t?[t]:[],i=(0,ss.A7)(o[0],e);return eo.default.state.stores.filter((e=>i.includes(e))).length>0})),this.frozonePropsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,{device:t,ThemeModeStore:o}=this.environment,{isScrolled:i,frozenIndex:r,tryShowHiddenFrozenColumn:n}=e.frozoneStore.state;if(void 0===r)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const s=(0,Wo.gh)({theme:o.state}),l={...(0,as.oc)({environment:this.environment,collectionContextStore:e,isPhone:t.isPhone,theme:s}),display:"flex",...i&&-1===r&&{height:"calc(100% + 1px)",borderBottom:`1px solid ${s.tableDividerColor}`}},a=Boolean(i&&-1===r),c=Boolean(a&&(n||this.anyItemsInGroupsSelected.state)),d=e.collectionViewBlockStore();return{isScrolled:i??!1,frozenIndex:r,frozenStyles:l,shouldFreezeMultiSelectColumn:a,shouldShowStickyMultiSelectColumn:c,isCollectionViewBlockSelected:!!d&&(0,ls.sY)(d)}}),!0)}renderComponent(){const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,i=this.groupStateStore.state;if(!i)return;const r=i.reducerResultStore.state,n=void 0!==r,s=ue.VM({collectionContextStore:e,reducerResult:r,isFullScreen:t}),l=void 0!==o,a=o?[o]:[],c=void 0!==r&&(null==r?void 0:r.blockIds.length)>0,d=""!==e.searchQuery.state,u=(0,Qe.H0)({collectionContextStore:e,groupsPointer:a,hasPartialResults:c}),p=n&&!u&&0===(null==r?void 0:r.blockIds.length);return(0,kt.jsxs)(kt.Fragment,{children:[this.renderHeaderRow(i),(0,kt.jsx)("div",{style:{height:Ta}}),this.renderRows(),u&&(0,kt.jsx)(Ca,{isFullScreen:t,hasGroups:l,propertyWidths:this.propertiesWidthStore.state,hasPartialResults:c,hasSearchQuery:d,frozoneProps:this.frozonePropsStore.state}),p&&(0,kt.jsx)(xs,{collectionContextStore:this.props.collectionContextStore,shouldShowAddRowButton:this.shouldShowAddRowButton(),handleAddRowClick:this.handleAddRowClick,paddingLeft:this.props.paddingLeft}),(0,kt.jsx)("div",{style:{width:this.tableWidthStore.state}}),s&&this.renderLoadMoreButton(),this.shouldShowAddRowButton()&&this.renderAddRowButton(),this.renderAggregationRow(),(0,kt.jsx)("div",{style:{height:Ma}})]})}renderHeaderRow(e){const{store:t,schema:o,query:i,disabled:r,collectionContextStore:n,minWidth:s,paddingBottom:l,isInPeekRenderer:a,blockPropertyValueOverlayStore:c,groupFormat:d}=this.props,u=n.viewIsFlushToTopbar(),p=n.permissionScopes.state,h=Boolean(d),m=u&&!h,g=Boolean(n.normalizedFormatStore.state.hide_table_vertical_lines);return(0,kt.jsx)(Fl,{store:t,format:ka(this.props.format,this.props.tableStore),groupFormat:d,schema:o,query:i,collectionContextStore:n,isInPeekRenderer:a,minWidth:s,paddingBottom:l,blockPropertyValueOverlayStore:c,resultStore:e.reducerResultStore,showPropertyFormatsStore:this.showPropertyFormatsStore,showRightActions:p.canConfigureCollection&&p.canConfigureBlock,allowHidingTitle:!1,tableStore:this.props.tableStore,formatKey:"table_properties",disabled:r||!p.canConfigureCollection&&!p.canConfigureBlock,disableTopBorder:!m,disableCellRightBorder:!m||g,height:Ta,frozoneProps:this.frozonePropsStore.state})}renderRows(){const{device:e}=this.environment,{store:t,schema:o,query:i,disabled:r,collectionContextStore:n,minWidth:s,blockPropertyValueOverlayStore:l,groupFormat:a}=this.props,c=n.collectionViewStore();if(!c)return;const d=this.canEditTable()&&e.isMobile&&!c.isSyncedCollection(),u=this.titleColumnIndexStore.state;return(0,kt.jsx)(ma,{store:t,format:ka(this.props.format,this.props.tableStore),schema:o,query:i,collectionContextStore:n,minWidth:s,blockPropertyValueOverlayStore:l,showPropertyFormatsStore:this.showPropertyFormatsStore,disabled:!this.canEditTable(),groupFormat:a,tableStore:this.props.tableStore,paddingLeft:this.props.paddingLeft,render:e=>(0,kt.jsx)(ba,{args:e,store:t,collectionContextStore:n,collectionViewFormat:ka(this.props.format,this.props.tableStore),blockPropertyValueOverlayStore:l,groupFormat:a,propertyFormats:this.showPropertyFormatsStore.state,schema:o,canDrag:d,disabled:r,titleColumnIndex:u,onShiftEnter:this.onItemShiftEnter,frozoneProps:this.frozonePropsStore.state})})}renderLoadMoreButton(){const{collectionContextStore:e,format:t,groupFormat:o}=this.props,i=o?[o]:[],r=(0,Qe.$t)({collectionContextStore:e,groupsPointer:i});return(0,kt.jsx)(io.Z,{onMouseDown:me.$0,onClick:e=>function(e,t,o,i,r){const n=t.groupsStore.getGroupState(o);if(!n)return;const s=n.reducerResultStore.state;(0,me.Wi)(e),G.ZH(r),s&&_.ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:n.groupsPointer,incrementLimitsInRelatedGroups:!1}});st.j({name:"collection_load_more"}),M.uDZ(r)}(e,this.props.collectionContextStore,this.props.groupFormat,this.props.isFullScreen,this.environment),disabled:r,hoveredStyle:r?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:Va+1,width:"100%",paddingLeft:ja,paddingBottom:2,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"},children:(0,kt.jsxs)("span",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,position:"sticky",left:ja},children:[(0,os.M)(Pa(this.theme)),(0,kt.jsx)(V.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"}),r?(0,kt.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,kt.jsx)(no.Z,{style:{width:12,height:12}})}):this.canEditTable()&&(0,kt.jsx)(ds.Z,{collectionContextStore:e,format:t})]})})}renderAggregationRow(){const{store:e,schema:t,query:o,disabled:i,collectionContextStore:r,blockPropertyValueOverlayStore:n,showHoverActionsStore:s,minWidth:l,paddingBottom:a,isInPeekRenderer:c,isFullScreen:d,groupFormat:u}=this.props,p=r.permissionScopes.state;return(0,kt.jsx)(ys,{store:e,groupFormat:u,disabled:i||!p.canConfigureBlock,format:ka(this.props.format,this.props.tableStore),schema:t,query:o,collectionContextStore:r,blockPropertyValueOverlayStore:n,isInPeekRenderer:c,isFullScreen:d,minWidth:l,paddingBottom:a,showPropertyFormatsStore:this.showPropertyFormatsStore,showRightActionsSpacer:p.canConfigureCollection,showHoverActionsStore:s,style:{...!this.isReady()&&{opacity:0,pointerEvents:"none",left:0,right:0}}})}renderAddRowButton(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,i=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground);return(0,kt.jsx)(io.Z,{onClick:this.handleAddRowClick,onMouseDown:me.$0,style:{borderBottom:`1px solid ${this.theme.tableDividerColor}`,display:"flex",alignItems:"center",height:Va,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:i,left:0,right:0},className:re.tfM,children:(0,kt.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",position:"sticky",left:8,color:this.theme.lightTextColor},children:[(0,y.R)(Pa(this.theme)),(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"New",id:"database.tableView.addRowButton"})]})})}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}shouldShowAddRowButton(){const{collectionContextStore:e}=this.props;return Boolean(this.isReady()&&this.canEditTable()&&e.shouldAllowNewItemCreation())}isReady(){var e;return void 0!==(null===(e=this.groupStateStore.state)||void 0===e?void 0:e.reducerResultStore.state)}canEditTable(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state;return!!this.canEdit()&&(!t.isSyncedCollection&&t.canEditContent)}}function ba(e){window.__c={n:"TableSelectionOverlayInner"};const t=(0,et.O7)(),{args:o,store:i,collectionContextStore:n,collectionViewFormat:s,blockPropertyValueOverlayStore:a,groupFormat:d,propertyFormats:u,schema:p,canDrag:h,disabled:m,titleColumnIndex:g,onShiftEnter:S,frozoneProps:f}=e,v=(0,r.useMemo)((()=>d?[d]:[]),[d]),y=(0,c.VK)((()=>n.permissionScopes.state),[n.permissionScopes]),C=(0,c.VK)((()=>Boolean(n.normalizedFormatStore.state.hide_table_vertical_lines)),[n.normalizedFormatStore]),x=(0,Ht.yK)((e=>({itemSelectableHalo:{borderRadius:0,zIndex:T.IK}})),[]),b=(0,Ht.Fg)(),w=(0,r.useCallback)((()=>({display:"flex",height:"calc(100% + 2px)",borderBottom:`1px solid ${b.tableDividerColor}`})),[b.tableDividerColor]),k=(0,r.useCallback)((e=>{const{store:o,parentStore:i,subitemPath:r,indentLevel:s}=e;if(i)return(0,kt.jsx)(cs.x,{store:o,collectionStore:i,subitemPath:r,indentLevel:s,collectionContextStore:n,disabled:m,groupsPointer:v,onSubitemCreate:e=>{a&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{rs.bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:a,store:e,property:"title",format:Si.C.Table,collectionContextStore:n})}))}))}})}),[a,n,m,t,v]),P=(0,c.VK)((()=>ue.fk({environment:t,collectionContextStore:n})),[n,t]),R=(0,c.VK)((()=>i.isLocked()),[i]),V=(0,r.useMemo)((()=>({schema:p,collectionContextStore:n,propertyFormats:u,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:m,blockPropertyValueOverlayStore:a,showRightActionsSpacer:y.canConfigureCollection,disableCellBorderRight:C,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:!y.canConfigureCollection||R,disableTableWrap:!1,onShiftEnter:S,titleColumnIndex:g,groupFormat:d,frozoneProps:f,shouldShowMultiSelectCheckbox:P})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,a,n,m,C,S,y.canConfigureCollection,u,p,g,d,f,P,R]);return(0,kt.jsx)(oo.Z,{collectionContextStore:n,groupsPointer:v,format:s,canDrag:h,resultProps:V,canDrop:!0,resultComponent:Jl,disabled:m,direction:oo.R.Vertical,getItemSelectableStyle:w,itemSelectableHaloStyle:x.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:a,titleColumnIndex:g,nestedCreateSubitemButton:k})}xa.contextTypes={...X.wK,...s.w};const wa=(0,V.injectIntl)(xa);function ka(e,t){const{temporaryFormat:o}=t.state;return o||e}function Pa(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}const Ra={position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums"},Ta=34,Va=32,Ma=32,ja=8;class Fa extends ee.Z{constructor(){super(...arguments),this.storeTypes={tableStore:tn},this.viewSettingsSidebarOpen=this.createComputedStore((()=>{var e;return this.props.collectionContextStore.settingsStore.state.open&&"sidebar"===(null===(e=this.props.viewSettingsPlacementStore)||void 0===e?void 0:e.state)}))}renderPersisted(){const{store:e,paddingBottom:t,paddingLeft:o,paddingRight:i,isFullScreen:r,collectionContextStore:n,format:s}=this.props,l=ue.az(n,r),a=s.collection_group_by;return(0,Xe.Z)((s=>{const c=(0,kt.jsx)(ao.Z,{store:e,shouldShowHalo:!r,canSelect:!r,analyticsName:"table",style:{position:"relative"},...s,children:a?this.renderGroups(a):this.renderGroupResults(void 0)});return(0,kt.jsxs)("div",{style:{...Ra,paddingBottom:t,paddingLeft:o,paddingRight:i+(this.viewSettingsSidebarOpen.state?Mo.nJ+20:0)},className:re._so,children:[a?c:(0,kt.jsx)(Io.Z,{renderEmitter:n.renderEmitter,isFullScreen:r,children:c}),!l&&(0,kt.jsx)(lo.Z,{onChange:e=>function(e,t,o,i){const r=t.isLoading.state,n=t.groupsStore.getGroupState([]),s=null==n?void 0:n.reducerResultStore.state;e<Ve.Z.incrementScrollOffset&&s&&!r&&s.hasMore&&(t.infiniteScrollLongTaskObserver.observe(),_.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment)})]})}))}renderGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,kt.jsx)(Ro.Z,{store:t,id:"table_groups",groupBy:e,groupsFormatKey:He.Uh,groupAggregationKey:He.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:e=>this.renderGroupResults(e),renderHeader:e=>(0,kt.jsx)(Ba,{args:e,isInPeekRenderer:this.props.isInPeekRenderer}),onGroupHeaderAddItem:(e,t,o)=>function(e,t,o,i,r){if(r.device.isMobile)qe._({environment:r,store:e,pageVisitSource:u.tY.Create});else{const{groupFormat:t}=o,n=t?[t]:[],s=i.groupsStore.getGroupState(n);$e.CH({environment:r,store:e,peekMode:ue.kr(i.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:i,pageVisitSource:u.tY.Create})}}(e,0,o,this.props.collectionContextStore,this.environment),paddingLeft:l,getGroupStyle:e=>function(e,t,o){const i=t.viewIsFlushToTopbar();if(0===e.index&&!i)return{};if(t.shouldShowSpinner.state&&e.index>0)return{};return{borderTop:`1px solid ${o.tableDividerColor}`}}(e,this.props.collectionContextStore,this.theme),isRootChild:a,isInPeekRenderer:c,stickyLeft:!0})}renderGroupResults(e){const{store:t,format:o,schema:i,query:r,collectionContextStore:n,showHoverActionsStore:s,isFullScreen:l,isInPeekRenderer:a,disabled:c,blockPropertyValueOverlayStore:d,minWidth:u,paddingBottom:p,paddingLeft:h}=this.props;if(n.groupsStore.getGroupState(e?[e]:[]))return(0,kt.jsx)(wa,{tableStore:this.stores.tableStore,groupFormat:e,store:t,format:o,schema:i,query:r,collectionContextStore:n,showHoverActionsStore:s,isFullScreen:l,isInPeekRenderer:a,disabled:c,blockPropertyValueOverlayStore:d,minWidth:u,paddingBottom:p,paddingLeft:h})}}Fa.displayName="Table";const Ia=(0,V.injectIntl)(Fa);function Ba(e){let{args:t,isInPeekRenderer:o}=e;window.__c={n:"GroupHeaderComponent"};const i=(0,Ht.Fg)();return(0,kt.jsx)(Po.Z,{...t,height:42,paddingTop:8,toggleClosedMarginBottom:8,getComputedStickyStyle:e=>function(e,t,o){return{boxShadow:e?`0 -1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,o,i)})}class _a extends s.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()}}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){return(0,kt.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,kt.jsx)(Ea,{timelineState:this.props.timelineState}),(0,kt.jsx)(Oa,{timelineState:this.props.timelineState}),(0,kt.jsx)(La,{timelineState:this.props.timelineState})]})}}_a.displayName="TimelineBackground";const Da=_a;function Aa(e){let{start:t,timelineState:o}=e;window.__c={n:"WeekendIndicatorComponent"};const i=(0,Ht.Fg)(),r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,c.VK)((()=>o.currentRange.state),[o]),s=t.plus({day:2}).startOf("day"),l=(0,de.e$)(r,t.valueOf()-n),a=(0,de.e$)(r,s.valueOf()-n);return(0,kt.jsx)("div",{style:{position:"absolute",left:l,width:a-l,height:"100%",background:i.timelineDarkerBackground}},t.valueOf())}function Za(e){let{time:t,timelineState:o}=e;window.__c={n:"VerticalDividerComponent"};const i=(0,Ht.Fg)(),r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,c.VK)((()=>o.currentRange.state),[o]),s=(0,de.e$)(r,t-n);return(0,kt.jsx)("div",{style:{position:"absolute",left:s,height:"100%",borderRight:`1px solid ${i.regularDividerColor}`}},t)}function La(e){let{timelineState:t}=e;window.__c={n:"NowVerticalDividerComponent"};const o=(0,Ht.Fg)(),r=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:n}=(0,c.VK)((()=>t.currentRange.state),[t]),s=i.ou.now().startOf("minute"),l=Math.floor((0,de.e$)(r,s.valueOf()-n));return(0,kt.jsx)("div",{style:{position:"absolute",left:l,height:"100%",borderRight:`1px solid ${o.timelineRed}`}})}function Ea(e){let{timelineState:t}=e;window.__c={n:"WeekendIndicatorsComponent"};const o=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:r,endTimestamp:n}=(0,c.VK)((()=>t.currentRange.state),[t]),{showWeekendIndicators:s}=de.BJ[o];if(!s)return null;let l=(0,de.DS)(i.ou.fromMillis(r),"day");const a=[];for(;l.valueOf()<n;){6===l.weekday&&a.push((0,kt.jsx)(Aa,{timelineState:t,start:l}));l=(0,de.Ip)(l,"day")}return(0,kt.jsx)(kt.Fragment,{children:a})}function Oa(e){let{timelineState:t}=e;window.__c={n:"VerticalDividersComponent"};const o=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:r,endTimestamp:n}=(0,c.VK)((()=>t.currentRange.state),[t]),{verticalDividerUnit:s}=de.BJ[o];if(!s)return null;const l=[];let a=(0,de.DS)(i.ou.fromMillis(r),s);for(;a.valueOf()<n;){l.push((0,kt.jsx)(Za,{timelineState:t,time:a.valueOf()}));a=(0,de.Ip)(a,s)}return(0,kt.jsx)(kt.Fragment,{children:l})}const Na=function(e){let{store:t,collectionContextStore:o,groupFormat:i}=e;window.__c={n:"CollectionTimelineViewDroppableRow"};const r=(0,et.O7)(),n=(0,c.VK)((()=>za(t)),[t]);return(0,kt.jsx)(ao.Z,{store:t,style:{width:"100%",height:rn.Z+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:n?Ha(n,r,t,o,i):void 0,onInsertAbove:n?Ga(n,r,t,o,i):void 0,onSelectableDrop:e=>function(e,t,o,i,r){const{droppedDirection:n,droppedStores:s,duplicate:l}=e,a=za(o);if(!a)return;const c=i.subitemTreeStore.state,d=(0,is.DY)(c.children,(e=>e.value.store===o)),u=xe.default.mark("collections.drop_item_lag");xe.default.measureAfterNextFlush(u,{environment:t,getData:()=>le.yr({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),U.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,perform:e=>{_.by({environment:t,collectionStore:a,targetStore:o,droppedDirection:n,collectionContextStore:i,groupsPointer:r?[r]:[],droppedStores:s,duplicate:l,transaction:e,subitemPath:d})}})}(e,r,t,o,i),onNativeDrop:e=>function(e,t,o,i,r){const{files:n,droppedDirection:s}=e,l=za(r);if(!l)return;const a=o.collectionViewBlockStore(),c=xe.default.mark("collections.drop_item_lag");xe.default.measureAfterNextFlush(c,{environment:t,getData:()=>le.yr({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),a&&U.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,perform:e=>{_.tQ({environment:t,collectionStore:l,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:i?[i]:[],files:n,transaction:e})}})}(e,r,o,i,t),onRemove:e=>function(e,t){const{transaction:o}=e;if(!za(t))return;_.Od({store:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function za(e){return e.getAssociatedCollectionStore()}function Ha(e,t,o,i,r){return n=>{const{insertStores:s,transaction:l}=n;return _.$T({environment:t,collectionStore:e,collectionContextStore:i,groupsPointer:r?[r]:[],insertStores:s,store:o,before:!1,transaction:l})}}function Ga(e,t,o,i,r){return n=>{const{insertStores:s,transaction:l}=n;return _.$T({environment:t,collectionStore:e,collectionContextStore:i,groupsPointer:r?[r]:[],insertStores:s,store:o,before:!0,transaction:l})}}class Wa extends s.Z{constructor(){super(...arguments),this.instanceStore=void 0}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.instanceStore=new Ee.G(this.environment,e.store.pointer)}renderComponent(){const{device:e}=this.environment,{groupFormat:t,canEdit:o,disabled:i,format:r,collectionContextStore:n}=this.props,s=n.groupsStore.getGroupState(t);if(!s)return;const l=n.permissionScopes.state,a=n.collectionViewStore(),c=o&&l.canEditContent&&!l.isSyncedCollection&&e.isMobile&&!(null!=a&&a.isSyncedCollection());return(0,kt.jsxs)(kt.Fragment,{children:[this.renderEmptyDroppable(),(0,kt.jsx)(oo.Z,{collectionContextStore:n,groupsPointer:s.groupsPointer,format:r,canDrag:c,disableRequest:!0,resultProps:{groupFormat:t,collectionContextStore:n,isLast:!1,handleOpenPeekPage:x.ZT},canDrop:!0,resultComponent:Na,disabled:i,direction:oo.R.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:Ua})]})}renderEmptyDroppable(){if(this.instanceStore){const{canEdit:e}=this.props;return(0,kt.jsx)(ao.Z,{store:this.instanceStore,shouldShowDropZone:e,canDropBelow:e,canNativeDropBelow:e,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,i){const{droppedDirection:r,droppedStores:n,duplicate:s}=e,l=o.collectionStore();if(!l)return;const a=o.groupsStore.getGroupState(t);if(!a)return;const c=o.collectionViewBlockStore(),d=xe.default.mark("collections.drop_item_lag");xe.default.measureAfterNextFlush(d,{environment:i,getData:()=>le.yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),c&&U.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:i,perform:e=>{_.by({environment:i,collectionStore:l,targetStore:c,droppedDirection:r,collectionContextStore:o,groupsPointer:a.groupsPointer,droppedStores:n,duplicate:s,transaction:e})}})}(e,this.props.groupFormat,this.props.collectionContextStore,this.environment),onNativeDrop:e=>function(e,t,o,i){const{files:r,droppedDirection:n}=e,s=t.collectionStore();if(!s)return;const l=t.collectionViewBlockStore(),a=xe.default.mark("collections.drop_item_lag");xe.default.measureAfterNextFlush(a,{environment:i,getData:()=>le.yr({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),l&&U.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:i,perform:e=>{_.tQ({environment:i,collectionStore:s,targetStore:l,droppedDirection:n,collectionContextStore:t,groupsPointer:o?[o]:[],files:r,transaction:e})}})}(e,this.props.collectionContextStore,this.props.groupFormat,this.environment),analyticsName:"timeline",style:{width:"100%"}})}}}Wa.displayName="TimelineDropzoneSelectableGroupResults";const Ka=Wa;function Ua(e){return(0,kt.jsx)("div",{style:{width:"100%",height:rn.Z+1}})}var qa=o(62193),$a=o(76205),Ya=o(42239),Qa=o(68056),Xa=o(24666),Ja=o(65187);function ec(e){window.__c={n:"TimelineItemDependencyDrawHandle"};const{store:t,schema:o,timelineState:i,dateValueStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a}=e,d=(0,r.useRef)(null),[u,p]=(0,r.useState)(!1),h=(0,et.O7)(),m=(0,c.VK)((()=>{const e=i.drawState.state;if(e)return e.startStore===t}),[t,i.drawState]),g=(0,c.VK)((()=>!m&&i.hoveredItem.state===t&&!Be.Z.state),[m,t,i.hoveredItem]),S=(0,c.VK)((()=>(0,de.H5)(s)),[s]),f=(0,r.useCallback)((e=>{if(e.preventDefault(),!i.scrollLeft.state||!d.current)return;const r=(0,ve.VW)(d.current);Xr.J4({timelineState:i,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:s,verticalScroller:r}),p(!1)}),[s,o,t,i]),v=(0,r.useCallback)((e=>{if(!d.current)return;const t=(0,ve.VW)(d.current);Xr.mz({timelineState:i,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[i]),y=(0,r.useCallback)((()=>{U.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:h,perform:e=>{Xr.$o({timelineState:i,environment:h,transaction:e,collectionContextStore:s,isFullScreen:l,isRootChild:a})}})}),[h,i,s,l,a]),C=(0,r.useCallback)((e=>{Xr.x({timelineState:i,environment:h})}),[h,i]),x=(0,r.useCallback)((()=>{p(!0)}),[p]),b=(0,r.useCallback)((()=>{p(!1)}),[p]),w=(0,Ht.yK)((e=>({draggableStyle:{position:"absolute",top:0,right:-24,width:24,height:"100%",zIndex:1},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:S?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:de.lf},svgCircleFill:{color:e.white}})),[S]),k=(0,r.useCallback)((e=>{if(!n.state)return;return(0,kt.jsx)("div",{ref:d,style:w.draggableStyle,...e,children:g&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{style:w.draggableSvgStyle,children:(0,kt.jsxs)("svg",{style:{width:22,height:30},onMouseMove:x,onMouseLeave:b,children:[(0,kt.jsx)(pn.Z,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:w.svgPathStyle,showArrowHead:u}),(0,kt.jsx)("circle",{cx:u?10+de.S7:10,cy:14,r:u?de.S7:de.Wk,style:w.svgPathStyle,fill:w.svgCircleFill.color})]})})})})}),[n,b,x,g,w.draggableStyle,w.draggableSvgStyle,w.svgCircleFill.color,w.svgPathStyle,u]);return(0,kt.jsx)(vi.Z,{render:k,onDraggableDragStart:f,onDraggableDragMove:v,onDraggableDragEnd:y,onDraggableDragCancel:C})}const tc={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},oc={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};class ic extends s.Z{constructor(){super(...arguments),this.storeTypes={hovered:d.default.createClass(!1)},this.renderDraggableInner=e=>{const{type:t,timelineState:o,dateValueStore:i}=this.props,r="left"===t,n=i.state,s=o.zoomLevel.state,l=this.isActiveStore.state;var a;if(n)return(0,kt.jsx)("div",{style:r?oc:tc,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,...e,children:l&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{style:r?(a=this.theme,{position:"absolute",left:Math.ceil(3.5)+1,top:6,borderRadius:3,width:3,bottom:6,background:a.regularTextColor}):nc(this.theme)}),(0,kt.jsx)("span",{style:r?{fontSize:12,position:"absolute",right:12,textAlign:"right",width:200,lineHeight:`${rn.Z}px`,pointerEvents:"none"}:{fontSize:12,position:"absolute",left:12,width:200,lineHeight:`${rn.Z}px`,pointerEvents:"none"},children:(0,kt.jsx)("span",{style:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,padding:4,borderRadius:4},children:r?(0,de.yk)(n,s):(0,de.fc)(n,s)})})]})})},this.handleMouseMove=()=>{this.stores.hovered.setState(!0)},this.handleMouseLeave=()=>{this.stores.hovered.setState(!1)},this.isActiveStore=this.createComputedStore((()=>{const{store:e,type:t,timelineState:o}=this.props,i=this.stores.hovered.state,r=o.dragState.state;return r?r.stores[0]===e&&("left"===t?r.type===de.px.LeftResizer:r.type===de.px.RightResizer):i&&!Be.Z.state}))}renderComponent(){return(0,kt.jsx)(vi.Z,{render:this.renderDraggableInner,onDraggableDragStart:e=>function(e,t,o,i,r,n,s,l){e.preventDefault(),Xr.f$({timelineState:i,store:o,startX:e.startX,type:"left"===t?de.px.LeftResizer:de.px.RightResizer,query:r,schema:n,intl:s,environment:l})}(e,this.props.type,this.props.store,this.props.timelineState,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragMove:e=>function(e,t){Xr.td({timelineState:t,currentX:e.currentX})}(e,this.props.timelineState),onDraggableDragEnd:()=>{return e=this.props.timelineState,t=this.props.query,o=this.props.schema,i=this.props.intl,r=this.props.collectionContextStore,n=this.props.isFullScreen,s=this.props.isRootChild,l=this.props.type,a=this.environment,U.createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:a,perform:n=>{Xr.fX({timelineState:e,collectionContextStore:r,query:t,schema:o,intl:i,environment:a,transaction:n})}}),void M.neX(a,{...(0,de.Ii)({environment:a,collectionContextStore:r,timelineState:e,isFullScreen:n,isRootChild:s}),type:l});var e,t,o,i,r,n,s,l,a},onDraggableDragCancel:e=>{return t=this.props.timelineState,o=this.environment,void Xr.cQ({timelineState:t,environment:o});var t,o}})}}ic.displayName="TimelineItemResizer";const rc=ic;function nc(e){return{position:"absolute",left:Math.floor(.5),top:6,borderRadius:3,width:3,bottom:6,background:e.regularTextColor}}const sc=(0,V.defineMessages)({typeAName:{defaultMessage:"Type a name…",id:"timelineItem.itemName.placeholder"}});var lc=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(lc||{});class ac extends s.Z{constructor(){super(...arguments),this.propertiesWrapEl=r.createRef(),this.renderProperty=(e,t)=>{const{showProperties:o,store:i,disabled:r,blockPropertyValueOverlayStore:n,clonedStore:s}=this.props,l=t===o.length-1,a=null==i?void 0:i.getAssociatedCollectionStore();if(a){if("title"===e)return this.renderTitle(l);if(i&&s)return(0,kt.jsx)(gi.Z,{store:s,property:e,disabled:r||!i.canEdit(),locked:!1,format:Si.C.Timeline,tableWrap:!1,isLast:l,blockPropertyValueOverlayStore:n,enablePointerEventsForInteractiveTypes:!0,collectionStore:a,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e)}},this.handleDateRangeButtonMouseMove=()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state;(Be.Z.state||o)&&!this.isDrawingDependencyStore.state||this.environment.device.isPhone||t.hoveredItem.setState(e)},this.handleDateRangeButtonMouseLeave=()=>{const{timelineState:e}=this.props,t=e.dragState.state;(Be.Z.state||t)&&!this.isDrawingDependencyStore.state||e.hoveredItem.setState(void 0)},this.handleAnimationStateChange=()=>{const{current:e}=this.propertiesWrapEl,t=this.animationStateStore.state;e&&t&&(e.style.position=t.position===lc.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)},this.pageURLStore=this.createComputedStore((()=>{const{store:e}=this.props;if(e)return(0,he.ZP)({store:e,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage})})),this.peekURLStore=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=Pe.default.state;if(e&&o)return ue.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.isHoveredStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props;return t.hoveredItem.state===e})),this.isDrawingDependencyStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.drawState.state;return o&&o.startStore!==e})),this.editingTitleStore=this.createComputedStore((()=>{var e;const{store:t}=this.props,o=Xa.default.state;if("editing"!==o.mode)return!1;const i=null===(e=(0,Qa.QY)(o.multiSelection))||void 0===e?void 0:e.store;return t&&i&&i===t.getBlockTitleStore()})),this.animationStateStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,itemPositionStore:o}=this.props,i=o.state;if(i){const{left:o,right:r}=i,n=r-o;if(!((0,de.Tp)(this.environment)&&n>50))return{position:lc.Absolute,left:o};{const i=e.scrollLeft.state;if(void 0!==i){const e=i+t-o+21;if(e<0)return{position:lc.Absolute,left:o};if(e>n)return{position:lc.Absolute,left:r};if(e>0)return{position:lc.Sticky,left:t+21}}}}})),this.passesFilterStore=this.createComputedStore((()=>{var e,t;const o=this.props.parentStore,i=(0,ne.m1)({collectionContextStore:this.props.collectionContextStore,collectionStore:o,environment:this.environment}),r=null===(e=this.props.store)||void 0===e?void 0:e.getModel(),n=null===(t=this.props.store)||void 0===t?void 0:t.getRecordModel;if(!i||!r||!n)return!0;const s=Fe.default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,$a.q)(i)({block:r,getRecordModel:n,propertyMapping:null==o?void 0:o.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+s,resultCache:new Map})})),this.shouldShowHighlightHalo=this.createComputedStore((()=>!!this.props.store&&ue.Sc(this.props.store))),this.isMyTasksStore=this.createComputedStore((()=>{const e=this.props.collectionContextStore.collectionViewBlockStore();return!!e&&(0,ie.qG)(e.id)}))}didMount(){super.didMount(),this.animationStateStore.addListener(this.handleAnimationStateChange),this.handleAnimationStateChange()}willUnmount(){super.willUnmount(),this.animationStateStore.removeListener(this.handleAnimationStateChange)}UNSAFE_willUpdate(){this.animationStateStore.enqueueRecompute()}renderComponent(){const{itemPositionStore:e,store:t,timelineState:o,query:i,schema:r,dateValueStore:n,disabled:s,isDraggingViaTimelineItemStore:l,collectionContextStore:a,isFullScreen:c,isRootChild:d,intl:u}=this.props,p=e.state;if(!p)return;const h=(0,de.H5)(a),{left:m,right:g,maskPercent:S}=p,f=this.isHoveredStore.state,v=this.pageURLStore.state,y=this.peekURLStore.state,C=!s&&(null==t?void 0:t.canEdit()),x=this.environment.device.isPhone,b=C&&!x&&(h||a.permissionScopes.state.canConfigureBlock)&&!this.isMyTasksStore.state,w=a.currentSubitemFormatStore.state?42:10,k=Math.max(g-m,w)+1,P=l.state,R=(0,kt.jsx)(uc,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,itemPositionStore:this.props.itemPositionStore}),T=this.passesFilterStore.state;return t&&!p.isPlaceholder?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)(ao.Z,{style:pc(m,k,P,p,T,this.props.isInPeekRenderer,this.theme),haloStyle:this.getHaloStyle(),className:re.ovr,store:t,canSelect:!0,shouldShowHalo:!0,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,canDrag:C,analyticsName:"timeline",onDraggableDragStart:hc,onDraggableDragMove:e=>function(e,t,o,i,r,n,s){if(!t)return;o.dragState.state||Xr.f$({timelineState:o,store:t,startX:e.startX,type:de.px.ItemDrag,query:i,schema:r,intl:n,environment:s});Xr.td({timelineState:o,currentX:e.currentX})}(e,this.props.store,this.props.timelineState,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragEnd:()=>function(e,t,o,i,r,n){U.createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:n,perform:s=>{Xr.fX({timelineState:e,collectionContextStore:t,query:o,schema:i,intl:r,environment:n,transaction:s})}})}(this.props.timelineState,this.props.collectionContextStore,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragCancel:()=>function(e,t){Xr.cQ({timelineState:e,environment:t})}(this.props.timelineState,this.environment),canTriggerContextMenu:C,getGhostElement:mc,disableScrollToReveal:!0,onMouseMove:this.handleDateRangeButtonMouseMove,onMouseLeave:this.handleDateRangeButtonMouseLeave,showBlockMenuInput:!0,children:[R,(0,kt.jsx)(yi.Z,{style:{width:"100%",height:"100%",borderRadius:4},innerStyle:{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:4},onClick:this.props.handleOpenPeekPage,href:v,metaHref:y,hovered:f,ignoreLocalHoverState:!0}),b&&this.props.store&&(0,kt.jsx)(ec,{store:this.props.store,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,schema:this.props.schema,timelineState:this.props.timelineState,dateValueStore:this.props.dateValueStore,collectionContextStore:this.props.collectionContextStore}),C&&!x&&(0,kt.jsx)(rc,{type:"left",store:t,query:i,schema:r,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d,intl:u,resultStore:this.props.resultStore}),C&&!x&&(0,kt.jsx)(rc,{type:"right",store:t,query:i,schema:r,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d,intl:u,resultStore:this.props.resultStore})]}),this.renderProperties(S,P,T)]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{style:pc(m,k,P,p,T,this.props.isInPeekRenderer,this.theme),className:re.ovr}),this.renderProperties(S,P,T)]})}renderProperties(e,t,o){const{showProperties:i}=this.props;return(0,kt.jsx)("div",{style:this.getPropertiesWrapStyle(e,t,o),children:(0,kt.jsx)("div",{style:dc(this.props.collectionContextStore,this.props.toggleButton),ref:this.propertiesWrapEl,className:re.z_z,children:i.map(this.renderProperty)})})}renderTitle(e){var t;const{store:o}=this.props,i=o?o.getIcon():void 0,r=null==o?void 0:o.hasError(),n=!o||o.isEmptyPage(),s=this.editingTitleStore.state,{parentStore:l,collectionContextStore:a}=this.props,c=a.currentSubitemFormatStore.state,d=c&&l?null===(t=l.getSchema()[c.property])||void 0===t?void 0:t.name:"";return(0,kt.jsxs)("div",{style:{display:"flex",marginRight:e?0:10,fontSize:14,fontWeight:R.Z.fontWeight.medium,alignItems:"center"},children:[i&&!r&&(0,kt.jsx)(Ci.Z,{disabled:!0,icon:i,isEmptyPage:n,size:20,style:{marginLeft:2,marginRight:6}}),r&&(0,pi.t)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:this.theme.accentColors.orange[500]}),o&&!s&&(0,kt.jsx)(xi.Z,{style:{whiteSpace:"nowrap",maxWidth:400},store:o}),s&&o&&(0,kt.jsx)(Ja.Z,{store:o.getBlockTitleStore(),style:{whiteSpace:this.environment.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:()=>gc(this.props.store,this.environment),onEsc:()=>gc(this.props.store,this.environment),onTab:x.yR,placeholder:ge.default.formatMessage(sc.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline"}),!o&&(0,kt.jsx)("span",{children:l&&d?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:d}}):(0,kt.jsx)(V.FormattedMessage,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}getPropertiesWrapStyle(e,t,o){return{width:"100%",WebkitMaskImage:e<1&&this.isHoveredStore.state?`linear-gradient(90deg, rgba(0,0,0,1) ${100*e}%, rgba(0,0,0,0.4) ${100*e}%)`:void 0,pointerEvents:"none",...t&&{display:"none"},zIndex:T.ov,opacity:o?1:.5}}getHaloStyle(){return{borderRadius:4,...ue.pB(this.shouldShowHighlightHalo.state,this.theme)}}}ac.displayName="TimelineItemDateRange";const cc=ac;function dc(e,t){const o=e.currentSubitemFormatStore.state;return{display:"flex",height:rn.Z-2+1,paddingLeft:o&&t?24:6,width:800,overflow:"hidden"}}function uc(e){let{collectionContextStore:t,toggleButton:o,itemPositionStore:i}=e;window.__c={n:"ToggleButton"};const r=(0,c.VK)((()=>t.currentSubitemFormatStore.state),[t]),n=(0,c.VK)((()=>i.state),[i]);return!r||!o||null!=n&&n.isExistingSubitemPlaceholder?null:(0,kt.jsx)("span",{style:{zIndex:1,paddingTop:3},children:o})}function pc(e,t,o,i,r,n,s){const l=s.mode;return{position:"absolute",left:e,marginTop:1,marginBottom:1,width:t,height:rn.Z-2,borderRadius:4,display:"flex",...i.isExistingSubitemPlaceholder?void 0:{..."light"===l?{background:i.isPlaceholder?s.buttonHoveredBackground:s.contentBackground,boxShadow:i.isPlaceholder?void 0:s.buttonBoxShadow}:{background:n?s.calendarItemBackground:s.popoverBackground,boxShadow:i.isPlaceholder?void 0:s.lightBoxShadow}},...i.isPlaceholder&&{cursor:"crosshair"},...o&&{display:"none"},...!r&&{opacity:.5},zIndex:T.ov}}function hc(e){e.preventDefault()}function mc(e){const t=si.C.findSelectablesFromStore(e),o=x.oA(t.map((e=>e.getNode()))),i=x.oA(o.map((e=>e.closest(`.${re.o4s}`))))[0];if(i){const e=Ya.eN(i),t=e.cloned.querySelector(`.${re.ovr}`),o=e.cloned.querySelector(`.${re.z_z}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(Ya.eN)}function gc(e,t){e&&G.Ys({environment:t,store:e})}var Sc=o(31505),fc=o(39301),vc=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(vc||{});class yc extends s.Z{constructor(){super(...arguments),this.lastVisibilityState=vc.NotDefined,this.buttonRef=r.createRef(),this.wrapRef=r.createRef(),this.arrowButtonHovered=d.default.createValue(!1),this.handleIsVisibleChange=()=>{const e=this.buttonRef.current,t=this.wrapRef.current;if(e&&t){const o=this.isVisibleStore.state,i=o===vc.VisibleInItem||o===vc.VisibleOutOfItem;e.style.opacity=""+(i?1:0),e.style.transform=`scale(${i?1:.3})`,t.style.pointerEvents=o===vc.VisibleOutOfItem?"":"none";this.lastVisibilityState!==vc.NotDefined&&o!==vc.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),this.lastVisibilityState=o}},this.handleClick=()=>{const{store:e,type:t,timelineState:o,dateValueStore:i,paddingLeft:r,format:n,collectionContextStore:s,isFullScreen:l,isRootChild:a}=this.props,c=i.state,d=o.zoomLevel.state,{snapUnit:u}=de.BJ[d],p=(0,de.x2)(d,200);if(c)if("left"===t){const{start:e}=(0,de.XO)(c,u),t=(0,de.GK)({timestamp:e.valueOf(),environment:this.environment,timelineState:o,paddingLeft:r,format:n})-p;Xr.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}else{const{end:e}=(0,de.XO)(c,u),t=(0,de.PF)({timestamp:e.valueOf(),timelineState:o})+p;Xr.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}this.arrowButtonHovered.setState(!1),G.Ys({environment:this.environment,store:e}),M.gw_(this.environment,{...(0,de.Ii)({environment:this.environment,collectionContextStore:s,timelineState:o,isFullScreen:l,isRootChild:a}),type:t})},this.handleMouseOver=()=>{this.environment.device.isPhone||Be.Z.state||this.arrowButtonHovered.setState(!0)},this.handleMouseOut=()=>{this.environment.device.isPhone||this.arrowButtonHovered.setState(!1)},this.isVisibleStore=this.createComputedStore((()=>{const{type:e,timelineState:t,scrollerLeftOffset:o,itemPositionStore:i,isDraggingViaTimelineItemStore:r}=this.props,n=i.state;if(n){const{left:i,right:s}=n;if(r.state)return vc.Hidden;const l=t.scrollLeft.state;if(void 0!==l){if("left"===e){const e=l+o;if(e-s>0)return vc.VisibleOutOfItem;if(e-i>0)return vc.VisibleInItem}else{const{outerSizeObserver:e}=t,o=l+e.rect.state.width;if(i-o>0)return vc.VisibleOutOfItem;if(s-o>0)return vc.VisibleInItem}return vc.Hidden}}return vc.NotDefined}))}didMount(){super.didMount(),this.isVisibleStore.addListener(this.handleIsVisibleChange),this.handleIsVisibleChange()}willUnmount(){super.willUnmount(),this.isVisibleStore.removeListener(this.handleIsVisibleChange)}UNSAFE_willUpdate(){this.isVisibleStore.enqueueRecompute()}renderComponent(){const{type:e}=this.props,t=this.arrowButtonHovered.state,o="left"===e?Sc.Y:fc.n;return(0,kt.jsxs)("div",{style:xc(this.props.type,this.props.scrollerLeftOffset,this.props.timelineState),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:me.$0,onClick:this.handleClick,ref:this.wrapRef,children:[(0,kt.jsx)("div",{style:this.getArrowStyle(),ref:this.buttonRef,children:o({height:6,fill:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground})}),t&&(0,kt.jsx)(wc,{dateValueStore:this.props.dateValueStore,timelineState:this.props.timelineState,isInPeekRenderer:this.props.isInPeekRenderer})]})}getArrowStyle(){const{type:e}=this.props;return{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:this.arrowButtonHovered.state?this.theme.regularIconColor:this.theme.mediumIconColor,borderRadius:4,border:`1px solid ${this.theme.contentBackground}`,..."left"===e&&{marginLeft:8,marginRight:4},..."right"===e&&{marginRight:8,marginLeft:4}}}}yc.displayName="TimelineScrollArrow";const Cc=yc;function xc(e,t,o){const{outerSizeObserver:i}=o;return{position:"sticky",left:"left"===e?t:i.rect.state.width-220,width:220,height:Ta-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===e?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",zIndex:T.fQ}}function bc(e,t){return{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:e?t.peekTimelineBackground:t.timelineBackground,pointerEvents:"none"}}function wc(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:i}=e;window.__c={n:"DateRangeComponent"};const r=(0,Ht.Fg)(),n=(0,c.VK)((()=>t.state),[t]),s=(0,c.VK)((()=>o.zoomLevel.state),[o]);return n?(0,kt.jsx)("span",{style:bc(i,r),children:(0,de._Q)(n,s)}):null}class kc extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.dateRangeRef=r.createRef(),this.storeTypes={node:d.default.createClass(null)},this.handleMouseMove=e=>{const{timelineState:t,store:o,groupFormat:r,disabled:n,query:s,schema:l}=this.props,a=t.dragState.state,c=t.drawState.state,{horizontalScroller:d}=t,u=t.scrollLeft.state,p=t.zoomLevel.state,h=t.currentRange.state,{snapUnit:m,getDateRangePlaceholderDuration:g}=de.BJ[p];if(!c&&Be.Z.state||a||Rc(this.props.store,this.props.query,this.props.schema,this.environment)||!d||void 0===u||n)return;const S=d.getBoundingClientRect(),f=u+(e.clientX-S.left),v=(0,de.x2)(p,f),y=i.ou.fromMillis(h.startTimestamp+v),C=(0,de.DS)(y,m),x=(0,de.DS)(g(y),m),b=(0,qo.hT)(C.valueOf(),(0,nt.r)()),w=(0,de.AZ)({startValue:b,snapUnit:m,desiredStart:C,desiredEnd:x});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:this.parentCollectionStore.state,groupFormat:r,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:s,schema:l}})},this.handleClick=e=>{const{store:t,query:o,schema:i,timelineState:r,groupFormat:n,collectionContextStore:s}=this.props,l=r.dateRangePlaceholder.state,a=s.groupsStore.getGroupState(n);if(a)if(l.active){const{date:e}=l;U.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:r=>{Xr.oP({environment:this.environment,store:t,query:o,schema:i,date:e,transaction:r})}}),r.dateRangePlaceholder.setState({active:!1})}else{const{timelineState:o,collectionContextStore:i}=this.props,{horizontalScroller:r}=o,n=o.scrollLeft.state,s=this.itemPositionStore.state,l=this.dateRangeRef.current;if(!r||void 0===n||!s||!l)return;const c=r.getBoundingClientRect(),d=n+(e.clientX-c.left),p=l.propertiesWrapEl.current;if(!p)return;const h=p.lastElementChild;if(!h)return;const m=n+(h.getBoundingClientRect().right-c.left);d>s.right&&d<=m&&(0,me.ZP)({event,context:me.Af.EditorClick,callback:()=>{(0,Se.X9)()||$e.CH({environment:this.environment,store:t,openInNew:pe.DJ(e),peekMode:(0,ue.kr)(i.collectionViewStore()),resultsStore:a.resultsStore,collectionContextStore:i,pageVisitSource:u.tY.PeekOpen})}})}},this.onRefChange=e=>{this.stores.node.setState(e)},this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,de.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:this.subitemPlaceholderDateStore.state})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.shouldRenderScrollArrowsStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e&&!e.isPlaceholder)})),this.subitemPlaceholderDateStore=this.createComputedStore((()=>{const{subitemPath:e}=this.props,t=(0,is.ub)(e);if(!t||Boolean(this.dateValueStore.state))return;const o=t.value.store,i=an.findCollectionTimelineViewItems(o);if(i.length>0){return i[0].dateValueStore.state}})),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,timelineState:t,groupFormat:o}=this.props,i=t.dateRangePlaceholder.state;if(i.active&&i.store===e&&!i.newTimelineItemProps&&(0,He.ZH)(i.groupFormat,o))return i.date})),this.dateValueStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,i=this.placeholderDateStore.state;if(i)return i;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return Rc(this.props.store,this.props.query,this.props.schema,this.environment)}),!0),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,i=un.ZP.state;return Boolean(o&&o.stores.includes(e)&&i.isDragging&&i.draggedStores.includes(e))})),this.parentCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore()))}get registries(){return[an]}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.clonedStore=e.store.clone()}renderComponent(){var e;const{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:r,format:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:u,isFullScreen:p,isRootChild:h,toggleButton:m,groupFormat:g}=this.props,S=this.shouldRenderDateRangeStore.state,f=this.shouldRenderScrollArrowsStore.state,v=null===(e=u.groupsStore.getGroupState(g))||void 0===e?void 0:e.reducerResultStore;if(v)return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{style:{display:"flex",height:0},children:[f&&(0,kt.jsx)(Cc,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:r,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,resultStore:v}),f&&(0,kt.jsx)(Cc,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:r,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:p,isRootChild:h,resultStore:v})]}),(0,kt.jsx)("div",{style:{display:"flex",height:rn.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){if(t.device.isMobile)return;(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),O.AI({environment:t,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:this.handleMouseMove,onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:this.handleClick,className:re.o4s,ref:this.onRefChange,children:S&&(0,kt.jsx)(cc,{store:t,parentStore:this.parentCollectionStore.state,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:o,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:ge.default.getIntl(),ref:this.dateRangeRef,resultStore:v,handleOpenPeekPage:this.props.handleOpenPeekPage})})]})}}kc.displayName="CollectionTimelineViewItem";const Pc=kc;function Rc(e,t,o,i){return(0,de.bk)({store:e,query:t,schema:o,userId:i.currentUser.id,intl:ge.default.getIntl()})}class Tc extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,de.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:void 0})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>!1)),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,parentStore:t,timelineState:o,groupFormat:i}=this.props,r=o.dateRangePlaceholder.state;if(r.active&&r.store===e&&r.newTimelineItemProps&&r.parentStore===t&&(0,He.ZH)(r.groupFormat,i))return r.date})),this.dateValueStore=this.createComputedStore((()=>{const e=this.placeholderDateStore.state;if(e)return e}),!0)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),e.store&&(this.clonedStore=e.store.clone())}renderComponent(){var e;const{store:t,parentStore:o,timelineState:r,scrollerLeftOffset:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:u,isFullScreen:p,isRootChild:h,toggleButton:m,groupFormat:g}=this.props,S=this.shouldRenderDateRangeStore.state,f=null===(e=u.groupsStore.getGroupState(g))||void 0===e?void 0:e.reducerResultStore,v=!t&&!S&&u.shouldAllowNewItemCreation();if(f)return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{style:{display:"flex",height:rn.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){if(t.device.isMobile)return;(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),O.AI({environment:t,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:e=>function(e,t,o,r,n,s,l,a,c,d,u,p){var h;const m=t.drawState.state,g=t.dragState.state,{horizontalScroller:S}=t,f=t.scrollLeft.state,v=t.zoomLevel.state,y=t.currentRange.state,{snapUnit:C,getDateRangePlaceholderDuration:x}=de.BJ[v];if(!m&&Be.Z.state||g||!S||void 0===f||n)return;const b=null===(h=d.groupsStore.getGroupState(r))||void 0===h?void 0:h.resultsStore;if(!b)return;const w=S.getBoundingClientRect(),k=f+(e.clientX-w.left),P=(0,de.x2)(v,k),R=i.ou.fromMillis(y.startTimestamp+P),T=(0,de.DS)(R,C),V=(0,de.DS)(x(R),C),M=(0,qo.hT)(T.valueOf(),(0,nt.r)()),j=(0,de.AZ)({startValue:M,snapUnit:C,desiredStart:T,desiredEnd:V});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:u,groupFormat:r,date:j,newTimelineItemProps:{query:s,schema:l,resultsStore:b,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,this.props.timelineState,this.props.store,this.props.groupFormat,this.props.disabled,this.props.query,this.props.schema,this.props.isFullScreen,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.parentStore,this.props.subitemPath),onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:e=>function(e,t,o,i,r,n,s,l,a,c,d,u){const p=r.dateRangePlaceholder.state;if(p.active){const{date:e}=p,h=u?"timeline_add_parent_item_bottom":"timeline_add_item_bottom";U.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,perform:r=>{const p=Xr.mg({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:i,isFullScreen:n,groupFormat:s,canEditTimelineItems:l,collectionContextStore:a,subitemPath:u,from:h});M.W2j(t,{from:h,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,le.Pn)(a)})}}),r.dateRangePlaceholder.setState({active:!1})}}(0,this.environment,this.props.query,this.props.schema,this.props.timelineState,this.props.isFullScreen,this.props.groupFormat,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.store,this.props.parentStore,this.props.subitemPath),className:re.o4s,children:[S&&(0,kt.jsx)(cc,{store:o?void 0:t,parentStore:o,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:r,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:ge.default.getIntl(),resultStore:f,handleOpenPeekPage:()=>{}}),v&&(0,kt.jsx)(Fc,{parentStore:this.props.parentStore,collectionContextStore:this.props.collectionContextStore,paddingLeft:this.props.paddingLeft,isFullScreen:this.props.isFullScreen,showTable:this.props.showTable})]})})}}Tc.displayName="CollectionTimelineViewItemNew";const Vc=Tc;function Mc(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function jc(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function Fc(e){let{parentStore:t,collectionContextStore:o,paddingLeft:i,isFullScreen:r,showTable:n}=e;window.__c={n:"AddRowIndicatorComponent"};const s=(0,Ht.Fg)(),l=(0,c.VK)((()=>o.currentSubitemFormatStore.state),[o]),a=(0,c.VK)((()=>{var e;return l&&t?null===(e=t.getSchema()[l.property])||void 0===e?void 0:e.name:""}),[l,t]);return(0,kt.jsx)("div",{style:Mc(i,r,n),children:(0,kt.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:Va,lineHeight:R.Z.lineHeight.UIRegular.desktop},children:[(0,y.R)(jc(s)),(0,kt.jsx)("span",{style:{color:s.mediumTextColor},children:t&&a?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:a}}):(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}class Ic extends s.Z{constructor(){super(...arguments),this.resultPropsMemo=new qa.Uw,this.resultProps=()=>{const{groupFormat:e,disabled:t,query:o,format:i,schema:r,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a,showTable:c,canEditTimelineItems:d,scrollerLeftOffsetStore:u,timelineState:p,paddingLeft:h,showTimelinePropertiesStore:m,isInPeekRenderer:g}=this.props,S=s.permissionScopes.state;return this.resultPropsMemo.memo((()=>({disabled:t||!("collectionTypedView"===s.contextType||S.canEditContent),timelineState:p,schema:r,query:o,format:i,scrollerLeftOffset:u.state,paddingLeft:h,showProperties:m.state,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,showTable:c,isRootChild:a,groupFormat:e,canEditTimelineItems:d,isInPeekRenderer:g,handleOpenPeekPage:()=>Dc(this.props.collectionContextStore,this.props.groupFormat,this.environment),isLast:!1})),[t,p,r,o,i,u,S,h,m,n,s,l,c,a,e,d,g,()=>Dc(this.props.collectionContextStore,this.props.groupFormat,this.environment)])},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,schema:t,groupFormat:o,query:i,showTable:r}=this.props;if(!i.timeline_by)return;const n=e.groupsStore.getGroupState(o);if(!n)return;const s=n.currentLimit.state,l=x.oA([o&&(0,rt.Ko)({schema:t,group:o,timeZone:(0,nt.r)()}),!r&&{property:i.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:s}}))}renderComponent(){const{store:e,format:t,groupFormat:o,collectionContextStore:i,isFullScreen:r,paddingLeft:n,showTable:s}=this.props,l=i.groupsStore.getGroupState(o);if(!l)return;const a=o?[o]:[],c=this.resultsReducerStore.state,d=l.reducerResultStore.state,u=ue.VM({collectionContextStore:i,reducerResult:d,isFullScreen:r});return(0,kt.jsxs)(kt.Fragment,{children:[c&&(0,kt.jsx)(ut.Z,{id:a.length>0?`results:${(0,He.KW)(a)}`:"timeline_results",reducer:c,groupsPointer:a,collectionContextStore:i,resultStore:l.reducerResultStore}),this.renderCollectionGroupResults(),u&&(0,kt.jsx)("div",{style:{width:"100%"},children:s?(0,kt.jsx)("div",{style:{height:on.K0}}):(0,kt.jsx)(on.ZP,{style:{position:"sticky",left:r?n:3,width:"max-content",height:on.K0},groupsPointer:a,store:e,collectionContextStore:i,format:t,isFullScreen:r,incrementLimitsInRelatedGroups:!1})}),(0,kt.jsx)(Bc,{...this.props,store:void 0,indentLevel:0,handleOpenPeekPage:()=>Dc(this.props.collectionContextStore,this.props.groupFormat,this.environment)})]})}renderCollectionGroupResults(){const{groupFormat:e,format:t,collectionContextStore:o}=this.props,i=o.groupsStore.getGroupState(e);if(i)return(0,kt.jsx)(oo.Z,{disableSelectable:!0,collectionContextStore:o,groupsPointer:i.groupsPointer,format:t,canDrag:!1,disableRequest:!0,resultProps:this.resultProps(),canDrop:!1,resultComponent:Pc,disabled:!0,direction:oo.R.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:e=>function(e,t,o){return(0,kt.jsx)(Bc,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>Dc(o.collectionContextStore,o.groupFormat,t)})}(e,this.environment,this.props)})}}function Bc(e){window.__c={n:"AddRowTimelineItem"};const{store:t,parentStore:o,subitemPath:i,timelineState:r,disabled:n,query:s,format:l,schema:a,collectionContextStore:d,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:h,groupFormat:m,paddingLeft:g,showTimelinePropertiesStore:S,scrollerLeftOffsetStore:f,showTable:v,canEditTimelineItems:y,isInPeekRenderer:C,isReady:x,canEdit:b}=e,w=(0,c.VK)((()=>d.groupsStore.getGroupState(m)),[d,m]),k=(0,c.VK)((()=>d.permissionScopes.state),[d.permissionScopes]),P=(0,c.VK)((()=>f.state),[f]),R=(0,c.VK)((()=>S.state),[S]);return w&&x&&b&&!k.isSyncedCollection?(0,kt.jsx)(Vc,{store:t,disabled:n||!k.canEditContent,timelineState:r,schema:a,query:s,format:l,scrollerLeftOffset:P,paddingLeft:g,showProperties:R,blockPropertyValueOverlayStore:u,collectionContextStore:d,isFullScreen:p,showTable:v,isRootChild:h,groupFormat:m,canEditTimelineItems:y,isInPeekRenderer:C,parentStore:o,subitemPath:i}):null}Ic.displayName="TimelineItemGroupResults";const _c=(0,V.injectIntl)(Ic);function Dc(e,t,o){const i=e.groupsStore.getGroupState(t);if(!i)return;xe.default.mark("collections.open_item_page_lag");const r=e.collectionViewStore();E.Xd({collectionContextStore:e,resultsStore:i.resultsStore});const n=null==r?void 0:r.getFormat().collection_peek_mode,s=n||Xo.Ls.timeline;M.hym(o,{is_peek:!0,from:"timeline",peek_mode:s})}function Ac(){window.__c={n:"TimelineTableShimmer"};const e=(0,Ht.yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,kt.jsx)("div",{style:e.rowContainer,children:(0,kt.jsx)(Wt.Z,{style:e.rowShimmer})})}class Zc extends s.Z{constructor(){super(...arguments),this.groupsPointerMemo=new qa.Uw,this.groupsPointer=()=>{const{groupFormat:e}=this.props;return this.groupsPointerMemo.memo((()=>e?[e]:[]),[e])},this.renderGroupResults=e=>{const{device:t}=this.environment,{schema:o,disabled:i,collectionContextStore:r,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,groupFormat:c}=this.props,d=r.collectionViewStore();if(!d)return;const u=this.groupsPointer();if(!r.groupsStore.getGroupState(u))return;const p=s.state,h=!l&&t.isMobile&&!d.isSyncedCollection(),m=this.titleColumnIndexStore.state;return(0,kt.jsx)(oo.Z,{collectionContextStore:r,groupsPointer:u,disableRequest:!0,format:a,canDrag:h,resultProps:{schema:o,collectionContextStore:r,propertyFormats:p,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:i,blockPropertyValueOverlayStore:n,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableTableWrap:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:Ec,titleColumnIndex:m,groupFormat:c,shouldShowMultiSelectCheckbox:!1},resultComponent:Jl,canDrop:!1,disabled:i,direction:oo.R.Vertical,getItemSelectableStyle:()=>({display:"flex",borderBottom:`1px solid ${this.theme.tableDividerColor}`,width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:e.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:n,titleColumnIndex:m,nestedCreateSubitemButton:this.nestedCreateSubitemButton})},this.nestedCreateSubitemButton=e=>{const{collectionContextStore:t,disabled:o}=this.props,{store:i,parentStore:r,subitemPath:n,indentLevel:s}=e;if(r)return(0,kt.jsx)(cs.x,{store:i,collectionStore:r,subitemPath:n,indentLevel:s,collectionContextStore:t,disabled:o,groupsPointer:this.groupsPointer(),onSubitemCreate:e=>function(e,t,o,i){o&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{rs.bA({isNewBlock:!0,environment:i,blockPropertyValueOverlayStore:o,store:e,property:"title",format:Si.C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})}))}))}(e,this.props.collectionContextStore,this.props.blockPropertyValueOverlayStore,this.environment)})},this.handleAddRowClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,{device:i}=this.environment,r=o?[o]:[],n=e.groupsStore.getGroupState(r);ze.M_(this.environment)&&n&&(e.searchQuery.state&&Z.Ug({searchQuery:"",collectionContextStore:e,isFullScreen:t}),U.createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:this.environment,perform:t=>{const r=_.IW({environment:this.environment,collectionContextStore:e,groupsPointer:o?[o]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"timeline_table_group_results"});if(r){if(i.isMobile){const e=(0,he.ZP)({store:r.newStore,fullyQualified:!1,pageVisitSource:u.tY.Create});this.navigate(e)}else l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{if(r.coercionSucceeded)rs.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r.newStore,property:"title",format:Si.C.Table,collectionContextStore:e,disableHorizontalEdgeScroll:!0});else{const t=o?[o]:[],i=e.groupsStore.getGroupState(t);$e.CH({environment:this.environment,store:r.newStore,peekMode:(0,ue.kr)(e.collectionViewStore()),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:e,pageVisitSource:u.tY.Create})}}))}));M.W2j(this.environment,{from:"timeline_add_item_bottom",type:"page",new_page_id:r.newStore.id,creating_block_id:r.newStore.id,...(0,le.Pn)(e)})}}}))},this.titleColumnIndexStore=this.createComputedStore((()=>{const{showTablePropertyFormatsStore:e}=this.props;return e.state.findIndex((e=>"title"===e.property))}))}renderComponent(){const{groupFormat:e,isFullScreen:t,collectionContextStore:o,blockPropertyValueOverlayStore:i,isReady:r,store:n,disabled:s,format:l,schema:a,isInPeekRenderer:c,paddingBottom:d,query:u,showTablePropertyFormatsStore:p,showHoverActionsStore:h}=this.props,m=o.groupsStore.getGroupState(this.groupsPointer());if(!m)return;const g=m.reducerResultStore.state,S=(0,ue.VM)({collectionContextStore:o,reducerResult:g,isFullScreen:t}),f=o.shouldShowSpinner.state&&"on"===Fe.default.getEligibleGroup({experimentId:"collections_loading_state",defaultGroup:"control"}),v=r&&0===(null==g?void 0:g.blockIds.length)&&!f,y=o.permissionScopes.state;return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(zc,{store:this.props.store,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore,disabled:s,paddingBottom:this.props.paddingBottom,isInPeekRenderer:this.props.isInPeekRenderer,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,tableStore:this.props.tableStore,showTablePropertyFormatsStore:this.props.showTablePropertyFormatsStore,timelineState:this.props.timelineState,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,groupFormat:e}),(0,kt.jsx)("div",{style:{height:(0,de.vX)(Boolean(e)),width:0}}),v&&this.renderEmptyTablePlaceholder(),this.renderTableRows(e),f&&(0,kt.jsx)(Ac,{}),S&&this.renderLoadMoreButton(),Oc(this.props.collectionContextStore,this.props.isReady,this.props.canEdit)&&this.renderTableAddRowButton(),(0,kt.jsx)(ys,{groupFormat:e,style:Nc(this.props.isReady,this.props.groupFormat,this.props.isFullScreen,this.props.paddingLeft),store:n,disabled:s||!y.canConfigureBlock,format:l,schema:a,query:u,collectionContextStore:o,isInPeekRenderer:c,isFullScreen:t,minWidth:void 0,paddingBottom:d,blockPropertyValueOverlayStore:i,showPropertyFormatsStore:p,showHoverActionsStore:h,showRightActionsSpacer:!1}),(e||t)&&(0,kt.jsx)("div",{style:{height:Ma,width:0,marginBottom:e?de.y1:void 0}})]})}renderTableRows(e){const{store:t,schema:o,query:i,collectionContextStore:r,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,tableStore:c,paddingLeft:d}=this.props;if(!r.collectionViewStore())return;return r.groupsStore.getGroupState(e)?(0,kt.jsx)(ma,{store:t,format:a,schema:o,query:i,collectionContextStore:r,minWidth:void 0,blockPropertyValueOverlayStore:n,showPropertyFormatsStore:s,disabled:!l,disableHorizontalEdgeScroll:!0,groupFormat:e,render:this.renderGroupResults,tableStore:c,paddingLeft:d}):void 0}renderEmptyTablePlaceholder(){const{canEdit:e}=this.props;return(0,kt.jsx)(io.Z,{onClick:this.handleAddRowClick,onMouseDown:me.$0,disabled:!e,style:{display:"flex",alignItems:"center",height:Va,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:this.theme.contentBackground,left:0,right:0,borderBottom:`1px solid ${this.theme.tableDividerColor}`},children:e?(0,kt.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,kt.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}renderLoadMoreButton(){const{collectionContextStore:e,format:t,canEdit:o}=this.props,i=this.groupsPointer();if(!e.groupsStore.getGroupState(i))return;const r=(0,Qe.$t)({collectionContextStore:e,groupsPointer:i});return(0,kt.jsxs)(io.Z,{onMouseDown:me.$0,onClick:e=>function(e,t,o,i,r){const n=t.groupsStore.getGroupState(o);if(!n)return;const s=n.reducerResultStore.state;(0,me.Wi)(e),G.ZH(r),s&&_.ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:n.groupsPointer,incrementLimitsInRelatedGroups:!1}});M.uDZ(r)}(e,this.props.collectionContextStore,this.props.groupFormat,this.props.isFullScreen,this.environment),disabled:r,hoveredStyle:r?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:Va+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,borderBottom:`1px solid ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,os.M)(Hc(this.theme)),(0,kt.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,kt.jsx)(V.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),r?(0,kt.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,kt.jsx)(no.Z,{style:{width:12,height:12}})}):o&&(0,kt.jsx)(ds.Z,{collectionContextStore:e,format:t})]})}renderTableAddRowButton(){return(0,kt.jsxs)(io.Z,{onClick:this.handleAddRowClick,style:(e=this.props.isInPeekRenderer,t=this.theme,{borderBottom:`1px solid ${t.tableDividerColor}`,display:"flex",alignItems:"center",height:Va,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}),className:re.tfM,onMouseDown:me.$0,children:[(0,y.R)(Hc(this.theme)),(0,kt.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]});var e,t}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}}Zc.displayName="TimelineTableGroupResults",Zc.contextTypes={...X.wK,...s.w};const Lc=(0,V.injectIntl)(Zc);function Ec(){}function Oc(e,t,o){const i=e.permissionScopes.state;return Boolean(t&&o&&!i.isSyncedCollection)}function Nc(e,t,o,i){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:i},...o&&!t&&{left:i}}}function zc(e){let{groupFormat:t,store:o,format:i,schema:r,query:n,collectionContextStore:s,disabled:l,paddingBottom:a,isInPeekRenderer:d,blockPropertyValueOverlayStore:u,tableStore:p,showTablePropertyFormatsStore:h,timelineState:m,isFullScreen:g,isRootChild:S}=e;window.__c={n:"TimelineTableGroupResultsHeaderRow"};const f=(0,c.VK)((()=>s.groupsStore.getGroupState(t)),[s,t]),v=(0,c.VK)((()=>s.permissionScopes.state),[s]),y=(0,c.VK)((()=>s.viewIsFlushToTopbar()),[s]);if(!f)return null;const C=Boolean(t);return(0,kt.jsx)(Fl,{store:o,format:i,schema:r,query:n,collectionContextStore:s,isInPeekRenderer:d,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:u,showPropertyFormatsStore:h,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:l||!v.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,de.vX)(C),paddingTop:C?0:de.Ne-de.pe,disableTopBorder:!y||C,disableCellRightBorder:!0,groupFormat:t,children:!C&&v.canConfigureBlock&&(0,kt.jsx)(Dn,{isGrouped:!1,format:i,collectionContextStore:s,timelineState:m,isFullScreen:g,isRootChild:S})})}function Hc(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}class Gc extends ee.Z{constructor(){super(...arguments),this.widthEl=null,this.storeTypes={tableStore:tn,hiddenGroupsVisible:d.default.createClass(!1),groupsReducerResultStore:d.default.createClass(void 0)},this.renderTableGroupHeader=e=>{const{format:t,collectionContextStore:o,isFullScreen:i,isRootChild:r}=this.props,n=o.permissionScopes.state;return(0,kt.jsxs)(Po.Z,{...e,height:de.Zn-1,paddingTop:de.xd,toggleClosedMarginBottom:de.xd,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.tableDividerColor}`:void 0}}(e,this.theme),style:qc(e.index,this.props.collectionContextStore,this.theme),children:[0===e.index&&n.canConfigureBlock&&(0,kt.jsx)(Dn,{isGrouped:!0,format:t,collectionContextStore:o,timelineState:this.timelineState,isFullScreen:i,isRootChild:r})," "]})},this.renderTableGroupResults=e=>{const{store:t,isFullScreen:o,schema:i,query:r,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,showHoverActionsStore:a,paddingBottom:c,isRootChild:d,disabled:u}=this.props,p=this.isReady.state,h=Uc(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);if(s.groupsStore.getGroupState(e))return(0,kt.jsx)(Lc,{store:t,groupFormat:e,schema:i,query:r,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:this.showTablePropertyFormatsStore,showHoverActionsStore:a,tableStore:this.stores.tableStore,paddingLeft:h,paddingBottom:c,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:d,isReady:p,canEdit:this.canEditCollectionTimeline(),disabled:u&&this.canEditCollectionTimeline()})},this.renderTimelineItemGroupResults=e=>{const{store:t,isFullScreen:o,schema:i,query:r,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,isRootChild:a,disabled:c}=this.props,d=this.isReady.state,u=Uc(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);return(0,kt.jsx)(_c,{store:t,groupFormat:e,schema:i,query:r,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTimelinePropertiesStore:this.showTimelinePropertiesStore,paddingLeft:u,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:a,isReady:d,canEdit:this.canEditCollectionTimeline(),disabled:c,showTable:this.showTableStore.state,canEditTimelineItems:this.canEditTimelineItemsStore.state,scrollerLeftOffsetStore:this.scrollerLeftOffsetStore})},this.renderTimelineItemGroupHeader=e=>{if(this.showTableStore.state)return;const t=this.timelineState.outerSizeObserver.rect.state.width;return(0,kt.jsx)("div",{style:{position:"sticky",left:0,width:t,height:de.Zn,zIndex:T.sL},children:(0,kt.jsx)(Po.Z,{...e,style:{width:"100%",height:"100%",paddingLeft:this.props.isFullScreen?Uc(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},getComputedStickyStyle:e=>function(e,t){return e?{background:t.contentBackground,boxShadow:`0 1px 0 ${t.tableDividerColor}`}:{background:"transparent",boxShadow:void 0}}(e,this.theme),preventToggleBackground:this.props.isInPeekRenderer})})},this.renderTimelineItemHiddenGroupsButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return(0,kt.jsx)("div",{style:{width:"100%",height:Vo.GQ+Vo.BG,display:"flex"},children:(0,kt.jsx)(Vo.ZP,{...e,style:{position:"sticky",left:t?Uc(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})})},this.renderTimelineAddGroupButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t,collectionContextStore:o}=this.props;return"collectionTypedView"!==o.contextType?(0,kt.jsx)("div",{style:{width:"100%",height:ko.KK+ko.$U,display:"flex"},children:(0,kt.jsx)(ko.ZP,{...e,style:{position:"sticky",left:t?Uc(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})}):void 0},this.renderTimelineGroupsLoadMoreButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return(0,kt.jsx)("div",{style:{width:"100%",height:To.bk+2*To.VJ,display:"flex"},children:(0,kt.jsx)(To.ZP,{...e,style:{position:"sticky",left:t?Uc(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})})},this.renderRowDropzoneSelectableGroupResults=e=>{const{collectionContextStore:t,store:o,isFullScreen:i,format:r,disabled:n}=this.props;return(0,kt.jsx)(Ka,{store:o,groupFormat:e,collectionContextStore:t,isFullScreen:i,canEdit:this.canEditCollectionTimeline(),format:r,disabled:n&&this.canEditCollectionTimeline()})},this.handleHorizontalScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,savePreference:o}=e;if(!t)return;const i=t.scrollLeft,r=e.scrollLeft.state;this.environment.device.isIOS&&void 0!==r&&0===i&&r>de.lx?t.scrollLeft=r:(o&&o(),e.scrollLeft.setState(i),(0,de.rr)(this.environment)?this.resetWindowForScrollDebounced():this.resetWindowForScroll())},this.resetWindowForScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o}=e;if(!t)return;const i=e.zoomLevel.state,{startTimestamp:r,endTimestamp:n}=e.currentRange.state,s=t.scrollLeft,l=o.rect.state.width,a=(0,de.e$)(i,n-r),c=(0,de.al)(e);if(s<de.lx){const t=-(0,de.x2)(i,de.Ge);e.currentRange.setState({startTimestamp:r+t,endTimestamp:n+t}),Xr.Nf({timelineState:e,environment:this.environment,zoomLevel:i,centerTimestamp:c})}else if(s+l>a-de.lx){const t=(0,de.x2)(i,de.Ge);e.currentRange.setState({startTimestamp:r+t,endTimestamp:n+t}),Xr.Nf({timelineState:e,environment:this.environment,zoomLevel:i,centerTimestamp:c})}},this.resetWindowForScrollDebounced=x.Ds(this.resetWindowForScroll,200),this.handleWidthElMount=e=>{if(this.widthEl=e,e){const{timelineState:t}=this,{outerSizeObserver:o}=t;o.observe(e);const i=(0,ve.xH)(e);i&&(t.horizontalScroller=i,(0,pe.lj)(i,"scroll",this.handleHorizontalScroll),this.scrollToCenteredTimestamp())}},this.handleTimelineElMount=e=>{if(e){const{timelineState:t}=this,{timelineSizeObserver:o}=t;o.observe(e)}},this.scrollToCenteredTimestamp=()=>{const{timelineState:e}=this,{startTimestamp:t,endTimestamp:o}=e.currentRange.state;Xr.KA({timelineState:e,centerTimestamp:(t+o)/2})},this.showTablePropertyFormatsStore=this.createComputedStore((()=>this.getTimelineTableProperties().filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>this.showTableStore.state?this.showTablePropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0):0)),this.scrollerLeftOffsetStore=this.createComputedStore((()=>(0,de.xI)({environment:this.environment,paddingLeft:Uc(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),format:this.props.format,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild}))),this.scrollPixelWidthStore=this.createComputedStore((()=>{const{timelineState:e}=this,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:i}=e.currentRange.state;return(0,de.e$)(t,i-o)})),this.showTimelinePropertiesStore=this.createComputedStore((()=>{const{format:e}=this.props;return(e.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))})),this.showTableStore=this.createComputedStore((()=>{const{format:e,isFullScreen:t,isRootChild:o}=this.props;return(0,de.C1)({environment:this.environment,format:e,isFullScreen:t,isRootChild:o})})),this.canEditTimelineItemsStore=this.createComputedStore((()=>{const{query:e,schema:t}=this.props;return ue.D2({query:e,schema:t})})),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getTimelineItemGroupStyle=e=>{const t=this.showTableStore.state,o=this.getGroupPaddingState(e);let i=0,r=0;return o.groupHeader&&t&&(i+=de.Zn-1),o.tableHeaderRow&&(i+=de.pe),o.tableEmptyRow&&(i+=Va),o.tableAggregationRow&&(r+=Ma),o.hiddenGroupsButton&&t&&(r+=Vo.GQ+Vo.BG),o.groupsLoadMoreButton&&t&&(r+=To.bk+2*To.VJ),o.addGroupButton&&t&&(r+=ko.KK+ko.$U),o.groupPaddingBottom&&(r+=de.y1),o.extraGroupMarginBottom&&(r+=de.xd+1),{paddingTop:i,paddingBottom:r,minHeight:de.Zn,boxShadow:e.index>0&&(!t||o.tableHeaderRow)?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}},this.getRowDropzoneSelectableGroupStyle=e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=this.getGroupPaddingState(e);let o=0,i=0;return t.groupHeader&&(o+=de.Zn),t.tableHeaderRow&&(o+=de.pe),t.tableEmptyRow&&(o+=Va),t.addItemRow&&(i+=rn.Z),t.loadMoreButton&&(i+=on.K0),t.tableAggregationRow&&(i+=Ma),t.hiddenGroupsButton&&(i+=Vo.GQ+Vo.BG),t.groupsLoadMoreButton&&(i+=To.bk+2*To.VJ),t.groupPaddingBottom&&(i+=de.y1),t.extraGroupMarginBottom&&(i+=de.xd),t.addGroupButton&&(i+=ko.KK+ko.$U),t.dropZoneSelectableGroupExtraBottomPadding&&(i+=1),{paddingTop:o,paddingBottom:i}}}get registries(){return super.registries.concat(Jr.Z)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.timelineState=(0,de.Gz)({isFullScreen:e.isFullScreen,isRootChild:e.isRootChild});const{collectionContextStore:t}=e,o=t.collectionStore(),i=t.collectionViewStore();o&&i&&Xr.j2({timelineState:this.timelineState,environment:this.environment,collectionViewStore:i,collectionContextStore:t})}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{timelineState:t}=this,{query:o,collectionContextStore:i}=e;Be.Z.state&&t.hoveredItem.setState(void 0);const r=i.collectionStore();r&&!o.timeline_by&&r.isDefined()&&function(e,t,o){const{schema:i}=e,r=t.permissionScopes.state,n=t.collectionStore();if(!n)return;const s=t.collectionViewStore();if(!s||!r.canConfigureBlock)return;const l=(0,V.defineMessages)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});U.createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:o,perform:e=>{let t,a=ue.HI(i);if(!a&&r.canConfigureCollection){a=(0,We.ZP)();t={[a]:{name:ge.default.formatMessage(l.date),type:"date"}}}Z.Es({collectionViewStore:s,update:{timeline_by:a},transaction:e}),Ue.sW({store:s,data:{type:"timeline"},transaction:e}),t&&Z.xO({environment:o,collectionStore:n,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){super.didMountOrUpdate();const e=this.timelineState,{collectionContextStore:t,isFullScreen:o,isRootChild:i}=this.props;M.iRP(this.environment,(0,de.Ii)({environment:this.environment,collectionContextStore:t,timelineState:e,isFullScreen:o,isRootChild:i}));const r=e.drawState.state;if(null!=r&&r.tryToCompleteDrawnArrow){(0,de.H5)(t)&&U.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:this.environment,perform:r=>{Xr.$o({timelineState:e,environment:this.environment,transaction:r,collectionContextStore:t,isFullScreen:o,isRootChild:i})}})}}willUnmount(){super.willUnmount();const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o,timelineSizeObserver:i}=e;o.destroy(),i.destroy(),e.destroyed=!0,t&&(0,pe.ZV)(t,"scroll",this.handleHorizontalScroll)}customizeEdgeScrollRect(e){const t=this.scrollerLeftOffsetStore.state;return li.iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}addBlockToView(e){const{store:t,transaction:o}=e,{collectionContextStore:i}=this.props,r=i.collectionStore();if(r)return Xr.Fv({environment:this.environment,store:t,timelineState:this.timelineState,query:this.props.query,collectionStore:r,collectionContextStore:this.props.collectionContextStore,groupFormat:void 0,transaction:o})}renderPersisted(){const{store:e,isInPeekRenderer:t,paddingRight:o,isFullScreen:i,isRootChild:r,query:n,schema:s,format:l,collectionContextStore:a,disabled:c}=this.props,{timeline_by:d}=n;if(!d)return(0,kt.jsx)(Kc,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const u=s[d];if(!u||!Go.Lt(u))return(0,kt.jsx)(Kc,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const{timelineState:p}=this,h=this.scrollerLeftOffsetStore.state,m=this.showTableStore.state,g=Uc(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),S=ue.az(a,i),f=l.collection_group_by,v=a.viewIsFlushToTopbar(),y=(0,Xe.Z)((d=>(0,kt.jsx)(Io.Z,{isFullScreen:i,renderEmitter:a.renderEmitter,children:(0,kt.jsx)("div",{style:this.getStyle(m),className:re.kDE,...d,children:(0,kt.jsxs)(ao.Z,{store:e,analyticsName:"timeline",shouldShowHalo:!i,canSelect:!i,children:[(0,kt.jsx)(Da,{timelineState:p,isInPeekRenderer:this.props.isInPeekRenderer}),(0,kt.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:de.Ne},ref:this.handleTimelineElMount,children:[f?this.renderTimelineItemGroups(f):this.renderTimelineItemGroupResults(void 0),(0,kt.jsx)(Cn,{timelineState:p,disabled:c,isReady:this.isReady.state,renderEmitter:a.renderEmitter,isFullScreen:i,isRootChild:r})]}),(0,kt.jsx)(zn,{isInPeekRenderer:t,timelineState:p,query:n,schema:s,scrollerLeftOffset:h,collectionContextStore:a,showTable:m}),(0,kt.jsx)(Mn,{timelineState:p,isInPeekRenderer:t,paddingLeft:g,paddingRight:!i&&r?8:o,format:l,scrollerLeftOffset:h,isFullScreen:i,isRootChild:r,showTable:m,collectionContextStore:a,isReady:this.isReady.state}),m&&this.renderTable(f,g),(0,kt.jsx)("div",{style:{paddingTop:de.Ne,pointerEvents:"none"},children:f?this.renderRowDropzoneSelectableGroups(f):(0,kt.jsx)("div",{style:this.getRowDropzoneSelectableGroupStyle(void 0),children:this.renderRowDropzoneSelectableGroupResults(void 0)})}),!S&&(0,kt.jsx)(lo.Z,{onChange:e=>function(e,t,o,i){const r=o.isLoading.state,n=o.groupsStore.getGroupState([]);if(!n)return;const s=n.reducerResultStore.state;e<Ve.Z.incrementScrollOffset&&s&&!r&&s.hasMore&&_.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})})})));return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{ref:this.handleWidthElMount}),!v&&(0,kt.jsx)("div",{style:{height:4}}),y]})}renderTable(e,t){const{store:o,isFullScreen:i,collectionContextStore:r}=this.props;return(0,kt.jsx)("div",{style:{position:"sticky",left:0,height:0,width:this.tableWidthStore.state,zIndex:T.eU},children:(0,kt.jsx)(ao.Z,{style:this.getTableSelectableStyle(t),store:o,shouldShowHalo:!1,canSelect:!i,analyticsName:"timeline",children:e?this.renderTableGroups(e):(0,kt.jsx)(Io.Z,{isFullScreen:i,ignoreAncestorContainer:!0,renderEmitter:r.renderEmitter,children:(0,kt.jsx)("div",{children:this.renderTableGroupResults(void 0)})})})})}renderTableGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,kt.jsx)(Ro.Z,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:He.Uh,groupAggregationKey:He.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:this.renderTableGroupResults,renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:(e,t,o)=>$c(e,t,o,this.environment,this.props.collectionContextStore),hiddenGroupsVisible:this.stores.hiddenGroupsVisible,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,ignoreAncestorStickyContainer:!0,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!1})}renderTimelineItemGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,kt.jsx)(Ro.Z,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:He.Uh,groupAggregationKey:He.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:this.renderTimelineItemGroupResults,onGroupHeaderAddItem:(e,t,o)=>$c(e,t,o,this.environment,this.props.collectionContextStore),hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderTimelineItemGroupHeader,getGroupStyle:this.getTimelineItemGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,renderHiddenGroupsButton:this.renderTimelineItemHiddenGroupsButton,renderAddGroupButton:this.renderTimelineAddGroupButton,renderGroupsLoadMoreButton:this.renderTimelineGroupsLoadMoreButton,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}renderRowDropzoneSelectableGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,kt.jsx)(Ro.Z,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:He.Uh,groupAggregationKey:He.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:this.renderRowDropzoneSelectableGroupResults,onGroupHeaderAddItem:(e,t,o)=>$c(e,t,o,this.environment,this.props.collectionContextStore),hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:()=>null,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,renderHiddenGroupsButton:()=>null,renderAddGroupButton:()=>null,renderGroupsLoadMoreButton:()=>null,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.stores.tableStore.state;return t||e}getTimelineTableProperties(){const e=this.getCurrentFormat();return e&&e.timeline_table_properties?e.timeline_table_properties:[]}canEditCollectionTimeline(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent&&!e.isSyncedCollection}getGroupPaddingState(e){const{groupFormat:t,currentGroups:o,visibleGroups:i,hiddenGroups:r,total:n}=e,{collectionContextStore:s,isFullScreen:l,disabled:a,format:c}=this.props,{hiddenGroupsVisible:d}=this.stores,u=c.collection_group_by,p=this.showTableStore.state,h=s.groupsStore.getGroupState(t),m=Boolean(t&&!(null!=h&&h.toggleStateStore.state)),g=function(e,t,o,i){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=i.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(t,m,o,this.props.collectionContextStore),S=null==h?void 0:h.reducerResultStore.state,f=ue.VM({collectionContextStore:s,reducerResult:S,isFullScreen:l}),v=t===r[r.length-1],y=t===i[i.length-1],C=i.length<n,x=d.state?v:y,b=s.permissionScopes.state,w=x&&!a&&b.canConfigureBlock&&u&&(0,He.Wz)(u,b.canConfigureCollection),k=S&&0===S.blockIds.length;return{groupHeader:Boolean(t&&(!p||!g)),tableHeaderRow:Boolean(p&&!m&&!g),tableAggregationRow:Boolean(p&&!m),addItemRow:Boolean(this.canEditCollectionTimeline()&&!m),hiddenGroupsButton:Boolean(y&&r.length>0),groupsLoadMoreButton:Boolean(y&&C),loadMoreButton:Boolean(!m&&f),groupPaddingBottom:Boolean(!m),tableEmptyRow:Boolean(p&&!m&&k),extraGroupMarginBottom:Boolean(p&&m),addGroupButton:Boolean(w),dropZoneSelectableGroupExtraBottomPadding:Boolean(!p)}}getStyle(e){const{isFullScreen:t,paddingBottom:o}=this.props,i=this.scrollPixelWidthStore.state,r=this.isReady.state;return{position:"relative",float:"left",minWidth:"100%",width:i,background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,...!t&&!e&&{borderBottom:`1px solid ${this.theme.tableDividerColor}`},...!r&&{minHeight:150},...t&&{paddingBottom:o},height:this.getComputedOuterHeight()}}getTableSelectableStyle(e){return{whiteSpace:"nowrap",background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,paddingLeft:e,borderRight:`1px solid ${this.theme.tableDividerColor}`,boxShadow:this.theme.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:this.tableWidthStore.state+e+1,height:this.getComputedOuterHeight()}}getComputedOuterHeight(){const{device:e}=this.environment,{paddingBottom:t,isFullScreen:o}=this.props,{timelineSizeObserver:i}=this.timelineState,r=i.rect.state.height||120,n=this.showTableStore.state;return r+t+(o?0:72)+(!o&&n?28:0)+(o&&e.isMobile?72:0)}}Gc.displayName="CollectionTimelineView";const Wc=Gc;function Kc(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:i}=e;window.__c={n:"MissingDateProperty"};const r=(0,c.VK)((()=>t.permissionScopes.state.canConfigureBlock),[t]),n=t.settingsStore;return(0,kt.jsx)(Fo,{collectionContextStore:t,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,kt.jsx)(jo,{onClick:()=>{D.r$({collectionContextStore:t,collectionSettingsStore:n}),D.H4({collectionSettingsStore:n,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:i}})}function Uc(e,t,o,i,r){return function(e,t,o,i){return(0,de.fj)({environment:i,isRootChild:e,isFullScreen:t,format:o})}(e,t,o,r)?de.Qw:i}function qc(e,t,o){const i=t.viewIsFlushToTopbar();return 0!==e||i?{borderTop:`1px solid ${o.tableDividerColor}`}:{}}function $c(e,t,o,i,r){if(i.device.isMobile)qe._({environment:i,store:e,pageVisitSource:u.tY.Create});else{const{groupFormat:t}=o,n=t?[t]:[],s=r.groupsStore.getGroupState(n);$e.CH({environment:i,store:e,peekMode:ue.kr(r.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:r,pageVisitSource:u.tY.Create})}}var Yc=o(9999),Qc=o(39567),Xc=o(25651),Jc=o(89086),ed=o(44862);const td=function(e){const{store:t,titleStyle:o,actionButton:i,collectionContextStore:r}=e;return(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("div",{style:{display:"flex"},children:[(0,kt.jsx)(xi.Z,{store:t,style:o}),i]}),(0,kt.jsx)(ed.Z,{collectionStore:t,collectionContextStore:r})]})};var od=o(19987);const id=(0,V.defineMessages)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}});class rd extends s.Z{constructor(){super(...arguments),this.isEditingName=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return!1;const o=t.getNameStore();return Boolean((0,Jc.J5)(o))})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>{const{store:e}=this.props,t=Le.default.state;return(0,ue.Ks)(e)||!(0,ue.en)(e)&&t.open&&t.isClosing}))}renderComponent(){var e;const{collectionContextStore:t,isFullScreen:o,canEdit:i}=this.props,r=t.collectionStore(),n=t.permissionScopes.state,s=t.collectionViewBlockStore();if(!r||!s)return;const l=Boolean((null===(e=r.getParentBlockStore())||void 0===e?void 0:e.id)===s.id),a=Boolean(r.isSyncedCollection()),c=this.isEditingName.state,d=this.isInFrameWhenSidePeekOpen.state,{WindowSizeStore:u}=this.environment,p=Math.min(fe.zL,u.state.width),h=(l||c)&&n.canConfigureCollection&&!a;return(0,kt.jsxs)("div",{style:{...(o||d)&&(0,ve.eA)(this.environment)&&{position:"sticky",left:0},paddingTop:8,boxSizing:d?"content-box":void 0,width:d?p:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[h?(0,kt.jsx)(gd,{collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore}):(0,kt.jsx)(md,{collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore}),a&&(0,kt.jsx)("div",{style:{display:"flex"},children:(0,kt.jsx)(od.Z,{canEdit:i,store:s,buttonStyle:{margin:0}})})]})}}rd.displayName="CollectionViewBlockSource";const nd=(0,V.injectIntl)(rd);function sd(){return{fontWeight:R.Z.fontWeight.bold,fontSize:22}}function ld(e){const t=e.collectionStore();if(!t)return;const o=t.getParentBlockStore();return o?(0,he.ZP)({store:o,fullyQualified:!1,pageVisitSource:u.tY.Breadcrumb}):void 0}function ad(e){const t=e.collectionStore();if(!t)return 22;return t.isSyncedCollection()?58:22}function cd(e,t){return{width:24,height:t?24:16,fill:e.regularIconColor}}function dd(e){let{parent:t,collectionContextStore:o}=e;window.__c={n:"ActionsPopupComponent"};const i=(0,Ht.Fg)(),r=(0,et.O7)(),n=(0,c.VK)((()=>o.permissionScopes.state),[o]),s=(0,c.VK)((()=>o.collectionStore()),[o]),l=(0,c.VK)((()=>null==s?void 0:s.isSyncedCollection()),[s]);if(!s)return null;const a=x.oA([{key:"view",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,Yc.J)(cd(i))}),action:e=>{const i=ld(o);if(!i)return null;const n=pe.DJ(e.event);N.c4({environment:r,url:i,openInNew:n}),n||t.close(),j.wd({environment:r,collectionContextStore:o,action:"click_source_view"})}},n.canConfigureCollection&&!l&&{key:"edit_name",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,Xc.R)(cd(i))}),action:()=>{K.mT({environment:r,store:s.getNameStore(),canSelectAllBlocks:!1}),t.close(),j.wd({environment:r,collectionContextStore:o,action:"click_source_edit_title"})}}]),d={key:"show_title",render:e=>(0,kt.jsx)(mt.Z,{...e,icon:(0,Ds.L)(cd(i,!0)),title:(0,kt.jsx)(V.FormattedMessage,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{const e=o.collectionViewStore();if(!e)return null;U.createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:r,perform:t=>{Ke.FH({stores:[e],update:{hide_linked_collection_name:!0},transaction:t})}}),t.close(),j.wd({environment:r,collectionContextStore:o,action:"click_source_hide_title"})}};return(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,sections:x.oA([{key:"actions",render:e=>(0,kt.jsx)(xt.Z,{...e}),items:a},n.canConfigureBlock&&{key:"show_title",render:e=>(0,kt.jsx)(xt.Z,{...e,topBorder:!0}),items:[d]}]),initialFocus:void 0})}function ud(e){let{showHoverActionsStore:t,collectionContextStore:o}=e;window.__c={n:"ActionButtonComponent"};const i=(0,et.O7)(),r=(0,c.VK)((()=>t.state),[t]);return(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{opacity:r?1:0},render:()=>(0,kt.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:4},children:(0,kt.jsx)(gt.ZP,{popupType:i.device.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,render:e=>(0,kt.jsx)(dd,{parent:e,collectionContextStore:o}),renderOrigin:e=>(0,kt.jsx)(Zt.Z,{icon:tt.o,...e}),style:{width:240},originGap:4})})})}function pd(e){G.ZH(e)}function hd(e){let{disabled:t,collectionContextStore:o}=e;window.__c={n:"IconComponent"};const i=(0,Ht.Fg)(),r=(0,et.O7)(),n=(0,c.VK)((()=>o.collectionStore()),[o]),s=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),l=(0,c.VK)((()=>null==n?void 0:n.getIcon()),[n]),a=(0,c.VK)((()=>{var e;return Boolean((null==n||null===(e=n.getParentBlockStore())||void 0===e?void 0:e.id)===(null==s?void 0:s.id))}),[n,s]),d=(0,c.VK)((()=>ad(o)),[o]),u=(0,c.VK)((()=>function(e){return{width:ad(e),height:ad(e),marginRight:4}}(o)),[o]),p=(0,c.VK)((()=>null==s?void 0:s.getType()),[s]);return n&&s?l?(0,kt.jsxs)("div",{style:{position:"relative",width:d+2,height:d+2,marginRight:4},children:[t?(0,kt.jsx)(Ci.Z,{disabled:!0,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:u,size:d}):(0,kt.jsx)(Ci.Z,{disabled:!1,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:u,size:d,iconLoggingData:{recordTable:n.table,source:"inline_collection",block_type:p,collection_id:n.id},onChange:e=>function(e,t,o){const i=o.collectionStore();if(!i)return;const r=i&&i.getIconStore();r&&U.createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:t,perform:t=>{Ue.sO({store:r,value:e,transaction:t})}})}(e,r,o)}),!a&&(0,Qc.Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===i.mode?i.regularTextColor:"#3E3C38",stroke:"dark"===i.mode?i.sidebarBackground:"white",strokeWidth:"dark"===i.mode?"1.85px":"1.5px"})]}):a?null:(0,kt.jsx)("div",{style:{width:20,marginRight:4},children:(0,Yc.J)({width:20})}):null}function md(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;window.__c={n:"LinkButtonComponent"};const i=(0,et.O7)(),r=(0,c.VK)((()=>t.collectionStore()),[t]),n=(0,c.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,c.VK)((()=>ld(t)),[t]);return r&&n?(0,kt.jsxs)(yi.Z,{style:{width:"max-content",maxWidth:"100%",marginRight:4,...R.Z.textOverflowStyle},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:4},href:s,onClick:()=>function(e,t){j.wd({environment:e,collectionContextStore:t,action:"click_collection_name_link_button"})}(i,t),children:[(0,kt.jsx)(hd,{collectionContextStore:t,disabled:!0}),(0,kt.jsx)(td,{actionButton:(0,kt.jsx)(ud,{showHoverActionsStore:o,collectionContextStore:t}),store:r,collectionContextStore:t,titleStyle:sd()})]}):null}function gd(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;window.__c={n:"NameInputComponent"};const i=(0,et.O7)(),r=(0,c.VK)((()=>t.collectionStore()),[t]),n=(0,c.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,c.VK)((()=>null==r?void 0:r.getNameStore()),[r]);return r&&n&&s?(0,kt.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},children:[(0,kt.jsx)(hd,{collectionContextStore:t,disabled:!1}),(0,kt.jsx)(Ja.Z,{store:s,style:{...sd(),marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:ge.default.formatMessage(id.titlePlaceholder),onEnter:()=>pd(i),onEsc:()=>pd(i),onClick:()=>function(e,t){j.wd({environment:e,collectionContextStore:t,action:"click_collection_name_input"})}(i,t),disableShiftEnter:!0,pasteBehavior:"inline"}),(0,kt.jsx)(ud,{showHoverActionsStore:o,collectionContextStore:t})]}):null}var Sd=o(40121),fd=(o(52262),o(24506),o(38297)),vd=o(45953),yd=o(56518);const Cd=new(o(53809).D)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function xd(e,t){let{lastActionWasCut:o,valuePromise:i}=t;const r=(0,yd.tt)(e);Cd.setState({eventId:r,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const n=await i;if(!n)return void Cd.setState({});const{recordMaps:s,...l}=n;Cd.setState({eventId:r,waitingForCopy:!1,lastActionWasCut:o,value:{...l,recordMapsJson:kd(s)}})}function bd(e){const t=Cd.getState(),o=(0,yd.tt)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:i,value:r,lastActionWasCut:n}=t;return i?new Promise((e=>{Cd.addListener(function(e,t){return function o(i){const r=i.getState();if(!r)return void i.removeListener(o);const{waitingForCopy:n,value:s,lastActionWasCut:l}=r;n||r.eventId!==e||(i.removeListener(o),t(s?{lastActionWasCut:l||!1,value:{...s,recordMaps:wd(s.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:n||!1,value:{...r,recordMaps:wd(r.recordMapsJson)}}):Promise.resolve(void 0)}function wd(e){return new Map(e.map((e=>{let[t,o]=e;return[t,vd.Ak.create(o)]})))}function kd(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson({allowVersionDowngrade:!1})]}))}var Pd=o(893),Rd=o(30188),Td=o(54532),Vd=o(79978);function Md(){window.__c={n:"CollectionViewKeyboardArea"};const e=(0,et.O7)(),t=(0,Q.Y$)(),{value:o}=(0,ye.useDependency)(ye.deps.markdownLinkifyIt),{value:i}=(0,ye.useDependency)(ye.deps.tinyMceMicrosoftWordPasteFilter),n=(0,c.VK)((()=>{var e;const o=eo.default.state.stores.filter((e=>Vr.R.findBlockFromStore(e))).at(0),i=null==o?void 0:o.getModel();if(!o||!i)return!1;const r=(0,fd.ky)({block:i,getRecordModel:o.getRecordModel});return!!r&&r.id===(null===(e=t.collectionStore())||void 0===e?void 0:e.id)}),[t]),s=r.useCallback((t=>{Pd.JG({event:t,environment:e,markdownLinkifyIt:o});xd(t,{lastActionWasCut:!1,valuePromise:jd(e).then((t=>Fd({environment:e,subitems:t})))})}),[e,o]),a=r.useCallback((async t=>{Pd.JG({event:t,environment:e,markdownLinkifyIt:o});const i=jd(e),r=i.then((t=>Fd({environment:e,subitems:t})));await xd(t,{lastActionWasCut:!0,valuePromise:r});const n=eo.default.getState().stores,s=await i;await Rd.VP({blocks:n,subitems:s,environment:e,canUndo:!0,skipConfirmation:!0})}),[e,o]),d=r.useCallback((async r=>{var n,s,a,c;const d=await bd(r);if(Cd.setState({...Cd.getState(),lastActionWasCut:!1}),!d)return void U.createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,perform:t=>{Pd.v({environment:e,event:r,disableEmbedMenu:!0,transaction:t,onPasteFiles:Pd.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:i})}});const u=t.collectionViewBlockStore();if(!u)return;const p=t.collectionStore();if(!p)return;const{recordMaps:h,subitemFormat:m,childRelationSchema:g,parentRelationSchema:S}=d.value;if(!(h&&m&&g&&S))return;const f=[...h.entries()].map((e=>{let[t]=e;return Ee.G.createChildStore(p,{table:w.iU,id:t})}));await Promise.all(f.map((e=>e.load())));const v=eo.default.getState().stores,y=!(d.lastActionWasCut&&function(e,t){const o=t.map((t=>Ee.G.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(p,f));let C=[],x=ss.JR(t),b=null===(n=x)||void 0===n?void 0:n.parentRelationProperty,k=null===(s=x)||void 0===s?void 0:s.childRelationSchema,P=null===(a=x)||void 0===a?void 0:a.parentRelationSchema,R=null===(c=x)||void 0===c?void 0:c.subitemFormat;const T=t.permissionScopes.state.canConfigureCollection;if(U.createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,perform:n=>{if(!R&&T){Rd.Bb({transaction:n,collectionContextStore:t,environment:e})&&(x=ss.JR(t),x&&(b=x.parentRelationProperty,k=x.childRelationSchema,P=x.parentRelationSchema,R=x.subitemFormat))}if(!(b&&k&&P&&R))return void Pd.v({environment:e,event:r,disableEmbedMenu:!0,transaction:n,onPasteFiles:Pd.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:i});const s=y?Rd.R2({blocks:f,environment:e,transaction:n,recordMaps:h,migrateSubitemFormat:{from:m,to:R},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:g,parentRelationSchema:S}}):Rd.cI({blocks:f,transaction:n,from:m,to:R,environment:e,subitemRelationSchema:k,relationPropertyCollectionId:p.id,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:i,subitemFormat:r,collectionContextStore:n,transaction:s}=e,l=n.collectionStore();if(!l)return;const a=o.at(-1),c=ss.qb(i,r);if(0===c.length)return;if(a){const e=ss.nK(n,a),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof Ee.G&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),a);c.forEach((e=>{Rd.Cz({environment:t,block:e,collectionStore:l,subitemFormat:r,transaction:s}),o&&Vd.hE({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:r.inverse,inverse:r.property},transaction:s,position:{type:"after"}})}))}else c.forEach((e=>{Rd.Cz({environment:t,block:e,collectionStore:l,subitemFormat:r,transaction:s})}))}({environment:e,selectedBlocks:v,blocksToInsert:s,subitemFormat:R,collectionContextStore:t,transaction:n}),Tr.is({environment:e,blocks:s,selection:v,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:!0}),C=s}}),!(b&&k&&P&&R))return;const V=ss.T2({blocks:C,parentRelationProperty:b,parentRelationSchema:P,collectionViewBlockStore:u});l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{G.Z5({environment:e,stores:V})}))}))}),[t,e,o,i]);return(0,kt.jsx)(Wl.Z,{capture:n,onCopy:s,onCut:a,onPaste:d})}function jd(e){const t=eo.default.getState().stores;return Rd.xr({environment:e,blocks:t})}function Fd(e){let{subitems:t,environment:o}=e;const i=eo.default.getState().stores,r=i.at(0);if(!r)return;const n=(0,ss.g0)(r);if(!n)return;const s=[...i,...t],l=x.oA(s.map((e=>{const t=Td.K8(o,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0});return t&&[e.id,t]}))),a=new Map(l),{subitemFormat:c,childRelationSchema:d,parentRelationSchema:u}=n;return{recordMaps:a,subitemFormat:c,childRelationSchema:d,parentRelationSchema:u}}var Id=o(80503),Bd=o(31194);class _d extends s.Z{constructor(){super(...arguments),this.storeTypes={placementStore:d.default.createClass(void 0),headerRectStore:d.default.createClass(void 0),shouldScrollIntoViewStore:d.default.createClass(!1)},this.lastPlacement=void 0,this.justOpened=!1,this.renderMenu=e=>{const{collectionContextStore:t}=this.props;if(!this.stores.shouldScrollIntoViewStore.state)return(0,kt.jsx)(zr.P,{context:ae.HV.ViewSettings,collectionContextStore:t,collectionSettingsStore:t.settingsStore,fullHeight:e})},this.sidebarLayoutStore=this.createComputedStore((()=>{const e=this.props.headerSizeObserver.rect.state,t=this.environment.WindowSizeStore.state.height,o=e.height-40;return{maxHeight:t-(e.top+40),moveUp:o}}))}UNSAFE_willMountOrUpdate(e){const{collectionContextStore:t,overridePlacement:o}=e,i=Zd(this.props.collectionContextStore),r=this.stores.placementStore.state;i&&!r&&this.props.headerSizeObserver.recompute();const n=this.props.headerSizeObserver.rect.state;if(i&&!r&&n){const e=function(e,t,o,i){if(!Zd(t))return;if(i)return i;const r=(null==e?void 0:e.width)||0;return o.device.isMobile||Le.default.isSidePeekOpen()||!(t.isFullScreen.state||r>600)||t.isCompactView.state?"popup":"sidebar"}(n,this.props.collectionContextStore,this.environment,o);this.stores.placementStore.setState(e),this.justOpened=!0,this.lastPlacement=e}else this.justOpened=!1;i||this.stores.placementStore.setState(void 0),this.justOpened&&(!t.isFullScreen.state&&"popup"!==this.stores.placementStore.state||Le.default.isSidePeekOpen())&&this.stores.shouldScrollIntoViewStore.setState(!0)}didMountOrUpdate(){const{collectionContextStore:e}=this.props,{shouldScrollIntoViewStore:t}=this.stores;if(t.state){const o=e.collectionViewBlockStore();if(o){const t=Vr.R.findCollectionViewBlockFromStore(o);if(t){const o=t.getNode();if(o){const t=o.getBoundingClientRect(),i=this.environment.WindowSizeStore.state.height-t.bottom,r=t.top;(i<Mo.j9||r<Id.Aj||e.isInPeekRenderer.state)&&((0,ve.Wr)(o,{edgeDist:0,animate:!1}),this.props.headerSizeObserver.recompute())}}}t.setState(!1)}}renderComponent(){const{paddingRight:e,collectionContextStore:t}=this.props,o=Zd(this.props.collectionContextStore),i=this.lastPlacement,r=t.isFullScreen.state,n=t.viewIsFlushToTopbar(),s=function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(this.props.collectionContextStore),l=("timeline"===s||"table"===s)&&n;if(i){if("sidebar"===i){const t=this.sidebarLayoutStore.state;if(!t)return;const{maxHeight:i,moveUp:n}=t;return(0,kt.jsx)(Br.Z,{isVisible:o,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},springConfig:Dd,render:()=>(0,kt.jsx)(kn.Z,{capture:o,allowMobileAutoScroll:!0,allowUndo:!0,render:t=>(0,kt.jsx)("div",{style:{position:"absolute",top:(l?1:0)-n,right:-e,height:`calc(100% + ${n}px)`,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,borderLeft:`1px solid ${this.theme.tableDividerColor}`,paddingRight:e,zIndex:T.Nm,...r&&{height:i},...!r&&{maxHeight:i}},className:re.Dkf,...(0,dt.Z)({onMouseDown:e=>{return t=e,o=this.environment,void(0,me.ZP)({event:t,context:me.Af.EditorMouseDown,callback:()=>{K.ZH(o)}});var t,o}},t),children:(0,kt.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,kt.jsx)("div",{style:{boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`},children:this.renderMenu(!0)}),(0,kt.jsx)("div",{style:{width:e}})]})})})})}return(0,kt.jsx)(Ct.ZP,{popupType:this.environment.device.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,open:o,placementToOrigin:Bd.Iw.Bottom,alignmentToOrigin:t.isCompactView.state?Bd.lU.Start:Bd.lU.End,style:{marginTop:-1},origin:(0,kt.jsx)("div",{}),render:this.renderMenu,onDismiss:e=>function(e,t){(0,me.ZP)({event:e,context:me.Af.CollectionSettingsClick,callback:()=>{D.E3({collectionSettingsStore:t.settingsStore})}})}(e,this.props.collectionContextStore),originRect:this.props.headerSizeObserver.rect.state,keepFocus:!0,trapFocus:!0})}}}_d.displayName="CollectionViewSettingsPopup";const Dd={translateX:{stiffness:120,damping:12,precision:.1},opacity:{stiffness:120,damping:10,precision:.001}},Ad=(0,V.injectIntl)(_d);function Zd(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}let Ld;class Ed{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;Ld||(Ld=document.createElement("div"),Ld.style.position="absolute",Ld.style.left="0",Ld.style.top="0",Ld.style.pointerEvents="none",Ld.style.opacity="0",document.body.appendChild(Ld)),x.M6(this.style,((e,t)=>{Ld&&(Ld.style[t]=e)})),Ld.textContent=e;const o=Ld.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}var Od=o(1136),Nd=o(29798),zd=o(13401),Hd=o(73657),Gd=o(17215),Wd=o(14976),Kd=o(55964),Ud=o(27714),qd=o(53470);class $d extends s.Z{constructor(){super(...arguments),this.isMyTasks=this.createComputedStore((()=>{var e;const t=null===(e=this.props.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,ie.qG)(t)}))}renderComponent(){const e=this.getMenuSections();return(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,initialFocus:void 0,sections:x.oA(e.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,kt.jsx)(xt.Z,{...e,topBorder:0!==t}),items:e}})))})}getMenuSections(){const{onClose:e,collectionContextStore:t,collectionViewStore:o,intl:i}=this.props,r=t.permissionScopes.state,n=t.collectionViewStore(),s=t.collectionViewBlockStore();if(!n||!s)return[];const l=n.id===o.id,a=o.getAppConfigUri(),c=a&&(0,$.xB)(a),d=!this.isMyTasks.state&&!c,u=[];if(u.push([]),r.canConfigureBlock){if(u[0].push({key:"rename",render:e=>(0,kt.jsx)(bt.ZP,{placement:bt.ug.Left,disableTooltip:d,render:t=>(0,kt.jsx)(mt.Z,{...e,disabled:!d,disabledFeedback:!0,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,qd.H)(Qd(this.theme,!1)),...t}),renderTooltip:()=>(0,kt.jsx)(V.FormattedMessage,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{j.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_rename"}),null==e||e(!0),l||Z.f8({environment:this.environment,collectionContextStore:t,collectionViewId:o.id,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state}),D.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore,selectViewNameInitial:!0})}}),"page"===o.getType())return u;u[0].push({key:"edit",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,Os.W)(Qd(this.theme,!1))}),action:()=>{j.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_edit"}),null==e||e(!0),l||Z.f8({environment:this.environment,collectionContextStore:t,collectionViewId:o.id,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state}),D.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore})}})}u.push([]),u[1].push({key:"copyLink",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,Ud.N)(Qd(this.theme,!1))}),action:async()=>{j.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_copy_link"}),await D.Ol({environment:this.environment,collectionContextStore:t,collectionViewStore:o}),null==e||e(!1)}});return o.getFormat().hide_linked_collection_name&&r.canConfigureBlock&&u[1].push({key:"showDatabaseTitle",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}),icon:(0,Kd.N)(Qd(this.theme,!0))}),action:()=>{j.wd({environment:this.environment,collectionContextStore:t,action:"click_source_show_title"}),U.createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:this.environment,perform:e=>{Ke.FH({stores:[o],update:{hide_linked_collection_name:!1},transaction:e})}}),null==e||e(!1)}}),u.push([]),r.canConfigureBlock&&!this.isMyTasks.state&&u[2].push({key:"duplicate",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,_s.a)(Qd(this.theme,!1))}),action:()=>{j.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_duplicate"}),D.zt({environment:this.environment,collectionContextStore:t,collectionViewStore:o,collectionSettingsStore:t.settingsStore,intl:i}),null==e||e(!0)}}),r.canConfigureBlock&&!this.isMyTasks.state&&u[2].push({key:"delete",render:e=>(0,kt.jsx)(mt.Z,{...e,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,kr.y)(Qd(this.theme,!1))}),action:async()=>{j.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_delete"});await D.TT({environment:this.environment,collectionContextStore:t,collectionViewStore:o,collectionSettingsStore:t.settingsStore,from:"view_action_menu"})&&(null==e||e(!1))}}),u}}$d.displayName="CollectionViewActionMenu";const Yd=(0,V.injectIntl)($d);function Qd(e,t){return{width:24,height:t?24:16,fill:e.regularIconColor}}function Xd(e){window.__c={n:"CollectionViewSelectItem"};const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:i,onClose:r}=e,{device:n}=(0,et.O7)(),s=(0,Ht.yK)((e=>({tooltipMessage:{color:e.mediumInvertedTextColor}})),[]),l=(0,V.useIntl)(),a=(0,c.qz)(void 0,Re.Z),[d,u,p,h,m,g]=(0,c.VK)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,t.collectionStore(),t.permissionScopes.state.canConfigureBlock]),[o,t]);if(void 0===u)return null;const S=e=>{a.setState({open:!1}),e&&r()},f=()=>{const t=n.isMobile?{menuType:ct.og.ActionSheet}:{menuType:ct.og.Popup,width:220};return(0,kt.jsx)(St.Z,{...t,children:(0,kt.jsx)(Yd,{...e,onClose:S})})},v=()=>{if(g)return(0,kt.jsx)(gt.ZP,{popupType:n.isMobile?gt.Z4.SlideUp:gt.Z4.Popup,renderOrigin:e=>(0,kt.jsx)(Zt.Z,{icon:tt.o,ariaLabel:l.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:f,buttonPopupStore:a})};return(0,kt.jsx)(bt.ZP,{renderTooltip:e=>(0,kt.jsxs)("div",{...e,style:Ys.F6,children:[(0,kt.jsx)("div",{children:(0,ue.Cc)({collectionViewName:d,collectionViewType:u})}),void 0!==m&&(0,kt.jsx)("div",{style:s.tooltipMessage,children:h||(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:Yt.Bh[u],collection:(0,Wd.Xh)(m.getName(),m)||(0,Gd.Q2)(l)}})})]}),placement:ps.u.Left,render:e=>(0,kt.jsx)(mt.Z,{title:(0,kt.jsx)(sr.Z,{collectionViewType:u,collectionViewName:d}),icon:(0,kt.jsx)(Od.F,{color:"regular",viewIcon:p,viewType:u}),showDragHandle:!n.isMobile&&g,right:v(),rightStyle:{marginRight:8},...(0,dt.Z)(e,i)})})}Xd.displayName="CollectionViewSelectItem";var Jd=o(88833);const eu=(0,V.defineMessages)({suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.collectionViewSuggestedViews.suggestedTitle"}});function tu(e,t){const o=(0,et.O7)(),i=(0,c.VK)((()=>Pe.default.state.currentSpaceViewStore),[]),n=(0,c.VK)((()=>e.collectionViewBlockStore()),[e]),s=(0,c.VK)((()=>e.collectionStore()),[e]),l=(0,c.VK)((()=>{var e;if(!s)return;const t=null===(e=s.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,$.YB)((0,$s.appConfigs)(),t):void 0}),[s]),a=r.useCallback((r=>{if(!n||!l||!i)return;const s=n.getParentStore();if(!s||"block"!==s.table&&"space"!==s.table&&"team"!==s.table)return;if(1!==r.dependencies.length)return;const a=r.dependencies[0];U.createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:o,perform:c=>{var d;Jd.applyFeatures({environment:o,spaceViewStore:i,appParentStore:s,appUri:l.uri,features:[{type:"simple",featureUri:r.uri}],appCollectionViewBlockStores:[n],createOrModify:"modify",transaction:c});const u=((null===(d=n.getFormat())||void 0===d?void 0:d.app_uri_map)??{})[a.uri];Z.f8({environment:o,collectionContextStore:e,collectionViewId:u,isFullScreen:e.isFullScreen.state,isRootChild:e.isRootChild.state,isInPeekRenderer:e.isInPeekRenderer.state}),t()}}),j.xb({environment:o,collectionContextStore:e,view_type:a.value.type,view_config_uri:r.uri})}),[n,l,i,o,e,t]);return{renderSuggestedView:r.useCallback((e=>({key:e.uri,render:t=>(0,kt.jsx)(bt.ZP,{placement:bt.ug.Left,render:o=>((e,t)=>{var o;const i=e.dependencies[0],r=(0,kt.jsx)(Od.F,{color:"regular",viewIcon:null===(o=i.value.format)||void 0===o?void 0:o.collection_view_icon,viewType:i.value.type});return(0,kt.jsx)(mt.Z,{title:i.value.name?i.value.name:"New View",icon:r,...t})})(e,{...t,...o,onMouseEnter:e=>{var i,r;null===(i=o.onMouseEnter)||void 0===i||i.call(o,e),null===(r=t.onMouseEnter)||void 0===r||r.call(t,e)}}),renderTooltip:()=>e.description}),action:()=>{a(e)}})),[a])}}function ou(e){window.__c={n:"CollectionViewSuggestedViews"};const t=(0,et.O7)().device,o=(0,Ht.yK)((e=>({showMoreLabel:{color:e.mediumTextColor}})),[]),i=e.suggestedViews,{renderSuggestedView:n}=tu(e.collectionContextStore,e.onClose),[s,l]=(0,r.useState)(!1),{collectionContextStore:a,onClose:d,onNewEmptyViewClick:u}=e,p=(0,c.VK)((()=>a.permissionScopes.state),[a]),h=(null==i?void 0:i.map((e=>n(e))))??[],m={key:"showMore",render:e=>(0,kt.jsx)(mt.Z,{...e,style:o.showMoreLabel,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Show more...",id:"collectionViewSuggestedViews.showMore.label"})}),action:()=>{l(!0)}},g=(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,initialFocus:0,sections:[{key:"suggested_views",render:e=>(0,kt.jsx)(xt.Z,{...e}),items:s||h.length<=5?h:[...h.slice(0,5),m]}]}),S=p.canConfigureBlock&&(0,kt.jsx)(xt.Z,{topBorder:!0,children:(0,kt.jsx)(zd.Z,{title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"New empty view",id:"database.collectionViewSuggestedViews.newEmptyViewTitle"}),onClick:()=>{u("CollectionViewSuggestedViews2.handleNewEmptyViewClick"),d()},focused:!1})});return(0,kt.jsx)(kn.Z,{capture:!0,allowEsc:!0,render:e=>{let o;return o=t.isMobile?{menuType:ct.og.Modal,title:ge.default.formatMessage(eu.suggestedSectionTitle),right:(0,kt.jsx)(vt.DoneMenuText,{}),onClickRight:d,...e}:{menuType:ct.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e},(0,kt.jsxs)(St.Z,{...o,children:[h.length&&(0,kt.jsx)(xt.Z,{title:!t.isMobile&&ge.default.formatMessage(eu.suggestedSectionTitle),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:2,marginBottom:2},style:{paddingBottom:0},children:g}),S]})}})}class iu extends s.Z{constructor(){super(...arguments),this.initialMenuListFocus=0,this.storeTypes={menuListStore:Nd.Z,viewFilterQueryStore:d.default.createClass("")},this.renderViewsSection=e=>{if(this.isDraggable()){const t=this.getFilteredViewStores().map((e=>e.id));return(0,kt.jsx)(xt.Z,{...e,children:(0,kt.jsx)(_o.ZP,{direction:"vertical",keys:t,renderKey:o=>e.children[t.indexOf(o)],onDrop:this.handleViewsDrop})})}return(0,kt.jsx)(xt.Z,{...e})},this.handleViewsDrop=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore();o&&(U.createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:this.environment,perform:t=>{Z.Wu({collectionViewBlockStore:o,newViewIds:e,transaction:t})}}),this.stores.menuListStore.reset())},this.handleViewFilterQueryChange=e=>{this.stores.viewFilterQueryStore.setState(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.filterView=e=>(0,ue.D)(e,this.stores.viewFilterQueryStore.state)}UNSAFE_willMount(e){var t,o;const{collectionContextStore:i}=e,r=null===(t=i.collectionViewStore())||void 0===t?void 0:t.id,n=((null===(o=i.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===r));n>=0&&(this.initialMenuListFocus=n),this.stores.viewFilterQueryStore.setState("")}renderComponent(){var e;const{intl:t,collectionContextStore:o,onClose:i,onAddViewClick:r}=this.props,{device:n}=this.environment,s=o.permissionScopes.state,l=(0,ie.qG)((null==o||null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.id)??""),a=(0,kt.jsx)(zd.Z,{title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),onClick:()=>function(e,t){e("CollectionViewSelect2.handleCreateButtonClick"),t()}(this.props.onAddViewClick,this.props.onClose),focused:!1});return(0,kt.jsx)(kn.Z,{capture:!0,allowEsc:!0,render:e=>{var c,d;let u;u=n.isMobile?{menuType:ct.og.Modal,title:(0,kt.jsx)(su,{collectionContextStore:this.props.collectionContextStore}),right:(0,kt.jsx)(vt.DoneMenuText,{}),onClickRight:this.props.onClose,...e}:{menuType:ct.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e};const p=s.canConfigureBlock&&!l&&(0,kt.jsx)(xt.Z,{topBorder:!0,children:this.props.suggestedViews&&this.props.suggestedViews.length?(0,kt.jsx)(gt.ZP,{popupType:this.environment.device.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,alignmentToOrigin:gt.vR.Center,placementToOrigin:gt.pO.Right,renderOrigin:e=>(0,kt.jsx)(zd.Z,{title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),focused:!1,...e}),render:()=>(0,kt.jsx)(ou,{collectionContextStore:o,suggestedViews:this.props.suggestedViews??[],onClose:i,onNewEmptyViewClick:r})}):a});return(0,kt.jsxs)(St.Z,{...u,header:!n.isMobile&&!(null!==(c=o.collectionViewBlockStore())&&void 0!==c&&c.isCollectionViewPageWithContent())&&(0,kt.jsx)(ro.ZP,{value:this.stores.viewFilterQueryStore.state,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:this.handleViewFilterQueryChange,placeholder:t.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}),footer:!n.isMobile&&p,children:[(0,kt.jsx)(xt.Z,{title:!n.isMobile&&!(null!==(d=o.collectionViewBlockStore())&&void 0!==d&&d.isCollectionViewPageWithContent)&&(0,kt.jsx)(su,{collectionContextStore:this.props.collectionContextStore}),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:0,marginBottom:0},children:this.renderMenuList()}),this.stores.viewFilterQueryStore.state&&0===this.getFilteredViewStores().length&&(0,kt.jsx)(Hd.Z,{caption:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),n.isMobile&&p]})}})}renderMenuList(){const e=this.getFilteredViewStores();if(e.length>0)return(0,kt.jsx)(ft.Z,{type:ft.i.Vertical,initialFocus:this.initialMenuListFocus,sections:[{key:"views",render:this.renderViewsSection,items:e.map((e=>({key:e.id,render:t=>(0,kt.jsx)(lu,{collectionContextStore:this.props.collectionContextStore,onClose:this.props.onClose,collectionViewStore:e,props:t}),action:t=>{let{event:o}=t;!function(e,t,o,i,r,n,s,l,a){const c=o.collectionViewStore();c&&i({currentCollectionViewStore:c,newCollectionViewStore:e,openInNew:a});(function(e,t,o,i,r,n,s){Z.f8({environment:n,collectionContextStore:t,collectionViewId:e.id,openInNew:s,isFullScreen:o,isRootChild:i,isInPeekRenderer:r}),j.wd({environment:n,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:e.getType(),new_view_id:e.id})})(e,o,r,n,s,t,a),a||l()}(e,this.environment,this.props.collectionContextStore,this.props.onViewClick,this.props.isFullScreen,this.props.isRootChild,this.props.isInPeekRenderer,this.props.onClose,pe.DJ(o))}})))}],store:this.stores.menuListStore})}getFilteredViewStores(){return nu(this.props.collectionContextStore).filter(this.filterView)}isDraggable(){return function(e,t){const o=e.permissionScopes.state,{device:i}=t;return!i.isMobile&&o.canConfigureBlock}(this.props.collectionContextStore,this.environment)&&""===this.stores.viewFilterQueryStore.state}}iu.displayName="CollectionViewSelect";const ru=(0,V.injectIntl)(iu);function nu(e){var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewStores())||[]}function su(e){let{collectionContextStore:t}=e;window.__c={n:"MenuTitle"};const o=(0,c.VK)((()=>nu(t)),[t]);return(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function lu(e){let{collectionViewStore:t,props:o,collectionContextStore:i,onClose:r}=e;return(0,kt.jsx)(Xd,{collectionContextStore:i,collectionViewStore:t,onClose:r,menuListItemProps:o})}var au=o(60310),cu=o(16732),du=o(26991),uu=o(65089);class pu extends s.Z{constructor(){super(...arguments),this.storeTypes={popupOpen:d.default.createClass(!1)},this.renderPopup=()=>{const{device:e}=this.environment;let t;return t=e.isPhone?{menuType:ct.og.Modal,right:(0,kt.jsx)(vt.DoneMenuText,{}),onClickRight:this.handleClose}:{menuType:ct.og.Popup,minWidth:220},(0,kt.jsx)(St.Z,{...t,children:(0,kt.jsx)(Yd,{...this.props,onClose:this.handleClose})})},this.handleClick=e=>{const{collectionViewStore:t,collectionContextStore:o}=this.props,i=o.collectionViewStore();if(!i)return;const r=pe.DJ(e);this.props.onViewClick({currentCollectionViewStore:i,newCollectionViewStore:t,openInNew:r}),i.id===t.id?this.stores.popupOpen.setState(!0):function(e,t,o,i){Z.f8({environment:o,collectionContextStore:t,collectionViewId:e,openInNew:i,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state})}(t.id,this.props.collectionContextStore,this.environment,r),j.wd({environment:this.environment,collectionContextStore:o,action:"click_view_tab",new_view_type:t.getType(),new_view_id:t.id})},this.handleContextMenu=e=>{e.preventDefault(),(0,me.ZP)({event:e,context:me.Af.EditorContextMenu,callback:()=>{this.stores.popupOpen.setState(!0)}})},this.handleClose=()=>{this.stores.popupOpen.setState(!1)}}renderComponent(){var e,t,o;const{collectionViewStore:i,collectionContextStore:n,disabled:s}=this.props,{popupOpen:l}=this.stores,{device:a}=this.environment,c=(0,r.createRef)(),d=function(e){return e.collectionViewStore()}(this.props.collectionContextStore);if(!i.isDefined()||!d)return;const u=i.getType(),h=i.getFormat().collection_view_icon,m=d.id===i.id,g=(null===(e=n.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||"none",S=n.collectionViewBlockStore();if(!S)return(0,kt.jsx)(kt.Fragment,{});const f=S.getSpaceId()!==(null===(t=Pe.default.state.currentSpaceStore)||void 0===t?void 0:t.id),v=i.getFormat().app_config_uri===p.g3&&"sprint_board"===(null===(o=Pe.default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.getFormat().special_page_for_pm_launch)&&!f,y=(0,ie.aT)(S.id,n.isInPeekRenderer.state);return(0,kt.jsx)(Ct.ZP,{popupType:a.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,alignmentToOrigin:Ct.ZP.Alignment.Start,open:l.state,render:this.renderPopup,onDismiss:this.handleClose,origin:(0,kt.jsxs)("div",{className:re.rTm,style:{display:"flex",alignItems:"center",background:g,height:"100%",...m&&!y&&{borderBottom:`2px solid ${this.theme.regularTextColor}`,paddingTop:2}},onContextMenu:this.handleContextMenu,children:[v&&(0,kt.jsx)(uu.FF,{origin:c}),(0,kt.jsx)(hu,{collectionViewStore:i,render:e=>(0,kt.jsxs)(yt.Z,{"aria-selected":m,role:"tab",ref:c,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:R.Z.fontWeight.medium,color:m?this.theme.regularTextColor:this.theme.mediumTextColor,maxWidth:Cu},hovered:l.state,onClick:this.handleClick,disabled:s,...e,children:[(0,kt.jsx)(Od.F,{color:m?"regular":"light",viewIcon:h,viewType:u,style:{marginRight:6}}),(0,kt.jsx)("span",{style:{...R.Z.textOverflowStyle,marginTop:1},children:(0,kt.jsx)(gu,{collectionContextStore:n,collectionViewStore:i})})]},i.id)})]})})}}function hu(e){window.__c={n:"CollectionViewTabTooltip"};const t=(0,Ht.Fg)(),o=(0,V.useIntl)(),{collectionViewStore:i,render:r}=e,n=(0,c.VK)((()=>i.getCollectionStore()),[i]),s=(0,c.VK)((()=>null==n?void 0:n.getModel()),[n]),l=(0,c.VK)((()=>i.getFormat().description),[i]),a=(0,c.VK)((()=>i.getModel()),[i]);return a?(0,kt.jsx)(bt.ZP,{placement:bt.ug.Bottom,alignment:bt.v2.Start,delayThreshold:500,render:r,renderTooltip:e=>(0,kt.jsxs)("div",{...e,style:Ys.F6,children:[(0,kt.jsx)("div",{children:(0,ue.Cc)({collectionViewName:a.getName(),collectionViewType:a.getType()})}),n&&s&&(0,kt.jsx)("div",{style:{color:t.mediumInvertedTextColor},children:l||(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:Yt.Bh[a.getType()],collection:(0,Wd.Xh)(n.getName(),n)||s.getEmptyTitlePlaceholder({intl:o})}})})]})}):null}function mu(e,t,o){var i;const r=e.collectionStore();if(!r)return t.getName();const n=r.getPropertyMapping(),s=t.getName(),l=null==n?void 0:n[p.Es.TaskToSprintRelation];if(!o||!l||s!==ge.default.formatMessage(cu.sY.tasksCurrentSprintV2ViewName))return t.getName();const a=o[l];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(i=(0,du.As)(e,"current",a.collection_pointer,r))||void 0===i?void 0:i.getBlockTitleStore().getValue();return c?`${ge.default.formatMessage(cu.sY.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function gu(e){window.__c={n:"CollectionViewTabTitle"};const{collectionViewStore:t,collectionContextStore:o}=e,i=(0,V.useIntl)(),[r,n]=(0,c.VK)((()=>{const e=o.settingsStore.state;return[e.open,x.Z$(e.stack)]}),[o.settingsStore]),s=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),l=(0,c.VK)((()=>o.collectionViewStore()),[o]),a=(0,c.VK)((()=>t.getCollectionStore()),[t]),d=(0,c.VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===p.g3&&null!=a&&a.isDefined()?{name:mu(o,t,a.getSchema()),type:t.getType()}:s&&(0,ie.qG)(s.id)?{name:i.formatMessage(au.CN.assignedToMeView),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,a,s,o,i]);return!d||l&&l.id===t.id&&r&&n&&("duplicateExistingView"===n.type||"createViewSource"===n.type||"createView"===n.type)?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,kt.jsx)(sr.Z,{collectionViewName:d.name,collectionViewType:d.type})}pu.displayName="CollectionViewTab";const Su=(0,V.injectIntl)(pu);var fu=o(78454);function vu(e){window.__c={n:"WikiHomeOnboardingTooltip"};const{origin:t}=e,o=(0,et.O7)();return(0,kt.jsx)(wl.U,{origin:t,placementToOrigin:"bottom",header:(0,kt.jsx)(V.FormattedMessage,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{ks.Rg(o)},shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:Rl.EZ,pointerOffset:Rl.rK,style:{width:Rl.G5}})}function yu(e){window.__c={n:"WikiViewsOnboardingTooltip"};const{origin:t}=e,o=(0,et.O7)();return(0,kt.jsx)(wl.U,{origin:t,placementToOrigin:"right",header:(0,kt.jsx)(V.FormattedMessage,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,kt.jsx)("span",{style:{fontWeight:R.Z.fontWeight.semibold},children:e})}}),onCloseClick:()=>{ks.Rg(o)},pointerPosition:"50%",pointerLength:Rl.EZ,pointerOffset:Rl.FD,shouldDismissUponOutsideClick:!0,style:{width:Rl.G5}})}const Cu=220;class xu extends s.Z{constructor(){super(...arguments),this.viewSelectContainerSizeObserver=new Ne.E({throttleMs:200}),this.viewIdWidthEstimatorMap=new Map,this.homeViewRef=r.createRef(),this.viewsDropdownRef=r.createRef(),this.storeTypes={buttonPopupStore:Re.Z},this.renderViewsPopup=(e,t)=>{var o;const{collectionContextStore:i}=this.props,{device:r}=this.environment,n=i.isFullScreen.state,s=i.isRootChild.state,l=i.isInPeekRenderer.state,a=(null===(o=i.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===p.GZ;return(0,kt.jsxs)(kt.Fragment,{children:[!r.isMobile&&"views"===ks.B1()&&a&&(0,kt.jsx)(yu,{origin:this.viewsDropdownRef}),(0,kt.jsx)("div",{ref:this.viewsDropdownRef,children:(0,kt.jsx)(ru,{collectionContextStore:i,onAddViewClick:e=>Ru(e,this.environment,this.props.collectionContextStore),suggestedViews:t,onClose:e.close,isFullScreen:n,isRootChild:s,isInPeekRenderer:l,onViewClick:this.props.onViewClick})})]})},this.handleViewSelectContainerMount=e=>{e&&this.viewSelectContainerSizeObserver.observe(e)},this.renderStateStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,showHoverActionsStore:o}=this.props,{device:i}=this.environment,r=ku(this.props.collectionContextStore),n=this.showViewTabsStore.state,s=(null==n?void 0:n.length)||0,l=r.length-s,a=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent())||i.isPhone||n&&(0===s||1===s&&r.length>1)||t.isCompactView.state?"dropdown":l>0?"someTabsNotVisible":"allTabsVisible",c=t.isFullScreen.state||o.state;return{showMoreViewsButton:"someTabsNotVisible"===a||"dropdown"===a,showAddViewButton:wu(this.props.collectionContextStore,this.props.isPlaceholderExternalCollectionStore)&&"allTabsVisible"===a,addViewButtonAnimatedIn:c,viewSelectState:a,moreViewsCount:l}})),this.showViewTabsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=ku(this.props.collectionContextStore),o=e.collectionViewStore();if(!o)return;const i=Math.max(100,wu(this.props.collectionContextStore,this.props.isPlaceholderExternalCollectionStore)?105:0);let r=this.viewSelectContainerSizeObserver.rect.state.width-i;const n=[],s=this.measureViewTabWidth(o);if(!(s<r))return n;n.push(o),r-=s;for(const c of t)if(c.id!==o.id){const e=this.measureViewTabWidth(c);if(!(e<r))break;n.push(c),r-=e}const l=n.filter((e=>e.id!==o.id)),a=t.findIndex((e=>e.id===o.id));return l.splice(a,0,o),l}))}willUnmount(){super.willUnmount(),this.viewSelectContainerSizeObserver.destroy()}renderComponent(){const{collectionContextStore:e}=this.props,t=this.renderStateStore.state,o=function(e){const t=e.collectionStore(),o=e.collectionViewBlockStore();if(!t||!o)return;const i=t.getFormat().app_config_uri,r=i?(0,$.YB)((0,$s.appConfigs)(),i):void 0;if(!r)return;return(0,$.AG)(r,t,o)}(e),i=e.isCompactView.state;return(0,kt.jsxs)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:i?void 0:1},ref:this.handleViewSelectContainerMount,children:[this.renderViewTabs(),t.showMoreViewsButton&&(0,kt.jsx)(gt.ZP,{popupType:this.environment.device.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,render:e=>this.renderViewsPopup(e,o),renderOrigin:e=>this.renderViewSelectButton(e),onClick:()=>function(e,t){j.wd({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(this.environment,this.props.collectionContextStore)}),t.showAddViewButton&&(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{opacity:t.addViewButtonAnimatedIn?1:0},render:()=>o&&o.length?(0,kt.jsx)(gt.ZP,{popupType:gt.Z4.Popup,alignmentToOrigin:fu.v2.Center,render:e=>(0,kt.jsx)(Tu,{collectionContextStore:this.props.collectionContextStore,parent:e,suggestedViews:o}),renderOrigin:e=>(0,kt.jsx)(Zt.Z,{className:re.rVO,icon:y.R,...e})},"suggested-views"):(0,kt.jsx)(Zt.Z,{className:re.rVO,icon:y.R,onClick:()=>Ru("CollectionViewTabBar.handleAddViewClick",this.environment,this.props.collectionContextStore)})})]})}renderViewSelectButton(e){var t;const{collectionContextStore:o,disabled:i}=this.props,{device:r}=this.environment,n=this.renderStateStore.state,s=function(e){return e.collectionViewStore()}(this.props.collectionContextStore);if(!s)return;if(!s.isDefined())return;const l=(null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri)===p.GZ&&"page"===s.getType();if("dropdown"===n.viewSelectState){const t=s.getType(),n=s.getFormat().collection_view_icon;return(0,kt.jsxs)(kt.Fragment,{children:[!r.isMobile&&l&&"home"===ks.B1()&&(0,kt.jsx)(vu,{origin:this.homeViewRef}),(0,kt.jsx)(hu,{collectionViewStore:s,render:r=>(0,kt.jsxs)(yt.Z,{ref:this.homeViewRef,style:{display:"flex",alignItems:"center",fontSize:i?R.Z.fontSize.UISmall.desktop:R.Z.fontSize.UIRegular.desktop,fontWeight:R.Z.fontWeight.semibold,color:i?this.theme.mediumTextColor:this.theme.regularTextColor,maxWidth:Cu,paddingRight:i?0:void 0},disabled:i,...e,...r,children:[(0,kt.jsx)(Od.F,{color:i?"lightGray":"regular",viewType:t,viewIcon:n,style:{marginRight:i?8:6},size:i?14:void 0}),(0,kt.jsx)("span",{style:{...R.Z.textOverflowStyle,marginRight:6,marginTop:1},children:(0,kt.jsx)(gu,{collectionContextStore:o,collectionViewStore:s})}),!this.props.disabled&&(0,wn.i)({marginTop:2,width:10,height:10,fill:this.theme.lightIconColor})]})})]})}return"someTabsNotVisible"===n.viewSelectState?(0,kt.jsx)(yt.Z,{style:{display:"flex",alignItems:"center",fontSize:R.Z.fontSize.UIRegular.desktop,color:this.theme.mediumTextColor},...e,children:(0,kt.jsx)("span",{style:{marginTop:1},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:n.moreViewsCount}})})}):void 0}renderViewTabs(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,o=this.showViewTabsStore.state,i=this.renderStateStore.state;if(o&&"dropdown"!==i.viewSelectState)return t.canConfigureBlock?(0,kt.jsx)(_o.ZP,{direction:"horizontal",keys:o.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const t=o.find((t=>t.id===e));if(t)return(0,kt.jsx)(Pu,{collectionContextStore:this.props.collectionContextStore,onViewClick:this.props.onViewClick,disabled:this.props.disabled,collectionViewStore:t})},onDrop:e=>function(e,t,o){const i=o.collectionViewBlockStore();if(!i)return;U.createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,perform:t=>{Z.Wu({collectionViewBlockStore:i,newViewIds:e,transaction:t})}})}(e,this.environment,this.props.collectionContextStore)}):o.map((e=>(0,kt.jsx)(Pu,{collectionContextStore:this.props.collectionContextStore,onViewClick:this.props.onViewClick,disabled:this.props.disabled,collectionViewStore:e},e.id)))}measureViewTabWidth(e){const t=e.getName(),o=e.getType();if(!o)return 0;let i=this.viewIdWidthEstimatorMap.get(e.id);i||(i=new Ed({style:{fontSize:`${R.Z.fontSize.UIRegular.desktop}px`,fontWeight:R.Z.fontWeight.medium}}),this.viewIdWidthEstimatorMap.set(e.id,i));const r=(0,ue.Cc)({collectionViewName:t,collectionViewType:o}),n=i.measure(r);return Math.min(40+n.width,Cu)}}xu.displayName="CollectionViewTabBar";const bu=(0,V.injectIntl)(xu);function wu(e,t){var o;const i=e.permissionScopes.state,r=null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.id,n=r&&(0,ie.qG)(r);return i.canConfigureBlock&&!t.state&&!n}function ku(e){var t;return(null===(t=function(e){return e.collectionViewBlockStore()}(e))||void 0===t?void 0:t.getCollectionViewStores())||[]}function Pu(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:i,disabled:r}=e;return(0,kt.jsx)(Su,{collectionContextStore:o,collectionViewStore:t,onViewClick:i,disabled:r},t.id)}function Ru(e,t,o){U.createAndCommit({userAction:e,environment:t,perform:e=>{Z.ME({environment:t,collectionContextStore:o,transaction:e})}}),j.xb({environment:t,collectionContextStore:o,view_type:"table"})}function Tu(e){let{parent:t,suggestedViews:o,collectionContextStore:i}=e;window.__c={n:"SuggestedViewsPopupComponent"};const r=(0,et.O7)();return(0,kt.jsx)(ou,{collectionContextStore:i,suggestedViews:o,onClose:t.close,onNewEmptyViewClick:e=>Ru(e,r,i)})}var Vu=o(74194),Mu=o(53336),ju=o(14562),Fu=o(61679),Iu=o(22789),Bu=o(31192),_u=o(95691),Du=o(56274),Au=o(77744),Zu=o(19977),Lu=o(45162),Eu=o(82136),Ou=o(15201),Nu=o(72711),zu=o(57819),Hu=o(16772),Gu=o(97053),Wu=o(55217);function Ku(e){window.__c={n:"DocumentView"};const{store:t,disabled:o,paddingLeft:i,paddingRight:r,setRef:n}=e,s=(0,et.O7)(),l=(0,c.VK)((()=>{const e=t.getFormat();return{pageFont:e.page_font,pageSmallText:e.page_small_text}}),[t]),a=(0,c.VK)((()=>(0,fe.CX)(t)),[t]),d=(0,Gu.Nr)(t),u=(0,c.VK)((()=>(0,fe.a_)(t)),[t]),p=(0,c.VK)((()=>t.isLocked()),[t]),{safePaddingLeft:h,safePaddingRight:m}=(0,c.VK)((()=>({safePaddingLeft:s.WindowSizeStore.getSafePaddingLeftCSS(i),safePaddingRight:s.WindowSizeStore.getSafePaddingRightCSS(r)})),[s.WindowSizeStore,i,r]),g=(0,c.VK)((()=>Boolean((0,zu.RR)(Hu.default.state))),[]),S=(0,c.VK)((()=>t.getContentStore()),[t]),f=(0,c.VK)((()=>(0,Bu.ww)(s.device)),[s.device]),v=a?e=>Nu.og(e,t,s):void 0;function y(e,t){return(0,kt.jsxs)("div",{style:e,ref:e=>{e&&n(e)},className:re.QS0,onClick:t,children:[!u&&(0,kt.jsx)(Wu.Z,{store:S,emptyDroppableStyle:{width:"100%"},disabled:p||o}),d&&(0,kt.jsx)(no.Z,{})]})}const C=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{device:t}=s,o=l.pageFont||Bu.em,i=Bu.sL[o],r={},n={};let c;if(t.isMobile)c=t.isAndroid?Bu.pE:Bu.tb;else{c=l.pageSmallText?Bu.Pc[o]||Bu.ZY:Bu.TE[o]||Bu.jo}let d={},u={},p={};d={gridTemplateColumns:`${h} calc(100% - ${h} - ${m}) ${m}`},u=g?{paddingBottom:"600px"}:a?{paddingBottom:"15vh"}:{paddingBottom:0},p={...u,paddingLeft:e?0:h,paddingRight:e?0:m};const S=Bu.VN[o],f=Bu.n5[o]||1.5,v={flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...d},y={display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:i,fontSize:c,letterSpacing:S?`${S}em`:void 0,lineHeight:f,zIndex:T.ke,...u},C={flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:i,fontSize:c,letterSpacing:S?`${S}em`:void 0,lineHeight:f,width:"100%",zIndex:T.ke,...p};return{wrapper:v,leftPadding:r,body:y,rightPadding:n,nonIOSLayoutBody:C}}();return f?(0,kt.jsxs)("div",{style:C.wrapper,children:[C.leftPadding&&(0,kt.jsx)(Ir.p,{allowSelectionWithin:!1,style:C.leftPadding,onClick:v}),y(C.body,v),C.rightPadding&&(0,kt.jsx)(Ir.p,{allowSelectionWithin:!1,style:C.rightPadding,onClick:v})]}):y(C.nonIOSLayoutBody,v)}function Uu(e){window.__c={n:"WikiHomeView"};const{store:t,style:o,canEdit:i,padding:n}=e,s=(0,et.O7)(),l=(0,r.useRef)(null),a=(0,c.VK)((()=>t.isLocked()),[t]),d=(0,c.VK)((()=>Y.fg(s,t)),[t,s]),u=(0,Gu.Bt)();let p=(0,kt.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5,paddingBottom:u},children:[(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{width:(0,fe.du)(t,Eu.S.CollectionPageView,s)},render:()=>(0,kt.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:(0,kt.jsx)(Ku,{...e,...n,setRef:e=>{(0,Au.k$)(l,e)}})})}),!s.device.isMobile&&(0,kt.jsx)(Zu.Z,{pageBlockStore:t,isVisible:d,context:Eu.S.CollectionPageView,pageViewBlockAccessor:()=>l.current})]});return(0,Lu.Aw)(s)&&(p=(0,kt.jsx)(Ou.O,{displayName:"PageContent",style:{...o},disabled:!i||a,children:p})),p}class qu extends d.default{getInitialState(){return{stage:"NOT_TRACKING"}}}function $u(e){window.__c={n:"SetupInitialDatabaseItemsVisibleTracker"};const{collectionContextStore:t,parentMountTime:o}=e,{handleInitialDatabaseRender:i,handleItemMount:n}=function(e,t){const o=(0,et.O7)(),i=(0,c.qz)(void 0,qu),n=(0,r.useRef)(0),s=(0,r.useRef)(t),a=(0,r.useCallback)((()=>{"NOT_TRACKING"===i.state.stage&&i.setState({stage:"COUNTING_VISIBLE_ITEMS"})}),[i]),d=(0,r.useCallback)((()=>{if("COUNTING_VISIBLE_ITEMS"===i.state.stage&&(n.current++,1===n.current)){const e=performance.now();l.default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===i.state.stage&&i.setState({stage:"SHOULD_TRACK",endTime:e})}))}}),[i]),u=(0,r.useCallback)((t=>{if("SHOULD_TRACK"===t.state.stage){const i=le.Pp({collectionContextStore:e,visibleItemsCount:n.current||0});xe.default.measureFromAppStart({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:o,data:i}),s.current&&xe.default.measure({metricName:"collections.initial_mount_to_items_visible",startTime:s.current,endTime:t.state.endTime},{environment:o,data:i}),t.reset(),n.current=0}}),[e,o]);return(0,r.useEffect)((()=>(i.addListener(u),()=>{i.removeListener(u)})),[u,i]),{handleInitialDatabaseRender:a,handleItemMount:d}}(t,o);return t.initialDatabaseItemsVisibleTracker||(t.initialDatabaseItemsVisibleTracker={handleInitialDatabaseRender:i,handleItemMount:n}),null}const Yu=["table","board"],Qu=["timeline"],Xu=180,Ju=(0,V.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"},openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},openFullscreenPageButtonTooltip:{defaultMessage:"Open as full page",id:"database.collectionViewBlock.openFullscreenPageButton.tooltip"}});class ep{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let i=!0;this.didEmit||(this.didEmit=!0,i=!1),this.lastValue===t?i=!1:this.lastValue=t,i&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=Ce.Z.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&Ce.Z.removeListener(this.listener,this.environment)}}class tp extends ee.Z{constructor(){super(...arguments),this.isCollectionViewBlock=!0,this.collectionContextStore=new Ve.Z(this.environment),this.headerSizeObserver=new Ne.E,this.headerEl=null,this.horizontalScrollerEl=null,this.resizeObserver=void 0,this.timelineViewRef=r.createRef(),this.automationsViewRef=r.createRef(),this.parentNode=void 0,this.renderStartTime=void 0,this.subscriptions=new Map,this.collectionTypeChangeSubscription=void 0,this.collectionRefetcher=new xr(this.collectionContextStore,this.environment),this.syncStateTimeout=void 0,this.switchViewMetric=void 0,this.storeTypes={collectionContextStore:Ve.Z,mouseStore:oe.Z,headerMouseStore:oe.Z,focusStore:d.default.createClass(!1),noDateResultStore:d.default.createClass(void 0),tasksResultStore:d.default.createClass(void 0),templateButtonPopupStore:Re.Z,filterBarSettingsStore:d.default.createClass({open:!1,stack:[]}),createFilterButtonPopupStore:Re.Z,createFilterSettingsStore:d.default.createClass({open:!1,stack:[]}),filterBarCreateFilterSettingsStore:d.default.createClass({open:!1,stack:[]}),createSortSettingsStore:d.default.createClass({open:!1,stack:[]}),viewSettingsPlacementStore:d.default.createClass(void 0),saveControlMoreActionsButtonPopupStore:Re.Z},this.renderCreateFilterPopup=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores;return(0,kt.jsx)(zr.P,{context:ae.HV.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderCreateSortPopup=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;return(0,kt.jsx)(zr.P,{context:ae.HV.TopbarSortPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderViewSettings=()=>{const e=this.isInPeekRenderer(),t=(0,ue.Ks)(this.props.store)?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state;if(t)return(0,kt.jsx)(Ad,{collectionContextStore:this.collectionContextStore,headerSizeObserver:this.headerSizeObserver,placementStore:this.stores.viewSettingsPlacementStore,isInPeekRenderer:e,overridePlacement:this.isHomeWidget.state?"popup":void 0,...t})},this.renderTemplatesPopup=()=>{const{collectionContextStore:e}=this,{store:t}=this.props,o=e.collectionStore();if(o){if(je.Z.state.online){const i=e.permissionScopes.state;return(0,kt.jsx)(Qr.Z,{isOverlay:!0,collectionStore:o,canConfigureCollection:i.canConfigureCollection,onEmptyPageClick:this.handleTemplateEmptyPageClick,onEmptyEnter:this.handleTemplateEmptyPageClick,onTemplateClick:this.handleTemplateClick,onCancelClick:this.handleTemplateCancelClick,locked:t.isLocked()})}return(0,kt.jsx)("div",{style:{fontSize:14,color:this.theme.mediumTextColor,width:280,padding:8},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}},this.renderNoDatePopup=e=>{const{collectionContextStore:t}=this,o=this.noDateTotal.state,i=t.collectionStore(),r=t.collectionViewStore(),n=this.getNoDateProperty();if(!i||!r||!n)return;const s=r.getType(),l=r.getName();return!r.isDefined()||"timeline"!==s&&"calendar"!==s?void 0:(0,kt.jsx)(dr,{collectionStore:i,collectionViewId:r.id,property:n,onClose:e.close,onAddPage:this.handleNoDateAddPage,collectionViewType:s,collectionViewName:l,collectionContextStore:t,noDateTotal:o})},this.handleRelativeVariableStaleStoreChange=async e=>{if(e.state){const e=this.collectionContextStore,t=e.collectionViewBlockStore(),o=e.collectionViewStore(),i=e.collectionStore();if(!t||!o||!i)return;await Z.dj(this.environment,e,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}},this.handleViewAutomationSettingsClick=e=>{(0,me.ZP)({event:e,context:me.Af.CollectionAutomationSettingsClick,callback:this.handleViewAutomationSettingsClickInner})},this.handleViewAutomationSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,i=(0,Me.n)(t);o&&"automationSettings"===(null==i?void 0:i.type)?D.E3({collectionSettingsStore:t}):(D.r$({collectionContextStore:e,collectionSettingsStore:t}),D.wl({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}))},this.handleViewClick=e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:i}=e;if(t.id!==o.id&&!i){const e=t.getType(),i=o.getType();var r;if(e&&i)this.switchViewMetric={from:e,to:i,metric:xe.default.mark("collections.switch_view_lag"),sizeHintAtStart:null===(r=this.collectionContextStore.remoteResult.state)||void 0===r?void 0:r.sizeHint}}},this.handleFilterClick=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores,o=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0,i=e.currentPropertyFiltersStore.state,r=e.filtersBarOpenStore.state;r||i.length>0||o?e.filtersBarOpen.setState(!r):D.wl({collectionSettingsStore:t,item:{type:"createFilter"}}),j.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_filter"})},this.handleSortClick=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;this.hasSort.state?(e.filtersBarOpen.setState(!0),D.wl({collectionSettingsStore:e.filterBarSortSettingsStore,item:{type:"sort"}})):D.wl({collectionSettingsStore:t,item:{type:"createSort"}}),j.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_sort"})},this.handleCreateFilterPopupDismiss=()=>{const{createFilterSettingsStore:e}=this.stores;D.E3({collectionSettingsStore:e})},this.handleCreateSortPopupDismiss=()=>{const{createSortSettingsStore:e}=this.stores;D.E3({collectionSettingsStore:e})},this.handleCollectionEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!1})},this.handleCollectionTypeChangeEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!0})},this.handlePageVisibilityChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("page_show")},this.handlePeekViewChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("exit_peek")},this.shouldQueueCollectionEmit=()=>{var e;return!Ae.Z.state.isVisible||!(!Le.default.isCenterPeekOpen()||null!==(e=Le.default.peekTarget.state)&&void 0!==e&&e.uiContains(this.props.store))},this.shouldRefetch=()=>{if(!Le.default.isCenterPeekOpen()&&Ae.Z.state.isVisible)return!0},this.handleHeaderMount=e=>{e&&this.headerSizeObserver.observe(e),this.headerEl=e},this.handleHorizontalScrollerMount=e=>{var t,o;var i;(null==e||null===(t=e.scrollerEl())||void 0===t?void 0:t.classList.contains(re.PBs))?this.horizontalScrollerEl=e:this.horizontalScrollerEl=(null==e||null===(i=e.context.scrollerContext)||void 0===i?void 0:i.horizontalScroller)||null;const r=this.collectionContextStore.collectionViewStore();this.resetFrozoneStore(r);const n=null===(o=this.horizontalScrollerEl)||void 0===o?void 0:o.scrollerEl();"undefined"!=typeof ResizeObserver&&n&&(this.resizeObserver=new ResizeObserver(this.handleHorizontalScrollerResizeDebounced),this.resizeObserver.observe(n))},this.handleHorizontalScrollerResize=()=>{var e,t;const o=null===(e=this.horizontalScrollerEl)||void 0===e||null===(e=e.scrollerEl())||void 0===e?void 0:e.getBoundingClientRect().width,i=this.collectionContextStore.frozoneStore.state.scrollerWidth,r=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.getBoundingClientRect().left,n=this.collectionContextStore.frozoneStore.state.scrollerLeftOffset;if(o===i&&r===n)return;const s=this.collectionContextStore.collectionViewStore(),l=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,scrollerWidth:o,scrollerLeftOffset:r,frozenIndex:null==s?void 0:s.getTableFrozenColumnIndex(o,l),tryShowHiddenFrozenColumn:!1})},this.handleHorizontalScrollerResizeDebounced=x.Ds(this.handleHorizontalScrollerResize,50),this.handleEditorMouseDown=e=>{const{device:t}=this.environment,o=this.getCurrentCollectionViewStore();if(!o||t.isMobile)return;const i=o.getType();i&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),O.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===i||"table"===i})}})},this.handleEditorClick=(e,t)=>{(0,me.ZP)({event:e,context:me.Af.EditorClick,callback:()=>{if(this.isInPeekRenderer()||E.E5(this.environment),"page"===t&&!Se.X9()){const{clientX:t,clientY:o,target:i}=e;l.default.afterNextFlush((()=>{U.createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:this.environment,perform:e=>{K.jh(this.environment,{x:t,y:o,target:i instanceof Element?i:void 0},e)}})}))}}})},this.handleScroll=e=>{var t,o;const i=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.scrollLeft,r=null===(o=this.leftRightPadding.state)||void 0===o?void 0:o.paddingLeft;if(void 0===i||void 0===r)return;const n=i>r;n!==this.collectionContextStore.frozoneStore.state.isScrolled&&(this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,isScrolled:n}),this.handleHorizontalScrollerResize())},this.handleFocusIn=e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,a.E)(t)&&this.stores.focusStore.setState(!0)},this.handleFocusOut=()=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=()=>{Be.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleHeaderMouseMove=()=>{Be.Z.state||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleLoadedStoreChange=()=>{if(!this.isLoadedStore.state||!this.componentIsMounted||this.collectionContextStore.wasCreatedThisSession.state||!this.isFullScreen())return;const e=this.environment.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const o=()=>{var e,o,i;return{...le.vS(this.collectionContextStore),is_push:(null===(e=t)||void 0===e?void 0:e.isPush)??!1,collectionViewType:null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType(),initial_route:this.environment.RouterStore.state.initialRoute.name,prefetchCache:null===(i=this.environment.prefetchCache)||void 0===i||null===(i=i.getPrefetchAnalytic("queryCollection"))||void 0===i?void 0:i.type,wasm_sqlite_initialized:_e.Z.state.metricData.state.wasm_sqlite_initialized}};var r;_e.Z.state.initialRenderCompleted?xe.default.measureAfterNextFlush("navigation_database_render",{environment:this.environment,getData:o}):(L.setInitialRenderCompleted(),xe.default.measureFromAppStartAfterNextFlush("initial_database_render",{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime&&xe.default.measureAfterNextFlush({metricName:"initial_database_render_from_component_mount",startTime:this.renderStartTime},{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime=void 0,null===(r=this.collectionContextStore.initialDatabaseItemsVisibleTracker)||void 0===r||r.handleInitialDatabaseRender(),i.vF.hackyOffsetParsesCorrectly()||M.Usb(this.environment))},this.handleSearchButtonClick=()=>{this.collectionContextStore.searchOpen.setState(!0),j.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_search"})},this.handleSearchQueryChange=e=>{Z.Ug({searchQuery:e.target.value,collectionContextStore:this.collectionContextStore,isFullScreen:Boolean(this.props.isFullScreen)}),M.ikP(this.environment,{view_type:this.getCurrentViewType()})},this.handleSearchBlur=()=>{this.collectionContextStore.searchQuery.state||this.handleClearSearch()},this.handleSearchKeyDown=e=>{27===e.keyCode&&this.handleClearSearch()},this.handleClearSearch=()=>{this.collectionContextStore.searchQuery.setState(""),this.collectionContextStore.searchOpen.setState(!1)},this.handleAddItemClick=e=>{var t;if(!this.collectionContextStore.collectionViewBlockStore()||!(0,ze.M_)(this.environment))return;const o=this.isHomeWidget.state,i=this.isMultiSourceView.state,r=this.isMyTasksPage.state,n=this.collectionContextStore.isCompactView.state,s=r?n?"home_tile_tasks":"home_tasks":"cvb_add_item",l=null===(t=this.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.getType();U.createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:this.environment,perform:t=>{Z.NZ({store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,transaction:t,shouldCoerce:!0,showMoveTo:i,peekModeOverride:o?"center_peek":void 0,from:s,useCrdt:(0,J.SL)(e,"table"===l?"collection_table_view":"collection_non_table_view")})}}),j.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_new_item"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplatesDropdownClick=()=>{j.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_templates_dropdown"})},this.handleTemplateClick=e=>{U.createAndCommit({userAction:"CollectionViewBlock.handleTemplateClick",environment:this.environment,perform:t=>{const o=Z.NZ({transaction:t,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template",useCrdt:e.useCrdt});o&&A.ob({title:"template",environment:this.environment,store:o,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"collection_view_block"})}}),this.projManagementTooltipTourAssignToSomeone(),this.stores.templateButtonPopupStore.reset()},this.handleTemplateEmptyPageClick=()=>{U.createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:this.environment,perform:e=>{Z.NZ({transaction:e,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template_empty_page",useCrdt:!1})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateCancelClick=()=>{this.stores.templateButtonPopupStore.reset()},this.handleSetSourceClick=()=>{const{collectionContextStore:e}=this,t=e.settingsStore;this.isPlaceholderExternalCollectionStore.state?D.NG({collectionSettingsStore:t}):(D.r$({collectionContextStore:e,collectionSettingsStore:t}),j.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_select_data_source"}))},this.handleNoDateAddPage=e=>{const{collectionContextStore:t}=this,o=this.getCollectionStore(),i=this.getCurrentCollectionViewStore(),r=this.timelineViewRef.current;if(!i||!o)return;if(!i.isDefined())return;const{performResult:n}=U.createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:this.environment,perform:n=>"calendar"===i.getType()?B.Fv({environment:this.environment,store:e,collectionStore:o,collectionContextStore:t,startDayOfWeek:ie.AK.state,results:this.getDefaultResults(),transaction:n}):r?r.addBlockToView({store:e,transaction:n}):void 0});n&&G.Z5({environment:this.environment,stores:[n]})},this.handleOpenAsPageClick=()=>{M.Jin(this.environment,{view_type:this.getCurrentViewType()})},this.handleNoDateButtonClick=()=>{j.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_no_date"})},this.initializeSyncStatePolling=async()=>{if(this.isSyncingStore.state){const e=this.getCollectionStore(),t=null==e?void 0:e.getFormat().uri,o=null==e?void 0:e.getFormat().bot_id,i=null==e?void 0:e.id;if(!t||!o||!i)return;await this.pollSyncState({uri:t,botId:o,collectionId:i})}},this.pollSyncState=async e=>{const t=await I.getExternalCollectionSyncState(this.environment,e);if("success"===t.type&&t.data.result){const o=t.data.result,i=this.collectionContextStore.numberChildrenReceived,r=this.collectionContextStore.numberChildrenUnfurled;i.setState(o.numberChildrenReceived),r.setState(o.numberChildrenUnfurled),r.state/i.state<1&&(this.syncStateTimeout=setTimeout((async()=>{await this.pollSyncState(e)}),1e4))}},this.resetCollectionSubscriptions=e=>{const t=Array.from(this.subscriptions.keys()),o=x.e5(t,e),i=x.e5(e,t);for(const n of o){var r;null===(r=this.subscriptions.get(n))||void 0===r||r.unsubscribe(),this.subscriptions.delete(n)}for(const n of i){const e=new ep(this.environment,(0,b.jY)(n),this.handleCollectionEmit);e.subscribe(),this.subscriptions.set(n,e)}},this.subscribeToTypeChanges=()=>{const e=this.collectionContextStore.contextType,t=this.collectionContextStore.databaseType;if("collectionTypedView"!==e||!t||this.collectionTypeChangeSubscription)return;const o=new ep(this.environment,(0,b.JY)({spaceId:this.props.store.getSpaceId(),databaseType:t}),this.handleCollectionTypeChangeEmit);o.subscribe(),this.collectionTypeChangeSubscription=o},this.isSyncingStore=this.createComputedStore((()=>{var e;const t=this.getCollectionStore(),o=null==t?void 0:t.isSyncedCollection(),i=!0===(null==t||null===(e=t.getFormat().sync_state)||void 0===e?void 0:e.syncing),r=this.environment.device.isMobile;return Boolean(o&&i&&!r)})),this.canShowPmIntroTooltipStore=this.createComputedStore((()=>{if(this.environment.device.isMobile)return!1;const e=Pe.default.state.currentUserSettingsStore,t=Pe.default.state.currentSpaceStore;if(!(0,$.jH)(e,t)&&(!t||t.getCreatedTime()<$.VL))return!1;if(!this.isTasksDB())return!1;if(this.props.store.pathIsDead())return!1;return!!this.collectionContextStore.permissionScopes.state.canEditContent&&(!!(0,$.Z0)()&&Pe.default.state.inAppCalloutStore.canShow("pm_intro_tooltip"))})),this.isMultiSourceView=this.createComputedStore((()=>"collectionTypedView"===this.collectionContextStore.contextType)),this.isHomeWidget=this.createComputedStore((()=>(0,ie.aT)(this.props.store.id,this.collectionContextStore.isInPeekRenderer.state))),this.isMyTasksPage=this.createComputedStore((()=>(0,ie.qG)(this.props.store.id))),this.isTasksEmpty=this.createComputedStore((()=>!!this.isMyTasksPage.state&&this.collectionContextStore.isEmptyStore.state)),this.isCompactView=this.createComputedStore((()=>this.collectionContextStore.isCompactView.state)),this.isTasksDB=()=>{const e=this.collectionContextStore.collectionViewBlockStore();return(null==e?void 0:e.getFormat().app_config_uri)===p.NB},this.shouldRestrictHeaderWidthForMarginComments=()=>this.isRootOrDirectChild()&&!(0,ue._5)(this.props.store)&&this.marginCommentsVisible.state,this.shouldRenderOptions=()=>void 0!==this.collectionContextStore.collectionStore()||"collectionTypedView"===this.collectionContextStore.contextType,this.shouldRestrictWidthForMarginComments=this.createComputedStore((()=>{const e=this.getCurrentCollectionViewStore(),t=null==e?void 0:e.getType();return this.shouldRestrictHeaderWidthForMarginComments()&&t&&(ue.bu.has(t)||"timeline"===t&&this.collectionContextStore.collectionStore()&&!(0,de.C1)({environment:this.environment,format:this.collectionContextStore.normalizedFormatStore.state,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild()}))})),this.isPlaceholderExternalCollectionStore=this.createComputedStore((()=>{const e=this.getCollectionStore();return!!e&&(0,m.OY)(e.getValue())})),this.getExternalIntegrationId=this.createComputedStore((()=>{const e=this.getCollectionStore();if(e)return e.getFormat().integration_id})),this.leftRightPadding=this.createComputedStore((()=>{var e;const{store:t,isFullScreen:o,overridePaddingLeft:i,overridePaddingRight:r,renderInLayoutEditorGrid:n}=this.props;if(n)return{paddingLeft:0,paddingRight:0};const s=(0,ue.Bs)({environment:this.environment,store:t,isFullScreen:o,sizeObserver:this.headerSizeObserver,viewType:null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getType()});s&&void 0!==i&&(s.paddingLeft=i),s&&void 0!==r&&(s.paddingRight=r);const l=this.shouldRestrictWidthForMarginComments.state;return s&&l&&(s.paddingRight+=(0,Y.gC)(this.environment,(0,ue.en)(t),this.isInFrameWhenSidePeekOpen.state)),s})),this.isLoadedStore=this.createComputedStore((()=>this.collectionContextStore.isLoaded.state)),this.leftRightMargin=this.createComputedStore((()=>{if(!this.isRootOrDirectChild()||!this.marginCommentsVisible.state||!(0,ue._5)(this.props.store)||this.props.store.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};const e=Y.QB/2;return{marginLeft:e,marginRight:-e}})),this.noDateTotal=this.createComputedStore((()=>{if(this.noDateReducerStore.state){const e=this.stores.noDateResultStore.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}return 0})),this.noDateReducerStore=this.createComputedStore((()=>{const e=this.getNoDateProperty();if(e){return{type:"aggregation",aggregation:{property:e,aggregator:"empty"}}}})),this.hasTasksReducerStore=this.createComputedStore((()=>{if(this.isMyTasksPage.state){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}})),this.hasAppliedFilter=this.createComputedStore((()=>(0,ne.RL)({collectionContextStore:this.collectionContextStore,applySubitemFilter:!1}).length>0)),this.hasSort=this.createComputedStore((()=>{const{collectionContextStore:e}=this;return e.currentSortsStore.state.length>0})),this.showHoverActionsStore=this.createComputedStore((()=>{const{device:e}=this.environment,{mouseStore:t,headerMouseStore:o,focusStore:i,createSortSettingsStore:r,createFilterSettingsStore:n,filterBarCreateFilterSettingsStore:s,saveControlMoreActionsButtonPopupStore:l}=this.stores,{collectionContextStore:a}=this,c=this.isFullScreen(),d=i.state,u=a.settingsStore.state.open,p=a.searchOpen.state,h=r.state.open,m=n.state.open,g=s.state.open,S=a.filterBarSortSettingsStore.state.open,f=Array.from(a.filterBarItemSettingsStoreMap.values()),v=l.state.open,y=f.some((e=>e.state.open));return Boolean(t.state.mouseEntered||o.state.mouseEntered||d||c||this.shouldShowProjManagementTooltipTour()||e.isMobile||u||y||h||m||g||p||v||S)})),this.showCompactDesktopHeaderStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.headerSizeObserver.rect.state;return!e.isMobile&&t.width&&t.width<400||this.isCompactView.state})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>(0,ue.Ks)(this.props.store))),this.isInPeek=this.createComputedStore((()=>(0,ue.en)(this.props.store)))}insertBlocks(e,t){const o=this.getCollectionStore();if(o)for(const i of e)_.mp({environment:this.environment,store:i,collectionStore:o,collectionContextStore:this.collectionContextStore,shouldCoerce:!0,groupsPointer:[],transaction:t});return[]}handleCreated(){G.ZH(this.environment),l.default.afterNextFlush((()=>{const{collectionContextStore:e}=this,t=e.collectionStore(),o=e.collectionViewBlockStore(),i=e.settingsStore;if(!o)return;const r=o.getCollectionViewSourceCollectionStore();if(this.isPlaceholderExternalCollectionStore.state)D.NG({collectionSettingsStore:i});else if(r)Z.W1({environment:this.environment,collectionContextStore:e});else if(t)D.r$({collectionContextStore:e,collectionSettingsStore:i}),(0,Hr.V)({collectionStore:t,collectionContextStore:e,collectionSettingsStore:i});else{const t=Fe.default.checkGate("typed_db_creation");D.r$({collectionContextStore:e,collectionSettingsStore:i}),t?D.wl({collectionSettingsStore:i,item:{type:"createTypedDB"}}):D.wl({collectionSettingsStore:i,item:{type:"createViewSource"}})}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.trackRenderTime({isFirstRender:!0}),this.collectionContextStore.isLoaded.addListener(this.handleLoadedStoreChange),this.handleLoadedStoreChange(),this.renderStartTime=performance.now()}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{store:t}=e,o=t.id,{collectionContextStore:i}=this,r=this.collectionContextStore.collectionViewStore(),n=this.collectionContextStore.collectionStore(),s=this.environment.currentUser.id,l=r?r.id:void 0,a=n?n.id:void 0,c=this.getViewStores().map((e=>e.id)),d=this.getDefaultCollectionViewStore(),u=C.Z.get({userId:s,key:Ve.Z.getLocalViewPreferenceKey(o)});let p;if(e.viewId&&c.indexOf(e.viewId)>=0?p=e.viewId:r&&c.indexOf(r.id)>=0?p=r.id:u&&c.indexOf(u)>=0?p=u:d&&c.indexOf(d.id)>=0&&(p=d.id),p){const e=Ee.Xr.createChildStore(t,{table:k.n,id:p}),r=e.getCollectionStore(),n=!r||r.isDefined();e.isDefined()&&n&&(p!==u&&C.Z.set({userId:s,key:Ve.Z.getLocalViewPreferenceKey(o),value:p}),(p!==l||r&&r.id!==a)&&Z.mc({environment:this.environment,collectionViewBlockStore:t,collectionViewStore:e,collectionStore:r,collectionContextStore:i,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild(),isInPeekRenderer:this.isInPeekRenderer()}),void 0===i.frozoneStore.state.frozenIndex&&this.resetFrozoneStore(e))}const h=i.collectionStore();if(h){h.getTemplatePageStores().map((e=>e.getValue()))}this.isSyncingStore.addListener(this.initializeSyncStatePolling),this.ensureStoreListeners()}UNSAFE_willUpdate(){this.trackRenderTime({isFirstRender:!1})}didMount(){var e,t;super.didMount(),Ae.Z.addListener(this.handlePageVisibilityChange),Le.default.addListener(this.handlePeekViewChange),this.collectionContextStore.relativeVariablesAreStale.addListener(this.handleRelativeVariableStaleStoreChange);const o=this.collectionContextStore.collectionViewStore(),i=this.collectionContextStore.collectionStore();if(o&&i){const e=o.getType();e&&F.es(this.environment,{collection_id:i.id,collection_view_id:o.id,collection_view_block_id:this.props.store.id,type:e,is_full_screen:this.isFullScreen(),is_peek:this.isInPeekRenderer(),peek_mode:Le.default.state.mode})}if(o&&"collectionTypedView"===this.collectionContextStore.contextType){const e=this.collectionContextStore.databaseType,t=o.getType();e&&t&&F.Wg(this.environment,{collection_view_id:o.id,collection_view_block_id:this.props.store.id,type:t,databaseType:e,is_my_tasks:(0,be.Ep)("myTasks")===this.props.store.id})}const r=this.collectionContextStore.sprintSettingsContextStore.state;W.Wu({environment:this.environment,sprintSettingsContext:r}),null===(e=(t=this.props).setCollectionContextStore)||void 0===e||e.call(t,this.collectionContextStore)}didMountOrUpdate(){var e,t;const o=this.getCollectionStore();o?this.resetCollectionSubscriptions([o.id]):this.resetCollectionSubscriptions(this.collectionContextStore.remoteCollectionIds.state);const i=this.collectionContextStore.frozoneStore.state.scrollerWidth,r=null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(i,this.collectionContextStore.normalizedFormatStore.state);var s;(void 0!==r&&this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,frozenIndex:r}),this.collectionContextStore.remoteCollectionIds.addListener((e=>this.resetCollectionSubscriptions(e.state))),this.subscribeToTypeChanges(),this.parentNode)||(this.parentNode=null===(s=n.findDOMNode(this))||void 0===s?void 0:s.parentElement,this.parentNode&&((0,pe.lj)(this.parentNode,"focusin",this.handleFocusIn),(0,pe.lj)(this.parentNode,"focusout",this.handleFocusOut),(0,pe.lj)(this.parentNode,"mousemove",this.handleMouseMove),(0,pe.lj)(this.parentNode,"mouseleave",this.handleMouseLeave)));const l=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.scrollerEl();l&&(0,pe.lj)(l,"scroll",this.handleScroll)}didUpdate(e){this.trackSwitchViewLag()}willUnmount(){var e,t;super.willUnmount();const{collectionContextStore:o}=this;Z.ob({collectionContextStore:o}),this.unsubscribeAll(),this.headerSizeObserver.destroy(),Ae.Z.removeListener(this.handlePageVisibilityChange),Le.default.removeListener(this.handlePeekViewChange),this.collectionContextStore.isLoaded.removeListener(this.handleLoadedStoreChange),this.collectionContextStore.relativeVariablesAreStale.removeListener(this.handleRelativeVariableStaleStoreChange),this.parentNode&&((0,pe.ZV)(this.parentNode,"focusin",this.handleFocusIn),(0,pe.ZV)(this.parentNode,"focusout",this.handleFocusOut),(0,pe.ZV)(this.parentNode,"mousemove",this.handleMouseMove),(0,pe.ZV)(this.parentNode,"mouseleave",this.handleMouseLeave));const i=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();i&&(0,pe.ZV)(i,"scroll",this.handleScroll),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.isSyncingStore.removeListener(this.initializeSyncStatePolling),clearTimeout(this.syncStateTimeout)}renderPersisted(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=this.getCollectionStore(),i=e.normalizedSchemaStore.state,r=e.normalizedQueryStore.state,n=e.normalizedFormatStore.state,s=this.isFullScreen();if(!(t&&i&&r&&n))return;const l=t.getType();if(!l)return;if(o&&!o.isDefined())return;if(this.isCollectionViewOfExternalCollectionWithoutExternalObjectId())return(0,kt.jsx)(Q.L1,{value:this.collectionContextStore,children:(0,kt.jsx)(Ir.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,onClick:this.handleEditorClick,ref:this.handleHeaderMount,children:(0,kt.jsx)(ao.Z,{store:this.props.store,shouldShowHoverMenu:!0,analyticsName:rp(l),shouldShowHalo:!this.isFullScreen(),canSelect:!this.isFullScreen(),children:(0,kt.jsx)(ju.Z,{store:this.props.store,style:{width:"auto"},disabled:!1})})})});const a=(0,we.$3)(this.environment)-fe.zL,c=this.isInFrameWhenSidePeekOpen.state&&!this.props.isFullScreen&&!(0,ue._5)(this.props.store)&&a>0&&!this.isHomeWidget.state,d=this.renderView(o,t,this.props.overrideViewType??l,i,r,n),u=this.isInPeek.state?ke.Z.X:(0,ie.p5)({environment:this.environment,isFullScreen:this.isFullScreen()}),p=this.props.renderInLayoutEditorGrid&&!Qu.includes(l)?d:(0,kt.jsx)(Mu.Z,{type:u,className:re.x9t,onMouseDown:this.handleEditorMouseDown,preventType:this.isInPeek.state||this.isHomeWidget.state?ke.Z.None:z.Q7(this.environment),onClick:e=>this.handleEditorClick(e,l),style:this.getScrollerStyle(l,n,c?a/2:void 0),ref:this.handleHorizontalScrollerMount,children:d}),h={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state},m=s?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{style:{position:"sticky",height:0,left:0,zIndex:T.Nm},children:this.renderViewSettings()}),(0,kt.jsx)(Ir.p,{allowSelectionWithin:!0,style:{...h,position:"relative"},children:p})]}):(0,kt.jsx)(Ir.p,{allowSelectionWithin:!0,style:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state,...c&&{marginLeft:-a/2}},children:(0,kt.jsxs)("div",{style:{position:"relative"},children:[p,this.renderViewSettings()]})});return this.props.renderInLayoutEditorGrid?(0,kt.jsxs)(Q.L1,{value:this.collectionContextStore,children:[(0,kt.jsx)(np,{}),(0,kt.jsxs)(Fu.cx,{children:[(0,kt.jsxs)(Fu.bU,{children:[this.renderMultiSelectToolbar(),this.renderHeader(l)]}),Yu.includes(l)?(0,kt.jsx)(Fu.i2,{children:m}):(0,kt.jsx)(Fu.bU,{children:m}),(0,kt.jsxs)(Fu.bU,{children:[this.renderBottomBorderForViewSettings(),(0,kt.jsx)($u,{collectionContextStore:this.collectionContextStore,parentMountTime:this.renderStartTime})]})]})]}):(0,kt.jsxs)(Q.L1,{value:this.collectionContextStore,children:[(0,kt.jsx)(np,{}),this.renderMultiSelectToolbar(),this.renderHeader(l),m,this.renderBottomBorderForViewSettings(),(0,kt.jsx)($u,{collectionContextStore:this.collectionContextStore,parentMountTime:this.renderStartTime})]})}renderHeader(e){var t,o;const{device:i}=this.environment,{store:r,disableHoverMenu:n}=this.props,s=this.isFullScreen(),l=this.noDateReducerStore.state,a=this.hasTasksReducerStore.state,c=this.showHoverActionsStore.state,d=this.showCompactDesktopHeaderStore.state,u=this.leftRightPadding.state,p=(null===(t=this.collectionContextStore.collectionViewBlockStore())||void 0===t?void 0:t.isCollectionViewPageWithContent())&&"page"===(null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType()),h=this.shouldShowProjManagementTooltipTour()?(0,kt.jsx)(br.Z,{store:r,origin:this.renderViewSettingsButton(),isFirstTooltip:!1,phase:"click_view_settings"}):this.renderViewSettingsButton();return(0,kt.jsxs)(Ir.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount,children:[u&&(0,kt.jsxs)(ao.Z,{store:r,shouldShowCopyLinkButton:r.isLocked(),shouldShowHoverMenu:!n&&this.canEdit()&&!s,analyticsName:rp(e),children:[i.isPhone?(0,kt.jsxs)("div",{style:this.getHeaderStyle(),children:[this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,kt.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.renderLoadingSpinner(),this.renderFullScreenButton(),h,this.renderAddItemButton()]})})]}):(0,kt.jsxs)("div",{style:this.getHeaderStyle(),children:[this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,kt.jsx)(Br.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,kt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[this.renderLoadingSpinner(),!d&&this.renderLockIndicator(),!d&&this.renderNoDateButton(),!d&&"page"!==e&&this.renderFilterButton(),!d&&"page"!==e&&this.renderSortButton(),this.renderAutomationSettingsButton(),!d&&"page"!==e&&this.renderSearch(),p&&this.renderPageViewSearch(),this.renderFullScreenButton(),h,this.renderAddItemButton()]})})]}),a&&(0,kt.jsx)(ut.Z,{id:"tasks_results",collectionContextStore:this.collectionContextStore,reducer:a,resultStore:this.stores.tasksResultStore}),l&&(0,kt.jsx)(ut.Z,{id:"no_date_count",collectionContextStore:this.collectionContextStore,reducer:l,resultStore:this.stores.noDateResultStore})]}),(0,kt.jsxs)("div",{style:this.getHeaderPositioningStyle(),children:[this.renderSource(),this.renderFilterBar()]})]})}renderLockIndicator(){const{device:e}=this.environment,{store:t}=this.props;if(!this.isFullScreen()&&!e.isPhone&&t.canEditCollection())return(0,kt.jsx)(Iu.Z,{store:t,isMobile:!1,isInlineCollection:!0,disableTooltip:!0,buttonStyle:{marginLeft:4,marginRight:4}})}renderViewTabBar(){return(0,kt.jsx)(bu,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,isPlaceholderExternalCollectionStore:this.isPlaceholderExternalCollectionStore,onViewClick:this.handleViewClick,disabled:this.props.hideHeader||this.isHomeWidget.state})}renderFullScreenButton(){const{store:e}=this.props;if(this.isFullScreen())return;const t=(0,he.ZP)({store:e,fullyQualified:!1,pageVisitSource:u.tY.Expand}),o=ge.default.formatMessage(Ju.openFullscreenPageButtonTooltip);return(0,kt.jsx)(bt.ZP,{renderTooltip:()=>o,render:e=>(0,kt.jsx)(Zt.Z,{ariaLabel:o,href:t,onClick:this.handleOpenAsPageClick,icon:v.Z,style:{...this.getTopbarIconButtonStyle(),...this.isHomeWidget.state?{position:"absolute",right:0,top:4}:{}},iconStyle:{fill:this.getTopbarIconButtonStyle().fill,width:16},...e})})}renderAutomationSettingsButton(){const{collectionContextStore:e,automationsViewRef:t}=this,o=this.getCurrentCollectionViewStore(),i=null==o?void 0:o.getType(),r=e.settingsStore,n=r.state.open,s=(0,Me.n)(r),l=(0,h.Cf)({tab:s}),a=e.aliveAutomationCount.state;if("page"===i||this.isPlaceholderExternalCollectionStore.state||!(0,ce.cB)(e))return;const c=a>0;return(0,kt.jsx)(bt.ZP,{renderTooltip:()=>ge.default.formatMessage(Ju.openAutomationsSettingsButtonTooltip),render:e=>(0,kt.jsx)(Zt.Z,{ariaLabel:ge.default.formatMessage(Ju.openAutomationsSettingsButtonAriaLabel),className:re.RIA,icon:g.K,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:14,fill:c?this.theme.icon.uiBluePrimary:this.theme.mediumTextColor},hovered:n&&l,onClick:this.handleViewAutomationSettingsClick,ref:t,...e})})}renderViewSettingsButton(){return this.isPlaceholderExternalCollectionStore.state?null:(0,kt.jsx)(ye.LazyCollectionViewSettingsButton,{collectionContextStore:this.collectionContextStore,style:this.getTopbarIconButtonStyle()})}renderFilterButton(){const{device:e}=this.environment,{createFilterSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return(0,kt.jsx)(Ct.ZP,{popupType:e.isMobile?gt.Z4.SlideUp:gt.Z4.Popup,open:t.state.open,origin:this.renderFilterButtonOrigin(),onDismiss:this.handleCreateFilterPopupDismiss,originGap:4,render:this.renderCreateFilterPopup})}renderFilterButtonOrigin(){const e=this.hasAppliedFilter.state;return(0,kt.jsx)(yt.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleFilterClick,children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"})})}renderSortButton(){const{device:e}=this.environment;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const{createSortSettingsStore:t}=this.stores;return(0,kt.jsx)(Ct.ZP,{popupType:e.isMobile?gt.Z4.SlideUp:gt.Z4.Popup,open:t.state.open,origin:this.renderSortButtonOrigin(),onDismiss:this.handleCreateSortPopupDismiss,originGap:4,render:this.renderCreateSortPopup})}renderSortButtonOrigin(){const e=this.hasSort.state;return(0,kt.jsx)(yt.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleSortClick,children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"})})}renderSearch(){const{collectionContextStore:e}=this;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const t=e.searchOpen.state,o=e.searchQuery.state;return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(Zt.Z,{icon:S.e,iconStyle:{width:14,height:void 0,fill:this.theme.mediumTextColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSearchButtonClick}),(0,kt.jsx)(Br.Z,{isVisible:t,animationStyle:{width:150,opacity:1},enterAnimationStyle:{width:0,opacity:0},exitAnimationStyle:{width:0,opacity:0},render:()=>(0,kt.jsx)(kn.Z,{capture:t,allowEsc:!0,render:e=>(0,kt.jsx)("div",{...e,children:(0,kt.jsx)("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"},children:(0,kt.jsx)(Vu.Z,{style:this.getSearchInputStyle(),format:Vu.B.Transparent,value:o,onChange:this.handleSearchQueryChange,placeholder:ge.default.formatMessage(Ju.searchInputPlaceholder),focusInitial:t,showClearButton:!0,onBlur:this.handleSearchBlur,onCancel:this.handleClearSearch,onClick:me.Wi,onClearButtonClick:this.handleClearSearch,onKeyDown:this.handleSearchKeyDown})})})})})]})}renderPageViewSearch(){var e;const t=this.getCurrentCollectionViewStore();if("page"!==(null==t?void 0:t.getType()))return null;const o=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return o?(0,kt.jsxs)(yt.Z,{style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:R.Z.fontWeight.medium,color:this.theme.mediumTextColor},onClick:()=>{H.Kf({environment:this.environment,analyticsFrom:"wiki-home-collection-view"}),Oe.ZP.updateFilters({ancestors:[o]})},children:[(0,S.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}renderAddItemButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore();if("page"===(null==t?void 0:t.getType())||this.isPlaceholderExternalCollectionStore.state||!e.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return null;const o=(0,ue.PI)(e),i={marginLeft:8,fontSize:14,height:28};if(this.isHomeWidget.state){const e=ge.default.getIntl().formatMessage({defaultMessage:"New task",id:"AssignedToMeHomePanel.addNewTask.tooltip"});return(0,kt.jsx)(bt.ZP,{textWrap:!1,renderTooltip:()=>e,placement:bt.ug.Top,render:t=>(0,kt.jsx)(io.Z,{...t,ariaLabel:e,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,height:24,width:24},mobileFeedback:!1,onClick:this.handleAddItemClick,children:(0,y.R)({width:14,height:14,fill:this.theme.mediumIconColor})})})}const r=e.collectionStoresStore.state,n=!r||0===r.length,s=this.isMultiSourceView.state,l=e=>(0,kt.jsx)(_u.Z,{title:o,color:"blue",onClick:this.handleAddItemClick,dropdownEvents:e,style:i,className:re.sqL,disabled:n,disableDropdown:s});return(0,kt.jsx)(gt.ZP,{popupType:this.environment.device.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,render:this.renderTemplatesPopup,originGap:4,onClick:this.handleTemplatesDropdownClick,renderOrigin:e=>this.shouldShowProjManagementTooltipTour()?(0,kt.jsx)(br.Z,{store:this.props.store,origin:l(e),isFirstTooltip:!0,phase:"create_a_task"}):l(e),buttonPopupStore:this.stores.templateButtonPopupStore})}renderNoDateButton(){const e=this.noDateTotal.state,{collectionContextStore:t}=this,o=t.permissionScopes.state;if(t.collectionStore()&&0!==e&&o.canEditContent)return(0,kt.jsx)(gt.ZP,{popupType:this.environment.device.isMobile?Ct.kQ.SlideUp:Ct.kQ.Popup,render:this.renderNoDatePopup,onClick:this.handleNoDateButtonClick,renderOrigin:t=>(0,kt.jsx)(yt.Z,{isGray:!0,style:this.getTopbarActionButtonStyle(!1),...t,children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:e}})})})}renderFilterBar(){const{collectionContextStore:e}=this,t=e.filtersBarOpenStore.state,o=e.shouldShowSource.state?8:12,i=this.getCurrentCollectionViewStore();if("page"!==(null==i?void 0:i.getType())&&!this.isCompactView.state){if(!t){if(!e.getCompleteSprintButtonContext.state)return;return(0,kt.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:this.environment.device.isPhone?12:8,paddingTop:o},children:[(0,kt.jsx)("div",{style:{flex:1}}),(0,kt.jsx)(Du.Z,{collectionContextStore:e})]})}return(0,kt.jsx)(Sd.Z,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,createFilterSettingsStore:this.stores.filterBarCreateFilterSettingsStore,saveControlMoreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}}renderSource(){if(!this.isPlaceholderExternalCollectionStore.state)return this.collectionContextStore.shouldShowSource.state?(0,kt.jsx)(nd,{store:this.props.store,collectionContextStore:this.collectionContextStore,isFullScreen:this.isFullScreen(),showHoverActionsStore:this.showHoverActionsStore,canEdit:this.canEdit()}):void 0}renderView(e,t,o,i,r,n){const{store:s}=this.props,{collectionContextStore:l}=this,a=!this.canEdit()||"collectionVirtualView"===l.contextType;"rendered"!==Pe.default.state.renderPhase&&Pe.default.setState({...Pe.default.state,renderPhase:"rendered"});const c=this.isFullScreen(),d=this.isInPeekRenderer(),u=this.getBlockPropertyValueOverlayStore(),p=this.isRootOrDirectChild();let h=this.leftRightPadding.state;if(h){if(!e&&this.collectionContextStore.hasSingleCollection())return this.renderNoSourcePlaceholder(o);if(this.isPlaceholderExternalCollectionStore.state)return this.renderNoSourceExternalCollectionPlaceholder(o);if(this.isTasksEmpty.state)return(0,kt.jsx)(Yr,{collectionContextStore:l,onAddTaskClick:this.handleAddItemClick,from:l.isCompactView.state?"home_tile_tasks":"home_tasks"});if("table"===o)return(0,kt.jsx)(Ia,{schema:i,format:n,query:r,store:s,collectionContextStore:l,showHoverActionsStore:this.showHoverActionsStore,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p,viewSettingsPlacementStore:this.stores.viewSettingsPlacementStore},t.id);if("board"===o)return(0,kt.jsx)(Ao,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id);if("page"===o){const e=t.getFormat().page_pointer;if(!e)return;const o=this.createComputedStore((()=>s.id===e.id?s:Ee.G.createChildStore(s,{table:e.table,id:e.id}))),i=(0,ie.ui)(this.environment),r=o.state;if(!r.isCollectionView())return;const n=this.canEdit();return(0,kt.jsx)(Uu,{canEdit:n,disabled:this.props.store.isLocked()||this.props.disabled,padding:{paddingBottom:Bu.ZP.paddingBottom(this.environment),paddingLeft:i,paddingRight:i},store:r,style:Bu.d$})}return"calendar"===o?(0,kt.jsx)(Hi,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id):"list"===o?(this.isInFrameWhenSidePeekOpen.state&&!this.isHomeWidget.state&&(h={...h,paddingRight:24}),(0,kt.jsx)(Xi.ZP,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id)):"gallery"===o?(0,kt.jsx)(Qi.ZP,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id):"timeline"===o?(0,kt.jsx)(Wc,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isRootChild:p,isInPeekRenderer:d,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,showHoverActionsStore:this.showHoverActionsStore,ref:this.timelineViewRef,...h},t.id):void 0}}renderNoSourcePlaceholder(e){const t=this.isFullScreen(),o=this.collectionContextStore.permissionScopes.state;return(0,kt.jsx)(Fo,{collectionContextStore:this.collectionContextStore,title:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:o.canConfigureBlock?(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"<button>Select a data source</button> to continue",id:"collectionViewBlock.setSourceButton.title",values:{button:e=>(0,kt.jsx)(jo,{onClick:this.handleSetSourceClick,children:e})}}):void 0,icon:(0,f.u)({height:48,fill:this.theme.lightIconColor,margin:"0 auto"}),style:{...this.leftRightPadding.state,paddingBottom:t?void 0:this.getPaddingBottom(e)}})}renderNoSourceExternalCollectionPlaceholder(e){var t;const o=this.isFullScreen(),i=this.collectionContextStore.permissionScopes.state,r=this.collectionContextStore.settingsStore.state.open,n={display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},s=this.getExternalIntegrationId.state,l=Ie.Z.integrations.state.find((e=>e.id===s)),a=!(this.environment.device.isMobileBrowser&&this.isPlaceholderExternalCollectionStore.state&&!this.isUserAuthenticated());if(l)return(0,kt.jsx)("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:o?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,kt.jsxs)("div",{style:{paddingRight:r?Mo.nJ:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,kt.jsx)(Ci.Z,{icon:null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.getIcon(),size:48,disabled:!0,isEmptyPage:!1}),(0,kt.jsx)("div",{style:{fontSize:17,fontWeight:R.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:l.name}})}),i.canConfigureBlock&&(0,kt.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:this.theme.lightTextColor},children:a&&(0,kt.jsx)(V.FormattedMessage,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:l.name,button:e=>(0,kt.jsx)(io.Z,{style:n,onClick:this.handleSetSourceClick,children:e})}})})]})})}renderLoadingSpinner(){const e=this.collectionContextStore.shouldShowSpinner.state;return(0,kt.jsx)(te.Z,{show:e,...ue.Mq,render:e=>e?(0,kt.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,kt.jsx)(no.Z,{style:{width:14,height:14}})}):void 0},"loading-spinner")}renderBottomBorderForViewSettings(){const{collectionContextStore:e}=this;if(e.settingsStore.state.open&&"sidebar"===this.stores.viewSettingsPlacementStore.state)return(0,kt.jsx)("div",{style:{...this.leftRightPadding.state,...this.leftRightMargin.state,borderTop:`1px solid ${this.theme.tableDividerColor}`,height:12}})}renderMultiSelectToolbar(){if((0,ue.fk)({environment:this.environment,collectionContextStore:this.collectionContextStore})){var e;const t=(null===(e=this.leftRightPadding.state)||void 0===e?void 0:e.paddingLeft)??0,o=this.leftRightMargin.state.marginLeft??0;return(0,kt.jsx)(Zr,{marginLeft:t+o})}}unsubscribeAll(){for(const e of this.subscriptions.values())e.unsubscribe();this.collectionTypeChangeSubscription&&this.collectionTypeChangeSubscription.unsubscribe()}resetFrozoneStore(e){var t,o;const i=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.stores.store.state.clientWidth,r=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({isScrolled:!1,scrollerWidth:i,scrollerLeftOffset:(null===(o=this.horizontalScrollerEl)||void 0===o||null===(o=o.stores.store.state.clientRect)||void 0===o?void 0:o.left)??0,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(i,r),tryShowHiddenFrozenColumn:!1})}isCollectionViewOfExternalCollectionWithoutExternalObjectId(){var e;const t=null===(e=this.getCollectionStore())||void 0===e?void 0:e.getValue();return Boolean(t&&(0,m.Ev)(t))}isUserAuthenticated(){const e=this.collectionContextStore.collectionStore();if(!e)return!1;const t=e.getFormat().integration_id,o=Ie.Z.integrations.state.find((e=>e.id===t));return!(!t||!o)&&(0,se.NP)(t).length>0}getViewStores(){const{store:e}=this.props;return e.getCollectionViewStores()}getCurrentCollectionViewStore(){return this.collectionContextStore.collectionViewStore()}getDefaultCollectionViewStore(){var e;const t=this.getViewStores();if(null!==(e=t[0])&&void 0!==e&&e.isDefined())return t[0]}getCollectionStore(){return this.collectionContextStore.collectionStore()}getMinWidth(){const{store:e}=this.props,{device:t}=this.environment,o=t.isPhone,i=this.isFullScreen(),r=this.getCurrentViewType(),n=("gallery"===r||("calendar"===r||"list"===r)&&i)&&this.isInFrameWhenSidePeekOpen.state,s=(0,we.ll)(this.environment,this.isInPeekRenderer()),l=Le.default.state;return this.isHomeWidget.state?void 0:i||this.isRootOrDirectChild()?o?`calc(100% - ${2*(0,ie.ui)(this.environment)}px - ${s}px)`:this.isInPeekRenderer()?`calc(100% - ${2*Le.PeekModePadding.horizontal[l.mode]}px - ${s}px)`:this.isInFrameWhenSidePeekOpen.state?(0,we.$3)(this.environment)+(n?(0,we.vJ)(this.environment):0):i?`calc(100% - ${2*(0,ie.CP)(this.environment)}px - ${s}px)`:(0,ue._5)(e)?`calc(100% - ${2*(0,ie.ui)(this.environment)}px - ${s}px)`:fe.zL-2*(0,ie.ui)(this.environment)-s:`calc(100% - ${s}px)`}isInPeekRenderer(){return(0,ue.en)(this.props.store)}getBlockPropertyValueOverlayStore(){return this.isInPeekRenderer()?Ze.Z:De.Z}resetLeftScrollAfterFlush(){l.default.afterNextFlush((()=>{var e;const t=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();if(t){t.scrollLeft=0;const e=ve.xH(t);e&&(e.scrollLeft=0)}}))}isFullScreen(){return Boolean(this.props.isFullScreen)}getDefaultResults(){const e=this.collectionContextStore.localResultStore.state,t=this.getCollectionStore();if(t&&e&&"reducer"===e.type){const o=x.sE(e.reducerResults,(e=>"results"===e.type));if(o)return o.blockIds.map((e=>Ee.G.createChildStore(t,{id:e,table:w.iU})))}return[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}getCurrentViewType(){var e;const{collectionContextStore:t}=this,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getNoDateProperty(){const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.normalizedQueryStore.state;if(!e||!t)return;const o=e.getType();return"timeline"===o&&t.timeline_by?t.timeline_by:"calendar"===o&&t.calendar_by?t.calendar_by:void 0}ensureStoreListeners(){const{collectionContextStore:e}=this,{store:t}=this.props;e.blockIsPrivateStore.state;for(const o of t.getCollectionViewStores())o.getValue()}getScrollerStyle(e,t,o){const{store:i}=this.props,r=this.isFullScreen(),n=this.isRootOrDirectChild(),s=this.leftRightPadding.state,l=this.getPaddingBottom(e),a=this.collectionContextStore.settingsStore.state.open;return{flexGrow:1,flexShrink:0,...i.isLocked()&&{cursor:"default"},..."timeline"===e&&this.collectionContextStore.collectionStore()&&!r&&!(0,de.fj)({environment:this.environment,isFullScreen:r,isRootChild:n,format:t})&&s&&{marginLeft:s.paddingLeft,marginRight:s.paddingRight,marginBottom:l},...a&&!r&&"sidebar"===this.stores.viewSettingsPlacementStore.state&&{minHeight:Mo.j9},...this.isInFrameWhenSidePeekOpen.state&&"timeline"!==e&&!this.isHomeWidget.state?{position:"sticky",left:0,paddingLeft:void 0===this.collectionContextStore.frozoneStore.state.frozenIndex?0:o,width:(0,we.$3)(this.environment)}:{},..."page"===e?{zIndex:T.y}:{}}}getPaddingBottom(e){return this.props.isFullScreen?"timeline"===e?96:Xu:"timeline"===e||"gallery"===e?0:Te.Z.state}getHeaderWrapStyle(){const{hideHeader:e}=this.props,t=this.leftRightPadding.state,o=(0,we.$3)(this.environment),i=(0,ue._5)(this.props.store)||this.isFullScreen()?o:Math.min(fe.zL,o),r=this.isInFrameWhenSidePeekOpen.state&&!Le.default.isSidePeekOpening.state;return{minHeight:40,paddingLeft:null==t?void 0:t.paddingLeft,paddingRight:r?0:null==t?void 0:t.paddingRight,flexShrink:0,...(this.isFullScreen()||r)&&{position:"sticky",zIndex:86,left:0,width:r&&t?i-(t.paddingLeft/2??0):void 0},...this.props.store.isLocked()&&{cursor:"default"},...this.leftRightMargin.state,...e?{opacity:0,height:0,minHeight:void 0,pointerEvents:"none"}:{},...this.isHomeWidget.state?{position:"sticky",top:0,background:this.theme.home.tile.background,boxShadow:`0 2px 5px 0 ${this.theme.home.tile.background}`,zIndex:99}:{}}}getHeaderStyle(){const{collectionContextStore:e}=this,t=this.getCurrentViewType(),o=e.viewIsFlushToTopbar();return{display:"flex",alignItems:"center",height:40,boxShadow:("timeline"===t||"table"===t)&&o||this.isCompactView.state?void 0:`inset 0 -1px 0 ${this.theme.tableDividerColor}`,...this.getHeaderPositioningStyle()}}getHeaderPositioningStyle(){const e=this.leftRightPadding.state;return{left:null==e?void 0:e.paddingLeft,width:"100%"}}getSearchInputStyle(){return{fontSize:14,lineHeight:1,paddingRight:4,color:this.theme.regularTextColor,marginBottom:1}}getTopbarActionButtonStyle(e){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:e?this.theme.blueColor:this.theme.mediumTextColor,fontWeight:R.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}getTopbarIconButtonStyle(){return{display:"flex",alignItems:"center",fontSize:14,padding:6,...this.isHomeWidget.state?{height:24,width:24,color:this.theme.lightTextColor,fill:this.theme.lightIconColor}:{height:28,width:28,color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},fontWeight:R.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}shouldShowProjManagementTooltipTour(){return this.canShowPmIntroTooltipStore.state}projManagementTooltipTourAssignToSomeone(){const e=Pe.default.state.currentUserSettingsStore,t=Pe.default.state.currentSpaceStore;e&&t&&q.uR({environment:this.environment,requiredCurrPhase:"create_a_task",nextPhase:"assign_to_someone",currentUserSettingsStore:e,currentSpaceStore:t})}trackRenderTime(e){let{isFirstRender:t}=e;const o=xe.default.mark("collections.collection_view_block_render");xe.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>({...le.vS(this.collectionContextStore),is_first_render:t})})}trackSwitchViewLag(){if(!this.switchViewMetric)return;const{from:e,to:t,metric:o,sizeHintAtStart:i}=this.switchViewMetric;xe.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>{const o=le.vS(this.collectionContextStore),{view_type:r,row_count_category:n,...s}=o;return{from:e,to:t,did_trigger_fetch:this.collectionContextStore.isLoading.state,row_count_category:le.ZO(i),...s}}}),this.switchViewMetric=void 0}}tp.displayName="CollectionViewBlock",tp.contextTypes={...X.wK,...s.w};class op extends s.Z{componentDidCatch(e){throw P.vd("collections"),e}renderComponent(){return(0,kt.jsx)(tp,{...this.props})}}const ip=tp;function rp(e){return"page"===e?"page_view":e}function np(){window.__c={n:"KeyboardArea"};return(0,c.VK)((()=>Fe.default.checkGate("collection_subitem_nested_operations")),[])?(0,kt.jsx)(Md,{}):null}},44514:(e,t,o)=>{o.d(t,{Q:()=>a});o(67294);var i=o(82990),r=o(52821),n=o(85893);const s={...i.Z.textOverflowStyle,position:"absolute",left:0,right:0,top:0,bottom:0},l={marginLeft:4,fontWeight:i.Z.fontWeight.semibold};function a(e){const{prefix:t,viewName:o,viewType:i}=e;return(0,n.jsxs)("div",{style:{position:"relative",width:"100%"},children:[" ",(0,n.jsxs)("div",{style:s,children:[t,i&&r.aW[i]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),(0,n.jsx)("span",{style:l,children:o})]})]})}},22789:(e,t,o)=>{o.d(t,{Z:()=>k});o(67294);var i=o(83355),r=o(86628),n=o(24405),s=o(16184),l=o(47020),a=o(3123),c=o(58687),d=o(19889),u=o(7928),p=o(9291),h=o(50906),m=o(96802),g=o(82530),S=o(34700),f=o(92547),v=o(26136),y=o(64921),C=o(26388),x=o(85893);const b={width:16,marginRight:4};class w extends i.Z{constructor(){super(...arguments),this.storeTypes={lockStore:f.Z},this.handleLockClick=()=>{const{store:e}=this.props;g.createAndCommit({userAction:"PageLockTopbarIndicator.handleLockClick",environment:this.environment,perform:t=>{m.Wq({environment:this.environment,store:e,isLocked:!1,transaction:t})}}),this.stores.lockStore.setState({...this.stores.lockStore.state,justUnlocked:!0});const t=this.props.store.getType();if(t){var o;let i;e.isCollectionView()&&(i=e.getCollectionViewCollectionStore()),h.UJr(this.environment,{from:"topbar",block_type:t,locked:!1,collection_id:null===(o=i)||void 0===o?void 0:o.id})}},this.handleUnlockClick=()=>{const{store:e}=this.props;g.createAndCommit({userAction:"PageLockTopbarIndicator.handleUnlockClick",environment:this.environment,perform:t=>{m.Wq({environment:this.environment,store:e,isLocked:!0,transaction:t})}}),this.stores.lockStore.setState({...this.stores.lockStore.state,justUnlocked:!1});const t=this.props.store.getType();if(t){var o;let i;e.isCollectionView()&&(i=e.getCollectionViewCollectionStore()),h.UJr(this.environment,{from:"topbar",block_type:t,locked:!0,collection_id:null===(o=i)||void 0===o?void 0:o.id})}}}renderComponent(){return this.props.isMobile?this.renderMobile():this.renderDesktop()}renderDesktop(){return this.props.store.isLocked()?(0,x.jsx)(C.ZP,{renderTooltip:()=>(0,x.jsx)(R,{store:this.props.store}),disableTooltip:this.props.disableTooltip,render:e=>{return(0,x.jsxs)(y.Z,{style:(t=this.props.isMobile,o=this.environment,i=this.theme,r=this.props.isInlineCollection,n=this.props.buttonStyle,{...P(t,r,n),...(0,S.X)({noDrag:o.device.isElectronMac}),color:i.lightTextColor,fill:i.lightIconColor}),onClick:this.handleLockClick,...e,children:[(0,s.Q)(b),(0,x.jsx)("div",{style:{lineHeight:1},children:(0,x.jsx)(p.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]});var t,o,i,r,n}}):this.stores.lockStore.state.justUnlocked?(0,x.jsxs)(y.Z,{style:(e=this.props.isMobile,t=this.environment,o=this.theme,i=this.props.isInlineCollection,r=this.props.buttonStyle,{...P(e,i,r),...(0,S.X)({noDrag:t.device.isElectronMac}),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}),onClick:this.handleUnlockClick,hoveredStyle:{background:this.theme.outlineBlueButtonHoveredBackground},pressedStyle:{background:this.theme.outlineBlueButtonPressedBackground},children:[(0,c.H)(b),(0,x.jsx)("div",{style:{lineHeight:1},children:(0,x.jsx)(p.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]}):void 0;var e,t,o,i,r}renderMobile(){const{WindowSizeStore:e}=this.environment;return this.props.store.isLocked()?(0,x.jsxs)(y.Z,{onClick:this.handleLockClick,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:e.getSafePaddingLeftCSS(10),paddingRight:e.getSafePaddingRightCSS(14)},children:[(0,l.B)({width:20,marginRight:6}),(0,x.jsx)("div",{children:(0,x.jsx)(p.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}):this.stores.lockStore.state.justUnlocked?(0,x.jsxs)(y.Z,{onClick:this.handleUnlockClick,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:e.getSafePaddingLeftCSS(10),paddingRight:e.getSafePaddingRightCSS(14),color:this.theme.blueColor,fill:this.theme.blueColor},children:[(0,a.j)({height:26,width:32,marginRight:6}),(0,x.jsx)("div",{children:(0,x.jsx)(p.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):void 0}}w.displayName="PageLockTopbarIndicator";const k=w;function P(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function R(e){let{store:t}=e;window.__c={n:"TooltipComponent"};const o=(0,n.Fg)(),i=(0,r.VK)((()=>t.getFormat().block_locked_by),[t]),s=(0,p.useIntl)(),l=(0,r.VK)((()=>i&&(0,u.Nz)(s,v.t1.createChildStore(t,{table:d.KJ,id:i}).getModel())),[i,s,t]);return i?(0,x.jsx)("div",{children:(0,x.jsx)(p.FormattedMessage,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,x.jsx)("b",{children:l}),br:(0,x.jsx)("br",{}),prompttext:e=>(0,x.jsx)("span",{style:{color:o.mediumInvertedTextColor},children:e})}})}):null}},71424:(e,t,o)=>{o.d(t,{EZ:()=>r,FD:()=>n,G5:()=>i,rK:()=>s});const i=220,r=24,n=-7,s=-3},34700:(e,t,o)=>{function i(e){return"drag"in e&&e.drag?{WebkitAppRegion:"drag"}:"noDrag"in e&&e.noDrag?{WebkitAppRegion:"no-drag"}:{}}o.d(t,{X:()=>i})},84437:(e,t,o)=>{o.d(t,{WS:()=>v,fW:()=>g,sh:()=>m});var i=o(72126),r=o(4615),n=o(64002),s=o(50906),l=o(54642),a=o(47839),c=o(12714),d=o(82530),u=o(37181),p=o(95477),h=o(71574);function m(e){const{environment:t,spaceStore:o,collectionViewStore:i}=e;if(!!o&&!(0,h.tE)())return void async function(e){const{environment:t,spaceStore:o,collectionViewStore:i}=e,s=f({spaceStore:o,collectionViewStore:i}),l=(0,r.ZP)(),a=n.bf({url:p.default.cron.notionAuthUrl,query:{...s,csrf:l}});await(0,h.PQ)({environment:t,csrf:l}),c.D({environment:t,url:a})}(e);const s=i?p.default.cron.openNotionDatabaseUrl:p.default.cron.domainBaseUrl,l=f({collectionViewStore:i,spaceStore:o});!async function(e){const{environment:t,url:o,targetSelf:i}=e;if(!t.device.isElectron)return c.D({environment:t,url:o,targetSelf:i});const{desktopProtocol:r}=p.default.cron;if(!(await a.isProtocolRegistered(r)))return c.D({environment:t,url:o,targetSelf:i});const n=o.replace(/^https?:/,`${r}:`);a.openExternalUrl(n)}({environment:t,url:n.bf({url:s,query:l})})}async function g(e){const{environment:t,csrf:o,calendarCsrf:r,spaceId:n,integration:a,redirectUri:c,state:d}=e;if(!(await(0,h.Bs)({environment:t,csrf:o})))return void S({environment:t,redirectUri:c,query:i.GM({state:d},i.o8)});const u=await l.createOauthAuthorizationCode(t,{integrationId:a.id,spaceId:n,redirectUri:c,acceptedIntegrationCapabilities:a.capabilities});if("failed"===u.type)return void S({environment:t,redirectUri:c,query:i.GM({state:d},i.o8)});s.dld(t);const p={code:u.data.code,calendarCsrf:r,state:d};S({environment:t,redirectUri:c,query:i.GM(p,i.o8)})}function S(e){const{environment:t,redirectUri:o,query:i}=e,r=n.bf({url:o,query:i});c.D({environment:t,url:r,targetSelf:!0})}function f(e){const{spaceStore:t,collectionViewStore:o}=e;if(!t&&!o)return{};const r={env:"production",collection_view_id:null==o?void 0:o.id,workspace_id:null==t?void 0:t.id};return i.GM(r,i.o8)}function v(e,t){const{phase:o,transactionUserAction:i,userSettingsStore:r}=t;d.createAndCommit({environment:e,userAction:i,perform:e=>{u.d2({userSettingsStore:r,transaction:e,data:{notion_calendar_launch_modal_phase:o}})}})}},35599:(e,t,o)=>{o.d(t,{Z:()=>a});var i=o(67294),r=o(24405),n=o(86432),s=o(63143),l=o(77907);function a(e){window.__c={n:"CalendarDateIcon"};const t=(0,l.useDependency)(l.deps.calendarDateIcons),o=function(){const[e,t]=(0,i.useState)(new Date),o=(0,i.useRef)();return(0,i.useEffect)((()=>{const i=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},r=new Date,n=new Date(r);n.setHours(r.getHours()+1),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);const l=n.getTime()-r.getTime(),a=setTimeout((()=>{i(),o.current=window.setInterval(i,s.U6)}),l);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),a=e.dateNumber??o.getDate(),c=(0,r.yK)((t=>({icon:{width:16,height:16,color:t.mediumIconColor,...e.style}})),[e.style]);return(0,i.useCallback)((e=>{if(e<1||e>31)return(0,n.s)(c.icon);if("resolved"!==t.status)return(0,n.s)(c.icon);const o=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;return(0,t.value[o])(c.icon)}),[c,t])(a)}},71574:(e,t,o)=>{o.d(t,{Bs:()=>m,PQ:()=>h,ZH:()=>d,tE:()=>u});var i=o(77657),r=o(4615),n=o(95477),s=o(12955),l=o(53410),a=o(77080),c=o(30874);async function d(e){const{environment:t}=e;return!!a.default.checkGate("notion_calendar")&&(!t.device.isMobile&&(!t.device.isElectron||async function(){if(!u())return!1;if(null===l.C||void 0===l.C||!l.C.isProtocolRegistered)return!1;return await l.C.isProtocolRegistered(n.default.cron.desktopProtocol)}()))}function u(){const{bots:e,externalAuthentications:t}=c.Z,o=e.state.find((e=>e.integration_id===i.Dv));if(!o)return!1;const r=t.state.find((e=>e.parent_id===o.id));return Boolean(r)}const p="notion_calendar_csrf";async function h(e){const{environment:t,csrf:o}=e;await(0,s.setCookie)(t,{name:p,value:o})}async function m(e){const{environment:t,csrf:o}=e,i=await(0,s.getCookie)(t,p),n=!!i&&(0,r.t)(i)&&i===o;return(0,s.removeCookie)(p),n}},92547:(e,t,o)=>{o.d(t,{Z:()=>n});var i=o(49085);class r extends i.default{getInitialState(){return{justUnlocked:!1}}}const n=r},55061:(e,t,o)=>{o.d(t,{$2:()=>ie,Bg:()=>te,P6:()=>I,Qs:()=>D,W9:()=>X,Wy:()=>Y,XW:()=>B,_2:()=>U,_u:()=>Q,c_:()=>J,gt:()=>K,iR:()=>z,jQ:()=>oe,kU:()=>q,oP:()=>Z,pF:()=>ee,qJ:()=>F,rn:()=>O,sn:()=>L,v4:()=>$,xS:()=>_});o(57658);var i=o(9291),r=o(66897),n=o(41432),s=o(15070),l=o(35011),a=o(99036),c=o(80951),d=o(40506),u=o(7057),p=o(6695),h=o(38297),m=o(22808),g=o(72126),S=o(59753),f=o(86517),v=o(82883),y=o(21202),C=o(77420),x=o(6287),b=o(15047),w=o(29369),k=o(19889),P=o(99108),R=o(97880),T=o(7928),V=o(63143),M=o(70693),j=o(4308);const F=(0,i.defineMessages)({defaultPluralizedUserNames:{defaultMessage:"Someone",id:"pushNotification.pluralizedUserNames.defaultLabel"},defaultPermissionGroupName:{defaultMessage:"Deleted group",id:"pushNotification.permissionGroupName.defaultLabel"},defaultPageName:{defaultMessage:"a Notion page",id:"pushNotification.pageName.defaultLabel"},untitledPermissionGroupName:{defaultMessage:"Untitled group",id:"pushNotification.permissionGroupName.untitledLabel"},userEditedPermissionGroup:{defaultMessage:"{userName} edited {permissionGroupName}",id:"pushNotification.userEditedTarget.label"},userDeletedPermissionGroup:{defaultMessage:"{userName} deleted {permissionGroupName}",id:"pushNotification.userDeletedTarget.label"},userCreatedPermissionGroup:{defaultMessage:"{userName} created {permissionGroupName}",id:"pushNotification.userCreatedTarget.label"},unknownAuthor:{defaultMessage:"Unknown author",id:"pushNotification.authorPhrase.unknown"},untitledSpaceName:{defaultMessage:"Untitled",id:"pushNotification.untitledSpaceName.label"},untitledTeamName:{defaultMessage:"Untitled",id:"pushNotification.untitledTeamName.label"},untitledCollectionName:{defaultMessage:"Untitled",id:"pushNotification.untitledCollectionName.placeholder"},untitledBlockTitle:{defaultMessage:"Untitled",id:"pushNotification.untitledBlockTitle.placeholder"},twoUserNames:{defaultMessage:"{firstAuthor} and {secondAuthor}",id:"pushNotification.twoUserNames.label"},threePlusUserNames:{defaultMessage:"{othersCount, plural, one {{firstAuthor} and {othersCount} other} other {{firstAuthor} and {othersCount} others}}",id:"pushNotification.threePlusUserNames.label"},editorPermissionLabel:{defaultMessage:"Full access",id:"pushNotifications.editorPermissionLevel.label"},readerPermissionLabel:{defaultMessage:"Read only",id:"pushNotifications.readerPermissionLevel.label"},editOnlyPermissionLabel:{defaultMessage:"Edit only",id:"pushNotifications.editOnlyPermissionLevel.label"},editPermissionLabel:{defaultMessage:"Edit",id:"pushNotifications.editPermissionLevel.label"},commentOnlyPermissionLabel:{defaultMessage:"Comment only",id:"pushNotifications.commentOnlyPermissionLevel.label"},noAccessPermissionLabel:{defaultMessage:"No access",id:"pushNotifications.noAccessPermissionLevel.label"},publicPermissionRoleLabel:{defaultMessage:"Public ({permissionLevel})",id:"pushNotifications.publicPermissions.label"},userNameWithRole:{defaultMessage:"{userName} ({permissionLevel})",id:"pushNotifications.userPermissionsWithRole.label"},botNameWithRole:{defaultMessage:"{botName} ({permissionLevel})",id:"pushNotifications.botPermissionsWithRole.label"},spaceNameWithRole:{defaultMessage:"{spaceName} ({permissionLevel})",id:"pushNotifications.spacePermissionsWithRole.label"},imageInPushNotification:{defaultMessage:"{imageEmoji} Image",id:"pushNotification.imageInPushNotification.placeholder"},topLevelBlockCreated:{defaultMessage:"{userName} created {targetName} in {spaceName}",id:"pushNotification.userCreatedBlockInSpace.message"},topLevelBlockDeleted:{defaultMessage:"{userName} deleted {targetName} in {spaceName}",id:"pushNotification.userDeletedBlockInSpace.message"},collectionRowCreated:{defaultMessage:"{userName} created {targetName} in {collectionName}",id:"pushNotification.userCreatedRowInCollection.message"},collectionRowDeleted:{defaultMessage:"{userName} deleted {targetName} in {collectionName}",id:"pushNotification.userDeletedRowInCollection.message"},emptyBlockEditedProperty:{defaultMessage:"Empty",id:"pushNotification.emptyBlockPropertyValueEdited.placeholderLabel"},propertyNameAndValueEdited:{defaultMessage:"{propertyName} ({propertyValue})",id:"pushNotification.propertyNameWithEditedValue.notificationSubject"},propertyNameAndValueNotificationBody:{defaultMessage:"{propertyName} ({propertyValue})",id:"pushNotification.propertyNameWithEditedValue.notificationBody"},blockDeletedEditBody:{defaultMessage:"[Deleted] {renderedBlock}",id:"pushNotification.deletedBlock.notificationContents"},blockEditedNotification:{defaultMessage:"{userName} edited {blockName}",id:"pushNotification.blockEdited.notificationSubject"},blockPropertyEditedNotification:{defaultMessage:"{userName} edited {blockName}",id:"pushNotification.blockPropertyEdited.notificationSubject"},mobileBlockPropertyEditedNotification:{defaultMessage:"{userName} edited",id:"pushNotification.mobileBlockPropertyEdited.notificationSubject"},userEditedPermissionsFor:{defaultMessage:"{userName} edited permissions for {targetName}",id:"pushNotifications.permissionsEditedForPageOrSpace.notificationSubject"},userMentionedIn:{defaultMessage:"{userName} mentioned you in {targetName}",id:"pushNotifications.userMentionedInPage.notificationSubject"},mobileUserMentionedIn:{defaultMessage:"{userName} mentioned you",id:"pushNotifications.mobileUserMentionedInPage.notificationSubject"},permissionGroupMentionedIn:{defaultMessage:"{userName} mentioned {groupName} in {targetName}",id:"pushNotifications.groupMentionedInPage.notificationSubject"},userDeletedComment:{defaultMessage:"[Deleted]💬 {commentText}",id:"pushNotifications.userDeletedCommentText.notificationContents"},userCommentedSubject:{defaultMessage:"{userName} commented in {targetName}",id:"pushNotifications.userCommentedSubject.notificationSubject"},mobileUserCommentedSubject:{defaultMessage:"{userName} commented",id:"pushNotifications.mobileUserCommentedSubject.notificationSubject"},userAddedToSpace:{defaultMessage:"{userName} added you to {workspaceName}",id:"pushNotifications.userAddedToSpace.notificationSubject"},userInvitedToSpace:{defaultMessage:"{userName} invited you to {workspaceName}",id:"pushNotifications.userInvitedToSpace.notificationSubject"},userInvitedToSpaceByBot:{defaultMessage:"You have been invited to {workspaceName}",id:"pushNotifications.userInvitedToSpaceByBot.notificationSubject"},userEditedCollectionSubject:{defaultMessage:"{userName} edited {collectionName}",id:"pushNotifications.collectionEdited.notificationSubject"},userCreatedCollectionSubject:{defaultMessage:"{userName} created {collectionName}",id:"pushNotifications.collectionCreated.notificationSubject"},collectionDescriptionDeleted:{defaultMessage:"{userName} deleted the description for {collectionName}",id:"pushNotifications.collectionDescriptionDeleted.notificationSubject"},collectionDescriptionCreated:{defaultMessage:"{userName} added a description for {collectionName}",id:"pushNotifications.collectionDescriptionAdded.notificationSubject"},untitledCollectionView:{defaultMessage:"Untitled",id:"pushNotifications.untitledCollection.label"},collectionViewEditedSubject:{defaultMessage:"{userName} edited view {collectionViewName} in {collectionName}",id:"pushNotifications.collectionViewEdited.notificationSubject"},collectionPropertyEditedUnknown:{defaultMessage:"Unknown",id:"pushNotifications.unknownCollectionPropertyName.label"},collectionPropertyEditedSubject:{defaultMessage:"{userName} edited property {propertyType} in {collectionName}",id:"pushNotifications.collectionPropertyEdited.subject"},reminderSubject:{defaultMessage:"Reminder in {pageName}",id:"pushNotifications.reminderChanged.subject"},pageLockedActivity:{defaultMessage:"{userName} locked {pageName}",id:"pushNotifications.pageLocked.subject"},pageUnlockedActivity:{defaultMessage:"{userName} unlocked {pageName}",id:"pushNotifications.pageUnlocked.subject"},emailEditedActivity:{defaultMessage:"{userName} edited their account settings",id:"pushNotifications.emailAccountSettingsEdited.subject"},emptyPropertyBody:{defaultMessage:"Empty",id:"pushNotifications.emptyPropertyValueInCollection.label"},unknownRelationValueChange:{defaultMessage:"Unknown",id:"pushNotifications.unknownRelationPropertyChanged.label"},unknownAuthorInPropertySchemaChange:{defaultMessage:"Unknown author",id:"pushNotifications.unknownAuthorUpdatedProperty.label"},accessRequestedSubject:{defaultMessage:"{userName} requested access to {pageName}",id:"pushNotifications.accessRequested.subject"},accessRequestResolvedApprovedSubject:{defaultMessage:"Your request to invite {guestEmail} to {pageName} has been approved",id:"pushNotifications.accessRequestResolved.approved.subject"},accessRequestResolvedRejectedSubject:{defaultMessage:"Your request to invite {guestEmail} to {pageName} has been rejected",id:"pushNotifications.accessRequestResolved.subject"},membershipRequestedSubject:{defaultMessage:"{userName} requested to add a new member to {workspaceName}",id:"pushNotifications.membershipRequested.subject"},guestInviteRequestedSubject:{defaultMessage:"{userName} requested to invite a guest to {workspaceName}",id:"pushNotifications.guestInviteRequested.subject"},blockFormatEditPageIconName:{defaultMessage:"Page Icon",id:"pushNotifications.formatChange.pageIcon.label"},pageIconImagePlaceholder:{defaultMessage:"Image",id:"pushNotifications.formatChange.pageIcon.imagePlaceholder"},pageDeletedActivity:{defaultMessage:"{userName} deleted {pageName}",id:"pushNotifications.pageDeleted.subject"},pageRestoredActivity:{defaultMessage:"{userName} restored {pageName}",id:"pushNotifications.pageRestored.subject"},pagePermanentlyDeletedActivity:{defaultMessage:"{userName} permanently deleted {pageName}",id:"pushNotifications.pagePermanentlyDeleted.subject"},userInvitedToTeam:{defaultMessage:"{userName} invited you to {teamName} team",id:"pushNotifications.userInvitedToTeam.notificationSubject"},privateContentTransferred:{defaultMessage:"{author} transferred private content from {fromUserName} to you: {pageName}",id:"pushNotifications.privateContentTransferred.notificationSubject"},verificationExpired:{defaultMessage:"Verification expired for {pageName}",id:"pushNotifications.verificationExpired.notificationSubject"},importSuccessful:{defaultMessage:"Your {importSource} import was successful",id:"pushNotifications.importCompleted.notificationSubject"},importFailed:{defaultMessage:"Your {importSource} import has failed",id:"pushNotifications.importFailed.notificationSubject"},exportCompleted:{defaultMessage:"Your workspace export is ready",id:"pushNotifications.exportCompleted.notificationSubject"}});function I(e){const{activity:t,getRecordValue:o}=e,i=t.getEdits();return g.oA((0,V.cf)(g.xH(i.map((e=>e.authors||[])))).map((e=>{const t=o(e);if(t)return(0,r.LU)({table:e.table,value:t})})))}function B(e,t){const o=e.map((e=>e?(0,r.$4)(t,e):t.formatMessage(F.unknownAuthor)));return function(e,t){if(1===t.length)return t[0];if(2===t.length)return e.formatMessage(F.twoUserNames,{firstAuthor:t[0],secondAuthor:t[1]});if(t.length>2){const o=t.length-1;return e.formatMessage(F.threePlusUserNames,{othersCount:o,firstAuthor:t[0]})}return e.formatMessage(F.defaultPluralizedUserNames)}(t,o)}function _(e){var t;if(g.xb(e))return;const o=e[0];var i;return o.table===k.KJ&&null!==(t=o.asActor)&&void 0!==t&&t.profile_photo?null===(i=o.asActor)||void 0===i?void 0:i.profile_photo:void 0}function D(e){if(!g.xb(e))return e[0].id}function A(e){const{blockValue:t,getRecordValue:o,userTimeZone:i,intl:r}=e,n=S.kk.fromBlock(t),s=S.om.fromGetRecordValueFn(o);return n.getRenderTitleWithEmoji({getRecordModel:s,placeholder:r.formatMessage(F.untitledBlockTitle),userTimeZone:i,intl:r})}function Z(e){return E(e).title.replaceAll(/[\r\n]+/g," ")}function L(e){const{activity:t}=e,o=t.navigable_block_id||t.top_level_block_id||t.collection_row_id;return o||(t.collection_id?t.collection_id:void 0)}function E(e){const{activity:t,getRecordValue:o,pageVisitSource:i,userTimeZone:r,intl:n}=e,s=S.om.fromGetRecordValueFn(o),l=t.navigable_block_id||t.top_level_block_id||t.collection_row_id;if(l){const a=o({table:y.iU,id:l,spaceId:t.space_id});if(a){return{url:S.kk.fromBlock(a).getRenderUrl({getRecordModel:s,baseUrl:e.baseURL,pageVisitSource:i}),title:A({intl:n,blockValue:a,getRecordValue:o,userTimeZone:r})}}return{url:e.baseURL||"/",title:n.formatMessage(F.untitledBlockTitle)}}if(t.collection_id)return H(e);if("permission-group-edited"===t.type){const i=s({table:b.bx,id:t.space_id});return{title:oe(n,J({activity:t,getRecordValue:o})),url:(null==i?void 0:i.getRenderUrl({baseUrl:e.baseURL}))??"/"}}if("user-invited"===t.type){const i=function(e){const{activity:t,getRecordValue:o}=e;if(!t.permission_group_id)return;return te({spaceId:t.space_id,permissionGroupId:t.permission_group_id,getRecordValue:o})}({activity:t,getRecordValue:o}),r=s({table:b.bx,id:t.space_id});if(r&&i)return{title:oe(n,i),url:r.getRenderUrl({baseUrl:e.baseURL})}}else if("team-membership-edited"===t.type){const i=e.baseURL||"/";if(!t.team_id)return{url:i,title:n.formatMessage(F.untitledTeamName)};const r=o({table:w.e0,id:t.team_id}),l=s({table:b.bx,id:t.space_id});return{url:(null==l?void 0:l.getRenderUrl({baseUrl:e.baseURL}))??i,title:(null==r?void 0:r.name)||n.formatMessage(F.untitledTeamName)}}return N(e)}function O(e){return N(e).title}function N(e){const{activity:t,getRecordValue:o,intl:i}=e,r=o({table:b.bx,id:t.space_id});if(r){const t=S.kk.fromSpace(r);return{title:t.getRenderTitleWithEmoji({placeholder:i.formatMessage({defaultMessage:"Untitled",id:"pushNotifications.workspaceName.untitled.placeholder"})}),url:t.getRenderUrl({baseUrl:e.baseURL})}}return{url:e.baseURL||"/",title:i.formatMessage(F.untitledSpaceName)}}function z(e){return H(e).title}function H(e){const{activity:t,getRecordValue:o,pageVisitSource:i,userTimeZone:r,intl:n}=e;if(t.collection_id){const s=o({table:x.v,id:t.collection_id,spaceId:t.space_id});if(s){const t=S.kk.fromCollection(s),o=S.om.fromGetRecordValueFn(e.getRecordValue),l=t.getRenderTitleWithEmoji({getRecordModel:o,placeholder:n.formatMessage(F.untitledCollectionName),userTimeZone:r,intl:n});return{url:t.getRenderUrl({getRecordModel:o,baseUrl:e.baseURL,pageVisitSource:i}),title:l}}return{url:e.baseURL||"/",title:n.formatMessage(F.untitledCollectionName)}}return{url:e.baseURL||"/",title:n.formatMessage(F.untitledCollectionName)}}function G(e){if(e.blockValue.properties)return(0,v.X)({intl:e.intl,textValue:e.blockValue.properties.title,getRecordModel:S.om.fromGetRecordValueFn(e.getRecordValue),userTimeZone:e.userTimeZone})}function W(e,t){const o=(0,f.kD)(t,void 0);return e.formatMessage(o)}function K(e){let{userTimeZone:t,activity:o,getRecordValue:i,pageVisitSource:r,intl:n}=e;const l=o.getEdits();if(l.length){const e=[];l.forEach((t=>{"permission-created"===t.type?e.push(t.permission_data):"permission-deleted"===t.type?e.push({...t.permission_data,role:"none"}):"permission-restriction-created"===t.type||"permission-restriction-deleted"===t.type?(t.permission_data.calculated_changes||[]).forEach((t=>{let[o,i]=t;e.push(i)})):e.push(t.permission_data.after)}));const a=g.oA(e.sort(f._G).map((e=>{if("user_permission"===e.type){const t=i({table:k.KJ,id:e.user_id}),o=(0,T.Nz)(n,t),r=W(n,e.role);return n.formatMessage(F.userNameWithRole,{userName:o,permissionLevel:r})}if("space_permission"===e.type){const s=O({intl:n,activity:o,getRecordValue:i,userTimeZone:t,pageVisitSource:r}),l=W(n,e.role);return n.formatMessage(F.spaceNameWithRole,{spaceName:s,permissionLevel:l})}if("public_permission"===e.type){const t=W(n,e.role);return n.formatMessage(F.publicPermissionRoleLabel,{permissionLevel:t})}if("bot_permission"===e.type){const t=i({table:C.cZ,id:e.bot_id}),o=(0,s.Mh)(t),r=W(n,e.role);return n.formatMessage(F.botNameWithRole,{botName:o,permissionLevel:r})}})));return n.formatList(a,{type:"conjunction",style:"narrow"})}}function U(e){const{intl:t}=e;switch(e.blockValue.type){case n.Ti.text:case n.Ti.header:case n.Ti.subHeader:case n.Ti.subSubHeader:case n.Ti.factory:case n.Ti.equation:case n.Ti.code:return G(e);case n.Ti.toggle:return`▸ ${G(e)}`;case n.Ti.bulletedList:return`• ${G(e)}`;case n.Ti.numberedList:return`1. ${G(e)}`;case n.Ti.quote:return`“${G(e)}”`;case n.Ti.toDo:return(function(e){let{blockValue:t}=e;return c.Ml(t.properties&&t.properties.checked)}(e)?"✓ ":"▢ ")+G(e);case n.Ti.file:case n.Ti.bookmark:return`🔗 ${G(e)}`;case n.Ti.embed:case n.Ti.framer:case n.Ti.whimsical:case n.Ti.mixpanel:case n.Ti.miro:case n.Ti.abstract:case n.Ti.sketch:case n.Ti.excalidraw:case n.Ti.replit:case n.Ti.hex:case n.Ti.deepnote:case n.Ti.tweet:case n.Ti.gist:case n.Ti.maps:case n.Ti.invision:case n.Ti.video:case n.Ti.audio:case n.Ti.image:return t.formatMessage(F.imageInPushNotification,{imageEmoji:"🖼"});case n.Ti.drive:return function(e){const{blockValue:t}=e,o=(0,p.v0)(t);return o&&o.title?o.title:A(e)}(e);case n.Ti.page:case n.Ti.collectionView:case n.Ti.collectionViewPage:return A(e);case n.Ti.tableRow:return function(e){var t;const{blockValue:o,getRecordValue:i,userTimeZone:r,intl:n}=e,s=i({table:o.parent_table,id:o.parent_id,spaceId:o.space_id});if(!s||!o)return;const l=o.properties,a=(null===(t=s.format)||void 0===t?void 0:t.table_block_column_order)||[];return a&&l?a.map((e=>(0,v.X)({textValue:l[e],getRecordModel:S.om.fromGetRecordValueFn(i),userTimeZone:r,intl:n}))).join(", "):void 0}(e)}}function q(e){const{getRecordValue:t,baseURL:o,userTimeZone:i,intl:r}=e,n=t({table:y.iU,id:e.blockId});if(n){if("page"===n.type){const s=(0,h.ky)({block:n,getRecordValue:t});if(s){const o=a.oC(s),i=o[e.property],l=i?i.name:void 0,c=$({property:e.property,schema:o,block:n,getRecordValue:t,userTimeZone:e.userTimeZone,baseURL:e.baseURL,intl:r})||r.formatMessage(F.emptyPropertyBody);return r.formatMessage(F.propertyNameAndValueNotificationBody,{propertyName:l,propertyValue:c})}return U({intl:r,blockValue:n,getRecordValue:t,baseURL:o,userTimeZone:i})}return U({intl:r,blockValue:n,getRecordValue:t,baseURL:o,userTimeZone:i})}}function $(e){const{property:t,schema:o,getRecordValue:i,userTimeZone:n,baseURL:s,intl:p}=e,h=o[t],m=S.kk.fromBlock(e.block);if(!m.getProperties()||!h)return;const g=m.getProperties()[t];if(g){if("formula"===h.type){const e=S.om.fromGetRecordValueFn(i),r=(0,l.py)({schema:o,property:t,blockModel:m,getRecordModel:e,intl:p,userTimeZone:n,depth:0,resultCache:new Map});return d.U3(r)?(0,u.ZV)({allowRelativeDates:!0,intl:p,value:r,userTimeZone:n}):"boolean"==typeof r?r?a.bx:a.HC:(0,V.hj)(r)?r.toString():r}if("person"===h.type)return p.formatList(c.DW({textValue:g,propertySchema:h,blockCreatorPointer:m.getCreatedByPointer()}).map((e=>{const t=i(e),o=(0,r.LU)({table:e.table,value:t});return(0,r.$4)(p,o)})),{type:"conjunction",style:"narrow"});if("created_by"===h.type){const e=m.getCreatedByPointer();if(!e)return p.formatMessage(F.unknownAuthorInPropertySchemaChange);const t=i(e),o=t&&(0,r.LU)({table:e.table,value:t});return o?(0,r.$4)(p,o):p.formatMessage(F.unknownAuthorInPropertySchemaChange)}return"created_time"===h.type?(0,u.Yx)(m.getCreatedTime(),"short",p.locale,n):Y({propertySchema:h,textValue:g,getRecordValue:i,userTimeZone:n,baseURL:s,intl:p})}}function Y(e){const{propertySchema:t,textValue:o,getRecordValue:i,userTimeZone:n,baseURL:s,intl:l}=e;if("title"===t.type||"text"===t.type)return(0,v.X)({intl:l,textValue:o,getRecordModel:S.om.fromGetRecordValueFn(i),userTimeZone:n});if("select"===t.type){const e=t.options||[];return c.Sj(o,e)}if("multi_select"===t.type){const e=t.options||[];return l.formatList(c.uP(o,e),{type:"conjunction",style:"narrow"})}if("checkbox"===t.type)return c.Ml(o)?a.bx:a.HC;if("date"===t.type){const e=c.Gl(o);if(e)return(0,u.ZV)({allowRelativeDates:!0,intl:l,value:e,date_format:t.date_format,time_format:t.time_format,userTimeZone:n})}else{if("person"===t.type)return l.formatList(c.DW({textValue:o,propertySchema:t,blockCreatorPointer:void 0}).map((e=>{const t=i(e),o=(0,r.LU)({table:e.table,value:t});return(0,r.$4)(l,o)})),{type:"conjunction",style:"narrow"});if("relation"===t.type){const e=c.j$({relationValue:c.rq(o),getRecordModel:S.om.fromGetRecordValueFn(i),propertySchema:t});return l.formatList(e.map(i).map((e=>e?A({intl:l,blockValue:e,getRecordValue:i,baseURL:s,userTimeZone:n}):l.formatMessage(F.unknownRelationValueChange))),{type:"conjunction",style:"narrow"})}if("number"===t.type){const e=c.VY(o);if(void 0!==e)return e.toString()}else if("auto_increment_id"===t.type){const e=c.ah(o);if(void 0!==e)return e.toString()}else{if("file"===t.type)return l.formatList(c.g(o).map((e=>e.name||e.url)),{type:"conjunction",style:"narrow"});if("url"===t.type||"phone_number"===t.type||"email"===t.type)return c.zB(o);if("created_by"===t.type)return;if("created_time"===t.type)return;if("formula"===t.type)return;if("rollup"===t.type)return;if("last_edited_by"===t.type)return;if("last_edited_time"===t.type)return;if("last_visited_time"===t.type)return;if("button"===t.type)return;if("status"===t.type)return c.ZG(o,t);if("location"===t.type)return;if("verification"===t.type){const e=c._w(o),t=e?j.WN(e):{type:"none"};if("none"===t.type)return l.formatMessage(j.X3.none);const s=i(t.actorPointer),a=(0,r.LU)({table:t.actorPointer.table,value:s}),d=(0,r.$4)(l,a);return"verified"===t.type&&t.isIndefinite?l.formatMessage(j.X3.verifiedIndefinitely,{actor:d}):l.formatMessage(j.X3.verifiedUntil,{actor:d,datetime:M.nK({dateTime:t.dateTimeRange.end,intl:l,userTimeZone:n,displayInUserTimezone:!1,alwaysIncludeTimezone:!0})})}(0,R.t1)(t)}}}function Q(e){switch(e.formatProperty){case"page_icon":return e.intl.formatMessage(F.blockFormatEditPageIconName);default:return}}function X(e){const{formatProperty:t,block:o,getRecordValue:i,intl:r}=e;switch(t){case"page_icon":const e=S.kk.fromBlock(o).getRenderIcon({getRecordModel:S.om.fromGetRecordValueFn(i)});return e?(0,m.Z)(e.icon)?e.icon:r.formatMessage(F.pageIconImagePlaceholder):r.formatMessage(F.emptyBlockEditedProperty);default:return}}function J(e){const{activity:t,getRecordValue:o}=e;let i=te({spaceId:t.space_id,permissionGroupId:t.permission_group_id,getRecordValue:o});if(!i){const e=t.getEdits(),o=P.hI(e)[0];i="permission-group-changed"===o.type?o.permission_group_data.after:o.permission_group_data}return i}function ee(e){const{activity:t,intl:o,userName:i,targetName:r}=e,n=t.getEdits(),s=P.hI(n)[0];return s?"permission-group-created"===s.type?o.formatMessage(F.userCreatedPermissionGroup,{userName:i,permissionGroupName:r}):"permission-group-deleted"===s.type?o.formatMessage(F.userDeletedPermissionGroup,{userName:i,permissionGroupName:r}):o.formatMessage(F.userEditedPermissionGroup,{userName:i,permissionGroupName:r}):o.formatMessage(F.userEditedPermissionGroup,{userName:i,permissionGroupName:r})}function te(e){const{spaceId:t,permissionGroupId:o,getRecordValue:i}=e,r=i({table:b.bx,id:t});return(r&&r.permission_groups||[]).find((e=>e.id===o))}function oe(e,t){if(t){return[(0,m.Z)(t.icon)?t.icon:void 0,t.name||e.formatMessage(F.untitledPermissionGroupName)].filter(Boolean).join(" ")}return e.formatMessage(F.defaultPermissionGroupName)}function ie(e){switch(e){case"block-property-edited":case"commented":case"permission-group-mentioned":case"reminder":case"user-invited":case"user-mentioned":return!0;case"access-requested":case"access-request-resolved":case"email-edited":case"private-content-transferred":case"team-membership-edited":case"verification-expired":case"export-completed":case"import-completed":return!1;case"block-edited":case"collection-edited":case"collection-property-edited":case"collection-row-created":case"collection-row-deleted":case"collection-view-edited":case"page-deleted":case"page-locked":case"page-permanently-deleted":case"page-restored":case"page-unlocked":case"permission-group-edited":case"permissions-edited":case"top-level-block-created":case"top-level-block-deleted":return!1;default:(0,R.t1)(e)}}},80503:(e,t,o)=>{o.d(t,{Aj:()=>r,R6:()=>s,TT:()=>i,br:()=>n,u3:()=>l});const i=52,r=45,n=37;function s(e){return e?n:r}function l(e){return 2*s(e)}}}]);