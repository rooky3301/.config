"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[6566],{16566:(e,t,s)=>{s.d(t,{Z:()=>at,s:()=>ot});s(57658),s(21703);var o=s(67294),i=s(83355),a=s(92996),r=s(41892),n=s(6906),l=s(58573),c=s(42853),d=s(90199),p=s(47453),u=s(35840),g=s(54497),m=s(72126),h=s(21202),S=s(97880),v=s(82990),f=s(9291),y=s(88295),M=s(60870),x=s(82530),T=s(37181),I=s(51592),j=s(52275),b=s(61519),w=s(1743),P=s(56940),A=s(68894),C=s(3386),k=s(16354),Z=s(68785),B=s(78140),F=s(89728),L=s(31278),V=s(72495),N=s(14871),O=s(26388),R=s(64369),_=s(45653),q=s(60442),E=s(12457),W=s(28020),K=s(87279),z=s(98742),U=s(44499),D=s(98165),H=s(58239),Q=s(18514),G=s(38755),X=s(95697),Y=s(77907),$=s(80444),J=s(62395),ee=s(88632),te=s(77080),se=s(63334),oe=s(29798),ie=s(49085);class ae extends ie.default{getInitialState(){return{chosenSpaceId:void 0}}getChosenSpaceId(){const{chosenSpaceId:e}=this.state,{currentSpaceStore:t}=$.default.state;return e||(null==t?void 0:t.id)}getChosenSpaceStore(){var e;return null===(e=this.getChosenSpaceViewStore())||void 0===e?void 0:e.getSpaceStore()}getChosenSpaceViewStore(){const{chosenSpaceId:e}=this.state,{currentSpaceViewStore:t,currentUserRootStore:s}=$.default.state;if(!e&&t)return t;if(e&&s){return s.getSpaceViewStores().find((t=>t.getSpaceId()===e))}}}const re=ae;var ne=s(42330),le=s(26136),ce=s(72087),de=s(30765),pe=s(32163),ue=s(43765),ge=s(23586),me=s(75822),he=s(85893);function Se(e){let{query:t,spaceId:s,menuListStore:o,requestStore:i,getAutocompleteItems:a}=e;return(0,he.jsx)(ge.Z,{request:{query:t,spaceId:s},render:(e,s)=>(0,he.jsx)(ve,{sections:s,error:e,menuListStore:o,initialFocus:Boolean(t)?0:void 0}),requestStore:i,debounce:me.vp,performRequest:a})}function ve(e){let{sections:t,error:s,menuListStore:o,initialFocus:i}=e;return s?(0,he.jsx)(V.Z,{children:(0,he.jsx)(ue.Z,{title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Something went wrong.",id:"moveBlockMenu.errorOnMove.label"})})}):t&&0===t.length?(0,he.jsx)(V.Z,{children:(0,he.jsx)(ue.Z,{title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"No results",id:"moveBlockMenu.noResults.label"})})}):(0,he.jsx)(pe.Z,{type:pe.i.Vertical,initialFocus:i,sections:t||[],store:o})}var fe=s(6287),ye=s(15047),Me=s(29369),xe=s(86628),Te=s(24405),Ie=s(11470),je=s(76798),be=s(65598);function we(e){window.__c={n:"MoveToMenuItem"};const{store:t,menuListItemProps:s,hidePath:o}=e,i=(0,xe.VK)((()=>function(e){if((0,be.OY)(e)&&!e.canEdit())return(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.needEditAccess.tooltip",defaultMessage:'You need "Can edit" access to "{parentName}" to move this page',values:{parentName:(0,he.jsx)(je.Z,{store:e,shouldWrap:!0})}});if((0,be.Y)(e)&&!e.canAddOrRemoveTopLevelPages())return(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.TeamSidebarLocked.tooltip",defaultMessage:"This teamspace has its sidebar locked. You must be a teamspace owner to move to this teamspace."})}(t)),[t]),a=Boolean(i),r=(0,Te.yK)((e=>({disabledTooltip:{maxWidth:240},recordMenuItem:a?{color:e.mediumTextColor}:{}})),[a]);return(0,he.jsx)(O.ZP,{placement:O.ug.Left,textWrap:!0,style:r.disabledTooltip,disableTooltip:!a,renderTooltip:()=>i,render:e=>(0,he.jsx)(Ie.Z,{...(0,z.Z)(s,e),disabled:a,store:t,hidePath:o,style:r.recordMenuItem})})}var Pe=s(480),Ae=s(86176),Ce=s(75024);function ke(e){let{spaceStore:t,collectionStore:s,menuListItemProps:o}=e;window.__c={n:"MoveToModalTypedItem"};const i=(0,Pe.O7)(),a=(0,Te.yK)((e=>({caption:{color:e.lightTextColor,fontSize:(0,Ce.yv)(i,"UISmall")}})),[i]);return(0,he.jsx)(Ie.Z,{caption:(0,he.jsx)("div",{style:a.caption,children:(0,he.jsx)(Ze,{spaceStore:t,collectionStore:s})}),store:s,...o})}function Ze(e){let{spaceStore:t,collectionStore:s}=e;window.__c={n:"PathCaption"};const o=(0,Pe.O7)(),i=(0,xe.VK)((()=>function(e){let{environment:t,spaceStore:s,collectionStore:o}=e;const i=(0,I.tV)({environment:t,spaceStore:s,collectionStore:o});switch(i){case"team":return null;case"private":return(0,he.jsx)(f.FormattedMessage,{id:"moveToHelpers.privatePageCaptionPrefix",defaultMessage:"Private"});case"shared":return(0,he.jsx)(f.FormattedMessage,{id:"moveToHelpers.sharedPageCaptionPrefix",defaultMessage:"Shared"});default:(0,S.t1)(i)}}({environment:o,spaceStore:t,collectionStore:s})),[o,t,s]),a=(0,xe.VK)((()=>(0,Ae.L)(s)),[s])&&(0,he.jsx)(Ae.Z,{store:s,showFullPathInTooltip:!0});return a&&i?(0,he.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[i,(0,he.jsx)("div",{style:{paddingLeft:4,paddingRight:4},children:"/"}),a]}):a&&!i?a:(0,he.jsx)(he.Fragment,{children:i})}function Be(e){let{spaceStore:t,value:s,showPath:o,isCreateIn:i,onAccept:a}=e;const r=function(e){let{spaceStore:t,value:s}=e;const{type:o}=s;switch(o){case"page":return le.G.createChildStore(t,{table:h.iU,id:s.id});case"collection":return le.NW.createChildStore(t,{table:fe.v,id:s.id});case"space":return le.H2.createChildStore(t,{table:ye.bx,id:s.id});case"team":return le.zX.createChildStore(t,{table:Me.e0,id:s.id});case"space-private-pages":return;default:(0,S.t1)(o)}}({spaceStore:t,value:s});if(r)return(0,U.Hn)()&&r instanceof le.NW?{key:r.id,render:e=>(0,he.jsx)(ke,{spaceStore:t,collectionStore:r,menuListItemProps:e}),action:()=>a(s)}:{key:r.id,render:e=>(0,he.jsx)(we,{store:r,menuListItemProps:e,hidePath:!!i&&!o}),action:()=>a(s)}}var Fe=s(59054),Le=s(69327),Ve=s(41432),Ne=s(16184),Oe=s(39567),Re=s(50906),_e=s(64921),qe=s(5210),Ee=s(35026),We=s(74016);function Ke(e){return 14*(e+1)}function ze(e){window.__c={n:"MoveToOutlinerItem"};const{store:t,spaceStore:s,spaceViewStore:i,depth:a,isAlias:r}=e,n=(0,Pe.O7)(),l=(0,Te.Fg)(),[c,p]=o.useState(!1),u=(0,Te.yK)((e=>({noChildrenLabelItem:{paddingLeft:Ke(a)+24,fontSize:14,paddingBottom:6.5,color:e.lightTextColor},outlinerItem:{display:"flex",flexDirection:"row",fontSize:14,height:28,paddingLeft:Ke(a),color:e.regularTextColor,alignItems:"center"},icon:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:22,height:18,marginRight:4,position:"relative"}})),[a]);function g(){const e=ne.ZP.state;e.isOpen&&(p(!c),Re.w6U(n,{flowId:e.flowId,is_toggled:!c,destination_type:t?t.table:"private_pages"}))}const m=(0,xe.VK)((()=>{if(t){const e=(0,he.jsx)("div",{children:(0,Oe.Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0})});return t instanceof le.zX?(0,he.jsx)("div",{style:u.icon,children:(0,he.jsx)(We.p,{disabled:!0,store:t,size:18})}):(0,he.jsxs)("div",{style:u.icon,children:[(0,he.jsx)(L.Z,{icon:t instanceof le.G?t.getIcon():void 0,isEmptyPage:t instanceof le.G&&t.isEmptyPage(),title:void 0,size:18,disabled:!0}),r&&e]})}return(0,he.jsx)(_.Z,{size:16,userStore:(0,W.B7)(n),style:{marginLeft:3}})}),[t,u.icon,n,r]),S=(0,xe.VK)((()=>t?t.table===Me.e0?"private"!==t.getTeamAccessLevel()?(0,he.jsx)("div",{style:{maxWidth:"80%"},children:(0,he.jsx)(je.Z,{store:t})}):(0,he.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",maxWidth:"80%"},children:[(0,he.jsx)(je.Z,{store:t}),(0,Ne.Q)({width:14,height:14,marginLeft:4,fill:l.mediumIconColor})]}):(0,he.jsx)("div",{style:{maxWidth:"80%"},children:(0,he.jsx)(je.Z,{store:t})}):(0,he.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:7},children:[(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Private pages",id:"outliner.addToPrivatePages"}),(0,he.jsx)("div",{style:{marginLeft:2},children:(0,d.b)({width:14,height:14,fill:l.mediumIconColor,marginLeft:4})})]})),[t,l.mediumIconColor]),v=(0,xe.VK)((()=>{const e=new Set([Ve.Ti.page,Ve.Ti.collectionViewPage,Ve.Ti.collectionView,Ve.Ti.alias]),s=new Set([Ve.Ti.factory]);let o=[];return t?t instanceof le.zX?o=t.getTeamPagesStores():t instanceof le.G&&(o=(0,Ee.Q2)(t,s,e)):o=i.getPrivatePages(n),o}),[t,i,n]);const y=0!==v.length?(0,he.jsx)(Ue,{spaceStore:s,spaceViewStore:i,itemStores:v,depth:a+1,onAccept:e.onAccept,targets:e.targets}):(0,he.jsx)("div",{style:u.noChildrenLabelItem,children:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"No pages inside",id:"outliner.NoPagesInside.placeholder"})});return(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(_e.Z,{onClick:function(){e.moveToPagesOnly&&(null==t?void 0:t.table)!==h.iU?g():t?t instanceof le.G?e.onAccept({type:"page",id:t.id,spaceId:s.id}):e.onAccept({type:"team",id:t.id,spaceId:s.id}):e.onAccept({type:"space-private-pages",spaceId:s.id})},children:(0,he.jsxs)("div",{style:u.outlinerItem,children:[(0,he.jsx)(qe.Z,{isSidebar:!0,fill:!0,icon:"chevron",open:c,color:l.mediumIconColor,onClick:g}),m,S]})}),c&&a<100&&y]})}function Ue(e){window.__c={n:"MoveToOutliner"};const{spaceStore:t,spaceViewStore:s,itemStores:o,depth:i}=e,a=(0,xe.VK)((()=>{const a=o?m.oA(o.map((o=>{if(o instanceof le.zX&&o.canAddOrRemoveTopLevelPages()||o instanceof le.G&&(0,U.Xk)(o,e.targets)&&o.canEdit()){const a=o instanceof le.G&&o.getType()===Ve.Ti.alias,r=a?o.getAliasTargetStore():void 0,n=r instanceof le.G?r:o;return(0,he.jsx)(ze,{spaceStore:t,spaceViewStore:s,store:n,depth:i,onAccept:e.onAccept,targets:e.targets,isAlias:a,moveToPagesOnly:e.moveToPagesOnly},o.id)}}))):[];return e.addedItems?[...e.addedItems,...a]:a}),[o,e.addedItems,e.moveToPagesOnly,e.targets,e.onAccept,t,s,i]),r=(0,Te.yK)((e=>({sectionHeader:{color:e.mediumTextColor,fontSize:12,fontWeight:v.Z.fontWeight.medium,padding:"12px 14px 4px 14px"}})),[]);return(0,he.jsxs)(w.Z,{capture:!0,children:[e.title&&(0,he.jsx)("div",{style:r.sectionHeader,children:(0,he.jsx)(R.Z,{isSmall:!0,children:e.title})}),(0,he.jsx)("div",{children:a})]})}function De(e){window.__c={n:"MoveToModal"};const{spaceStore:t,spaceViewStore:s,targets:o,moveToPagesOnly:i}=e,a=(0,xe.VK)((()=>$.default.state.currentUserStore),[]),r=(0,Pe.O7)(),n=(0,f.useIntl)(),l=(0,Te.yK)((()=>({modal:{height:374,maxHeight:"70vh",paddingBottom:12},body:{width:"100%"}})),[]),[c]=(0,Fe.r5)((async()=>t&&a?await(0,X.qX)({environment:r,spaceStore:t,currentUserId:a.id}):[]),[r,t,a]),d=(0,xe.VK)((()=>{if(!c.value)return;const e=s.getTeamsStores().filter((e=>e.canAddOrRemoveTopLevelPages()));return e.length>=7?e:m.mN([...e,...c.value||[]],(e=>e.id)).filter((e=>e.canAddOrRemoveTopLevelPages())).slice(0,7)}),[s,c.value]),p=(0,xe.VK)((()=>He({spaceStore:t,targets:o})),[t,o]),u=(0,xe.VK)((()=>s.getWorkspacePages().filter((e=>(0,U.Xk)(e,o)&&e.canEdit()))),[s,o]),g=(0,xe.VK)((()=>{if(Qe({environment:r,targets:o,chosenSpaceStore:t}))return(0,he.jsx)(ze,{spaceStore:t,spaceViewStore:s,store:void 0,depth:0,onAccept:e.onAccept,targets:e.targets,moveToPagesOnly:i},"MoveToModal private item")}),[r,i,e,t,s,o]);return t&&s?(0,he.jsx)("div",{style:l.modal,children:(0,he.jsx)("div",{style:l.body,children:(0,he.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,he.jsx)(Ue,{spaceStore:t,spaceViewStore:s,itemStores:p,addedItems:[g],moveToPagesOnly:i,depth:0,title:n.formatMessage({defaultMessage:"Suggested",id:"moveToModal.suggestedSection.title"}),onAccept:e.onAccept,targets:e.targets}),d&&d.length>0&&(0,he.jsx)(Ue,{spaceStore:t,spaceViewStore:s,itemStores:d,moveToPagesOnly:i,depth:0,title:n.formatMessage({defaultMessage:"Teamspaces",id:"moveToModal.teamsSection.title"}),onAccept:e.onAccept,targets:e.targets}),u.length>0&&(0,he.jsx)(Ue,{spaceStore:t,spaceViewStore:s,itemStores:u,moveToPagesOnly:i,depth:0,title:n.formatMessage({defaultMessage:"Workspace",id:"moveToModal.workspaceSection.title"}),onAccept:e.onAccept,targets:e.targets})]})})}):null}function He(e){let{spaceStore:t,targets:s}=e,o=Le.Z.getWithoutSubscribing(t.id).map((e=>{let{store:t}=e;return t})).filter((e=>e.pathIsAccessibleAndAlive()&&!s.some((t=>"block"===t.table&&t.id===e.id))));const i=s.filter((e=>"block"===e.getParentTable())).map((e=>e.getParentId())),a=i.length===s.length,r=[...new Set(i)];return a&&1===r.length&&(o=o.filter((e=>e.id!==r[0]))),o.slice(0,7)}function Qe(e){let{environment:t,targets:s,chosenSpaceStore:o}=e;const i=(0,G.Cx)(o),a=s.every((e=>e.isTopLevelPrivatePage({spaceStore:o,environment:t})));return!i&&!a}var Ge=s(84169),Xe=s(73063),Ye=s(43568),$e=s(40215),Je=s(20658);function et(e){window.__c={n:"MoveToModalTypedEmptyState"};const{onClick:t,databaseType:s}=e,o=(0,Pe.O7)(),i=(0,Te.yK)((e=>({modal:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginTop:32,marginBottom:32},icon:{width:20,fill:e.mediumTextColor},title:{marginTop:6,fontWeight:v.Z.fontWeight.semibold,color:e.mediumTextColor},subtitle:{marginTop:2,marginLeft:14,marginRight:14,textAlign:"center"},button:{fontWeight:v.Z.fontWeight.semibold,fontSize:(0,Ce.yv)(o,"UISmall")}})),[o]),a=(0,I.sN)(s),r=(0,I.Q_)(s);return(0,he.jsxs)("div",{style:i.modal,children:[(0,Je.$)(i.icon),(0,he.jsx)(R.Z,{isSmall:!0,style:i.title,children:(0,he.jsx)(f.FormattedMessage,{id:"moveToModalTypedEmptyState.title",defaultMessage:"No other {singleItemName} databases",values:{singleItemName:a}})}),(0,he.jsx)(R.Z,{isSmall:!0,isMultiline:!0,style:i.subtitle,children:(0,he.jsx)(f.FormattedMessage,{id:"moveToModalTypedEmptyState.subtitle",defaultMessage:"Try adding {pluralItemName} to another teamspace",values:{pluralItemName:r}})}),(0,he.jsx)(F.Z,{isBlue:!0,onClick:t,style:i.button,children:(0,he.jsx)(f.FormattedMessage,{id:"moveToModalTypedEmptyState.button",defaultMessage:"Move somewhere else"})})]})}function tt(e){let{spaceStore:t,spaceViewStore:s,targets:o,menuListStore:i,onAccept:r}=e;window.__c={n:"MoveToModalTyped"};const l=(0,Pe.O7)(),c=(0,Te.yK)((()=>({modal:{maxHeight:"70vh"},loadingShimmer:{padding:16}})),[]),d=(0,xe.VK)((()=>s.getTeamsStores().map((e=>e.id))),[s]),p=(0,$e.F)({environment:l,spaceStore:t,parentStore:t,joinedTeamIds:d,moveToTargets:o,overrideDatabaseType:void 0}),u=(0,xe.VK)((()=>p.success?p.typedDatabases.map((e=>function(e){const{store:t,spaceStore:s,onAccept:o}=e;return{key:t.id,render:e=>(0,he.jsx)(ke,{spaceStore:s,collectionStore:t,menuListItemProps:e}),action:()=>o({type:"collection",id:t.id,spaceId:s.id})}}({store:e,spaceStore:t,onAccept:r}))):[]),[p,t,r]),g=(0,xe.VK)((()=>ne.ZP.getTargetsDatabaseType()),[]);if(!p.success)return(0,he.jsx)("div",{style:c.loadingShimmer,children:(0,he.jsx)(Ye.Z,{paragraphs:[{lineHeight:18,lineMargin:4,sectionWidths:[100],repeat:1,sectionMargin:0},{lineHeight:14,lineMargin:4,sectionWidths:[100,40],repeat:1,sectionMargin:-2}]})});if(!g)throw new Error("Trying to show typed moveTo modal when database type is not available.");if(0===u.length)return(0,he.jsx)(et,{databaseType:g,onClick:()=>{ne.ZP.state.isOpen&&ne.ZP.setState({...ne.ZP.state,variant:a.br})}});const m=(0,I.sN)(g),h=[{key:"suggested",render:e=>(0,he.jsx)(V.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"{typedItemName} databases",id:"moveToModalTyped.suggestedMenuSection.title",values:{typedItemName:(0,n.Z)(m)}}),right:(0,he.jsx)(st,{typedItemName:m})}),items:u.slice(0,7)}];return(0,he.jsx)("div",{style:c.modal,children:(0,he.jsx)(pe.Z,{initialFocus:0,type:pe.i.Vertical,sections:h||[],store:i})})}function st(e){let{typedItemName:t}=e;window.__c={n:"TypedMoveToTooltip"};const s=(0,Te.yK)((e=>({icon:{width:13,height:13,fill:e.mediumIconColor},iconButton:{height:18,width:18,padding:0,marginTop:-4,marginBottom:-4,marginRight:-4}})),[]),o=(0,f.useIntl)();return(0,Pe.Fy)().isMobile?null:(0,he.jsx)(O.ZP,{placement:O.ug.Bottom,style:{width:220},textWrap:!0,renderTooltip:()=>(0,he.jsx)(f.FormattedMessage,{defaultMessage:"{typedItemName} properties will be kept when moving to these locations",id:"moveTypedMenu.tooltip",values:{typedItemName:m.kC(t)}}),render:e=>(0,he.jsx)(Xe.Z,{ariaLabel:o.formatMessage({id:"moveToModalTyped.helpIcon.ariaLabel",defaultMessage:"Help icon for moving typed pages."}),icon:Ge.m,iconStyle:s.icon,style:s.iconButton,...e})})}const ot=(0,f.defineMessages)({createSubpage:{id:"moveToOrCreateMenu.createSubpage.description",defaultMessage:"Create a new sub-page where your cursor is, inside the current block."},newPageIn:{id:"moveToOrCreateMenu.newPageIn.description",defaultMessage:"Create a new page inside any existing page, then link to it in one go."},turnInto:{id:"moveToOrCreateMenu.turnInto.description",defaultMessage:"Turn blocks into new pages inside any existing database or page."},privatePagesTitle:{defaultMessage:"Private Pages",id:"moveBlockMenu.privatePagesMenuTitle"}});class it extends i.Z{constructor(){super(...arguments),this.storeTypes={ignoreSelectionAreaStore:se.Z,moveToSpaceMenuStore:re,requestStore:ce.Z,menuListStore:oe.Z},this.getAutocompleteItems=async e=>{const{currentUserRootStore:t,mainEditorCurrentBlockStore:s,currentSpaceStore:o}=$.default.state,{query:i}=e,a=this.stores.moveToSpaceMenuStore.getChosenSpaceStore();if(!(t&&a&&s&&o))return[];const r=(0,H.lX)({spaceStore:a,currentUserId:this.environment.currentUser.id}),[n,l,c,d]=await async function(e,t,s,o,i){const a=[],r=[],n=[];let l=[];if(t&&rt()){const r=await Y.deps.searchActions.loader(),l=await r.searchPageIds({environment:i,query:t,limit:20,spaceId:e.id,requireEditPermissions:!1,excludeTemplates:!1,source:"move_to_menu",boostRecentlyViewedPages:!0});for(const t of l.results){const i=le.G.createChildStore(e.getPagesStore(),{table:h.iU,id:t});if((0,U.Xk)(i,s)){const e={blockId:i.id,isEditable:i.canEdit()};lt(i,o)?n.push(e):a.push(e)}}}else{l=(await M.I0(e,e.id)).map((t=>{const s=le.G.createChildStore(e.getPagesStore(),{table:h.iU,id:t});return{blockId:s.id,isEditable:s.canEdit()}})),l=l.filter((t=>{let{blockId:i}=t;const a=le.G.createChildStore(e.getPagesStore(),{table:h.iU,id:i});if((0,U.Xk)(a,s)){const e={blockId:a.id,isEditable:a.canEdit()};return!lt(a,o)||(n.push(e),!1)}}));const t=W.Xb(i);for(const e of t)if((0,U.Xk)(e,s)){const t={blockId:e.id,isEditable:e.canEdit()};lt(e,o)?n.push(t):r.push(t)}}return[a,r,n,l]}(a,i,this.props.targets,this.props.isCreateIn,this.environment),p=await r;return(0,U.Hn)()?await this.getTypedAutoCompleteItems({chosenSpaceStore:a,savedQuickAddParent:p,query:i,blockResults:n,recentPageResults:d}):this.props.isCreateIn?this.createAutoCompleteItems(a,i,n,l,c,d):this.getAutoCompleteItems(a,p,i,n,l,c,d)},this.createAutoCompleteItems=(e,t,s,o,i,a)=>{const{isAddTo:r,isTurnIntoPage:n}=this.props,l=[],c=new Set,d=e=>{if(!e)return!1;const{key:t}=e;return!c.has(t)&&(c.add(t),!0)},p=m.oA([nt({query:t},this.environment,this.props.targets,this.props.onAccept,this.props.parentBlockId,this.props.isAddTo,this.props.isCreateIn)]);!p.length||Boolean(n)||Boolean(r)||l.push({key:"defaults",render:e=>(0,he.jsx)(V.Z,{...e}),items:p});const u=m.oA([...a.slice(0,5).map((t=>{let{blockId:s}=t;return Be({spaceStore:e,value:{type:"page",id:s,spaceId:e.id},showPath:!Boolean(n)&&!Boolean(r),isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept})})),...s.slice(0,10).map((s=>{let{blockId:o}=s;return Be({spaceStore:e,value:{type:"page",id:o,spaceId:e.id},showPath:!t,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept})})),...o.slice(0,10).map((s=>{let{blockId:o}=s;return Be({spaceStore:e,value:{type:"page",id:o,spaceId:e.id},showPath:!t,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept})}))].slice(0,20).filter(d));u.length>0&&l.push({key:"blocks",render:e=>(0,he.jsx)(V.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Suggested",id:"moveBlockMenu.suggestedSection.title"}),topBorder:l.length>0&&!Boolean(n)&&!Boolean(r)}),items:u});const g=m.oA(this.getMoveToTeamMenuItems(t).filter(d));g.length>0&&(0,X.bq)()&&l.push({key:"teams",render:e=>(0,he.jsx)(V.Z,{...e,isTitleUppercase:!0,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Teamspaces",id:"moveBlockMenu.teamsSection.title"}),topBorder:l.length>0}),items:g});const h=m.oA(i.slice(0,5).map((t=>{let{blockId:s}=t;return Be({spaceStore:e,value:{type:"page",id:s,spaceId:e.id},showPath:!0,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept})})).filter(d));return h.length>0&&l.push({key:"templates",render:e=>(0,he.jsx)(V.Z,{...e,isTitleUppercase:!0,title:r?(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Add from template",id:"moveBlockMenu.addFromTemplate.title"}):(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Move to template",id:"moveBlockMenu.moveToTemplate.title"}),topBorder:l.length>0}),items:h}),p.length&&(Boolean(n)||Boolean(r))&&l.push({key:"defaults",render:e=>(0,he.jsx)(V.Z,{...e,topBorder:l.length>0}),items:p}),l},this.getAutoCompleteItems=(e,t,s,o,i,a,r)=>{const n=this.getSuggestedMenuSection(s,e),l=[...r.slice(0,3),...o.slice(0,20)],c={key:"pages",render:e=>(0,he.jsx)(V.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Pages",id:"moveBlockMenu.pagesSection.title"})}),items:m.mN(m.VS(m.oA([this.getSavedQuickAddParentMenuItem({query:s,savedQuickAddParent:t}),...l.map((t=>{let{blockId:o}=t;return Be({spaceStore:e,value:{type:"page",id:o,spaceId:e.id},showPath:!s,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept})}))])),(e=>e.key))};return[n,{key:"teams",render:e=>(0,he.jsx)(V.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Teamspaces",id:"moveBlockMenu.teamsSection.title"})}),items:m.oA(this.getMoveToTeamMenuItems(s)).slice(0,10)},c].filter((e=>e.items.length>0))},this.getTypedAutoCompleteItems=async e=>{let{chosenSpaceStore:t,savedQuickAddParent:s,query:o,blockResults:i,recentPageResults:a}=e;const{typedSuggestedMenuSection:r,typedSuggestedResults:n}=await this.getTypedSuggestedMenuSection(o);if(ne.ZP.state.isOpen&&"aggregated_type"===ne.ZP.state.moveToContext)return[r].filter((e=>e.items.length>0));let l=(0,U.XQ)({recentPageResults:a,blockResults:i,suggestedPages:n});const c=new Set((0,U.qB)(this.props.targets));c.size>0&&(l=l.filter((e=>!c.has(e.blockId))));const d=m.mN(m.VS(m.oA([this.getSavedQuickAddParentMenuItem({query:o,savedQuickAddParent:s}),...l.map((e=>{let{blockId:s}=e;return Be({spaceStore:t,value:{type:"page",id:s,spaceId:t.id},showPath:!o,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept})}))])),(e=>e.key)),p=m.oA(this.getMoveToTeamMenuItems(o)).slice(0,5),u=r.items.length>0,g={key:"teams",render:e=>(0,he.jsx)(V.Z,{...e,desktopStyle:{paddingTop:u?0:6,paddingBottom:6},title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Teamspaces",id:"typedMoveBlockMenu.teamsSection.title"})}),items:p},h=r.items.length>0&&0===g.items.length;return[r,g,{key:"pages",render:e=>(0,he.jsx)(V.Z,{...e,desktopStyle:{paddingTop:h?0:6,paddingBottom:6},title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Pages",id:"typedMoveBlockMenu.pagesSection.title"})}),items:d}].filter((e=>e.items.length>0))},this.getTypedSuggestedMenuSection=async e=>{if(!ne.ZP.state.isOpen||ne.ZP.state.variant===a.br||"typedUninitialized"===ne.ZP.state.variant||!J.n.state)throw new Error("Trying to render section when it's either not open, untyped, or typed but uninitialized (i.e. the typed databases are not fetched yet)");const t=ne.ZP.getTargetsDatabaseType(),s=(0,I.sN)(t),{typedDatabases:o}=J.n.state;let i;i=te.default.checkGate("typed_move_to_improved_search")?await this.getTypedCollectionMenuItemsFromSearch({query:e,databaseType:t?[t]:void 0}):this.getTypedMoveToMenuItems({query:e,typedDatabases:o});return{typedSuggestedMenuSection:{key:"suggested",render:e=>(0,he.jsx)(V.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"{typedItemName} databases",id:"moveBlockMenu.typedSuggestedSection.title",values:{typedItemName:(0,n.Z)(s)}}),right:(0,he.jsx)(st,{typedItemName:s})}),items:i.slice(0,5)},typedSuggestedResults:o}},this.allTargetsAreNavigableStore=this.createComputedStore((()=>this.props.targets.every((e=>e.isNavigableBlock()))))}renderComponent(){if(!this.props.isAddTo&&!this.props.isCreateIn&&!ne.ZP.state.isOpen)return(0,he.jsx)(he.Fragment,{});const{device:e}=this.environment,{autocompleteQuery:t,isAddTo:s,isTurnIntoPage:o}=this.props,{requestStore:i,menuListStore:a}=this.stores,r=!i.state.ready&&t.length>0;let n,l;return n=rt()?e.isPhone?this.renderInputMenuItem(r):(0,he.jsx)(V.Z,{isInput:!0,children:this.renderInputMenuItem(r)}):void 0,l=e.isPhone?{onMouseEnter:this.props.onMouseEnter,menuType:K.og.Modal,title:o?(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Add to another page",id:"moveBlockMenu.mobileNewPageInj.label"}):s?(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Add new page in",id:"moveBlockMenu.mobileAddTo.label"}):(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Move to",id:"moveBlockMenu.mobileMoveTo.label"}),right:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Done",id:"moveBlockMenu.rightDoneButton.label"}),onClickRight:this.props.onCancel,header:n}:{onMouseEnter:this.props.onMouseEnter,menuType:K.og.Popup,width:this.props.desktopWidth,header:n},(0,he.jsxs)(w.Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowTabUntab:!1,allowUndo:!1,children:[(0,he.jsx)(C.Z,{capture:!0,onEsc:this.props.onCancel}),(0,he.jsx)(P.Z,{store:this.stores.ignoreSelectionAreaStore,capture:this.props.captureSelection,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:this.props.restoreSelection,render:()=>{var e;const t=!Boolean(this.props.autocompleteQuery)&&!this.environment.device.isPhone||(0,U.Hn)()&&!Boolean(this.props.autocompleteQuery);return(0,he.jsx)(B.Z,{...l,footer:this.renderFooter(),children:t?this.renderMoveToModal():(0,he.jsx)(Se,{query:this.props.autocompleteQuery,spaceId:null===(e=this.getChosenSpaceStore())||void 0===e?void 0:e.id,menuListStore:a,requestStore:i,getAutocompleteItems:this.getAutocompleteItems})})}})]})}renderMoveToModal(){const e=this.getChosenSpaceStore(),t=this.getChosenSpaceViewStore();if(!t||!e)return;if((0,U.Hn)())return(0,he.jsx)(tt,{spaceStore:e,spaceViewStore:t,onAccept:e=>ct(e,this.props.onAccept,this.environment),targets:this.props.targets,menuListStore:this.stores.menuListStore});const s=(0,G.Cx)(e);return(0,he.jsx)(De,{spaceStore:e,spaceViewStore:t,onAccept:this.props.onAccept,targets:this.props.targets,moveToPagesOnly:!this.allTargetsAreNavigableStore.state||s})}renderFooter(){const{isCreateIn:e,isAddTo:t,intl:s}=this.props,{currentUserRootStore:o,currentSpaceStore:i}=$.default.state,a=this.stores.moveToSpaceMenuStore.getChosenSpaceStore();if(!o||!a||!i)return;if(!(this.allTargetsAreNavigableStore.state&&!i.getDisableMoveToSpace()&&!e&&!t))return null;const r=o.getSpaceViewStores(),n=m.mN(m.oA(r.map((e=>{const t=e.getSpaceStore();return!(0,G.Cx)(t)&&t}))),(e=>e.id)),l={menuTitle:s.formatMessage({defaultMessage:"Workspaces",id:"moveBlockMenu.spaceSwitcher.menuTitle"}),items:n,selectedItem:a,onSelect:e=>{this.stores.moveToSpaceMenuStore.setState({chosenSpaceId:e.id})},getKey:e=>e.id,renderItem:e=>(0,he.jsx)(j.Z,{...e,checkState:e.value.id===a.id,title:(0,G.rn)(this.environment,e.value),icon:(0,he.jsx)(L.Z,{icon:(0,G.Wd)(this.environment,e.value),isEmptyPage:!1,size:20,disabled:!0,title:(0,G.rn)(this.environment,e.value)})}),renderOrigin:e=>{return(0,he.jsxs)(F.Z,{isSmall:!0,style:{fontWeight:"normal",fontSize:12,flexShrink:1},...e,children:[(0,he.jsx)(L.Z,{disabled:!0,icon:a.getIcon(),isEmptyPage:!1,size:16,title:a.getName(),style:{marginRight:4}}),(0,he.jsx)(de.s,{children:(0,G.rn)(this.environment,a)}),(0,c.i)((t=this.theme,{width:10,marginLeft:4,fill:t.lightIconColor}))]});var t},width:150};return(0,he.jsxs)("div",{children:[(0,he.jsx)(b.Z,{vertical:!1,size:1}),(0,he.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",padding:"4px"},children:(0,he.jsx)(N.Z,{...l},"space-switcher")})]})}renderInputMenuItemLabel(){const{intl:e,isAddTo:t,isTurnIntoPage:s}=this.props;if(this.isMovingToAnotherSpace())return e.formatMessage({defaultMessage:"Duplicate page…",id:"moveToMenuRenderer.duplicateToSpace.label"});if((0,U.Hn)()){const t=(0,I.sN)(ne.ZP.getTargetsDatabaseType());return e.formatMessage({defaultMessage:"Move {typedItemName} to…",id:"moveToMenuRenderer.moveTo.typedLabel"},{typedItemName:t})}return s?e.formatMessage({defaultMessage:"Search page to add in…",id:"moveToMenuRenderer.addNewPageIn.label"}):t?e.formatMessage({defaultMessage:"Search page to add to…",id:"moveToMenuRenderer.addTo.label"}):e.formatMessage({defaultMessage:"Move page to…",id:"moveToMenuRenderer.moveTo.teamLabel"})}renderInputMenuItem(e){const{device:t}=this.environment,{autocompleteQuery:s}=this.props,o=(0,U.Hn)()&&ne.ZP.state.isOpen&&"typedUninitialized"===ne.ZP.state.variant;return(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(A.ZP,{onCancel:()=>{ne.ZP.state.isOpen&&ne.ZP.setState({...ne.ZP.state,isOpen:!1})},disabled:o,focus:!t.isMobile||void 0,focusAfterAnimation:!0,value:s,onChange:e=>{this.props.onAutocompleteQueryChange(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:this.renderInputMenuItemLabel(),inputLeft:(0,he.jsx)(A.f_,{icon:u.R}),inputRight:(0,he.jsx)(E.Z,{show:e,showDelay:400,showHold:0,render:e=>e&&(0,he.jsx)(Z.Z,{style:{marginRight:2}})}),style:{marginBottom:-2}}),this.isMovingToAnotherSpace()&&(0,he.jsxs)(R.Z,{isMultiline:!0,isSecondaryColor:!1,style:{background:this.theme.accentColors.gray[30],marginTop:12,marginLeft:12,marginRight:12,padding:8,borderRadius:6},children:[(0,g.t)({fill:this.theme.accentColors.orange[400],width:14,height:14,marginRight:4,alignSelf:"center",display:"inline-block",verticalAlign:"text-bottom"}),(0,he.jsx)("span",{children:(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.duplicateToSpace.message",defaultMessage:"You can only duplicate pages into another workspace — not move them."})}),(0,he.jsx)(k.Z,{href:(0,Q.UY)("guides.duplicateToSpace"),style:{color:this.theme.accentColors.gray[500],fontWeight:v.Z.fontWeight.semibold,marginTop:4},children:(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.duplicateToSpace.learnMoreLink",defaultMessage:"Learn more"})})]})]})}getSuggestedMenuSection(e,t){const s=0===e.length&&t?He({spaceStore:t,targets:this.props.targets}):[];return{key:"suggested",render:e=>(0,he.jsx)(V.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Suggested",id:"moveBlockMenu.suggestedSection.title"})}),items:m.oA([this.getPrivatePagesMenuItem({query:e,chosenSpaceStore:t}),...s.filter((e=>(0,U.Xk)(e,this.props.targets))).map((e=>Be({spaceStore:t,value:{type:"page",id:e.id,spaceId:t.id},showPath:!1,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept})))])}}async getTypedCollectionMenuItemsFromSearch(e){const{databaseType:t,query:s}=e,o=this.getChosenSpaceStore();if(!o)return[];const i=await Y.deps.searchActions.loader();return(await i.searchCollectionsWithRecents({environment:this.environment,query:s,limit:20,databaseType:t,parentStore:o,spaceStore:o,collectionViewBlockStore:void 0})).results.map((e=>Be({spaceStore:o,value:{type:"collection",id:e,spaceId:o.id},showPath:!0,isCreateIn:this.props.isCreateIn,onAccept:this.props.isCreateIn?this.props.onAccept:e=>ct(e,this.props.onAccept,this.environment)}))).filter(S.$K)}getPrivatePagesMenuItem(e){var t;const{query:s,chosenSpaceStore:o}=e,i=ot.privatePagesTitle,a=this.props.intl.formatMessage(i).replace(/<[^>]*>/g,""),r=s?null===(t=(0,l.C6)(s,a))||void 0===t?void 0:t.score:void 0,n=s&&(r||0)>=l.V5;if((!s||n)&&this.allTargetsAreNavigableStore.state&&(!o||Qe({environment:this.environment,targets:this.props.targets,chosenSpaceStore:o})))return{key:"private",render:e=>(0,he.jsx)(j.Z,{icon:(0,he.jsx)(_.Z,{size:22,userStore:(0,W.B7)(this.environment)}),title:(0,he.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,he.jsx)("span",{children:(0,he.jsx)(f.FormattedMessage,{...i})}),(0,X.bq)()&&(0,he.jsx)("div",{style:{marginLeft:2},children:(0,d.b)({width:14,height:14,fill:this.theme.mediumIconColor})})]}),...e}),action:()=>{this.props.onAccept({type:"space-private-pages"})}}}getSavedQuickAddParentMenuItem(e){const{isAddTo:t}=this.props,{query:s,savedQuickAddParent:o}=e,i=this.getChosenSpaceStore();if(i)return t&&!s&&"space"===o.type||"page"===o.type?Be({spaceStore:i,value:o,showPath:!0,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept}):void 0}getTypedMoveToMenuItems(e){const{query:t,typedDatabases:s}=e,o=this.getChosenSpaceStore();if(!o||!t||!s)return[];return(0,l.ZP)(t,s,(e=>{const t=String(e.getName())||"",s=(0,D.u3)(e);return[t,s instanceof le.zX&&s.getName()||""].join(" ")})).map((e=>Be({spaceStore:o,value:{type:"collection",id:e.id,spaceId:o.id},showPath:!0,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept}))).filter(S.$K)}getMoveToTeamMenuItems(e){if(e&&!this.allTargetsAreNavigableStore.state)return[];const t=this.getChosenSpaceStore(),s=this.getChosenSpaceViewStore();if(!t||!s)return[];let o=s.getTeamsStores();return e&&(o=(0,l.ZP)(e,o,(e=>e.getName()||""))),o.map((e=>Be({spaceStore:t,value:{type:"team",id:e.id,spaceId:t.id},showPath:!1,isCreateIn:this.props.isCreateIn,onAccept:this.props.onAccept}))).filter(S.$K)}isMovingToAnotherSpace(){var e;const{moveToSpaceMenuStore:t}=this.stores;return!!t&&t.getChosenSpaceId()!==(null===(e=$.default.state.currentSpaceStore)||void 0===e?void 0:e.id)}getChosenSpaceStore(){return this.stores.moveToSpaceMenuStore.getChosenSpaceStore()??$.default.state.currentSpaceStore}getChosenSpaceViewStore(){return this.stores.moveToSpaceMenuStore.getChosenSpaceViewStore()??$.default.state.currentSpaceViewStore}}it.displayName="MoveToOrCreateMenu";const at=(0,f.injectIntl)(it);function rt(){return ee.Z.state.online}function nt(e,t,s,o,i,a,n){if(!a||!n)return;if(e.query)return;const l=$.default.state.mainEditorCurrentBlockStore;if(!l)return;const c=i?le.G.createChildStore(l,{table:h.iU,id:i}):void 0,d=y.gt(c);return d?{key:d.pageStore.id,render:e=>{const o=t=>(0,he.jsx)(j.Z,{...(0,z.Z)(t||{},e),icon:(0,p.R)({width:14}),title:s.length>1?(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.currentPage.pluralAddTitle",defaultMessage:"New sub-pages"}):(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.currentPage.singleAddTitle",defaultMessage:"New sub-page"})});return t.device.isPhone?o():(0,he.jsx)(O.ZP,{renderTooltip:()=>(0,he.jsx)(q.Z,{imageURL:r.Z.images.tooltips.pageMenu.newSubpagePng,imageWidth:140,imageHeight:100,caption:(0,he.jsx)(f.FormattedMessage,{...ot.createSubpage})}),placement:O.ug.Right,delayThreshold:0,render:e=>o(e)})},action:()=>o(d.createInValue)}:void 0}function lt(e,t){return!!t&&e.isTemplate()}function ct(e,t,s){var o;t(e);const i=ne.ZP.getTargetsDatabaseType(),a=null===(o=$.default.state.currentSpaceStore)||void 0===o?void 0:o.id;"collection"===e.type&&i&&a&&x.createAndCommit({userAction:"TypedMoveToMenu.handleClick",environment:s,perform:t=>{T.zq({transaction:t,dbType:i,collectionId:e.id})}})}},30765:(e,t,s)=>{s.d(t,{s:()=>c});var o=s(67294),i=s(480),a=s(24405),r=s(82990),n=s(26388);var l=s(85893);function c(e){let{children:t,style:s}=e;window.__c={n:"TextOverflowWithTooltip"};const{isSafari:c}=(0,i.Fy)(),d=(0,o.useRef)(null),p=function(e){const[t,s]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const{current:t}=e;if(!t)return void s(!1);const o="ResizeObserver"in window?new ResizeObserver((e=>{let[t]=e;s(t.target.scrollWidth>t.target.clientWidth)})):void 0;return null==o||o.observe(t),()=>null==o?void 0:o.unobserve(t)}),[]),t}(d),u=(0,a.yK)((()=>({overflowText:{...r.Z.textOverflowStyle,...s}})),[s]);return(0,l.jsx)(n.ZP,{delayThreshold:500,placement:n.ug.Bottom,forceVisibleState:!(c||!p)&&void 0,renderTooltip:()=>p?t:void 0,render:e=>(0,l.jsx)("div",{ref:d,style:u.overflowText,...e,children:t})})}}}]);